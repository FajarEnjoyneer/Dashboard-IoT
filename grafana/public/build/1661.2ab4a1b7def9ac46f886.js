"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1661],{81661:(Qn,je,o)=>{o.r(je),o.d(je,{default:()=>An});var r=o(74848),C=o(22803),Y=o(96540),x=o(49785),z=o(25229),l=o(92745),Xe=o(62061),N=o(63142),S=o(41654),qe=o(6975),_e=o(66404),T=o(37386),se=o(63527),q=o(3271),et=o(83813),_=o(68886),b=o(80238),tt=o(2416),nt=o(30063),U=o(70234),ye=o(47006),w=o(95955),at=o(94676),Oe=o(60861),rt=o(46310),ue=o(9229),J=o(17834),A=o(45861),Q=o(69788),st=o(41053),oe=o(32899),he=o(83175),ie=o(75234),Te=o(87063),be=o(94535),ot=o(88559),it=o(4213),lt=o.n(it),dt=o(75505),ct=o(68143),Ce=o(98924),Fe=o(51208);const ut=async(e,t)=>{if((0,Ce.nu)(t)){(0,ie.J7)().publish({type:oe.r1.alertError.name,payload:["Invalid dashboards"]});return}const n={title:e,dashboards:(0,Fe.IM)(t)},a=he.kM.appendQueryToUrl(U.yo,he.kM.toUrlParams(n));try{const s=await(0,dt.s)((0,ct.AI)().fetch({url:a,method:"GET",responseType:"blob"}));if(s.status===204){(0,ie.J7)().publish({type:oe.r1.alertWarning.name,payload:["The report does not contain any dashboard with a table panel"]});return}const i=new Blob([s.data],{type:"application/zip"});lt()(i,`${e||"report-csv"}.zip`),(0,ie.J7)().publish({type:oe.r1.alertSuccess.name,payload:["CSV downloaded"]})}catch{(0,ie.J7)().publish({type:oe.r1.alertError.name,payload:["There was an error downloading the CSV"]})}};var k=o(40951);function ht({sceneDashboards:e}){const{watch:t}=(0,x.xW)(),n=(0,ye.b0)(),a=t("title"),[s,i]=(0,st.A)(async p=>{k.M.downloadCSVClicked(n.renderingContext),p.stopPropagation(),await ut(a,e)},[a,e]),d=(0,Ce.nu)(e),h=p=>{k.M.previewPDFClicked(n.renderingContext),d&&(p.stopPropagation(),(0,ie.J7)().publish({type:oe.r1.alertError.name,payload:["Invalid dashboards"]}));const f={title:a,scaleFactor:t("pdfOptions.scaleFactor")||100,orientation:t("pdfOptions.orientation")||"landscape",layout:t("pdfOptions.layout")||"grid",pdfShowTemplateVariables:(!!t("pdfOptions.dashboardPDF.showTemplateVariables")).toString(),pdfCombineOneFile:(!!t("pdfOptions.dashboardPDF.combineOneFile")).toString(),includeTables:(!!t("pdfOptions.dashboardPDF.addPDFTablesAppendix")).toString(),dashboards:(0,Fe.IM)(e)},g=he.kM.appendQueryToUrl(U.oS,he.kM.toUrlParams(f));window.open(g,"_blank")},u=(0,r.jsxs)(Te.W,{children:[(0,r.jsx)(be.D,{label:s.loading?(0,l.t)("share-report.actions.downloading-label","Downloading..."):(0,l.t)("share-report.actions.download-csv-label","Download CSV"),icon:s.loading?"spinner":"file-download",onClick:i,disabled:s.loading,testId:w.Tp.components.ReportFormDrawer.ActionsMenu.downloadCsv}),(0,r.jsx)(be.D,{label:(0,l.t)("share-report.actions.preview-pdf-label","Preview PDF"),icon:"external-link-alt",onClick:h,testId:w.Tp.components.ReportFormDrawer.ActionsMenu.previewPdf}),(0,r.jsx)(Te.W.Divider,{}),(0,r.jsx)(be.D,{label:(0,l.t)("share-report.actions.report-settings-label","Report settings"),icon:"external-link-alt",url:U.oY,target:"_blank",testId:w.Tp.components.ReportFormDrawer.ActionsMenu.reportSettings,onClick:()=>k.M.settingsClicked(n.renderingContext)})]});return(0,r.jsx)(ot.m,{overlay:u,placement:"bottom-end",children:(0,r.jsx)(A.$n,{variant:"secondary",fill:"outline",icon:"ellipsis-v","data-testid":w.Tp.components.ReportFormDrawer.actionsMenuButton})})}var W=o(32635),mt=o(59243),me=o(43910);function pt({sceneDashboards:e}){const t=(0,N.of)(ft),[n,a]=(0,Y.useState)(!1),{watch:s,trigger:i}=(0,x.xW)(),d=s("recipients")||[],h=(0,ye.b0)(),[u,{isLoading:p}]=(0,_.lg)(),{register:f,handleSubmit:g,watch:m,setValue:y,clearErrors:j,formState:{errors:v},reset:M}=(0,x.mN)({defaultValues:{previewEmail:"",useReportEmails:!1}}),E=m("useReportEmails"),O=()=>{a(!1),M({previewEmail:"",useReportEmails:!1})},X=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),g($)())},$=async c=>{k.M.sendClicked(h.renderingContext);const I={...s(),recipients:c.useReportEmails?d:[c.previewEmail]},F=(0,ue.Js)({...I,dashboardsScene:e});await u(F).unwrap(),O()},G=async()=>{k.M.sendPreviewClicked(h.renderingContext),await i(["title","dashboards"],{shouldFocus:!0})&&a(!0)},ae=(0,r.jsx)("div",{className:t.container,children:(0,r.jsxs)(S.B,{direction:"column",gap:1.5,children:[(0,r.jsx)(T.D,{label:(0,l.t)("share-report.send-preview.email","Email"),required:!0,description:(0,l.t)("share-report.send-preview.email-description","Separate multiple email addresses with a comma or semicolon"),error:v.previewEmail?.message,invalid:!!v.previewEmail,children:(0,r.jsx)(se.p,{placeholder:"your.address@company.com",...f("previewEmail",{required:(0,l.t)("share-report.send-preview.email-required","Email is required"),validate:c=>(0,me.K7)(c)||(0,l.t)("share-report.recipients.invalid-emails","Invalid emails: {{emails}}",{emails:c})}),onKeyDown:X,disabled:E})}),(0,r.jsx)(T.D,{children:(0,r.jsx)(W.S,{disabled:!d.length,label:(0,l.t)("share-report.send-preview.use-report-emails","Use emails from report"),...f("useReportEmails",{onChange:c=>{const I=c.target.checked;y("useReportEmails",I),I?(y("previewEmail",d.join(", ")),j("previewEmail")):y("previewEmail","")}})})}),(0,r.jsxs)(S.B,{gap:2,justifyContent:"flex-start",direction:{xs:"column",sm:"row"},children:[(0,r.jsx)(A.$n,{variant:"secondary",disabled:p,onClick:O,children:(0,l.t)("share-report.send-preview.cancel","Cancel")}),(0,r.jsx)(A.$n,{onClick:()=>g($)(),disabled:p,icon:p?"fa fa-spinner":void 0,children:p?(0,l.t)("share-report.send-preview.sending","Sending..."):(0,l.t)("share-report.send-preview.send","Send")})]})]})});return(0,r.jsx)(mt.G,{content:ae,title:(0,l.t)("share-report.send-preview.title","Send preview"),placement:"auto-start",theme:"info",show:n,onOpen:G,onClose:O,children:(0,r.jsx)(A.$n,{variant:"secondary",fill:"outline",children:(0,l.t)("share-report.send-preview.button","Send preview")})})}const ft=e=>({container:(0,C.css)({width:"400"})});function gt({isUpsertLoading:e,isSaveDraftLoading:t,isUpdateStateReportLoading:n,onSaveDraftClick:a,onDeleteClick:s,onToggleStateClick:i,sceneDashboards:d,isEditMode:h,reportState:u}){const{formState:{isDirty:p}}=(0,x.xW)();return(0,r.jsxs)(S.B,{justifyContent:"space-between",direction:{xs:"column",md:"row"},gap:{xs:2,md:0},children:[(0,r.jsxs)(S.B,{gap:1,children:[(0,r.jsx)(ht,{sceneDashboards:d}),(0,r.jsx)(pt,{sceneDashboards:d})]}),(0,r.jsxs)(S.B,{gap:{xs:2,md:1},direction:{xs:"column",md:"row"},children:[(0,r.jsx)(A.$n,{type:"submit",variant:"primary","data-testid":w.Tp.components.ReportFormDrawer.submitButton,icon:e?"spinner":void 0,fullWidth:!0,children:h&&u!==Q.ReportState.Draft?e?(0,l.t)("share-report.update-report.updating-button","Updating report..."):(0,l.t)("share-report.update-report.button","Update report"):e?(0,l.t)("share-report.schedule-report.scheduling-button","Scheduling report..."):(0,l.t)("share-report.schedule-report.button","Schedule report")}),(!h||u===Q.ReportState.Draft)&&(0,r.jsx)(A.$n,{variant:"secondary",icon:t?"spinner":void 0,onClick:a,fullWidth:!0,children:t?(0,l.t)("share-report.save-draft.saving-button","Saving draft..."):(0,l.t)("share-report.save-draft.button","Save draft")}),(u===Q.ReportState.Scheduled||u===Q.ReportState.Paused)&&(0,r.jsx)(A.$n,{variant:"secondary",disabled:p,icon:u===Q.ReportState.Scheduled?"pause":"play",onClick:i,fullWidth:!0,children:u===Q.ReportState.Scheduled?n?(0,l.t)("share-report.update-report.pausing-button","Pausing report..."):(0,l.t)("share-report.update-report.pause-button","Pause"):n?(0,l.t)("share-report.update-report.resuming-button","Resuming report..."):(0,l.t)("share-report.update-report.resume-button","Resume")}),u&&(0,r.jsx)(A.$n,{icon:"trash-alt",variant:"destructive",onClick:s,fullWidth:!0,children:(0,l.t)("share-report.update-report.delete-button","Delete")})]})]})}var xt=o(59310);function yt(){const{register:e}=(0,x.xW)();return(0,r.jsx)(W.S,{...e("schedule.workdaysOnly"),label:(0,l.t)("share-report.schedule.workdays-only","Send Monday to Friday only")})}var bt=o(43482),ee=o(30703);const ve=(0,Y.forwardRef)(({onClear:e,...t},n)=>{const a=(0,N.of)(vt);return(0,r.jsx)(bt.l,{...t,ref:n,closeOnSelect:!0,suffix:(0,r.jsxs)(S.B,{gap:1,alignItems:"center",children:[t.value&&e&&(0,r.jsx)(ee.I,{name:"times",size:"lg",className:a.iconButton,onClick:e}),(0,r.jsx)(ee.I,{name:"calendar-alt"})]})})});ve.displayName="DatePickerInput";const vt=e=>({iconButton:(0,C.css)({"&:hover":{color:e.colors.text.maxContrast},cursor:"pointer"})});function Dt(){const{control:e,watch:t,formState:{errors:n},resetField:a}=(0,x.xW)(),s=t("schedule.startDate")??new Date;return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.end-date","End date"),error:n.schedule?.endDate?.message,invalid:!!n.schedule?.endDate?.message,htmlFor:"end-date-picker",children:(0,r.jsx)(x.xI,{name:"schedule.endDate",control:e,rules:(0,J.As)(t()).schedule.endDate,render:({field:{value:i,...d}})=>(0,r.jsx)(ve,{id:"end-date-picker",...d,value:i||"",placeholder:(0,l.t)("share-report.schedule.end-date-placeholder","Does not end"),minDate:new Date(s),onClear:()=>a("schedule.endDate")})})})}var Re=o(11527);function wt(){const{control:e}=(0,x.xW)();return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.end-time","End time"),children:(0,r.jsx)(x.xI,{name:"schedule.endTime",render:({field:{ref:t,...n}})=>(0,r.jsx)(Re.R,{...n,minuteStep:10}),control:e})})}var le=o(43243);const St=[{label:"Once",value:b.Bw.Once},{label:"Hourly",value:b.Bw.Hourly},{label:"Daily",value:b.Bw.Daily},{label:"Weekly",value:b.Bw.Weekly},{label:"Monthly",value:b.Bw.Monthly},{label:"Custom",value:b.Bw.Custom}];function jt(){const{control:e}=(0,x.xW)();return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.frequency","Frequency"),htmlFor:"frequency-combobox",children:(0,r.jsx)(x.xI,{name:"schedule.frequency",control:e,render:({field:{ref:t,onChange:n,...a}})=>(0,r.jsx)(le.G,{id:"frequency-combobox",...a,options:St,onChange:s=>{n(s.value)}})})})}var Ot=o(77824);const Tt=[{label:"Send now",value:b.OZ.Now},{label:"Send later",value:b.OZ.Later}];function Ct(){const{control:e}=(0,x.xW)();return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.send-time","Schedule"),children:(0,r.jsx)(x.xI,{control:e,name:"schedule.sendTime",render:({field:{ref:t,...n}})=>(0,r.jsx)(Ot.z,{fullWidth:!0,...n,options:Tt})})})}function Ft(){const{register:e,control:t,formState:n}=(0,x.xW)(),a=!!n.errors.schedule?.intervalAmount;return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.repeat-every","Repeat every"),error:n.errors.schedule?.intervalAmount?.message,...a&&{invalid:!0},htmlFor:"repeat-frequency",children:(0,r.jsxs)(S.B,{gap:1,children:[(0,r.jsx)(se.p,{width:8,id:"repeat-frequency",type:"number",min:2,...e("schedule.intervalAmount",{valueAsNumber:!0,...(0,J.As)().schedule.intervalAmount}),placeholder:(0,l.t)("share-report.schedule.repeat-every-placeholder","e.g. 2"),defaultValue:2}),(0,r.jsx)(x.xI,{control:t,name:"schedule.intervalFrequency",defaultValue:b.o9.Hours,render:({field:{ref:s,onChange:i,...d}})=>(0,r.jsx)(le.G,{...d,onChange:h=>i(h.value),options:Ee,placeholder:(0,l.t)("share-report.schedule.repeat-interval-frequency-placeholder","e.g. hours")})})]})})}var Rt=o(95062);function Et(){const{watch:e,setValue:t,trigger:n,control:a,formState:{errors:s,isSubmitted:i}}=(0,x.xW)(),d=h=>{const p=e("schedule.lastDayOfMonthOnly")&&(0,Rt.c)(h);t("schedule.lastDayOfMonthOnly",p)};return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.start-date","Start date"),error:s.schedule?.startDate?.message,invalid:!!s.schedule?.startDate?.message,htmlFor:"start-date-picker",children:(0,r.jsx)(x.xI,{name:"schedule.startDate",control:a,rules:(0,J.As)().schedule.startDate,defaultValue:new Date,render:({field:{onChange:h,...u}})=>(0,r.jsx)(ve,{id:"start-date-picker",...u,placeholder:(0,l.t)("share-report.schedule.start-date-placeholder","Select date"),onChange:p=>{const f=new Date(p);d(f),h(f),i&&n("schedule.endDate")},minDate:new Date})})})}function Mt(){const{control:e}=(0,x.xW)();return(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.start-time","Start time"),children:(0,r.jsx)(x.xI,{name:"schedule.startTime",render:({field:{ref:t,...n}})=>(0,r.jsx)(Re.R,{...n,minuteStep:10}),control:e})})}const Ee=[{label:"hours",value:b.o9.Hours},{label:"days",value:b.o9.Days},{label:"weeks",value:b.o9.Weeks},{label:"months",value:b.o9.Months}];function Pt(){const{control:e}=(0,x.xW)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Et,{}),(0,r.jsx)(Mt,{}),(0,r.jsx)(T.D,{label:(0,l.t)("share-report.schedule.time-zone","Time zone"),children:(0,r.jsx)(x.xI,{name:"schedule.timeZone",render:({field:{ref:t,...n}})=>(0,r.jsx)(xt.U,{...n,openMenuOnFocus:!1}),control:e})})]})}var It=o(16817),De=o(22592),V=o(36674),Me=o(5857),kt=o(6890),Wt=o(64762),Bt=o(12880),Pe=o(13956),Ie=o(7817),ke=o(55211),Yt=o(52763),At=o(49045),We=o(7389),Nt=o(43173),Be=o(72636),Ye=o(45967),Vt=o(56265),Lt=o(76319),Ae=o(34999),Ne=o(74475),$t=o(95506);class Gt extends V.Bs{constructor(t){super({...t,title:t?.title??"",onRemoveClick:t?.onRemoveClick??(()=>{})}),this.onDashboardChange=(n,a,s,i,d)=>{this.setState({uid:n,title:a,$timeRange:s,$variables:i,variableControls:d})},this.onRemove=()=>{this.setState({uid:void 0,title:void 0,$variables:void 0,$timeRange:void 0})}}static{this.Component=Ht}}function Ht({model:e}){const{watch:t,control:n,formState:{errors:a},setValue:s}=(0,x.xW)(),{uid:i,variableControls:d,$variables:h,onRemoveClick:u,key:p}=e.useState(),[f,g]=(0,Y.useState)(!0),m=(0,N.of)(Qt),y=(0,N.$j)(),j=(0,At.A)(`(max-width: ${y.breakpoints.values.md}px)`),v=t("dashboards"),M=v.filter(c=>c.uid===i).length>1,E=v.findIndex(c=>c.uid===i),O=v.findIndex(c=>c.key===p),X=M&&O>E,$=async c=>{if(!c){e.onRemove();return}const I=await(0,Pe.n)("v1").getDashboardDTO(c.uid),F=new Ie.G(I.dashboard,I.meta),B=new V.JZ({from:F.time.from,to:F.time.to,fiscalYearStartMonth:F.fiscalYearStartMonth,timeZone:F.timezone,weekStart:(0,Me.rE)(F.weekStart)?F.weekStart:void 0}),Se=(0,ke.bc)(F);e.onDashboardChange(c.uid,c.title,B,Se,[new V.K8({layout:"vertical"}),new V.i7]),s(`dashboards.${O}.uid`,c.uid),s(`dashboards.${O}.timeRange`,B.state.value)},G=V.jh.getTimeRange(e),ae=h?.state.variables?.filter(({state:c})=>c.hide!==We.zL.hideVariable);return(0,r.jsxs)(S.B,{direction:"column",flex:1,children:[(0,r.jsxs)(S.B,{alignItems:"flex-start",flex:1,direction:{xs:"column",md:"row"},children:[(0,r.jsx)("div",{className:m.sourceDashboard,children:(0,r.jsx)(T.D,{label:(0,l.t)("share-report.dashboard.source-dashboard-label","Source dashboard"),required:!0,className:m.field,error:a.dashboards?.[O]?.uid?.message,invalid:!!a.dashboards?.[O]?.uid?.message,children:(0,r.jsx)(x.xI,{name:`dashboards.${O}.uid`,control:n,rules:(0,J.As)().dashboards.uid,render:({field:{onChange:c,...I}})=>(0,r.jsx)($t.b,{...I,onChange:F=>{c(F?.uid),$(F)}})})})}),(0,r.jsx)(T.D,{label:(0,r.jsx)(Be.J,{children:(0,r.jsxs)(S.B,{alignItems:"center",children:[(0,l.t)("share-report.dashboard.time-range-label","Time range"),(0,r.jsx)(Ye.m,{content:(0,l.t)("share-report.dashboard.time-range-description","Empty time range will fallback to the time range from the report's dashboard. Absolute time range is represented in your browser's timezone."),children:(0,r.jsx)(ee.I,{name:"info-circle"})})]})}),className:m.field,error:a.dashboards?.[O]?.timeRange?.message,invalid:!!a.dashboards?.[O]?.timeRange?.message,required:!0,children:(0,r.jsx)(x.xI,{name:`dashboards.${O}.timeRange`,control:n,render:({field:{onChange:c,ref:I,...F}})=>(0,r.jsx)(Vt.b,{...F,clearable:!0,value:G.state.value,timeZone:"browser",onChange:B=>{c(B),G.onTimeRangeChange(B)},isReversed:j})})}),(0,r.jsx)(T.D,{label:"",children:(0,r.jsxs)(S.B,{alignItems:"center",children:[(0,r.jsx)(A.z9,{disabled:!i,href:`${Nt.$.appUrl}d/${i}`,target:"_blank",icon:"external-link-alt",variant:"secondary",fill:"text",tooltip:(0,l.t)("share-report.dashboard.view-dashboard-tooltip","View dashboard")}),v.length>1&&(0,r.jsx)(Lt.K,{name:"trash-alt",tooltip:(0,l.t)("share-report.dashboard.delete-dashboard-tooltip","Delete this dashboard"),onClick:()=>u(e)},"delete")]})})]}),ae?.length?X?(0,r.jsx)(Ae.F,{severity:"info",title:(0,l.t)("share-report.dashboard.repeated-template-variables-description","When adding the same dashboard multiple times in one report, template variables that you selected first are applied to all instances of that dashboard in the report.")}):(0,r.jsx)("div",{children:(0,r.jsx)(Ne.M,{label:(0,l.t)("share-report.dashboard.template-variables-title","Customize template variables"),isOpen:f,onToggle:()=>g(c=>!c),className:m.templateVariablesSectionTitle,children:(0,r.jsx)(S.B,{gap:1,direction:{xs:"column",md:"row"},wrap:"wrap",children:d?.map(c=>(0,r.jsx)(c.Component,{model:c},c.state.key))??(0,r.jsx)(r.Fragment,{})})})}):null]})}const Qt=e=>({sourceDashboard:(0,C.css)({flex:1,width:"100%",[e.breakpoints.up("md")]:{width:"auto"}}),field:(0,C.css)({width:"100%",[e.breakpoints.up("md")]:{width:"auto"}}),templateVariablesSectionTitle:(0,C.css)({fontSize:e.typography.h6.fontSize,color:e.colors.text.primary})}),Zt=({report:e,setValue:t,appendDashboard:n,removeDashboard:a})=>{const s=(0,Yt.wA)(),[i,d]=(0,Y.useState)([]),h=async()=>{try{const m=e?.dashboards?.filter(y=>y?.uid);return m?.length?await Promise.all(m.map(async y=>{const j=await(0,Pe.n)("v1").getDashboardDTO(y.uid),v=new Ie.G(j.dashboard,j.meta),M=new V.JZ({from:y.timeRange.from,to:y.timeRange.to,fiscalYearStartMonth:v.fiscalYearStartMonth,timeZone:v.timezone,weekStart:(0,Me.rE)(v.weekStart)?v.weekStart:void 0});if(!y.timeRange.from&&!y.timeRange.to){const $=(0,z.KQ)(null),G=(0,z.KQ)(null);M.onTimeRangeChange({from:$,to:G,raw:{from:$,to:G}})}const E=(0,Bt.Xt)(v.templating.list,y.variables);v.templating.list=E;const O=(0,ke.bc)(v);return p({key:void 0,uid:y?.uid,title:y?.title,timeRange:M,variables:O})})):[p()]}catch(m){return s((0,kt.dx)((0,Wt.gi)(m instanceof Error?m.message:"There was an error trying to load report dashboards"))),[]}},{loading:u}=(0,It.A)(async()=>{const m=await h(),y=m?.map(j=>{const v=j.state.$timeRange?.state.value||(0,De.E2)();return{uid:j.state.uid,key:j.state.key,timeRange:v}});d(m??[]),t("dashboards",y??[],{shouldDirty:!1})},[e]),p=m=>new Gt({key:m?.key,uid:m?.uid,title:m?.title,$timeRange:m?.timeRange?.clone()||new V.JZ({value:(0,De.E2)()}),$variables:m?.variables?.clone(),variableControls:[new V.K8({layout:"vertical"}),new V.i7],onRemoveClick:f}),f=m=>{const y=i?.findIndex(j=>j.state.key===m.state.key);y!==void 0&&(a(y),d(j=>j.filter(v=>v!==m)))};return{sceneDashboards:i,isLoadingDashboards:u,onAddDashboardClick:()=>{const m=p();d(j=>[...j,m]);const y=m.state.$timeRange?.state.value||(0,De.E2)();n({uid:void 0,key:m.state.key,timeRange:y})}}};var we=o(13943),Ve=o(65642);function de({label:e,children:t,contentClassName:n,dataTestId:a,isOpen:s,onToggle:i,contentDataTestId:d}){const h=(0,N.of)(zt);return(0,r.jsx)(Ne.M,{isOpen:s,onToggle:i,label:e,className:h.sectionTitle,contentClassName:(0,C.cx)(h.content,n),unmountContentWhenClosed:!1,headerDataTestId:a,contentDataTestId:d,children:t})}const zt=e=>({sectionTitle:(0,C.css)({fontSize:e.typography.h4.fontSize}),content:(0,C.css)({paddingBottom:e.spacing(0)})}),Ut=Q.reportOrientations.map(({icon:e,...t})=>({...t,value:t.value??""})),Jt=Q.reportLayouts.map(({icon:e,...t})=>({...t,value:t.value??""}));function Kt({open:e,onToggle:t,dashboards:n}){const{register:a,watch:s,control:i,formState:{touchedFields:d}}=(0,x.xW)(),h=(0,N.of)(Xt),u=(0,Y.useRef)(null),p=!!Ve.Ay.featureToggles.newPDFRendering,f=!!Ve.Ay.featureToggles.pdfTables,g=s("attachments.pdf"),m=s("attachments.pdfTables"),y=n?.some(v=>v.state.$variables?.state.variables?.some(({state:M})=>M.hide!==We.zL.hideVariable));(0,Y.useEffect)(()=>{(g&&d.attachments?.pdf||m&&d.attachments?.pdfTables)&&u?.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[g,m,d,u]);const j=(0,U.aZ)(p).filter(v=>!v.isDisabled).map(v=>({label:v.label,value:v.value??1}));return(0,r.jsxs)(de,{isOpen:e,label:(0,l.t)("share-report.attachments.section-title","Attachments"),onToggle:t,dataTestId:w.Tp.components.ReportFormDrawer.Attachments.header,contentDataTestId:w.Tp.components.ReportFormDrawer.Attachments.content,children:[(0,r.jsxs)(S.B,{direction:"column",alignItems:"start",gap:1.5,children:[(0,r.jsx)(W.S,{label:(0,l.t)("share-report.attachments.pdf-report","Attach the report as a PDF"),...a("attachments.pdf"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.pdfReportCheckbox}),f&&(0,r.jsx)(W.S,{label:(0,l.t)("share-report.attachments.pdf-tables","Attach a separate PDF of table data"),...a("attachments.pdfTables"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.pdfTablesCheckbox}),(0,r.jsx)(W.S,{label:(0,l.t)("share-report.attachments.csv-tables","Attach a CSV file of table panel data"),...a("attachments.csv"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.csvTablesCheckbox})]}),(g||m)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q.c,{}),(0,r.jsxs)("div",{ref:u,children:[(0,r.jsx)("h4",{className:h.pdfFormatTitle,children:(0,l.t)("share-report.attachments.pdf-format","PDF format")}),(0,r.jsxs)(we.x,{columns:{xs:1,md:3},gap:1,children:[(0,r.jsx)(T.D,{label:(0,r.jsxs)(S.B,{children:[(0,r.jsx)(Be.J,{children:(0,l.t)("share-report.attachments.orientation","Orientation")}),(0,r.jsx)(Ye.m,{placement:"right-end",content:(0,l.t)("share-report.attachments.orientation-tooltip","The orientation selection will be applied to the dashboard PDF, table data and the PDF appendix"),children:(0,r.jsx)(ee.I,{name:"info-circle",size:"xs"})})]}),children:(0,r.jsx)(x.xI,{control:i,name:"pdfOptions.orientation",render:({field:{onChange:v,ref:M,...E}})=>(0,r.jsx)(le.G,{...E,options:Ut,onChange:O=>v(O.value)})})}),g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(T.D,{label:(0,l.t)("share-report.attachments.layout","Layout"),children:(0,r.jsx)(x.xI,{control:i,name:"pdfOptions.layout",render:({field:{onChange:v,ref:M,...E}})=>(0,r.jsx)(le.G,{...E,options:Jt,onChange:O=>v(O.value)})})}),(0,r.jsx)(T.D,{label:(0,l.t)("share-report.attachments.zoom","Zoom scale"),children:(0,r.jsx)(x.xI,{control:i,name:"pdfOptions.scaleFactor",render:({field:{onChange:v,ref:M,...E}})=>(0,r.jsx)(le.G,{...E,options:j,onChange:O=>v(O.value)})})})]})]}),g&&(0,r.jsx)("div",{children:(0,r.jsxs)(S.B,{direction:"column",alignItems:"start",gap:1.5,children:[n&&n?.length>1&&(0,r.jsx)(W.S,{...a("pdfOptions.dashboardPDF.combineOneFile"),label:(0,l.t)("share-report.attachments.combine-one-file","Combine all dashboards PDFs in one file"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.combineDashboardsCheckbox}),y&&(0,r.jsx)(W.S,{...a("pdfOptions.dashboardPDF.showTemplateVariables"),label:(0,l.t)("share-report.attachments.show-template-variables","Show template variables in the header"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.showTemplateVariablesCheckbox}),f&&(0,r.jsx)(W.S,{...a("pdfOptions.dashboardPDF.addPDFTablesAppendix"),label:(0,l.t)("share-report.attachments.pdf-tables-appendix","Include table data as PDF appendix"),"data-test-id":w.Tp.components.ReportFormDrawer.Attachments.pdfTablesAppendixCheckbox})]})})]})]})]})}const Xt=e=>({pdfFormatTitle:(0,C.css)({color:e.colors.text.secondary})});var qt=o(87105),_t=o(89640);function en({open:e,onToggle:t}){const n=(0,N.of)(tn),{register:a,formState:{errors:s}}=(0,x.xW)();return(0,r.jsxs)(de,{label:(0,l.t)("share-report.email-configuration.section-title","Email settings"),dataTestId:w.Tp.components.ReportFormDrawer.EmailConfiguration.header,contentDataTestId:w.Tp.components.ReportFormDrawer.EmailConfiguration.content,isOpen:e,onToggle:t,children:[(0,r.jsx)(T.D,{label:(0,l.t)("share-report.email-configuration.subject-label","Email subject"),description:(0,l.t)("share-report.email-configuration.subject-description","The report name will be used as the email subject if this field is left empty"),children:(0,r.jsx)(se.p,{id:"subject-input",...a("subject"),type:"text","data-testid":w.Tp.components.ReportFormDrawer.EmailConfiguration.subjectInput})}),(0,r.jsx)(T.D,{label:(0,l.t)("share-report.email-configuration.message-label","Message"),children:(0,r.jsx)(qt.f,{id:"message-input",...a("message"),rows:4,placeholder:(0,l.t)("share-report.email-configuration.message-placeholder","Enter a message"),"data-testid":w.Tp.components.ReportFormDrawer.EmailConfiguration.messageInput})}),(0,r.jsx)(T.D,{label:(0,l.t)("share-report.email-configuration.reply-to-label","Reply-to-email address"),invalid:!!s.replyTo,error:s.replyTo?.message,children:(0,r.jsx)(se.p,{id:"reply-to-input",...a("replyTo",(0,J.As)().replyTo),placeholder:"your.address@company.com",type:"text","data-testid":w.Tp.components.ReportFormDrawer.EmailConfiguration.replyToInput})}),(0,r.jsxs)(S.B,{direction:"column",gap:1,alignItems:"start",children:[(0,r.jsx)(W.S,{...a("addDashboardUrl"),label:(0,l.t)("share-report.email-configuration.add-dashboard-url-label","Include dashboard link"),"data-testid":w.Tp.components.ReportFormDrawer.EmailConfiguration.addDashboardUrlCheckbox}),(0,r.jsx)(W.S,{...a("addDashboardImage"),label:(0,l.t)("share-report.email-configuration.add-dashboard-image-label","Embed dashboard image"),"data-testid":w.Tp.components.ReportFormDrawer.EmailConfiguration.addDashboardImageCheckbox}),(0,r.jsx)("div",{className:n.imageSettings,children:(0,r.jsxs)(S.B,{gap:1,alignItems:"center",children:[(0,r.jsx)(ee.I,{name:"info-circle"}),(0,r.jsxs)(l.x6,{i18nKey:"share-report.email-configuration.dashboard-image-settings-description",children:["The dashboard image settings can be adjusted in the general",(0,r.jsx)(_t.Y,{variant:"bodySmall",href:U.oY,inline:!0,external:!0,children:"report settings"})]})]})})]})]})}const tn=e=>({imageSettings:(0,C.css)({fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.secondary,marginTop:e.spacing(1)})});var nn=o(10928);function an({open:e,onToggle:t}){const{control:n,formState:{errors:a},setError:s,clearErrors:i,setValue:d}=(0,x.xW)();function h(u){const p=u.flatMap(y=>y.split(me.mF).filter(Boolean).map(j=>j.trim())),f=[...new Set(p)],g=f.filter(y=>(0,me.xf)(y)),m=f.filter(y=>!(0,me.xf)(y));d("recipients",g,{shouldDirty:!0}),m.length?s("recipients",{type:"manual",message:m.length>1?(0,l.t)("share-report.recipients.invalid-emails","Invalid emails: {{emails}}",{emails:m.join("; ")}):(0,l.t)("share-report.recipients.invalid-email","Invalid email: {{email}}",{email:m[0]})}):i("recipients")}return(0,r.jsx)(de,{isOpen:e,label:(0,l.t)("share-report.recipients.section-title","Recipients"),onToggle:t,dataTestId:w.Tp.components.ReportFormDrawer.Recipients.header,contentDataTestId:w.Tp.components.ReportFormDrawer.Recipients.content,children:(0,r.jsx)(T.D,{label:(0,l.t)("share-report.recipients.field-label","Recipients"),description:(0,l.t)("share-report.recipients.tooltip","Separate multiple email addresses with a comma or semicolon"),required:!0,invalid:!!a.recipients,error:a.recipients?.message,children:(0,r.jsx)(x.xI,{name:"recipients",control:n,rules:(0,J.As)().recipients,render:({field:{value:u,...p}})=>(0,r.jsx)(nn.u,{...p,disabled:!Oe.V,invalid:!!a.recipients,onChange:h,placeholder:(0,l.t)("share-report.recipients.placeholder","Type in the recipients' email addresses and press Enter"),tags:u,autoColors:!1,addOnBlur:!0})})})})}var rn=o(65988),sn=o(75156),pe=o(92516),on=o(2831),L=o(29407);function ln(e,t){const n=(0,L.a)(e,t?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const Zn=null;function dn(e,t){const n=(0,L.a)(e,t?.in);return(0,on.m)(n,ln(n))+1}const zn=null;var Le=o(61501);function ce(e,t){const n=(0,pe.q)(),a=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,s=(0,L.a)(e,t?.in),i=s.getDay(),d=(i<a?7:0)+i-a;return s.setDate(s.getDate()-d),s.setHours(0,0,0,0),s}const Un=null;function fe(e,t){return ce(e,{...t,weekStartsOn:1})}const Jn=null;var te=o(43329);function $e(e,t){const n=(0,L.a)(e,t?.in),a=n.getFullYear(),s=(0,te.w)(n,0);s.setFullYear(a+1,0,4),s.setHours(0,0,0,0);const i=fe(s),d=(0,te.w)(n,0);d.setFullYear(a,0,4),d.setHours(0,0,0,0);const h=fe(d);return n.getTime()>=i.getTime()?a+1:n.getTime()>=h.getTime()?a:a-1}const Kn=null;function cn(e,t){const n=$e(e,t),a=(0,te.w)(t?.in||e,0);return a.setFullYear(n,0,4),a.setHours(0,0,0,0),fe(a)}const Xn=null;function un(e,t){const n=(0,L.a)(e,t?.in),a=+fe(n)-+cn(n);return Math.round(a/Le.my)+1}const qn=null;function Ge(e,t){const n=(0,L.a)(e,t?.in),a=n.getFullYear(),s=(0,pe.q)(),i=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,d=(0,te.w)(t?.in||e,0);d.setFullYear(a+1,0,i),d.setHours(0,0,0,0);const h=ce(d,t),u=(0,te.w)(t?.in||e,0);u.setFullYear(a,0,i),u.setHours(0,0,0,0);const p=ce(u,t);return+n>=+h?a+1:+n>=+p?a:a-1}const _n=null;function hn(e,t){const n=(0,pe.q)(),a=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,s=Ge(e,t),i=(0,te.w)(t?.in||e,0);return i.setFullYear(s,0,a),i.setHours(0,0,0,0),ce(i,t)}const ea=null;function mn(e,t){const n=(0,L.a)(e,t?.in),a=+ce(n,t)-+hn(n,t);return Math.round(a/Le.my)+1}const ta=null;function D(e,t){const n=e<0?"-":"",a=Math.abs(e).toString().padStart(t,"0");return n+a}const Z={y(e,t){const n=e.getFullYear(),a=n>0?n:1-n;return D(t==="yy"?a%100:a,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):D(n+1,2)},d(e,t){return D(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return D(e.getHours()%12||12,t.length)},H(e,t){return D(e.getHours(),t.length)},m(e,t){return D(e.getMinutes(),t.length)},s(e,t){return D(e.getSeconds(),t.length)},S(e,t){const n=t.length,a=e.getMilliseconds(),s=Math.trunc(a*Math.pow(10,n-3));return D(s,t.length)}},ne={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},He={G:function(e,t,n){const a=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});case"GGGG":default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const a=e.getFullYear(),s=a>0?a:1-a;return n.ordinalNumber(s,{unit:"year"})}return Z.y(e,t)},Y:function(e,t,n,a){const s=Ge(e,a),i=s>0?s:1-s;if(t==="YY"){const d=i%100;return D(d,2)}return t==="Yo"?n.ordinalNumber(i,{unit:"year"}):D(i,t.length)},R:function(e,t){const n=$e(e);return D(n,t.length)},u:function(e,t){const n=e.getFullYear();return D(n,t.length)},Q:function(e,t,n){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return D(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return D(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){const a=e.getMonth();switch(t){case"M":case"MM":return Z.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){const a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return D(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){const s=mn(e,a);return t==="wo"?n.ordinalNumber(s,{unit:"week"}):D(s,t.length)},I:function(e,t,n){const a=un(e);return t==="Io"?n.ordinalNumber(a,{unit:"week"}):D(a,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):Z.d(e,t)},D:function(e,t,n){const a=dn(e);return t==="Do"?n.ordinalNumber(a,{unit:"dayOfYear"}):D(a,t.length)},E:function(e,t,n){const a=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});case"EEEE":default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){const s=e.getDay(),i=(s-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return D(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});case"eeee":default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){const s=e.getDay(),i=(s-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return D(i,t.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});case"cccc":default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,n){const a=e.getDay(),s=a===0?7:a;switch(t){case"i":return String(s);case"ii":return D(s,t.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});case"iiii":default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,t,n){const a=e.getHours();let s;switch(a===12?s=ne.noon:a===0?s=ne.midnight:s=a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,n){const a=e.getHours();let s;switch(a>=17?s=ne.evening:a>=12?s=ne.afternoon:a>=4?s=ne.morning:s=ne.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let a=e.getHours()%12;return a===0&&(a=12),n.ordinalNumber(a,{unit:"hour"})}return Z.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):Z.H(e,t)},K:function(e,t,n){const a=e.getHours()%12;return t==="Ko"?n.ordinalNumber(a,{unit:"hour"}):D(a,t.length)},k:function(e,t,n){let a=e.getHours();return a===0&&(a=24),t==="ko"?n.ordinalNumber(a,{unit:"hour"}):D(a,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):Z.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):Z.s(e,t)},S:function(e,t){return Z.S(e,t)},X:function(e,t,n){const a=e.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return Ze(a);case"XXXX":case"XX":return K(a);case"XXXXX":case"XXX":default:return K(a,":")}},x:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"x":return Ze(a);case"xxxx":case"xx":return K(a);case"xxxxx":case"xxx":default:return K(a,":")}},O:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Qe(a,":");case"OOOO":default:return"GMT"+K(a,":")}},z:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Qe(a,":");case"zzzz":default:return"GMT"+K(a,":")}},t:function(e,t,n){const a=Math.trunc(+e/1e3);return D(a,t.length)},T:function(e,t,n){return D(+e,t.length)}};function Qe(e,t=""){const n=e>0?"-":"+",a=Math.abs(e),s=Math.trunc(a/60),i=a%60;return i===0?n+String(s):n+String(s)+t+D(i,2)}function Ze(e,t){return e%60===0?(e>0?"-":"+")+D(Math.abs(e)/60,2):K(e,t)}function K(e,t=""){const n=e>0?"-":"+",a=Math.abs(e),s=D(Math.trunc(a/60),2),i=D(a%60,2);return n+s+t+i}const ze=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Ue=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},pn={p:Ue,P:(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],a=n[1],s=n[2];if(!s)return ze(e,t);let i;switch(a){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",ze(a,t)).replace("{{time}}",Ue(s,t))}},fn=/^D+$/,gn=/^Y+$/,xn=["D","DD","YY","YYYY"];function yn(e){return fn.test(e)}function bn(e){return gn.test(e)}function vn(e,t,n){const a=Dn(e,t,n);if(console.warn(a),xn.includes(e))throw new RangeError(a)}function Dn(e,t,n){const a=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${a} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function wn(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}const aa=null;function Sn(e){return!(!wn(e)&&typeof e!="number"||isNaN(+(0,L.a)(e)))}const ra=null,jn=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,On=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Tn=/^'([^]*?)'?$/,Cn=/''/g,Fn=/[a-zA-Z]/;function Rn(e,t,n){const a=(0,pe.q)(),s=n?.locale??a.locale??sn.c,i=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,d=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,h=(0,L.a)(e,n?.in);if(!Sn(h))throw new RangeError("Invalid time value");let u=t.match(On).map(f=>{const g=f[0];if(g==="p"||g==="P"){const m=pn[g];return m(f,s.formatLong)}return f}).join("").match(jn).map(f=>{if(f==="''")return{isToken:!1,value:"'"};const g=f[0];if(g==="'")return{isToken:!1,value:En(f)};if(He[g])return{isToken:!0,value:f};if(g.match(Fn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:f}});s.localize.preprocessor&&(u=s.localize.preprocessor(h,u));const p={firstWeekContainsDate:i,weekStartsOn:d,locale:s};return u.map(f=>{if(!f.isToken)return f.value;const g=f.value;(!n?.useAdditionalWeekYearTokens&&bn(g)||!n?.useAdditionalDayOfYearTokens&&yn(g))&&vn(g,t,String(e));const m=He[g[0]];return m(h,g,s.localize,p)}).join("")}function En(e){const t=e.match(Tn);return t?t[1].replace(Cn,"'"):e}const sa=null;var Je=o(19196);const Mn=()=>{const{watch:e}=(0,x.xW)(),{frequency:t,lastDayOfMonthOnly:n,startDate:a,endDate:s,intervalFrequency:i,sendTime:d}=e("schedule"),h=a&&(0,Je.lB)(new Date(a).getDate()),u=d===b.OZ.Now&&(0,Je.lB)((0,z.KQ)().toDate().getDate()),p=[b.Bw.Hourly,b.Bw.Daily].includes(t)||t===b.Bw.Custom&&i===b.o9.Hours,f=s&&(t===b.Bw.Hourly||t===b.Bw.Custom&&i===b.o9.Hours),g=t===b.Bw.Monthly&&!n&&(h||u);return{showWorkdaysOnlyCheckbox:p,showEndTimeInput:f,showLastDayOfMonthWarning:g}};function Pn(){const{watch:e,setValue:t,register:n}=(0,x.xW)(),{frequency:a,sendTime:s,startDate:i}=e("schedule"),{showWorkdaysOnlyCheckbox:d,showEndTimeInput:h,showLastDayOfMonthWarning:u}=Mn(),p=()=>{const g=(0,z.KQ)(i).endOf("month").toDate();t("schedule.startDate",g)},f=n("schedule.lastDayOfMonthOnly");return(0,r.jsxs)(r.Fragment,{children:[u&&(0,r.jsx)(Ae.F,{severity:"warning",title:"",children:(0,l.t)("share-report.schedule.monthly-schedule-alert-title",`Note: Reports won't be sent on months that don't have a {{ dayNumber }} day. Choose an earlier date or select "Send on the last day of the month" to send a report at the end of every month.`,{dayNumber:Rn(s==="now"?(0,z.KQ)().toDate():i,"do")})}),a!==b.Bw.Once&&(0,r.jsxs)(we.x,{columnGap:2,columns:{xs:1,md:3},children:[(0,r.jsx)(Dt,{}),h&&(0,r.jsx)(wt,{})]}),d&&(0,r.jsx)(yt,{}),s===b.OZ.Later&&a===b.Bw.Monthly&&(0,r.jsx)(W.S,{...f,label:(0,l.t)("share-report.schedule.last-day-of-month","Send on the last day of month"),onChange:g=>{p(),f.onChange(g)}})]})}function In(){const{watch:e}=(0,x.xW)(),t=(0,N.of)(Wn),{frequency:n,startTime:a,endTime:s,sendTime:i,lastDayOfMonthOnly:d,timeZone:h,startDate:u,endDate:p,intervalFrequency:f,intervalAmount:g,workdaysOnly:m}=e("schedule"),y={frequency:n,time:{hour:a?.hour?.()??0,minute:a?.minute?.()??0},endTime:{hour:s?.hour?.()??0,minute:s?.minute?.()??0},sendTime:i,dayOfMonth:d?b.F0:void 0,timeZone:h,startDate:u,endDate:p,intervalFrequency:f,intervalAmount:g?.toString(),workdaysOnly:m};return(0,r.jsx)("div",{className:t.preview,"data-testid":"schedule-preview",children:(0,r.jsxs)(S.B,{alignItems:"center",children:[(0,r.jsx)(ee.I,{name:"calendar-alt"}),(0,rn.OG)(y)]})})}function kn({open:e,onToggle:t}){const{watch:n}=(0,x.xW)(),{frequency:a,sendTime:s}=n("schedule");return(0,r.jsxs)(de,{isOpen:e,label:(0,l.t)("share-report.schedule.section-title","Schedule"),onToggle:t,dataTestId:w.Tp.components.ReportFormDrawer.Schedule.header,contentDataTestId:w.Tp.components.ReportFormDrawer.Schedule.content,children:[(0,r.jsxs)(we.x,{columnGap:2,columns:{xs:1,md:3},children:[(0,r.jsx)(Ct,{}),(0,r.jsx)(jt,{}),a===b.Bw.Custom?(0,r.jsx)(Ft,{}):(0,r.jsx)("div",{}),s===b.OZ.Later&&(0,r.jsx)(Pt,{})]}),(0,r.jsx)(Pn,{}),(0,r.jsx)(In,{})]})}const Wn=e=>({preview:(0,C.css)({marginTop:e.spacing(2),color:e.colors.text.secondary})});function Bn({dashboards:e=[],onAddDashboard:t,open:n,onToggle:a}){return(0,r.jsxs)(de,{label:(0,l.t)("share-report.dashboard.section-title","Dashboards"),isOpen:n,onToggle:a,dataTestId:w.Tp.components.ReportFormDrawer.SelectDashboards.header,contentDataTestId:w.Tp.components.ReportFormDrawer.SelectDashboards.content,children:[(0,r.jsx)(S.B,{direction:"column",gap:2,children:e.map((s,i)=>(0,r.jsxs)(S.B,{direction:"column",children:[(0,r.jsx)(s.Component,{model:s}),i<e.length-1&&(0,r.jsx)(q.c,{spacing:0})]},s.state.key))}),(0,r.jsx)(q.c,{}),(0,r.jsxs)(A.$n,{variant:"primary",fill:"text",onClick:t,children:["+ ",(0,l.t)("share-report.dashboard.add-dashboard","Add dashboard")]})]})}var R=o(16904);const ge=[{id:R.P.SelectDashboards,inputs:["dashboards"],component:Bn},{id:R.P.Schedule,inputs:["schedule"],component:kn},{id:R.P.EmailConfiguration,inputs:["subject","message","replyTo","addDashboardUrl","addDashboardImage"],component:en},{id:R.P.Recipients,inputs:["recipients"],component:an},{id:R.P.Attachments,inputs:["attachments"],component:Kt}],Yn=e=>{const[t,n]=(0,Y.useState)({[R.P.SelectDashboards]:e?.[R.P.SelectDashboards]??!0,[R.P.Schedule]:e?.[R.P.Schedule]??!0,[R.P.EmailConfiguration]:e?.[R.P.EmailConfiguration]??!0,[R.P.Recipients]:e?.[R.P.Recipients]??!0,[R.P.Attachments]:e?.[R.P.Attachments]??!0});return{openSections:t,updateOpenSectionsByErrors:s=>{const i=Object.keys(s),d=ge.filter(h=>h.inputs.some(u=>i.includes(u))).map(h=>h.id);n(h=>{const u={...h};return ge.forEach(p=>{!u[p.id]&&(u[p.id]=d.includes(p.id))}),u})},setOpenSections:n}},Ke={message:U.FE,addDashboardUrl:!0,addDashboardImage:!1,schedule:{sendTime:b.OZ.Later,frequency:b.Bw.Daily,startDate:new Date,endTime:(0,z.KQ)().add(2,"hour").startOf("hour"),startTime:(0,z.KQ)().add(1,"hour").startOf("hour"),timeZone:(0,at.Md)()},attachments:{pdf:!0,csv:!1,pdfTables:!1},pdfOptions:{orientation:"landscape",layout:"grid",scaleFactor:U.Pf}};function An({report:e,setIsDirty:t,onSuccess:n,defaultOpenSections:a,headerActions:s}){const i=(0,N.of)(Nn),d=(0,ye.b0)(),{openSections:h,setOpenSections:u,updateOpenSectionsByErrors:p}=Yn(a),[f,g]=(0,Y.useState)(!1),[m,{isLoading:y}]=(0,_.h_)(),[j,{isLoading:v}]=(0,_.yi)(),[M,{isLoading:E}]=(0,_.Z9)(),[O,{isLoading:X}]=(0,_.zh)(),[$,{isLoading:G}]=(0,_.iJ)(),ae=y||v||E,c=(0,x.mN)({mode:"onSubmit",defaultValues:{...Ke,...e,schedule:{...Ke.schedule,...e?.schedule,intervalFrequency:Ee.find(P=>P.value===e?.schedule?.intervalFrequency)?.value||b.o9.Hours}},shouldUnregister:!0,shouldFocusError:!0}),{remove:I,append:F}=(0,x.jz)({control:c.control,name:"dashboards"}),{sceneDashboards:B,onAddDashboardClick:Se,isLoadingDashboards:xe}=Zt({report:e,setValue:c.setValue,appendDashboard:F,removeDashboard:I});(0,Y.useEffect)(()=>{xe||c.setFocus("title")},[c,c.setFocus,xe]),(0,Y.useEffect)(()=>{t(c.formState.isDirty)},[c.formState.isDirty,t]);const Vn=async P=>{const H=(0,ue.Js)({...P,state:b.QF.Scheduled,dashboardsScene:B,id:e?.id});k.M.saveClicked(d.renderingContext,H),await(e?.id?j:m)(H).unwrap(),n()},Ln=async()=>{const P=c.getValues(),H=(0,ue.Js)({...P,state:b.QF.Draft,dashboardsScene:B,id:e?.id});k.M.saveDraftClicked(d.renderingContext,H),await(e?.id?j:O)(H).unwrap(),n()},$n=async()=>{const P=c.getValues(),H=e?.state&&(0,rt.U)(e.state);e?.state===b.QF.Scheduled?k.M.pauseClicked(d.renderingContext):k.M.resumeClicked(d.renderingContext);const re=(0,ue.Js)({...P,state:H,dashboardsScene:B,id:e?.id});await M(re).unwrap()},Gn=()=>{k.M.deleteClicked(d.renderingContext),g(!0)},Hn=async()=>{e?.id&&(await $(e?.id).unwrap(),g(!1),n())};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(et.F,{confirmRedirect:c.formState.isDirty,onDiscard:()=>{k.M.discardClicked(d.renderingContext)}}),(0,r.jsx)("div",{className:(0,C.cx)({[i.hidden]:!f}),children:(0,r.jsx)(tt.Z,{title:(0,l.t)("share-report.confirm-delete.title","Delete report"),confirmButtonLabel:(0,l.t)("share-report.confirm-delete.button","Delete report"),onConfirm:Hn,onDismiss:()=>g(!1),description:(0,l.t)("share-report.confirm-delete.description","Are you sure you want to delete this report?"),isActionLoading:G})}),(0,r.jsxs)("div",{className:(0,C.cx)(i.formContainer,{[i.hidden]:f}),children:[(0,r.jsxs)(S.B,{justifyContent:"space-between",children:[s,(0,r.jsxs)(S.B,{justifyContent:"space-between",flex:1,children:[xe&&(0,r.jsx)(qe._,{"data-testid":"form-loading-placeholder",text:(0,l.t)("share-report.loading-form","Loading form...")}),(0,r.jsxs)("div",{className:i.stateContainer,children:[(0,r.jsx)(_e.E,{children:(0,l.t)("share-report.state","State:")}),(0,r.jsx)(nt.Z,{reportState:e?.state})]})]})]}),(0,r.jsx)(x.Op,{...c,children:(0,r.jsx)("form",{onSubmit:c.handleSubmit(Vn,p),className:i.form,"data-testid":w.Tp.components.ReportFormDrawer.container,children:(0,r.jsxs)("fieldset",{disabled:!Oe.V||ae||X||xe||!(0,Xe.a)("reports.creation"),className:i.container,children:[(0,r.jsx)(T.D,{label:(0,l.t)("share-report.report-name.label","Report name"),required:!0,error:c.formState.errors.title?.message,invalid:!!c.formState.errors.title,children:(0,r.jsx)(se.p,{id:"title",...c.register("title",(0,J.As)().title),placeholder:e?.title,type:"text",autoComplete:"off"})}),(0,r.jsx)(q.c,{spacing:0}),(0,r.jsx)("div",{className:i.reportSectionContainer,children:(0,r.jsx)(S.B,{direction:"column",flex:1,children:ge.map((P,H)=>(0,r.jsxs)("div",{children:[(0,r.jsx)(P.component,{dashboards:B,onAddDashboard:Se,open:h[P.id],onToggle:()=>u(re=>({...re,[P.id]:!re[P.id]}))}),H<ge.length-1&&(0,r.jsx)(q.c,{})]},P.id))})}),(0,r.jsxs)("div",{className:i.actionsContainer,children:[(0,r.jsx)(q.c,{}),(0,r.jsx)(gt,{isEditMode:!!e?.id,isUpsertLoading:ae,isUpdateStateReportLoading:E,isSaveDraftLoading:X,onSaveDraftClick:Ln,onDeleteClick:Gn,onToggleStateClick:$n,sceneDashboards:B,reportState:e?.state})]})]})})})]})]})}const Nn=e=>({form:(0,C.css)({height:"100%"}),container:(0,C.css)({display:"flex",flexDirection:"column",height:"100%"}),reportSectionContainer:(0,C.css)({height:"100%",marginTop:e.spacing(2)}),actionsContainer:(0,C.css)({position:"sticky",bottom:0,left:0,right:0,width:"100%",background:e.colors.background.primary,zIndex:e.zIndex.tooltip,marginBottom:e.spacing(-2),paddingBottom:e.spacing(2)}),hidden:(0,C.css)({display:"none"}),formContainer:(0,C.css)({display:"flex",flexDirection:"column",gap:e.spacing(2),flex:1}),stateContainer:(0,C.css)({display:"flex",gap:e.spacing(1),marginLeft:"auto"})})}}]);

//# sourceMappingURL=1661.2ab4a1b7def9ac46f886.js.map