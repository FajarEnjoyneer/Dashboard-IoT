"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2516],{25984:(tt,we,n)=>{n.d(we,{Y:()=>V,z:()=>L});var e=n(74848),l=n(22803),P=n(33149),r=n(96540),J=n(92745),Y=n(27489),m=n(18027),Le=n(18857),I=n(46072),H=n(63142),_=n(37386),h=n(63527);function de(d){return{searchWrap:(0,l.css)({padding:`${d.spacing(.4)} 0 ${d.spacing(.4)} ${d.spacing(.4)}`})}}function E(d){const p=(0,H.$j)(),c=de(p);return(0,e.jsx)(_.D,{className:c.searchWrap,children:(0,e.jsx)(h.p,{value:d.value,type:"text",placeholder:(0,J.t)("explore.logs-column-search.placeholder-search-fields-by-name","Search fields by name"),onChange:d.onChange})})}var Z=n(67155),q=n(89332);function U(d){return{empty:(0,l.css)({marginBottom:d.spacing(2),marginLeft:d.spacing(1.75),fontSize:d.typography.fontSize})}}function ne(){const d=(0,H.$j)(),p=U(d);return(0,e.jsx)("div",{className:p.empty,children:(0,e.jsx)(J.x6,{i18nKey:"explore.logs-table-empty-fields.no-fields",children:"No fields"})})}var he=n(32635),b=n(30703);function C(d){return{dragIcon:(0,l.css)({cursor:"drag",marginLeft:d.spacing(1),opacity:.4}),labelCount:(0,l.css)({marginLeft:d.spacing(.5),marginRight:d.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:d.typography.pxToRem(11),opacity:.6}),contentWrap:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),checkboxLabel:(0,l.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}function W(d){const p=(0,H.$j)(),c=C(p);if(d.labels[d.label])return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:c.contentWrap,children:[(0,e.jsx)(he.S,{className:c.checkboxLabel,label:d.label,onChange:d.onChange,checked:d.labels[d.label]?.active??!1}),d.showCount&&(0,e.jsxs)("button",{className:c.labelCount,onClick:d.onChange,children:[d.labels[d.label]?.percentOfLinesWithLabel,"%"]})]}),d.draggable&&(0,e.jsx)(b.I,{"aria-label":(0,J.t)("explore.logs-table-nav-field.aria-label-drag-and-drop-icon","Drag and drop icon"),title:(0,J.t)("explore.logs-table-nav-field.title-drag-and-drop-to-reorder","Drag and drop to reorder"),name:"draggabledots",size:"lg",className:c.dragIcon})]})}function Q(d){return{wrap:(0,l.css)({marginTop:d.spacing(1),marginBottom:d.spacing(1),display:"flex",background:d.colors.background.primary}),dragging:(0,l.css)({background:d.colors.background.secondary}),columnWrapper:(0,l.css)({marginBottom:d.spacing(1.5),paddingLeft:d.spacing(.5)})}}function z(d){return(p,c)=>{const T=d[p],k=d[c];return T.index!=null&&k.index!=null?T.index-k.index:0}}const N=d=>{const{reorderColumn:p,labels:c,valueFilter:T,toggleColumn:k}=d,te=(0,H.$j)(),fe=Q(te),le=Object.keys(c).filter(w=>T(w)),x=w=>{w.destination&&p(w.source.index,w.destination.index)},R=w=>{const K=c[w];if(K)return`${w} appears in ${K?.percentOfLinesWithLabel}% of log lines`};return le.length?(0,e.jsx)(q.JY,{onDragEnd:x,children:(0,e.jsx)(q.gL,{droppableId:"order-fields",direction:"vertical",children:w=>(0,e.jsxs)("div",{className:fe.columnWrapper,...w.droppableProps,ref:w.innerRef,children:[le.sort(z(c)).map((K,ce)=>(0,e.jsx)(q.sx,{draggableId:K,index:ce,children:(y,oe)=>(0,e.jsx)("div",{className:(0,l.cx)(fe.wrap,oe.isDragging?fe.dragging:void 0),ref:y.innerRef,...y.draggableProps,...y.dragHandleProps,title:R(K),children:(0,e.jsx)(W,{label:K,onChange:()=>k(K),labels:c,draggable:!0})})},K)),w.placeholder]})})}):(0,e.jsx)(ne,{})},g=new Intl.Collator(void 0,{sensitivity:"base"});function B(d){return(p,c)=>{const T=d[p],k=d[c];return T!=null&&k!=null?+(k.type==="TIME_FIELD")-+(T.type==="TIME_FIELD")||+(k.type==="BODY_FIELD")-+(T.type==="BODY_FIELD")||g.compare(p,c):0}}const G=d=>{const{labels:p,valueFilter:c,toggleColumn:T}=d,k=(0,H.$j)(),te=Q(k),fe=Object.keys(p).filter(le=>c(le));return fe.length?(0,e.jsx)("div",{className:te.columnWrapper,children:fe.sort(B(p)).map((le,x)=>(0,e.jsx)("div",{className:te.wrap,title:(0,J.t)("explore.logs-table-available-fields.title-label-percentage","{{labelName}} appears in {{percentage}}% of log lines",{labelName:le,percentage:p[le]?.percentOfLinesWithLabel}),children:(0,e.jsx)(W,{showCount:!0,label:le,onChange:()=>T(le),labels:p})},le))}):(0,e.jsx)(ne,{})};function ae(d){return{sidebarWrap:(0,l.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,l.css)({appearance:"none",background:"none",border:"none",fontSize:d.typography.pxToRem(11)}),columnHeader:(0,l.css)({display:"flex",justifyContent:"space-between",fontSize:d.typography.h6.fontSize,background:d.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:d.spacing(.75),paddingRight:d.spacing(.75),paddingBottom:d.spacing(.75),paddingLeft:d.spacing(1.5),zIndex:3,marginBottom:d.spacing(2)})}}const v=d=>{const p=(0,H.$j)(),c=ae(p);return(0,e.jsx)("div",{className:c.sidebarWrap,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:c.columnHeader,children:[(0,e.jsx)(J.x6,{i18nKey:"explore.logs-table-multi-select.selected-fields",children:"Selected fields"}),(0,e.jsx)("button",{onClick:d.clear,className:c.columnHeaderButton,children:(0,e.jsx)(J.x6,{i18nKey:"explore.logs-table-multi-select.reset",children:"Reset"})})]}),(0,e.jsx)(N,{reorderColumn:d.reorderColumn,toggleColumn:d.toggleColumn,labels:d.filteredColumnsWithMeta??d.columnsWithMeta,valueFilter:T=>d.columnsWithMeta[T]?.active??!1,id:"selected-fields"}),(0,e.jsx)("div",{className:c.columnHeader,children:(0,e.jsx)(J.x6,{i18nKey:"explore.logs-table-multi-select.fields",children:"Fields"})}),(0,e.jsx)(G,{toggleColumn:d.toggleColumn,labels:d.filteredColumnsWithMeta??d.columnsWithMeta,valueFilter:T=>!d.columnsWithMeta[T]?.active})]})})};var F=n(84139),D=n(2543);const j=new F.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function f(d,p,c){const[T,k,te]=j.search(d,p,0,1e5);let fe=[],le=new Set;if(T&&te){const x=(R,w)=>{w&&le.add(R)};for(let R=0;R<te.length;R++){let w=te[R];F.A.highlight(d[k.idx[w]],k.ranges[w],x),fe.push(d[k.idx[w]])}c([fe,[...le]])}else p||c([[],[]])}const X=(0,D.debounce)(f,300);function V(d){const{logsFrames:p,updatePanelState:c,panelState:T}=d,k=T?.columns,[te,fe]=(0,r.useState)(void 0),[le,x]=(0,r.useState)(void 0),[R,w]=(0,r.useState)(""),K=L(),ce=d?.panelState?.refId,[y,oe]=(0,r.useState)(p.find(Ee=>Ee.refId===ce)??p[0]),pe=(0,r.useCallback)(Ee=>{const Qe=d.panelState?.columns;return Qe&&Object.values(Qe).forEach((We,Ce)=>{Ee[We]&&(Ee[We].active=!0,Ee[We].index=Ce)}),Ee},[d.panelState?.columns]),me=(0,I.Os)(y);(0,r.useEffect)(()=>{if(me?.timeField.name&&me?.bodyField.name&&!k){const Ee={0:me?.timeField.name??"",1:me?.bodyField.name??""};c({columns:Object.values(Ee),visualisationType:"table",labelFieldName:me?.getLabelFieldName()??void 0})}},[me,k,c]),(0,r.useEffect)(()=>{const Ee=p.find(Qe=>Qe.refId===ce)??p[0];Ee&&oe(Ee)},[p,ce]),(0,r.useEffect)(()=>{if(!te||!le)return;let Ee={...le},Qe=!1;Object.keys(te).forEach(We=>{Ee[We]&&Ee[We].active!==te[We].active&&(Ee[We]=te[We],Qe=!0)}),Qe&&x(Ee)},[te,le]),(0,r.useEffect)(()=>{if(!y.length)return;const Ee=y?y.length:0,Qe=(0,I.Os)(y),We=Qe?.getLogFrameLabelsAsLabels(),Ce=[];Qe&&Ce.push(...Qe.extraFields.filter(Ie=>!Ie?.config?.custom?.hidden)),Qe?.severityField&&Ce.push(Qe?.severityField),Qe?.bodyField&&Ce.push(Qe?.bodyField),Qe?.timeField&&Ce.push(Qe?.timeField);const Re=new Map;let $e={};We?.length&&Ee&&(We.forEach(Ie=>{Object.keys(Ie).forEach(O=>{if(Re.has(O)){const ge=Re.get(O);ge&&(ge?.active?Re.set(O,{percentOfLinesWithLabel:ge.percentOfLinesWithLabel+1,active:!0,index:ge.index}):Re.set(O,{percentOfLinesWithLabel:ge.percentOfLinesWithLabel+1,active:!1,index:void 0}))}else Re.set(O,{percentOfLinesWithLabel:1,active:!1,index:void 0})})}),$e=Object.fromEntries(Re),Object.keys($e).forEach(Ie=>{$e[Ie].percentOfLinesWithLabel=ie($e[Ie].percentOfLinesWithLabel,Ee)})),Ce.forEach(Ie=>{const $=$e[Ie.name]?.active,O=$e[Ie.name]?.index;$&&O!==void 0?$e[Ie.name]={percentOfLinesWithLabel:ie(Ie.values.filter(ge=>ge!=null).length,Ee),active:!0,index:O}:$e[Ie.name]={percentOfLinesWithLabel:ie(Ie.values.filter(ge=>ge!=null).length,Ee),active:!1,index:void 0}}),$e=pe($e),Object.keys($e).filter(Ie=>$e[Ie].active).length===0&&(Qe?.bodyField?.name&&($e[Qe.bodyField.name].active=!0),Qe?.timeField?.name&&($e[Qe.timeField.name].active=!0)),Qe?.bodyField?.name&&Qe?.timeField?.name&&($e[Qe.bodyField.name].type="BODY_FIELD",$e[Qe.timeField.name].type="TIME_FIELD"),fe($e)},[y,pe]);const[Te,Oe]=(0,r.useState)(220),xe=d.width-Te;if(!te)return null;function be(Ee){if(te){const Qe=!te[Ee]?.active,We=Object.keys(te).filter(Re=>te[Re]?.active)?.length,Ce={columnAction:Qe?"add":"remove",columnCount:Qe?We+1:We-1,datasourceType:d.datasourceType};(0,Y.rR)("grafana_explore_logs_table_column_filter_clicked",Ce)}}function ye(Ee){(0,Y.rR)("grafana_explore_logs_table_text_search_result_count",{resultCount:Ee,datasourceType:d.datasourceType??"unknown"})}const Be=()=>{const Ee={...te};let Qe=0;Object.keys(Ee).forEach(We=>{const Ce=!!Ee[We].type;Ee[We].active=Ce,Ee[We].index=Ce?Qe++:void 0}),fe(Ee)},Ae=(Ee,Qe)=>{if(Ee===Qe)return;const We={...te},Ce=Object.keys(We).filter($e=>We[$e].active).map($e=>({fieldName:$e,index:We[$e].index??0})).sort(($e,Ve)=>$e.index-Ve.index),[Re]=Ce.splice(Ee,1);Ce.splice(Qe,0,Re),Ce.forEach(($e,Ve)=>{We[$e.fieldName].index=Ve}),fe(We),ze(We)};function ze(Ee){const Qe=Object.keys(Ee).filter($e=>Ee[$e]?.active).sort(($e,Ve)=>{const Ie=Ee[$e],$=Ee[Ve];return Ie.index!==void 0&&$.index!==void 0?Ie.index-$.index:0}),We=Object.assign({},Qe),Ce={0:me?.timeField.name??"",1:me?.bodyField.name??""},Re={...d.panelState,columns:Object.keys(We).length?We:Ce,refId:y.refId,visualisationType:"table",labelFieldName:me?.getLabelFieldName()??void 0};c(Re)}const Ye=Ee=>{if(!te||!(Ee in te)){console.warn("failed to get column",te);return}const Qe=Object.keys(te).filter(Re=>te[Re].active).length,We=te[Ee].active?void 0:!0;let Ce;if(We?Ce={...te,[Ee]:{...te[Ee],active:We,index:Qe}}:Ce={...te,[Ee]:{...te[Ee],active:!1,index:void 0}},be(Ee),fe(Ce),le){const Re=!le[Ee]?.active;let $e;Re?$e={...le,[Ee]:{...le[Ee],active:Re,index:Qe}}:$e={...le,[Ee]:{...le[Ee],active:!1,index:void 0}},x($e)}ze(Ce)},st=Ee=>{const Qe=Ee[0];let We={},Ce=0;Qe.forEach(Re=>{Re in te&&(We[Re]=te[Re],Ce++)}),x(We),ye(Ce)},He=Ee=>{f(Object.keys(te),Ee,st)},Xe=Ee=>{const Qe=Ee.currentTarget?.value;w(Qe),Qe?He(Qe):x(void 0)},nt=Ee=>{p.find(We=>We.refId===Ee.value)&&oe(p.find(We=>We.refId===Ee.value)??p[0]),d.updatePanelState({refId:Ee.value,labelFieldName:me?.getLabelFieldName()??void 0})},at=je(d.theme,K,Te),vt=(Ee,Qe,We)=>{const Ce=Number(We.style.width.slice(0,-2));isNaN(Ce)||Oe(Ce)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:p.length>1&&(0,e.jsx)("div",{children:(0,e.jsx)(m.I,{label:(0,J.t)("explore.logs-table-wrap.label-select-query","Select query"),htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:(0,J.t)("explore.logs-table-wrap.tooltip-select-query-visualize-table","Select a query to visualize in the table"),children:(0,e.jsx)(Le.l6,{inputId:"explore_logs_table_frame_selector","aria-label":(0,J.t)("explore.logs-table-wrap.aria-label-select-query-by-name","Select query by name"),value:y.refId,options:p.map(Ee=>({label:Ee.refId,value:Ee.refId})),onChange:nt})})})}),(0,e.jsxs)("div",{className:at.wrapper,children:[(0,e.jsx)(P.c,{enable:{right:!0},handleClasses:{right:at.rzHandle},onResize:vt,children:(0,e.jsxs)("section",{className:at.sidebar,children:[(0,e.jsx)(E,{value:R,onChange:Xe}),(0,e.jsx)(v,{reorderColumn:Ae,toggleColumn:Ye,filteredColumnsWithMeta:le,columnsWithMeta:te,clear:Be})]})}),(0,e.jsx)(Z.O,{logsFrame:me,onClickFilterLabel:d.onClickFilterLabel,onClickFilterOutLabel:d.onClickFilterOutLabel,logsSortOrder:d.logsSortOrder,range:d.range,splitOpen:d.splitOpen,timeZone:d.timeZone,width:xe,dataFrame:y,columnsWithMeta:te,height:K})]})]})}const ie=(d,p)=>Math.ceil(100*d/p);function je(d,p,c){return{wrapper:(0,l.css)({display:"flex"}),sidebar:(0,l.css)({height:p,fontSize:d.typography.pxToRem(11),overflowY:"hidden",width:c,paddingRight:d.spacing(3)}),rzHandle:(0,l.css)({background:d.colors.secondary.main,[d.transitions.handleMotion("no-preference","reduce")]:{transition:"0.3s background ease-in-out"},position:"relative",height:"50% !important",width:`${d.spacing(1)} !important`,top:"25% !important",right:`${d.spacing(1)} !important`,cursor:"grab",borderRadius:d.shape.radius.pill,"&:hover":{background:d.colors.secondary.shade}})}}const L=()=>Math.max(window.innerHeight-500,500)},78242:(tt,we,n)=>{n.d(we,{N:()=>I});var e=n(74848),l=n(22803),P=n(96540),r=n(92745),J=n(27489),Y=n(63142),m=n(87063),Le=n(74746);const I=({x:h,y:de,onClickFilterString:E,onClickFilterOutString:Z,selection:q,row:U,close:ne,...he})=>{const b=(0,P.useRef)(null),C=(0,Y.of)(_);(0,P.useEffect)(()=>{function z(N){N.key==="Escape"&&ne()}return document.addEventListener("keyup",z),()=>{document.removeEventListener("keyup",z)}},[ne]);const W=(0,P.useCallback)(()=>{H("popover_menu_disabled",q.length,U.datasourceType),he.onDisable()},[he,U.datasourceType,q.length]);return E||Z?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:C.menu,style:{top:de,left:h},children:(0,e.jsxs)(m.W,{ref:b,children:[(0,e.jsx)(m.W.Item,{label:(0,r.t)("logs.popover-menu.copy","Copy selection"),onClick:()=>{(0,Le.Dk)(q,b),ne(),H("copy",q.length,U.datasourceType)}}),E&&(0,e.jsx)(m.W.Item,{label:(0,r.t)("logs.popover-menu.line-contains","Add as line contains filter"),onClick:()=>{E(q,U.dataFrame.refId),ne(),H("line_contains",q.length,U.datasourceType)}}),Z&&(0,e.jsx)(m.W.Item,{label:(0,r.t)("logs.popover-menu.line-contains-not","Add as line does not contain filter"),onClick:()=>{Z(q,U.dataFrame.refId),ne(),H("line_does_not_contain",q.length,U.datasourceType)}}),(0,e.jsx)(m.W.Divider,{}),(0,e.jsx)(m.W.Item,{label:(0,r.t)("logs.popover-menu.disable-menu","Disable menu"),onClick:W})]})})}):null};function H(h,de,E){(0,J.rR)("grafana_explore_logs_popover_menu",{action:h,selectionLength:de,datasourceType:E||"unknown"})}const _=h=>({menu:(0,l.css)({position:"fixed",zIndex:h.zIndex.modal})})},70159:(tt,we,n)=>{n.d(we,{$Z:()=>e,OY:()=>l,r3:()=>P});const e={showLabels:"grafana.explore.logs.showLabels",showTime:"grafana.explore.logs.showTime",wrapLogMessage:"grafana.explore.logs.wrapLogMessage",prettifyLogMessage:"grafana.explore.logs.prettifyLogMessage",logsSortOrder:"grafana.explore.logs.sortOrder",logContextWrapLogMessage:"grafana.explore.logs.logContext.wrapLogMessage",commonLabels:"grafana.explore.logs.commonLabels"},l="grafana.explore.logs",P="grafana.explore.logs.visualisationType"},44376:(tt,we,n)=>{n.d(we,{U:()=>U});var e=n(74848),l=n(22803),P=n(96540),r=n(1906),J=n(739),Y=n(19379),m=n(43173),Le=n(63142),I=n(25984),H=n(29457),_=n(92252);const h=({loading:C,loadMoreLogs:W,deduplicatedRows:Q=[],range:z,splitOpen:N,onClickFilterLabel:g,onClickFilterOutLabel:B,panelState:G,datasourceType:ae,updatePanelState:v,width:F,logsTableFrames:D,visualisationType:j,...f})=>{const{sortOrder:X}=(0,H.fl)(),V=(0,P.useMemo)(()=>new Y.o,[]),ie=(0,Le.$j)(),je=de(ie);if(!N||!F||!v){console.error("<ControlledLogsTable>: Missing required props.");return}return(0,e.jsxs)("div",{className:je.logRowsContainer,children:[(0,e.jsx)(_.V,{eventBus:V,visualisationType:j}),(0,e.jsx)("div",{className:je.logRows,"data-testid":"logRowsTable",children:(0,e.jsx)(I.Y,{logsSortOrder:X,range:z,splitOpen:N,timeZone:f.timeZone,width:F-45,logsFrames:D??[],onClickFilterLabel:g,onClickFilterOutLabel:B,panelState:G,theme:ie,updatePanelState:v,datasourceType:ae})})]})},de=C=>({logRows:(0,l.css)({overflowY:"visible",width:"100%"}),logRowsContainer:(0,l.css)({display:"flex",flexDirection:"row-reverse"})});var E=n(17896),Z=n(48575),q=n(55439);const U=(0,P.forwardRef)(({deduplicatedRows:C,dedupStrategy:W,filterLevels:Q,hasUnescapedContent:z,showLabels:N,showTime:g,logsMeta:B,logOptionsStorageKey:G,logsSortOrder:ae,prettifyLogMessage:v,onLogOptionsChange:F,wrapLogMessage:D,...j},f)=>(0,e.jsxs)(H.vv,{app:j.app||r.Jk.Unknown,displayedFields:[],dedupStrategy:W,enableLogDetails:!1,filterLevels:Q,fontSize:"default",hasUnescapedContent:z,logOptionsStorageKey:G,logs:C??[],logsMeta:B,prettifyJSON:v,showControls:!0,showTime:g,showUniqueLabels:N,sortOrder:ae||J.uH.Descending,onLogOptionsChange:F,wrapLogMessage:D,children:[j.visualisationType==="logs"&&(0,e.jsx)(ne,{ref:f,...j,deduplicatedRows:C}),j.visualisationType==="table"&&j.updatePanelState&&(0,e.jsx)(h,{...j})]}));U.displayName="ControlledLogRows";const ne=(0,P.forwardRef)(({loading:C,loadMoreLogs:W,deduplicatedRows:Q=[],range:z,scrollIntoView:N,...g},B)=>{const{app:G,dedupStrategy:ae,filterLevels:v,forceEscape:F,prettifyJSON:D,sortOrder:j,showTime:f,showUniqueLabels:X,wrapLogMessage:V}=(0,H.fl)(),ie=(0,P.useMemo)(()=>new Y.o,[]),je=(0,P.useRef)(null);(0,P.useEffect)(()=>{const c=ie.subscribe(q._B,T=>he(T,je.current));return()=>c.unsubscribe()},[ie]),(0,P.useImperativeHandle)(B,()=>je.current);const L=(0,P.useMemo)(()=>v.length===0?Q:Q.filter(c=>v.includes(c.logLevel)),[v,Q]),d=(0,P.useMemo)(()=>B?b.forwardedScrollableLogRows:m.$.featureToggles.logsInfiniteScrolling?b.scrollableLogRows:b.logRows,[B]),p=(0,P.useCallback)(c=>{if(N){N(c);return}je.current&&je.current.scroll({behavior:"smooth",top:je.current.scrollTop+c.getBoundingClientRect().top-window.innerHeight/2})},[N]);return(0,e.jsxs)("div",{className:b.logRowsContainer,children:[(0,e.jsx)(_.V,{eventBus:ie}),(0,e.jsx)("div",{ref:je,className:d,children:(0,e.jsx)(E.u8,{loading:C,loadMoreLogs:W,range:z,timeZone:g.timeZone,rows:L,scrollElement:je.current,sortOrder:j,children:(0,e.jsx)(Z.k,{...g,app:G,dedupStrategy:ae,deduplicatedRows:L,forceEscape:F,logRows:L,logsSortOrder:j,scrollElement:je.current,prettifyLogMessage:!!D,scrollIntoView:p,showLabels:!!X,showTime:f,wrapLogMessage:V})})})]})});ne.displayName="LogRowsComponent";function he(C,W){C.payload.scrollTo==="top"?W?.scrollTo(0,0):W&&W.scrollTo(0,W.scrollHeight)}const b={scrollableLogRows:(0,l.css)({overflowY:"auto",width:"100%",maxHeight:"80vh"}),forwardedScrollableLogRows:(0,l.css)({overflowY:"auto",width:"100%",maxHeight:"100%"}),logRows:(0,l.css)({overflowX:"scroll",overflowY:"visible",width:"100%"}),logRowsContainer:(0,l.css)({display:"flex",flexDirection:"row-reverse",height:"100%"})}},17896:(tt,we,n)=>{n.d(we,{Dh:()=>q,K6:()=>he,V7:()=>U,rg:()=>z,u8:()=>de});var e=n(74848),l=n(22803),P=n(96540),r=n(17548),J=n(1906),Y=n(92745),m=n(43173),Le=n(27489),I=n(739),H=n(45861),_=n(30703),h=n(82212);const de=({app:g,children:B,loading:G,loadMoreLogs:ae,range:v,rows:F,scrollElement:D,sortOrder:j,timeZone:f,topScrollEnabled:X=!1})=>{const[V,ie]=(0,P.useState)(!1),[je,L]=(0,P.useState)(!1),[d,p]=(0,P.useState)(!1),[c,T]=(0,P.useState)(!1),k=(0,P.useRef)(F),te=(0,P.useRef)(D?.scrollTop||0),fe=(0,P.useRef)(null),le=(0,P.useRef)(0);(0,P.useEffect)(()=>{ie(!1),L(!1)},[v,F,j]),(0,P.useEffect)(()=>{G||(p(!1),T(!1))},[G]),(0,P.useEffect)(()=>{c&&D&&D.scrollTo(0,D.scrollHeight-D.clientHeight)},[c,D]),(0,P.useEffect)(()=>{F!==k.current&&F.length===k.current.length&&(d||c)&&(j===I.uH.Descending&&c?L(!0):j===I.uH.Ascending&&d&&ie(!0)),k.current=F},[c,F,j,d]),(0,P.useEffect)(()=>{if(!D||!ae)return;function K(oe){if(!D||!ae||!F.length||G||!m.$.featureToggles.logsInfiniteScrolling)return;const pe=U(oe,fe.current,le,D,te.current);fe.current=oe,te.current=D.scrollTop,pe!==0&&(oe.stopImmediatePropagation(),pe===-1&&X?ce():pe===1&&y(),fe.current=null)}function ce(){const oe=Q(he(F),v,f,j);if(!oe){ie(!0);return}ie(!1),ae?.(oe),p(!0),(0,Le.rR)("grafana_logs_infinite_scrolling",{direction:"top",sort_order:j})}function y(){const oe=z(he(F),v,f,j);if(!oe){L(!0);return}L(!1),ae?.(oe),T(!0),(0,Le.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:j})}return D.addEventListener("scroll",K),D.addEventListener("wheel",K),()=>{D.removeEventListener("scroll",K),D.removeEventListener("wheel",K)}},[ae,G,v,F,D,j,f,X]);const x=j===I.uH.Descending&&r.isRelativeTime(v.raw.to),R=j===I.uH.Ascending&&r.isRelativeTime(v.raw.to),w=(0,P.useCallback)(()=>{(0,Le.rR)("grafana_explore_logs_infinite_pagination_clicked",{pageType:"olderLogsButton"});const K=Q(he(F),v,f,j);if(!K){ie(!0);return}ie(!1),ae?.(K),p(!0),D?.scroll({behavior:"auto",top:0})},[ae,v,F,D,j,f]);return(0,e.jsxs)(e.Fragment,{children:[d&&(0,e.jsx)(h.I,{adjective:j===I.uH.Descending?"newer":"older"}),!x&&V&&Z,j===I.uH.Ascending&&g===J.Jk.Explore&&ae&&(0,e.jsx)(H.$n,{className:E.navButton,variant:"secondary",onClick:w,disabled:G,children:(0,e.jsxs)("div",{className:E.navButtonContent,children:[(0,e.jsx)(_.I,{name:"angle-up",size:"lg"}),(0,e.jsx)(Y.x6,{i18nKey:"logs.infinite-scroll.older-logs",children:"Older logs"})]})}),B,!R&&je&&Z,c&&(0,e.jsx)(h.I,{adjective:j===I.uH.Descending?"older":"newer"})]})},E={messageContainer:(0,l.css)({textAlign:"center",padding:.25}),navButton:(0,l.css)({width:"58px",height:"68px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",lineHeight:"1",position:"absolute",top:0,right:-3,zIndex:1}),navButtonContent:(0,l.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",whiteSpace:"normal"})},Z=(0,e.jsx)("div",{className:E.messageContainer,"data-testid":"end-of-range",children:(0,e.jsx)(Y.x6,{i18nKey:"logs.out-of-range-message.end-of-the-selected-time-range",children:"End of the selected time range."})});var q=(g=>(g[g.Top=-1]="Top",g[g.Bottom=1]="Bottom",g[g.NoScroll=0]="NoScroll",g))(q||{});function U(g,B,G,ae,v){if(ae.scrollHeight<=ae.clientHeight)return 0;const F=g instanceof WheelEvent?g.deltaY:ae.scrollTop-v;if(F===0)return 0;const D=F<0?-1:1;return(D===-1?ae.scrollTop:ae.scrollHeight-ae.scrollTop-ae.clientHeight)>1||!B||ne(g,B,G)?0:D}function ne(g,B,G){const ae=g.timeStamp-B.timeStamp;return ae>500?(G.current=0,!1):(G.current++,ae<100?G.current>=180?(G.current=0,!1):!0:ae<400&&G.current>=25?(G.current=0,!1):!0)}function he(g){const B=g[0].timeEpochMs,G=g[g.length-1].timeEpochMs;return G<B?{from:G,to:B}:{from:B,to:G}}function b(g,B){return{from:B.from.valueOf(),to:g.from}}function C(g,B,G){return B=N(B,G),{from:g.to,to:B.to.valueOf()}}const W=1e3;function Q(g,B,G,ae){return ae===I.uH.Descending?(B=N(B,G),B.to.valueOf()-g.to>W?C(g,B,G):void 0):Math.abs(B.from.valueOf()-g.from)>W?b(g,B):void 0}function z(g,B,G,ae){return ae===I.uH.Descending?Math.abs(B.from.valueOf()-g.from)>W?b(g,B):void 0:(B=N(B,G),B.to.valueOf()-g.to>W?C(g,B,G):void 0)}function N(g,B){return r.isRelativeTimeRange(g.raw)?r.convertRawToRange(g.raw,B):g}},82212:(tt,we,n)=>{n.d(we,{I:()=>r});var e=n(74848),l=n(22803),P=n(68079);const r=({adjective:Y="newer"})=>{const m=`Loading ${Y} logs...`;return(0,e.jsx)("div",{className:J,children:(0,e.jsxs)("div",{children:[m," ",(0,e.jsx)(P.y,{inline:!0})]})})},J=(0,l.css)({display:"flex",justifyContent:"center"})},13744:(tt,we,n)=>{n.d(we,{x:()=>F,r:()=>G});var e=n(74848),l=n(22803),P=n(96540),r=n(54092),J=n(39443),Y=n(92745),m=n(46907),Le=n(63142),I=n(74746),H=n(76487),_=n(2543),h=n(41811),de=n(1906),E=n(27489),Z=n(47931),q=n(76319),U=n(28134),ne=n(45967),he=n(37234),b=n(29229),C=n(21429);const W=(0,h.default)(D=>({labelType:(0,l.css)({border:`solid 1px ${D.colors.text.secondary}`,color:D.colors.text.secondary,borderRadius:D.shape.radius.circle,fontSize:D.spacing(1),lineHeight:D.spacing(1.25),height:D.spacing(1.5),width:D.spacing(1.5),display:"flex",justifyContent:"center",verticalAlign:"middle",marginLeft:D.spacing(1)}),wordBreakAll:(0,l.css)({label:"wordBreakAll",wordBreak:"break-all"}),copyButton:(0,l.css)({"& > button":{color:D.colors.text.secondary,padding:0,justifyContent:"center",borderRadius:D.shape.radius.circle,height:D.spacing(D.components.height.sm),width:D.spacing(D.components.height.sm),svg:{margin:0},"span > div":{top:"-5px","& button":{color:D.colors.success.main}}}}),adjoiningLinkButton:(0,l.css)({marginLeft:D.spacing(1)}),wrapLine:(0,l.css)({label:"wrapLine",whiteSpace:"pre-wrap"}),logDetailsStats:(0,l.css)({padding:`0 ${D.spacing(1)}`}),logDetailsValue:(0,l.css)({display:"flex",alignItems:"center",lineHeight:"22px",".log-details-value-copy":{visibility:"hidden"},"&:hover":{".log-details-value-copy":{visibility:"visible"}}}),buttonRow:(0,l.css)({display:"flex",flexDirection:"row",gap:D.spacing(.5),marginLeft:D.spacing(.5)})}));class Q extends P.PureComponent{constructor(){super(...arguments),this.state={showFieldsStats:!1,fieldCount:0,fieldStats:null},this.showField=()=>{const{onClickShowField:j,parsedKeys:f,row:X}=this.props;j&&j(f[0]),(0,E.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:X.datasourceType,logRowUid:X.uid,type:"enable"})},this.hideField=()=>{const{onClickHideField:j,parsedKeys:f,row:X}=this.props;j&&j(f[0]),(0,E.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:X.datasourceType,logRowUid:X.uid,type:"disable"})},this.isFilterLabelActive=async()=>{const{isFilterLabelActive:j,parsedKeys:f,parsedValues:X,row:V}=this.props;return j?await j(f[0],X[0],V.dataFrame?.refId):!1},this.filterLabel=()=>{const{onClickFilterLabel:j,parsedKeys:f,parsedValues:X,row:V}=this.props;j&&j(f[0],X[0],(0,he.f8)(V)||void 0),(0,E.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:V.datasourceType,filterType:"include",logRowUid:V.uid})},this.filterOutLabel=()=>{const{onClickFilterOutLabel:j,parsedKeys:f,parsedValues:X,row:V}=this.props;j&&j(f[0],X[0],(0,he.f8)(V)||void 0),(0,E.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:V.datasourceType,filterType:"exclude",logRowUid:V.uid})},this.updateStats=()=>{const{getStats:j}=this.props,f=j(),X=f?f.reduce((V,ie)=>V+ie.count,0):0;(!(0,_.isEqual)(this.state.fieldStats,f)||X!==this.state.fieldCount)&&this.setState({fieldStats:f,fieldCount:X})},this.showStats=()=>{const{isLabel:j,row:f,app:X}=this.props,{showFieldsStats:V}=this.state;V||this.updateStats(),this.toggleFieldsStats(),(0,E.rR)("grafana_explore_logs_log_details_stats_clicked",{dataSourceType:f.datasourceType,fieldType:j?"label":"detectedField",type:V?"close":"open",logRowUid:f.uid,app:X})}}componentDidUpdate(){this.state.showFieldsStats&&this.updateStats()}toggleFieldsStats(){this.setState(j=>({showFieldsStats:!j.showFieldsStats}))}generateClipboardButton(j){const{theme:f}=this.props,X=W(f);return(0,e.jsx)("div",{className:`log-details-value-copy ${X.copyButton}`,children:(0,e.jsx)(Z.b,{getText:()=>j,title:(0,Y.t)("logs.un-themed-log-details-row.title-copy-value-to-clipboard","Copy value to clipboard"),fill:"text",variant:"secondary",icon:"copy",size:"md"})})}generateMultiVal(j,f){return(0,e.jsx)("table",{children:(0,e.jsx)("tbody",{children:j?.map((X,V)=>(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{children:[X,f&&X!==""&&this.generateClipboardButton(X)]})},`${X}-${V}`))})})}render(){const{theme:j,parsedKeys:f,parsedValues:X,isLabel:V,links:ie,displayedFields:je,wrapLogMessage:L,onClickFilterLabel:d,onClickFilterOutLabel:p,disableActions:c,row:T,app:k,onPinLine:te,pinLineButtonTooltipTitle:fe}=this.props,{showFieldsStats:le,fieldStats:x,fieldCount:R}=this.state,w=W(j),K=(0,C.D)(j),ce=f==null?!1:f.length===1,y=X==null?!1:X.length===1,oe=!c&&d&&p,pe=k===de.Jk.Explore&&T.dataFrame?.refId?` in query ${T.dataFrame?.refId}`:"",me=ce?(0,I.dO)(f[0],T):null,Te=!y&&X!=null&&!X.every(xe=>xe===""),Oe=je&&f!=null&&je.includes(f[0])?(0,e.jsx)(q.K,{variant:"primary",tooltip:(0,Y.t)("logs.un-themed-log-details-row.toggle-field-button.tooltip-hide-this-field","Hide this field"),name:"eye",onClick:this.hideField}):(0,e.jsx)(q.K,{tooltip:(0,Y.t)("logs.un-themed-log-details-row.toggle-field-button.tooltip-field-instead-message","Show this field instead of the message"),name:"eye",onClick:this.showField});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:K.logDetailsValue,children:[(0,e.jsx)("td",{className:K.logsDetailsIcon,children:(0,e.jsxs)("div",{className:w.buttonRow,children:[oe&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N,{name:"search-plus",onClick:this.filterLabel,isActive:()=>this.isFilterLabelActive(),tooltipSuffix:pe}),(0,e.jsx)(q.K,{name:"search-minus",tooltip:k===de.Jk.Explore&&T.dataFrame?.refId?(0,Y.t)("logs.un-themed-log-details-row.filter-out-query","Filter out value in query {{query}}",{query:T.dataFrame?.refId}):(0,Y.t)("logs.un-themed-log-details-row.filter-out","Filter out value"),onClick:this.filterOutLabel})]}),!c&&je&&Oe,!c&&(0,e.jsx)(q.K,{variant:le?"primary":"secondary",name:"signal",tooltip:(0,Y.t)("logs.un-themed-log-details-row.tooltip-adhoc-statistics","Ad-hoc statistics"),className:"stats-button",disabled:!ce,onClick:this.showStats})]})}),(0,e.jsx)("td",{children:me&&(0,e.jsx)(z,{type:me,styles:w})}),(0,e.jsx)("td",{className:K.logDetailsLabel,children:ce?f[0]:this.generateMultiVal(f)}),(0,e.jsx)("td",{className:(0,l.cx)(w.wordBreakAll,L&&w.wrapLine),children:(0,e.jsxs)("div",{className:w.logDetailsValue,children:[y?X[0]:this.generateMultiVal(X,!0),y&&this.generateClipboardButton(X[0]),(0,e.jsx)("div",{className:(0,l.cx)((y||Te)&&w.adjoiningLinkButton),children:ie?.map((xe,be)=>{if(xe.onClick&&te){const ye=xe.onClick;xe.onClick=(Be,Ae)=>{te(T,!1),ye(Be,Ae)}}return(0,e.jsx)("span",{children:(0,e.jsx)(U.R,{buttonProps:{tooltip:typeof fe=="object"&&xe.onClick?fe:void 0,variant:"secondary",fill:"outline",...xe.icon&&{icon:xe.icon}},link:xe})},`${xe.title}-${be}`)})})]})})]}),le&&ce&&y&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(q.K,{variant:le?"primary":"secondary",name:"signal",tooltip:(0,Y.t)("logs.un-themed-log-details-row.tooltip-hide-adhoc-statistics","Hide ad-hoc statistics"),onClick:this.showStats})}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)("div",{className:w.logDetailsStats,children:(0,e.jsx)(b.y,{stats:x,label:f[0],value:X[0],rowCount:R,isLabel:V})})})]})]})}}function z({type:D,styles:j}){return(0,e.jsx)(ne.m,{content:D,children:(0,e.jsx)("div",{className:j.labelType,children:(0,e.jsx)("span",{children:D.substring(0,1)})})})}const N=({isActive:D,tooltipSuffix:j,...f})=>{const[X,V]=(0,P.useState)(!1),ie=X?"Remove filter":"Filter for value";return(0,P.useEffect)(()=>{D().then(V)},[D]),(0,e.jsx)(q.K,{...f,variant:X?"primary":void 0,tooltip:ie+j})},g=(0,Le.cV)(Q);g.displayName="LogDetailsRow";var B=n(62215);const G=D=>{const j=(0,P.useMemo)(()=>({attributes:Object.fromEntries(Object.entries(D.labels).map(([X,V])=>[X,[V]])),datasource:{type:D.datasourceType??"",uid:D.datasourceUid??""}}),[D.labels,D.datasourceType,D.datasourceUid]),{links:f}=(0,m.U)({extensionPointId:r.S.LogsViewResourceAttributes,limitPerPlugin:10,context:j});return(0,P.useMemo)(()=>f.reduce((X,V)=>{if(V.category){const ie={href:V.path??"",target:"_blank",origin:void 0,title:V.title,onClick:V.onClick,icon:V.icon};X[V.category]?X[V.category].push(ie):X[V.category]=[ie]}return X},{}),[f])},ae=D=>{function j(f){const X=G(f.row);return(0,e.jsx)(D,{...f,links:X})}return j};class v extends P.PureComponent{render(){const{app:j,row:f,theme:X,hasError:V,onClickFilterOutLabel:ie,onClickFilterLabel:je,getRows:L,showDuplicates:d,className:p,onClickShowField:c,onClickHideField:T,displayedFields:k,getFieldLinks:te,wrapLogMessage:fe,onPinLine:le,styles:x,pinLineButtonTooltipTitle:R,links:w}=this.props,K=(0,C.L)(X,f.logLevel),ce=f.labels?f.labels:{},y=Object.keys(ce).length>0,oe=(0,B.jE)(f,te);let pe=oe.filter(Ae=>Ae.links?.length);const me=pe.filter(Ae=>Ae.fieldIndex!==f.entryFieldIndex).sort(),Te=pe.filter(Ae=>Ae.fieldIndex===f.entryFieldIndex).sort(),Oe=(0,B.qE)(Te),xe=me&&me.length>0||Oe&&Oe.length>0,be=f.dataFrame.meta?.type===J.m.LogLines?[]:oe.filter(Ae=>Ae.links?.length===0&&Ae.fieldIndex!==f.entryFieldIndex).sort(),ye=be&&be.length>0,Be=V?"":`${K.logsRowLevelColor} ${x.logsRowLevel} ${x.logsRowLevelDetails}`;return(0,e.jsxs)("tr",{className:(0,l.cx)(p,x.logDetails),children:[d&&(0,e.jsx)("td",{}),(0,e.jsx)("td",{className:Be,"aria-label":(0,Y.t)("logs.un-themed-log-details.aria-label-log-level","Log level")}),(0,e.jsx)("td",{colSpan:4,children:(0,e.jsx)("div",{className:x.logDetailsContainer,children:(0,e.jsx)("table",{className:x.logDetailsTable,children:(0,e.jsxs)("tbody",{children:[k&&k.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:x.logDetailsHeading,"aria-label":(0,Y.t)("logs.un-themed-log-details.aria-label-line","Log line"),children:(0,e.jsx)(Y.x6,{i18nKey:"logs.log-details.log-line",children:"Log line"})})}),(0,e.jsx)(H.b,{onClickShowField:c,onClickHideField:T,row:f,app:j,displayedFields:k,disableActions:!1,theme:X})]}),(y||ye)&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:x.logDetailsHeading,"aria-label":(0,Y.t)("logs.un-themed-log-details.aria-label-fields","Fields"),children:(0,e.jsx)(Y.x6,{i18nKey:"logs.log-details.fields",children:"Fields"})})}),Object.keys(ce).sort().map((Ae,ze)=>{const Ye=ce[Ae];return(0,e.jsx)(g,{parsedKeys:[Ae],parsedValues:[Ye],isLabel:!0,getStats:()=>(0,I.Tj)(L(),Ae),onClickFilterOutLabel:ie,onClickFilterLabel:je,onClickShowField:c,onClickHideField:T,row:f,app:j,wrapLogMessage:fe,displayedFields:k,disableActions:!1,isFilterLabelActive:this.props.isFilterLabelActive,links:w?.[Ae]},`${Ae}=${Ye}-${ze}`)}),be.map((Ae,ze)=>{const{keys:Ye,values:st,fieldIndex:He}=Ae;return(0,e.jsx)(g,{parsedKeys:Ye,parsedValues:st,onClickShowField:c,onClickHideField:T,onClickFilterOutLabel:ie,onClickFilterLabel:je,getStats:()=>(0,I.s2)(f.dataFrame.fields[He].values),displayedFields:k,wrapLogMessage:fe,row:f,app:j,disableActions:!1,isFilterLabelActive:this.props.isFilterLabelActive},`${Ye[0]}=${st[0]}-${ze}`)}),xe&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,className:x.logDetailsHeading,"aria-label":(0,Y.t)("logs.un-themed-log-details.aria-label-data-links","Data links"),children:(0,e.jsx)(Y.x6,{i18nKey:"logs.log-details.links",children:"Links"})})}),me.map((Ae,ze)=>{const{keys:Ye,values:st,links:He,fieldIndex:Xe}=Ae;return(0,e.jsx)(g,{parsedKeys:Ye,parsedValues:st,links:He,onClickShowField:c,onClickHideField:T,onPinLine:le,pinLineButtonTooltipTitle:R,getStats:()=>(0,I.s2)(f.dataFrame.fields[Xe].values),displayedFields:k,wrapLogMessage:fe,row:f,app:j,disableActions:!1},`${Ye[0]}=${st[0]}-${ze}`)}),Oe?.map((Ae,ze)=>{const{keys:Ye,values:st,links:He,fieldIndex:Xe}=Ae;return(0,e.jsx)(g,{parsedKeys:Ye,parsedValues:st,links:He,onClickShowField:c,onClickHideField:T,onPinLine:le,pinLineButtonTooltipTitle:R,getStats:()=>(0,I.s2)(f.dataFrame.fields[Xe].values),displayedFields:k,wrapLogMessage:fe,row:f,app:j,disableActions:!0},`${Ye[0]}=${st[0]}-${ze}`)}),!ye&&!y&&!xe&&(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:100,"aria-label":(0,Y.t)("logs.un-themed-log-details.aria-label-no-details","No details"),children:(0,e.jsx)(Y.x6,{i18nKey:"logs.log-details.no-details",children:"No details available"})})})]})})})})]})}}const F=(0,Le.cV)(ae(v));F.displayName="LogDetails"},76487:(tt,we,n)=>{n.d(we,{I:()=>I,b:()=>H});var e=n(74848),l=n(22803),P=n(41811),r=n(92745),J=n(27489),Y=n(76319),m=n(21429);const Le=(0,P.default)(_=>({buttonRow:(0,l.css)({display:"flex",flexDirection:"row",gap:_.spacing(.5),marginLeft:_.spacing(.5)})})),I="___LOG_LINE_BODY___",H=_=>{const h=()=>{const{onClickShowField:C,row:W}=_;C&&C(I),(0,J.rR)("grafana_explore_logs_log_details_show_body_clicked",{datasourceType:W.datasourceType,logRowUid:W.uid,type:"enable",app:_.app})},de=()=>{const{onClickHideField:C,row:W}=_;C&&C(I),(0,J.rR)("grafana_explore_logs_log_details_show_body_clicked",{datasourceType:W.datasourceType,logRowUid:W.uid,type:"disable",app:_.app})},{theme:E,displayedFields:Z,disableActions:q,row:U}=_,ne=Le(E),he=(0,m.D)(E),b=Z!=null&&Z.includes(I)?(0,e.jsx)(Y.K,{variant:"primary",tooltip:(0,r.t)("logs.log-details-body.toggle-field-button.tooltip-hide-log-line","Hide log line"),name:"eye",onClick:de}):(0,e.jsx)(Y.K,{tooltip:(0,r.t)("logs.log-details-body.toggle-field-button.tooltip-show-log-line","Show log line"),name:"eye",onClick:h});return(0,e.jsxs)("tr",{className:he.logDetailsValue,children:[(0,e.jsx)("td",{className:he.logsDetailsIcon,children:(0,e.jsx)("div",{className:ne.buttonRow,children:!q&&Z&&b})}),(0,e.jsx)("td",{className:he.logDetailsLabel,colSpan:100,children:U.entry})]})}},29229:(tt,we,n)=>{n.d(we,{y:()=>H});var e=n(74848),l=n(22803),P=n(96540),r=n(92745),J=n(63142);const Y=_=>({logsStatsRow:(0,l.css)({label:"logs-stats-row",margin:`${parseInt(_.spacing(2),10)/1.75}px 0`}),logsStatsRowActive:(0,l.css)({label:"logs-stats-row--active",color:_.colors.primary.text,position:"relative"}),logsStatsRowLabel:(0,l.css)({label:"logs-stats-row__label",display:"flex",marginBottom:"1px"}),logsStatsRowValue:(0,l.css)({label:"logs-stats-row__value",flex:1,textOverflow:"ellipsis",overflow:"hidden"}),logsStatsRowCount:(0,l.css)({label:"logs-stats-row__count",textAlign:"right",marginLeft:_.spacing(.75)}),logsStatsRowPercent:(0,l.css)({label:"logs-stats-row__percent",textAlign:"right",marginLeft:_.spacing(.75),width:_.spacing(4.5)}),logsStatsRowBar:(0,l.css)({label:"logs-stats-row__bar",height:_.spacing(.5),overflow:"hidden",background:_.colors.text.disabled}),logsStatsRowInnerBar:(0,l.css)({label:"logs-stats-row__innerbar",height:_.spacing(.5),overflow:"hidden",background:_.colors.primary.main})}),m=({active:_,count:h,proportion:de,value:E})=>{const Z=(0,J.of)(Y),q=`${Math.round(de*100)}%`,U={width:q},ne=_?(0,l.cx)([Z.logsStatsRow,Z.logsStatsRowActive]):(0,l.cx)([Z.logsStatsRow]);return(0,e.jsxs)("div",{className:ne,children:[(0,e.jsxs)("div",{className:(0,l.cx)([Z.logsStatsRowLabel]),children:[(0,e.jsx)("div",{className:(0,l.cx)([Z.logsStatsRowValue]),title:E,children:E}),(0,e.jsx)("div",{className:(0,l.cx)([Z.logsStatsRowCount]),children:h}),(0,e.jsx)("div",{className:(0,l.cx)([Z.logsStatsRowPercent]),children:q})]}),(0,e.jsx)("div",{className:(0,l.cx)([Z.logsStatsRowBar]),children:(0,e.jsx)("div",{className:(0,l.cx)([Z.logsStatsRowInnerBar]),style:U})})]})};m.displayName="LogLabelStatsRow";const Le=5,I=_=>({logsStats:(0,l.css)({label:"logs-stats",background:"inherit",color:_.colors.text.primary,wordBreak:"break-all",width:"fit-content",maxWidth:"100%"}),logsStatsHeader:(0,l.css)({label:"logs-stats__header",borderBottom:`1px solid ${_.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,l.css)({label:"logs-stats__title",fontWeight:_.typography.fontWeightMedium,paddingRight:_.spacing(2),display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),logsStatsClose:(0,l.css)({label:"logs-stats__close",cursor:"pointer"}),logsStatsBody:(0,l.css)({label:"logs-stats__body",padding:"5px 0px"})}),H=({className:_,label:h,rowCount:de,stats:E,value:Z,isLabel:q})=>{const U=(0,J.of)(I),ne=(0,P.useMemo)(()=>{const Q=E.slice(0,Le);let z=Q.find(B=>B.value===Z),N=E.slice(Le);const g=!z;return g&&(z=N.find(B=>B.value===Z),N=N.filter(B=>B.value!==Z)),{topRows:Q,otherRows:N,insertActiveRow:g,activeRow:z}},[E,Z]),he=(0,P.useMemo)(()=>ne.otherRows.reduce((Q,z)=>Q+z.count,0),[ne.otherRows]),C=(0,P.useMemo)(()=>ne.topRows.reduce((Q,z)=>Q+z.count,0),[ne.topRows])+he,W=he/C;return(0,e.jsxs)("div",{className:_??U.logsStats,"data-testid":"logLabelStats",children:[(0,e.jsx)("div",{className:U.logsStatsHeader,children:(0,e.jsx)("div",{className:U.logsStatsTitle,children:q?(0,r.t)("logs.un-themed-log-label-stats.label-log-stats","{{label}}: {{total}} of {{rowCount}} rows have that label",{label:h,total:C,rowCount:de}):(0,r.t)("logs.un-themed-log-label-stats.field-log-stats","{{label}}: {{total}} of {{rowCount}} rows have that field")})}),(0,e.jsxs)("div",{className:U.logsStatsBody,children:[ne.topRows.map(Q=>(0,e.jsx)(m,{...Q,active:Q.value===Z},Q.value)),ne.insertActiveRow&&ne.activeRow&&(0,e.jsx)(m,{...ne.activeRow,active:!0},ne.activeRow.value),he>0&&(0,e.jsx)(m,{count:he,value:"Other",proportion:W},"__OTHERS__")]})]})}},59896:(tt,we,n)=>{n.d(we,{A:()=>h,h:()=>_});var e=n(74848),l=n(22803),P=n(96540),r=n(92745),J=n(63142),Y=n(45967),m=n(45861),Le=n(30703),I=n(76487);const H=["detected_level","level","lvl","filename"],_=(0,P.memo)(({labels:Z,emptyMessage:q,addTooltip:U=!0,displayMax:ne,onDisplayMaxToggle:he,displayAll:b=!1})=>{const[C,W]=(0,P.useState)(ne?b:void 0),Q=(0,J.of)(E),z=(0,P.useMemo)(()=>Object.keys(Z).filter(g=>!g.startsWith("_")&&!H.includes(g)&&Z[g]).map(g=>`${g}=${Z[g]}`),[Z]),N=(0,P.useMemo)(()=>z.slice(0,!C&&ne?ne:1/0),[z,C,ne]);return N.length===0&&q?(0,e.jsx)("span",{className:Q.logsLabels,children:(0,e.jsx)("span",{className:Q.logsLabel,children:q})}):(0,e.jsxs)("span",{className:Q.logsLabels,children:[N.map(g=>U?(0,e.jsx)(Y.m,{content:g,placement:"top",children:(0,e.jsx)(de,{styles:Q,children:g})},g):(0,e.jsx)(de,{styles:Q,tooltip:g,children:g},g)),N.length<z.length&&!C&&(0,e.jsxs)(m.$n,{size:"sm",fill:"outline",variant:"secondary","aria-label":(0,r.t)("logs.log-labels.expand","Expand labels"),onClick:()=>{W(!0),he?.(!0)},children:[(0,e.jsx)(Le.I,{name:"plus",size:"xs"}),z.length-N.length]}),C===!0&&(0,e.jsx)(m.$n,{size:"sm",fill:"outline",variant:"secondary","aria-label":(0,r.t)("logs.log-labels.collapse","Collapse labels"),onClick:()=>{W(!1),he?.(!1)},children:(0,e.jsx)(Le.I,{name:"minus",size:"xs"})})]})});_.displayName="LogLabels";const h=(0,P.memo)(({labels:Z})=>{const q=(0,J.of)(E);return(0,e.jsx)("span",{className:q.logsLabels,children:Z.map(U=>(0,e.jsx)(de,{styles:q,tooltip:U,children:U===I.I?(0,r.t)("logs.log-labels-list.log-line","log line"):U},U))})});h.displayName="LogLabelsList";const de=(0,P.forwardRef)(({styles:Z,tooltip:q,children:U},ne)=>(0,e.jsx)("span",{className:Z.logsLabel,ref:ne,children:(0,e.jsx)("span",{className:Z.logsLabelValue,title:q,children:U})}));de.displayName="LogLabel";const E=Z=>({logsLabels:(0,l.css)({display:"flex",flexWrap:"wrap",fontSize:Z.typography.size.xs,alignItems:"center"}),logsLabel:(0,l.css)({label:"logs-label",display:"flex",padding:Z.spacing(0,.25),backgroundColor:Z.colors.background.secondary,borderRadius:Z.shape.radius.default,margin:Z.spacing(.125,.5,0,0),textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxHeight:Z.spacing(2)}),logsLabelValue:(0,l.css)({label:"logs-label__value",display:"inline-block",maxWidth:Z.spacing(25),textOverflow:"ellipsis",overflow:"hidden"})})},25461:(tt,we,n)=>{n.d(we,{$:()=>H});var e=n(74848),l=n(88838),P=n(96540),r=n(23257),J=n.n(r),Y=n(38388),m=n(63142);function Le(_,h){return h.split(/;\s*/).reduce((de,E)=>{if(E==="color:rgba(0,0,0,0.5)")return{color:_.colors.text.secondary};const Z=E.match(/([^:\s]+)\s*:\s*(.+)/);if(Z&&Z[1]&&Z[2]){const q=Z[1].replace(/-([a-z])/g,(U,ne)=>ne.toUpperCase());de[q]=Z[2]}return de},{})}class I extends P.PureComponent{constructor(){super(...arguments),this.state={chunks:[],prevValue:""}}static getDerivedStateFromProps(h,de){return h.value===de.prevValue?null:{chunks:l.Ay.parse(h.value).spans.map(Z=>Z.css?{style:Le(h.theme,Z.css),text:Z.text}:{text:Z.text}),prevValue:h.value}}render(){const{chunks:h}=this.state;return h.map((de,E)=>{const Z=this.props.highlight?.searchWords?(0,e.jsx)(J(),{textToHighlight:de.text,searchWords:this.props.highlight.searchWords,findChunks:Y.Oq,highlightClassName:this.props.highlight.highlightClassName},E):de.text;return de.style?(0,e.jsx)("span",{style:de.style,"data-testid":"ansiLogLine",children:Z},E):Z})}}const H=(0,m.cV)(I);H.displayName="LogMessageAnsi"},48575:(tt,we,n)=>{n.d(we,{k:()=>p});var e=n(74848),l=n(22803),P=n(96540),r=n(739),J=n(92745),Y=n(43173),m=n(63142),Le=n(71599),I=n(30703),H=n(78242);class _{constructor(){this.seen=new Set,this.count=0}getKey(T){this.count+=1;const k=`k_${T}`;return this.seen.has(k)?`i_${this.count}`:(this.seen.add(k),k)}}var h=n(74746),de=n(2543),E=n(80011),Z=n(27489),q=n(45967),U=n(13744),ne=n(59896),he=n(23257),b=n.n(he),C=n(38388),W=n(25461),Q=n(76319),z=n(47931);const N=(0,P.memo)(({logText:c,onOpenContext:T,onPermalinkClick:k,onPinLine:te,onUnpinLine:fe,pinLineButtonTooltipTitle:le,pinned:x,row:R,showContextToggle:w,styles:K,mouseIsOver:ce,onBlur:y,getRowContextQuery:oe,addonBefore:pe,addonAfter:me})=>{const Te=(0,P.useMemo)(()=>w?w(R):!1,[R,w]),Oe=(0,P.useCallback)(ze=>{ze.stopPropagation()},[]),xe=(0,P.useCallback)(async ze=>{ze.stopPropagation(),(0,h.R)(ze,R,oe,T)},[T,oe,R]),be=(0,P.useCallback)(ze=>{!ze.currentTarget.contains(ze.relatedTarget)&&y&&y()},[y]),ye=(0,P.useCallback)(()=>c,[c]),Be=(0,P.useMemo)(()=>pe?g(pe,R):null,[pe,R]),Ae=(0,P.useMemo)(()=>me?g(me,R):null,[me,R]);return(0,e.jsxs)("span",{className:`log-row-menu ${K.rowMenu}`,onClick:Oe,onBlur:be,children:[x&&!ce&&(0,e.jsx)(Q.K,{className:K.unPinButton,size:"md",name:"gf-pin",onClick:()=>fe&&fe(R),tooltip:(0,J.t)("logs.log-row-menu-cell.tooltip-unpin-line","Unpin line"),tooltipPlacement:"top","aria-label":(0,J.t)("logs.log-row-menu-cell.aria-label-unpin-line","Unpin line"),tabIndex:0}),ce&&(0,e.jsxs)(e.Fragment,{children:[Be,Te&&(0,e.jsx)(Q.K,{size:"md",name:"gf-show-context",onClick:xe,tooltip:(0,J.t)("logs.log-row-menu-cell.tooltip-show-context","Show context"),tooltipPlacement:"top","aria-label":(0,J.t)("logs.log-row-menu-cell.aria-label-show-context","Show context"),tabIndex:0}),(0,e.jsx)(z.b,{className:K.copyLogButton,icon:"copy",variant:"secondary",fill:"text",size:"md",getText:ye,tooltip:(0,J.t)("logs.log-row-menu-cell.tooltip-copy-to-clipboard","Copy to clipboard"),tooltipPlacement:"top",tabIndex:0}),x&&fe&&(0,e.jsx)(Q.K,{className:K.unPinButton,size:"md",name:"gf-pin",onClick:()=>fe&&fe(R),tooltip:(0,J.t)("logs.log-row-menu-cell.tooltip-unpin-line","Unpin line"),tooltipPlacement:"top","aria-label":(0,J.t)("logs.log-row-menu-cell.aria-label-unpin-line","Unpin line"),tabIndex:0}),!x&&te&&(0,e.jsx)(Q.K,{className:K.unPinButton,size:"md",name:"gf-pin",onClick:()=>te&&te(R),tooltip:le??"Pin line",tooltipPlacement:"top","aria-label":(0,J.t)("logs.log-row-menu-cell.aria-label-pin-line","Pin line"),tabIndex:0}),k&&R.rowId!==void 0&&R.uid&&(0,e.jsx)(Q.K,{tooltip:(0,J.t)("logs.log-row-menu-cell.tooltip-copy-shortlink","Copy shortlink"),"aria-label":(0,J.t)("logs.log-row-menu-cell.aria-label-copy-shortlink","Copy shortlink"),tooltipPlacement:"top",size:"md",name:"share-alt",onClick:()=>k(R),tabIndex:0}),Ae]})]})});function g(c,T){return c.map((k,te)=>{if((0,P.isValidElement)(k)){const fe=k.props.onClick;return fe?(0,P.cloneElement)(k,{onClick:le=>{fe(le,T)},key:te}):k}return k})}N.displayName="LogRowMenuCell";const B=1e5,G=({hasAnsi:c,entry:T,highlights:k,styles:te})=>{const fe=(0,P.useMemo)(()=>T.length-B,[T]),le=k&&k.length>0&&k[0]&&k[0].length>0&&fe<=0,x=k??[],[R,w]=(0,P.useState)(fe<0),K=(0,P.useMemo)(()=>R?T:T.substring(0,B),[T,R]);if(c){const ce=le?{searchWords:x,highlightClassName:te.logsRowMatchHighLight}:void 0;return(0,e.jsx)(W.$,{value:K,highlight:ce})}else if(le)return(0,e.jsx)(b(),{textToHighlight:K,searchWords:x,findChunks:C.Oq,highlightClassName:te.logsRowMatchHighLight});return(0,e.jsxs)(e.Fragment,{children:[K,!R&&(0,e.jsx)(ae,{showFull:R,toggle:w,diff:fe})]})},ae=({toggle:c,diff:T})=>{const k=v((0,m.$j)()),te=fe=>{fe.stopPropagation(),c(!0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.x6,{i18nKey:"logs.log-row-message.ellipsis",children:"\u2026 "}),(0,e.jsxs)("button",{className:k.showMore,onClick:te,children:[T," ",(0,e.jsx)(J.x6,{i18nKey:"logs.log-row-message.more",children:"more"})]})]})},v=c=>({showMore:(0,l.css)({backgroundColor:"transparent",display:"inline-flex",fontWeight:c.typography.fontWeightMedium,fontSize:c.typography.size.sm,fontFamily:c.typography.fontFamily,height:c.spacing(3),padding:c.spacing(.25,1),color:c.colors.secondary.text,border:`1px solid ${c.colors.border.strong}`,"&:hover":{background:c.colors.secondary.transparent,borderColor:c.colors.emphasize(c.colors.border.strong,.25),color:c.colors.secondary.text}})}),F=(c,T,k,te,fe)=>{let le=c.raw;if(T)try{return le=JSON.stringify(JSON.parse(le),void 0,2),c.hasUnescapedContent&&fe?(0,h.Hw)(le):le}catch{}return c.hasUnescapedContent&&fe&&(le=(0,h.Hw)(le)),!k&&!te&&(le=le.replace(/(\r\n|\n|\r)/g,"")),le},D=(0,P.memo)(c=>{const{row:T,wrapLogMessage:k,prettifyLogMessage:te,showContextToggle:fe,styles:le,onOpenContext:x,onPermalinkClick:R,onUnpinLine:w,onPinLine:K,pinLineButtonTooltipTitle:ce,pinned:y,mouseIsOver:oe,onBlur:pe,getRowContextQuery:me,expanded:Te,logRowMenuIconsBefore:Oe,logRowMenuIconsAfter:xe,forceEscape:be}=c,{hasAnsi:ye}=T,Be=(0,P.useMemo)(()=>F(T,te,k,!!Te,!!be),[Te,be,te,T,k]),Ae=oe||y;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{className:le.logsRowMessage,children:(0,e.jsx)("div",{className:k?le.positionRelative:le.horizontalScroll,children:(0,e.jsx)("div",{className:`${le.logLine} ${le.positionRelative}`,children:(0,e.jsx)(G,{hasAnsi:ye,entry:Be,highlights:T.searchWords,styles:le})})})}),(0,e.jsx)("td",{className:`log-row-menu-cell ${le.logRowMenuCell}`,children:Ae&&(0,e.jsx)(N,{logText:Be,row:T,showContextToggle:fe,getRowContextQuery:me,onOpenContext:x,onPermalinkClick:R,onPinLine:K,onUnpinLine:w,pinLineButtonTooltipTitle:ce,pinned:y,styles:le,mouseIsOver:oe,onBlur:pe,addonBefore:Oe,addonAfter:xe})})]})});D.displayName="LogRowMessage";var j=n(76487),f=n(62215);const X=(0,P.memo)(c=>{const{row:T,detectedFields:k,getFieldLinks:te,wrapLogMessage:fe,styles:le,mouseIsOver:x,pinned:R,logRowMenuIconsBefore:w,logRowMenuIconsAfter:K,preview:ce,...y}=c,oe=fe?"":V.noWrap,pe=(0,P.useMemo)(()=>(0,f.jE)(T,te),[te,T]),me=(0,P.useMemo)(()=>{let Oe="";for(let xe=0;xe<k.length;xe++){const be=k[xe];be===j.I&&(Oe+=` ${T.entry}`);const ye=pe.find(Be=>Be.keys[0]===be);ye!=null&&(Oe+=` ${be}=${ye.values}`),T.labels[be]!=null&&T.labels[be]!=null&&(Oe+=` ${be}=${T.labels[be]}`)}return Oe.trimStart()},[k,pe,T.entry,T.labels]),Te=x||R;return ce?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{children:(0,e.jsx)("div",{children:me})}),(0,e.jsx)("td",{})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("td",{className:le.logsRowMessage,children:(0,e.jsx)("div",{className:oe,children:me})}),(0,e.jsx)("td",{className:`log-row-menu-cell ${le.logRowMenuCell}`,children:Te&&(0,e.jsx)(N,{logText:me,row:T,styles:le,pinned:R,mouseIsOver:x,addonBefore:w,addonAfter:K,...y})})]})}),V={noWrap:(0,l.css)({whiteSpace:"nowrap"})};X.displayName="LogRowMessageDisplayedFields";var ie=n(21429);const je=({getRows:c,onClickFilterLabel:T,onClickFilterOutLabel:k,onClickShowField:te,onClickHideField:fe,enableLogDetails:le,row:x,showDuplicates:R,showContextToggle:w,showLabels:K,showTime:ce,displayedFields:y,wrapLogMessage:oe,prettifyLogMessage:pe,getFieldLinks:me,forceEscape:Te,app:Oe,styles:xe,getRowContextQuery:be,pinned:ye,logRowMenuIconsBefore:Be,logRowMenuIconsAfter:Ae,timeZone:ze,permalinkedRowId:Ye,scrollIntoView:st,handleTextSelection:He,onLogRowHover:Xe,...nt})=>{const[at,vt]=(0,P.useState)(!1),[Ee,Qe]=(0,P.useState)(!1),[We,Ce]=(0,P.useState)(!1),[Re,$e]=(0,P.useState)(!1),Ve=(0,P.useRef)(null),Ie=(0,m.$j)(),$=(0,P.useMemo)(()=>(0,E.LE)(x.timeEpochMs,{timeZone:ze,defaultWithMS:!0}),[x.timeEpochMs,ze]),O=(0,P.useMemo)(()=>(0,ie.L)(Ie,x.logLevel),[x.logLevel,Ie]),ge=(0,P.useMemo)(()=>x.hasUnescapedContent&&Te?{...x,entry:(0,h.Hw)(x.entry)}:x,[Te,x]),ee=(0,h.Ei)(x),ue=ee!==void 0,De=(0,h.qR)(x),Fe=De!==void 0;(0,P.useEffect)(()=>{if(Ye!==x.uid){$e(!1);return}if(!Re){$e(!0);return}Ve.current&&st&&(st(Ve.current),(0,Z.rR)("grafana_explore_logs_permalink_opened",{datasourceType:x.datasourceType??"unknown",logRowUid:x.uid}),$e(!0))},[Re,Ye,x.datasourceType,x.uid,st]);const re=(0,P.useCallback)((0,de.debounce)(()=>{vt(!1)},3e3),[]),Ke=(0,P.useCallback)(ut=>{vt(!0),nt.onOpenContext(ut,re)},[re,nt]),Ue=(0,P.useCallback)(ut=>{He?.(ut,x)||le&&Qe(ct=>!ct)},[le,He,x]),Ze=(0,P.useCallback)(()=>{Ce(!0),Xe&&Xe(x)},[Xe,x]),pt=(0,P.useCallback)(ut=>{He&&document.getSelection()?.toString()&&ut.buttons>0&&Ce(!1)},[He]),Ge=(0,P.useCallback)(()=>{Ce(!1)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{ref:Ve,className:`${xe.logsRow} ${ue?xe.errorLogRow:""} ${at||Re||ye?xe.highlightBackground:""}`,onClick:Ue,onMouseEnter:Ze,onMouseLeave:Ge,onMouseMove:pt,onFocus:Ze,children:[R&&(0,e.jsx)("td",{className:xe.logsRowDuplicates,children:ge.duplicates&&ge.duplicates>0?`${ge.duplicates+1}x`:null}),(0,e.jsxs)("td",{className:ue||Fe?xe.logsRowWithError:`${O.logsRowLevelColor} ${xe.logsRowLevel}`,children:[ue&&(0,e.jsx)(q.m,{content:(0,J.t)("logs.log-row-message.tooltip-error","Error: {{errorMessage}}",{errorMessage:ee}),placement:"right",theme:"error",children:(0,e.jsx)(I.I,{className:xe.logIconError,name:"exclamation-triangle",size:"xs"})}),Fe&&(0,e.jsx)(q.m,{content:De,placement:"right",theme:"info",children:(0,e.jsx)(I.I,{className:xe.logIconInfo,name:"info-circle",size:"xs"})})]}),(0,e.jsx)("td",{title:le?Ee?"Hide log details":"See log details":"",className:le?xe.logsRowToggleDetails:"",children:le&&(0,e.jsx)("button",{"aria-label":(0,J.t)("logs.log-row-message.see-details","See log details"),className:xe.detailsToggle,"aria-expanded":Ee,children:(0,e.jsx)(I.I,{className:xe.topVerticalAlign,name:Ee?"angle-down":"angle-right"})})}),ce&&(0,e.jsx)("td",{className:xe.logsRowLocalTime,children:$}),K&&ge.uniqueLabels&&(0,e.jsx)("td",{className:xe.logsRowLabels,children:(0,e.jsx)(ne.h,{labels:ge.uniqueLabels,addTooltip:!1})}),y&&y.length>0?(0,e.jsx)(X,{row:ge,showContextToggle:w,detectedFields:y,getFieldLinks:me,wrapLogMessage:oe,onOpenContext:Ke,onPermalinkClick:nt.onPermalinkClick,styles:xe,onPinLine:nt.onPinLine,onUnpinLine:nt.onUnpinLine,pinned:ye,mouseIsOver:We,onBlur:Ge,logRowMenuIconsBefore:Be,logRowMenuIconsAfter:Ae}):(0,e.jsx)(D,{row:ge,showContextToggle:w,getRowContextQuery:be,wrapLogMessage:oe,prettifyLogMessage:pe,onOpenContext:Ke,onPermalinkClick:nt.onPermalinkClick,app:Oe,styles:xe,onPinLine:nt.onPinLine,onUnpinLine:nt.onUnpinLine,pinLineButtonTooltipTitle:nt.pinLineButtonTooltipTitle,pinned:ye,mouseIsOver:We,onBlur:Ge,expanded:Ee,forceEscape:Te,logRowMenuIconsBefore:Be,logRowMenuIconsAfter:Ae})]}),Ee&&(0,e.jsx)(U.x,{onPinLine:nt.onPinLine,className:`${xe.logsRow} ${ue?xe.errorLogRow:""} ${Re&&!Ee?xe.highlightBackground:""}`,showDuplicates:R,getFieldLinks:me,onClickFilterLabel:T,onClickFilterOutLabel:k,onClickShowField:te,onClickHideField:fe,getRows:c,row:ge,wrapLogMessage:oe,hasError:ue,displayedFields:y,app:Oe,styles:xe,isFilterLabelActive:nt.isFilterLabelActive,pinLineButtonTooltipTitle:nt.pinLineButtonTooltipTitle})]})},L=()=>{},d=({row:c,showDuplicates:T,showLabels:k,showTime:te,displayedFields:fe,...le})=>(0,e.jsxs)("tr",{children:[T&&(0,e.jsx)("td",{}),(0,e.jsx)("td",{}),(0,e.jsx)("td",{}),te&&(0,e.jsx)("td",{children:c.timeEpochMs}),k&&c.uniqueLabels&&(0,e.jsx)("td",{}),fe&&fe.length>0?(0,e.jsx)(X,{...le,row:c,detectedFields:fe,mouseIsOver:!1,onBlur:L,onOpenContext:L,preview:!0}):(0,e.jsx)("td",{className:le.styles.logsRowMessage,children:c.entry}),(0,e.jsx)("td",{className:`log-row-menu-cell ${le.styles.logRowMenuCell}`})]}),p=(0,P.memo)(({deduplicatedRows:c,logRows:T=[],dedupStrategy:k,logsSortOrder:te,previewLimit:fe,pinnedLogs:le,onOpenContext:x,onClickFilterOutString:R,onClickFilterString:w,scrollElement:K,renderPreview:ce=!1,enableLogDetails:y,permalinkedRowId:oe,...pe})=>{const[me,Te]=(0,P.useState)(ce&&!oe?Math.max(2*Math.ceil(window.innerHeight/20),Math.ceil(T.length/3)):1/0),[Oe,xe]=(0,P.useState)({selection:"",selectedRow:null,popoverMenuCoordinates:{x:0,y:0}}),[be,ye]=(0,P.useState)(!1),Be=(0,P.useRef)(null),Ae=(0,m.$j)(),ze=(0,ie.D)(Ae),Ye=c||T,st=(0,P.useMemo)(()=>Ye.reduce(($,O)=>O.duplicates?$+O.duplicates:$,0),[Ye]),He=k!==r.fY.none&&st>0,Xe=(0,P.useMemo)(()=>te?(0,h.oR)(Ye,te):Ye,[Ye,te]),nt=(0,P.useMemo)(()=>()=>Xe,[Xe]),at=(0,P.useRef)(null),vt=new _;(0,P.useEffect)(()=>()=>{at.current&&(document.removeEventListener("click",at.current),document.removeEventListener("contextmenu",at.current))},[]),(0,P.useEffect)(()=>{if(!K)return;function $(){Te(1/0),K?.removeEventListener("scroll",$),K?.removeEventListener("wheel",$)}K.addEventListener("scroll",$),K.addEventListener("wheel",$)},[T.length,K]);const Ee=(0,P.useCallback)(($,O)=>{x&&x($,O)},[x]),Qe=(0,P.useCallback)(()=>!Y.$.featureToggles.logRowsPopoverMenu||(0,h.Vu)()?!1:!!(R||w),[R,w]),We=(0,P.useCallback)(()=>{at.current&&(document.removeEventListener("click",at.current),document.removeEventListener("contextmenu",at.current),at.current=null),xe({selection:"",popoverMenuCoordinates:{x:0,y:0},selectedRow:null})},[]),Ce=(0,P.useCallback)($=>{if((0,h.a8)($.target)&&!Be.current?.contains($.target)){We();return}document.getSelection()?.toString()||We()},[We]),Re=(0,P.useCallback)(($,O)=>{const ge=document.getSelection()?.toString();if(!ge)return!1;if($.altKey&&(0,h.Ck)(),Qe()===!1)return!!ge;if(!Be.current)return!1;const ee=270,ue=105,De=$.clientX+ee>window.innerWidth?window.innerWidth-ee:$.clientX,Fe=$.clientY+ue>window.innerHeight?window.innerHeight-ue:$.clientY;return xe({selection:ge,popoverMenuCoordinates:{x:De,y:Fe},selectedRow:O}),at.current=Ce,document.addEventListener("click",Ce),document.addEventListener("contextmenu",Ce),!0},[Ce,Qe]),$e=(0,P.useCallback)(()=>{ye(!0)},[]),Ve=(0,P.useCallback)(()=>{ye(!1)},[]),Ie=(0,P.useCallback)(()=>{(0,h.PO)(),ye(!1)},[]);return(0,e.jsxs)("div",{className:ze.logRows,ref:Be,children:[Oe.selection&&Oe.selectedRow&&(0,e.jsx)(H.N,{close:We,row:Oe.selectedRow,selection:Oe.selection,...Oe.popoverMenuCoordinates,onClickFilterString:w,onClickFilterOutString:R,onDisable:$e}),be&&(0,e.jsx)(Le.u,{isOpen:!0,title:(0,J.t)("logs.log-rows.disable-popover.title","Disable menu"),body:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.x6,{i18nKey:"logs.log-rows.disable-popover.message",children:"You are about to disable the logs filter menu. To re-enable it, select text in a log line while holding the alt key."}),(0,e.jsxs)("div",{className:ze.shortcut,children:[(0,e.jsx)(I.I,{name:"keyboard"}),(0,e.jsx)(J.x6,{i18nKey:"logs.log-rows.disable-popover-message.shortcut",children:"alt+select to enable again"})]})]}),confirmText:(0,J.t)("logs.log-rows.disable-popover.confirm","Confirm"),icon:"exclamation-triangle",onConfirm:Ie,onDismiss:Ve}),(0,e.jsx)("table",{className:(0,l.cx)(ze.logsRowsTable,pe.overflowingContent?"":ze.logsRowsTableContain),children:(0,e.jsx)("tbody",{children:Xe.map(($,O)=>O<me?(0,e.jsx)(je,{getRows:nt,row:$,showDuplicates:He,logsSortOrder:te,onOpenContext:Ee,styles:ze,onPermalinkClick:pe.onPermalinkClick,scrollIntoView:pe.scrollIntoView,permalinkedRowId:oe,onPinLine:pe.onPinLine,onUnpinLine:pe.onUnpinLine,pinLineButtonTooltipTitle:pe.pinLineButtonTooltipTitle,pinned:le?.some(ge=>ge===$.rowId||ge===$.uid),isFilterLabelActive:pe.isFilterLabelActive,handleTextSelection:Re,enableLogDetails:y,...pe},vt.getKey($.uid)):(0,e.jsx)(d,{enableLogDetails:!1,getRows:nt,onOpenContext:Ee,styles:ze,showDuplicates:He,...pe,row:$},`preview_${vt.getKey($.uid)}`))})})]})})},21429:(tt,we,n)=>{n.d(we,{D:()=>Le,L:()=>m});var e=n(22803),l=n(41811),P=n(84140),r=n(67770),J=n(6773),Y=n(35484);const m=(I,H)=>{let _=I.isLight?I.v1.palette.gray5:I.v1.palette.gray2;switch(H){case r.$b.crit:case r.$b.critical:_="#705da0";break;case r.$b.error:case r.$b.err:_="#e24d42";break;case r.$b.warning:case r.$b.warn:_=I.colors.warning.main;break;case r.$b.info:_="#7eb26d";break;case r.$b.debug:_="#1f78c1";break;case r.$b.trace:_="#6ed0e0";break}return{logsRowLevelColor:(0,e.css)({"&::after":{backgroundColor:_}})}},Le=(0,l.default)(I=>{const H=Y.hoverColor(I.colors.background.secondary,I),_=(0,P.A)(I.components.dashboard.background).setAlpha(.7).toRgbString();return{logsRowLevel:(0,e.css)({label:"logs-row__level",maxWidth:I.spacing(1.25),cursor:"default","&::after":{content:"''",display:"block",position:"absolute",top:"1px",bottom:"1px",width:"3px",left:I.spacing(.5)}}),logsRowWithError:(0,e.css)({maxWidth:`${I.spacing(1.5)}`}),logsRowMatchHighLight:(0,e.css)({label:"logs-row__match-highlight",background:"inherit",padding:"inherit",color:I.components.textHighlight.text,backgroundColor:I.components.textHighlight.background}),logRows:(0,e.css)({position:"relative"}),shortcut:(0,e.css)({display:"inline-flex",alignItems:"center",gap:I.spacing(1),color:I.colors.text.secondary,opacity:.7,fontSize:I.typography.bodySmall.fontSize,marginTop:I.spacing(1)}),logsRowsTable:(0,e.css)({label:"logs-rows",fontFamily:I.typography.fontFamilyMonospace,fontSize:I.typography.bodySmall.fontSize,width:"100%",position:"relative"}),logsRowsTableContain:(0,e.css)({contain:"strict"}),highlightBackground:(0,e.css)({backgroundColor:(0,P.A)(I.colors.info.transparent).setAlpha(.25).toString()}),logsRow:(0,e.css)({label:"logs-row",width:"100%",cursor:"pointer",verticalAlign:"top","&:focus-within":{outline:`2px solid ${I.colors.primary.border}`,outlineOffset:"-2px"},"&:hover":{".log-row-menu":{zIndex:1},background:H},"td:not(.log-row-menu-cell):last-child":{width:"100%"},"> td:not(.log-row-menu-cell)":{position:"relative",paddingRight:I.spacing(1),borderTop:"1px solid transparent",borderBottom:"1px solid transparent",height:"100%"}}),logsRowDuplicates:(0,e.css)({label:"logs-row__duplicates",textAlign:"right",width:"4em",cursor:"default"}),logIconError:(0,e.css)({color:I.colors.warning.main,position:"relative",top:"-2px"}),logIconInfo:(0,e.css)({color:I.colors.info.main,position:"relative",top:"-2px"}),logsRowToggleDetails:(0,e.css)({label:"logs-row-toggle-details__level",fontSize:"9px",maxWidth:"15px"}),logsRowLocalTime:(0,e.css)({label:"logs-row__localtime",whiteSpace:"nowrap"}),logsRowLabels:(0,e.css)({label:"logs-row__labels",whiteSpace:"nowrap",maxWidth:"22em","> span":{marginTop:"0.75px"}}),logsRowMessage:(0,e.css)({label:"logs-row__message",whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"anywhere",width:"100%",textAlign:"left"}),copyLogButton:(0,e.css)({padding:I.spacing(0,0,0,.5),height:I.spacing(3),width:I.spacing(3.25),lineHeight:I.spacing(2.5),overflow:"hidden","&:hover":{backgroundColor:J.MV.alpha(I.colors.text.primary,.12)}}),logDetailsContainer:(0,e.css)({label:"logs-row-details-table",border:`1px solid ${I.colors.border.medium}`,padding:I.spacing(0,1,1),borderRadius:I.shape.radius.default,margin:I.spacing(2.5,1,2.5,2),cursor:"default"}),logDetailsTable:(0,e.css)({label:"logs-row-details-table",lineHeight:"18px",width:"100%","td:last-child":{width:"100%"}}),logsDetailsIcon:(0,e.css)({label:"logs-row-details__icon",position:"relative",color:I.v1.palette.gray3,paddingTop:"1px",paddingBottom:"1px",paddingRight:I.spacing(.75)}),logDetailsLabel:(0,e.css)({label:"logs-row-details__label",maxWidth:"30em",padding:I.spacing(0,1),overflowWrap:"break-word"}),logDetailsHeading:(0,e.css)({label:"logs-row-details__heading",fontWeight:I.typography.fontWeightBold,padding:I.spacing(1,0,.5)}),logDetailsValue:(0,e.css)({label:"logs-row-details__row",position:"relative",verticalAlign:"middle",cursor:"default","&:hover":{backgroundColor:H}}),detailsToggle:(0,e.css)({appearance:"none",background:"none",border:"none",padding:0,maxHeight:"19px","&:focus-visible":{boxShadow:"none"},"&:focus":{outline:0},"&:after":{content:'""',inset:0,position:"absolute"}}),topVerticalAlign:(0,e.css)({label:"topVerticalAlign",marginTop:I.spacing(-.9),marginLeft:I.spacing(-.25)}),detailsOpen:(0,e.css)({"&:hover":{backgroundColor:Y.hoverColor(I.colors.background.primary,I)}}),errorLogRow:(0,e.css)({label:"erroredLogRow",color:I.colors.text.secondary}),positionRelative:(0,e.css)({label:"positionRelative",position:"relative"}),rowWithContext:(0,e.css)({label:"rowWithContext",zIndex:1,outline:`9999px solid ${_}`,display:"inherit"}),horizontalScroll:(0,e.css)({label:"horizontalScroll",whiteSpace:"pre"}),contextNewline:(0,e.css)({display:"block",marginLeft:"0px"}),rowMenu:(0,e.css)({label:"rowMenu",display:"flex",flexWrap:"nowrap",flexDirection:"row",alignContent:"flex-end",justifyContent:"space-evenly",alignItems:"center",position:"absolute",top:0,bottom:"auto",background:I.colors.background.primary,boxShadow:I.shadows.z3,padding:I.spacing(.5,1,.5,1),zIndex:100,gap:I.spacing(.5),"& > button":{margin:0}}),logRowMenuCell:(0,e.css)({position:"sticky",zIndex:I.zIndex.dropdown,marginTop:I.spacing(-.125),right:0,"& > span":{transform:"translateX(-100%)"}}),logLine:(0,e.css)({fontFamily:I.typography.fontFamilyMonospace,fontSize:I.typography.bodySmall.fontSize,letterSpacing:I.typography.bodySmall.letterSpacing,textAlign:"left",padding:0,userSelect:"text"}),logsRowLevelDetails:(0,e.css)({label:"logs-row__level_details","&::after":{top:"-3px"}}),logDetails:(0,e.css)({label:"logDetailsDefaultCursor",cursor:"default","&:hover":{backgroundColor:I.colors.background.primary}}),visibleRowMenu:(0,e.css)({label:"visibleRowMenu",aspectRatio:"1/1",zIndex:90}),linkButton:(0,e.css)({label:"linkButton","> button":{paddingTop:I.spacing(.5)}}),hidden:(0,e.css)({label:"hidden",visibility:"hidden"}),unPinButton:(0,e.css)({height:I.spacing(3),lineHeight:I.spacing(2.5)})}})},27789:(tt,we,n)=>{n.d(we,{V:()=>j});var e=n(74848),l=n(22803),P=n(2543),r=n(96540),J=n(16817),Y=n(28105),m=n(739),Le=n(67770),I=n(25229),H=n(92745),_=n(27489),h=n(43173),de=n(63142),E=n(22787),Z=n(45861),q=n(29043),U=n(70159),ne=n(35231),he=n(52763),b=n(37234),C=n(74746),W=n(82212),Q=n(48575),z=n(21285);function N(f){return{buttons:(0,l.css)({display:"flex",gap:f.spacing(1)})}}const g=f=>{const X=(0,de.of)(N),{wrapLines:V,onChangeWrapLines:ie,onScrollCenterClick:je}=f,L=(0,r.useCallback)(d=>{const p=d.currentTarget.checked;(0,_.rR)("grafana_explore_logs_log_context_toggle_lines_clicked",{state:p}),ie(p)},[ie]);return(0,e.jsxs)("div",{className:X.buttons,children:[(0,e.jsx)(z.K,{showLabel:!0,value:V,onChange:L,label:(0,H.t)("logs.log-context-buttons.label-wrap-lines","Wrap lines")}),(0,e.jsx)(Z.$n,{variant:"secondary",onClick:je,children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-context-buttons.center-matched-line",children:"Center matched line"})})]})},B=f=>({modal:(0,l.css)({width:"85vw",[f.breakpoints.down("md")]:{width:"100%"},top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),sticky:(0,l.css)({position:"sticky",zIndex:1,top:"-1px",bottom:"-1px"}),entry:(0,l.css)({"& > td":{padding:f.spacing(1,0,1,0)},background:f.colors.emphasize(f.colors.background.secondary),"& > table":{marginBottom:0},"& .log-row-menu":{marginTop:"-6px"}}),datasourceUi:(0,l.css)({paddingBottom:f.spacing(1.25),display:"flex",alignItems:"center"}),logRowGroups:(0,l.css)({overflow:"auto",maxHeight:"75%",alignSelf:"stretch",display:"inline-block",border:`1px solid ${f.colors.border.weak}`,borderRadius:f.shape.radius.default,"& > table":{minWidth:"100%"}}),flexColumn:(0,l.css)({display:"flex",flexDirection:"column",padding:f.spacing(0,3,3,3)}),flexRow:(0,l.css)({display:"flex",flexDirection:"row",alignItems:"center","& > div:last-child":{marginLeft:"auto"}}),noMarginBottom:(0,l.css)({"& > table":{marginBottom:0}}),hidden:(0,l.css)({display:"none"}),paddingTop:(0,l.css)({paddingTop:f.spacing(1)}),paddingBottom:(0,l.css)({paddingBottom:f.spacing(1)}),link:(0,l.css)({color:f.colors.text.secondary,fontSize:f.typography.bodySmall.fontSize,":hover":{color:f.colors.text.link}}),loadingCell:(0,l.css)({position:"sticky",left:"50%",display:"inline-block",transform:"translateX(-50%)"})}),G=()=>({above:{loadingState:Y.Gu.NotStarted,rows:[]},below:{loadingState:Y.Gu.NotStarted,rows:[]}}),ae=(f,X)=>f==="above"&&X===m.uH.Descending||f==="below"&&X===m.uH.Ascending?Le.ZF.Forward:Le.ZF.Backward,v=(f,X)=>({...f,dataFrame:{...f.dataFrame,refId:`context_${X.above}_${X.below}`}}),F=(f,X)=>f.some(V=>V.entry===X.entry&&V.timeEpochNs===X.timeEpochNs),D=100,j=({row:f,open:X,logsSortOrder:V,timeZone:ie,getLogRowContextUi:je,getRowContextQuery:L,onClose:d,getRowContext:p})=>{const c=(0,r.useRef)(null),T=(0,r.useRef)(null),k=(0,r.useRef)(null),te=(0,r.useRef)(null),fe=(0,r.useRef)(null),le=(0,r.useRef)(null),x=(0,r.useRef)(null),R=(0,r.useRef)({above:0,below:0}),w=(0,he.wA)(),K=(0,de.$j)(),ce=B(K),[y,oe]=(0,r.useState)(!0),[pe,me]=(0,r.useState)(G()),Te=(Re,$e)=>{me(Ve=>{const Ie={...Ve};return Ie[Re]=$e(Ve[Re]),Ie})},Oe=(0,r.useRef)(1),[xe,be]=(0,r.useState)(null),[ye,Be]=(0,r.useState)(q.A.getBool(U.$Z.logContextWrapLogMessage,q.A.getBool(U.$Z.wrapLogMessage,!0))),Ae=(0,r.useCallback)(()=>{const{below:Re,above:$e}=pe,Ve=(0,C.oR)([...Re.rows,f,...$e.rows],m.uH.Ascending),Ie=Ve[0].timeEpochMs;let $=Ve[Ve.length-1].timeEpochMs;Ie===$&&($+=1);const O=(0,I.KQ)(Ie),ge=(0,I.KQ)($);return{from:O,to:ge,raw:{from:O,to:ge}}},[pe,f]),ze=(0,r.useCallback)(async()=>{const Re=L?await L(f):null;be(Re)},[f,L]),Ye=async()=>{await ze(),me(G()),R.current={above:0,below:0},Oe.current+=1},st=async(Re,$e)=>{R.current[Re]+=1;const Ve=$e.at(Re==="above"?0:-1);if(Ve==null)throw new Error("should never happen. the array always contains at least 1 item (the middle row)");(0,_.rR)("grafana_explore_logs_log_context_load_more_called",{datasourceType:Ve.datasourceType,above:R.current.above,below:R.current.below});const Ie=ae(Re,V),$=await p(v(Ve,R.current),{limit:D,direction:Ie}),O=(0,b.HT)($.data).rows;return V===m.uH.Ascending&&O.reverse(),O.filter(ee=>!F($e,ee))};(0,r.useEffect)(()=>{X&&ze()},[ze,X]);const[He,Xe]=(0,r.useState)([]),nt=Re=>{He.indexOf(Re)===-1&&Xe([...He,Re])},at=Re=>{const $e=He.indexOf(Re);$e>-1&&(He.splice($e,1),Xe([...He]))},vt=async Re=>{const{below:$e,above:Ve}=pe;if(pe[Re].loadingState===Y.Gu.Loading)return;Te(Re,O=>({...O,loadingState:Y.Gu.Loading}));const $=Oe.current;try{const O=[...Ve.rows,f,...$e.rows],ge=(await st(Re,O)).map(re=>!re.searchWords||!re.searchWords?.length?{...re,searchWords:f.searchWords}:re),[ee,ue]=(0,P.partition)(ge,re=>re.timeEpochNs>f.timeEpochNs),De=V===m.uH.Ascending?ue:ee,Fe=V===m.uH.Ascending?ee:ue;$===Oe.current&&me(re=>{const Ke=De.length>0?(0,C.oR)([...De,...re.above.rows],V):re.above.rows,Ue=Fe.length>0?(0,C.oR)([...re.below.rows,...Fe],V):re.below.rows;return{above:{rows:Ke,loadingState:Re==="above"?ge.length===0?Y.Gu.Done:Y.Gu.NotStarted:re.above.loadingState},below:{rows:Ue,loadingState:Re==="below"?ge.length===0?Y.Gu.Done:Y.Gu.NotStarted:re.below.loadingState}}})}catch{Te(Re,O=>({rows:O.rows,loadingState:Y.Gu.Error}))}},Ee=async(Re,$e)=>{for(const Ve of Re){if(!Ve.isIntersecting)continue;const Ie=Ve.target;Ie===le.current?vt("above"):Ie===x.current&&vt("below")}};(0,r.useEffect)(()=>{const Re=c.current,$e=le.current,Ve=x.current;if(Re==null)return;const Ie=new IntersectionObserver(Ee,{root:Re});return $e!=null&&Ie.observe($e),Ve!=null&&Ie.observe(Ve),()=>{Ie.disconnect()}});const Qe=(0,r.useCallback)(()=>{k.current?.scrollIntoView({block:"center"}),T.current?.scrollIntoView({block:"center"})},[k,T]);(0,r.useLayoutEffect)(()=>{const Re=c.current;if(Re==null)return;const $e=fe.current,Ve=Re.clientHeight;if(fe.current=Ve,$e!==Ve){Qe();return}if(R.current.above<=1&&R.current.below<=1){Qe();return}const Ie=te.current,$=Re.scrollHeight;if(te.current=$,Ie!=null){const O=Re.scrollTop+($-Ie);Re.scrollTop=O}},[pe.above.rows,Qe]),(0,J.A)(ze,[L,f]);const We=pe.above.loadingState,Ce=pe.below.loadingState;return(0,e.jsxs)(E.a,{isOpen:X,title:(0,H.t)("logs.log-row-context-modal.title-log-context","Log context"),contentClassName:ce.flexColumn,className:ce.modal,onDismiss:d,children:[h.$.featureToggles.logsContextDatasourceUi&&je&&(0,e.jsx)("div",{className:ce.datasourceUi,children:je(f,Ye)}),(0,e.jsx)("div",{className:(0,l.cx)(ce.flexRow,ce.paddingBottom),children:(0,e.jsx)("div",{children:(0,e.jsx)(g,{wrapLines:ye,onChangeWrapLines:Be,onScrollCenterClick:Qe})})}),(0,e.jsx)("div",{ref:c,className:ce.logRowGroups,children:(0,e.jsx)("table",{children:(0,e.jsxs)("tbody",{children:[(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{className:ce.loadingCell,children:[We!==Y.Gu.Done&&We!==Y.Gu.Error&&(0,e.jsx)("div",{ref:le,children:(0,e.jsx)(W.I,{adjective:"newer"})}),We===Y.Gu.Error&&(0,e.jsx)("div",{children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-row-context-modal.error-loading-log-more-logs",children:"Error loading more logs."})}),We===Y.Gu.Done&&(0,e.jsx)("div",{children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-row-context-modal.no-more-logs-available",children:"No more logs available."})})]})}),(0,e.jsx)("tr",{children:(0,e.jsx)("td",{className:ce.noMarginBottom,children:(0,e.jsx)(Q.k,{logRows:pe.above.rows,dedupStrategy:m.fY.none,showLabels:q.A.getBool(U.$Z.showLabels,!1),showTime:q.A.getBool(U.$Z.showTime,!0),wrapLogMessage:ye,prettifyLogMessage:q.A.getBool(U.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:ie,displayedFields:He,onClickShowField:nt,onClickHideField:at,scrollElement:null})})}),(0,e.jsx)("tr",{ref:k}),(0,e.jsx)("tr",{ref:T,className:(0,l.cx)(ce.entry,y?ce.sticky:null),"data-testid":"entry-row",children:(0,e.jsx)("td",{className:ce.noMarginBottom,children:(0,e.jsx)(Q.k,{logRows:[f],dedupStrategy:m.fY.none,showLabels:q.A.getBool(U.$Z.showLabels,!1),showTime:q.A.getBool(U.$Z.showTime,!0),wrapLogMessage:ye,prettifyLogMessage:q.A.getBool(U.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:ie,displayedFields:He,onClickShowField:nt,onClickHideField:at,onUnpinLine:()=>oe(!1),onPinLine:()=>oe(!0),pinnedLogs:y?[f.uid]:void 0,overflowingContent:!0,scrollElement:null})})}),(0,e.jsx)("tr",{children:(0,e.jsx)("td",{children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Q.k,{logRows:pe.below.rows,dedupStrategy:m.fY.none,showLabels:q.A.getBool(U.$Z.showLabels,!1),showTime:q.A.getBool(U.$Z.showTime,!0),wrapLogMessage:ye,prettifyLogMessage:q.A.getBool(U.$Z.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:ie,displayedFields:He,onClickShowField:nt,onClickHideField:at,scrollElement:null})})})}),(0,e.jsx)("tr",{children:(0,e.jsxs)("td",{className:ce.loadingCell,children:[Ce!==Y.Gu.Done&&Ce!==Y.Gu.Error&&(0,e.jsx)("div",{ref:x,children:(0,e.jsx)(W.I,{adjective:"older"})}),Ce===Y.Gu.Error&&(0,e.jsx)("div",{children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-row-context-modal.error-loading-log-more-logs",children:"Error loading more logs."})}),Ce===Y.Gu.Done&&(0,e.jsx)("div",{children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-row-context-modal.no-more-logs-available",children:"No more logs available."})})]})})]})})}),(0,e.jsx)(E.a.ButtonRow,{children:xe?.datasource?.uid&&(0,e.jsx)(Z.$n,{variant:"secondary",onClick:async()=>{let Re=f.uid;f.dataFrame.refId&&(Re=f.uid.replace(f.dataFrame.refId,xe.refId)),w((0,ne.ve)({queries:[xe],range:Ae(),datasourceUid:xe.datasource.uid,panelsState:{logs:{id:Re}}})),d(),(0,_.rR)("grafana_explore_logs_log_context_open_split_view_clicked",{datasourceType:f.datasourceType,logRowUid:f.uid})},children:(0,e.jsx)(H.x6,{i18nKey:"logs.log-row-context-modal.open-in-split-view",children:"Open in split view"})})})]})}},6442:(tt,we,n)=>{n.d(we,{EO:()=>w,l_:()=>K,Bj:()=>R});var e=n(74848),l=n(22803),P=n(33149),r=n(96540),J=n(63142),Y=n(45897),m=n(2543),Le=n(39443),I=n(78012),H=n(92745),_=n(89599),h=n(74746),de=n(13744),E=n(62215),Z=n(89332),q=n(8073),U=n(76319),ne=n(76487),he=n(29457);const b=()=>{const{displayedFields:y,setDisplayedFields:oe}=(0,he.fl)(),pe=(0,r.useCallback)(me=>{if(me.destination==null)return;const Te=[...y],Oe=y[me.source.index];Te.splice(me.source.index,1),Te.splice(me.destination.index,0,Oe),oe?.(Te)},[y,oe]);return(0,e.jsx)("div",{children:(0,e.jsx)(Z.JY,{onDragEnd:pe,children:(0,e.jsx)(Z.gL,{ignoreContainerClipping:!0,droppableId:"displayed-fields",direction:"vertical",children:me=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{ref:me.innerRef,...me.droppableProps,children:y.map((Te,Oe)=>(0,e.jsx)(C,{field:Te,index:Oe},Te))}),me.placeholder]})})})})},C=({field:y,index:oe})=>{const{onClickHideField:pe}=(0,he.fl)(),me=(0,J.of)(W);return(0,e.jsx)(Z.sx,{draggableId:y,index:oe,children:Te=>(0,e.jsx)("div",{ref:Te.innerRef,...Te.draggableProps,...Te.dragHandleProps,children:(0,e.jsxs)(q.Z,{noMargin:!0,className:me.fieldCard,children:[(0,e.jsx)("div",{children:y===ne.I?(0,H.t)("logs.log-line-details.log-line-field","Log line"):y}),pe&&(0,e.jsx)(U.K,{name:"times",onClick:()=>pe(y),tooltip:(0,H.t)("logs.log-line-details.remove-displayed-field","Remove field")})]})})})},W=y=>({fieldCard:(0,l.css)({cursor:"move",padding:y.spacing(1),marginBottom:y.spacing(1),wordBreak:"break-word"})});var Q=n(1906),z=n(99885),N=n(27489),g=n(28134),B=n(47931),G=n(37234),ae=n(29229);const v=({disableActions:y,fields:oe,log:pe,logs:me,search:Te})=>{if(!oe.length)return null;const Oe=(0,J.of)(D),xe=(0,r.useCallback)(()=>me,[me]),be=(0,r.useMemo)(()=>Te?L(oe,Te):oe,[oe,Te]);return be.length===0?(0,H.t)("logs.log-line-details.search.no-results","No results to display."):(0,e.jsx)("div",{className:y?Oe.fieldsTableNoActions:Oe.fieldsTable,children:be.map((ye,Be)=>(0,e.jsx)(j,{disableActions:y,getLogs:xe,fieldIndex:ye.fieldIndex,keys:ye.keys,links:ye.links,log:pe,values:ye.values},`${ye.keys[0]}=${ye.values[0]}-${Be}`))})},F=({fields:y,log:oe,logs:pe,search:me})=>{if(!y.length)return null;const Te=(0,J.of)(D),Oe=(0,r.useCallback)(()=>pe,[pe]),xe=(0,r.useMemo)(()=>me?d(y,me):y,[y,me]);return xe.length===0?(0,H.t)("logs.log-line-details.search.no-results","No results to display."):(0,e.jsx)("div",{className:Te.fieldsTable,children:xe.map((be,ye)=>(0,e.jsx)(j,{getLogs:Oe,isLabel:!0,keys:[be.key],links:be.links,log:oe,values:[be.value]},`${be.key}=${be.value}-${ye}`))})},D=y=>({fieldsTable:(0,l.css)({display:"grid",gap:y.spacing(1),gridTemplateColumns:`${y.spacing(11.5)} minmax(15%, 30%) 1fr`}),fieldsTableNoActions:(0,l.css)({display:"grid",gap:y.spacing(1),gridTemplateColumns:"minmax(15%, 30%) 1fr"})}),j=({disableActions:y=!1,fieldIndex:oe,getLogs:pe,isLabel:me,links:Te,log:Oe,keys:xe,values:be})=>{const[ye,Be]=(0,r.useState)(!1),[Ae,ze]=(0,r.useState)(0),[Ye,st]=(0,r.useState)(null),{app:He,closeDetails:Xe,displayedFields:nt,isLabelFilterActive:at,onClickFilterLabel:vt,onClickFilterOutLabel:Ee,onClickShowField:Qe,onClickHideField:We,onPinLine:Ce,pinLineButtonTooltipTitle:Re}=(0,he.fl)(),$e=(0,J.of)(f),Ve=(0,r.useCallback)(()=>me?(0,h.Tj)(pe(),xe[0]):oe!==void 0?(0,h.s2)(Oe.dataFrame.fields[oe].values):[],[oe,pe,me,xe,Oe.dataFrame.fields]),Ie=(0,r.useCallback)(()=>{const Ue=Ve(),Ze=Ue.reduce((pt,Ge)=>pt+Ge.count,0);(!(0,m.isEqual)(Ye,Ue)||Ae!==Ze)&&(st(Ue),ze(Ze))},[Ae,Ye,Ve]);(0,r.useEffect)(()=>{ye&&Ie()},[ye,Ie]);const $=(0,r.useCallback)(()=>{Qe&&Qe(xe[0]),(0,N.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:Oe.datasourceType,logRowUid:Oe.uid,type:"enable"})},[Qe,xe,Oe.datasourceType,Oe.uid]),O=(0,r.useCallback)(()=>{We&&We(xe[0]),(0,N.rR)("grafana_explore_logs_log_details_replace_line_clicked",{datasourceType:Oe.datasourceType,logRowUid:Oe.uid,type:"disable"})},[We,xe,Oe.datasourceType,Oe.uid]),ge=(0,r.useCallback)(()=>{vt&&vt(xe[0],be[0],(0,G.f8)(Oe)||void 0),(0,N.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:Oe.datasourceType,filterType:"include",logRowUid:Oe.uid})},[vt,xe,be,Oe]),ee=(0,r.useCallback)(()=>{Ee&&Ee(xe[0],be[0],(0,G.f8)(Oe)||void 0),(0,N.rR)("grafana_explore_logs_log_details_filter_clicked",{datasourceType:Oe.datasourceType,filterType:"exclude",logRowUid:Oe.uid})},[Ee,xe,be,Oe]),ue=(0,r.useCallback)(async()=>at?await at(xe[0],be[0],Oe.dataFrame?.refId):!1,[at,xe,be,Oe.dataFrame?.refId]),De=(0,r.useCallback)(()=>{Be(Ue=>!Ue),(0,N.rR)("grafana_explore_logs_log_details_stats_clicked",{dataSourceType:Oe.datasourceType,fieldType:me?"label":"detectedField",type:ye?"close":"open",logRowUid:Oe.uid,app:He})},[He,me,Oe.datasourceType,Oe.uid,ye]),Fe=(0,r.useMemo)(()=>He===Q.Jk.Explore&&Oe.dataFrame?.refId?` in query ${Oe.dataFrame?.refId}`:"",[He,Oe.dataFrame?.refId]),re=xe.length===1,Ke=be.length===1;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:$e.row,children:[!y&&(0,e.jsxs)("div",{className:$e.actions,children:[vt&&(0,e.jsx)(je,{name:"search-plus",onClick:ge,isActive:ue,tooltipSuffix:Fe}),Ee&&(0,e.jsx)(U.K,{name:"search-minus",tooltip:He===Q.Jk.Explore&&Oe.dataFrame?.refId?(0,H.t)("logs.log-line-details.fields.filter-out-query","Filter out value in query {{query}}",{query:Oe.dataFrame?.refId}):(0,H.t)("logs.log-line-details.fields.filter-out","Filter out value"),onClick:ee}),re&&nt.includes(xe[0])&&(0,e.jsx)(U.K,{variant:"primary",tooltip:(0,H.t)("logs.log-line-details.fields.toggle-field-button.hide-this-field","Hide this field"),name:"eye",onClick:O}),re&&!nt.includes(xe[0])&&(0,e.jsx)(U.K,{tooltip:(0,H.t)("logs.log-line-details.fields.toggle-field-button.field-instead-message","Show this field instead of the message"),name:"eye",onClick:$}),(0,e.jsx)(U.K,{variant:ye?"primary":"secondary",name:"signal",tooltip:(0,H.t)("logs.log-line-details.fields.adhoc-statistics","Ad-hoc statistics"),className:"stats-button",disabled:!re,onClick:De})]}),(0,e.jsx)("div",{className:$e.label,children:re?xe[0]:(0,e.jsx)(ie,{values:xe})}),(0,e.jsx)("div",{className:$e.value,children:(0,e.jsxs)("div",{className:$e.valueContainer,children:[Ke?be[0]:(0,e.jsx)(ie,{showCopy:!0,values:be}),Ke&&(0,e.jsx)(X,{value:be[0]})]})})]}),Te?.map((Ue,Ze)=>{if(Ue.onClick&&Ce){const pt=Ue.onClick;Ue.onClick=(Ge,ut)=>{Ce(Oe),pt(Ge,ut),Xe()}}return(0,e.jsx)("div",{className:$e.row,children:(0,e.jsx)("div",{className:y?$e.linkNoActions:$e.link,children:(0,e.jsx)(g.R,{buttonProps:{tooltip:typeof Re=="object"&&Ue.onClick?Re:void 0,variant:"secondary",fill:"outline",...Ue.icon&&{icon:Ue.icon}},link:Ue})})},`${Ue.title}-${Ze}`)}),ye&&Ye&&(0,e.jsxs)("div",{className:$e.row,children:[(0,e.jsx)("div",{}),(0,e.jsx)("div",{className:y?void 0:$e.statsColumn,children:(0,e.jsx)(ae.y,{className:$e.stats,stats:Ye,label:xe[0],value:be[0],rowCount:Ae,isLabel:me})})]})]})},f=y=>({row:(0,l.css)({display:"contents"}),actions:(0,l.css)({whiteSpace:"nowrap"}),label:(0,l.css)({overflowWrap:"break-word",wordBreak:"break-word"}),value:(0,l.css)({overflowWrap:"break-word",wordBreak:"break-word",button:{visibility:"hidden"},"&:hover":{button:{visibility:"visible"}}}),link:(0,l.css)({gridColumn:"span 3"}),linkNoActions:(0,l.css)({gridColumn:"span 2"}),stats:(0,l.css)({paddingRight:y.spacing(1),wordBreak:"break-all",width:"100%",maxWidth:"50vh"}),statsColumn:(0,l.css)({gridColumn:"span 2"}),valueContainer:(0,l.css)({display:"flex",alignItems:"center",lineHeight:y.typography.body.lineHeight,whiteSpace:"pre-wrap",wordBreak:"break-all"})}),X=({value:y})=>{const oe=(0,J.of)(V);return(0,e.jsx)("div",{className:oe.button,children:(0,e.jsx)(B.b,{getText:()=>y,title:(0,H.t)("logs.log-line-details.fields.copy-value-to-clipboard","Copy value to clipboard"),fill:"text",variant:"secondary",icon:"copy",size:"md"})})},V=y=>({button:(0,l.css)({"& > button":{color:y.colors.text.secondary,padding:0,justifyContent:"center",borderRadius:y.shape.radius.circle,height:y.spacing(y.components.height.sm),width:y.spacing(y.components.height.sm),svg:{margin:0},"span > div":{top:"-5px","& button":{color:y.colors.success.main}}}})}),ie=({showCopy:y,values:oe=[]})=>oe.every(pe=>pe==="")?null:(0,e.jsx)("table",{children:(0,e.jsx)("tbody",{children:oe.map((pe,me)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:pe}),(0,e.jsx)("td",{children:y&&pe!==""&&(0,e.jsx)(X,{value:pe})})]},`${pe}-${me}`))})}),je=({isActive:y,tooltipSuffix:oe,...pe})=>{const[me,Te]=(0,r.useState)(!1),Oe=me?"Remove filter":"Filter for value";return(0,r.useEffect)(()=>{y().then(Te)},[y]),(0,e.jsx)(U.K,{...pe,variant:me?"primary":void 0,tooltip:Oe+oe})};function L(y,oe){const pe=y.map(be=>be.keys.join(" ")),me=(0,z.X)(pe,oe),Te=y.map(be=>be.values.join(" ")),Oe=(0,z.X)(Te,oe),xe=me.map(be=>y[be]);return Oe.forEach(be=>{xe.includes(y[be])||xe.push(y[be])}),xe}function d(y,oe){const pe=y.map(be=>be.key),me=(0,z.X)(pe,oe),Te=y.map(be=>be.value),Oe=(0,z.X)(Te,oe),xe=me.map(be=>y[be]);return Oe.forEach(be=>{xe.includes(y[be])||xe.push(y[be])}),xe}var p=n(6773),c=n(63527);const T=({log:y,search:oe,onSearch:pe})=>{const{closeDetails:me,detailsMode:Te,displayedFields:Oe,getRowContextQuery:xe,logOptionsStorageKey:be,logSupportsContext:ye,setDetailsMode:Be,onClickHideField:Ae,onClickShowField:ze,onOpenContext:Ye,onPermalinkClick:st,onPinLine:He,onUnpinLine:Xe,wrapLogMessage:nt}=(0,he.fl)(),at=(0,he.u0)(y),vt=(0,J.of)(k,Te,nt),Ee=(0,r.useRef)(null),Qe=(0,r.useRef)(null),We=(0,r.useCallback)(()=>{(0,h.Dk)(y.entry,Ee)},[y.entry]),Ce=(0,r.useCallback)(()=>{st?.(y)},[y,st]),Re=(0,r.useCallback)(()=>{at?Xe?.(y):He?.(y)},[y,He,Xe,at]),$e=(0,r.useMemo)(()=>ye?ye(y):!1,[y,ye]),Ve=(0,r.useCallback)(async De=>{(0,h.R)(De,y,xe,Fe=>Ye?.(Fe,()=>{}))},[Ye,xe,y]),Ie=Ae&&ze&&Oe.length>0,$=Oe.includes(ne.I),O=(0,r.useCallback)(()=>{const De=Te==="inline"?"sidebar":"inline";be&&I.M.set(`${be}.detailsMode`,De),Be(De)},[Te,be,Be]),ge=(0,r.useCallback)(()=>{$?Ae?.(ne.I):ze?.(ne.I)},[$,Ae,ze]),ee=(0,r.useMemo)(()=>(0,e.jsx)(U.K,{name:"times",size:"sm",onClick:()=>{pe(""),Qe.current&&(Qe.current.value="")},tooltip:(0,H.t)("logs.log-line-details.clear-search","Clear")}),[pe]),ue=(0,r.useCallback)(De=>{pe(De.target.value)},[pe]);return(0,e.jsxs)("div",{className:vt.header,ref:Ee,children:[(0,e.jsx)(c.p,{onChange:ue,placeholder:(0,H.t)("logs.log-line-details.search-placeholder","Search field names and values"),ref:Qe,suffix:oe!==""?ee:void 0}),Ie&&(0,e.jsx)(U.K,{tooltip:$?(0,H.t)("logs.log-line-details.hide-log-line","Hide log line"):(0,H.t)("logs.log-line-details.show-log-line","Show log line"),tooltipPlacement:"top",size:"md",name:"eye",onClick:ge,tabIndex:0,variant:$?"primary":void 0}),(0,e.jsxs)("div",{className:vt.icons,children:[(0,e.jsx)(U.K,{tooltip:(0,H.t)("logs.log-line-details.copy-to-clipboard","Copy to clipboard"),tooltipPlacement:"top",size:"md",name:"copy",onClick:We,tabIndex:0}),st&&y.rowId!==void 0&&y.uid&&(0,e.jsx)(U.K,{tooltip:(0,H.t)("logs.log-line-details.copy-shortlink","Copy shortlink"),tooltipPlacement:"top",size:"md",name:"share-alt",onClick:Ce,tabIndex:0}),at&&Xe&&(0,e.jsx)(U.K,{size:"md",name:"gf-pin",onClick:Re,tooltip:(0,H.t)("logs.log-line-details.unpin-line","Unpin log"),tooltipPlacement:"top",tabIndex:0,variant:"primary"}),!at&&He&&(0,e.jsx)(U.K,{size:"md",name:"gf-pin",onClick:Re,tooltip:(0,H.t)("logs.log-line-details.pin-line","Pin log"),tooltipPlacement:"top",tabIndex:0}),$e&&(0,e.jsx)(U.K,{size:"md",name:"gf-show-context",onClick:Ve,tooltip:(0,H.t)("logs.log-line-details.show-context","Show context"),tooltipPlacement:"top",tabIndex:0}),(0,e.jsx)(U.K,{name:Te==="inline"?"columns":"gf-layout-simple",tooltip:Te==="inline"?(0,H.t)("logs.log-line-details.sidebar-mode","Anchor to the right"):(0,H.t)("logs.log-line-details.inline-mode","Display inline"),onClick:O}),(0,e.jsx)(U.K,{name:"times","aria-label":(0,H.t)("logs.log-line-details.close","Close log details"),onClick:me})]})]})},k=(y,oe,pe)=>({container:(0,l.css)({overflow:"auto",height:"100%"}),scrollContainer:(0,l.css)({overflow:"auto",height:"100%"}),header:(0,l.css)({alignItems:"center",background:y.colors.background.canvas,display:"flex",flexDirection:!pe&&oe==="inline"?"row-reverse":"row",gap:y.spacing(.75),zIndex:y.zIndex.navbarFixed,height:y.spacing(5.5),marginBottom:y.spacing(1),padding:y.spacing(.5,1),position:"sticky",top:0}),icons:(0,l.css)({display:"flex",gap:y.spacing(.75)}),copyLogButton:(0,l.css)({padding:0,height:y.spacing(4),width:y.spacing(2.5),overflow:"hidden","&:hover":{backgroundColor:p.MV.alpha(y.colors.text.primary,.12)}}),componentWrapper:(0,l.css)({padding:y.spacing(0,1,1,1)})}),te=({log:y,logs:oe})=>{const{displayedFields:pe,logOptionsStorageKey:me,setDisplayedFields:Te}=(0,he.fl)(),[Oe,xe]=(0,r.useState)(""),be=(0,r.useRef)(""),ye=(0,J.of)(le),Be=(0,de.r)(y),Ae=(0,r.useMemo)(()=>{const Ce=y.fields.filter(Ie=>Ie.links?.length),Re=Ce.filter(Ie=>Ie.fieldIndex!==y.entryFieldIndex).sort(),$e=Ce.filter(Ie=>Ie.fieldIndex===y.entryFieldIndex).sort(),Ve=(0,E.qE)($e);return{links:Re,linksFromVariableMap:Ve}},[y.entryFieldIndex,y.fields]),ze=y.dataFrame.meta?.type===Le.m.LogLines?[]:y.fields.filter(Ce=>Ce.links?.length===0&&Ce.fieldIndex!==y.entryFieldIndex).sort(),Ye=(0,r.useMemo)(()=>Object.keys(y.labels).sort().map(Ce=>({key:Ce,value:y.labels[Ce],link:Be?.[Ce]})),[Be,y.labels]),st=(0,r.useMemo)(()=>(0,m.groupBy)(Ye,Ce=>(0,h.dO)(Ce.key,y,!0)??""),[Ye,y]),He=(0,r.useMemo)(()=>Object.keys(st),[st]),Xe=me?I.M.getBool(`${me}.log-details.logLineOpen`,!1):!1,nt=me?I.M.getBool(`${me}.log-details.linksOpen`,!0):!0,at=me?I.M.getBool(`${me}.log-details.fieldsOpen`,!0):!0,vt=me?I.M.getBool(`${me}.log-details.displayedFieldsOpen`,!1):!1,Ee=(0,r.useCallback)((Ce,Re)=>{I.M.set(`${me}.log-details.${Ce}`,Re)},[me]),Qe=(0,r.useCallback)(Ce=>{be.current=Ce,(0,r.startTransition)(()=>{xe(be.current)})},[]),We=!Ae.links.length&&!Ae.linksFromVariableMap.length&&!He.length&&!ze.length;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(T,{log:y,search:Oe,onSearch:Qe}),(0,e.jsxs)("div",{className:ye.componentWrapper,children:[(0,e.jsx)(_.a,{className:ye.collapsable,label:(0,H.t)("logs.log-line-details.log-line-section","Log line"),collapsible:!0,isOpen:Xe,onToggle:Ce=>Ee("logLineOpen",Ce),children:(0,e.jsx)("div",{className:ye.logLineWrapper,children:y.raw})}),pe.length>0&&Te&&(0,e.jsx)(_.a,{label:(0,H.t)("logs.log-line-details.displayed-fields-section","Organize displayed fields"),collapsible:!0,isOpen:vt,onToggle:Ce=>Ee("displayedFieldsOpen",Ce),children:(0,e.jsx)(b,{})}),Ae.links.length>0&&(0,e.jsxs)(_.a,{className:ye.collapsable,label:(0,H.t)("logs.log-line-details.links-section","Links"),collapsible:!0,isOpen:nt,onToggle:Ce=>Ee("linksOpen",Ce),children:[(0,e.jsx)(v,{log:y,logs:oe,fields:Ae.links,search:Oe}),(0,e.jsx)(v,{disableActions:!0,log:y,logs:oe,fields:Ae.linksFromVariableMap,search:Oe})]}),He.map(Ce=>Ce===""?(0,e.jsxs)(_.a,{className:ye.collapsable,label:(0,H.t)("logs.log-line-details.fields-section","Fields"),collapsible:!0,isOpen:at,onToggle:Re=>Ee("fieldsOpen",Re),children:[(0,e.jsx)(F,{log:y,logs:oe,fields:st[Ce],search:Oe}),(0,e.jsx)(v,{log:y,logs:oe,fields:ze,search:Oe})]},"fields"):(0,e.jsx)(_.a,{className:ye.collapsable,label:Ce,collapsible:!0,isOpen:I.M.getBool(`${me}.log-details.${fe(Ce)}`,!0),onToggle:Re=>Ee(fe(Ce),Re),children:(0,e.jsx)(F,{log:y,logs:oe,fields:st[Ce],search:Oe})},Ce)),!He.length&&ze.length>0&&(0,e.jsx)(_.a,{className:ye.collapsable,label:(0,H.t)("logs.log-line-details.fields-section","Fields"),collapsible:!0,isOpen:at,onToggle:Ce=>Ee("fieldsOpen",Ce),children:(0,e.jsx)(v,{log:y,logs:oe,fields:ze,search:Oe})},"fields"),We&&(0,e.jsx)(H.x6,{i18nKey:"logs.log-line-details.no-details",children:"No fields to display."})]})]})};function fe(y){return`${(0,m.camelCase)(y)}Open`}const le=y=>({collapsable:(0,l.css)({"&:last-of-type":{marginBottom:0}}),componentWrapper:(0,l.css)({padding:y.spacing(0,1,1,1)}),logLineWrapper:(0,l.css)({maxHeight:"50vh",overflow:"auto"})});var x=n(55439);const R=({containerElement:y,focusLogLine:oe,logs:pe,onResize:me})=>{const{detailsWidth:Te,setDetailsWidth:Oe,showDetails:xe}=(0,he.fl)(),be=(0,J.of)(ce,"sidebar"),ye=(0,J.of)(Y.l),Be=(0,r.useRef)(null);(0,r.useEffect)(()=>{oe(xe[0])},[]);const Ae=(0,r.useCallback)(()=>{Be.current&&Oe(Be.current.clientWidth),me()},[me,Oe]),ze=y.clientWidth-x.Of;return xe.length?(0,e.jsx)(P.c,{onResize:Ae,handleClasses:{left:ye.dragHandleVertical},defaultSize:{width:Te,height:y.clientHeight},size:{width:Te,height:y.clientHeight},enable:{left:!0},minWidth:40,maxWidth:ze,children:(0,e.jsx)("div",{className:be.container,ref:Be,children:(0,e.jsx)("div",{className:be.scrollContainer,children:(0,e.jsx)(te,{log:xe[0],logs:pe})})})}):null},w=({logs:y})=>{const{showDetails:oe}=(0,he.fl)(),pe=(0,J.of)(ce,"inline");return oe.length?(0,e.jsx)("div",{className:`${pe.inlineWrapper} log-line-inline-details`,children:(0,e.jsx)("div",{className:pe.container,children:(0,e.jsx)("div",{className:pe.scrollContainer,children:(0,e.jsx)(te,{log:oe[0],logs:y})})})}):null},K=35,ce=(y,oe)=>({inlineWrapper:(0,l.css)({gridColumn:"1 / -1",height:`${K}vh`,paddingBottom:y.spacing(.5),marginRight:1}),container:(0,l.css)({overflow:"auto",height:"100%",boxShadow:y.shadows.z1,border:`1px solid ${y.colors.border.medium}`,borderRight:oe==="sidebar"?"none":void 0}),scrollContainer:(0,l.css)({overflow:"auto",height:"100%"}),componentWrapper:(0,l.css)({padding:y.spacing(0,1,1,1)})})},49356:(tt,we,n)=>{n.d(we,{Z:()=>Re});var e=n(74848),l=n(22803),P=n(2543),r=n(96540),J=n(97222),Y=n(78012),m=n(19379),Le=n(1906),I=n(739),H=n(92745),_=n(63142),h=n(71599),de=n(30703),E=n(78242),Z=n(84596),q=n(27489),U=n(43173),ne=n(68079),he=n(17896),b=n(23257),C=n.n(b),W=n(84140),Q=n(38388),z=n(45967),N=n(45861),g=n(76487),B=n(25461),G=n(6442),ae=n(87063),v=n(88559),F=n(76319),D=n(74746),j=n(29457);const f=({log:$,styles:O})=>{const{enableLogDetails:ge,detailsDisplayed:ee,getRowContextQuery:ue,onOpenContext:De,onPermalinkClick:Fe,onPinLine:re,onUnpinLine:Ke,logLineMenuCustomItems:Ue=[],logSupportsContext:Ze,toggleDetails:pt}=(0,j.fl)(),Ge=(0,j.u0)($),ut=(0,r.useRef)(null),ct=(0,r.useCallback)(()=>{(0,D.Dk)($.entry,ut)},[$.entry]),ot=(0,r.useCallback)(()=>{Fe?.($)},[$,Fe]),Je=(0,r.useMemo)(()=>Ze?Ze($):!1,[$,Ze]),Ot=(0,r.useCallback)(async lt=>{(0,D.R)(lt,$,ue,Et=>De?.(Et,()=>{}))},[De,ue,$]),ft=(0,r.useCallback)(()=>{pt($)},[$,pt]),ht=(0,r.useCallback)(()=>{Ge?Ke?.($):re?.($)},[$,re,Ke,Ge]),Lt=(0,r.useCallback)(()=>(0,e.jsxs)(ae.W,{ref:ut,children:[ge&&(0,e.jsx)(ae.W.Item,{onClick:ft,label:ee($)?(0,H.t)("logs.log-line-menu.show-details","Hide log details"):(0,H.t)("logs.log-line-menu.hide-details","Show log details")}),Je&&(0,e.jsx)(ae.W.Item,{onClick:Ot,label:(0,H.t)("logs.log-line-menu.show-context","Show context")}),!Ge&&re&&(0,e.jsx)(ae.W.Item,{onClick:ht,label:(0,H.t)("logs.log-line-menu.pin-to-outline","Pin log")}),Ge&&Ke&&(0,e.jsx)(ae.W.Item,{onClick:ht,label:(0,H.t)("logs.log-line-menu.unpin-from-outline","Unpin log")}),(0,e.jsx)(ae.W.Divider,{}),(0,e.jsx)(ae.W.Item,{onClick:ct,label:(0,H.t)("logs.log-line-menu.copy-log","Copy log line")}),Fe&&$.rowId!==void 0&&$.uid&&(0,e.jsx)(ae.W.Item,{onClick:ot,label:(0,H.t)("logs.log-line-menu.copy-link","Copy link to log line")}),Ue.map((lt,Et)=>X(lt)?(0,e.jsx)(ae.W.Divider,{},Et):V(lt)?(0,e.jsx)(ae.W.Item,{onClick:()=>lt.onClick($),label:lt.label},Et):null)]}),[ot,ct,ee,ge,$,Ue,Fe,re,Ke,Ge,Je,Ot,ft,ht]);return(0,e.jsx)(v.m,{overlay:Lt,placement:"bottom-start",children:(0,e.jsx)(F.K,{className:O.menuIcon,name:"ellipsis-v","aria-label":(0,H.t)("logs.log-line-menu.icon-label","Log menu")})})};function X($){return"divider"in $&&$.divider}function V($){return"onClick"in $&&"label"in $}var ie=n(67897),je=n(55439);const L=({displayedFields:$,index:O,log:ge,style:ee,styles:ue,onClick:De,onOverflow:Fe,showTime:re,variant:Ke,virtualization:Ue,wrapLogMessage:Ze})=>(0,e.jsx)("div",{style:Ze?ee:{...ee,width:"max-content",minWidth:"100%"},children:(0,e.jsx)(d,{displayedFields:$,height:ee.height,index:O,log:ge,styles:ue,onClick:De,onOverflow:Fe,showTime:re,variant:Ke,virtualization:Ue,wrapLogMessage:Ze})}),d=(0,r.memo)(({displayedFields:$,height:O,index:ge,log:ee,styles:ue,onClick:De,onOverflow:Fe,showTime:re,variant:Ke,virtualization:Ue,wrapLogMessage:Ze})=>{const{detailsDisplayed:pt,detailsMode:Ge,dedupStrategy:ut,enableLogDetails:ct,fontSize:ot,hasLogsWithErrors:Je,hasSampledLogs:Ot,onLogLineHover:ft}=(0,j.fl)(),[ht,Lt]=(0,r.useState)(Ze&&ee.collapsed!==void 0?ee.collapsed:void 0),lt=(0,r.useRef)(null),Et=(0,j.u0)(ee),xt=(0,j.cQ)(ee);(0,r.useEffect)(()=>{if(!Fe||!lt.current||!Ue||!O)return;const yt=typeof O=="number"?O:void 0,At=(0,je.SC)(Ue,lt.current,yt,ee.collapsed);At&&Fe(ge,ee.uid,At)}),(0,r.useEffect)(()=>{Ze?(ht===void 0&&ee.collapsed!==void 0||ht!==void 0&&ee.collapsed===void 0)&&Lt(ee.collapsed):Lt(void 0)},[ht,ee.collapsed,Ze]);const wt=(0,r.useCallback)(()=>ft?.(ee),[ee,ft]),qe=(0,r.useCallback)(()=>{const yt=!ht;Lt(yt),ee.setCollapsedState(yt),Fe?.(ge,ee.uid)},[ht,ge,ee,Fe]),It=(0,r.useCallback)(yt=>{De(yt,ee)},[ee,De]),Tt=pt(ee);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:`${ue.logLine} ${Ke??""} ${Et?ue.pinnedLogLine:""} ${xt?ue.permalinkedLogLine:""} ${Tt?ue.detailsDisplayed:""} ${ot==="small"?ue.fontSizeSmall:""}`,ref:Fe?lt:void 0,onMouseEnter:wt,onFocus:wt,children:[(0,e.jsx)(f,{styles:ue,log:ee}),ut!==I.fY.none&&(0,e.jsx)("div",{className:`${ue.duplicates}`,children:ee.duplicates&&ee.duplicates>0?`${ee.duplicates+1}x`:null}),Je&&(0,e.jsx)("div",{className:`${ue.hasError}`,children:ee.hasError&&(0,e.jsx)(z.m,{content:(0,H.t)("logs.log-line.tooltip-error","Error: {{errorMessage}}",{errorMessage:ee.errorMessage}),placement:"right",theme:"error",children:(0,e.jsx)(de.I,{className:ue.logIconError,name:"exclamation-triangle","aria-label":(0,H.t)("logs.log-line.has-error","Has errors"),size:"xs"})})}),Ot&&(0,e.jsx)("div",{className:`${ue.isSampled}`,children:ee.isSampled&&(0,e.jsx)(z.m,{content:ee.sampledMessage??"",placement:"right",theme:"info",children:(0,e.jsx)(de.I,{className:ue.logIconInfo,name:"info-circle",size:"xs","aria-label":(0,H.t)("logs.log-line.is-sampled","Is sampled")})})}),(0,e.jsx)("div",{className:`${ue.fieldsWrapper} ${Tt?ue.detailsDisplayed:""} ${Ze?ue.wrappedLogLine:`${ue.unwrappedLogLine} unwrapped-log-line`} ${ht===!0?ue.collapsedLogLine:""} ${ct?ue.clickable:""}`,style:ht&&Ue?{maxHeight:`${Ue.getTruncationLineCount()*Ue.getLineHeight()}px`}:void 0,onClick:It,children:(0,e.jsx)(p,{displayedFields:$,log:ee,showTime:re,styles:ue,wrapLogMessage:Ze})})]}),ht===!0&&(0,e.jsx)("div",{className:ue.expandCollapseControl,children:(0,e.jsx)(N.$n,{variant:"primary",fill:"text",size:"sm",className:ue.expandCollapseControlButton,onClick:qe,children:(0,H.t)("logs.log-line.show-more","show more")})}),ht===!1&&(0,e.jsx)("div",{className:ue.expandCollapseControl,children:(0,e.jsx)(N.$n,{variant:"primary",fill:"text",size:"sm",className:ue.expandCollapseControlButton,onClick:qe,children:(0,H.t)("logs.log-line.show-less","show less")})}),Ge==="inline"&&Tt&&(0,e.jsx)(G.EO,{logs:[]})]})});d.displayName="LogLineComponent";const p=(0,r.memo)(({displayedFields:$,log:O,showTime:ge,styles:ee,wrapLogMessage:ue})=>(0,e.jsxs)(e.Fragment,{children:[ge&&(0,e.jsx)("span",{className:`${ee.timestamp} level-${O.logLevel} field`,children:O.timestamp}),(O.displayLevel||!ue)&&(0,e.jsx)("span",{className:`${ee.level} level-${O.logLevel} field`,children:O.displayLevel}),$.length>0?(0,e.jsx)(c,{displayedFields:$,log:O,styles:ee}):(0,e.jsx)(T,{log:O,styles:ee})]}));p.displayName="Log";const c=({displayedFields:$,log:O,styles:ge})=>{const{matchingUids:ee,search:ue}=(0,ie.fV)(),De=(0,r.useMemo)(()=>{const Fe=O.searchWords&&O.searchWords[0]?O.searchWords.slice():[];if(ue&&ee?.includes(O.uid)&&Fe.push(ue),!!Fe.length)return Fe},[O.searchWords,O.uid,ee,ue]);return $.map(Fe=>Fe===g.I?(0,e.jsx)(T,{log:O,styles:ge},Fe):(0,e.jsx)("span",{className:"field",title:Fe,children:De?(0,e.jsx)(C(),{textToHighlight:O.getDisplayedFieldValue(Fe),searchWords:De,findChunks:Q.Oq,highlightClassName:ge.matchHighLight}):O.getDisplayedFieldValue(Fe)},Fe))},T=({log:$,styles:O})=>{const{syntaxHighlighting:ge}=(0,j.fl)(),{matchingUids:ee,search:ue}=(0,ie.fV)(),De=(0,r.useMemo)(()=>{const Fe=$.searchWords&&$.searchWords[0]?$.searchWords.slice():[];if(ue&&ee?.includes($.uid)&&Fe.push(ue),!!Fe.length)return{searchWords:Fe,highlightClassName:O.matchHighLight}},[$.searchWords,$.uid,ee,ue,O.matchHighLight]);return $.hasAnsi?(0,e.jsx)("span",{className:"field no-highlighting",children:(0,e.jsx)(B.$,{value:$.body,highlight:De})}):ge?(0,e.jsx)("span",{className:"field log-syntax-highlight",dangerouslySetInnerHTML:{__html:$.highlightedBody}}):De?(0,e.jsx)(C(),{textToHighlight:$.body,searchWords:De.searchWords,findChunks:Q.Oq,highlightClassName:O.matchHighLight}):(0,e.jsx)("span",{className:"field no-highlighting",children:$.body})};function k($,O){const ge=$.map(ue=>ue.width).join("px "),ee=O.length>0?"":" 1fr";return`${ge}px${ee}`}const te=($,O)=>{const ge={critical:"#B877D9",error:$.colors.error.text,warning:"#FBAD37",debug:"#6E9FFF",trace:"#6ed0e0",info:"#6CCF8E",metadata:$.colors.text.primary,parsedField:$.colors.text.primary},ee=(0,W.A)($.colors.background.canvas).darken(4).toRgbString();return{logLine:(0,l.css)({color:(0,W.A)($.colors.text.secondary).setAlpha(.75).toRgbString(),display:"flex",gap:$.spacing(.5),flexDirection:"row",fontFamily:$.typography.fontFamilyMonospace,fontSize:$.typography.fontSize,lineHeight:$.typography.body.lineHeight,wordBreak:"break-all","&:hover":{background:ee},"&.infinite-scroll":{"&::before":{borderTop:`solid 1px ${$.colors.border.strong}`,content:'""',height:0,left:0,position:"absolute",top:-3,width:"100%"}},"& .log-syntax-highlight":{".log-token-string":{color:(0,W.A)($.colors.text.secondary).setAlpha(.75).toRgbString()},".log-token-duration":{color:$.colors.success.text},".log-token-size":{color:$.colors.success.text},".log-token-uuid":{color:$.colors.success.text},".log-token-key":{color:ge.parsedField,opacity:.9,fontWeight:$.typography.fontWeightMedium},".log-token-json-key":{color:ge.parsedField,opacity:.9,fontWeight:$.typography.fontWeightMedium},".log-token-label":{color:ge.metadata,fontWeight:$.typography.fontWeightBold},".log-token-method":{color:$.colors.info.shade},".log-search-match":{color:$.components.textHighlight.text,backgroundColor:$.components.textHighlight.background}},"& .no-highlighting":{color:$.colors.text.primary}}),matchHighLight:(0,l.css)({color:$.components.textHighlight.text,backgroundColor:$.components.textHighlight.background}),fontSizeSmall:(0,l.css)({fontSize:$.typography.bodySmall.fontSize,lineHeight:$.typography.bodySmall.lineHeight}),detailsDisplayed:(0,l.css)({background:ee}),pinnedLogLine:(0,l.css)({backgroundColor:(0,W.A)($.colors.info.transparent).setAlpha(.25).toString()}),permalinkedLogLine:(0,l.css)({backgroundColor:(0,W.A)($.colors.info.transparent).setAlpha(.25).toString()}),menuIcon:(0,l.css)({height:O?.getLineHeight()??je.Dj,margin:0,padding:$.spacing(0,0,0,.5)}),logLineMessage:(0,l.css)({fontFamily:$.typography.fontFamily,justifyContent:"center"}),timestamp:(0,l.css)({color:$.colors.text.disabled,display:"inline-block"}),duplicates:(0,l.css)({flexShrink:0,textAlign:"center",width:$.spacing(4.5)}),hasError:(0,l.css)({flexShrink:0,width:$.spacing(2),"& svg":{position:"relative",top:-1}}),isSampled:(0,l.css)({flexShrink:0,width:$.spacing(2),"& svg":{position:"relative",top:-1}}),logIconError:(0,l.css)({color:$.colors.warning.main}),logIconInfo:(0,l.css)({color:$.colors.info.main}),level:(0,l.css)({color:$.colors.text.secondary,fontWeight:$.typography.fontWeightBold,textTransform:"uppercase",display:"inline-block","&.level-critical":{color:ge.critical},"&.level-error":{color:ge.error},"&.level-warning":{color:ge.warning},"&.level-info":{color:ge.info},"&.level-debug":{color:ge.debug}}),loadMoreButton:(0,l.css)({background:"transparent",border:"none",display:"inline"}),overflows:(0,l.css)({outline:"solid 1px red"}),clickable:(0,l.css)({cursor:"pointer"}),unwrappedLogLine:(0,l.css)({display:"grid",gridColumnGap:$.spacing(je.yb),whiteSpace:"pre",paddingBottom:$.spacing(.75)}),wrappedLogLine:(0,l.css)({alignSelf:"flex-start",paddingBottom:$.spacing(.75),whiteSpace:"pre-wrap","& .field":{marginRight:$.spacing(je.yb)},"& .field:last-child":{marginRight:0}}),fieldsWrapper:(0,l.css)({"&:hover":{background:ee}}),collapsedLogLine:(0,l.css)({overflow:"hidden"}),expandCollapseControl:(0,l.css)({display:"flex",justifyContent:"center"}),expandCollapseControlButton:(0,l.css)({fontWeight:$.typography.fontWeightLight,height:O?.getLineHeight()??je.Dj,margin:0})}},fe=({children:$,onClick:O,style:ge,styles:ee})=>(0,e.jsx)("div",{style:ge,className:`${ee.logLine} ${ee.logLineMessage}`,children:O?(0,e.jsx)("button",{className:ee.loadMoreButton,onClick:O,children:$}):$}),le=({children:$,displayedFields:O,handleOverflow:ge,loadMore:ee,logs:ue,onClick:De,scrollElement:Fe,setInitialScrollPosition:re,showTime:Ke,sortOrder:Ue,timeRange:Ze,timeZone:pt,virtualization:Ge,wrapLogMessage:ut})=>{const[ct,ot]=(0,r.useState)("idle"),[Je,Ot]=(0,r.useState)(!1),ft=(0,Z.A)(ue),ht=(0,Z.A)(Ue),Lt=(0,r.useRef)(Fe?.scrollTop||0),lt=(0,r.useRef)(null),Et=(0,r.useRef)(0),xt=(0,r.useRef)([]),wt=(0,_.of)(te,Ge);(0,r.useEffect)(()=>{!ft||ft===ue||(ct==="loading"?ot(ue.length===ft.length?"out-of-bounds":"idle"):(xt.current=[],Ot(!0)))},[ct,ue,ft]),(0,r.useEffect)(()=>{ht&&ht!==Ue&&ot("idle")},[ht,Ue]),(0,r.useEffect)(()=>{Je&&(re(),Ot(!1))},[Je,re]);const qe=(0,r.useCallback)(()=>{const gt=(0,he.rg)((0,he.K6)(ue),Ze,pt,Ue);if(!gt){ot("out-of-bounds");return}xt.current.push(ue[ue.length-1].uid),ot("loading"),ee?.(gt),(0,q.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:Ue})},[ee,ue,Ue,Ze,pt]);(0,r.useEffect)(()=>{if(!Fe||!ee||!U.$.featureToggles.logsInfiniteScrolling)return;function gt($t){if(!Fe||!ee||!ue.length||ct!=="pre-scroll")return;const Nt=(0,he.V7)($t,lt.current,Et,Fe,Lt.current);lt.current=$t,Lt.current=Fe.scrollTop,Nt===he.Dh.Bottom&&qe()}return Fe.addEventListener("scroll",gt),Fe.addEventListener("wheel",gt),()=>{Fe.removeEventListener("scroll",gt),Fe.removeEventListener("wheel",gt)}},[ct,ee,ue.length,qe,Fe]);const It=(0,r.useCallback)(({index:gt,style:$t})=>!ue[gt]&&ct!=="idle"?(0,e.jsx)(fe,{style:$t,styles:wt,onClick:ct==="pre-scroll"?qe:void 0,children:x(ct,Ue)}):(0,e.jsx)(L,{displayedFields:O,index:gt,log:ue[gt],onClick:De,showTime:Ke,style:$t,styles:wt,variant:R(ue,gt,xt.current),virtualization:Ge,wrapLogMessage:ut,onOverflow:ge}),[O,ge,ct,ue,De,qe,Ke,Ue,wt,Ge,ut]),Tt=(0,r.useCallback)(gt=>{if(!Fe||ct==="loading"||ct==="out-of-bounds"||Fe.scrollHeight<=Fe.clientHeight)return;const $t=ue.length-1,Nt=ue.length-2;gt.visibleStopIndex>=$t?ot("pre-scroll"):gt.visibleStartIndex<Nt&&ot("idle")},[ct,ue.length,Fe]),yt=(0,r.useCallback)(gt=>ue[gt]?ue[gt].uid:gt.toString(),[ue]),At=ue.length&&ee&&ct!=="idle"?ue.length+1:ue.length;return(0,e.jsx)(e.Fragment,{children:$({getItemKey:yt,itemCount:At,onItemsRendered:Tt,Renderer:It})})};function x($,O){switch($){case"out-of-bounds":return(0,H.t)("logs.infinite-scroll.end-of-range","End of the selected time range.");case"loading":return(0,e.jsxs)(e.Fragment,{children:[O===I.uH.Ascending?(0,H.t)("logs.infinite-scroll.load-newer","Loading newer logs..."):(0,H.t)("logs.infinite-scroll.load-older","Loading older logs...")," ",(0,e.jsx)(ne.y,{inline:!0})]});case"pre-scroll":return(0,H.t)("logs.infinite-scroll.load-more","Scroll to load more");default:return null}}function R($,O,ge){if(!ge.length||!$[O-1])return;const ee=$[O-1];for(const ue of ge)if(ee.uid===ue)return"infinite-scroll"}var w=n(92252),K=n(76732),ce=n(8934),y=n(63527);const oe=48,pe=({listRef:$,logs:O})=>{const{hideSearch:ge,filterLogs:ee,matchingUids:ue,setMatchingUids:De,setSearch:Fe,searchVisible:re,toggleFilterLogs:Ke}=(0,ie.fV)(),{displayedFields:Ue}=(0,j.fl)(),[Ze,pt]=(0,r.useState)(""),[Ge,ut]=(0,r.useState)(null),ct=(0,r.useRef)(""),ot=(0,_.of)(me),Je=(0,r.useMemo)(()=>!Ze||!re?[]:Te(O,Ze,Ue),[Ue,O,Ze,re]),Ot=(0,r.useCallback)(lt=>{ct.current=lt.target.value,(0,r.startTransition)(()=>{pt(ct.current)})},[]),ft=(0,r.useCallback)(()=>{if(Ge===null)return;const lt=Ge>0?Ge-1:Je.length-1;ut(lt),$?.scrollToItem(O.indexOf(Je[lt]),"center")},[Ge,$,O,Je]),ht=(0,r.useCallback)(()=>{if(Ge===null)return;const lt=Ge<Je.length-1?Ge+1:0;ut(lt),$?.scrollToItem(O.indexOf(Je[lt]),"center")},[Ge,$,O,Je]);if((0,r.useEffect)(()=>{if(!Je.length){ut(null);return}Ge||(ut(0),$?.scrollToItem(O.indexOf(Je[0]),"center"))},[Ge,$,O,Je]),(0,r.useEffect)(()=>{re||(pt(""),Fe(void 0),De(null))},[re,Fe,De]),(0,r.useEffect)(()=>{const lt=Je.map(xt=>xt.uid),Et=ue?(0,K.ab)(ue,lt):!1;ue&&!Et&&O.filter(xt=>ue.includes(xt.uid)).filter(xt=>Je.findIndex(wt=>wt.uid===xt.uid)<0).forEach(xt=>xt.setCurrentSearch(void 0)),Fe(Ze||void 0),Et?Je.length||De(null):De(lt.length?lt:null)},[O,Je,ue,Ze,Fe,De]),!re)return null;const Lt=Ze!==""?(0,e.jsx)(e.Fragment,{children:`${Ge!==null?Ge+1:0}/${Je?.length??0}`}):void 0;return(0,e.jsxs)("div",{className:ot.container,children:[(0,e.jsx)("div",{className:ot.wrapper,children:(0,e.jsx)(y.p,{onChange:Ot,autoFocus:!0,placeholder:(0,H.t)("logs.log-list-search.input-placeholder","Search in logs"),suffix:Lt})}),(0,e.jsx)(F.K,{name:"info-circle",variant:"secondary",tooltip:(0,H.t)("logs.log-list-search.info","Client-side search for strings within the displayed logs. Not to be confused with query filters. Use this component to search for specific strings in your log results.")}),(0,e.jsx)(F.K,{onClick:ft,disabled:!Je||!Je.length,name:"angle-up","aria-label":(0,H.t)("logs.log-list-search.prev","Previous result")}),(0,e.jsx)(F.K,{onClick:ht,disabled:!Je||!Je.length,name:"angle-down","aria-label":(0,H.t)("logs.log-list-search.next","Next result")}),(0,e.jsx)(F.K,{onClick:Ke,disabled:!Je||!Je.length,className:ee?ot.controlButtonActive:void 0,name:"filter","aria-label":(0,H.t)("logs.log-list-search.filter","Filter matching logs")}),(0,e.jsx)(F.K,{onClick:ge,name:"times","aria-label":(0,H.t)("logs.log-list-search.close","Close search")})]})},me=$=>({container:(0,l.css)({background:$.colors.background.elevated,display:"flex",gap:$.spacing(1),padding:$.spacing(1),zIndex:$.zIndex.modal,overflow:"hidden",width:"100%"}),wrapper:(0,l.css)({width:"50%"}),controlButtonActive:(0,l.css)({"&:after":{display:"block",content:'" "',position:"absolute",height:2,borderRadius:$.shape.radius.default,bottom:2,backgroundImage:$.colors.gradients.brandHorizontal,width:"95%",opacity:1}})});function Te($,O,ge){const ee=new RegExp((0,ce.$f)(O),"i"),ue=$.filter(De=>De.entry.match(ee)?!0:ge.some(Fe=>De.getDisplayedFieldValue(Fe).match(ee)));return ue.forEach(De=>De.setCurrentSearch(O)),ue}var Oe=n(88838),xe=n(28848),be=n.n(xe),ye=n(80011),Be=n(67770),Ae=n(62215);const ze={"log-token-uuid":/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}/g,"log-token-json-key":/"(\b|\B)[\w-]+"(?=\s*:)/gi,"log-token-key":/(\b|\B)[\w_]+(?=\s*=)/gi,"log-token-size":/(?:\b|")\d+\.{0,1}\d*\s*[kKmMGgtTPp]*[bB]{1}(?:"|\b)/g,"log-token-duration":/(?:\b)\d+(\.\d+)?(ns|s|ms|s|m|h|d)(?:\b)/g,"log-token-method":/\b(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|TRACE|CONNECT)\b/g,"log-token-string":/"(?!:)([^'"])*?"(?!:)/g},Ye=$=>{const O=Object.keys($.labels).concat($.fields.map(ee=>ee.keys[0]));return{...{"log-token-label":new RegExp(`\\b(${O.join("|")})(?:[=:]{1})\\b`,"g")},...ze}},st=($=[],O)=>{const ge=$.map(ee=>{const{cleaned:ue,flags:De}=(0,Q.bQ)(He(ee));return new RegExp(`(?:${ue})`,De)});return O&&ge.push(new RegExp((0,ce.$f)(O),"gi")),ge.length?{"log-search-match":ge}:{}},He=$=>$.replace(/[[{(][\w,.\/:;<=>?:*+]+$/,""),Xe=5e4,nt=/(\r\n|\n|\r)/g;class at{constructor(O,{escape:ge,getFieldLinks:ee,grammar:ue,timeZone:De,virtualization:Fe,wrapLogMessage:re}){this.collapsed=void 0,this._body=void 0,this._currentSearch=void 0,this._highlightedBody=void 0,this._fields=void 0,this._getFieldLinks=void 0,this.datasourceType=O.datasourceType,this.dataFrame=O.dataFrame,this.datasourceUid=O.datasourceUid,this.duplicates=O.duplicates,this.entry=O.entry,this.entryFieldIndex=O.entryFieldIndex,this.hasAnsi=O.hasAnsi,this.hasError=!!(0,D.Ei)(O),this.hasUnescapedContent=O.hasUnescapedContent,this.isSampled=!!(0,D.qR)(O),this.labels=O.labels,this.logLevel=O.logLevel,this.rowIndex=O.rowIndex,this.rowId=O.rowId,this.searchWords=O.searchWords,this.timeFromNow=O.timeFromNow,this.timeEpochMs=O.timeEpochMs,this.timeEpochNs=O.timeEpochNs,this.timeLocal=O.timeLocal,this.timeUtc=O.timeUtc,this.uid=O.uid,this.uniqueLabels=O.uniqueLabels,this.displayLevel=Qe(O.logLevel),this._getFieldLinks=ee,this._grammar=ue,this.timestamp=(0,ye.LE)(O.timeEpochMs,{timeZone:De,defaultWithMS:!0}),this._virtualization=Fe,this._wrapLogMessage=re;let Ke=O.raw;ge&&O.hasUnescapedContent&&(Ke=(0,D.Hw)(Ke)),this.raw=Ke}get body(){return this._body===void 0&&(this._body=this.collapsed?this.raw.substring(0,this._virtualization?.getTruncationLength(null)??Xe):this.raw,this._wrapLogMessage||(this._body=this._body.replace(nt,""))),this._body}get errorMessage(){return(0,D.Ei)(this)}get fields(){return this._fields===void 0&&(this._fields=(0,Ae.jE)(this,this._getFieldLinks)),this._fields}get highlightedBody(){if(this._highlightedBody===void 0){this._grammar=this._grammar??Ye(this);const O=st(this.searchWords,this._currentSearch);this._highlightedBody=be().highlight(this.body,{...O,...this._grammar},"lokiql")}return this._highlightedBody}get sampledMessage(){return(0,D.qR)(this)}getDisplayedFieldValue(O,ge=!1){if(O===g.I)return ge?Oe.Ay.strip(this.body):this.body;let ee="";if(this.labels[O]!=null)ee=this.labels[O];else{const ue=this.fields.find(De=>De.keys[0]===O);ee=ue?ue.values.toString():""}return this._wrapLogMessage?ee:ee.replace(nt,"")}updateCollapsedState(O,ge){const ue=(O.length>0?O.map(De=>this.getDisplayedFieldValue(De,!0)).join("").length:this.entry.length)>=(this._virtualization?.getTruncationLength(ge)??Xe)?!0:void 0;return(this.collapsed===void 0||ue===void 0)&&(this.collapsed=ue),this.collapsed}setCollapsedState(O){this.collapsed!==O&&(this._body=void 0,this._highlightedBody=void 0),this.collapsed=O}setCurrentSearch(O){this._currentSearch=O,this._highlightedBody=void 0}}const vt=($,{escape:O,getFieldLinks:ge,order:ee,timeZone:ue,virtualization:De,wrapLogMessage:Fe},re)=>(0,D.oR)($,ee).map(Ue=>Ee(Ue,{escape:O,getFieldLinks:ge,grammar:re,timeZone:ue,virtualization:De,wrapLogMessage:Fe})),Ee=($,O)=>new at($,O);function Qe($=""){switch($){case Be.$b.critical:return"crit";case Be.$b.warning:return"warn";case Be.$b.unknown:return"";default:return $}}const We=()=>{const{hideSearch:$,searchVisible:O,showSearch:ge}=(0,ie.fV)();(0,r.useEffect)(()=>{function ee(ue){const De=navigator.userAgent.includes("Mac"),Fe=ue.key==="f"||ue.key==="F";if(De&&ue.metaKey&&Fe||!De&&ue.ctrlKey&&Fe){ge();return}ue.key==="Escape"&&O&&$()}return document.addEventListener("keydown",ee),()=>{document.removeEventListener("keydown",ee)}})},Ce=$=>{const[O,ge]=(0,r.useState)({selection:"",selectedRow:null,popoverMenuCoordinates:{x:0,y:0}}),[ee,ue]=(0,r.useState)(!1),De=(0,r.useRef)(null),{onClickFilterOutString:Fe,onClickFilterString:re}=(0,j.fl)(),Ke=(0,r.useCallback)(()=>!U.$.featureToggles.logRowsPopoverMenu||(0,D.Vu)()?!1:!!(Fe||re),[Fe,re]),Ue=(0,r.useCallback)(()=>{De.current&&(document.removeEventListener("click",De.current),document.removeEventListener("contextmenu",De.current),De.current=null),ge({selection:"",popoverMenuCoordinates:{x:0,y:0},selectedRow:null})},[]),Ze=(0,r.useCallback)(ot=>{if((0,D.a8)(ot.target)&&!$?.contains(ot.target)){Ue();return}document.getSelection()?.toString()||Ue()},[Ue,$]),pt=(0,r.useCallback)((ot,Je)=>{const Ot=document.getSelection()?.toString();if(!Ot)return!1;if(ot.altKey&&(0,D.Ck)(),Ke()===!1)return!!Ot;if(!$)return!1;const ft=270,ht=105,Lt=ot.clientX+ft>window.innerWidth?window.innerWidth-ft:ot.clientX,lt=ot.clientY+ht>window.innerHeight?window.innerHeight-ht:ot.clientY;return ge({selection:Ot,popoverMenuCoordinates:{x:Lt,y:lt},selectedRow:Je}),De.current=Ze,document.addEventListener("click",Ze),document.addEventListener("contextmenu",Ze),!0},[$,Ze,Ke]),Ge=(0,r.useCallback)(()=>{Ue(),ue(!0)},[Ue]),ut=(0,r.useCallback)(()=>{ue(!1)},[]),ct=(0,r.useCallback)(()=>{(0,D.PO)(),ue(!1)},[]);return{closePopoverMenu:Ue,handleTextSelection:pt,onDisableCancel:ut,onDisableConfirm:ct,onDisablePopoverMenu:Ge,popoverState:O,showDisablePopoverOptions:ee}},Re=({app:$,displayedFields:O,containerElement:ge,logOptionsStorageKey:ee,detailsMode:ue=ee?Y.M.get(`${ee}.detailsMode`)??"sidebar":"sidebar",dedupStrategy:De,enableLogDetails:Fe,eventBus:re,filterLevels:Ke,fontSize:Ue=ee?Y.M.get(`${ee}.fontSize`)??"default":"default",getFieldLinks:Ze,getRowContextQuery:pt,grammar:Ge,initialScrollPosition:ut="top",isLabelFilterActive:ct,loading:ot,loadMore:Je,logLineMenuCustomItems:Ot,logs:ft,logsMeta:ht,logSupportsContext:Lt,onClickFilterLabel:lt,onClickFilterOutLabel:Et,onClickFilterString:xt,onClickFilterOutString:wt,onClickShowField:qe,onClickHideField:It,onLogOptionsChange:Tt,onLogLineHover:yt,onPermalinkClick:At,onPinLine:gt,onOpenContext:$t,onUnpinLine:Nt,permalinkedLogId:jt,pinLineButtonTooltipTitle:Gt,pinnedLogs:Yt,setDisplayedFields:kt,showControls:Ft,showTime:qt,sortOrder:zt,syntaxHighlighting:_t=ee?Y.M.getBool(`${ee}.syntaxHighlighting`,!0):!0,timeRange:is,timeZone:es,wrapLogMessage:rs})=>{const os=(0,r.useMemo)(()=>ft.some(ts=>ts.hasUnescapedContent),[ft]);return(0,e.jsx)(j.vv,{app:$,containerElement:ge,dedupStrategy:De,detailsMode:ue,displayedFields:O,enableLogDetails:Fe,filterLevels:Ke,fontSize:Ue,getRowContextQuery:pt,hasUnescapedContent:os,isLabelFilterActive:ct,logs:ft,logsMeta:ht,logLineMenuCustomItems:Ot,logOptionsStorageKey:ee,logSupportsContext:Lt,onClickFilterLabel:lt,onClickFilterOutLabel:Et,onClickFilterString:xt,onClickFilterOutString:wt,onClickShowField:qe,onClickHideField:It,onLogOptionsChange:Tt,onLogLineHover:yt,onPermalinkClick:At,onPinLine:gt,onOpenContext:$t,onUnpinLine:Nt,permalinkedLogId:jt,pinLineButtonTooltipTitle:Gt,pinnedLogs:Yt,setDisplayedFields:kt,showControls:Ft,showTime:qt,sortOrder:zt,syntaxHighlighting:_t,wrapLogMessage:rs,children:(0,e.jsx)(ie.zz,{children:(0,e.jsx)($e,{containerElement:ge,eventBus:re,getFieldLinks:Ze,grammar:Ge,initialScrollPosition:ut,loading:ot,loadMore:Je,logs:ft,showControls:Ft,timeRange:is,timeZone:es})})})},$e=({containerElement:$,eventBus:O=new m.o,getFieldLinks:ge,grammar:ee,initialScrollPosition:ue="top",loading:De,loadMore:Fe,logs:re,showControls:Ke,timeRange:Ue,timeZone:Ze})=>{const{app:pt,displayedFields:Ge,dedupStrategy:ut,detailsMode:ct,filterLevels:ot,fontSize:Je,forceEscape:Ot,hasLogsWithErrors:ft,hasSampledLogs:ht,onClickFilterString:Lt,onClickFilterOutString:lt,permalinkedLogId:Et,showDetails:xt,showTime:wt,sortOrder:qe,toggleDetails:It,wrapLogMessage:Tt}=(0,j.fl)(),[yt,At]=(0,r.useState)([]),[gt,$t]=(0,r.useState)(pt===Le.Jk.Explore?Math.max(window.innerHeight*.8,$.clientHeight):$.clientHeight),Nt=(0,_.$j)(),jt=(0,r.useRef)(null),Gt=(0,r.useRef)($.clientWidth),Yt=(0,r.useRef)(null),kt=(0,r.useRef)(null),Ft=(0,r.useMemo)(()=>new je.km(Nt,Je),[Nt,Je]),qt=(0,r.useMemo)(()=>Tt?[]:Ft.calculateFieldDimensions(yt,Ge),[Ge,yt,Ft,Tt]),zt=(0,_.of)(Ve,qt,Ge,{showTime:wt}),_t=Yt.current??$,{closePopoverMenu:is,handleTextSelection:es,onDisableCancel:rs,onDisableConfirm:os,onDisablePopoverMenu:ts,popoverState:Xt,showDisablePopoverOptions:ms}=Ce(Yt.current);We();const{filterLogs:us,matchingUids:ss,searchVisible:ls}=(0,ie.fV)(),Vt=(0,r.useMemo)(()=>(0,P.debounce)(dt=>{jt.current?.resetAfterIndex(dt),Kt.current=1/0},25),[]),cs=(0,r.useMemo)(()=>(0,P.debounce)((dt,Rt)=>{jt.current?.scrollToItem(dt,Rt)},250),[]);(0,r.useEffect)(()=>{const dt=O.subscribe(je._B,Rt=>Ie(Rt,re.length,jt.current));return()=>dt.unsubscribe()},[O,re.length]),(0,r.useEffect)(()=>{De||(At(vt(re,{getFieldLinks:ge,escape:Ot??!1,order:qe,timeZone:Ze,virtualization:Ft,wrapLogMessage:Tt},ee)),Ft.resetLogLineSizes(),jt.current?.resetAfterIndex(0))},[Ot,ge,ee,De,re,qe,Ze,Ft,Tt]),(0,r.useEffect)(()=>{jt.current?.resetAfterIndex(0)},[Tt,xt,Ge,ut]),(0,r.useEffect)(()=>{const dt=(0,P.debounce)(()=>{$t((pt===Le.Jk.Explore?Math.max(window.innerHeight*.8,$.clientHeight):$.clientHeight)-(ls?oe:0))},50);return window.addEventListener("resize",dt),dt(),()=>{window.removeEventListener("resize",dt)}},[pt,$.clientHeight,ls]),(0,r.useLayoutEffect)(()=>{Gt.current!==_t.clientWidth&&(Gt.current=_t.clientWidth,Vt(0))});const Kt=(0,r.useRef)(1/0),gs=(0,r.useCallback)((dt,Rt,Jt)=>{Jt!==void 0&&Ft.storeLogLineSize(Rt,_t,Jt),dt!==Kt.current&&(Kt.current=dt<Kt.current?dt:Kt.current,Vt(Kt.current))},[Vt,Ft,_t]),fs=(0,r.useCallback)(()=>{if(Et){const dt=yt.findIndex(Rt=>Rt.uid===Et);if(dt>=0){jt.current?.scrollToItem(dt,"start");return}}jt.current?.scrollToItem(ue==="top"?0:yt.length-1)},[ue,Et,yt]);if(!$||gt==null)return null;const hs=(0,r.useCallback)((dt,Rt)=>{es(dt,Rt)||It(Rt)},[es,It]),ps=(0,r.useCallback)(()=>{Vt(0)},[Vt]),Zt=(0,r.useMemo)(()=>ot.length===0?yt:yt.filter(dt=>ot.includes(dt.logLevel)),[ot,yt]),Ht=(0,r.useMemo)(()=>ss&&us?Zt.filter(dt=>ss.includes(dt.uid)):Zt,[us,Zt,ss]),ns=(0,r.useCallback)(dt=>{const Rt=Ht.indexOf(dt);Rt>=0&&cs(Rt,"start")},[cs,Ht]);return(0,e.jsxs)("div",{className:zt.logListContainer,children:[(0,e.jsxs)("div",{className:zt.logListWrapper,ref:Yt,children:[Xt.selection&&Xt.selectedRow&&(0,e.jsx)(E.N,{close:is,row:Xt.selectedRow,selection:Xt.selection,...Xt.popoverMenuCoordinates,onClickFilterString:Lt,onClickFilterOutString:lt,onDisable:ts}),ms&&(0,e.jsx)(h.u,{isOpen:!0,title:(0,H.t)("logs.log-rows.disable-popover.title","Disable menu"),body:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H.x6,{i18nKey:"logs.log-rows.disable-popover.message",children:"You are about to disable the logs filter menu. To re-enable it, select text in a log line while holding the alt key."}),(0,e.jsxs)("div",{className:zt.shortcut,children:[(0,e.jsx)(de.I,{name:"keyboard"}),(0,e.jsx)(H.x6,{i18nKey:"logs.log-rows.disable-popover-message.shortcut",children:"alt+select to enable again"})]})]}),confirmText:(0,H.t)("logs.log-rows.disable-popover.confirm","Confirm"),icon:"exclamation-triangle",onConfirm:os,onDismiss:rs}),(0,e.jsx)(pe,{logs:Zt,listRef:jt.current}),(0,e.jsx)(le,{displayedFields:Ge,handleOverflow:gs,logs:Ht,loadMore:Fe,onClick:hs,scrollElement:kt.current,showTime:wt,sortOrder:qe,timeRange:Ue,timeZone:Ze,setInitialScrollPosition:fs,virtualization:Ft,wrapLogMessage:Tt,children:({getItemKey:dt,itemCount:Rt,onItemsRendered:Jt,Renderer:Ts})=>(0,e.jsx)(J._m,{className:zt.logList,height:gt,itemCount:Rt,itemSize:je.gn.bind(null,Ft,Ht,_t,Ge,{detailsMode:ct,hasLogsWithErrors:ft,hasSampledLogs:ht,showDuplicates:ut!==I.fY.none,showDetails:xt,showTime:wt,wrap:Tt}),itemKey:dt,layout:"vertical",onItemsRendered:Jt,outerRef:kt,overscanCount:5,ref:jt,style:{overflowY:"scroll"},width:"100%",children:Ts})})]}),ct==="sidebar"&&xt.length>0&&(0,e.jsx)(G.Bj,{containerElement:$,focusLogLine:ns,logs:Ht,onResize:ps}),Ke&&(0,e.jsx)(w.V,{eventBus:O})]})};function Ve($,O,ge,{showTime:ee}){const ue=ee?O:O.filter((De,Fe)=>Fe>0);return{logList:(0,l.css)({"& .unwrapped-log-line":{display:"grid",gridTemplateColumns:k(ue,ge),"& .field":{overflow:"hidden"}}}),logListContainer:(0,l.css)({display:"flex",minWidth:$.spacing(35)}),logListWrapper:(0,l.css)({position:"relative",width:"100%"}),shortcut:(0,l.css)({display:"inline-flex",alignItems:"center",gap:$.spacing(1),color:$.colors.text.secondary,opacity:.7,fontSize:$.typography.bodySmall.fontSize,marginTop:$.spacing(1)})}}function Ie($,O,ge){$.payload.scrollTo==="top"?ge?.scrollTo(0):ge?.scrollToItem(O-1)}},29457:(tt,we,n)=>{n.d(we,{KB:()=>ne,Q4:()=>U,cQ:()=>Z,fl:()=>de,u0:()=>E,vv:()=>q});var e=n(74848),l=n(2543),P=n.n(l),r=n(96540),J=n(1906),Y=n(739),m=n(78012),Le=n(76732),I=n(74746),H=n(55439);const _=(0,r.createContext)({app:J.Jk.Unknown,closeDetails:()=>{},dedupStrategy:Y.fY.none,detailsDisplayed:()=>!1,detailsMode:"sidebar",detailsWidth:0,displayedFields:[],downloadLogs:()=>{},enableLogDetails:!1,filterLevels:[],fontSize:"default",hasUnescapedContent:!1,setDedupStrategy:()=>{},setDetailsMode:()=>{},setDetailsWidth:()=>{},setFilterLevels:()=>{},setFontSize:()=>{},setForceEscape:()=>{},setLogListState:()=>{},setPinnedLogs:()=>{},setPrettifyJSON:()=>{},setShowTime:()=>{},setShowUniqueLabels:()=>{},setSortOrder:()=>{},setSyntaxHighlighting:()=>{},setWrapLogMessage:()=>{},showDetails:[],showTime:!0,sortOrder:Y.uH.Ascending,syntaxHighlighting:!0,toggleDetails:()=>{},wrapLogMessage:!1}),h=b=>useContext(_)[b],de=()=>(0,r.useContext)(_),E=b=>{const{pinnedLogs:C}=(0,r.useContext)(_);return C?.some(W=>W===b.rowId)},Z=b=>{const{permalinkedLogId:C}=(0,r.useContext)(_);return C&&C===b.uid},q=({app:b,children:C,containerElement:W,enableLogDetails:Q,detailsMode:z,dedupStrategy:N,displayedFields:g,filterLevels:B,fontSize:G,forceEscape:ae=!1,hasUnescapedContent:v,isLabelFilterActive:F,getRowContextQuery:D,logs:j,logLineMenuCustomItems:f,logsMeta:X,logOptionsStorageKey:V,logSupportsContext:ie,onClickFilterLabel:je,onClickFilterOutLabel:L,onClickFilterString:d,onClickFilterOutString:p,onClickShowField:c,onClickHideField:T,onLogOptionsChange:k,onLogLineHover:te,onPermalinkClick:fe,onPinLine:le,onOpenContext:x,onUnpinLine:R,permalinkedLogId:w,pinLineButtonTooltipTitle:K,pinnedLogs:ce,prettifyJSON:y,setDisplayedFields:oe,showControls:pe,showTime:me,showUniqueLabels:Te,sortOrder:Oe,syntaxHighlighting:xe,wrapLogMessage:be})=>{const[ye,Be]=(0,r.useState)({dedupStrategy:N,filterLevels:B??(V?m.M.getObject(`${V}.filterLevels`,[]):[]),fontSize:G,forceEscape:ae,hasUnescapedContent:v,pinnedLogs:ce,prettifyJSON:y,showTime:me,showUniqueLabels:Te,sortOrder:Oe,syntaxHighlighting:xe,wrapLogMessage:be}),[Ae,ze]=(0,r.useState)([]),[Ye,st]=(0,r.useState)(he(W,V)),[He,Xe]=(0,r.useState)(z??"sidebar");(0,r.useEffect)(()=>{if(pe&&b!==J.Jk.PanelEditor)return;const re={...ye,dedupStrategy:N,showTime:me,sortOrder:Oe,syntaxHighlighting:xe,wrapLogMessage:be};(0,Le.ab)(ye,re)||Be(re)},[b,N,ye,ce,pe,me,Oe,xe,be]),(0,r.useEffect)(()=>{B!==void 0&&Be(re=>(0,Le.ab)(re.filterLevels,B)?re:{...re,filterLevels:B})},[B]),(0,r.useEffect)(()=>{Be(re=>({...re,fontSize:G}))},[G]),(0,r.useEffect)(()=>{ye.hasUnescapedContent!==v&&Be({...ye,hasUnescapedContent:v})},[v,ye]),(0,r.useEffect)(()=>{(0,Le.ab)(ye.pinnedLogs??[],ce??[])||Be({...ye,pinnedLogs:ce})},[ye,ce]),(0,r.useEffect)(()=>{if(!Ae.length)return;const re=Ae.filter(Ke=>j.findIndex(Ue=>Ue.uid===Ke.uid)>=0);re.length!==Ae.length&&ze(re)},[j,Ae]),(0,r.useEffect)(()=>{const re=(0,l.debounce)(()=>{st(Ke=>he(W,V,Ke))},50);return re(),window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re)}},[W,V]);const nt=(0,r.useCallback)(re=>!!Ae.find(Ke=>Ke.uid===re.uid),[Ae]),at=(0,r.useCallback)(re=>{Be({...ye,dedupStrategy:re}),k?.("dedupStrategy",re)},[ye,k]),vt=(0,r.useCallback)(re=>{V&&m.M.set(`${V}.fontSize`,re),Be(Ke=>({...Ke,fontSize:re}))},[V]),Ee=(0,r.useCallback)(re=>{Be({...ye,forceEscape:re})},[ye]),Qe=(0,r.useCallback)(re=>{Be({...ye,filterLevels:re}),k?.("filterLevels",re)},[ye,k]),We=(0,r.useCallback)(re=>{Be({...ye,pinnedLogs:re}),k?.("pinnedLogs",re)},[ye,k]),Ce=(0,r.useCallback)(re=>{Be({...ye,showTime:re}),k?.("showTime",re),V&&m.M.set(`${V}.showTime`,re)},[ye,V,k]),Re=(0,r.useCallback)(re=>{Be({...ye,showUniqueLabels:re}),k?.("showUniqueLabels",re),V&&m.M.set(`${V}.showLabels`,re)},[ye,V,k]),$e=(0,r.useCallback)(re=>{Be({...ye,prettifyJSON:re}),k?.("prettifyJSON",re),V&&m.M.set(`${V}.prettifyLogMessage`,re)},[ye,V,k]),Ve=(0,r.useCallback)(re=>{Be({...ye,syntaxHighlighting:re}),k?.("syntaxHighlighting",re),V&&m.M.set(`${V}.syntaxHighlighting`,re)},[ye,V,k]),Ie=(0,r.useCallback)(re=>{Be({...ye,sortOrder:re}),k?.("sortOrder",re),V&&m.M.set(`${V}.sortOrder`,re)},[ye,V,k]),$=(0,r.useCallback)(re=>{Be({...ye,wrapLogMessage:re}),k?.("wrapLogMessage",re),V&&m.M.set(`${V}.wrapLogMessage`,re)},[ye,V,k]),O=(0,r.useCallback)(re=>{const Ke=ye.filterLevels.length===0?j:j.filter(Ue=>ye.filterLevels.includes(Ue.logLevel));(0,I.K7)(re,Ke,X)},[ye.filterLevels,j,X]),ge=(0,r.useCallback)(()=>{ze([])},[]),ee=(0,r.useCallback)(re=>{if(!Q)return;Ae.findIndex(Ue=>Ue===re||Ue.uid===re.uid)>=0?ze(Ae.filter(Ue=>Ue!==re&&Ue.uid!==re.uid)):ze([re])},[Q,Ae]),ue=(0,r.useCallback)(re=>{if(!V||!W)return;const Ke=W.clientWidth-H.Of;re>Ke||(m.M.set(`${V}.detailsWidth`,re),st(re))},[W,V]),De=(0,r.useMemo)(()=>j.some(re=>!!(0,I.Ei)(re)),[j]),Fe=(0,r.useMemo)(()=>j.some(re=>!!(0,I.qR)(re)),[j]);return(0,e.jsx)(_.Provider,{value:{app:b,closeDetails:ge,detailsDisplayed:nt,dedupStrategy:ye.dedupStrategy,detailsMode:He,detailsWidth:Ye,displayedFields:g,downloadLogs:O,enableLogDetails:Q,filterLevels:ye.filterLevels,fontSize:ye.fontSize,forceEscape:ye.forceEscape,hasLogsWithErrors:De,hasSampledLogs:Fe,hasUnescapedContent:ye.hasUnescapedContent,isLabelFilterActive:F,getRowContextQuery:D,logSupportsContext:ie,logLineMenuCustomItems:f,logOptionsStorageKey:V,onClickFilterLabel:je,onClickFilterOutLabel:L,onClickFilterString:d,onClickFilterOutString:p,onClickShowField:c,onClickHideField:T,onLogLineHover:te,onPermalinkClick:fe,onPinLine:le,onOpenContext:x,onUnpinLine:R,permalinkedLogId:w,pinLineButtonTooltipTitle:K,pinnedLogs:ye.pinnedLogs,prettifyJSON:ye.prettifyJSON,setDedupStrategy:at,setDetailsMode:Xe,setDetailsWidth:ue,setDisplayedFields:oe,setFilterLevels:Qe,setFontSize:vt,setForceEscape:Ee,setLogListState:Be,setPinnedLogs:We,setPrettifyJSON:$e,setShowTime:Ce,setShowUniqueLabels:Re,setSortOrder:Ie,setSyntaxHighlighting:Ve,setWrapLogMessage:$,showDetails:Ae,showTime:ye.showTime,showUniqueLabels:ye.showUniqueLabels,sortOrder:ye.sortOrder,syntaxHighlighting:ye.syntaxHighlighting,toggleDetails:ee,wrapLogMessage:ye.wrapLogMessage},children:C})};function U(b){return b===Y.uH.Ascending||b===Y.uH.Descending}function ne(b){return b===Y.fY.exact||b===Y.fY.none||b===Y.fY.numbers||b===Y.fY.signature}function he(b,C,W){if(!b)return 0;const Q=b.clientWidth*.4,z=W||(C?parseInt(m.M.get(`${C}.detailsWidth`)??Q,10):Q),N=b.clientWidth-H.Of;return z>=b.clientWidth||z>N?W??Q:z}},92252:(tt,we,n)=>{n.d(we,{V:()=>W});var e=n(74848),l=n(22803),P=n(2543),r=n.n(P),J=n(96540),Y=n(739),m=n(67770),Le=n(1906),I=n(92745),H=n(27489),_=n(43173),h=n(63142),de=n(87063),E=n(76319),Z=n(88559),q=n(74746),U=n(29457),ne=n(67897),he=n(55439);const b=[Y.fY.none,Y.fY.exact,Y.fY.numbers,Y.fY.signature],C=[m.$b.info,m.$b.debug,m.$b.trace,m.$b.warning,m.$b.error,m.$b.critical,m.$b.unknown],W=({eventBus:z,visualisationType:N="logs"})=>{const g=(0,h.of)(Q),{app:B,dedupStrategy:G,downloadLogs:ae,filterLevels:v,fontSize:F,forceEscape:D,hasUnescapedContent:j,prettifyJSON:f,setDedupStrategy:X,setFilterLevels:V,setFontSize:ie,setForceEscape:je,setPrettifyJSON:L,setShowTime:d,setShowUniqueLabels:p,setSortOrder:c,setSyntaxHighlighting:T,setWrapLogMessage:k,showTime:te,showUniqueLabels:fe,sortOrder:le,syntaxHighlighting:x,wrapLogMessage:R}=(0,U.fl)(),{hideSearch:w,searchVisible:K,showSearch:ce}=(0,ne.fV)(),y=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_scroll_top_clicked"),z.publish(new he._B({scrollTo:"top"}))},[z]),oe=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_scroll_bottom_clicked"),z.publish(new he._B({scrollTo:"bottom"}))},[z]),pe=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_force_escape_clicked"),je(!D)},[D,je]),me=(0,J.useCallback)(Xe=>{(0,H.rR)("logs_log_list_controls_level_clicked"),Xe===void 0?V([]):v.includes(Xe)?V(v.filter(nt=>nt!==Xe)):V([...v,Xe])},[v,V]),Te=(0,J.useCallback)(()=>{const Xe=F==="default"?"small":"default";(0,H.rR)("logs_log_list_controls_font_size_clicked",{size:Xe}),ie(Xe)},[F,ie]),Oe=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_show_time_clicked",{show_time:!te}),d(!te)},[d,te]),xe=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_show_unique_labels_clicked",{show_unique_labels:fe}),p(!fe)},[p,fe]),be=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_sort_order_clicked",{order:le===Y.uH.Ascending?Y.uH.Descending:Y.uH.Ascending}),c(le===Y.uH.Ascending?Y.uH.Descending:Y.uH.Ascending)},[c,le]),ye=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_prettify_json_clicked",{state:!f}),L(!f)},[f,L]),Be=(0,J.useCallback)(()=>{(0,H.rR)("logs_log_list_controls_syntax_clicked",{state:!x}),T(!x)},[T,x]),Ae=(0,J.useCallback)(Xe=>{Xe.preventDefault(),(0,H.rR)("logs_log_list_controls_wrap_clicked",{state:!R}),k(!R)},[k,R]),ze=(0,J.useMemo)(()=>(0,e.jsx)(de.W,{children:b.map(Xe=>(0,e.jsx)(de.W.Item,{className:G===Xe?g.menuItemActive:void 0,description:m._C[Xe],label:(0,P.capitalize)(Xe),onClick:()=>X(Xe)},Xe))}),[G,X,g.menuItemActive]),Ye=(0,J.useMemo)(()=>(0,e.jsxs)(de.W,{children:[(0,e.jsx)(de.W.Item,{className:v.length===0?g.menuItemActive:void 0,label:(0,I.t)("logs.logs-controls.display-level-all","All levels"),onClick:()=>me()},"all"),C.map(Xe=>(0,e.jsx)(de.W.Item,{className:v.includes(Xe)?g.menuItemActive:void 0,label:(0,P.capitalize)(Xe),onClick:()=>me(Xe)},Xe))]}),[v,me,g.menuItemActive]),st=(0,J.useMemo)(()=>(0,e.jsxs)(de.W,{children:[(0,e.jsx)(de.W.Item,{label:(0,I.t)("logs.logs-controls.download-logs.txt","txt"),onClick:()=>ae(q.s.Text)}),(0,e.jsx)(de.W.Item,{label:(0,I.t)("logs.logs-controls.download-logs.json","json"),onClick:()=>ae(q.s.Json)}),(0,e.jsx)(de.W.Item,{label:(0,I.t)("logs.logs-controls.download-logs.csv","csv"),onClick:()=>ae(q.s.CSV)})]}),[ae]),He=B===Le.Jk.Dashboard||B===Le.Jk.PanelEditor||B===Le.Jk.PanelViewer;return(0,e.jsxs)("div",{className:g.navContainer,children:[N==="logs"&&(0,e.jsx)(E.K,{name:"arrow-down",className:g.controlButton,variant:"secondary",onClick:oe,tooltip:(0,I.t)("logs.logs-controls.scroll-bottom","Scroll to bottom"),size:"lg"}),He?(0,e.jsxs)(e.Fragment,{children:[_.$.featureToggles.newLogsPanel&&(0,e.jsx)(E.K,{name:"search",className:K?g.controlButtonActive:g.controlButton,onClick:K?w:ce,tooltip:K?(0,I.t)("logs.logs-controls.hide-search","Close search"):(0,I.t)("logs.logs-controls.show-search","Search in logs result"),size:"lg"}),(0,e.jsx)(Z.m,{overlay:Ye,placement:"auto-end",children:(0,e.jsx)(E.K,{name:"gf-logs",className:v&&v.length>0?g.controlButtonActive:g.controlButton,tooltip:(0,I.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E.K,{name:le===Y.uH.Descending?"sort-amount-up":"sort-amount-down",className:g.controlButton,onClick:be,tooltip:le===Y.uH.Descending?(0,I.t)("logs.logs-controls.newest-first","Sorted by newest logs first - Click to show oldest first"):(0,I.t)("logs.logs-controls.oldest-first","Sorted by oldest logs first - Click to show newest first"),size:"lg"}),N==="logs"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g.divider}),_.$.featureToggles.newLogsPanel&&(0,e.jsx)(E.K,{name:"search",className:K?g.controlButtonActive:g.controlButton,onClick:K?w:ce,tooltip:K?(0,I.t)("logs.logs-controls.hide-search","Close search"):(0,I.t)("logs.logs-controls.show-search","Search in logs result"),size:"lg"}),(0,e.jsx)(Z.m,{overlay:ze,placement:"auto-end",children:(0,e.jsx)(E.K,{name:"filter",className:G!==Y.fY.none?g.controlButtonActive:g.controlButton,tooltip:(0,I.t)("logs.logs-controls.deduplication","Deduplication"),size:"lg"})}),(0,e.jsx)(Z.m,{overlay:Ye,placement:"auto-end",children:(0,e.jsx)(E.K,{name:"gf-logs",className:v&&v.length>0?g.controlButtonActive:g.controlButton,tooltip:(0,I.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})}),(0,e.jsx)("div",{className:g.divider}),(0,e.jsx)(E.K,{name:"clock-nine","aria-pressed":te,className:te?g.controlButtonActive:g.controlButton,onClick:Oe,tooltip:te?(0,I.t)("logs.logs-controls.hide-timestamps","Hide timestamps"):(0,I.t)("logs.logs-controls.show-timestamps","Show timestamps"),size:"lg"}),fe!==void 0&&B!==Le.Jk.Unknown&&(0,e.jsx)(E.K,{name:"tag-alt","aria-pressed":fe,className:fe?g.controlButtonActive:g.controlButton,onClick:xe,tooltip:fe?(0,I.t)("logs.logs-controls.hide-unique-labels","Hide unique labels"):(0,I.t)("logs.logs-controls.show-unique-labels","Show unique labels"),size:"lg"}),(0,e.jsx)(E.K,{name:"wrap-text",className:R?g.controlButtonActive:g.controlButton,"aria-pressed":R,onClick:Ae,tooltip:R?(0,I.t)("logs.logs-controls.unwrap-lines","Unwrap lines"):(0,I.t)("logs.logs-controls.wrap-lines","Wrap lines"),size:"lg"}),f!==void 0&&(0,e.jsx)(E.K,{name:"brackets-curly","aria-pressed":f,className:f?g.controlButtonActive:g.controlButton,onClick:ye,tooltip:f?(0,I.t)("logs.logs-controls.disable-prettify-json","Collapse JSON logs"):(0,I.t)("logs.logs-controls.prettify-json","Expand JSON logs"),size:"lg"}),x!==void 0&&(0,e.jsx)(E.K,{name:"brackets-curly",className:x?g.controlButtonActive:g.controlButton,"aria-pressed":x,onClick:Be,tooltip:x?(0,I.t)("logs.logs-controls.disable-highlighting","Disable highlighting"):(0,I.t)("logs.logs-controls.enable-highlighting","Enable highlighting"),size:"lg"}),_.$.featureToggles.newLogsPanel&&(0,e.jsx)(E.K,{name:"text-fields",className:F==="small"?g.controlButtonActive:g.controlButton,"aria-pressed":!!F,onClick:Te,tooltip:F==="default"?(0,I.t)("logs.logs-controls.font-size-default","Use small font size"):(0,I.t)("logs.logs-controls.font-size-small","Use default font size"),size:"lg"}),j&&(0,e.jsx)(E.K,{name:"enter","aria-pressed":D,className:D?g.controlButtonActive:g.controlButton,onClick:pe,tooltip:D?(0,I.t)("logs.logs-controls.remove-escaping","Remove escaping"):(0,I.t)("logs.logs-controls.escape-newlines","Fix incorrectly escaped newline and tab sequences in log lines"),size:"lg"})]}),!_.$.exploreHideLogsDownload&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:g.divider}),(0,e.jsx)(Z.m,{overlay:st,placement:"auto-end",children:(0,e.jsx)(E.K,{name:"download-alt",className:g.controlButton,tooltip:(0,I.t)("logs.logs-controls.download","Download logs"),size:"lg"})})]})]}),N==="logs"&&(0,e.jsx)(E.K,{name:"arrow-up","data-testid":"scrollToTop",className:g.scrollToTopButton,variant:"secondary",onClick:y,tooltip:(0,I.t)("logs.logs-controls.scroll-top","Scroll to top"),size:"lg"})]})},Q=z=>({navContainer:(0,l.css)({maxHeight:"100%",display:"flex",gap:z.spacing(3),flexDirection:"column",justifyContent:"flex-start",width:z.spacing(4),paddingTop:z.spacing(.75),paddingLeft:z.spacing(1),borderLeft:`solid 1px ${z.colors.border.medium}`,overflow:"hidden",minWidth:z.spacing(4)}),scrollToTopButton:(0,l.css)({margin:0,marginTop:"auto",color:z.colors.text.secondary,height:z.spacing(2)}),controlButton:(0,l.css)({margin:0,color:z.colors.text.secondary,height:z.spacing(2)}),divider:(0,l.css)({borderTop:`solid 1px ${z.colors.border.medium}`,height:1,marginTop:z.spacing(-.25),marginBottom:z.spacing(-1.75)}),controlButtonActive:(0,l.css)({margin:0,color:z.colors.text.secondary,height:z.spacing(2),"&:after":{display:"block",content:'" "',position:"absolute",height:2,borderRadius:z.shape.radius.default,bottom:z.spacing(-1),backgroundImage:z.colors.gradients.brandHorizontal,width:"95%",opacity:1}}),menuItemActive:(0,l.css)({"&:before":{content:'""',position:"absolute",left:0,top:z.spacing(.5),height:`calc(100% - ${z.spacing(1)})`,width:"2px",backgroundColor:z.colors.warning.main}})})},67897:(tt,we,n)=>{n.d(we,{fV:()=>J,zz:()=>Y});var e=n(74848),l=n(96540);const P=(0,l.createContext)({hideSearch:()=>{},filterLogs:!1,matchingUids:null,searchVisible:!1,setMatchingUids:()=>{},setSearch:()=>{},showSearch:()=>{},toggleFilterLogs:()=>{}}),r=m=>useContext(P)[m],J=()=>(0,l.useContext)(P),Y=({children:m})=>{const[Le,I]=(0,l.useState)(void 0),[H,_]=(0,l.useState)(!1),[h,de]=(0,l.useState)(null),[E,Z]=(0,l.useState)(!1),q=(0,l.useCallback)(()=>{_(!1)},[]),U=(0,l.useCallback)(()=>{_(!0)},[]),ne=(0,l.useCallback)(()=>{Z(he=>!he)},[]);return(0,e.jsx)(P.Provider,{value:{hideSearch:q,filterLogs:E,matchingUids:h,search:Le,searchVisible:H,setMatchingUids:de,setSearch:I,showSearch:U,toggleFilterLogs:ne},children:m})}},55439:(tt,we,n)=>{n.d(we,{Dj:()=>Y,Of:()=>r,SC:()=>I,_B:()=>E,gn:()=>Le,km:()=>m,yb:()=>J});var e=n(88838),l=n(68388),P=n(6442);const r=35*8,J=1.5,Y=22;class m{constructor(q,U){this.ctx=null,this.measurementMode="canvas",this.spanElement=document.createElement("span"),this.getLineHeight=()=>this.lineHeight,this.getGridSize=()=>this.gridSize,this.getPaddingBottom=()=>this.paddingBottom,this.getTruncationLineCount=()=>Math.round(window.innerHeight/this.getLineHeight()/1.5),this.getTruncationLength=C=>(C?h(C):window.innerWidth)/this.measureTextWidth("e")*this.getTruncationLineCount(),this.determineMeasurementMode=()=>{if(!this.ctx){this.measurementMode="dom";return}const C=this.ctx.measureText("e").width;this.measureTextWidthWithDOM("e")-C>=.1&&(console.warn("Virtualized log list: falling back to DOM for measurement"),this.measurementMode="dom")},this.initCanvasMeasurement=(C,W)=>{const Q=document.createElement("canvas");this.ctx=Q.getContext("2d"),this.ctx&&(this.ctx.font=C,this.ctx.fontKerning="normal",this.ctx.fontStretch="normal",this.ctx.fontVariantCaps="normal",this.ctx.textRendering="optimizeLegibility",W&&(this.ctx.letterSpacing=W))},this.initDOMmeasurement=(C,W)=>{this.spanElement.style.font=C,this.spanElement.style.visibility="hidden",this.spanElement.style.position="absolute",this.spanElement.style.wordBreak="break-all",W&&(this.spanElement.style.letterSpacing=W)},this.measureTextWidth=C=>{if(!this.ctx)throw new Error("Measuring context canvas is not initialized. Call init() before.");const W=C.length,Q=this.textWidthMap.get(W);if(Q)return Q;const z=this.measurementMode==="canvas"?this.ctx.measureText(C).width:this.measureTextWidthWithDOM(C);return this.textWidthMap.set(W,z),z},this.measureTextWidthWithDOM=C=>{this.spanElement.textContent=C,document.body.appendChild(this.spanElement);const W=this.spanElement.getBoundingClientRect().width;return document.body.removeChild(this.spanElement),W},this.measureTextHeight=(C,W,Q=0)=>{let z=0;const N=this.measureTextWidth("e");let g=Math.round(W/N);const B=Math.floor((W-Q)/N)-2*N,G=C.split(`
`);if(G.length===1&&C.length<B)return{lines:1,height:this.getLineHeight()+this.paddingBottom};const ae=W-Q;for(const F of G)for(let D=0;D<F.length;){let j,f=0,X=0;do{j=F.substring(D,D+g-X);let V=j;z>0&&V.trimStart(),f=this.measureTextWidth(V),X+=1}while(f>=ae);Q&&(Q=0),z+=1,D+=j.length}const v=z*this.getLineHeight()+this.paddingBottom;return{lines:z,height:v}},this.calculateFieldDimensions=(C,W=[])=>{if(!C.length)return[];let Q=0,z=0;const N={};for(let B=0;B<C.length;B++){let G=this.measureTextWidth(C[B].timestamp);G>Q&&(Q=Math.round(G)),G=this.measureTextWidth(C[B].displayLevel),G>z&&(z=Math.round(G));for(const ae of W)G=this.measureTextWidth(C[B].getDisplayedFieldValue(ae,!0)),N[ae]=!N[ae]||G>N[ae]?Math.round(G):N[ae]}const g=[{field:"timestamp",width:Q},{field:"level",width:z}];for(const B in N)g.push({field:B,width:N[B]});return g},this.resetLogLineSizes=()=>{this.logLineSizesMap=new Map},this.storeLogLineSize=(C,W,Q)=>{const z=`${C}_${h(W)}_${this.fontSize}`;this.logLineSizesMap.set(z,Q)},this.retrieveLogLineSize=(C,W)=>{const Q=`${C}_${h(W)}_${this.fontSize}`;return this.logLineSizesMap.get(Q)},this.fontSize=U;let ne;U==="default"?(ne=q.typography.fontSize,this.lineHeight=q.typography.fontSize*q.typography.body.lineHeight):(ne=typeof q.typography.bodySmall.fontSize=="string"&&q.typography.bodySmall.fontSize.includes("rem")?q.typography.fontSize*parseFloat(q.typography.bodySmall.fontSize):parseInt(q.typography.bodySmall.fontSize,10),this.lineHeight=ne*q.typography.bodySmall.lineHeight),this.gridSize=q.spacing.gridSize,this.paddingBottom=this.gridSize*.75,this.logLineSizesMap=new Map,this.textWidthMap=new Map;const he=`${ne}px ${q.typography.fontFamilyMonospace}`,b=q.typography.body.letterSpacing;this.initDOMmeasurement(he,b),this.initCanvasMeasurement(he,b),this.determineMeasurementMode()}}function Le(Z,q,U,ne,{detailsMode:he,hasLogsWithErrors:b,hasSampledLogs:C,showDuplicates:W,showDetails:Q,showTime:z,wrap:N},g){if(!U)return 0;const B=Z.getGridSize()*J,G=he==="inline"&&Q.findIndex(f=>f.uid===q[g].uid)>=0?window.innerHeight*(P.l_/100)+B/2:0;if(!N||!q[g])return Z.getLineHeight()+Z.getPaddingBottom()+G;if(q[g].updateCollapsedState(ne,U),q[g].collapsed)return(Z.getTruncationLineCount()+1)*Z.getLineHeight()+G;const ae=Z.retrieveLogLineSize(q[g].uid,U);if(ae)return ae;let v="";const F=Z.getGridSize()*.5;let D=0;W&&(D+=Z.getGridSize()*4.5+F),b&&(D+=Z.getGridSize()*2+F),C&&(D+=Z.getGridSize()*2+F),z&&(D+=B,v+=q[g].timestamp),(q[g].displayLevel||!N)&&(D+=B,v+=q[g].displayLevel??"");for(const f of ne)v=q[g].getDisplayedFieldValue(f,!0)+v;ne.length||(v+=e.Ay.strip(q[g].body));const{height:j}=Z.measureTextHeight(v,h(U),D);return q[g].collapsed===!1?j+Z.getLineHeight()+G:j+G}function I(Z,q,U,ne){ne!==void 0&&U&&(U-=Z.getLineHeight());const he=q.parentElement?Array.from(q.parentElement.children).filter(z=>z.classList.contains("log-line-inline-details")):void 0,b=he?.length?he[0].clientHeight:0;let C=q.scrollHeight+b;const W=U??q.clientHeight;if(C>W)return ne!==void 0?C+Z.getLineHeight():C;const Q=q.children[1];return C=Q.clientHeight+b,Q instanceof HTMLDivElement&&C<W?ne!==void 0?C+Z.getLineHeight():C:null}const H=24,_=de();function h(Z){return Z.clientWidth-_-H}function de(){const Z=document.createElement("div");Z.style.width="100px",Z.style.height="100px",Z.style.overflow="scroll",Z.style.position="absolute",Z.style.top="-9999px",document.body.appendChild(Z);const q=Z.offsetWidth-Z.clientWidth;return document.body.removeChild(Z),q}class E extends l.x{static{this.type="logs-panel-scroll-to"}}},27522:(tt,we,n)=>{n.d(we,{B:()=>l,a:()=>Y});var e=n(96426);function l(m,Le,I,H){if(!m)return!1;const _=P(Le,H);if(!_.length)return!1;let h=_;if(m!==Le){const de=P(m,H);h=_.flatMap(E=>de.filter(Z=>E.text===Z.text)||E)}return h.map(de=>r(m,I,de)).filter(J)}function P(m,Le){const I=[];return Le.parse(m).iterate({enter:_=>{if(_.type.id===e.Ql){const h=_.node;I.push({node:h,text:m.substring(h.from,h.to)})}}}),I}function r(m,Le,I){if(Le.length===1){const h=I.node.from===I.node.to,de=h&&I.node.parent?I.node.parent:I.node,E=h?m.substring(de.from,de.to):I.text;return{startLineNumber:1,startColumn:de.from+1,endLineNumber:1,endColumn:de.to+1,error:E}}let H=0,_=0;for(let h=0;h<Le.length;h++){if(_=H+Le[h].length,I.node.from>_){H+=Le[h].length+1;continue}return{startLineNumber:h+1,startColumn:I.node.from-H+1,endLineNumber:h+1,endColumn:I.node.to-H+1,error:I.text}}return null}function J(m){return m!==null}const Y={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},49224:(tt,we,n)=>{n.d(we,{we:()=>bs,VQ:()=>cn,lb:()=>Ls,Gf:()=>Bs,M1:()=>Es,ow:()=>Ss,mL:()=>Bt,In:()=>Ps});var e=n(2543),l=n(13288),P=n(44240),r=n(62467),J=n(75505),Y=n(81160),m=n(66847),Le=n(59099),I=n(63720),H=n(17548),_=n(28105),h=n(67770),de=n(83175),E=n(1906),Z=n(88673),q=n(428),U=n(36195),ne=n(36580),he=n(2863),b=n(43173);const C=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,W=new Set,Q=typeof process=="object"&&process?process:{},z=(S,t,s,a)=>{typeof Q.emitWarning=="function"?Q.emitWarning(S,t,s,a):console.error(`[${s}] ${t}: ${S}`)};let N=globalThis.AbortController,g=globalThis.AbortSignal;if(typeof N>"u"){g=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(a,i){this._onabort.push(i)}},N=class{constructor(){t()}signal=new g;abort(a){if(!this.signal.aborted){this.signal.reason=a,this.signal.aborted=!0;for(const i of this.signal._onabort)i(a);this.signal.onabort?.(a)}}};let S=Q.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const t=()=>{S&&(S=!1,z("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const B=S=>!W.has(S),G=Symbol("type"),ae=S=>S&&S===Math.floor(S)&&S>0&&isFinite(S),v=S=>ae(S)?S<=Math.pow(2,8)?Uint8Array:S<=Math.pow(2,16)?Uint16Array:S<=Math.pow(2,32)?Uint32Array:S<=Number.MAX_SAFE_INTEGER?F:null:null;class F extends Array{constructor(t){super(t),this.fill(0)}}class D{heap;length;static#l=!1;static create(t){const s=v(t);if(!s)return[];D.#l=!0;const a=new D(t,s);return D.#l=!1,a}constructor(t,s){if(!D.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class j{#l;#u;#p;#T;#m;#F;#M;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#v;#n;#s;#e;#c;#g;#o;#i;#O;#r;#x;#y;#f;#b;#C;#d;#D;static unsafeExposeInternals(t){return{starts:t.#y,ttls:t.#f,sizes:t.#x,keyMap:t.#n,keyList:t.#s,valList:t.#e,next:t.#c,prev:t.#g,get head(){return t.#o},get tail(){return t.#i},free:t.#O,isBackgroundFetch:s=>t.#t(s),backgroundFetch:(s,a,i,o)=>t.#I(s,a,i,o),moveToTail:s=>t.#$(s),indexes:s=>t.#L(s),rindexes:s=>t.#E(s),isStale:s=>t.#h(s)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#v}get size(){return this.#a}get fetchMethod(){return this.#F}get memoMethod(){return this.#M}get dispose(){return this.#p}get onInsert(){return this.#T}get disposeAfter(){return this.#m}constructor(t){const{max:s=0,ttl:a,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:u,updateAgeOnHas:M,allowStale:A,dispose:se,onInsert:Pe,disposeAfter:ve,noDisposeOnSet:Se,noUpdateTTL:Me,maxSize:Ne=0,maxEntrySize:ke=0,sizeCalculation:et,fetchMethod:_e,memoMethod:it,noDeleteOnFetchRejection:St,noDeleteOnStaleGet:mt,allowStaleOnFetchRejection:Pt,allowStaleOnFetchAbort:Ct,ignoreFetchAbort:Mt}=t;if(s!==0&&!ae(s))throw new TypeError("max option must be a nonnegative integer");const bt=s?v(s):Array;if(!bt)throw new Error("invalid max value: "+s);if(this.#l=s,this.#u=Ne,this.maxEntrySize=ke||this.#u,this.sizeCalculation=et,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(it!==void 0&&typeof it!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#M=it,_e!==void 0&&typeof _e!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#F=_e,this.#C=!!_e,this.#n=new Map,this.#s=new Array(s).fill(void 0),this.#e=new Array(s).fill(void 0),this.#c=new bt(s),this.#g=new bt(s),this.#o=0,this.#i=0,this.#O=D.create(s),this.#a=0,this.#v=0,typeof se=="function"&&(this.#p=se),typeof Pe=="function"&&(this.#T=Pe),typeof ve=="function"?(this.#m=ve,this.#r=[]):(this.#m=void 0,this.#r=void 0),this.#b=!!this.#p,this.#D=!!this.#T,this.#d=!!this.#m,this.noDisposeOnSet=!!Se,this.noUpdateTTL=!!Me,this.noDeleteOnFetchRejection=!!St,this.allowStaleOnFetchRejection=!!Pt,this.allowStaleOnFetchAbort=!!Ct,this.ignoreFetchAbort=!!Mt,this.maxEntrySize!==0){if(this.#u!==0&&!ae(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!ae(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#_()}if(this.allowStale=!!A,this.noDeleteOnStaleGet=!!mt,this.updateAgeOnGet=!!u,this.updateAgeOnHas=!!M,this.ttlResolution=ae(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=a||0,this.ttl){if(!ae(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const Wt="LRU_CACHE_UNBOUNDED";B(Wt)&&(W.add(Wt),z("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Wt,j))}}getRemainingTTL(t){return this.#n.has(t)?1/0:0}#A(){const t=new F(this.#l),s=new F(this.#l);this.#f=t,this.#y=s,this.#W=(o,u,M=C.now())=>{if(s[o]=u!==0?M:0,t[o]=u,u!==0&&this.ttlAutopurge){const A=setTimeout(()=>{this.#h(o)&&this.#S(this.#s[o],"expire")},u+1);A.unref&&A.unref()}},this.#R=o=>{s[o]=t[o]!==0?C.now():0},this.#P=(o,u)=>{if(t[u]){const M=t[u],A=s[u];if(!M||!A)return;o.ttl=M,o.start=A,o.now=a||i();const se=o.now-A;o.remainingTTL=M-se}};let a=0;const i=()=>{const o=C.now();if(this.ttlResolution>0){a=o;const u=setTimeout(()=>a=0,this.ttlResolution);u.unref&&u.unref()}return o};this.getRemainingTTL=o=>{const u=this.#n.get(o);if(u===void 0)return 0;const M=t[u],A=s[u];if(!M||!A)return 1/0;const se=(a||i())-A;return M-se},this.#h=o=>{const u=s[o],M=t[o];return!!M&&!!u&&(a||i())-u>M}}#R=()=>{};#P=()=>{};#W=()=>{};#h=()=>!1;#_(){const t=new F(this.#l);this.#v=0,this.#x=t,this.#w=s=>{this.#v-=t[s],t[s]=0},this.#N=(s,a,i,o)=>{if(this.#t(a))return 0;if(!ae(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(a,s),!ae(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#j=(s,a,i)=>{if(t[s]=a,this.#u){const o=this.#u-t[s];for(;this.#v>o;)this.#Q(!0)}this.#v+=t[s],i&&(i.entrySize=a,i.totalCalculatedSize=this.#v)}}#w=t=>{};#j=(t,s,a)=>{};#N=(t,s,a,i)=>{if(a||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#L({allowStale:t=this.allowStale}={}){if(this.#a)for(let s=this.#i;!(!this.#B(s)||((t||!this.#h(s))&&(yield s),s===this.#o));)s=this.#g[s]}*#E({allowStale:t=this.allowStale}={}){if(this.#a)for(let s=this.#o;!(!this.#B(s)||((t||!this.#h(s))&&(yield s),s===this.#i));)s=this.#c[s]}#B(t){return t!==void 0&&this.#n.get(this.#s[t])===t}*entries(){for(const t of this.#L())this.#e[t]!==void 0&&this.#s[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#s[t],this.#e[t]])}*rentries(){for(const t of this.#E())this.#e[t]!==void 0&&this.#s[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#s[t],this.#e[t]])}*keys(){for(const t of this.#L()){const s=this.#s[t];s!==void 0&&!this.#t(this.#e[t])&&(yield s)}}*rkeys(){for(const t of this.#E()){const s=this.#s[t];s!==void 0&&!this.#t(this.#e[t])&&(yield s)}}*values(){for(const t of this.#L())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}*rvalues(){for(const t of this.#E())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,s={}){for(const a of this.#L()){const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;if(o!==void 0&&t(o,this.#s[a],this))return this.get(this.#s[a],s)}}forEach(t,s=this){for(const a of this.#L()){const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;o!==void 0&&t.call(s,o,this.#s[a],this)}}rforEach(t,s=this){for(const a of this.#E()){const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;o!==void 0&&t.call(s,o,this.#s[a],this)}}purgeStale(){let t=!1;for(const s of this.#E({allowStale:!0}))this.#h(s)&&(this.#S(this.#s[s],"expire"),t=!0);return t}info(t){const s=this.#n.get(t);if(s===void 0)return;const a=this.#e[s],i=this.#t(a)?a.__staleWhileFetching:a;if(i===void 0)return;const o={value:i};if(this.#f&&this.#y){const u=this.#f[s],M=this.#y[s];if(u&&M){const A=u-(C.now()-M);o.ttl=A,o.start=Date.now()}}return this.#x&&(o.size=this.#x[s]),o}dump(){const t=[];for(const s of this.#L({allowStale:!0})){const a=this.#s[s],i=this.#e[s],o=this.#t(i)?i.__staleWhileFetching:i;if(o===void 0||a===void 0)continue;const u={value:o};if(this.#f&&this.#y){u.ttl=this.#f[s];const M=C.now()-this.#y[s];u.start=Math.floor(Date.now()-M)}this.#x&&(u.size=this.#x[s]),t.unshift([a,u])}return t}load(t){this.clear();for(const[s,a]of t){if(a.start){const i=Date.now()-a.start;a.start=C.now()-i}this.set(s,a.value,a)}}set(t,s,a={}){if(s===void 0)return this.delete(t),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:u=this.noDisposeOnSet,sizeCalculation:M=this.sizeCalculation,status:A}=a;let{noUpdateTTL:se=this.noUpdateTTL}=a;const Pe=this.#N(t,s,a.size||0,M);if(this.maxEntrySize&&Pe>this.maxEntrySize)return A&&(A.set="miss",A.maxEntrySizeExceeded=!0),this.#S(t,"set"),this;let ve=this.#a===0?void 0:this.#n.get(t);if(ve===void 0)ve=this.#a===0?this.#i:this.#O.length!==0?this.#O.pop():this.#a===this.#l?this.#Q(!1):this.#a,this.#s[ve]=t,this.#e[ve]=s,this.#n.set(t,ve),this.#c[this.#i]=ve,this.#g[ve]=this.#i,this.#i=ve,this.#a++,this.#j(ve,Pe,A),A&&(A.set="add"),se=!1,this.#D&&this.#T?.(s,t,"add");else{this.#$(ve);const Se=this.#e[ve];if(s!==Se){if(this.#C&&this.#t(Se)){Se.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:Me}=Se;Me!==void 0&&!u&&(this.#b&&this.#p?.(Me,t,"set"),this.#d&&this.#r?.push([Me,t,"set"]))}else u||(this.#b&&this.#p?.(Se,t,"set"),this.#d&&this.#r?.push([Se,t,"set"]));if(this.#w(ve),this.#j(ve,Pe,A),this.#e[ve]=s,A){A.set="replace";const Me=Se&&this.#t(Se)?Se.__staleWhileFetching:Se;Me!==void 0&&(A.oldValue=Me)}}else A&&(A.set="update");this.#D&&this.onInsert?.(s,t,s===Se?"update":"replace")}if(i!==0&&!this.#f&&this.#A(),this.#f&&(se||this.#W(ve,i,o),A&&this.#P(A,ve)),!u&&this.#d&&this.#r){const Se=this.#r;let Me;for(;Me=Se?.shift();)this.#m?.(...Me)}return this}pop(){try{for(;this.#a;){const t=this.#e[this.#o];if(this.#Q(!0),this.#t(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#d&&this.#r){const t=this.#r;let s;for(;s=t?.shift();)this.#m?.(...s)}}}#Q(t){const s=this.#o,a=this.#s[s],i=this.#e[s];return this.#C&&this.#t(i)?i.__abortController.abort(new Error("evicted")):(this.#b||this.#d)&&(this.#b&&this.#p?.(i,a,"evict"),this.#d&&this.#r?.push([i,a,"evict"])),this.#w(s),t&&(this.#s[s]=void 0,this.#e[s]=void 0,this.#O.push(s)),this.#a===1?(this.#o=this.#i=0,this.#O.length=0):this.#o=this.#c[s],this.#n.delete(a),this.#a--,s}has(t,s={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:i}=s,o=this.#n.get(t);if(o!==void 0){const u=this.#e[o];if(this.#t(u)&&u.__staleWhileFetching===void 0)return!1;if(this.#h(o))i&&(i.has="stale",this.#P(i,o));else return a&&this.#R(o),i&&(i.has="hit",this.#P(i,o)),!0}else i&&(i.has="miss");return!1}peek(t,s={}){const{allowStale:a=this.allowStale}=s,i=this.#n.get(t);if(i===void 0||!a&&this.#h(i))return;const o=this.#e[i];return this.#t(o)?o.__staleWhileFetching:o}#I(t,s,a,i){const o=s===void 0?void 0:this.#e[s];if(this.#t(o))return o;const u=new N,{signal:M}=a;M?.addEventListener("abort",()=>u.abort(M.reason),{signal:u.signal});const A={signal:u.signal,options:a,context:i},se=(ke,et=!1)=>{const{aborted:_e}=u.signal,it=a.ignoreFetchAbort&&ke!==void 0;if(a.status&&(_e&&!et?(a.status.fetchAborted=!0,a.status.fetchError=u.signal.reason,it&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),_e&&!it&&!et)return ve(u.signal.reason);const St=Me;return this.#e[s]===Me&&(ke===void 0?St.__staleWhileFetching?this.#e[s]=St.__staleWhileFetching:this.#S(t,"fetch"):(a.status&&(a.status.fetchUpdated=!0),this.set(t,ke,A.options))),ke},Pe=ke=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=ke),ve(ke)),ve=ke=>{const{aborted:et}=u.signal,_e=et&&a.allowStaleOnFetchAbort,it=_e||a.allowStaleOnFetchRejection,St=it||a.noDeleteOnFetchRejection,mt=Me;if(this.#e[s]===Me&&(!St||mt.__staleWhileFetching===void 0?this.#S(t,"fetch"):_e||(this.#e[s]=mt.__staleWhileFetching)),it)return a.status&&mt.__staleWhileFetching!==void 0&&(a.status.returnedStale=!0),mt.__staleWhileFetching;if(mt.__returned===mt)throw ke},Se=(ke,et)=>{const _e=this.#F?.(t,o,A);_e&&_e instanceof Promise&&_e.then(it=>ke(it===void 0?void 0:it),et),u.signal.addEventListener("abort",()=>{(!a.ignoreFetchAbort||a.allowStaleOnFetchAbort)&&(ke(void 0),a.allowStaleOnFetchAbort&&(ke=it=>se(it,!0)))})};a.status&&(a.status.fetchDispatched=!0);const Me=new Promise(Se).then(se,Pe),Ne=Object.assign(Me,{__abortController:u,__staleWhileFetching:o,__returned:void 0});return s===void 0?(this.set(t,Ne,{...A.options,status:void 0}),s=this.#n.get(t)):this.#e[s]=Ne,Ne}#t(t){if(!this.#C)return!1;const s=t;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof N}async fetch(t,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:u=this.ttl,noDisposeOnSet:M=this.noDisposeOnSet,size:A=0,sizeCalculation:se=this.sizeCalculation,noUpdateTTL:Pe=this.noUpdateTTL,noDeleteOnFetchRejection:ve=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:Se=this.allowStaleOnFetchRejection,ignoreFetchAbort:Me=this.ignoreFetchAbort,allowStaleOnFetchAbort:Ne=this.allowStaleOnFetchAbort,context:ke,forceRefresh:et=!1,status:_e,signal:it}=s;if(!this.#C)return _e&&(_e.fetch="get"),this.get(t,{allowStale:a,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:_e});const St={allowStale:a,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:u,noDisposeOnSet:M,size:A,sizeCalculation:se,noUpdateTTL:Pe,noDeleteOnFetchRejection:ve,allowStaleOnFetchRejection:Se,allowStaleOnFetchAbort:Ne,ignoreFetchAbort:Me,status:_e,signal:it};let mt=this.#n.get(t);if(mt===void 0){_e&&(_e.fetch="miss");const Pt=this.#I(t,mt,St,ke);return Pt.__returned=Pt}else{const Pt=this.#e[mt];if(this.#t(Pt)){const Ut=a&&Pt.__staleWhileFetching!==void 0;return _e&&(_e.fetch="inflight",Ut&&(_e.returnedStale=!0)),Ut?Pt.__staleWhileFetching:Pt.__returned=Pt}const Ct=this.#h(mt);if(!et&&!Ct)return _e&&(_e.fetch="hit"),this.#$(mt),i&&this.#R(mt),_e&&this.#P(_e,mt),Pt;const Mt=this.#I(t,mt,St,ke),Wt=Mt.__staleWhileFetching!==void 0&&a;return _e&&(_e.fetch=Ct?"stale":"refresh",Wt&&Ct&&(_e.returnedStale=!0)),Wt?Mt.__staleWhileFetching:Mt.__returned=Mt}}async forceFetch(t,s={}){const a=await this.fetch(t,s);if(a===void 0)throw new Error("fetch() returned undefined");return a}memo(t,s={}){const a=this.#M;if(!a)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:o,...u}=s,M=this.get(t,u);if(!o&&M!==void 0)return M;const A=a(t,M,{options:u,context:i});return this.set(t,A,u),A}get(t,s={}){const{allowStale:a=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:u}=s,M=this.#n.get(t);if(M!==void 0){const A=this.#e[M],se=this.#t(A);return u&&this.#P(u,M),this.#h(M)?(u&&(u.get="stale"),se?(u&&a&&A.__staleWhileFetching!==void 0&&(u.returnedStale=!0),a?A.__staleWhileFetching:void 0):(o||this.#S(t,"expire"),u&&a&&(u.returnedStale=!0),a?A:void 0)):(u&&(u.get="hit"),se?A.__staleWhileFetching:(this.#$(M),i&&this.#R(M),A))}else u&&(u.get="miss")}#U(t,s){this.#g[s]=t,this.#c[t]=s}#$(t){t!==this.#i&&(t===this.#o?this.#o=this.#c[t]:this.#U(this.#g[t],this.#c[t]),this.#U(this.#i,t),this.#i=t)}delete(t){return this.#S(t,"delete")}#S(t,s){let a=!1;if(this.#a!==0){const i=this.#n.get(t);if(i!==void 0)if(a=!0,this.#a===1)this.#k(s);else{this.#w(i);const o=this.#e[i];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#b||this.#d)&&(this.#b&&this.#p?.(o,t,s),this.#d&&this.#r?.push([o,t,s])),this.#n.delete(t),this.#s[i]=void 0,this.#e[i]=void 0,i===this.#i)this.#i=this.#g[i];else if(i===this.#o)this.#o=this.#c[i];else{const u=this.#g[i];this.#c[u]=this.#c[i];const M=this.#c[i];this.#g[M]=this.#g[i]}this.#a--,this.#O.push(i)}}if(this.#d&&this.#r?.length){const i=this.#r;let o;for(;o=i?.shift();)this.#m?.(...o)}return a}clear(){return this.#k("delete")}#k(t){for(const s of this.#E({allowStale:!0})){const a=this.#e[s];if(this.#t(a))a.__abortController.abort(new Error("deleted"));else{const i=this.#s[s];this.#b&&this.#p?.(a,i,t),this.#d&&this.#r?.push([a,i,t])}}if(this.#n.clear(),this.#e.fill(void 0),this.#s.fill(void 0),this.#f&&this.#y&&(this.#f.fill(0),this.#y.fill(0)),this.#x&&this.#x.fill(0),this.#o=0,this.#i=0,this.#O.length=0,this.#v=0,this.#a=0,this.#d&&this.#r){const s=this.#r;let a;for(;a=s?.shift();)this.#m?.(...a)}}}var f=n(94644),X=n(22592),V=n(22420),ie=n(24162),je=n(32783),L=n(69457),d=n(12282);const p=1e6,c="{}",T=["__aggregated_metric__","__tenant_id__","__stream_shard__"];class k extends f.Is{constructor(t,s){super(),this.started=!1,this.seriesCache=new j({max:10}),this.labelsCache=new j({max:10}),this.detectedFieldValuesCache=new j({max:10}),this.labelsPromisesCache=new j({max:10}),this.detectedLabelValuesPromisesCache=new j({max:10}),this.request=async(a,i,o,u)=>{try{return await this.datasource.metadataRequest(a,i,u)}catch(M){if(o)throw M;console.error(M)}},this.start=a=>{const i=a??this.getDefaultTimeRange(),o=this.datasource.getTimeRangeParams(i),u=this.startedTimeRange?this.datasource.getTimeRangeParams(this.startedTimeRange):null;return(!this.startTask||!u||o.start!==u.start||o.end!==u.end)&&(this.startedTimeRange=i,this.startTask=this.fetchLabels({timeRange:i}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(a,i)=>{const o=this.datasource.interpolateString(a),u="series",M=i?.timeRange??this.getDefaultTimeRange(),{start:A,end:se}=this.datasource.getTimeRangeParams(M),Pe=this.generateCacheKey(u,A,se,o);let ve=this.seriesCache.get(Pe);if(!ve){const Se={"match[]":o,start:A,end:se},Me=await this.request(u,Se);if(!Array.isArray(Me))return{};const{values:Ne}=(0,V.P7)(Me);ve=Ne,this.seriesCache.set(Pe,ve)}return ve},this.fetchSeries=async(a,i)=>{const o="series",u=i?.timeRange??this.getDefaultTimeRange(),{start:M,end:A}=this.datasource.getTimeRangeParams(u),se={"match[]":a,start:M,end:A};return await this.request(o,se)},this.datasource=t,this.labelKeys=[],Object.assign(this,s)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(t){return{refId:t.refId,expr:(0,V.tt)(t),queryType:d.U3.Range}}exportToAbstractQuery(t){if(!t.expr||t.expr.length===0)return{refId:t.refId,labelMatchers:[]};const a=(0,ie.pk)(t.expr).map(i=>(0,je.u_)(i).query.labels.map(M=>({name:M.label,value:M.value,operator:V.sM[M.op]})));return{refId:t.refId,labelMatchers:(0,e.flatten)(a)}}async fetchLabels(t){if(b.$.featureToggles.lokiLabelNamesQueryApi||!t?.streamSelector)return this.fetchLabelsByLabelsEndpoint(t);{const s=await this.fetchSeriesLabels(t.streamSelector,{timeRange:t.timeRange});return Object.keys(s??{})}}async fetchLabelsByLabelsEndpoint(t){const s="labels",a=t?.timeRange??this.getDefaultTimeRange(),{start:i,end:o}=this.datasource.getTimeRangeParams(a),u={start:i,end:o};t?.streamSelector&&t?.streamSelector!==c&&(u.query=t.streamSelector);const M=await this.request(s,u);if(Array.isArray(M)){const A=Array.from(new Set(M)).slice().sort().filter(se=>T.includes(se)===!1);return this.labelKeys=A,this.labelKeys}return[]}generateCacheKey(t,s,a,i){return[t,this.roundTime(s),this.roundTime(a),i].join()}roundTime(t){return t?Math.floor(t/p/1e3/60/5):0}async fetchDetectedFields(t,s){const a=t.expr&&t.expr!==c?this.datasource.interpolateString(t.expr,t.scopedVars):void 0;if(!a)throw new Error("fetchDetectedFields requires query expression");const i="detected_fields",o=t?.timeRange??this.getDefaultTimeRange(),u=this.datasource.getTimeRangeParams(o),{start:M,end:A}=u,se={start:M,end:A,limit:t?.limit??1e3};return se.query=a,new Promise(async(Pe,ve)=>{try{const Se=await this.request(i,se,!0,s);Pe(Se)}catch(Se){console.error("error",Se),ve(Se)}})}async fetchDetectedFieldValues(t,s,a){return this.fetchDetectedLabelValues(t,s,a)}async fetchDetectedLabelValues(t,s,a){const i=encodeURIComponent(this.datasource.interpolateString(t)),o=s?.expr&&s.expr!==c?this.datasource.interpolateString(s.expr,s.scopedVars):void 0,u=`detected_field/${i}/values`,M=s?.timeRange??this.getDefaultTimeRange(),A=this.datasource.getTimeRangeParams(M),{start:se,end:Pe}=A,ve={start:se,end:Pe,limit:s?.limit??1e3};let Se=i;o&&(ve.query=o,Se+=o);const Me=this.generateCacheKey(u,se,Pe,Se),Ne=this.detectedFieldValuesCache.get(Me);if(Ne)return Ne;let ke=this.detectedLabelValuesPromisesCache.get(Me);return ke||(ke=new Promise(async(et,_e)=>{try{const it=await this.request(u,ve,s?.throwError,a);if(Array.isArray(it)){const St=it.slice().sort();this.detectedFieldValuesCache.set(Me,St),this.detectedLabelValuesPromisesCache.delete(Me),et(St)}}catch(it){s?.throwError?_e(it):(console.error(it),et([]))}}),this.detectedLabelValuesPromisesCache.set(Me,ke),ke)}async fetchLabelValues(t,s){const a=encodeURIComponent(this.datasource.interpolateString(t)),i=s?.streamSelector&&s.streamSelector!==c?this.datasource.interpolateString(s.streamSelector):void 0,o=`label/${a}/values`,u=s?.timeRange??this.getDefaultTimeRange(),M=this.datasource.getTimeRangeParams(u),{start:A,end:se}=M,Pe={start:A,end:se};let ve=a;i&&(Pe.query=i,ve+=i);const Se=this.generateCacheKey(o,A,se,ve),Me=this.labelsCache.get(Se);if(Me)return Me;let Ne=this.labelsPromisesCache.get(Se);return Ne||(Ne=new Promise(async ke=>{try{const et=await this.request(o,Pe);if(Array.isArray(et)){const _e=et.slice().sort();this.labelsCache.set(Se,_e),this.labelsPromisesCache.delete(Se),ke(_e)}}catch(et){console.error(et),ke([])}}),this.labelsPromisesCache.set(Se,Ne),Ne)}async getParserAndLabelKeys(t,s){const a={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1},i=await this.datasource.getDataSamples({expr:t,refId:"data-samples",maxLines:s?.maxLines||bs},s?.timeRange??this.getDefaultTimeRange());if(!i.length)return a;const{hasLogfmt:o,hasJSON:u,hasPack:M}=(0,L.YB)(i[0]);return{extractedLabelKeys:[...(0,L.fV)(i[0],d.HD.Indexed),...(0,L.fV)(i[0],d.HD.Parsed)],structuredMetadataKeys:(0,L.fV)(i[0],d.HD.StructuredMetadata),unwrapLabelKeys:(0,L.aN)(i[0]),hasJSON:u,hasPack:M,hasLogfmt:o}}getDefaultTimeRange(){return(0,X.E2)()}}var te=n(39697),fe=n(37748),le=n(69862),x=n(69850),R=n(31635),w=n(13752),K=n(75508),ce=n(88483),y=n(64423),oe=n(39741),pe={url:"",deserializer:function(S){return JSON.parse(S.data)},serializer:function(S){return JSON.stringify(S)}},me="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Te=function(S){(0,R.__extends)(t,S);function t(s,a){var i=S.call(this)||this;if(i._socket=null,s instanceof ce.c)i.destination=a,i.source=s;else{var o=i._config=(0,R.__assign)({},pe);if(i._output=new w.B,typeof s=="string")o.url=s;else for(var u in s)s.hasOwnProperty(u)&&(o[u]=s[u]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new oe.m}return i}return t.prototype.lift=function(s){var a=new t(this._config,this.destination);return a.operator=s,a.source=this,a},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new oe.m),this._output=new w.B},t.prototype.multiplex=function(s,a,i){var o=this;return new ce.c(function(u){try{o.next(s())}catch(A){u.error(A)}var M=o.subscribe({next:function(A){try{i(A)&&u.next(A)}catch(se){u.error(se)}},error:function(A){return u.error(A)},complete:function(){return u.complete()}});return function(){try{o.next(a())}catch(A){u.error(A)}M.unsubscribe()}})},t.prototype._connectSocket=function(){var s=this,a=this._config,i=a.WebSocketCtor,o=a.protocol,u=a.url,M=a.binaryType,A=this._output,se=null;try{se=o?new i(u,o):new i(u),this._socket=se,M&&(this._socket.binaryType=M)}catch(ve){A.error(ve);return}var Pe=new y.yU(function(){s._socket=null,se&&se.readyState===1&&se.close()});se.onopen=function(ve){var Se=s._socket;if(!Se){se.close(),s._resetState();return}var Me=s._config.openObserver;Me&&Me.next(ve);var Ne=s.destination;s.destination=K.vU.create(function(ke){if(se.readyState===1)try{var et=s._config.serializer;se.send(et(ke))}catch(_e){s.destination.error(_e)}},function(ke){var et=s._config.closingObserver;et&&et.next(void 0),ke&&ke.code?se.close(ke.code,ke.reason):A.error(new TypeError(me)),s._resetState()},function(){var ke=s._config.closingObserver;ke&&ke.next(void 0),se.close(),s._resetState()}),Ne&&Ne instanceof oe.m&&Pe.add(Ne.subscribe(s.destination))},se.onerror=function(ve){s._resetState(),A.error(ve)},se.onclose=function(ve){se===s._socket&&s._resetState();var Se=s._config.closeObserver;Se&&Se.next(ve),ve.wasClean?A.complete():A.error(ve)},se.onmessage=function(ve){try{var Se=s._config.deserializer;A.next(Se(ve))}catch(Me){A.error(Me)}}},t.prototype._subscribe=function(s){var a=this,i=this.source;return i?i.subscribe(s):(this._socket||this._connectSocket(),this._output.subscribe(s),s.add(function(){var o=a._socket;a._output.observers.length===0&&(o&&(o.readyState===1||o.readyState===0)&&o.close(),a._resetState())}),s)},t.prototype.unsubscribe=function(){var s=this._socket;s&&(s.readyState===1||s.readyState===0)&&s.close(),this._resetState(),S.prototype.unsubscribe.call(this)},t}(w.k);function Oe(S){return new Te(S)}var xe=n(35479),be=n(95004);function ye(S,t,s,a){switch(S){case 0:return t&s^~t&a;case 1:return t^s^a;case 2:return t&s^t&a^s&a;case 3:return t^s^a}}function Be(S,t){return S<<t|S>>>32-t}function Ae(S){const t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520],a=new Uint8Array(S.length+1);a.set(S),a[S.length]=128,S=a;const i=S.length/4+2,o=Math.ceil(i/16),u=new Array(o);for(let M=0;M<o;++M){const A=new Uint32Array(16);for(let se=0;se<16;++se)A[se]=S[M*64+se*4]<<24|S[M*64+se*4+1]<<16|S[M*64+se*4+2]<<8|S[M*64+se*4+3];u[M]=A}u[o-1][14]=(S.length-1)*8/Math.pow(2,32),u[o-1][14]=Math.floor(u[o-1][14]),u[o-1][15]=(S.length-1)*8&4294967295;for(let M=0;M<o;++M){const A=new Uint32Array(80);for(let Ne=0;Ne<16;++Ne)A[Ne]=u[M][Ne];for(let Ne=16;Ne<80;++Ne)A[Ne]=Be(A[Ne-3]^A[Ne-8]^A[Ne-14]^A[Ne-16],1);let se=s[0],Pe=s[1],ve=s[2],Se=s[3],Me=s[4];for(let Ne=0;Ne<80;++Ne){const ke=Math.floor(Ne/20),et=Be(se,5)+ye(ke,Pe,ve,Se)+Me+t[ke]+A[Ne]>>>0;Me=Se,Se=ve,ve=Be(Pe,30)>>>0,Pe=se,se=et}s[0]=s[0]+se>>>0,s[1]=s[1]+Pe>>>0,s[2]=s[2]+ve>>>0,s[3]=s[3]+Se>>>0,s[4]=s[4]+Me>>>0}return Uint8Array.of(s[0]>>24,s[0]>>16,s[0]>>8,s[0],s[1]>>24,s[1]>>16,s[1]>>8,s[1],s[2]>>24,s[2]>>16,s[2]>>8,s[2],s[3]>>24,s[3]>>16,s[3]>>8,s[3],s[4]>>24,s[4]>>16,s[4]>>8,s[4])}const ze=Ae;var Ye=n(41391);function st(S){if(!(0,Ye.A)(S))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(S.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(S.slice(9,13),16))>>>8,t&255,(t=parseInt(S.slice(14,18),16))>>>8,t&255,(t=parseInt(S.slice(19,23),16))>>>8,t&255,(t=parseInt(S.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}const He=st;var Xe=n(71060);function nt(S){S=unescape(encodeURIComponent(S));const t=new Uint8Array(S.length);for(let s=0;s<S.length;++s)t[s]=S.charCodeAt(s);return t}const at="6ba7b810-9dad-11d1-80b4-00c04fd430c8",vt="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ee(S,t,s,a,i,o){const u=typeof s=="string"?nt(s):s,M=typeof a=="string"?He(a):a;if(typeof a=="string"&&(a=He(a)),a?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let A=new Uint8Array(16+u.length);if(A.set(M),A.set(u,M.length),A=t(A),A[6]=A[6]&15|S,A[8]=A[8]&63|128,i){o=o||0;for(let se=0;se<16;++se)i[o+se]=A[se];return i}return(0,Xe.k)(A)}function Qe(S,t,s,a){return Ee(80,ze,S,t,s,a)}Qe.DNS=at,Qe.URL=vt;const We=Qe,Ce="6ec946da-0f49-47a8-983a-1d76d17e7c92";function Re(S,t){const s=S.streams;if(!s||!s.length)return;const a=t.fields[0],i=t.fields[1],o=t.fields[2],u={};for(const M of s){const A=Object.entries(M.stream).map(([se,Pe])=>`${se}="${Pe}"`).sort().join("");for(const[se,Pe]of M.values)a.values.push(new Date(parseInt(se.slice(0,-6),10)).toISOString()),i.values.push(Pe),o.values.push($e(se,A,Pe,u,t.refId))}}function $e(S,t,s,a,i){let o=We(`${S}_${t}_${s}`,Ce);if(o in a){const u=a[o]+1;a[o]=u,o=`${o}_${u}`}else a[o]=0;return i?`${i}_${o}`:o}class Ve{constructor(){this.streams={}}getStream(t,s=5e3){let a=this.streams[t.url];if(a)return a;const i=new xe.x({capacity:t.size});return i.addField({name:"Time",type:be.PU.time,config:{}}),i.addField({name:"Line",type:be.PU.string}),i.addField({name:"id",type:be.PU.string}),i.meta={...i.meta,preferredVisualisationType:"logs"},i.refId=t.refId,a=Oe(t.url).pipe((0,Y.T)(o=>(Re(o,i),[i])),(0,fe.l)(o=>o.pipe((0,le.Z)((u,M)=>{const A=M+1;return u.code===1006&&A<30?(A>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${u.reason}`),(0,te.O)(s)):(0,l.$)(u)}))),(0,x.j)(()=>{delete this.streams[t.url]})),this.streams[t.url]=a,a}}var Ie=n(25229),$=n(10279),O=n(74848),ge=n(22803),ee=n(96540),ue=n(16817),De=n(67458),Fe=n(54078),re=n(27489),Ke=n(63142),Ue=n(34999),Ze=n(45967),pt=n(45861),Ge=n(89599),ut=n(30703),ct=n(68079),ot=n(72636),Je=n(18857),Ot=n(97095),ft=n(18027),ht=n(70663),Lt=n(21285),lt=n(77236);function Et(S){return{labels:(0,ge.css)({display:"flex",gap:S.spacing(.5)}),wrapper:(0,ge.css)({display:"flex",flexDirection:"column",flex:1,gap:S.spacing(.5),position:"relative"}),textWrapper:(0,ge.css)({display:"flex",alignItems:"center"}),hidden:(0,ge.css)({visibility:"hidden"}),label:(0,ge.css)({maxWidth:"100%","&:first-of-type":{marginBottom:S.spacing(2)},"&:not(:first-of-type)":{margin:S.spacing(2,0)}}),rawQueryContainer:(0,ge.css)({textAlign:"start",lineBreak:"anywhere",marginTop:S.spacing(-.25),marginRight:S.spacing(6),minHeight:S.spacing(4)}),ui:(0,ge.css)({backgroundColor:S.colors.background.secondary,padding:S.spacing(2)}),notification:(0,ge.css)({position:"absolute",zIndex:S.zIndex.portal,top:0,right:0}),rawQuery:(0,ge.css)({display:"inline"}),queryDescription:(0,ge.css)({marginLeft:S.spacing(.5)}),iconButton:(0,ge.css)({position:"absolute",top:S.spacing(1),right:S.spacing(1),zIndex:S.zIndex.navbarFixed}),operationsToggle:(0,ge.css)({margin:S.spacing(1,0,-1,0),"& > div":{margin:0,"& > label":{padding:0}}})}}const xt="isLogContextQueryUiOpen";function wt(S){const{row:t,logContextProvider:s,updateFilter:a,onClose:i,origQuery:o,runContextQuery:u}=S,M=(0,Ke.of)(Et),[A,se]=(0,ee.useState)([]),[Pe,ve]=(0,ee.useState)(!1),[Se,Me]=(0,ee.useState)(!1),[Ne,ke]=(0,ee.useState)(!1),[et,_e]=(0,ee.useState)(window.localStorage.getItem(xt)==="true"),[it,St]=(0,ee.useState)(window.localStorage.getItem($t)==="true"),mt=(0,ee.useRef)(),Pt=(0,ee.useRef)(!1),Ct=(0,ee.useRef)([]),Mt=(0,ee.useMemo)(()=>!(Se&&A.some(rt=>rt.nonIndexed===rt.enabled)||it&&s.queryContainsValidPipelineStages(o)),[A,it,Se,s,o]);(0,ee.useEffect)(()=>{if(Se){if(!Pt.current){Pt.current=Se;return}if(A.filter(({enabled:rt,nonIndexed:Qt})=>rt&&!Qt).length===0){se(Ct.current);return}return Ct.current=structuredClone(A),mt.current&&clearTimeout(mt.current),ke(!0),mt.current=window.setTimeout(()=>{a(A.filter(({enabled:Qt})=>Qt));const rt={removedLabels:[],selectedExtractedLabels:[]};A.forEach(({enabled:Qt,nonIndexed:Dt,label:ds})=>{!Qt&&!Dt&&rt.removedLabels.push(ds),Qt&&Dt&&rt.selectedExtractedLabels.push(ds)}),window.localStorage.setItem(gt,JSON.stringify(rt)),ke(!1)},1500),()=>{clearTimeout(mt.current)}}},[A,Se]),(0,ee.useEffect)(()=>()=>{clearTimeout(mt.current),i()},[i]),(0,ue.A)(async()=>{ke(!0);const rt=await s.getInitContextFilters(t,o,{from:(0,Ie.KQ)(t.timeEpochMs),to:(0,Ie.KQ)(t.timeEpochMs),raw:{from:(0,Ie.KQ)(t.timeEpochMs),to:(0,Ie.KQ)(t.timeEpochMs)}});se(rt.contextFilters),ve(rt.preservedFiltersApplied),Me(!0),ke(!1)}),(0,ee.useEffect)(()=>{Pe&&setTimeout(()=>{ve(!1)},2e3)},[Pe]),(0,ee.useEffect)(()=>((0,re.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"load"}),()=>{(0,re.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"unload"})}),[t.uid]);const bt=A.filter(({nonIndexed:rt})=>!rt),Wt=bt.filter(({enabled:rt})=>rt),Ut=A.filter(({nonIndexed:rt})=>rt),Us=Ut.filter(({enabled:rt})=>rt),Cs=(0,ee.useCallback)(rt=>({label:`${rt.label}="${(0,V.Bb)(rt.value)}"`,value:rt.label}),[]),dn=Ut.length>0;let un=s.prepareExpression(A.filter(({enabled:rt})=>rt),o);return(0,O.jsxs)("div",{className:M.wrapper,children:[Pe&&(0,O.jsx)(Ue.F,{className:M.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),(0,O.jsx)(Ze.m,{content:"Revert to initial log context query.",children:(0,O.jsx)("div",{className:M.iconButton,children:(0,O.jsx)(pt.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:Mt,onClick:rt=>{(0,re.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:t.uid}),se(Qt=>Qt.map(Dt=>({...Dt,enabled:!Dt.nonIndexed}))),window.localStorage.removeItem(gt),window.localStorage.removeItem($t),St(!1)}})})}),(0,O.jsx)(Ge.S,{collapsible:!0,isOpen:et,onToggle:()=>{window.localStorage.setItem(xt,(!et).toString()),_e(rt=>!rt),(0,re.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:t.uid,action:et?"close":"open"})},label:(0,O.jsx)("div",{className:M.rawQueryContainer,children:Se?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Fe.Z,{language:{grammar:lt.vB,name:"loki"},query:un,className:M.rawQuery}),(0,O.jsx)(Ze.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query.",children:(0,O.jsx)(ut.I,{name:"info-circle",size:"sm",className:M.queryDescription})})]}):(0,O.jsx)(ct.y,{})}),children:(0,O.jsxs)("div",{className:M.ui,children:[(0,O.jsx)(ot.J,{className:M.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters.",children:"Widen the search"}),(0,O.jsx)(Je.KF,{isLoading:Ne,options:bt.map(Cs),value:Wt.map(Cs),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(rt,Qt)=>(Qt.action==="select-option"&&(0,re.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"select"}),Qt.action==="remove-value"&&(0,re.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"remove"}),se(A.map(Dt=>(Dt.nonIndexed||(Dt.enabled=rt.some(ds=>ds.value===Dt.label)),Dt))))}),dn&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ot.J,{className:M.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line.",children:"Refine the search"}),(0,O.jsx)(Je.KF,{isLoading:Ne,options:Ut.map(Cs),value:Us.map(Cs),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(rt,Qt)=>{Qt.action==="select-option"&&(0,re.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"select"}),Qt.action==="remove-value"&&(0,re.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"remove"}),se(A.map(Dt=>(Dt.nonIndexed&&(Dt.enabled=rt.some(ds=>ds.value===Dt.label)),Dt)))}})]}),s.queryContainsValidPipelineStages(o)&&(0,O.jsx)(Ot.C,{className:M.operationsToggle,children:(0,O.jsx)(ft.I,{label:"Include LogQL pipeline operations",tooltip:(0,O.jsx)(ht.I,{content:(0,De.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")}),children:(0,O.jsx)(Lt.K,{value:it,showLabel:!0,transparent:!0,onChange:rt=>{(0,re.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:t.uid,action:rt.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem($t,rt.currentTarget.checked.toString()),St(rt.currentTarget.checked),u&&u()}})})})]})})]})}var qe=n(76160),It=(S=>(S[S.Ascending=0]="Ascending",S[S.Descending=1]="Descending",S))(It||{});function Tt(S,t){const s=S.values,{nanos:a}=S,i=Array(s.length);for(let u=0;u<i.length;u++)i[u]=u;const o=t===0;return i.sort((u,M)=>{const A=s[u],se=s[M];if(A<se)return o?-1:1;if(A>se)return o?1:-1;if(a===void 0)return 0;const Pe=a[u],ve=a[M];return Pe<ve?o?-1:1:Pe>ve?o?1:-1:0}),i}function yt(S,t){const{fields:s,...a}=S,i=s.find(u=>u.type===be.PU.time);if(i===void 0)throw new Error("missing timestamp field. should never happen");const o=Tt(i,t);return{...a,fields:s.map(u=>({...u,values:At(u.values,o),nanos:u.nanos===void 0?void 0:At(u.nanos,o)}))}}function At(S,t){return S.map((s,a)=>S[t[a]])}const gt="lokiLogContextPreservedLabels",$t="lokiLogContextShouldIncludePipelineOperations";class Nt{constructor(t){this.getLogRowContextQuery=async(s,a,i,o=!0)=>{i&&a?.scopedVars&&(i=this.datasource.applyTemplateVariables(i,a?.scopedVars));const{query:u}=await this.getQueryAndRange(s,a,i,o);return o||(this.cachedContextFilters=[]),u},this.getLogRowContext=async(s,a,i)=>{i&&a?.scopedVars&&(i=this.datasource.applyTemplateVariables(i,a?.scopedVars));const o=a&&a.direction||h.ZF.Backward,{query:u,range:M}=await this.getQueryAndRange(s,a,i),A=Pe=>{const Se=Pe.data.map(Me=>yt(Me,It.Descending));return{...Pe,data:Se}},se=E.Jk.Explore;return(0,J.s)(this.datasource.query(Ps(u,M,se,`${Es}${o}`)).pipe((0,m.W)(Pe=>{throw{message:"Error during context query. Please check JS console logs.",status:Pe.status,statusText:Pe.statusText}}),(0,I.n)(Pe=>(0,r.of)(A(Pe)))))},this.processContextFiltersToExpr=(s,a)=>{let o=`{${s.map(u=>!u.nonIndexed&&u.enabled?`${u.label}="${(0,V.Qn)(u.value)}"`:"").filter(u=>!!u).join(",")}}`;if(a){let u=!1;if((0,ie.MX)(a.expr).parserCount===1){u=!0;const A=(0,ie.aw)(a.expr);A&&(o=(0,qe.aH)(o,A))}const M=s.filter(A=>A.nonIndexed&&A.enabled);for(const A of M)A.enabled&&(o=(0,qe.tE)(o,A.label,"=",A.value,u?d.HD.Parsed:d.HD.StructuredMetadata))}return o},this.processPipelineStagesToExpr=(s,a)=>{let i=s;const o=a?.expr??"";if((0,ie.MX)(o).parserCount>1)return i;const u=(0,ie.TQ)(o,[U.t3,U.iT,U.c$,U.LM,U.CX,U.bY]),M=u.filter(se=>se.type?.id===U.t3),A=u.filter(se=>se.type?.id!==U.t3);for(const se of M)A.some(Pe=>se.contains(Pe))||(i+=` ${se.getExpression(o)}`);return i},this.queryContainsValidPipelineStages=s=>{const a=s?.expr??"",i=(0,ie.TQ)(a,[U.t3,U.iT,U.CX,U.bY]),o=i.filter(M=>M.type?.id===U.t3),u=i.filter(M=>M.type?.id!==U.t3);return o.some(M=>u.every(A=>M.contains(A)===!1))},this.getInitContextFilters=async(s,a,i)=>{let o=!1;if(!a||(0,e.isEmpty)(s.labels))return{contextFilters:[],preservedFiltersApplied:o};const u=s.labels;let M=[];if(!(0,ie.MX)(a.expr).queryWithParser)await this.datasource.languageProvider.start(i),M=this.datasource.languageProvider.getLabelKeys();else{const ve=(0,ie.pk)(a.expr);M=await this.datasource.languageProvider.fetchLabels({streamSelector:ve[0],timeRange:i})}const A=[];Object.entries(u).forEach(([ve,Se])=>{const Me=(0,V.Ed)(ve,s.dataFrame,s.rowIndex),Ne={label:ve,value:Se,enabled:M.includes(ve),nonIndexed:Me!==null&&Me!==d.HD.Indexed};A.push(Ne)});let se;const Pe=window.localStorage.getItem(gt);if(Pe)try{se=JSON.parse(Pe)}catch{}if(se){let ve=!1;const Se=A.map(Ne=>se.removedLabels.includes(Ne.label)?(ve=!0,{...Ne,enabled:!1}):se.selectedExtractedLabels.includes(Ne.label)?(ve=!0,{...Ne,enabled:!0}):{...Ne});return Se.some(({enabled:Ne,nonIndexed:ke})=>Ne&&!ke)?(ve&&(o=!0),{contextFilters:Se,preservedFiltersApplied:o}):{contextFilters:A,preservedFiltersApplied:o}}else return{contextFilters:A,preservedFiltersApplied:o}},this.datasource=t,this.cachedContextFilters=[]}async getQueryAndRange(t,s,a,i=!0){const o=s&&s.direction||h.ZF.Backward,u=s&&s.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!i){const M=(await this.getInitContextFilters(t,a,{from:(0,Ie.KQ)(t.timeEpochMs),to:(0,Ie.KQ)(t.timeEpochMs),raw:{from:(0,Ie.KQ)(t.timeEpochMs),to:(0,Ie.KQ)(t.timeEpochMs)}})).contextFilters.filter(A=>A.enabled);this.cachedContextFilters=M}return await this.prepareLogRowContextQueryTarget(t,u,o,a)}async prepareLogRowContextQueryTarget(t,s,a,i){const o=this.prepareExpression(this.cachedContextFilters,i),u=2*60*60*1e3,M=a===h.ZF.Forward?d.ti.Forward:d.ti.Backward,A={expr:o,queryType:d.U3.Range,refId:`${Es}_${Math.random().toString()}`,maxLines:s,direction:M,datasource:{uid:this.datasource.uid,type:this.datasource.type}},Pe=new $.L(t.dataFrame).getFirstFieldOfType(be.PU.time);if(Pe===void 0)throw new Error("loki: data frame missing time-field, should never happen");const ve=Pe.values[t.rowIndex],Se=(0,Ie.yT)(ve),Me=M===d.ti.Forward?{from:Se,to:(0,Ie.yT)(t.timeEpochMs+u)}:{from:(0,Ie.yT)(t.timeEpochMs-u),to:Se};return{query:A,range:{from:Me.from,to:Me.to,raw:Me}}}getLogRowContextUi(t,s,a,i){a&&i&&(a=this.datasource.applyTemplateVariables(a,i));const o=u=>{this.cachedContextFilters=u,s&&s()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),wt({row:t,origQuery:a,updateFilter:o,onClose:this.onContextClose,logContextProvider:this,runContextQuery:s})}prepareExpression(t,s){let a=this.processContextFiltersToExpr(t,s);return window.localStorage.getItem($t)==="true"&&(a=this.processPipelineStagesToExpr(a,s)),a}}var jt=n(65474),Gt=n(48592),Yt=n(84596),kt=n(63527);const Ft=/^label_names\(\)\s*$/,qt=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function zt(S){if(typeof S!="string")return S;const t={refId:"LokiVariableQueryEditor-VariableQuery",type:d.ie.LabelNames};if(S.match(Ft))return{...t,type:d.ie.LabelNames};const a=S.match(qt);return a?{...t,type:d.ie.LabelValues,label:a[2]?a[2]:a[1],stream:a[2]?a[1]:void 0}:t}const _t=[{label:"Label names",value:d.ie.LabelNames},{label:"Label values",value:d.ie.LabelValues}],is="LokiVariableQueryEditor-VariableQuery",es=({onChange:S,query:t,datasource:s,range:a})=>{const[i,o]=(0,ee.useState)(void 0),[u,M]=(0,ee.useState)(""),[A,se]=(0,ee.useState)([]),[Pe,ve]=(0,ee.useState)(""),Se=(0,Yt.A)(i);(0,ee.useEffect)(()=>{if(!t)return;const _e=typeof t=="string"?zt(t):t;o(_e.type),M(_e.label||""),ve(_e.stream||"")},[t]),(0,ee.useEffect)(()=>{i!==d.ie.LabelValues||Se===i||s.languageProvider.fetchLabels({timeRange:a}).then(_e=>{se(_e.map(it=>({label:it,value:it})))})},[s,i,a,Se]);const Me=_e=>{o(_e.value),_e.value!==void 0&&S({type:_e.value,label:u,stream:Pe,refId:is})},Ne=_e=>{M(_e.value||"")},ke=_e=>{ve(_e.currentTarget.value)},et=()=>{i!==void 0&&S({type:i,label:u,stream:Pe,refId:"LokiVariableQueryEditor-VariableQuery"})};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(Ot.C,{children:[(0,O.jsx)(ft.I,{label:"Query type",labelWidth:20,children:(0,O.jsx)(Je.l6,{"aria-label":"Query type",onChange:Me,onBlur:et,value:i,options:_t,width:16})}),i===d.ie.LabelValues&&(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(ft.I,{label:"Label",labelWidth:20,children:(0,O.jsx)(Je.l6,{"aria-label":"Label",onChange:Ne,onBlur:et,value:{label:u,value:u},options:A,width:16,allowCustomValue:!0})})})]}),i===d.ie.LabelValues&&(0,O.jsx)(Ot.C,{children:(0,O.jsx)(ft.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:(0,O.jsx)("div",{children:'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}'}),children:(0,O.jsx)(kt.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:Pe,onChange:ke,onBlur:et})})})]})};class rs extends Gt.f5{constructor(t){super(),this.datasource=t,this.editor=es}async execute(t,s,a){return this.datasource.metricFindQuery(t,{scopedVars:s,range:a})}query(t){const s=this.execute(t.targets[0],t.scopedVars,t.range);return(0,jt.H)(s).pipe((0,Y.T)(a=>({data:a})))}}var os=n(41119),ts=n(78282);function Xt(S,t){if(!t.length)return[];const s=(0,e.groupBy)(t,"name"),a=Object.values(s).map(ms),i=S.fields.find(u=>u.type===be.PU.string);if(i===void 0)throw new Error("invalid logs-dataframe, string-field missing");const o=S.fields.find(u=>u.type===be.PU.other&&u.name==="labels");for(let u=0;u<i.values.length;u++)for(const M of a)if(s[M.name][0].matcherType==="label"&&o){const A=o.values[u];if(A){const se=Object.keys(A).find(Pe=>new RegExp(s[M.name][0].matcherRegex).test(Pe));if(se){M.values.push(A[se]);continue}}M.values.push(null)}else if(s[M.name][0].matcherType==="regex"||s[M.name][0].matcherType===void 0){const se=i.values[u].match(s[M.name][0].matcherRegex);if(se&&se[1]){M.values.push(se[1]);continue}M.values.push(null)}else M.values.push(null);return a}function ms(S){const t=(0,ts.l)(),s=S.reduce((a,i)=>{if(i.datasourceUid){const o=t.getInstanceSettings(i.datasourceUid),u=M=>{switch(M){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};a.push({title:i.urlDisplayLabel||"",url:"",internal:{query:{query:i.url,queryType:u(o?.type)},datasourceUid:i.datasourceUid,datasourceName:o?.name??"Data source not found"},targetBlank:i.targetBlank})}else i.url&&a.push({title:i.urlDisplayLabel||"",url:i.url,targetBlank:i.targetBlank});return a},[]);return{name:S[0].name,type:be.PU.string,config:{links:s},values:[]}}function us(S){const t=S.filter(a=>a.refId!==void 0),s=(0,e.groupBy)(t,a=>a.refId);return Object.entries(s).map(([a,i])=>ss(i,a))}function ss(S,t){const s={name:"Time",config:{},values:[],type:be.PU.time},a={name:`Value #${t}`,config:{},values:[],type:be.PU.number},i=new Set(S.map(M=>M.fields.map(A=>Object.keys(A.labels??{})).flat()).flat()),u=Array.from(i).sort().map(M=>({name:M,config:{filterable:!0},values:[],type:be.PU.string}));return S.forEach(M=>{const A=M.fields.find(Me=>Me.type===be.PU.time),se=M.fields.find(Me=>Me.type===be.PU.number);if(A==null||se==null)return;const Pe=A.values,ve=se.values;for(let Me of Pe)s.values.push(Me);for(let Me of ve)a.values.push(Me);const Se=se.labels??{};for(let Me of u){const Ne=Se[Me.name]??"";for(let ke=0;ke<ve.length;ke++)Me.values.push(Ne)}}),{fields:[s,...u,a],refId:t,meta:{preferredVisualisationType:"table"},length:s.values.length}}function ls(S){return S.fields.every(t=>t.type===be.PU.time||t.type===be.PU.number)}function Vt(S,t){const{meta:s,...a}=S,i={...s,...t};return{...a,meta:i}}function cs(S,t,s){const a={...S.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,L.nE)(S)&&(a.error="Error when parsing some of the logs");const i={preferredVisualisationType:"logs",limit:t?.maxLines,searchWords:t?(0,ie.H0)(t.expr):void 0,custom:a},o=Vt(S,i),u=Xt(o,s);return{...o,fields:[...o.fields,...u]}}function Kt(S,t,s){return S.map(a=>{const i=a.refId!==void 0?t.get(a.refId):void 0;return cs(a,i,s)})}function gs(S){return S.length>0?us(S):[]}function fs(S){const t={preferredVisualisationType:"graph"};return S.map(s=>Vt(s,t))}function hs(S,t){const s=[],a=[],i=[];return S.forEach(o=>{ls(o)?o.refId!=null&&t.get(o.refId)?.queryType===d.U3.Instant?a.push(o):i.push(o):s.push(o)}),{streamsFrames:s,metricInstantFrames:a,metricRangeFrames:i}}function ps(S,t){if(S===void 0)return S;const{refId:s,message:a}=S;if(s===void 0||a===void 0)return S;const i=t.get(s);return i===void 0?S:a.includes("escape")&&i.expr.includes("\\")?{...S,message:`${a}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:S}function Zt(S,t,s){const{data:a,error:i,...o}=S,u=a.map(ve=>{if(!(0,os.ci)(ve))throw new Error("transformation only supports dataframe responses");return ve}),M=new Map(t.map(ve=>{const Se=S.data.find(Ne=>Ne.refId===ve.refId)?.meta.executedQueryString,Me={...ve,expr:Se?(0,ie.mW)(Se):ve.expr};return[ve.refId,Me]})),{streamsFrames:A,metricInstantFrames:se,metricRangeFrames:Pe}=hs(u,M);return{...o,error:ps(i,M),data:[...fs(Pe),...gs(se),...Kt(A,M,s)]}}var Ht=n(32300),ns=n(30048),dt=n(41654);const Rt=[{value:d.U3.Range,label:"Range",description:"Run query over a range of time."},{value:d.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}],Jt=[{value:d.ti.Backward,label:"Backward",description:"Search in backward direction."},{value:d.ti.Forward,label:"Forward",description:"Search in forward direction."}];b.$.featureToggles.lokiShardSplitting&&Jt.push({value:d.ti.Scan,label:"Scan",description:"Experimental. Split the query into smaller units and stop at the requested log line limit.",icon:"exclamation-triangle"}),b.$.featureToggles.lokiExperimentalStreaming&&Rt.push({value:d.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});function Ts(S){return Jt.find(t=>t.value===S)?.label??"Unknown"}function Rs(S){const{lineLimitValue:t,onRunQuery:s,runOnBlur:a,onChange:i}=S,o=S.query??{};function u(se){const Pe={...o,maxLines:ws(se)};i(Pe)}function M(se){o.maxLines!==ws(se.currentTarget.value)&&u(se.currentTarget.value)}function A(se){se.key==="Enter"&&s()}return(0,O.jsx)(dt.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field",children:(0,O.jsx)(dt.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field",children:(0,O.jsx)(ft.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,O.jsx)(kt.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:M,onKeyDown:A,value:t,onBlur:()=>{a&&s()}})})})})}const rn=(0,ee.memo)(Rs);function ws(S){const t=parseInt(S,10);if(!(isNaN(t)||t<0))return t}const ks=(0,ee.lazy)(()=>n.e(1952).then(n.bind(n,32833))),_s=S=>(0,O.jsx)(ee.Suspense,{fallback:null,children:(0,O.jsx)(ks,{...S})}),zs=S=>{const t=(0,ee.useRef)(null),{onRunQuery:s,onChange:a,...i}=S,o=M=>{t.current=M,a(M),s()},u=M=>{a(M)};return(0,O.jsx)(_s,{onRunQuery:o,onBlur:u,onChange:a,...i})};class Xs extends ee.PureComponent{constructor(t){super(t),this._isMounted=!1,this.onChangeQuery=(s,a)=>{const{query:i,onChange:o,onRunQuery:u}=this.props;if(o){const M={...i,expr:s};o(M),a&&u&&u()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(t){const{range:s,datasource:{languageProvider:a}}=this.props;(0,V.WV)(s,t.range)&&a.fetchLabels({timeRange:s})}render(){const{ExtraFieldElement:t,query:s,datasource:a,history:i,onRunQuery:o,range:u}=this.props,M=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:(0,O.jsx)("div",{className:"gf-form--grow flex-shrink-1 min-width-15",children:(0,O.jsx)(zs,{datasource:a,history:i??[],onChange:this.onChangeQuery,onRunQuery:o,initialValue:s.expr??"",placeholder:M,timeRange:u})})}),t]})}}const Vs=(0,ee.memo)(function(t){const{annotation:s,onAnnotationChange:a,history:i}=t;if(s===void 0||a===void 0)return null;const o=M=>{a({...s,expr:M.expr,maxLines:M.maxLines,queryType:"range"})},u={refId:"",expr:s.expr,maxLines:s.maxLines,instant:s.instant,queryType:s.queryType};return(0,O.jsxs)(dt.B,{gap:5,direction:"column",children:[(0,O.jsx)(dt.B,{gap:0,direction:"column",children:(0,O.jsx)(Xs,{datasource:t.datasource,query:u,onChange:o,onRunQuery:()=>{},history:i,ExtraFieldElement:(0,O.jsx)(Rs,{lineLimitValue:u?.maxLines?.toString()||"",query:u,onRunQuery:()=>{},onChange:o})})}),(0,O.jsxs)(Ht.U,{children:[(0,O.jsx)(ns.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,O.jsx)(kt.p,{type:"text",placeholder:"alertname",value:s.titleFormat,onChange:M=>{a({...s,titleFormat:M.currentTarget.value})}})}),(0,O.jsx)(ns.c,{label:"Tags",children:(0,O.jsx)(kt.p,{type:"text",placeholder:"label1,label2",value:s.tagKeys,onChange:M=>{a({...s,tagKeys:M.currentTarget.value})}})}),(0,O.jsx)(ns.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,O.jsx)(kt.p,{type:"text",placeholder:"instance",value:s.textFormat,onChange:M=>{a({...s,textFormat:M.currentTarget.value})}})})]})]})});var vs=n(27522);function Ks(S,t){if(t.length===0)return[];const s=[],{queryWithParser:a,parserCount:i}=(0,ie.MX)(S);if(!a){const{hasLogfmt:M,hasJSON:A,hasPack:se}=(0,L.YB)(t[0]);A&&(se?s.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:S}}}):s.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:S}}})),M&&s.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:S}}})}if(a){if(i===1){const A=(0,ie.d_)(S);(0,L.db)(t[0])&&!A&&s.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:S}}})}(0,ie.pS)(S)||s.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:S}}})}if(!(0,ie._i)(S)){const M=(0,L.Ac)(t[0]),A=(0,L.sz)(t[0]);!M&&A&&s.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${A}" label.`,fix:{title:"add label level format",label:`If ${A} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:S,options:{renameTo:"level",originalLabel:A}}}})}return(0,ie.Rn)(S)||s.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:S}}}),s}var Os=n(68088),$s=n(96426),Hs=n(24726),xs=n(23235);function Fs(S,t){const s=t.targets.filter(a=>a.expr).filter(a=>!a.hide).map(a=>S.applyTemplateVariables(a,t.scopedVars,t.filters));return Gs(S,t,s)}function Gs(S,t,s){let a=!1,i={data:[],state:_.Gu.Streaming,key:(0,Hs.A)()},o=null,u=new Map,M=null;const A=(Pe,ve,Se)=>{let Me=Se[ve].groupSize;const{shards:Ne,groupSize:ke,cycle:et}=Se[ve];let _e=!1;o!=null&&(o.unsubscribe(),o=null);const it=()=>{i.state=a?_.Gu.Error:_.Gu.Done,Pe.next(i),Pe.complete()};if(a){it();return}const St=()=>{const bt=Se[ve+1]&&ys(Se[ve+1])?Se[ve+1]:Se.find(Wt=>ys(Wt));if(bt===void 0){it();return}Se[ve].groupSize=Me,A(Pe,Se.indexOf(bt),Se)},mt=bt=>{try{if(bt&&!(0,L.BY)(bt))return!1}catch(Us){return console.error(Us),a=!0,!1}if(ke!==void 0&&ke>1)return Se[ve].groupSize=Math.floor(Math.sqrt(ke)),as(`Possible time out, new group size ${Se[ve].groupSize}`),_e=!0,A(Pe,ve,Se),!0;const Wt=`${ve}_${et}`,Ut=u.get(Wt)??0;return Ut>1?(a=!0,!1):(u.set(Wt,Ut+1),M=setTimeout(()=>{console.warn(`Retrying ${ve} ${et} (${Ut+1})`),A(Pe,ve,Se),M=null},1500*Math.pow(2,Ut)),_e=!0,!0)},Pt=(0,Os.gn)(Se[ve].targets,i);if(!Pt.length){St();return}const Ct=Ne&&et!==void 0&&ke?Js(Ne,et,ke):[],Mt={...t,targets:(0,ie.Bg)(Pt,Ct)};t.requestId&&(Mt.requestId=Ct.length>0?`${t.requestId}_shard_${ve}_${et}_${ke}`:t.requestId),as(Ct.length?`Querying ${Ct.join(", ")}`:"Running regular query"),o=(0,Os.K9)(S,Mt,{skipPartialUpdates:!0,disableRetry:!0}).subscribe({next:bt=>{((bt.errors??[]).length>0||bt.error!=null)&&mt(bt)||(ke&&et!==void 0&&Ne!==void 0&&(Me=Zs(et+ke,Ys(bt,Se[ve]),Ne.length),Me!==ke&&as(`New group size ${Me}`)),i=Ct.length>0?(0,xs.Wn)(i,bt):(0,xs.Df)(i,bt),Ct.length===0&&Pe.next(i))},complete:()=>{_e||(Pe.next(i),St())},error:bt=>{console.error(bt,{msg:"failed to shard"}),Pe.next(i),!mt()&&St()}})};return new ce.c(Pe=>(Ms(s,S,t).then(ve=>{A(Pe,0,ve)}),()=>{a=!0,M&&clearTimeout(M),o!=null&&(o.unsubscribe(),o=null)}))}async function Ms(S,t,s){const[a,i]=(0,e.partition)(S,M=>(0,ie.E2)([M])),o=[];i.length&&o.push({targets:i});const u=(0,e.groupBy)(a,M=>(0,ie.tO)(M.expr));for(const M in u)try{const se=(await t.languageProvider.fetchLabelValues("__stream_shard__",{timeRange:s.range,streamSelector:M})).map(Pe=>parseInt(Pe,10));se&&(se.sort((Pe,ve)=>ve-Pe),as(`Querying ${M} with shards ${se.join(", ")}`)),o.push({targets:u[M],shards:se.length?se:void 0,groupSize:se.length?Ds(se):void 0,cycle:0})}catch(A){console.error(A,{msg:"failed to fetch label values for __stream_shard__"}),o.push({targets:u[M]})}return o}function ys(S){if(S.cycle===void 0||!S.groupSize||!S.shards)return!1;const{cycle:t,groupSize:s,shards:a}=S,i=Math.min(t+s,a.length);return S.cycle=i,t<a.length&&i<=a.length}function Ys(S,t){const{groupSize:s}=t;if(!s)return 1;if(!S.data.length)return s+1;const a=S.data[0].meta?.stats?.find(i=>i.displayName==="Summary: exec time");if(a){const i=Math.round(a.value);return as(`${a.value}`),i<=1?Math.floor(s*1.5):i<6?Math.ceil(s*1.1):s===1?s:i<20?Math.ceil(s*.9):Math.floor(s/2)}return s}function Zs(S,t,s){return Math.min(t,Math.max(Math.floor((s-S)*.7),1))}function Js(S,t,s){return t===S.length?[-1]:S.slice(t,t+s)}function Ds(S){return Math.floor(Math.sqrt(S.length))}const qs=!!localStorage.getItem("loki.sharding_debug_enabled");function as(S){qs&&console.log(S)}var js=n(72316),Qs=n(51388),Is=n(38619),As=n(33184);async function Ws(S){const t=JSON.stringify({expr:S.expr}),s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-1",s),i=Array.from(new Uint8Array(a.slice(0,8)));return`${S.datasource?.uid}/${i.map(o=>o.toString(16).padStart(2,"0")).join("")}/${b.$.bootData.user.orgId}`}function Ns(S,t,s){const a=s.range,i=a.to.valueOf()-a.from.valueOf()+1e3;let o=s.maxDataPoints??1e3;o>100&&(o*=2);let u;const M=A=>{if("message"in A&&A.message){const se=A.message;u?u.push(se):u=Qs.k9.fromDataFrameJSON(se,{maxLength:o,maxDelta:i,displayNameFormat:S.legendFormat})}return u};return(0,js.v)(()=>Ws(S)).pipe((0,le.Z)(A=>(0,As.oF)().getStream({scope:Is.qD.DataSource,namespace:t.uid,path:`tail/${A}`,data:{...S,timeRange:{from:a.from.valueOf().toString(),to:a.to.valueOf().toString()}}}).pipe((0,Y.T)(se=>{const Pe=M(se);return{data:Pe?[Pe]:[],state:_.Gu.Streaming}}))))}const en=S=>{let s=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${b.$.appSubUrl}`;return s.endsWith("/")&&(s=s.slice(0,-1)),`${s}${S}`};var tn=n(47126);const sn=1e3,bs=10,on="/loki/api/v1",Ls="loki-data-samples",Bs="annotation-",Es="log-row-context-query-",Bt="log-volume-",Ss="log-sample-",ln="log-stats-",nn=1e6;function Ps(S,t,s,a,i){const o=H.calculateInterval(t,1);return{targets:[S],requestId:a,interval:o.interval,intervalMs:o.intervalMs,range:t,scopedVars:{},timezone:"UTC",app:s,startTime:Date.now(),hideFromInspector:i}}class cn extends ne.iy{constructor(t,s=(0,he.w)()){super(t),this.instanceSettings=t,this.templateSrv=s,this.streams=new Ve,this.runLiveQuery=(i,o)=>{const u=this.createLiveTarget(i,o);return this.streams.getStream(u).pipe((0,Y.T)(M=>({data:M||[],key:`loki-${u.refId}`,state:_.Gu.Streaming})),(0,m.W)(M=>(0,l.$)(()=>`Live tailing was stopped due to following error: ${M.reason}`)))},this.getLogRowContext=async(i,o,u)=>await this.logContextProvider.getLogRowContext(i,o,(0,ie.sc)(u)),this.getLogRowContextQuery=async(i,o,u,M)=>await this.logContextProvider.getLogRowContextQuery(i,o,(0,ie.sc)(u),M),this.languageProvider=new k(this);const a=t.jsonData||{};this.maxLines=parseInt(a.maxLines??"0",10)||sn,this.annotations={QueryEditor:Vs},this.variables=new rs(this),this.logContextProvider=new Nt(this)}getSupplementaryRequest(t,s,a){switch(t){case h.cF.LogsVolume:const i=a?.type===h.cF.LogsVolume?a:{type:t};return this.getLogsVolumeDataProvider(s,i);case h.cF.LogsSample:const o=a?.type===h.cF.LogsSample?a:{type:t};return this.getLogsSampleDataProvider(s,o);default:return}}getSupportedSupplementaryQueryTypes(){return[h.cF.LogsVolume,h.cF.LogsSample]}getSupplementaryQuery(t,s){if(s.hide)return;const a=(0,ie.vV)(s);let i=(0,qe.Lv)(a.expr),o=!1;switch(t.type){case h.cF.LogsVolume:if(o=!!(i&&(0,ie.sI)(i)&&a.queryType===d.U3.Range),!o)return;const u=`${i} | drop __error__`,M=t.field||"level, detected_level";return(0,ie.FV)(this.interpolateString(u,vs.a))===!1&&(i=u),{...a,refId:`${Bt}${a.refId}`,queryType:d.U3.Range,supportingQueryType:d.Q$.LogsVolume,expr:`sum by (${M}) (count_over_time(${i}[$__auto]))`};case h.cF.LogsSample:return o=!!(i&&!(0,ie.sI)(i)),o?{...a,queryType:d.U3.Range,refId:`${Ss}${a.refId}`,expr:(0,ie.OT)(i),maxLines:Number.isNaN(Number(t.limit))?this.maxLines:Number(t.limit),supportingQueryType:d.Q$.LogsSample}:void 0;default:return}}getLogsVolumeDataProvider(t,s){const a=(0,e.cloneDeep)(t),i=a.targets.map(o=>this.getSupplementaryQuery(s,o)).filter(o=>!!o);if(i.length)return{...a,targets:i}}getLogsSampleDataProvider(t,s){const a=(0,e.cloneDeep)(t),i=a.targets.map(o=>this.getSupplementaryQuery({type:h.cF.LogsSample,limit:100},o)).filter(o=>!!o);if(i.length)return{...a,targets:i}}query(t){const s=t.targets.map(ie.vV).map(u=>({...u,maxLines:u.maxLines??this.maxLines,scopes:b.$.featureToggles.scopeFilters&&b.$.featureToggles.logQLScope?t.scopes?.flatMap(M=>M.spec.filters):void 0})),a={...t,targets:s},i=a.targets.filter(u=>u.queryType===d.U3.Stream);if(b.$.featureToggles.lokiExperimentalStreaming&&i.length>0&&a.rangeRaw?.to==="now"){const u={...a,targets:i};return(0,P.h)(...i.map(M=>Ns(this.applyTemplateVariables(M,t.scopedVars,t.filters),this,u)))}if(a.liveStreaming)return this.runLiveQueryThroughBackend(a);if(b.$.featureToggles.lokiShardSplitting&&(0,ie.E2)(a.targets))return Fs(this,a);if(b.$.featureToggles.lokiQuerySplitting&&(0,ie.gy)(a.targets))return(0,Os.K9)(this,a);const o=new Date;return this.runQuery(a).pipe((0,Le.M)(u=>(0,tn.Ex)(u,a,o)))}runQuery(t){return super.query(t).pipe((0,Y.T)(s=>Zt(s,t.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(t){const s=t.targets.filter(i=>i.expr!==""&&(0,ie.sI)(i.expr));if(s.length===0)return(0,r.of)({data:[],state:_.Gu.Done});const a=s.map(i=>{const o=this.applyTemplateVariables(i,t.scopedVars,t.filters),u=o.maxLines||this.maxLines;return this.runLiveQuery(o,u)});return(0,P.h)(...a)}createLiveTarget(t,s){const a=t.expr,i=this.instanceSettings.url,o=de.kM.serializeParams({query:a});return{query:a,url:en(`${i}/loki/api/v1/tail?${o}`),refId:t.refId,size:s}}interpolateVariablesInQueries(t,s,a){let i=t;return t&&t.length&&(i=t.map(o=>({...o,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(o.expr,s,this.interpolateQueryExpr),a)}))),i}getQueryDisplayText(t){return t.expr}getTimeRangeParams(t){return{start:t.from.valueOf()*nn,end:t.to.valueOf()*nn}}async importFromAbstractQueries(t){await this.languageProvider.start();const s=this.languageProvider.labelKeys;return s&&s.length&&(t=t.map(a=>(a.labelMatchers=a.labelMatchers.filter(i=>s.includes(i.name)),a))),t.map(a=>this.languageProvider.importFromAbstractQuery(a))}async exportToAbstractQueries(t){return t.map(s=>this.languageProvider.exportToAbstractQuery(s))}async metadataRequest(t,s,a){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);const i=await this.getResource(t,s,a);return!i.data&&i.values?i.values??[]:!i.data&&i.fields?i.fields??[]:i.data??[]}async statsMetadataRequest(t,s,a){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);return await this.getResource(t,s,a)}async getQueryStats(t,s){if((0,ie.FV)(this.interpolateString(t.expr,vs.a)))return;const a=(0,ie.pk)(t.expr);let i={streams:0,chunks:0,bytes:0,entries:0};for(const o in a){const{start:u,end:M}=this.getStatsTimeRange(t,Number(o),s);if(u===void 0||M===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const A=await this.statsMetadataRequest("index/stats",{query:a[o],start:u,end:M},{showErrorAlert:!1,requestId:`${ln}${t.refId}`});i={streams:i.streams+A.streams,chunks:i.chunks+A.chunks,bytes:i.bytes+A.bytes,entries:i.entries+A.entries}}catch{break}}return i}getStatsTimeRange(t,s,a){let i,o;const A=(0,ie.QH)(t.expr,[U.dw]).map(se=>t.expr.substring(se.from,se.to));return(0,ie.sI)(t.expr)?t.queryType===d.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(a):t.queryType===d.U3.Instant?A[s]?(o=this.getTimeRangeParams(a).end,i=o-H.intervalToMs(A[s])*1e6,{start:i,end:o}):/(\$__auto|\$__range)/.test(t.expr)?this.getTimeRangeParams(a):{start:void 0,end:void 0}:this.getTimeRangeParams(a)}async getStats(t,s){if(!t.expr)return null;const a=await this.getQueryStats(t,s);return a?Object.values(a).every(i=>i===0)?null:a:null}async metricFindQuery(t,s){if(!t)return Promise.resolve([]);let a;return typeof t=="string"?a=this.parseStringToVariableQuery(this.interpolateString(t,s?.scopedVars)):a={...t,label:this.interpolateString(t.label||"",s?.scopedVars),stream:this.interpolateString(t.stream||"",s?.scopedVars)},a?await this.processMetricFindQuery(a,s?.range):Promise.resolve([])}async processMetricFindQuery(t,s){return t.type===d.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:s})).map(o=>({text:o})):t.label?(await this.languageProvider.fetchLabelValues(t.label,{streamSelector:t.stream,timeRange:s})).map(i=>({text:i})):[]}parseStringToVariableQuery(t){const s="LokiVariableQueryEditor-VariableQuery";if(t.match(Ft))return{type:d.ie.LabelNames,refId:s};const i=t.match(qt);if(i)return{type:d.ie.LabelValues,label:i[2],stream:i[1],refId:s}}async getDataSamples(t,s){if(!(0,ie.sI)(t.expr)||(0,ie.FV)(this.interpolateString(t.expr,vs.a)))return[];const a={expr:t.expr,queryType:d.U3.Range,refId:Ls,maxLines:t.maxLines||bs,supportingQueryType:d.Q$.DataSample},i=Ps(a,s,E.Jk.Unknown,Ls,!0);return await(0,J.s)(this.query(i).pipe((0,I.n)(o=>(0,r.of)(o.data))))}async getTagKeys(t){let s="{}";for(const i of t?.filters??[])s=(0,qe.tE)(s,i.key,i.operator,i.value);return(await this.languageProvider.fetchLabels({timeRange:t?.timeRange,streamSelector:s})).map(i=>({text:i}))}async getTagValues(t){let s="{}";for(const i of t?.filters??[])s=(0,qe.tE)(s,i.key,i.operator,i.value);return(await this.languageProvider.fetchLabelValues(t.key,{timeRange:t.timeRange,streamSelector:s})).map(i=>({text:i}))}interpolateQueryExpr(t,s){return!s.multi&&!s.includeAll?t:typeof t=="string"?an(t):(0,e.map)(t,an).join("|")}toggleQueryFilter(t,s){let a=t.expr??"";const i=(0,V.Ed)(s.options.key,s.frame,0);switch(s.type){case"FILTER_FOR":{if(s.options?.key&&s.options?.value){const o=(0,V.Bb)(s.options.value);a=(0,qe.je)(a,s.options.key,"=",o)?(0,qe.FN)(a,s.options.key,"=",o):(0,qe.tE)(a,s.options.key,"=",o,i)}break}case"FILTER_OUT":{if(s.options?.key&&s.options?.value){const o=(0,V.Bb)(s.options.value);(0,qe.je)(a,s.options.key,"=",o)&&(a=(0,qe.FN)(a,s.options.key,"=",o)),a=(0,qe.tE)(a,s.options.key,"!=",o,i)}break}default:break}return{...t,expr:a}}queryHasFilter(t,s){let a=t.expr??"";return(0,qe.je)(a,s.key,"=",s.value)}modifyQuery(t,s){let a=t.expr??"";switch(s.type){case"ADD_FILTER":{if(s.options?.key&&s.options?.value){const i=(0,V.Ed)(s.options.key,s.frame,0),o=(0,V.Bb)(s.options.value);a=(0,qe.tE)(a,s.options.key,"=",o,i)}break}case"ADD_FILTER_OUT":{if(s.options?.key&&s.options?.value){const i=(0,V.Ed)(s.options.key,s.frame,0),o=(0,V.Bb)(s.options.value);a=(0,qe.tE)(a,s.options.key,"!=",o,i)}break}case"ADD_LOGFMT_PARSER":{a=(0,qe.aH)(a,"logfmt");break}case"ADD_JSON_PARSER":{a=(0,qe.aH)(a,"json");break}case"ADD_UNPACK_PARSER":{a=(0,qe.aH)(a,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{a=(0,qe.yI)(a);break}case"ADD_LEVEL_LABEL_FORMAT":{s.options?.originalLabel&&s.options?.renameTo&&(a=(0,qe.o9)(a,{renameTo:s.options.renameTo,originalLabel:s.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const i=(0,qe.cH)(t.expr),o=(0,qe.lN)(t.expr),u=(0,qe.lq)([...i,...o]),M=(0,qe.i6)("","","=");a=(0,qe.cQ)(a,[u],M);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{a=(0,qe.OS)(a,s.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{a=(0,qe.OS)(a,s.options?.value,"!=");break}default:break}return{...t,expr:a}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(t,s,a,i){return this.logContextProvider.getLogRowContextUi(t,s,(0,ie.sc)(a),i)}async annotationQuery(t){const{expr:s,maxLines:a,instant:i,tagKeys:o="",titleFormat:u="",textFormat:M=""}=t.annotation;if(!s)return[];const A=`${Bs}${t.annotation.name}`,se={refId:A,expr:s,maxLines:a,instant:i,queryType:i?d.U3.Instant:d.U3.Range},Pe=Ps(se,t.range,E.Jk.Dashboard,A),{data:ve}=await(0,J.s)(this.query(Pe)),Se=[],Me=o.split(",").filter(ke=>ke!==""),Ne=b.$.featureToggles.lokiLogsDataplane;for(const ke of ve)new Z.R(ke).forEach(_e=>{const{labels:it}=_e,St=Object.entries(it).map(([Ct,Mt])=>[Ct,Mt.trim()]).filter(([Ct,Mt])=>!(Mt===""||Me.length&&!Me.includes(Ct))).map(([Ct,Mt])=>Mt),mt=Array.from(new Set(St)),Pt=Ne?_e.body:_e.Line;Se.push({time:Ne?new Date(_e.timestamp).valueOf():new Date(_e.Time).valueOf(),title:(0,q.j)(u,it),text:(0,q.j)(M,it)||Pt,tags:mt})});return Se}addAdHocFilters(t,s){if(!s?.length)return t;let a=(0,$s.qk)(t);return a=s.reduce((i,o)=>{const{key:u,operator:M}=o;let{value:A}=o;return(0,V.N4)(M)||(A=(0,V.Bb)(A,M)),(0,qe.tE)(i,u,M,A)},a),(0,$s.If)(a)}filterQuery(t){return!(t.hide||t.expr==="")}applyTemplateVariables(t,s,a){const{__auto:i,__interval:o,__interval_ms:u,__range:M,__range_s:A,__range_ms:se,...Pe}=s||{},ve={...Pe,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},Se=this.addAdHocFilters(this.templateSrv.replace(t.expr,ve,this.interpolateQueryExpr),a),Me=this.templateSrv.replace(t.step,ve),Ne=this.templateSrv.replace(t.legendFormat,ve);return{...t,expr:Se,step:Me,legendFormat:Ne}}interpolateString(t,s){return this.templateSrv.replace(t,s,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(t=>`$${t.name}`)}getQueryHints(t,s){return Ks(t.expr,s)}getDefaultQuery(t){const s={refId:"A",expr:""};return t===E.Jk.UnifiedAlerting?{...s,queryType:d.U3.Instant}:{...s,queryType:d.U3.Range}}}function an(S){return typeof S=="string"?S.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&"):S}},22420:(tt,we,n)=>{n.d(we,{Bb:()=>de,Ed:()=>q,N4:()=>E,P7:()=>b,Qn:()=>H,WV:()=>m,qv:()=>_,sM:()=>ne,tY:()=>Z,tt:()=>he});var e=n(2543),l=n.n(e),P=n(46933),r=n(12282);function J(Q){return Y(Q/1e3)}function Y(Q){return Math.floor(Q/60)}function m(Q,z){if(Q&&z){const N=J(Q.from.valueOf())===J(z.from.valueOf()),g=J(Q.to.valueOf())===J(z.to.valueOf());return!(N&&g)}return!1}const Le=/[*+?()|\\.\[\]{}^$]/g;function I(Q){return Q.replace(Le,"\\$&")}function H(Q){return Q.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function _(Q){return Q.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function h(Q){return H(I(Q))}function de(Q,z){return E(z)?h(Q):H(Q)}function E(Q){return!!(Q&&(Q.includes("=~")||Q.includes("!~")))}function Z(Q){const z=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],N=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${z.join("|")})$`);return!!Q.match(N)}function q(Q,z,N){if(!z||N===void 0)return null;const g=z.fields.find(B=>B.name==="labelTypes")?.values[N];if(!g)return null;switch(g[Q]){case"I":return r.HD.Indexed;case"S":return r.HD.StructuredMetadata;case"P":return r.HD.Parsed;default:return null}}const U={[P.D_.Equal]:"=",[P.D_.NotEqual]:"!=",[P.D_.EqualRegEx]:"=~",[P.D_.NotEqualRegEx]:"!~"},ne=(0,e.invert)(U);function he(Q){const z=Q.labelMatchers.map(N=>{const g=U[N.operator];return g?`${N.name}${g}"${N.value}"`:""}).filter(N=>N!=="").join(", ");return z?`{${z}}`:""}function b(Q){const z={};Q.forEach(g=>{Object.keys(g).forEach(B=>{z[B]||(z[B]=new Set),z[B].has(g[B])||z[B].add(g[B])})});const N={};return W(Object.keys(z)).forEach(g=>{N[g]=W(Array.from(z[g]))}),{values:N,keys:Object.keys(N)}}const C=1e4;function W(Q){return Q.slice(0,C)}},23235:(tt,we,n)=>{n.d(we,{Df:()=>Le,Wn:()=>m});var e=n(28105),l=n(95004),P=n(51388),r=n(76732),J=n(39443),Y=n(68088);function m(b,C){if(!b)return U(C);C.data.forEach(N=>{const g=b.data.find(B=>he(B,N));if(!g){b.data.push(ne(N));return}I(g,N)});const W=[...b.errors??[],...C.errors??[]];W.length>0&&(b.errors=W);const Q=b.error??C.error;Q!=null&&(b.error=Q);const z=[...b.traceIds??[],...C.traceIds??[]];return z.length>0&&(b.traceIds=z),b}function Le(b,C){if(!b)return U(C);C.data.forEach(N=>{const g=b.data.findIndex(B=>he(B,N));if(g<0){b.data.push(ne(N));return}b.data[g]=N}),C.state===e.Gu.Done&&(b.data=b.data.filter(N=>N.name!==Y.NW));const W=[...b.errors??[],...C.errors??[]];W.length>0&&(b.errors=W);const Q=b.error??C.error;Q!=null&&(b.error=Q);const z=[...b.traceIds??[],...C.traceIds??[]];return z.length>0&&(b.traceIds=z),b}function I(b,C){const W=b.fields.find(G=>G.type===l.PU.time),Q=b.fields.find(G=>G.type===l.PU.string&&G.name==="id"),z=C.fields.find(G=>G.type===l.PU.time),N=C.fields.find(G=>G.type===l.PU.string&&G.name==="id");if(!W||!z){console.error(new Error("Time fields not found in the data frames"));return}const g=z?.values.slice(0)??[],B=Math.max(b.fields.length,C.fields.length);for(let G=0;G<g.length;G++){const ae=H(W,z,G),v=_(W,Q,ae,z,N,G);for(let F=0;F<B;F++){if(!b.fields[F])continue;const D=de(b.fields[F],C.fields,F);if(D)if(v){if(b.fields[F].type===l.PU.time)continue;b.fields[F].type===l.PU.number?b.fields[F].values[ae]=(b.fields[F].values[ae]??0)+D.values[G]:b.fields[F].type===l.PU.other?typeof D.values[G]=="object"?b.fields[F].values[ae]={...b.fields[F].values[ae],...D.values[G]}:D.values[G]&&(b.fields[F].values[ae]=D.values[G]):b.fields[F].values[ae]=D.values[G]}else D.values[G]!==void 0&&(b.fields[F].values.splice(ae,0,D.values[G]),D.nanos?(b.fields[F].nanos=b.fields[F].nanos??new Array(b.fields[F].values.length-1).fill(0),b.fields[F].nanos?.splice(ae,0,D.nanos[G])):b.fields[F].nanos&&b.fields[F].nanos?.splice(ae,0,0))}}b.length=b.fields[0].values.length,b.meta={...b.meta,stats:q(b.meta?.stats??[],C.meta?.stats??[])}}function H(b,C,W){const Q=(0,P.Ls)(C.values[W],b.values);return Q<0?0:C.values[W]===b.values[Q]&&C.nanos&&b.nanos?C.nanos[W]>b.nanos[Q]?Q+1:Q:C.values[W]>b.values[Q]?Q+1:Q}function _(b,C,W,Q,z,N){return h(b,W,Q,N)?!C||!z?!0:C.values[W]!==void 0&&C.values[W]===z.values[N]:!1}function h(b,C,W,Q){return b.nanos&&W.nanos?b.values[C]!==void 0&&b.values[C]===W.values[Q]&&b.nanos[C]!==void 0&&b.nanos[C]===W.nanos[Q]:b.values[C]!==void 0&&b.values[C]===W.values[Q]}function de(b,C,W){const Q=C.filter(z=>z.name===b.name);return Q.length===1?Q[0]:b.labels?Q.find(z=>(0,r.ab)(b.labels??{},z.labels??{})):C[W]}const E="Summary: total bytes processed",Z="Summary: exec time";function q(b,C){const W=[];for(const Q of[E,Z]){const z=b.find(B=>B.displayName===Q),N=C.find(B=>B.displayName===Q);if(N!=null&&z!=null){W.push({value:N.value+z.value,displayName:Q,unit:z.unit});continue}const g=N??z;g!=null&&W.push(g)}return W}function U(b){return{...b,data:b.data.map(ne)}}function ne(b){return{...b,fields:b.fields.map(C=>({...C,values:C.values}))}}function he(b,C){if(b.refId!==C.refId||b.name!==C.name)return!1;const W=b.meta?.type,Q=C.meta?.type;if(W!==Q)return!1;if(W===J.m.TimeSeriesMulti){const g=b.fields.find(G=>G.type===l.PU.number),B=C.fields.find(G=>G.type===l.PU.number);return g===void 0||B===void 0?!1:(0,r.ab)(g.labels??{},B.labels??{})}const z=b.meta?.custom?.frameType,N=C.meta?.custom?.frameType;return z==="LabeledTimeValues"&&N==="LabeledTimeValues"?!0:z===N}},76160:(tt,we,n)=>{n.d(we,{Ch:()=>U,Gk:()=>g,cQ:()=>je,o9:()=>ae,tE:()=>Q,OS:()=>d,yI:()=>G,aH:()=>N,lq:()=>T,lN:()=>j,cH:()=>D,yB:()=>F,je:()=>ne,Lv:()=>v,FN:()=>he,i6:()=>V});var e=n(2543),l=n(36195),P=n(22420),r=n(24162),J=n(42954),Y=n(55060),m=Object.defineProperty,Le=(x,R,w)=>R in x?m(x,R,{enumerable:!0,configurable:!0,writable:!0,value:w}):x[R]=w,I=(x,R,w)=>Le(x,typeof R!="symbol"?R+"":R,w);class H{constructor(R,w){I(this,"operationsRegistry"),I(this,"categories",[]),I(this,"innerQueryPlaceholder"),this.operationsRegistry=new J.O(()=>R),this.innerQueryPlaceholder=w||"<query>"}setOperationCategories(R){this.categories=R}getOperationsForCategory(R){return this.operationsRegistry.list().filter(w=>w.category===R&&!w.hideFromList)}getAlternativeOperations(R){return this.operationsRegistry.list().filter(w=>w.alternativesKey&&w.alternativesKey===R)}getCategories(){return this.categories}getOperationDefinition(R){return this.operationsRegistry.getIfExists(R)}hasBinaryOp(R){return R.operations.find(w=>{const K=this.getOperationDefinition(w.id);return K?.category===Y.T})!==void 0}}var _=n(38903),h=n(95826);class de extends H{constructor(){super(_.sp,"<expr>"),this.setOperationCategories([h.Ln.Aggregations,h.Ln.RangeFunctions,h.Ln.Formats,h.Ln.BinaryOps,h.Ln.LabelFilters,h.Ln.LineFilters])}renderOperations(R,w){for(const K of w){if(K.disabled)continue;const ce=this.operationsRegistry.getIfExists(K.id);if(!ce){console.error(`Could not find operation ${K.id} in the registry`);continue}R=ce.renderer(K,ce,R)}return R}renderBinaryQueries(R,w){if(w)for(const K of w)R=`${this.renderBinaryQuery(R,K)}`;return R}renderBinaryQuery(R,w){let K=R+` ${w.operator} `;return w.vectorMatches&&(K+=`${w.vectorMatchesType}(${w.vectorMatches}) `),K+this.renderQuery(w.query,!0)}renderLabels(R){if(R.length===0)return"{}";let w="{";for(const K of R)w!=="{"&&(w+=", "),w+=`${K.label}${K.op}"${K.value}"`;return w+"}"}renderQuery(R,w){let K=this.renderLabels(R.labels);return K=this.renderOperations(K,R.operations),!w&&this.hasBinaryOp(R)&&R.binaryQueries?.length&&(K=`(${K})`),K=this.renderBinaryQueries(K,R.binaryQueries),K}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:h.IQ.Log,operations:[{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]},{id:h.EF.Json,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:h.IQ.Log,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:[""]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.SumOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:h.IQ.Metric,operations:[{id:h.EF.LineContains,params:[""]},{id:h.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.CountOverTime,params:["$__auto"]},{id:h.EF.Sum,params:[]},{id:h.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:h.IQ.Metric,operations:[{id:h.EF.Logfmt,params:[]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.Unwrap,params:["latency"]},{id:h.EF.LabelFilterNoErrors,params:[]},{id:h.EF.QuantileOverTime,params:["$__auto",.5]},{id:h.EF.Sum,params:[]}]}]}}const E=new de;var Z=n(32783),q=n(12282);class U{constructor(R,w,K){this.from=R,this.to=w,this.type=K}static fromNode(R){return new U(R.from,R.to,R.type)}contains(R){return this.from<=R.from&&this.to>=R.to}getExpression(R){return R.substring(this.from,this.to)}}function ne(x,R,w,K){return W(x,R,w,K).length>0}function he(x,R,w,K){const ce=W(x,R,w,K);for(const y of ce)x=y.parent?.type.id===l.bY?b(x,y):C(x,y);return x}function b(x,R){const w=R.parent?.parent;return!w||w.type.id!==l.t3?x:(x.substring(0,w.from)+x.substring(w.to)).trim()}function C(x,R){let w=R;do w=w.parent;while(w&&w.type.id!==l.MD);const K=R.getChild(l.gw);if(!w||!K)return x;const ce=x.substring(K.from,K.to),y=x.substring(0,w.from),oe=x.substring(w.to),pe=(0,Z.u_)(x.substring(w.from,w.to));return pe.query.labels=pe.query.labels.filter(me=>me.label!==ce),y+E.renderQuery(pe.query)+oe}function W(x,R,w,K){const ce=l.K3.parse(x),y=[];return ce.iterate({enter:({type:oe,node:pe})=>{oe.id===l.g$&&y.push(pe)}}),y.filter(oe=>{const pe=oe.getChild(l.gw),me=pe?.nextSibling,Te=oe.getChild(l.Qf);if(!pe||!me||!Te||x.substring(pe.from,pe.to)!==R)return!1;const xe=x.substring(Te.from,Te.to);return!((0,Z.w4)(xe)!==(0,P.qv)(K)||x.substring(me.from,me.to)!==w)})}function Q(x,R,w,K,ce){if(!R)throw new Error("Need label to add to query.");const y=F(x);if(!y.length)return x;const oe=D(x),pe=j(x),me=fe(x),Te=(0,r.TQ)(x,[l.J_]);ce||le(x).map(Be=>Be.getExpression(x)).includes(R)&&(ce=q.HD.Indexed);const Oe=y.every(be=>me.some(ye=>ye.from>=be.from&&ye.to<=be.to)),xe=V(R,K,w);if(ce===q.HD.Parsed||ce===q.HD.StructuredMetadata){const be=z(x,[...y,...pe,...oe,...Te]);return je(x,be,xe)}else{if(ce===q.HD.Indexed)return ie(x,y,xe);if(oe.length===0||Oe===!1)return ie(x,y,xe);{const be=z(x,[...oe,...pe,...Te]);return je(x,be,xe)}}}function z(x,R){const w=k((0,r.TQ)(x,[l.GN])),K=[...R];return w.map(y=>T(K.filter(oe=>y.contains(oe))))}function N(x,R){const w=f(x);if(w.length)return B(x,w,R);{const K=F(x);return K.length?B(x,K,R):x}}function g(x,R){const w=f(x);if(w.length)return B(x,w,`drop ${R.join(", ")}`);{const K=F(x);return K.length?B(x,K,`drop ${R.join(", ")}`):x}}function B(x,R,w){let K="",ce=0;for(let y=0;y<R.length;y++){const oe=R[y],pe=y===R.length-1,me=x.substring(ce,oe.to),Te=pe?x.substring(oe.to):"";K+=me+` | ${w}`+Te,ce=oe.to}return K}function G(x){const R=D(x);if(!R.length)return x;const w=V("__error__","","=");return je(x,R,w)}function ae(x,R){const w=X(x);return L(x,w,R)}function v(x){const R=p(x);if(!R.length)return x;let w="",K=0;for(let ce of R)w=w+x.substring(K,ce.from),K=ce.to;return w=w+x.substring(K),w}function F(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({type:K,node:ce})=>{if(K.id===l.MD)return w.push(U.fromNode(ce)),!1}}),w}function D(x){const R=l.K3.parse(x),w=[],K=[l.iT,l.eF,l.Zj,l.Tz];return R.iterate({enter:({type:ce,node:y})=>{if(K.includes(ce.id))return w.push(U.fromNode(y)),!1}}),w}function j(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({type:K,node:ce})=>{if(K.id===l.bY)return w.push(U.fromNode(ce)),!1}}),w}function f(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({type:K,node:ce})=>{if(K.id===l.CX)return w.push(U.fromNode(ce)),!1}}),w}function X(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({type:K,node:ce})=>{if(K.id===l.UK)return w.push(U.fromNode(ce)),!1;if(K.id===l.xo){const y=[],oe=ce.getChild(l.MD);oe&&y.push(U.fromNode(oe));const pe=ce.getChild(l.AL);pe&&y.push(U.fromNode(pe));const me=ce.getChild(l.HV);me&&y.push(U.fromNode(me));const Te=(0,e.sortBy)(y,Oe=>Oe.to);return w.push(new U(Te[0].from,Te[Te.length-1].to)),!1}}}),w}function V(x,R,w){return{label:x,op:w,value:R}}function ie(x,R,w){let K="",ce=0;for(let y=0;y<R.length;y++){const oe=R[y],pe=y===R.length-1,me=x.substring(ce,oe.from),Te=pe?x.substring(oe.to):"",Oe=(0,Z.u_)(x.substring(oe.from,oe.to));c(Oe.query.labels,w)||Oe.query.labels.push(w);const xe=E.renderQuery(Oe.query);K+=me+xe+Te,ce=oe.to}return K}function je(x,R,w){let K="",ce=0;for(let y=0;y<R.length;y++){const oe=R[y],pe=y===R.length-1,me=x.substring(ce,oe.to),Te=pe?x.substring(oe.to):"";let Oe="";!Number.isNaN(Number(w.value))&&(w.op==="<"||w.op===">")?Oe=` | ${w.label}${w.op}${Number(w.value)}`:Oe=` | ${w.label}${w.op}\`${(0,P.qv)(w.value)}\``,K+=me+Oe+Te,ce=oe.to}return K}function L(x,R,w){let K="",ce=0;for(let y=0;y<R.length;y++){const oe=R[y],pe=y===R.length-1,me=x.substring(ce,oe.to),Te=pe?x.substring(oe.to):"",Oe=` | label_format ${w.renameTo}=${w.originalLabel}`;K+=me+Oe+Te,ce=oe.to}return K}function d(x,R="",w="|="){const K=F(x);if(!K.length)return x;const ce=K[0].to;return x.slice(0,ce)+` ${w} \`${R}\``+x.slice(ce)}function p(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({type:K,from:ce,to:y})=>{if(K.id===l.uk)return w.push(new U(ce,y,K)),!1}}),w}function c(x,R){return x.find(w=>w.label===R.label&&w.value===R.value)}function T(x){return x.length?x.reduce((R,w)=>R.to>w.to?R:w):new U(0,0)}function k(x){return x.filter(R=>x.every(w=>R.contains(w)===!1||R===w))}function te(x,R){if(x.type.id===R)return[U.fromNode(x)];const w=[];let K=0,ce=x.childAfter(K);for(;ce;)w.push(...te(ce,R)),K=ce.to,ce=x.childAfter(K);return w}function fe(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({node:K})=>{K.type.id===l.MD&&w.push(...te(K,l.g$))}}),w}function le(x){const R=l.K3.parse(x),w=[];return R.iterate({enter:({node:K})=>{K.type.id===l.MD&&w.push(...te(K,l.gw))}}),w}},68088:(tt,we,n)=>{n.d(we,{NW:()=>b,gn:()=>ne,K9:()=>z});var e=n(2543),l=n(88483),P=n(59099),r=n(24726),J=n(25229),Y=n(28105),m=n(27359),Le=n(739),I=n(17548);function H(g,B,G){if(B-g<=G)return[[g,B]];const ae=[];for(let v=B;v>g;v-=G){const F=Math.max(v-G,g);ae.push([F,v])}return ae.reverse(),ae}var _=n(23235);function h(g,B,G,ae){if(ae<G)return[[g,B]];const v=Math.trunc(ae/G)*G,F=g-g%G,D=[];for(let j=F;j<B;j+=v){const f=Math.min(j+v-G,B);D.push([j,f])}return D}var de=n(24162),E=n(69457),Z=n(47126),q=n(12282);function U(g,B,G,ae){const v=B.from.toDate().getTime(),F=B.to.toDate().getTime();return(g?H(v,F,ae):h(v,F,G,ae)).map(([j,f])=>{const X=(0,J.KQ)(j),V=(0,J.KQ)(f);return{from:X,to:V,raw:{from:X,to:V}}})}function ne(g,B){return B?g.map(G=>{if(!G.maxLines||!(0,de.sI)(G.expr))return G;const ae=B.data.find(F=>F.refId===G.refId);if(!ae)return G;const v=G.maxLines-ae.length;return{...G,maxLines:v<0?0:v}}).filter(G=>G.maxLines===void 0||G.maxLines>0):g}function he(g,B,G={}){const ae=B.length?B[0].request.queryGroupId:(0,r.A)();let v={data:[],state:Y.Gu.Streaming,key:ae};const F=Math.max(...B.map(({partition:L})=>L.length)),D=B.filter(({partition:L})=>L.length===F)[0].partition;let j=!1,f=null,X=new Map,V=null;const ie=(L,d,p)=>{let c=!1;if(f!=null&&(f.unsubscribe(),f=null),j){L.complete();return}const T=()=>{v.state=Y.Gu.Done,L.next(v),L.complete()},k=()=>{const{nextRequestN:w,nextRequestGroup:K}=W(B,p,d);if(w>0&&K>=0){ie(L,w,K);return}T()},te=w=>{if(G.disableRetry)return!1;try{if(w&&!(0,E.BY)(w))return!1}catch(y){return console.error(y),j=!0,!1}const K=`${d}-${p}`,ce=X.get(K)??0;return ce>0?!1:(X.set(K,ce+1),V=setTimeout(()=>{ie(L,d,p)},1500*Math.pow(2,ce)),c=!0,!0)},fe=B[p],le=fe.partition[d-1],x=ne(fe.request.targets,v);if(!x.length){k();return}const R={...B[p].request,range:le,targets:x};fe.request.requestId&&(R.requestId=`${fe.request.requestId}_${d}`),f=g.runQuery(R).subscribe({next:w=>{if((w.errors??[]).length>0||w.error!=null){if(te(w))return;j=!0}v=(0,_.Wn)(v,w),G.skipPartialUpdates||(v=C(v,R,D,d))},complete:()=>{c||(G.skipPartialUpdates||L.next(v),k())},error:w=>{L.error(w),te()}})};return new l.c(L=>(ie(L,F,0),()=>{j=!0,V&&(clearTimeout(V),V=null),f!=null&&(f.unsubscribe(),f=null)}))}const b="loki-splitting-progress";function C(g,B,G,ae){if((0,de.sI)(B.targets[0].expr)||(g.data=g.data.filter(F=>F.name!==b),ae<=1))return g;const v=(0,m.I)([{time:G[0].from.valueOf(),timeEnd:G[ae-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return v.name=b,v.meta={dataTopic:Le.QR.Annotations},g.data.push(v),g}function W(g,B,G){for(let ae=B+1;ae<g.length;ae++)if(g[ae].partition[G-1])return{nextRequestGroup:ae,nextRequestN:G};return{nextRequestGroup:g.findIndex(ae=>ae?.partition[G-1]!==void 0),nextRequestN:G-1}}function Q(g){return g.queryType!==q.U3.Instant&&!(0,de.Cg)(g.expr)}function z(g,B,G={}){const ae=B.targets.filter(L=>!L.hide).filter(L=>L.expr).map(L=>g.applyTemplateVariables(L,B.scopedVars,B.filters)),[v,F]=(0,e.partition)(ae,L=>!Q(L)),[D,j]=(0,e.partition)(F,L=>(0,de.sI)(L.expr));B.queryGroupId=(0,r.A)();const f=24*60*60*1e3,X=(0,e.groupBy)(D,L=>L.direction===q.ti.Forward?q.ti.Forward:q.ti.Backward),V=[];for(const L in X){const d=X[L],p=(0,e.groupBy)(d,c=>c.resolution||1);for(const c in p){const T={request:{...B,targets:p[c]},partition:U(!0,B.range,B.intervalMs,f)};L===q.ti.Forward&&T.partition.reverse(),V.push(T)}}const ie=(0,e.groupBy)(j,L=>N(B.intervalMs,B.range,L.resolution||1,L.step));for(const L in ie){const d=ie[L].map(p=>{const{maxLines:c,...T}=p;return T});V.push({request:{...B,targets:d},partition:U(!1,B.range,Number(L),f)})}v.length&&V.push({request:{...B,targets:v},partition:[B.range]});const je=new Date;return he(g,V,G).pipe((0,P.M)(L=>{L.state===Y.Gu.Done&&(0,Z.uJ)(L,V,B,je)}))}function N(g,B,G,ae){const v=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(ae?.match(v))return I.intervalToMs(ae)*G;const F=g*G,D=Math.round((B.to.valueOf()-B.from.valueOf())/11e3);return Math.max(F,D)}},24162:(tt,we,n)=>{n.d(we,{$F:()=>E,Bg:()=>je,Cg:()=>v,E2:()=>j,FV:()=>b,H0:()=>m,MX:()=>W,OT:()=>g,QH:()=>U,Rn:()=>ae,TQ:()=>ne,_i:()=>N,aw:()=>Q,d_:()=>z,g5:()=>B,gy:()=>D,kr:()=>V,mW:()=>Le,pS:()=>G,pk:()=>F,sI:()=>C,sc:()=>ie,tO:()=>d,vV:()=>H});var e=n(2543),l=n.n(e),P=n(36195),r=n(76160),J=n(96426),Y=n(12282);function m(p=""){const c=[],T=U(p,[P.PN]);for(const k of T){const te=k.getChild(P.dJ)?.getChild(P.Sg),fe=k.getChild(P.dJ)?.getChild(P.q5),le=I(k);if(!(!te&&!fe||!le.length))for(const x of le){const R=p.substring(x.from,x.to).trim(),w=R[0]==="`",K=R.substring(1,R.length-1);if(!K)continue;let ce="";fe?ce=w?K:K.replace(/\\\\/g,"\\"):ce=(0,e.escapeRegExp)(K),ce&&c.push(ce)}}return c}function Le(p){return p.replace("Expr: ","")}function I(p){const c=[];let T=p;do{const k=T.getChild(P.Qf);k&&!T.getChild(P.w7)&&c.push(k),T=T.getChild(P.ih)}while(T!=null);return c}function H(p){let c=_(p);const{instant:T,range:k,...te}=p;try{C(p.expr)&&c===Y.U3.Instant&&(c=Y.U3.Range)}catch{}return{...te,queryType:c}}function _(p){const{queryType:c}=p;return c===Y.U3.Range||c===Y.U3.Instant||c===Y.U3.Stream?c:p.instant===!0?Y.U3.Instant:Y.U3.Range}const h=["String","Identifier","LineComment","Number"],de=["__error__","__interval","__interval_ms","__auto"];function E(p){let c=p;return P.K3.parse(p).iterate({enter:({name:k,from:te,to:fe})=>{const le=p.substring(te,fe);h.includes(k)&&!de.includes(le)&&(c=c.replace(le,k))}}),c}function Z(p){const c=[];return parser.parse(p).iterate({enter:({name:k})=>{c.push(k)}}),c}function q(p,c){let T=!1;return P.K3.parse(p).iterate({enter:({type:te})=>{if(te.id===c)return T=!0,!1}}),T}function U(p,c){const T=[];return P.K3.parse(p).iterate({enter:te=>{(c===void 0||c.includes(te.type.id))&&T.push(te.node)}}),T}function ne(p,c){const T=[];return P.K3.parse(p).iterate({enter:te=>{(c===void 0||c.includes(te.type.id))&&T.push(r.Ch.fromNode(te.node))}}),T}function he(p,c){const T=U(p,[c]);return T.length>0?T[0]:void 0}function b(p){return q(p,J.Ql)}function C(p){return p.trim().length>2&&!q(p,P.Yw)}function W(p){const T=U(p,[P.iT,P.eF,P.c$]).length;return{queryWithParser:T>0,parserCount:T}}function Q(p){const c=U(p,[P.iT,P.LM,P.c$]);return c.length>0?p.substring(c[0].from,c[0].to).trim():void 0}function z(p){const c=U(p,[P.bY]);for(const T of c){const k=T.getChild(P.g$)?.getChild(P.gw);if(k&&p.substring(k.from,k.to)==="__error__")return!0}return!1}function N(p){return q(p,P.J_)}function g(p){if(C(p))return p;const c=he(p,P.MD);if(!c)return"";const T=p.substring(c.from,c.to),k=he(p,P.AL),te=k?p.substring(k.from,k.to):"";return`${T} ${te}`.trim()}function B(p,c){if(C(p))return p;const T=U(p,[P.Yw]).reverse().find(k=>k.from<=c&&k.to>=c);return T?g(p.substring(T.from,T.to)):""}function G(p){return q(p,P.bY)}function ae(p){return q(p,P.PN)}function v(p){const c=U(p,[P.Q6]);for(const T of c)if(p.substring(T.from,T.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function F(p){return(0,r.yB)(p).map(k=>p.slice(k.from,k.to))}function D(p){return p.filter(T=>!T.hide).filter(T=>!T.refId.includes("do-not-chunk")).filter(T=>T.expr).length>0}function j(p){return p.filter(T=>!T.hide).filter(T=>T.queryType!==Y.U3.Instant).filter(T=>!T.refId.includes("do-not-shard")).filter(T=>T.expr).filter(T=>T.direction===Y.ti.Scan&&C(T.expr)||f(T.expr)).length>0}function f(p){if(C(p)||(p=p.trim().toLowerCase(),U(p,[P.MK]).length>0))return!1;const T=U(p,[P.ZQ]),k=T.filter(R=>X(p,R)==="sum"),te=T.filter(R=>X(p,R)!=="sum"),fe=k.filter(R=>te.every(w=>R.from<w.from));if(te.length>0)return fe.length>0;const le=U(p,[P.lo]),x=["count_over_time","sum_over_time","bytes_over_time"];for(const R of le)if(!x.includes(X(p,R)))return fe.length>0;return!0}function X(p,c){return p.substring(c.from,c.to)}const V=p=>p?"expr"in p&&p.expr!==void 0:!1,ie=p=>{if(!(!p||!V(p)))return p},je=(p,c)=>{if(c.length===0)return p;let T=c.join("|");return T==="-1"||c.length===1?(T=T==="-1"?"":T,p.map(k=>({...k,expr:L(k.expr,"=",T)}))):p.map(k=>({...k,expr:L(k.expr,"=~",T)}))};function L(p,c,T){const k=(0,r.tE)(p,"__stream_shard__",c,T,Y.HD.Indexed);return C(p)?k:(0,r.Gk)(k,["__stream_shard__"])}const d=p=>{const c=U(p,[P.MD]);return c.length>0?p.substring(c[0].from,c[0].to):""}},80124:(tt,we,n)=>{n.d(we,{C:()=>P,I:()=>r});var e=n(88744),l=n(95826);const P=[{id:l.EF.Addition,name:"Add scalar",sign:"+"},{id:l.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:l.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:l.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:l.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:l.EF.Exponent,name:"Exponent",sign:"^"},{id:l.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:l.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:l.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:l.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:l.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:l.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],r=P.map(Y=>{const m=[{name:"Value",type:"number"}];let Le=[2];return Y.comparison&&(m.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),Le=[2,!1]),{id:Y.id,name:Y.name,params:m,defaultParams:Le,toggleable:!0,alternativesKey:"binary scalar operations",category:l.Ln.BinaryOps,renderer:J(Y.sign),addOperationHandler:e.iZ}});function J(Y){return function(Le,I,H){let _=Le.params[0],h="";return Le.params.length===2&&(h=Le.params[1]?" bool":""),`${H} ${Y}${h} ${_}`}}},88744:(tt,we,n)=>{n.d(we,{af:()=>W,VR:()=>Q,G3:()=>D,jC:()=>ie,fu:()=>de,yD:()=>E,iZ:()=>F,UF:()=>z,OS:()=>g,sn:()=>U,EP:()=>he});var e=n(2543),l=n(55127),P=n.n(l),r=n(22420),J=n(77236),Y=n(74848),m=n(96540),Le=n(18857);const I=({onChange:L,index:d,operationId:p,value:c,query:T,datasource:k,queryModeller:te})=>{const[fe,le]=(0,m.useState)({});return(0,Y.jsx)(Le.l6,{inputId:g(p,d),autoFocus:c==="",openMenuOnFocus:!0,onOpenMenu:async()=>{le({isLoading:!0});const x=await H(T,k,te);le({options:x,isLoading:void 0})},isLoading:fe.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:fe.options,value:_(c),onChange:x=>L(d,x.value)})};async function H(L,d,p){let c=L.labels;const T=p.renderLabels(c);return(await d.languageProvider.fetchLabels({streamSelector:T})).map(te=>({label:te,value:te}))}const _=L=>({label:L?.toString(),value:L});var h=n(95826);function de(L,d){const p=[N()],c=["$__auto"];let T;return L===h.EF.QuantileOverTime&&(c.push("0.95"),p.push({name:"Quantile",type:"number"})),d&&(p.push({name:"By label",type:"string",restParam:!0,optional:!0}),T=B(`__${L}_by`)),{id:L,name:v(L),params:p,defaultParams:c,toggleable:!0,alternativesKey:"range function",category:h.Ln.RangeFunctions,orderRank:h.h5.RangeVectorFunction,renderer:q,addOperationHandler:W,paramChangedHandler:T,explainHandler:(k,te)=>{let fe=J.AW.find(le=>le.insertText===k.id)?.documentation??"";return k.params[0]==="$__auto"?`${fe} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${fe} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${k.params[0]}\`.`}}}function E(L){const d=de(L,!0),p=d.params.slice(0,-1);return[d,{id:`__${L}_by`,name:`${v(L)} by`,params:[...p,{name:"Label",type:"string",restParam:!0,optional:!0,editor:I}],defaultParams:[...d.defaultParams,""],toggleable:!0,alternativesKey:"range function with grouping",category:h.Ln.RangeFunctions,renderer:Z(L,"by"),paramChangedHandler:ae(L),explainHandler:G(L,"by"),addOperationHandler:W,hideFromList:!0},{id:`__${L}_without`,name:`${v(L)} without`,params:[...p,{name:"Label",type:"string",restParam:!0,optional:!0,editor:I}],defaultParams:[...d.defaultParams,""],alternativesKey:"range function with grouping",category:h.Ln.RangeFunctions,renderer:Z(L,"without"),paramChangedHandler:ae(L),explainHandler:G(L,"without"),addOperationHandler:W,hideFromList:!0}]}function Z(L,d){return function(c,T,k){const te=T.params.findIndex(x=>x.restParam),fe=c.params.slice(0,te),le=c.params.slice(te);return fe.length===2&&L===h.EF.QuantileOverTime?`${L}(${fe[1]}, ${k} [${fe[0]}]) ${d} (${le.join(", ")})`:`${L}(${k} [${fe[0]}]) ${d} (${le.join(", ")})`}}function q(L,d,p){const c=L.params??[],T=c[0]??"$__auto";if(c.length===2&&L.id===h.EF.QuantileOverTime){const k=c[1];return`${L.id}(${k}, ${p} [${T}])`}return`${L.id}(${p} [${c[0]??"$__auto"}])`}function U(L,d,p){return["<","<=",">",">="].includes(String(L.params[1]))?`${p} | ${L.params[0]} ${L.params[1]} ${L.params[2]}`:`${p} | ${L.params[0]} ${L.params[1]} \`${L.params[2]}\``}function ne(L,d){if(!L)return!1;const p=L.params[1].toString().startsWith("!");return d.filter(k=>k.id===LokiOperationId.LabelFilter&&k.params[0]===L.params[0]&&k.params[2]===L.params[2]).some(k=>!!(p&&k.params[1].toString().startsWith("!")===!1||p===!1&&k.params[1].toString().startsWith("!")))}function he(L,d,p){switch(L.id){case h.EF.Logfmt:const[c=!1,T=!1,...k]=L.params;return`${p} | logfmt${c?" --strict":""}${T?" --keep-empty":""} ${k.filter(te=>te).join(", ")}`.trim();case h.EF.Json:return`${p} | json ${L.params.filter(te=>te).join(", ")}`.trim();case h.EF.Drop:return`${p} | drop ${L.params.filter(te=>te).join(", ")}`.trim();case h.EF.Keep:return`${p} | keep ${L.params.filter(te=>te).join(", ")}`.trim();default:return`${p} | ${L.id}`}}function b(L){return L.category===h.Ln.RangeFunctions}function C(L,d,p){const c=L.findIndex(T=>{const k=d.getOperationDefinition(T.id);return k?p(k):!1});return c===-1?L.length:c}function W(L,d,p){const c={id:L.id,params:L.defaultParams},T=[...d.operations],k=T.find(te=>{const fe=p.getOperationDefinition(te.id);return fe?b(fe):!1});switch(L.category){case h.Ln.Aggregations:case h.Ln.Functions:if(!k){const fe=C(T,p,le=>le.category===h.Ln.Functions);T.splice(fe,0,{id:h.EF.Rate,params:["$__auto"]})}T.push(c);break;case h.Ln.RangeFunctions:if(k){const fe=T.indexOf(k);T[fe]=c;break}default:const te=C(T,p,fe=>(L.orderRank??100)<(fe.orderRank??100));T.splice(te,0,c);break}return{...d,operations:T}}function Q(L,d){return{...d,binaryQueries:[...d.binaryQueries??[],{operator:"/",query:d}]}}function z(L,d){return function(c,T,k){const te=c.params.some(x=>typeof x=="string"&&x.includes("`")),fe=te?'"':"`";let le;return te?le=c.params.map(x=>typeof x=="string"?(0,r.Qn)(x):x):le=c.params,d?`${k} ${L} ${fe}(?i)${le.join(`${fe} or ${fe}(?i)`)}${fe}`:`${k} ${L} ${fe}${le.join(`${fe} or ${fe}`)}${fe}`}}function N(){return{name:"Range",type:"string",options:["$__auto"],description:'Use the default value "$__auto". Change the "step" value in the query options to change the bucket size.'}}function g(L,d){return`operations.${L}.param.${d}`}function B(L){return function(p,c,T){return c.params.length===T.params.length?{...c,id:L}:c}}function G(L,d){return function(c){const T=c.params.map(te=>`\`${te}\``).join(" and "),k=P()("label",c.params.length);switch(d){case"by":return`Calculates ${L} over dimensions while preserving ${k} ${T}.`;case"without":return`Calculates ${L} over the dimensions ${T}. All other labels are preserved.`;default:return`Calculates ${L} over the dimensions.`}}}function ae(L){return function(p,c,T){return c.params.length<T.params.length?{...c,id:L}:c}}function v(L){return(0,e.capitalize)(L.replace(/_/g," "))}function F(L,d){const p={id:L.id,params:L.defaultParams};return{...d,operations:[...d.operations,p]}}function D(L,d={}){return[{id:L,name:v(L),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],toggleable:!0,alternativesKey:"plain aggregations",category:h.Ln.Aggregations,renderer:f,paramChangedHandler:B(`__${L}_by`),explainHandler:G(L,""),addOperationHandler:F,...d},{id:`__${L}_by`,name:`${v(L)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:I}],defaultParams:[""],alternativesKey:"aggregations by",category:h.Ln.Aggregations,renderer:V(L),paramChangedHandler:ae(L),explainHandler:G(L,"by"),addOperationHandler:F,hideFromList:!0,...d},{id:`__${L}_without`,name:`${v(L)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:I}],defaultParams:[""],alternativesKey:"aggregations by",category:h.Ln.Aggregations,renderer:j(L),paramChangedHandler:ae(L),explainHandler:G(L,"without"),addOperationHandler:F,hideFromList:!0,...d}]}function j(L){return function(p,c,T){return`${L} without(${p.params.join(", ")}) (${T})`}}function f(L,d,p){const c=X(L,d,p),T=L.id+"(";return p&&c.push(p),T+c.join(", ")+")"}function X(L,d,p){return(L.params??[]).map((c,T)=>d.params[T].type==="string"?'"'+c+'"':c)}function V(L){return function(p,c,T){return`${L} by(${p.params.join(", ")}) (${T})`}}function ie(L,d,p={}){const c=D(L,p);return c[0].params.unshift(...d.params),c[1].params.unshift(...d.params),c[2].params.unshift(...d.params),c[0].defaultParams=d.defaultParams,c[1].defaultParams=[...d.defaultParams,""],c[2].defaultParams=[...d.defaultParams,""],c[1].renderer=je(L),c[2].renderer=je(L),c}function je(L){return function(p,c,T){const k=c.params.findIndex(le=>le.restParam),te=p.params.slice(0,k),fe=p.params.slice(k);return`${L} by(${fe.join(", ")}) (${te.map((le,x)=>c.params[x].type==="string"?`"${le}"`:le).join(", ")}, ${T})`}}},38903:(tt,we,n)=>{n.d(we,{VI:()=>he,y6:()=>U,mD:()=>ne,sp:()=>q});var e=n(80124),l=n(74848),P=n(96540),r=n(47184),J=n(22592),Y=n(18857),m=n(27522),Le=n(49224),I=n(24162),H=n(69457),_=n(88744);function h({onChange:b,index:C,operationId:W,value:Q,query:z,datasource:N,timeRange:g,queryModeller:B}){const[G,ae]=(0,P.useState)({});return(0,l.jsx)(Y.l6,{inputId:(0,_.OS)(W,C),onOpenMenu:async()=>{if(N instanceof Le.VQ){ae({isLoading:!0});const v=await de(z,N,B,g);ae({options:v,isLoading:void 0})}},isLoading:G.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:G.options,value:Q?(0,r.z)(Q.toString()):null,onChange:v=>{v.value&&b(C,v.value)}})}async function de(b,C,W,Q=(0,J.E2)()){const z=W.renderQuery(b),N=(0,I.OT)(z);if((0,I.FV)(C.interpolateString(N,m.a)))return[];const g=await C.getDataSamples({expr:N,refId:"unwrap_samples"},Q);return(0,H.aN)(g[0]).map(ae=>({label:ae,value:ae}))}var E=n(95826);function Z(){const b=[E.EF.Sum,E.EF.Min,E.EF.Max,E.EF.Avg,E.EF.Stddev,E.EF.Stdvar,E.EF.Count].flatMap(N=>(0,_.G3)(N,{addOperationHandler:_.af,orderRank:E.h5.Last})),C=[E.EF.TopK,E.EF.BottomK].flatMap(N=>(0,_.jC)(N,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:_.af,orderRank:E.h5.Last})),W=[(0,_.fu)(E.EF.Rate),(0,_.fu)(E.EF.RateCounter),(0,_.fu)(E.EF.CountOverTime),(0,_.fu)(E.EF.SumOverTime),(0,_.fu)(E.EF.BytesRate),(0,_.fu)(E.EF.BytesOverTime),(0,_.fu)(E.EF.AbsentOverTime)],Q=[...(0,_.yD)(E.EF.AvgOverTime),...(0,_.yD)(E.EF.MaxOverTime),...(0,_.yD)(E.EF.MinOverTime),...(0,_.yD)(E.EF.FirstOverTime),...(0,_.yD)(E.EF.LastOverTime),...(0,_.yD)(E.EF.StdvarOverTime),...(0,_.yD)(E.EF.StddevOverTime),...(0,_.yD)(E.EF.QuantileOverTime)];return[...b,...C,...W,...Q,{id:E.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Parsers,renderer:_.EP,addOperationHandler:_.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:E.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Parsers,renderer:_.EP,addOperationHandler:_.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:E.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Parsers,renderer:(N,g,B)=>`${B} | regexp \`${N.params[0]}\``,addOperationHandler:_.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:E.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Parsers,renderer:(N,g,B)=>`${B} | pattern \`${N.params[0]}\``,addOperationHandler:_.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:E.EF.Unpack,name:"Unpack",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Parsers,renderer:_.EP,addOperationHandler:_.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:E.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.PipeOperations,renderer:(N,g,B)=>`${B} | line_format \`${N.params[0]}\``,addOperationHandler:_.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:E.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.PipeOperations,renderer:(N,g,B)=>`${B} | label_format ${N.params[1]}=${N.params[0]}`,addOperationHandler:_.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:E.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("|="),addOperationHandler:_.af,explainHandler:N=>`Return log lines that contain string \`${N.params?.join("`, or `")}\`.`},{id:E.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("!="),addOperationHandler:_.af,explainHandler:N=>`Return log lines that does not contain string \`${N.params?.join("`, or `")}\`.`},{id:E.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("|~",!0),addOperationHandler:_.af,explainHandler:N=>`Return log lines that match regex \`(?i)${N.params?.join("`, or `(?i)")}\`.`},{id:E.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("!~",!0),addOperationHandler:_.af,explainHandler:N=>`Return log lines that does not match regex \`(?i)${N.params?.join("`, or `(?i)")}\`.`},{id:E.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("|~"),addOperationHandler:_.af,explainHandler:N=>`Return log lines that match a \`RE2\` regex pattern. \`${N.params?.join("`, or `")}\`.`},{id:E.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(0,_.UF)("!~"),addOperationHandler:_.af,explainHandler:N=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${N.params?.join("`, or `")}\`.`},{id:E.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[E.NS.contains,E.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],toggleable:!0,alternativesKey:"line filter",category:E.Ln.LineFilters,orderRank:E.h5.LineFilters,renderer:(N,g,B)=>`${B} ${N.params[0]} ip(\`${N.params[1]}\`)`,addOperationHandler:_.af,explainHandler:N=>`Return log lines using IP matching of \`${N.params[1]}\``},{id:E.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[E.NS.equals,E.NS.doesNotEqual,E.NS.matchesRegex,E.NS.doesNotMatchRegex,E.NS.greaterThan,E.NS.lessThan,E.NS.greaterThanOrEqual,E.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:E.Ln.LabelFilters,orderRank:E.h5.PipeOperations,renderer:_.sn,addOperationHandler:_.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:E.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[E.NS.equals,E.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:E.Ln.LabelFilters,orderRank:E.h5.PipeOperations,renderer:(N,g,B)=>`${B} | ${N.params[0]} ${N.params[1]} ip(\`${N.params[2]}\`)`,addOperationHandler:_.af,explainHandler:N=>`Return log lines using IP matching of \`${N.params[2]}\` for \`${N.params[0]}\` label`},{id:E.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],toggleable:!0,alternativesKey:"label filter",category:E.Ln.LabelFilters,orderRank:E.h5.NoErrors,renderer:(N,g,B)=>`${B} | __error__=\`\``,addOperationHandler:_.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:E.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:h},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.Unwrap,renderer:(N,g,B)=>`${B} | unwrap ${N.params[1]?`${N.params[1]}(${N.params[0]})`:N.params[0]}`,addOperationHandler:_.af,explainHandler:N=>{let g=String(N.params[0]).length>0?N.params[0]:"<label>";return`Use the extracted label \`${g}\` as sample values instead of log lines for the subsequent range aggregation.${N.params[1]?` Conversion function \`${N.params[1]}\` wrapping \`${g}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:E.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.PipeOperations,renderer:(N,g,B)=>`${B} | decolorize`,addOperationHandler:_.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:E.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.PipeOperations,renderer:_.EP,addOperationHandler:_.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:E.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:E.Ln.Formats,orderRank:E.h5.PipeOperations,renderer:_.EP,addOperationHandler:_.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...e.I,{id:E.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],toggleable:!0,category:E.Ln.BinaryOps,renderer:(N,g,B)=>B,addOperationHandler:_.VR}]}const q=Z();function U(b){return(q.find(Q=>Q.id===b)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function ne(b){return q.find(C=>C.id===b)}function he(b,C){return!(C.length<b.params.filter(W=>!W.optional).length)}},32783:(tt,we,n)=>{n.d(we,{u_:()=>Y,w4:()=>z});var e=n(36195),l=n(80124),P=n(38903),r=n(96426),J=n(95826);function Y(v){const F=(0,r.qk)(v),j=e.K3.parse(F).topNode,X={query:{labels:[],operations:[]},errors:[]};try{m(F,j,X)}catch(V){console.error(V),V instanceof Error&&X.errors.push({text:V.message})}return B(X.query)&&(X.errors=[]),X}function m(v,F,D){const j=D.query;switch(F.type.id){case e.g$:{j.labels.push(Le(v,F));const f=F.getChild(r.Ql);f&&D.errors.push((0,r.xz)(v,f));break}case e.PN:{const{operation:f,error:X}=I(v,F);f&&j.operations.push(f),X&&D.errors.push(g(v,F,X));break}case e.iT:{j.operations.push(H(v,F));break}case e.bY:{const{operation:f,error:X}=de(v,F);f&&j.operations.push(f),X&&D.errors.push(g(v,F,X));break}case e.eF:{j.operations.push(_(v,F));break}case e.Zj:case e.Tz:{const{operation:f,error:X}=h(v,F);f&&j.operations.push(f),X&&D.errors.push(g(v,F,X));break}case e.pH:{j.operations.push(E(v,F));break}case e.e_:{j.operations.push(Z(v,F));break}case e.HV:{const{operation:f,error:X}=U(v,F,D);f&&j.operations.push(f),X&&D.errors.push(g(v,F,X));break}case e.Zg:{j.operations.push(q());break}case e.h1:{j.operations.push(ne(v,F,D));break}case e.Rh:{j.operations.push(he(v,F,D));break}case e.MK:{C(v,F,D);break}case r.Ql:{if(Q(F))break;D.errors.push((0,r.xz)(v,F));break}case e.i8:{j.operations.push(G(v,F,D));break}case e.UP:{j.operations.push(ae(v,F,D));break}default:{let f=F.firstChild;for(;f;)m(v,f,D),f=f.nextSibling}}}function Le(v,F){const D=F.getChild(e.gw),j=(0,r.AA)(v,D),f=(0,r.AA)(v,D?.nextSibling);let X=(0,r.AA)(v,F.getChild(e.Qf));return X=X.substring(1,X.length-1),{label:j,op:f,value:X}}function I(v,F){const D=(0,r.AA)(v,F.getChild(e.dJ)),j=z((0,r.AA)(v,F.getChild(e.Qf)));if(F.getChild(e.w7)?.getChild(e.Ip))return{operation:{id:J.EF.LineFilterIpMatches,params:[D,j]}};const X=[j];let V=F.getChild(e.ih);for(;V;)X.push(z((0,r.AA)(v,V.getChild(e.Qf)))),V=V.getChild(e.ih);return{operation:{id:{"|=":J.EF.LineContains,"!=":J.EF.LineContainsNot,"|~":J.EF.LineMatchesRegex,"!~":J.EF.LineMatchesRegexNot}[D],params:X}}}function H(v,F){const D=F.firstChild,j=(0,r.AA)(v,D),f=z((0,r.AA)(v,F.getChild(e.Qf)));let X=f?[f]:[];const V=(0,P.mD)(j);return V&&!(0,P.VI)(V,X)&&(X=V?.defaultParams||[]),{id:j,params:X}}function _(v,F){const D=F.getChild(e.LM),j=(0,r.AA)(v,D),f=[...(0,r.R1)(v,F,e.Gn)];return{id:j,params:f}}function h(v,F){const D=[],j=[];let f;const X=F.from;return F.toTree().iterate({enter:ie=>{ie.type.id===e.ov?D.push(v.substring(ie.from+X,ie.to+X)):ie.type.id===e.Gn?j.push(v.substring(ie.from+X,ie.to+X)):ie.type.id===r.Ql&&(f=`Unexpected string "${v.substring(ie.from+X,ie.to+X)}"`)}}),{operation:{id:J.EF.Logfmt,params:[D.includes("--strict"),D.includes("--keep-empty"),...j]},error:f}}function de(v,F){if(F.getChild(e.Or)||F.getChild(e.KD)||F.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(F.firstChild.type.id===e.GA){const je=F.firstChild,L=je?.getChild(e.gw),d=L?.nextSibling,p=je?.getChild(e.Qf),c=z((0,r.AA)(v,p));return{operation:{id:J.EF.LabelFilterIpMatches,params:[(0,r.AA)(v,L),(0,r.AA)(v,d),c]}}}const D=J.EF.LabelFilter;if(F.firstChild.type.id===e.Jq){const L=F.firstChild.firstChild.firstChild,d=L.nextSibling,p=d.nextSibling,c=z((0,r.AA)(v,p));return{operation:{id:D,params:[(0,r.AA)(v,L),(0,r.AA)(v,d),c]}}}const f=F.firstChild.firstChild,X=f.nextSibling,V=X.nextSibling,ie=[(0,r.AA)(v,f),(0,r.AA)(v,X),z((0,r.AA)(v,V))];return ie.join("")==="__error__="?{operation:{id:J.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:D,params:ie}}}function E(v,F){const D=J.EF.LineFormat,j=z((0,r.AA)(v,F.getChild(e.Qf)));return{id:D,params:[j]}}function Z(v,F){const D=J.EF.LabelFormat,j=F.getChild(e.gw),X=j.nextSibling.nextSibling;return{id:D,params:[(0,r.AA)(v,X),z((0,r.AA)(v,j))]}}function q(){return{id:J.EF.Decolorize,params:[]}}function U(v,F,D){const j=F.getChild(e.HV),f=F.getChild(e.bY),X=F.getChild(e.sK);if(j&&m(v,j,D),f&&m(v,f,D),X){if(X.nextSibling?.type.id===e.yW){const V=X.nextSibling,ie=V.nextSibling;return{operation:{id:J.EF.Unwrap,params:[(0,r.AA)(v,ie),(0,r.AA)(v,V)]}}}return{operation:{id:J.EF.Unwrap,params:[(0,r.AA)(v,X?.nextSibling),""]}}}return{}}function ne(v,F,D){const j=F.getChild(e.lo),f=(0,r.AA)(v,j),X=F.getChild(e.wN),V=F.getChild(e.xo),ie=X!=null?[(0,r.AA)(v,X)]:[],je=V?.getChild(e.Q6),L=je?(0,r.AA)(v,je):null,d=F.getChild(e.aU);L&&ie.unshift(L.substring(1,L.length-1)),d&&ie.push(...(0,r.R1)(v,d,e.gw));const p={id:f,params:ie};return V&&m(v,V,D),p}function he(v,F,D){const j=F.getChild(e.ZQ);let f=(0,r.AA)(v,j);const X=F.getChild(e.aU),V=[],ie=F.getChild(e.wN),je=F.getChild(r.Ql)?.getChild(e.gw);ie?V.push(Number((0,r.AA)(v,ie))):je&&V.push((0,r.AA)(v,je)),X&&(X.getChild(e.By)&&f&&(f=`__${f}_by`),X.getChild(e.xB)&&(f=`__${f}_without`),V.push(...(0,r.R1)(v,X,e.gw)));const L=F.getChild(e.Yw),d={id:f,params:V};return L&&(L.firstChild?.type.id===e.MK&&D.errors.push({text:"Query parsing is ambiguous.",from:L.firstChild.from,to:L.firstChild?.to}),m(v,L,D)),d}const b=l.C.reduce((v,F)=>(v[F.sign]={id:F.id,comparison:F.comparison},v),{});function C(v,F,D){const j=D.query,f=F.firstChild,X=(0,r.AA)(v,f.nextSibling),V=W(v,F.getChild(e.o5)),ie=F.lastChild,je=b[X],L=N(f,"MetricExpr.LiteralExpr.Number"),d=N(ie,"MetricExpr.LiteralExpr.Number"),p=ie.getChild(e.MK);if(L||m(v,f,D),d)j.operations.push((0,r.rq)(je,v,ie,!!V?.isBool));else if(p){const c=(0,r.z9)(ie);c?.type.id===e.wN&&j.operations.push((0,r.rq)(je,v,c,!!V?.isBool)),m(v,ie,D)}else{j.binaryQueries=j.binaryQueries||[];const c={operator:X,query:{labels:[],operations:[]}};V?.isMatcher&&(c.vectorMatchesType=V.matchType,c.vectorMatches=V.matches),j.binaryQueries.push(c),m(v,ie,{query:c.query,errors:D.errors})}}function W(v,F){if(!F)return;const D=F.getChild(e.wT),j=F.getChild(e.x);if(!D&&j)return{isBool:!0,isMatcher:!1};{if(!D)return;const f=(0,r.AA)(v,D.getChild(e.x$)?.getChild(e.qJ));return{isMatcher:!0,isBool:!!j,matches:f,matchType:D.getChild(e.On)?"on":"ignoring"}}}function Q(v){return v?.parent?.type.id===e.Q6}function z(v){return v[0]==='"'&&v[v.length-1]==='"'?v.substring(1,v.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):v.replace(/`/g,"")}function N(v,F){let D=v;const j=F.split(".");for(const f of j)if(D=D.getChild(f),!D)return null;return D}function g(v,F,D){const j=(0,r.xz)(v,F);return j.text=`${D}: ${j.text}`,j}function B(v){return v.labels.length===0&&v.operations.length===0}function G(v,F,D){const j=[];let f=F.getChild(e.LQ);for(;f;){const X=(0,r.AA)(v,f.getChild(e.yj));X&&j.push(X),f=f?.getChild(e.LQ)}return j.reverse(),{id:J.EF.Drop,params:j}}function ae(v,F,D){const j=[];let f=F.getChild(e.J3);for(;f;){const X=(0,r.AA)(v,f.getChild(e.UM));X&&j.push(X),f=f?.getChild(e.J3)}return j.reverse(),{id:J.EF.Keep,params:j}}},96426:(tt,we,n)=>{n.d(we,{AA:()=>Le,If:()=>m,Ql:()=>e,R1:()=>H,qk:()=>J,rq:()=>I,xz:()=>P,z9:()=>l});const e=0;function l(h){return h.firstChild?l(h.firstChild):h}function P(h,de){return{text:Le(h,de),from:de.from,to:de.to,parentType:de.parent?.name}}const r=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function J(h){return h.replace(r,(de,E,Z,q,U,ne,he)=>{const b=q||he;let C=E,W="0";return Z&&(C=Z,W="1"),U&&(C=U,W="2"),`__V_${W}__`+C+"__V__"+(b?"__F__"+b+"__F__":"")})}const Y=[(h,de)=>`$${h}`,(h,de)=>`[[${h}${de?`:${de}`:""}]]`,(h,de)=>`\${${h}${de?`:${de}`:""}}`];function m(h){return h.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(de,E,Z,q)=>Y[parseInt(E,10)](Z,q))}function Le(h,de){return de?m(h.substring(de.from,de.to)):""}function I(h,de,E,Z){const q=[parseFloat(Le(de,E))];return h.comparison&&q.push(Z),{id:h.id,params:q}}function H(h,de,E){if(de.type.id===E||de.name===E)return[Le(h,de)];const Z=[];let q=0,U=de.childAfter(q);for(;U;)Z.push(...H(h,U,E)),q=U.to,U=de.childAfter(q);return Z}const _=h=>h.split(" ").map(E=>`${E}.*`).join("")},95826:(tt,we,n)=>{n.d(we,{EF:()=>r,IQ:()=>l,Ln:()=>P,NS:()=>Y,h5:()=>J});var e=n(55060),l=(m=>(m.Log="log",m.Metric="metric",m))(l||{}),P=(m=>(m.Aggregations="Aggregations",m.RangeFunctions="Range functions",m.Functions="Functions",m.Formats="Formats",m.LineFilters="Line filters",m.LabelFilters="Label filters",m.BinaryOps=`${e.T}`,m))(P||{}),r=(m=>(m.Json="json",m.Logfmt="logfmt",m.Regexp="regexp",m.Pattern="pattern",m.Unpack="unpack",m.LineFormat="line_format",m.LabelFormat="label_format",m.Decolorize="decolorize",m.Drop="drop",m.Keep="keep",m.Rate="rate",m.RateCounter="rate_counter",m.CountOverTime="count_over_time",m.SumOverTime="sum_over_time",m.AvgOverTime="avg_over_time",m.MaxOverTime="max_over_time",m.MinOverTime="min_over_time",m.FirstOverTime="first_over_time",m.LastOverTime="last_over_time",m.StdvarOverTime="stdvar_over_time",m.StddevOverTime="stddev_over_time",m.QuantileOverTime="quantile_over_time",m.BytesRate="bytes_rate",m.BytesOverTime="bytes_over_time",m.AbsentOverTime="absent_over_time",m.Sum="sum",m.Avg="avg",m.Min="min",m.Max="max",m.Stddev="stddev",m.Stdvar="stdvar",m.Count="count",m.TopK="topk",m.BottomK="bottomk",m.LineContains="__line_contains",m.LineContainsNot="__line_contains_not",m.LineContainsCaseInsensitive="__line_contains_case_insensitive",m.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",m.LineMatchesRegex="__line_matches_regex",m.LineMatchesRegexNot="__line_matches_regex_not",m.LineFilterIpMatches="__line_filter_ip_matches",m.LabelFilter="__label_filter",m.LabelFilterNoErrors="__label_filter_no_errors",m.LabelFilterIpMatches="__label_filter_ip_marches",m.Unwrap="unwrap",m.SumBy="__sum_by",m.SumWithout="__sum_without",m.Addition="__addition",m.Subtraction="__subtraction",m.MultiplyBy="__multiply_by",m.DivideBy="__divide_by",m.Modulo="__modulo",m.Exponent="__exponent",m.NestedQuery="__nested_query",m.EqualTo="__equal_to",m.NotEqualTo="__not_equal_to",m.GreaterThan="__greater_than",m.LessThan="__less_than",m.GreaterOrEqual="__greater_or_equal",m.LessOrEqual="__less_or_equal",m))(r||{}),J=(m=>(m[m.LineFilters=1]="LineFilters",m[m.Parsers=2]="Parsers",m[m.PipeOperations=3]="PipeOperations",m[m.Unwrap=4]="Unwrap",m[m.NoErrors=5]="NoErrors",m[m.RangeVectorFunction=5]="RangeVectorFunction",m[m.Last=6]="Last",m))(J||{});const Y={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},69457:(tt,we,n)=>{n.d(we,{Ac:()=>H,nE:()=>I,db:()=>E,fV:()=>h,sz:()=>Z,YB:()=>_,aN:()=>de,BY:()=>q});var e=n(95004),l=n(74529),P=n(22420);function r(U){let ne;try{ne=JSON.parse(U)}catch{}return typeof ne=="object"}const J=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function Y(U){return J.test(U)}function m(U){let ne;try{return ne=JSON.parse(U),ne.hasOwnProperty("_entry")}catch{return!1}}var Le=n(12282);function I(U){return(U.fields.find(he=>he.name==="labels")?.values??[]).some(he=>he.__error__!==void 0)}function H(U){return(U.fields.find(he=>he.name==="labels")?.values??[]).some(he=>he.level!==void 0)}function _(U){const ne=U.fields.find(Q=>Q.type===e.PU.string);if(ne==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const he=ne.values;let b=!1,C=!1,W=!1;return he.forEach(Q=>{r(Q)&&(b=!0,W=m(Q)),Y(Q)&&(C=!0)}),{hasLogfmt:C,hasJSON:b,hasPack:W}}function h(U,ne=Le.HD.Indexed){const he=U?.fields?.find(W=>W.name==="labels")?.values??[],b=U?.fields?.find(W=>W.name==="labelTypes")?.values??[];if(!he?.length)return[];if(!b?.length){if(ne===Le.HD.Indexed){const{keys:W}=(0,P.P7)(he);return W}return[]}let C=new Set;for(let W=0;W<he.length;W++){const Q=he[W],z=b[W],N=Object.keys(Q).filter(g=>z[g]===ne);C=new Set([...C,...N])}return Array.from(C)}function de(U){const ne=U?.fields?.find(b=>b.name==="labels")?.values??[];return ne?.length?Object.keys(ne[0]).filter(b=>{const C=ne[0][b];return C?!isNaN(Number(C))||(0,l.pp)(C)||(0,P.tY)(C):!1}).filter(b=>ne.every(C=>C[b])):[]}function E(U){const ne=U.fields.find(b=>b.name==="labels"&&b.type===e.PU.other);return ne==null?!1:ne.values.some(b=>b.__error__)}function Z(U){const ne=U.fields.find(C=>C.name==="labels"&&C.type===e.PU.other);if(ne==null)return null;const he=ne.values.slice(0,2);let b=null;for(let C of he){const W=Object.keys(C).find(Q=>Q==="level"||Q==="detected_level"||Q==="lvl"||Q.includes("level"));if(W){b=W;break}}return b}function q(U){const ne=U.errors?(U.errors[0].message??"").toLowerCase():U.error?.message??"";if(ne.includes("timeout"))return!0;if(U.data.length>0&&U.data[0].fields.length>0)return!1;throw new Error(ne)}},47126:(tt,we,n)=>{n.d(we,{Ex:()=>q,uJ:()=>U});var e=n(1906),l=n(27489),P=n(43173),r=n(49224),J=n(51814),Y=n(24162),m=n(96426),Le=n(12282);const I=({payload:{dashboardId:ne,orgId:he,grafanaVersion:b,queries:C}})=>{try{const W=C[pluginJson.id]?.filter(f=>!f.hide)?.map(f=>getNormalizedLokiQuery(f));if(!W?.length)return;const Q=W.filter(f=>isLogsQuery(f.expr)),z=W.filter(f=>!isLogsQuery(f.expr)),N=W.filter(f=>f.queryType===LokiQueryType.Instant),g=W.filter(f=>f.queryType===LokiQueryType.Range),B=W.filter(f=>f.editorMode===QueryEditorMode.Builder),G=W.filter(f=>f.editorMode===QueryEditorMode.Code),ae=W.filter(H),v=W.filter(_),F=W.filter(h),D=W.filter(de),j={grafana_version:b,dashboard_id:ne,org_id:he,queries_count:W.length,logs_queries_count:Q.length,metric_queries_count:z.length,instant_queries_count:N.length,range_queries_count:g.length,builder_mode_queries_count:B.length,code_mode_queries_count:G.length,queries_with_template_variables_count:ae.length,queries_with_changed_resolution_count:v.length,queries_with_changed_line_limit_count:F.length,queries_with_changed_legend_count:D.length};reportInteraction("grafana_loki_dashboard_loaded",j)}catch(W){console.error("error in loki tracking handler",W)}},H=ne=>variableRegex.test(ne.expr),_=ne=>ne.resolution?ne.resolution!==1:!1,h=ne=>ne.maxLines!==null&&ne.maxLines!==void 0,de=ne=>ne.legendFormat?ne.legendFormat!=="":!1,E=ne=>!![r.Gf,r.M1,r.mL,r.ow,r.lb].some(b=>ne.startsWith(b)),Z=ne=>{let he=0;for(const b of ne.data){const C=b.meta?.custom?.lokiQueryStatKey;C&&(he+=b.meta?.stats?.find(W=>W.displayName===C)?.value??0)}return he};function q(ne,he,b,C={}){const{app:W,targets:Q}=he;if(W!==e.Jk.Explore)return;let z=Z(ne);for(const N of Q){if(E(N.refId))return;(0,l.rR)("grafana_explore_loki_query_executed",{grafana_version:P.$.buildInfo.version,editor_mode:N.editorMode,has_data:ne.data.some(g=>g.length>0),has_error:ne.error!==void 0,legend:N.legendFormat,line_limit:N.maxLines,obfuscated_query:(0,Y.$F)(N.expr),query_type:(0,Y.sI)(N.expr)?"logs":"metric",query_vector_type:N.queryType,resolution:N.resolution,simultaneously_executed_query_count:Q.filter(g=>!g.hide).length,simultaneously_hidden_query_count:Q.filter(g=>g.hide).length,time_range_from:he?.range?.from?.toISOString(),time_range_to:he?.range?.to?.toISOString(),time_taken:Date.now()-b.getTime(),bytes_processed:z,is_split:!1,...C})}}function U(ne,he,b,C){const W={split_query_group_count:he.length,split_query_largest_partition_size:Math.max(...he.map(({partition:Q})=>Q.length)),split_query_total_request_count:he.reduce((Q,{partition:z})=>Q+z.length,0),is_split:!0,simultaneously_executed_query_count:b.targets.filter(Q=>!Q.hide).length,simultaneously_hidden_query_count:b.targets.filter(Q=>Q.hide).length};for(const Q of he){const z=Q.partition.length;q(ne,Q.request,C,{...W,split_query_partition_size:z})}}},72316:(tt,we,n)=>{n.d(we,{v:()=>P});var e=n(88483),l=n(15964);function P(r){return new e.c(function(J){(0,l.Tg)(r()).subscribe(J)})}},36195:(tt,we,n)=>{n.d(we,{AL:()=>pt,By:()=>Be,CX:()=>ut,GA:()=>jt,GN:()=>$,Gn:()=>gt,HV:()=>Ms,I4:()=>At,Ip:()=>lt,J3:()=>Zt,J_:()=>ls,Jq:()=>Gt,K0:()=>Ie,K3:()=>c,KD:()=>ze,LM:()=>T,LQ:()=>fs,MD:()=>ge,MK:()=>Qs,Nl:()=>ts,On:()=>pe,Or:()=>Ye,PN:()=>ct,Q6:()=>Fs,Qf:()=>re,Rh:()=>as,Sg:()=>Je,Tz:()=>$t,UK:()=>O,UM:()=>Ht,UP:()=>ps,Yw:()=>ns,ZQ:()=>js,Zg:()=>xe,Zj:()=>wt,aU:()=>Ds,bY:()=>Nt,c$:()=>k,dJ:()=>ot,dw:()=>Ft,eF:()=>yt,e_:()=>cs,g$:()=>ue,gw:()=>De,h1:()=>dt,i8:()=>gs,iT:()=>Tt,ih:()=>Et,lo:()=>Rt,o5:()=>Is,ov:()=>It,pH:()=>ss,q5:()=>Ot,qJ:()=>Ns,sK:()=>x,sq:()=>ee,t3:()=>Ge,uk:()=>Ve,w7:()=>Lt,wN:()=>Xt,wT:()=>As,x:()=>oe,x$:()=>Ws,xB:()=>Ae,xo:()=>xs,yW:()=>ys,yj:()=>hs});var e=n(48820);const l=1,P=2,r=3,J=4,Y=5,m=6,Le=7,I=8,H=9,_=10,h=11,de=12,E=13,Z=14,q=15,U=16,ne=17,he=18,b=19,C=20,W=21,Q=22,z=23,N=24,g=25,B=26,G=27,ae=28,v=29,F=30,D=31,j=32,f=33,X=34,V=35,ie={json:l,logfmt:P,unpack:r,pattern:J,regexp:Y,label_format:Le,line_format:I,label_replace:H,vector:_,offset:h,bool:de,on:E,ignoring:Z,group_left:q,group_right:U,unwrap:m,decolorize:ne,drop:he,keep:b},je=Bt=>ie[Bt.toLowerCase()]||-1,L={by:C,without:W,and:Q,or:z,unless:N,sum:g,avg:B,count:G,max:ae,min:v,stddev:F,stdvar:D,bottomk:j,topk:f,sort:X,sort_desc:V},d=Bt=>L[Bt.toLowerCase()]||-1,p={__proto__:null,ip:295,count_over_time:301,rate:303,rate_counter:305,bytes_over_time:307,bytes_rate:309,avg_over_time:311,sum_over_time:313,min_over_time:315,max_over_time:317,stddev_over_time:319,stdvar_over_time:321,quantile_over_time:323,first_over_time:325,last_over_time:327,absent_over_time:329,bytes:335,duration:337,duration_seconds:339},c=e.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ",stateData:"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO",goto:"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:169,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"<n~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P2v!P!Q3v!Q!R3{!R![7^![!]9]!^!_9q!_!`:O!`!a:e!c!}:r!}#O;Y#P#Q;_#Q#R;d#R#S:r#S#T;i#T#o:r#o#p;u#p#q;z#q#r<i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kQ!x~}!O&q!Q![(w~&tQ#_#`&z#g#h(X~&}P#X#Y'Q~'TP#X#Y'W~'ZP#d#e'^~'aP}!O'd~'gP#X#Y'j~'mP#a#b'p~'sP#d#e'v~'yP#h#i'|~(PP#m#n(S~(XO!b~~([P#h#i(_~(bP#f#g(e~(hP#]#^(k~(nP#V#W(q~(tP#h#i(S~(zZ!O!P)m!Q![(w#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~)pP!Q![)s~)vV!Q![)s#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~*bP!m~!Q![*e~*hV!O!P*}!Q![*e#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+QP!Q![+T~+WU!Q![+T#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+oQ!m~!Q![+u#g#h-Q~+xV!O!P,_!Q![+u#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,bP!Q![,e~,hU!Q![,e#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,}P#g#h-Q~-VP!m~!Q![-Y~-]T!O!P-l!Q![-Y#b#c.R#i#j.^${$|.^~-oP!Q![-r~-uS!Q![-r#b#c.R#i#j.^${$|.^~.UP#g#h.X~.^O!m~~.aP#g#h.d~.iP!m~!Q![.l~.oR!O!P.x!Q![.l#b#c.R~.{P!Q![/O~/RQ!Q![/O#b#c.R~/^P!m~!Q![/a~/dU!O!P/v!Q![/a#a#b,z#b#c.R#i#j.^${$|.^~/yP!Q![/|~0PT!Q![/|#a#b,z#b#c.R#i#j.^${$|.^~0eP!m~!Q![0h~0kW!O!P)m!Q![0h#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~1YP!m~!Q![1]~1`X!O!P)m!Q![1]#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~2QP!m~!Q![2T~2WY!O!P)m!Q![2T#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T${$|.^~2yP!Q![2|~3RR!v~!Q![2|!g!h3[#X#Y3[~3_R{|3h}!O3h!Q![3n~3kP!Q![3n~3sP!v~!Q![3n~3{O#|~~4Qe!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#l#m8q#m#n1{${$|.^~5hR!v~!Q![5q!g!h3[#X#Y3[~5v`!v~!Q![5q!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~6}O!s~~7QQ!d!e6x#]#^7W~7ZP!d!e6x~7cd!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~8tR!Q![8}!c!i8}#T#Z8}~9SR!v~!Q![8}!c!i8}#T#Z8}P9bT{P!Q![9]![!]9]!c!}9]#R#S9]#T#o9]~9vP!o~!_!`9y~:OO!p~~:TQ|~!_!`:Z#r#s:`~:`O!q~~:eO!P~~:jP!l~!_!`:m~:rO!n~R:yT{P#zQ!Q![:r![!]9]!c!}:r#R#S:r#T#o:r~;_O$k~~;dO$l~~;iO$O~~;lRO#S;i#S#T%`#T~;i~;zO$U~~<PR!_~!_!`<Y!`!a<_#r#s<d~<_O!W~~<dO!Y~~<iO!X~~<nO$W~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(Bt,Ss)=>je(Bt)<<1},{term:43,get:(Bt,Ss)=>d(Bt)<<1|1},{term:43,get:Bt=>p[Bt]||-1}],tokenPrec:0}),T=1,k=2,te=3,fe=4,le=5,x=6,R=7,w=8,K=9,ce=10,y=11,oe=12,pe=13,me=14,Te=15,Oe=16,xe=17,be=18,ye=19,Be=20,Ae=21,ze=22,Ye=23,st=24,He=25,Xe=26,nt=27,at=28,vt=29,Ee=30,Qe=31,We=32,Ce=33,Re=34,$e=35,Ve=36,Ie=37,$=38,O=39,ge=40,ee=41,ue=42,De=43,Fe=44,re=45,Ke=46,Ue=47,Ze=48,pt=49,Ge=50,ut=51,ct=52,ot=53,Je=54,Ot=55,ft=56,ht=57,Lt=58,lt=59,Et=60,xt=61,wt=62,qe=63,It=64,Tt=65,yt=66,At=67,gt=68,$t=69,Nt=70,jt=71,Gt=72,Yt=73,kt=74,Ft=75,qt=76,zt=77,_t=78,is=79,es=80,rs=81,os=82,ts=83,Xt=84,ms=85,us=86,ss=87,ls=88,Vt=89,cs=90,Kt=91,gs=92,fs=93,hs=94,ps=95,Zt=96,Ht=97,ns=98,dt=99,Rt=100,Jt=101,Ts=102,Rs=103,rn=104,ws=105,ks=106,_s=107,zs=108,Xs=109,Vs=110,vs=111,Ks=112,Os=113,$s=114,Hs=115,xs=116,Fs=117,Gs=118,Ms=119,ys=120,Ys=121,Zs=122,Js=123,Ds=124,qs=125,as=126,js=127,Qs=128,Is=129,As=130,Ws=131,Ns=132,en=133,tn=134,sn=135,bs=136,on=137,Ls=138,Bs=139,Es=140},32300:(tt,we,n)=>{n.d(we,{U:()=>J});var e=n(22803),l=n(96540),P=n(63142),r=n(46936);const J=({children:m})=>{const Le=(0,P.of)(Y);return l.createElement("div",{className:Le.root},l.createElement(r.C,{gap:2},m))},Y=m=>({root:(0,e.css)({padding:m.spacing(1),backgroundColor:m.colors.background.secondary,borderRadius:m.shape.radius.default})})},46936:(tt,we,n)=>{n.d(we,{C:()=>P});var e=n(96540),l=n(41654);const P=({children:r,wrap:J=!0,...Y})=>{var m,Le;return e.createElement(l.B,{wrap:J?"wrap":void 0,direction:(m=Y.direction)!=null?m:"row",gap:(Le=Y.gap)!=null?Le:2,...Y},r)}},54078:(tt,we,n)=>{n.d(we,{Z:()=>Y});var e=n(22803),l=n(28848),P=n(96540),r=n(63704),J=n(63142);function Y({query:Le,language:I,className:H}){const _=(0,J.$j)(),h=m(_),de=l.highlight(Le,I.grammar,I.name);return P.createElement("div",{className:(0,e.cx)(h.editorField,"prism-syntax-highlight",H),"aria-label":"selector",dangerouslySetInnerHTML:{__html:r.sQ.sanitize(de)}})}const m=Le=>({editorField:(0,e.css)({fontFamily:Le.typography.fontFamilyMonospace,fontSize:Le.typography.bodySmall.fontSize})})},55060:(tt,we,n)=>{n.d(we,{T:()=>P});var e=n(96540),l=(r=>(r.Code="code",r.Builder="builder",r))(l||{});const P="Binary operations"},41391:(tt,we,n)=>{n.d(we,{A:()=>P});const e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function l(r){return typeof r=="string"&&e.test(r)}const P=l}}]);

//# sourceMappingURL=2516.dbc6af22c9f179f7f45b.js.map