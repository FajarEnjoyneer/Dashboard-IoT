"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4162],{76151:(K,M,n)=>{n.d(M,{V:()=>u,a:()=>l});var e=n(96540),d=n(52763),R=n(52161),P=n(5709),m=n(78467);const u=P.H.injectEndpoints({endpoints:o=>({getGroups:o.query({query:({ruleSource:r,namespace:s,groupName:a,ruleName:_,groupLimit:i,excludeAlerts:c,groupNextToken:E,notificationOptions:A})=>{if(r.uid===R.hY)throw new Error("Please use getGrafanaGroups endpoint for grafana rules");return{url:`api/prometheus/${r.uid}/api/v1/rules`,params:{file:s,"file[]":s,rule_group:a,"rule_group[]":a,rule_name:_,"rule_name[]":_,exclude_alerts:c?.toString(),group_limit:i?.toFixed(0),group_next_token:E},notificationOptions:A}},transformResponse:r=>({...r,data:{...r.data,groups:r.data.groups.map(m.JY)}})}),getGrafanaGroups:o.query({query:({folderUid:r,groupName:s,ruleName:a,contactPoint:_,health:i,state:c,groupLimit:E,limitAlerts:A,groupNextToken:C})=>({url:"api/prometheus/grafana/api/v1/rules",params:{folder_uid:r,rule_group:s,rule_name:a,receiver_name:_,health:i,state:c,limit_alerts:A,group_limit:E?.toFixed(0),group_next_token:C}}),providesTags:(r,s,{folderUid:a,groupName:_,ruleName:i})=>[{type:"GrafanaPrometheusGroups",id:`grafana/${a??"__any__"}/${_??"__any__"}/${i??"__any__"}`}]})})});function l(){const o=(0,d.wA)();return{populateGroupResponseCache:(0,e.useCallback)(s=>{o(u.util.upsertQueryData("getGrafanaGroups",{folderUid:s.folderUid,groupName:s.name},{data:{groups:[s]},status:"success"}))},[o])}}},93167:(K,M,n)=>{n.d(M,{e:()=>L});var e=n(74848),d=n(10378),R=n(96540),P=n(92745),m=n(68143),u=n(34999),l=n(70327),o=n(55143),r=n(76151),s=n(95443),a=n(94646),_=n(29609),i=n(70148),c=n(4956),E=n(78377),A=n(78297),C=n(87672),T=n(95081);const{useDiscoverDsFeaturesQuery:h}=o.L,{useGetGroupsQuery:O}=r.V,{useGetRuleGroupForNamespaceQuery:D}=l.hK;function L({groupIdentifier:g,expectedRulesCount:U=3}){const{namespace:I,groupName:p}=g,v=I.name,{data:W,isLoading:y,isError:G}=O({ruleSource:{uid:g.rulesSource.uid},namespace:v,groupName:p},{pollingInterval:s.HH}),{data:f,isLoading:j,isError:V}=h({uid:g.rulesSource.uid}),{data:F,error:$,isFetching:z,isError:Q}=D(f?.rulerConfig?{rulerConfig:f?.rulerConfig,namespace:v,group:p}:d.hT);if(y||j||z)return(0,e.jsx)(e.Fragment,{children:Array.from({length:U}).map((B,H)=>(0,e.jsx)(E.l,{},H))});if(G||V||Q)return(0,m.NF)($)&&$.status===404?(0,e.jsx)(u.F,{severity:"warning",title:(0,P.t)("alerting.ds-group-loader.group-deleting","The group is being deleted")}):(0,e.jsx)(u.F,{title:(0,P.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:p,namespaceName:v}),severity:"error"});const S=W?.data.groups.find(B=>B.file===v&&B.name===p);return f?.rulerConfig&&F&&(0,_.x6)(F)&&S?(0,e.jsx)(x,{groupIdentifier:g,promGroup:S,rulerGroup:F,application:f.application}):S?(0,e.jsx)(e.Fragment,{children:S.rules.map(B=>(0,e.jsx)(i.l,{rule:B,groupIdentifier:g,application:f?.application,showLocation:!1},(0,a.jY)(B)))}):(0,e.jsx)(u.F,{title:(0,P.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:p,namespaceName:v}),severity:"warning"})}function x({groupIdentifier:g,application:U,promGroup:I,rulerGroup:p}){const{namespace:v,groupName:W}=g,{matches:y,promOnlyRules:G}=(0,R.useMemo)(()=>(0,T.Y1)(p,I),[I,p]);return(0,e.jsxs)(e.Fragment,{children:[p.rules.map(f=>{const j=y.get(f);return j?(0,e.jsx)(i.l,{rule:j,rulerRule:f,groupIdentifier:g,application:U,actions:(0,e.jsx)(A.l,{rule:f,promRule:j,groupIdentifier:g,compact:!0}),showLocation:!1},(0,a.jY)(j)):(0,e.jsx)(c.B3,{name:(0,_.qz)(f),namespace:v.name,group:W,rulesSource:g.rulesSource,application:U,operation:C.s.Creating,showLocation:!1},(0,_.qz)(f))}),G.map(f=>(0,e.jsx)(c.B3,{name:f.name,namespace:v.name,group:W,rulesSource:g.rulesSource,application:U,operation:C.s.Deleting,showLocation:!1},f.name))]})}},70148:(K,M,n)=>{n.d(M,{l:()=>r});var e=n(74848),d=n(24619),R=n(39187),P=n(95443),m=n(94646),u=n(29609),l=n(92367),o=n(4956);function r({rule:a,rulerRule:_,groupIdentifier:i,application:c,actions:E,showLocation:A=!0}){const C=(0,R.w)(),{rulesSource:T,namespace:h,groupName:O}=i,D=_?(0,m.P1)(T.name,h.name,O,_):(0,m.Lg)(T.name,h.name,O,a),L=s(D,C),x=(0,u.uo)(a),g=_?(0,u.qz)(_):a.name,U=_?_.labels:a.labels,I={name:g,rulesSource:T,application:c,group:O,namespace:h.name,href:L,health:a.health,error:a.lastError,labels:U,actions:E,origin:x,showLocation:A};switch(a.type){case d.JS.Alerting:const v=((u.p.any.alertingRule(_)?_.annotations:a.annotations)??{})[P.YH.summary];return(0,e.jsx)(o.WG,{...I,summary:v,state:a.state,instancesCount:a.alerts?.length});case d.JS.Recording:return(0,e.jsx)(o.nh,{...I});default:return(0,e.jsx)(o.Om,{ruleName:g,groupIdentifier:i,ruleDefinition:a})}}function s(a,_){const i=encodeURIComponent((0,m.$9)(a)),c=encodeURIComponent(a.ruleSourceName);return(0,l.G)(`/alerting/${c}/${i}/view`,_?{returnTo:_}:{})}},48760:(K,M,n)=>{n.d(M,{$:()=>r});var e=n(74848),d=n(92745),R=n(34999),P=n(76151),m=n(95443),u=n(1621),l=n(78377);const{useGetGrafanaGroupsQuery:o}=P.V;function r({groupIdentifier:s,namespaceName:a,expectedRulesCount:_=3}){const{data:i,isLoading:c}=o({folderUid:s.namespace.uid,groupName:s.groupName,limitAlerts:0},{pollingInterval:m.HH});return c?(0,e.jsx)(e.Fragment,{children:Array.from({length:_}).map((E,A)=>(0,e.jsx)(l.l,{},A))}):i?(0,e.jsx)(e.Fragment,{children:i.data.groups.at(0)?.rules.map(E=>(0,e.jsx)(u.g,{rule:E,groupIdentifier:s,namespaceName:a,showLocation:!1},E.uid))}):(0,e.jsx)(R.F,{title:(0,d.t)("alerting.group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:s.groupName,namespaceName:a}),severity:"error"})}},1621:(K,M,n)=>{n.d(M,{g:()=>r});var e=n(74848),d=n(24619),R=n(52161),P=n(45311),m=n(29609),u=n(92367),l=n(4956),o=n(78297);function r({rule:s,groupIdentifier:a,namespaceName:_,operation:i,showLocation:c=!0}){const{name:E,uid:A,labels:C,provenance:T}=s,h={name:E,rulesSource:R.r6,group:a.groupName,namespace:_,href:(0,u.G)(`/alerting/grafana/${A}/view`),health:s?.health,error:s?.lastError,labels:C,isProvisioned:!!T,isPaused:s?.isPaused,application:"grafana",actions:(0,e.jsx)(o.l,{promRule:s,groupIdentifier:a,compact:!0})};if(m.R$.grafana.alertingRule(s)){const O=s&&s.type===d.JS.Alerting?s:void 0,D=(0,P.U)(O?.totals??{});return(0,e.jsx)(l.WG,{...h,summary:s.annotations?.summary,state:O?.state,instancesCount:D,operation:i,showLocation:c})}return m.R$.grafana.recordingRule(s)?(0,e.jsx)(l.nh,{...h,showLocation:c}):(0,e.jsx)(l.Om,{ruleName:E,groupIdentifier:a,ruleDefinition:s})}},78377:(K,M,n)=>{n.d(M,{l:()=>l});var e=n(74848),d=n(70255),R=n(77256),P=n(51592),m=n(15079),u=n(87672);function l(){return(0,e.jsx)(P.c,{title:(0,e.jsx)(d.A,{width:64}),icon:(0,e.jsx)(u.c,{isPaused:!1}),description:(0,e.jsx)(d.A,{width:256}),actions:(0,e.jsx)(m.T,{}),"data-testid":"alert-rule-list-item-loader","aria-disabled":!0})}function o({ruleIdentifier:r,error:s}){const a=s?stringifyErrorLike(s):t("alerting.rule-list.rulerrule-loading-error","Failed to load the rule");return jsx(ListItem,{title:r.uid,description:a,"data-testid":"ruler-rule-loading-error"})}},78297:(K,M,n)=>{n.d(M,{l:()=>C});var e=n(74848),d=n(2543),R=n.n(d),P=n(96540),m=n(92745),u=n(45861),l=n(41654),o=n(94380),r=n(53567),s=n(14050),a=n(2218),_=n(74268),i=n(16692),c=n(94646),E=n(29609),A=n(92367);function C({compact:O,rule:D,promRule:L,groupIdentifier:x}){const g=!O,[U,I]=(0,r.w)(g),[p,v]=(0,P.useState)(!1),[W,y]=(0,P.useState)(void 0),G=T(D,L),[f,j]=(0,i.mW)(D,x,i.j5.Update),[V,F]=(0,i.Es)(E.R$.grafana.rule(L)?L:i.hT,i.j5.Update),$=f&&j||V&&F,z=[],Q=O?"sm":"md",N=h(x,D,L);if(!N)return null;const Y=(0,E.xE)(D??L),S=(0,d.isString)(Y)&&(E.p.grafana.alertingRule(D)||E.R$.grafana.alertingRule(L));if($){const B=(0,A.G)(`/alerting/${encodeURIComponent(c.$9(N))}/edit`);z.push((0,e.jsx)(u.z9,{title:(0,m.t)("alerting.rule-actions-buttons.title-edit","Edit"),size:Q,variant:"secondary",fill:"text",href:B,children:(0,e.jsx)(m.x6,{i18nKey:"common.edit",children:"Edit"})},"edit"))}return(0,e.jsxs)(l.B,{gap:0,alignItems:"center",wrap:"nowrap",children:[z,(0,e.jsx)(o.A,{buttonSize:Q,fill:"text",rulerRule:D,promRule:L,groupIdentifier:x,identifier:N,handleDelete:(B,H)=>I(B,H),handleSilence:()=>v(!0),handleDuplicateRule:()=>y({identifier:N,isProvisioned:G})}),U,S&&p&&(0,e.jsx)(a.A,{ruleUid:Y,onClose:()=>v(!1)}),W?.identifier&&(0,e.jsx)(s.Z,{identifier:W.identifier,isProvisioned:W.isProvisioned,onDismiss:()=>y(void 0)})]})}function T(O,D){return O?(0,E.Nv)(O):D?(0,E.bL)(D):!1}function h(O,D,L){if(D)return c.co(O,D);if(E.R$.grafana.rule(L))return{ruleSourceName:"grafana",uid:L.uid};(0,_.FF)("Unable to construct an editable rule identifier")}},15079:(K,M,n)=>{n.d(M,{T:()=>R});var e=n(74848),d=n(70255);function R(){return(0,e.jsx)(d.A,{width:50,height:16})}},95081:(K,M,n)=>{n.d(M,{SF:()=>R,Y1:()=>m});var e=n(94646),d=n(29609);function R(u,l){const o=u.rules.filter(a=>(0,d.qz)(a)===l.name);if(o.length===1)return o[0];const r=o.filter(a=>(0,e.vL)(a,!1).join("-")===(0,e.Tn)(l,!1).join("-"));if(r.length===1)return r[0];const s=o.filter(a=>(0,e.vL)(a,!0).join("-")===(0,e.Tn)(l,!0).join("-"));if(s.length===1)return s[0]}function P(u,l){const o=u.rules.filter(a=>a.name===(0,d.qz)(l));if(o.length===1)return o[0];const r=o.filter(a=>(0,e.Tn)(a,!1).join("-")===(0,e.vL)(l,!1).join("-"));if(r.length===1)return r[0];const s=o.filter(a=>(0,e.Tn)(a,!0).join("-")===(0,e.vL)(l,!0).join("-"));if(s.length===1)return s[0]}function m(u,l){const o=u.rules.reduce((r,s)=>{const{matches:a,unmatchedPromRules:_}=r,i=P(l,s);return i&&(a.set(s,i),_.delete(i)),r},{matches:new Map,unmatchedPromRules:new Set(l.rules)});return{matches:o.matches,promOnlyRules:Array.from(o.unmatchedPromRules)}}}}]);

//# sourceMappingURL=4162.9a6f2ec5d79532fa987e.js.map