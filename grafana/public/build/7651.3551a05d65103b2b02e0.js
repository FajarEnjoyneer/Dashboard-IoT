"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7651],{71586:(C,p,s)=>{s.d(p,{S:()=>r});var o=s(74848),n=s(96540),g=s(49785),m=s(51898),l=s(92745),e=s(43173),h=s(63142),E=s(34999),f=s(37386),u=s(41654),_=s(45861),i=s(45967),d=s(61238),t=s(10180),a=s(10501);const r=({onSubmit:c,onSkip:w,showDefaultPasswordWarning:M})=>{const O=(0,h.of)(d.$),[D,x]=(0,n.useState)(!1),[L,P]=(0,n.useState)(!0),{handleSubmit:y,register:v,getValues:I,formState:{errors:A},watch:T}=(0,g.mN)({defaultValues:{newPassword:"",confirmNew:""}}),U=T("newPassword"),W=B=>{c(B.newPassword)};return(0,o.jsxs)("form",{onSubmit:y(W),children:[M&&(0,o.jsx)(E.F,{severity:"info",title:(0,l.t)("forgot-password.change-password.default-password-alert","Continuing to use the default password exposes you to security risks.")}),(0,o.jsx)(f.D,{label:(0,l.t)("forgot-password.change-password.new-password-label","New password"),invalid:!!A.newPassword,error:A?.newPassword?.message,children:(0,o.jsx)(t.s,{onFocus:()=>x(!0),...v("newPassword",{required:"New Password is required",onBlur:()=>P(!1),validate:{strongPasswordValidationRegister:a.DP}}),id:"new-password",autoFocus:!0,autoComplete:"new-password"})}),D&&(0,o.jsx)(a.zJ,{pristine:L,password:U,strongPasswordValidations:a.NQ}),(0,o.jsx)(f.D,{label:(0,l.t)("forgot-password.change-password.confirm-label","Confirm new password"),invalid:!!A.confirmNew,error:A?.confirmNew?.message,children:(0,o.jsx)(t.s,{...v("confirmNew",{required:"Confirmed Password is required",validate:B=>B===I().newPassword||"Passwords must match!"}),id:"confirm-new-password",autoComplete:"new-password"})}),(0,o.jsxs)(u.B,{direction:"column",children:[(0,o.jsx)(_.$n,{type:"submit",className:O.submitButton,children:(0,o.jsx)(l.x6,{i18nKey:"forgot-password.change-password.submit-button",children:"Submit"})}),!e.$.auth.basicAuthStrongPasswordPolicy&&w&&(0,o.jsx)(i.m,{content:(0,l.t)("forgot-password.change-password.tooltip-skip-button","If you skip you will be prompted to change password next time you log in."),placement:"bottom",children:(0,o.jsx)(_.$n,{className:O.skipButton,fill:"text",onClick:w,type:"button","data-testid":m.Tp.pages.Login.skip,children:(0,o.jsx)(l.x6,{i18nKey:"forgot-password.change-password.skip-button",children:"Skip"})})})]})]})}},53539:(C,p,s)=>{s.d(p,{A:()=>u});var o=s(74848),n=s(96540),g=s(92745),m=s(36490),l=s(68143),e=s(65642);const h=()=>!!e.Ay.oauth&&Object.keys(e.Ay.oauth).length>0,E=()=>!!m.Ny.getSearch().get("code");class f extends n.PureComponent{constructor(t){super(t),this.changePassword=a=>{const r={newPassword:a,confirmNew:a,oldPassword:"admin"};if(this.props.resetCode){const c={code:this.props.resetCode,newPassword:a,confirmPassword:a};(0,l.AI)().post("/api/user/password/reset",c).then(()=>{this.toGrafana()})}else(0,l.AI)().put("/api/user/password",r).then(()=>{this.toGrafana()}).catch(c=>console.error(c))},this.login=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,l.AI)().post("/login",a,{showErrorAlert:!1}).then(r=>{if(this.result=r,a.password!=="admin"||e.Ay.ldapEnabled||e.Ay.authProxyEnabled){this.toGrafana();return}else this.changeView(a.password==="admin")}).catch(r=>{const c=(0,l.NF)(r)?_(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:c||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessStart=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,l.AI)().post("/api/login/passwordless/start",a,{showErrorAlert:!1}).then(r=>{window.location.assign(r.URL)}).catch(r=>{const c=(0,l.NF)(r)?_(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:c||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.passwordlessConfirm=a=>{this.setState({loginErrorMessage:void 0,isLoggingIn:!0}),(0,l.AI)().post("/api/login/passwordless/authenticate",a,{showErrorAlert:!1}).then(r=>{this.result=r,this.toGrafana()}).catch(r=>{const c=(0,l.NF)(r)?_(r):void 0;this.setState({isLoggingIn:!1,loginErrorMessage:c||(0,g.t)("login.error.unknown","Unknown error occurred")})})},this.changeView=a=>{this.setState({isChangingPassword:!0,showDefaultPasswordWarning:a})},this.toGrafana=()=>{if(e.Ay.featureToggles.useSessionStorageForRedirection){window.location.assign(e.Ay.appSubUrl+"/");return}this.result?.redirectUrl?e.Ay.appSubUrl!==""&&!this.result.redirectUrl.startsWith(e.Ay.appSubUrl)?window.location.assign(e.Ay.appSubUrl+this.result.redirectUrl):window.location.assign(this.result.redirectUrl):window.location.assign(e.Ay.appSubUrl+"/")},this.state={isLoggingIn:!1,isChangingPassword:!1,showDefaultPasswordWarning:!1,loginErrorMessage:i(e.Ay.loginError)}}render(){const{children:t}=this.props,{isLoggingIn:a,isChangingPassword:r,showDefaultPasswordWarning:c,loginErrorMessage:w}=this.state,{login:M,toGrafana:O,changePassword:D,passwordlessStart:x,passwordlessConfirm:L}=this,{loginHint:P,passwordHint:y,disableLoginForm:v,disableUserSignUp:I}=e.Ay;return(0,o.jsx)(o.Fragment,{children:t({isOauthEnabled:h(),loginHint:P,passwordHint:y,disableLoginForm:v,disableUserSignUp:I,login:M,passwordlessStart:x,passwordlessConfirm:L,showPasswordlessConfirmation:E(),isLoggingIn:a,changePassword:D,skipPasswordChange:O,isChangingPassword:r,showDefaultPasswordWarning:c,loginErrorMessage:w})})}}const u=f;function _(d){switch(d.data?.messageId){case"password-auth.empty":case"password-auth.failed":case"password-auth.invalid":return(0,g.t)("login.error.invalid-user-or-password","Invalid username or password");case"login-attempt.blocked":return(0,g.t)("login.error.blocked","You have exceeded the number of login attempts for this user. Please try again later.");default:return d.data?.message}}function i(d){switch(d){case"oauth.login.error":return(0,g.t)("oauth.login.error","Login provider denied login request");default:return d}}},61238:(C,p,s)=>{s.d(p,{$:()=>d,Q:()=>i});var o=s(74848),n=s(22803),g=s(96540),m=s(49785),l=s(51898),e=s(92745),h=s(63142),E=s(37386),f=s(63527),u=s(45861),_=s(10180);const i=({children:t,onSubmit:a,isLoggingIn:r,passwordHint:c,loginHint:w})=>{const M=(0,h.of)(d),O=(0,g.useId)(),D=(0,g.useId)(),{handleSubmit:x,register:L,formState:{errors:P}}=(0,m.mN)({mode:"onChange"});return(0,o.jsx)("div",{className:M.wrapper,children:(0,o.jsxs)("form",{onSubmit:x(a),children:[(0,o.jsx)(E.D,{label:(0,e.t)("login.form.username-label","Email or username"),invalid:!!P.user,error:P.user?.message,children:(0,o.jsx)(f.p,{...L("user",{required:(0,e.t)("login.form.username-required","Email or username is required")}),id:O,autoFocus:!0,autoCapitalize:"none",placeholder:w||(0,e.t)("login.form.username-placeholder","email or username"),"data-testid":l.Tp.pages.Login.username})}),(0,o.jsx)(E.D,{label:(0,e.t)("login.form.password-label","Password"),invalid:!!P.password,error:P.password?.message,children:(0,o.jsx)(_.s,{...L("password",{required:(0,e.t)("login.form.password-required","Password is required")}),id:D,autoComplete:"current-password",placeholder:c||(0,e.t)("login.form.password-placeholder","password")})}),(0,o.jsx)(u.$n,{type:"submit","data-testid":l.Tp.pages.Login.submit,className:M.submitButton,disabled:r,children:r?(0,e.t)("login.form.submit-loading-label","Logging in..."):(0,e.t)("login.form.submit-label","Log in")}),t]})})},d=t=>({wrapper:(0,n.css)({width:"100%",paddingBottom:t.spacing(2)}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),skipButton:(0,n.css)({alignSelf:"flex-start"})})},58102:(C,p,s)=>{s.d(p,{GU:()=>f,YO:()=>_,qm:()=>E});var o=s(74848),n=s(22803),g=s(96540),m=s(92745),l=s(63142),e=s(92948),h=s(10388);const E=({children:i,enterAnimation:d=!0})=>{const t=(0,l.of)(_);return(0,o.jsx)("div",{className:(0,n.cx)(t.loginInnerBox,d&&t.enterAnimation),children:i})},f=({children:i,branding:d,isChangingPassword:t})=>{const a=(0,l.of)(_),[r,c]=(0,g.useState)(!1),w=d?.loginSubtitle??e.M.GetLoginSubTitle(),M=d?.loginTitle??e.M.LoginTitle,O=d?.loginBoxBackground||e.M.LoginBoxBackground(),D=d?.loginLogo,x=d?.hideEdition??e.M.HideEdition;return(0,g.useEffect)(()=>c(!0),[]),(0,o.jsxs)(e.M.LoginBackground,{className:(0,n.cx)(a.container,r&&a.loginAnim,d?.loginBackground),children:[(0,o.jsx)("div",{className:a.loginMain,children:(0,o.jsxs)("div",{className:(0,n.cx)(a.loginContent,O,"login-content-box"),children:[(0,o.jsxs)("div",{className:a.loginLogoWrapper,children:[(0,o.jsx)(e.M.LoginLogo,{className:a.loginLogo,logo:D}),(0,o.jsx)("div",{className:a.titleWrapper,children:t?(0,o.jsx)("h1",{className:a.mainTitle,children:(0,o.jsx)(m.x6,{i18nKey:"login.layout.update-password",children:"Update your password"})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:a.mainTitle,children:M}),w&&(0,o.jsx)("h3",{className:a.subTitle,children:w})]})})]}),(0,o.jsx)("div",{className:a.loginOuterBox,children:i})]})}),d?.hideFooter?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(h.wi,{hideEdition:x,customLinks:d?.footerLinks})]})},u=(0,n.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,_=i=>({loginMain:(0,n.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,n.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,n.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,n.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,n.css)({width:"100%",maxWidth:60,marginBottom:i.spacing(2),[i.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:i.spacing(3)}),titleWrapper:(0,n.css)({textAlign:"center"}),mainTitle:(0,n.css)({fontSize:22,[i.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,n.css)({fontSize:i.typography.size.md,color:i.colors.text.secondary}),loginContent:(0,n.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:i.shape.radius.default,padding:i.spacing(2,0),opacity:0,[i.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[i.breakpoints.up("sm")]:{minHeight:i.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,n.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,n.css)({padding:i.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[i.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,n.css)({[i.transitions.handleMotion("no-preference")]:{animation:`${u} ease-out 0.2s`}})})},10180:(C,p,s)=>{s.d(p,{s:()=>h});var o=s(74848),n=s(96540),g=s(51898),m=s(92745),l=s(63527),e=s(76319);const h=(0,n.forwardRef)((E,f)=>{const[u,_]=(0,n.useState)(!1);return(0,o.jsx)(l.p,{...E,type:u?"text":"password","data-testid":g.Tp.pages.Login.password,ref:f,suffix:(0,o.jsx)(e.K,{name:u?"eye-slash":"eye","aria-controls":E.id,role:"switch","aria-checked":u,onClick:()=>{_(!u)},tooltip:u?(0,m.t)("grafana-ui.password-field.tooltip-hide","Hide password"):(0,m.t)("grafana-ui.password-field.tooltip-show","Show password")})})});h.displayName="PasswordField"},10501:(C,p,s)=>{s.d(p,{DP:()=>u,NQ:()=>f,zJ:()=>_});var o=s(74848),n=s(22803),g=s(92745),m=s(31286),l=s(63142),e=s(30703),h=s(66404),E=s(65642);const f=[{message:"At least 12 characters",validation:t=>t.length>=12},{message:"One uppercase letter",validation:t=>/[A-Z]+/.test(t)},{message:"One lowercase letter",validation:t=>/[a-z]+/.test(t)},{message:"One number",validation:t=>/[0-9]+/.test(t)},{message:"One symbol",validation:t=>/[\W]/.test(t)}],u=t=>!E.Ay.auth.basicAuthStrongPasswordPolicy||f.every(a=>a.validation(t))||(0,g.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),_=({strongPasswordValidations:t,password:a,pristine:r})=>(0,o.jsx)(m.a,{marginBottom:2,children:t.map(c=>(0,o.jsx)(i,{strongPasswordValidation:c,password:a,pristine:r},c.message))}),i=({strongPasswordValidation:t,password:a,pristine:r})=>{const c=(0,l.of)(d),{basicAuthStrongPasswordPolicy:w}=E.Ay.auth;if(!w)return null;const{message:M,validation:O}=t,D=a.length>0&&O(a),x=D||r?"check":"exclamation-triangle",L=D?"secondary":r?"primary":"error";let P;return D?P=c.icon.valid:r?P=c.icon.pending:P=c.icon.error,(0,o.jsxs)(m.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,o.jsx)(e.I,{className:(0,n.cx)(c.icon.style,P),name:x}),(0,o.jsx)(h.E,{color:L,children:M})]},M)},d=t=>({icon:{style:(0,n.css)({marginRight:t.spacing(1)}),valid:(0,n.css)({color:t.colors.success.text}),pending:(0,n.css)({color:t.colors.secondary.text}),error:(0,n.css)({color:t.colors.error.text})}})}}]);

//# sourceMappingURL=7651.3551a05d65103b2b02e0.js.map