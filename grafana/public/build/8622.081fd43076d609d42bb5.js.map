{"version":3,"file":"8622.081fd43076d609d42bb5.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CloudCommonChannelSettings.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/CloudReceiverForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/GrafanaCommonChannelSettings.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/TestContactPointModal.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/GrafanaReceiverForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ChannelOptions.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ChannelSubForm.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/fields/DeletedSubform.tsx","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/util.ts","webpack://grafana/./public/app/features/alerting/unified/components/receivers/form/ReceiverForm.tsx"],"sourcesContent":["import { useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Checkbox, Field } from '@grafana/ui';\n\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\n\nexport const CloudCommonChannelSettings = ({\n  pathPrefix,\n  className,\n  readOnly = false,\n}: CommonSettingsComponentProps) => {\n  const { register } = useFormContext();\n\n  return (\n    <div className={className}>\n      <Field disabled={readOnly}>\n        <Checkbox\n          {...register(`${pathPrefix}sendResolved`)}\n          label={t('alerting.cloud-common-channel-settings.label-send-resolved', 'Send resolved')}\n          disabled={readOnly}\n          description={t(\n            'alerting.cloud-common-channel-settings.description-whether-notify-about-resolved-alerts',\n            'Whether or not to notify about resolved alerts.'\n          )}\n        />\n      </Field>\n    </div>\n  );\n};\n","import { useMemo } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Alert } from '@grafana/ui';\nimport { alertmanagerApi } from 'app/features/alerting/unified/api/alertmanagerApi';\nimport {\n  useCreateContactPoint,\n  useUpdateContactPoint,\n} from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { Receiver } from 'app/plugins/datasource/alertmanager/types';\n\nimport { CloudChannelMap, CloudChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport { cloudNotifierTypes } from '../../../utils/cloud-alertmanager-notifier-types';\nimport { isVanillaPrometheusAlertManagerDataSource } from '../../../utils/datasource';\nimport { cloudReceiverToFormValues, formValuesToCloudReceiver } from '../../../utils/receiver-form';\n\nimport { CloudCommonChannelSettings } from './CloudCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\nimport { Notifier } from './notifiers';\n\ninterface Props {\n  alertManagerSourceName: string;\n  contactPoint?: Receiver;\n  readOnly?: boolean;\n  editMode?: boolean;\n}\n\nconst defaultChannelValues: CloudChannelValues = Object.freeze({\n  __id: '',\n  sendResolved: true,\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  type: 'email',\n});\n\nconst cloudNotifiers = cloudNotifierTypes.map<Notifier>((n) => ({ dto: n }));\nconst { useGetAlertmanagerConfigurationQuery } = alertmanagerApi;\n\nexport const CloudReceiverForm = ({ contactPoint, alertManagerSourceName, readOnly = false, editMode }: Props) => {\n  const { isLoading, data: config } = useGetAlertmanagerConfigurationQuery(alertManagerSourceName);\n\n  const isVanillaAM = isVanillaPrometheusAlertManagerDataSource(alertManagerSourceName);\n  const [createContactPoint] = useCreateContactPoint({ alertmanager: alertManagerSourceName });\n  const [updateContactPoint] = useUpdateContactPoint({ alertmanager: alertManagerSourceName });\n\n  // transform receiver DTO to form values\n  const [existingValue] = useMemo((): [ReceiverFormValues<CloudChannelValues> | undefined, CloudChannelMap] => {\n    if (!contactPoint) {\n      return [undefined, {}];\n    }\n    return cloudReceiverToFormValues(contactPoint, cloudNotifierTypes);\n  }, [contactPoint]);\n\n  const onSubmit = async (values: ReceiverFormValues<CloudChannelValues>) => {\n    const newReceiver = formValuesToCloudReceiver(values, defaultChannelValues);\n\n    try {\n      if (editMode && contactPoint) {\n        await updateContactPoint.execute({ contactPoint: newReceiver, originalName: contactPoint.name });\n      } else {\n        await createContactPoint.execute({ contactPoint: newReceiver });\n      }\n      locationService.push('/alerting/notifications');\n    } catch (error) {\n      // React form validation will handle this for us\n    }\n  };\n\n  // this basically checks if we can manage the selected alert manager data source, either because it's a Grafana Managed one\n  // or a Mimir-based AlertManager\n  const isManageableAlertManagerDataSource = !readOnly && !isVanillaAM;\n\n  return (\n    <>\n      {!isVanillaAM && (\n        <Alert title={t('alerting.cloud-receiver-form.title-info', 'Info')} severity=\"info\">\n          <Trans i18nKey=\"alerting.cloud-receiver-form.body-info\">\n            Note that empty string values will be replaced with global defaults where appropriate.\n          </Trans>\n        </Alert>\n      )}\n      <ReceiverForm<CloudChannelValues>\n        showDefaultRouteWarning={!isLoading && !config?.alertmanager_config.route}\n        isEditable={isManageableAlertManagerDataSource}\n        isTestable={isManageableAlertManagerDataSource}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        notifiers={cloudNotifiers}\n        alertManagerSourceName={alertManagerSourceName}\n        defaultItem={defaultChannelValues}\n        commonSettingsComponent={CloudCommonChannelSettings}\n      />\n    </>\n  );\n};\n","import { useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Checkbox, Field } from '@grafana/ui';\n\nimport { CommonSettingsComponentProps } from '../../../types/receiver-form';\n\nexport const GrafanaCommonChannelSettings = ({\n  pathPrefix,\n  className,\n  readOnly = false,\n}: CommonSettingsComponentProps) => {\n  const { register } = useFormContext();\n\n  return (\n    <div className={className}>\n      <Field>\n        <Checkbox\n          {...register(`${pathPrefix}disableResolveMessage`)}\n          label={t(\n            'alerting.grafana-common-channel-settings.label-disable-resolved-message',\n            'Disable resolved message'\n          )}\n          description={t(\n            'alerting.grafana-common-channel-settings.description-disable-resolved-message',\n            'Disable the resolve message [OK] that is sent when alerting state returns to false'\n          )}\n          disabled={readOnly}\n        />\n      </Field>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\nimport { FormProvider, useForm } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Label, Modal, RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport { TestReceiversAlert } from 'app/plugins/datasource/alertmanager/types';\nimport { Annotations, Labels } from 'app/types/unified-alerting-dto';\n\nimport { defaultAnnotations } from '../../../utils/constants';\nimport AnnotationsStep from '../../rule-editor/AnnotationsStep';\nimport LabelsField from '../../rule-editor/labels/LabelsField';\n\ninterface Props {\n  isOpen: boolean;\n  onDismiss: () => void;\n  onTest: (alert?: TestReceiversAlert) => void;\n}\n\ntype AnnoField = {\n  key: string;\n  value: string;\n};\n\ninterface FormFields {\n  annotations: AnnoField[];\n  labels: AnnoField[];\n}\n\nenum NotificationType {\n  predefined = 'Predefined',\n  custom = 'Custom',\n}\n\nconst notificationOptions = Object.values(NotificationType).map((value) => ({ label: value, value: value }));\n\nconst defaultValues: FormFields = {\n  annotations: [...defaultAnnotations],\n  labels: [{ key: '', value: '' }],\n};\n\nexport const TestContactPointModal = ({ isOpen, onDismiss, onTest }: Props) => {\n  const [notificationType, setNotificationType] = useState<NotificationType>(NotificationType.predefined);\n  const styles = useStyles2(getStyles);\n  const formMethods = useForm<FormFields>({ defaultValues, mode: 'onBlur' });\n\n  const onSubmit = (data: FormFields) => {\n    if (notificationType === NotificationType.custom) {\n      const alert = {\n        annotations: data.annotations\n          .filter(({ key, value }) => !!key && !!value)\n          .reduce<Annotations>((acc, { key, value }) => {\n            return { ...acc, [key]: value };\n          }, {}),\n        labels: data.labels\n          .filter(({ key, value }) => !!key && !!value)\n          .reduce<Labels>((acc, { key, value }) => {\n            return { ...acc, [key]: value };\n          }, {}),\n      };\n      onTest(alert);\n    } else {\n      onTest();\n    }\n  };\n\n  return (\n    <Modal\n      onDismiss={onDismiss}\n      isOpen={isOpen}\n      title={t('alerting.test-contact-point-modal.title-test-contact-point', 'Test contact point')}\n    >\n      <div className={styles.section}>\n        <Label>\n          <Trans i18nKey=\"alerting.test-contact-point-modal.notification-message\">Notification message</Trans>\n        </Label>\n        <RadioButtonGroup\n          options={notificationOptions}\n          value={notificationType}\n          onChange={(value) => setNotificationType(value)}\n        />\n      </div>\n\n      <FormProvider {...formMethods}>\n        <form onSubmit={formMethods.handleSubmit(onSubmit)}>\n          {notificationType === NotificationType.predefined && (\n            <div className={styles.section}>\n              <Trans i18nKey=\"alerting.test-contact-point-modal.predefined-notification-message\">\n                You will send a test notification that uses a predefined alert. If you have defined a custom template or\n                message, for better results switch to <strong>custom</strong> notification message, from above.\n              </Trans>\n            </div>\n          )}\n          {notificationType === NotificationType.custom && (\n            <>\n              <div className={styles.section}>\n                <Trans i18nKey=\"alerting.test-contact-point-modal.custom-notification-message\">\n                  You will send a test notification that uses the annotations defined below. This is a good option if\n                  you use custom templates and messages.\n                </Trans>\n              </div>\n              <div className={styles.section}>\n                <AnnotationsStep />\n              </div>\n              <div className={styles.section}>\n                <LabelsField />\n              </div>\n            </>\n          )}\n\n          <Modal.ButtonRow>\n            <Button type=\"submit\">\n              <Trans i18nKey=\"alerting.test-contact-point-modal.send-test-notification\">Send test notification</Trans>\n            </Button>\n          </Modal.ButtonRow>\n        </form>\n      </FormProvider>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flexRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start',\n    marginBottom: theme.spacing(1),\n  }),\n  section: css({\n    marginBottom: theme.spacing(2),\n  }),\n});\n","import { useMemo, useState } from 'react';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Alert, LoadingPlaceholder } from '@grafana/ui';\nimport {\n  useCreateContactPoint,\n  useUpdateContactPoint,\n} from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { showManageContactPointPermissions } from 'app/features/alerting/unified/components/contact-points/utils';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\nimport { canEditEntity } from 'app/features/alerting/unified/utils/k8s/utils';\nimport {\n  GrafanaManagedContactPoint,\n  GrafanaManagedReceiverConfig,\n  TestReceiversAlert,\n} from 'app/plugins/datasource/alertmanager/types';\nimport { useDispatch } from 'app/types/store';\n\nimport { alertmanagerApi } from '../../../api/alertmanagerApi';\nimport { testReceiversAction } from '../../../state/actions';\nimport { GrafanaChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\nimport {\n  formChannelValuesToGrafanaChannelConfig,\n  formValuesToGrafanaReceiver,\n  grafanaReceiverToFormValues,\n} from '../../../utils/receiver-form';\nimport { ProvisionedResource, ProvisioningAlert } from '../../Provisioning';\nimport { ReceiverTypes } from '../grafanaAppReceivers/onCall/onCall';\nimport { useOnCallIntegration } from '../grafanaAppReceivers/onCall/useOnCallIntegration';\n\nimport { GrafanaCommonChannelSettings } from './GrafanaCommonChannelSettings';\nimport { ReceiverForm } from './ReceiverForm';\nimport { TestContactPointModal } from './TestContactPointModal';\nimport { Notifier } from './notifiers';\n\nconst defaultChannelValues: GrafanaChannelValues = Object.freeze({\n  __id: '',\n  secureSettings: {},\n  settings: {},\n  secureFields: {},\n  disableResolveMessage: false,\n  type: 'email',\n});\n\ninterface Props {\n  contactPoint?: GrafanaManagedContactPoint;\n  readOnly?: boolean;\n  editMode?: boolean;\n}\n\nconst { useGrafanaNotifiersQuery } = alertmanagerApi;\n\nexport const GrafanaReceiverForm = ({ contactPoint, readOnly = false, editMode }: Props) => {\n  const dispatch = useDispatch();\n  const [createContactPoint] = useCreateContactPoint({\n    alertmanager: GRAFANA_RULES_SOURCE_NAME,\n  });\n  const [updateContactPoint] = useUpdateContactPoint({\n    alertmanager: GRAFANA_RULES_SOURCE_NAME,\n  });\n\n  const {\n    onCallNotifierMeta,\n    extendOnCallNotifierFeatures,\n    extendOnCallReceivers,\n    onCallFormValidators,\n    isLoadingOnCallIntegration,\n    hasOnCallError,\n  } = useOnCallIntegration();\n\n  const { data: grafanaNotifiers = [], isLoading: isLoadingNotifiers } = useGrafanaNotifiersQuery();\n\n  const [testChannelValues, setTestChannelValues] = useState<GrafanaChannelValues>();\n\n  // transform receiver DTO to form values\n  const [existingValue, id2original] = useMemo((): [\n    ReceiverFormValues<GrafanaChannelValues> | undefined,\n    Record<string, GrafanaManagedReceiverConfig>,\n  ] => {\n    if (!contactPoint || isLoadingNotifiers || isLoadingOnCallIntegration) {\n      return [undefined, {}];\n    }\n\n    return grafanaReceiverToFormValues(extendOnCallReceivers(contactPoint));\n  }, [contactPoint, isLoadingNotifiers, extendOnCallReceivers, isLoadingOnCallIntegration]);\n\n  const onSubmit = async (values: ReceiverFormValues<GrafanaChannelValues>) => {\n    const newReceiver = formValuesToGrafanaReceiver(values, id2original, defaultChannelValues);\n\n    try {\n      if (editMode) {\n        if (contactPoint && contactPoint.id) {\n          await updateContactPoint.execute({\n            contactPoint: newReceiver,\n            id: contactPoint.id,\n            resourceVersion: contactPoint?.metadata?.resourceVersion,\n          });\n        } else if (contactPoint) {\n          await updateContactPoint.execute({\n            contactPoint: newReceiver,\n            originalName: contactPoint.name,\n          });\n        }\n      } else {\n        await createContactPoint.execute({ contactPoint: newReceiver });\n      }\n      locationService.push('/alerting/notifications');\n    } catch (error) {\n      // React form validation will handle this for us\n    }\n  };\n\n  const onTestChannel = (values: GrafanaChannelValues) => {\n    setTestChannelValues(values);\n  };\n\n  const testNotification = (alert?: TestReceiversAlert) => {\n    if (testChannelValues) {\n      const existing: GrafanaManagedReceiverConfig | undefined = id2original[testChannelValues.__id];\n      const chan = formChannelValuesToGrafanaChannelConfig(testChannelValues, defaultChannelValues, 'test', existing);\n\n      const payload = {\n        alertManagerSourceName: GRAFANA_RULES_SOURCE_NAME,\n        receivers: [\n          {\n            name: 'test',\n            grafana_managed_receiver_configs: [chan],\n          },\n        ],\n        alert,\n      };\n\n      dispatch(testReceiversAction(payload));\n    }\n  };\n\n  const isEditable = Boolean(\n    (!readOnly || (contactPoint && canEditEntity(contactPoint))) && !contactPoint?.provisioned\n  );\n  const isTestable = !readOnly;\n\n  if (isLoadingNotifiers || isLoadingOnCallIntegration) {\n    return (\n      <LoadingPlaceholder text={t('alerting.grafana-receiver-form.text-loading-notifiers', 'Loading notifiers...')} />\n    );\n  }\n\n  const notifiers: Notifier[] = grafanaNotifiers.map((n) => {\n    if (n.type === ReceiverTypes.OnCall) {\n      return {\n        dto: extendOnCallNotifierFeatures(n),\n        meta: onCallNotifierMeta,\n      };\n    }\n\n    return { dto: n };\n  });\n\n  return (\n    <>\n      {hasOnCallError && (\n        <Alert\n          severity=\"error\"\n          title={t(\n            'alerting.grafana-receiver-form.title-loading-on-call-integration-failed',\n            'Loading OnCall integration failed'\n          )}\n        >\n          <Trans i18nKey=\"alerting.grafana-receiver-form.body-loading-on-call-integration-failed\">\n            Grafana OnCall plugin has been enabled in your Grafana instances but it is not reachable. Please check the\n            plugin configuration\n          </Trans>\n        </Alert>\n      )}\n\n      {contactPoint?.provisioned && <ProvisioningAlert resource={ProvisionedResource.ContactPoint} />}\n\n      <ReceiverForm<GrafanaChannelValues>\n        contactPointId={contactPoint?.id}\n        isEditable={isEditable}\n        isTestable={isTestable}\n        onSubmit={onSubmit}\n        initialValues={existingValue}\n        onTestChannel={onTestChannel}\n        notifiers={notifiers}\n        alertManagerSourceName={GRAFANA_RULES_SOURCE_NAME}\n        defaultItem={{ ...defaultChannelValues }}\n        commonSettingsComponent={GrafanaCommonChannelSettings}\n        customValidators={{ [ReceiverTypes.OnCall]: onCallFormValidators }}\n        canManagePermissions={\n          editMode && contactPoint && showManageContactPointPermissions(GRAFANA_RULES_SOURCE_NAME, contactPoint)\n        }\n      />\n      <TestContactPointModal\n        onDismiss={() => setTestChannelValues(undefined)}\n        isOpen={!!testChannelValues}\n        onTest={(alert) => testNotification(alert)}\n      />\n    </>\n  );\n};\n","import * as React from 'react';\nimport { DeepMap, FieldError, FieldErrors, useFormContext } from 'react-hook-form';\n\nimport { Field, SecretInput } from '@grafana/ui';\nimport { NotificationChannelOption, NotificationChannelSecureFields, OptionMeta } from 'app/types/alerting';\n\nimport {\n  ChannelValues,\n  CloudChannelValues,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../../../types/receiver-form';\n\nimport { OptionField } from './fields/OptionField';\n\nexport interface Props<R extends ChannelValues> {\n  defaultValues: R;\n  selectedChannelOptions: NotificationChannelOption[];\n\n  onResetSecureField: (key: string) => void;\n  onDeleteSubform?: (settingsPath: string, option: NotificationChannelOption) => void;\n  errors?: FieldErrors<R>;\n  /**\n   * The path for the integration in the array of integrations.\n   * This is used to access the settings and secure fields for the integration in a type-safe way.\n   */\n  integrationPrefix: `items.${number}`;\n  readOnly?: boolean;\n\n  customValidators?: Record<string, React.ComponentProps<typeof OptionField>['customValidator']>;\n}\n\nexport function ChannelOptions<R extends ChannelValues>({\n  defaultValues,\n  selectedChannelOptions,\n  onResetSecureField,\n  onDeleteSubform,\n  errors,\n  integrationPrefix,\n  readOnly = false,\n  customValidators = {},\n}: Props<R>): JSX.Element {\n  const { watch } = useFormContext<ReceiverFormValues<CloudChannelValues | GrafanaChannelValues>>();\n\n  const [settings, secureFields] = watch([`${integrationPrefix}.settings`, `${integrationPrefix}.secureFields`]);\n\n  // Note: settingsPath includes a trailing dot for OptionField, unlike the path used in watch()\n  const settingsPath = `${integrationPrefix}.settings.` as const;\n\n  const getOptionMeta = (option: NotificationChannelOption): OptionMeta => ({\n    required: determineRequired(option, settings, secureFields),\n    readOnly: determineReadOnly(option, settings, secureFields),\n  });\n\n  return (\n    <>\n      {selectedChannelOptions.map((option: NotificationChannelOption, index: number) => {\n        const key = `${option.label}-${index}`;\n        // Some options can be dependent on other options, this determines what is selected in the dependency options\n        // I think this needs more thought.\n        // pathPrefix = items.index.\n        // const paths = pathPrefix.split('.');\n        const selectedOptionValue = settings?.[option.showWhen.field];\n\n        if (option.showWhen.field && selectedOptionValue !== option.showWhen.is) {\n          return null;\n        }\n\n        if (secureFields && secureFields[option.secureFieldKey ?? option.propertyName]) {\n          return (\n            <Field\n              key={key}\n              label={option.label}\n              description={option.description}\n              htmlFor={`${settingsPath}${option.propertyName}`}\n            >\n              <SecretInput\n                id={`${settingsPath}${option.propertyName}`}\n                onReset={() => onResetSecureField(option.secureFieldKey ?? option.propertyName)}\n                isConfigured\n              />\n            </Field>\n          );\n        }\n\n        const error: FieldError | DeepMap<any, FieldError> | undefined = (\n          (option.secure ? errors?.secureFields : errors?.settings) as DeepMap<any, FieldError> | undefined\n        )?.[option.secureFieldKey ?? option.propertyName];\n\n        const defaultValue = defaultValues?.settings?.[option.propertyName];\n\n        return (\n          <OptionField\n            secureFields={secureFields}\n            onResetSecureField={onResetSecureField}\n            onDeleteSubform={onDeleteSubform}\n            defaultValue={defaultValue}\n            readOnly={readOnly}\n            key={key}\n            error={error}\n            pathPrefix={settingsPath}\n            option={option}\n            customValidator={customValidators[option.propertyName]}\n            getOptionMeta={getOptionMeta}\n          />\n        );\n      })}\n    </>\n  );\n}\n\nconst determineRequired = (\n  option: NotificationChannelOption,\n  settings: Record<string, unknown>,\n  secureFields: NotificationChannelSecureFields\n) => {\n  if (!option.required) {\n    return false;\n  }\n\n  if (!option.dependsOn) {\n    return option.required ? 'Required' : false;\n  }\n\n  // TODO: This doesn't work with nested secureFields.\n  const dependentOn = Boolean(settings[option.dependsOn]) || Boolean(secureFields[option.dependsOn]);\n\n  if (dependentOn) {\n    return false;\n  }\n\n  return 'Required';\n};\n\nconst determineReadOnly = (\n  option: NotificationChannelOption,\n  settings: Record<string, unknown>,\n  secureFields: NotificationChannelSecureFields\n) => {\n  if (!option.dependsOn) {\n    return false;\n  }\n\n  // TODO: This doesn't work with nested secureFields.\n  return Boolean(settings[option.dependsOn]) || Boolean(secureFields[option.dependsOn]);\n};\n","import { css } from '@emotion/css';\nimport { sortBy } from 'lodash';\nimport * as React from 'react';\nimport { useEffect, useMemo } from 'react';\nimport { Controller, FieldErrors, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Alert, Button, Field, Select, Stack, Text, useStyles2 } from '@grafana/ui';\nimport { NotificationChannelOption } from 'app/types/alerting';\n\nimport { useUnifiedAlertingSelector } from '../../../hooks/useUnifiedAlertingSelector';\nimport {\n  ChannelValues,\n  CloudChannelValues,\n  CommonSettingsComponentType,\n  GrafanaChannelValues,\n  ReceiverFormValues,\n} from '../../../types/receiver-form';\nimport { OnCallIntegrationType } from '../grafanaAppReceivers/onCall/useOnCallIntegration';\n\nimport { ChannelOptions } from './ChannelOptions';\nimport { CollapsibleSection } from './CollapsibleSection';\nimport { Notifier } from './notifiers';\n\ninterface Props<R extends ChannelValues> {\n  defaultValues: R;\n  initialValues?: R;\n  pathPrefix: `items.${number}.`;\n  integrationIndex: number;\n  notifiers: Notifier[];\n  onDuplicate: () => void;\n  onTest?: () => void;\n  commonSettingsComponent: CommonSettingsComponentType;\n  errors?: FieldErrors<R>;\n  onDelete?: () => void;\n  isEditable?: boolean;\n  isTestable?: boolean;\n\n  customValidators?: React.ComponentProps<typeof ChannelOptions>['customValidators'];\n}\n\nexport function ChannelSubForm<R extends ChannelValues>({\n  defaultValues,\n  initialValues,\n  pathPrefix,\n  integrationIndex,\n  onDuplicate,\n  onDelete,\n  onTest,\n  notifiers,\n  errors,\n  commonSettingsComponent: CommonSettingsComponent,\n  isEditable = true,\n  isTestable,\n  customValidators = {},\n}: Props<R>): JSX.Element {\n  const styles = useStyles2(getStyles);\n  const { control, watch, register, trigger, formState, setValue, getValues } =\n    useFormContext<ReceiverFormValues<CloudChannelValues | GrafanaChannelValues>>();\n\n  const channelFieldPath = `items.${integrationIndex}` as const;\n  const typeFieldPath = `${channelFieldPath}.type` as const;\n  const settingsFieldPath = `${channelFieldPath}.settings` as const;\n\n  const selectedType = watch(typeFieldPath) ?? defaultValues.type;\n  const parse_mode = watch(`${settingsFieldPath}.parse_mode`);\n  const { loading: testingReceiver } = useUnifiedAlertingSelector((state) => state.testReceivers);\n\n  // TODO I don't like integration specific code here but other ways require a bigger refactoring\n  const onCallIntegrationType = watch(`${settingsFieldPath}.integration_type`);\n  const isTestAvailable = onCallIntegrationType !== OnCallIntegrationType.NewIntegration;\n\n  useEffect(() => {\n    register(`${channelFieldPath}.__id`);\n    /* Need to manually register secureFields or else they'll\n     be lost when testing a contact point */\n    register(`${channelFieldPath}.secureFields`);\n  }, [register, channelFieldPath]);\n\n  // Prevent forgetting about initial values when switching the integration type and the oncall integration type\n  useEffect(() => {\n    // Restore values when switching back from a changed integration to the default one\n    const subscription = watch((formValues, { name, type }) => {\n      // @ts-expect-error name is valid key for formValues\n      const value = name ? formValues[name] : '';\n      if (initialValues && name === typeFieldPath && value === initialValues.type && type === 'change') {\n        setValue(settingsFieldPath, initialValues.settings);\n      }\n      // Restore initial value of an existing oncall integration\n      if (\n        initialValues &&\n        name === `${settingsFieldPath}.integration_type` &&\n        value === OnCallIntegrationType.ExistingIntegration\n      ) {\n        setValue(`${settingsFieldPath}.url`, initialValues.settings.url);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, [selectedType, initialValues, setValue, settingsFieldPath, typeFieldPath, watch]);\n\n  const onResetSecureField = (key: string) => {\n    // formSecureFields might not be up to date if this function is called multiple times in a row\n    const currentSecureFields = getValues(`${channelFieldPath}.secureFields`);\n    if (currentSecureFields[key]) {\n      setValue(`${channelFieldPath}.secureFields`, { ...currentSecureFields, [key]: '' });\n    }\n  };\n\n  const findSecureFieldsRecursively = (options: NotificationChannelOption[]): string[] => {\n    const secureFields: string[] = [];\n    options?.forEach((option) => {\n      if (option.secure && option.secureFieldKey) {\n        secureFields.push(option.secureFieldKey);\n      }\n      if (option.subformOptions) {\n        secureFields.push(...findSecureFieldsRecursively(option.subformOptions));\n      }\n    });\n    return secureFields;\n  };\n\n  const onDeleteSubform = (settingsPath: string, option: NotificationChannelOption) => {\n    // Get all subform options with secure=true recursively.\n    const relatedSecureFields = findSecureFieldsRecursively(option.subformOptions ?? []);\n    relatedSecureFields.forEach((key) => {\n      onResetSecureField(key);\n    });\n    const fieldPath = settingsPath.startsWith(`${channelFieldPath}.settings.`)\n      ? settingsPath.slice(`${channelFieldPath}.settings.`.length)\n      : settingsPath;\n    setValue(`${settingsFieldPath}.${fieldPath}`, undefined);\n  };\n\n  const typeOptions = useMemo(\n    (): SelectableValue[] =>\n      sortBy(notifiers, ({ dto, meta }) => [meta?.order ?? 0, dto.name]).map<SelectableValue>(\n        ({ dto: { name, type }, meta }) => ({\n          // @ts-expect-error ReactNode is supported\n          label: (\n            <Stack alignItems=\"center\" gap={1}>\n              {name}\n              {meta?.badge}\n            </Stack>\n          ),\n          value: type,\n          description: meta?.description,\n          isDisabled: meta ? !meta.enabled : false,\n        })\n      ),\n    [notifiers]\n  );\n\n  const handleTest = async () => {\n    await trigger();\n    const isValid = Object.keys(formState.errors).length === 0;\n\n    if (isValid && onTest) {\n      onTest();\n    }\n  };\n\n  const notifier = notifiers.find(({ dto: { type } }) => type === selectedType);\n  const isTelegram = selectedType === 'telegram';\n  // Grafana AM takes \"None\" value and maps to an empty string,\n  // Cloud AM takes no value at all\n  const isParseModeNone = parse_mode === 'None' || !parse_mode;\n  const showTelegramWarning = isTelegram && !isParseModeNone;\n  // if there are mandatory options defined, optional options will be hidden by a collapse\n  // if there aren't mandatory options, all options will be shown without collapse\n  const mandatoryOptions = notifier?.dto.options.filter((o) => o.required) ?? [];\n  const optionalOptions = notifier?.dto.options.filter((o) => !o.required) ?? [];\n\n  const contactPointTypeInputId = `contact-point-type-${pathPrefix}`;\n  return (\n    <div className={styles.wrapper} data-testid=\"item-container\">\n      <div className={styles.topRow}>\n        <div>\n          <Field\n            label={t('alerting.channel-sub-form.label-integration', 'Integration')}\n            htmlFor={contactPointTypeInputId}\n            data-testid={`${pathPrefix}type`}\n          >\n            <Controller\n              name={typeFieldPath}\n              control={control}\n              defaultValue={defaultValues.type}\n              render={({ field: { ref, onChange, ...field } }) => (\n                <Select\n                  disabled={!isEditable}\n                  inputId={contactPointTypeInputId}\n                  {...field}\n                  width={37}\n                  options={typeOptions}\n                  onChange={(value) => onChange(value?.value)}\n                />\n              )}\n            />\n          </Field>\n        </div>\n        <div className={styles.buttons}>\n          {isTestable && onTest && isTestAvailable && (\n            <Button\n              disabled={testingReceiver}\n              size=\"xs\"\n              variant=\"secondary\"\n              type=\"button\"\n              onClick={() => handleTest()}\n              icon={testingReceiver ? 'spinner' : 'message'}\n            >\n              <Trans i18nKey=\"alerting.channel-sub-form.test\">Test</Trans>\n            </Button>\n          )}\n          {isEditable && (\n            <>\n              <Button size=\"xs\" variant=\"secondary\" type=\"button\" onClick={() => onDuplicate()} icon=\"copy\">\n                <Trans i18nKey=\"alerting.channel-sub-form.duplicate\">Duplicate</Trans>\n              </Button>\n              {onDelete && (\n                <Button\n                  data-testid={`${pathPrefix}delete-button`}\n                  size=\"xs\"\n                  variant=\"secondary\"\n                  type=\"button\"\n                  onClick={() => onDelete()}\n                  icon=\"trash-alt\"\n                >\n                  <Trans i18nKey=\"alerting.channel-sub-form.delete\">Delete</Trans>\n                </Button>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n      {notifier && (\n        <div className={styles.innerContent}>\n          {showTelegramWarning && (\n            <Alert\n              title={t(\n                'alerting.contact-points.telegram.parse-mode-warning-title',\n                'Telegram messages are limited to 4096 UTF-8 characters.'\n              )}\n              severity=\"warning\"\n            >\n              <Trans i18nKey=\"alerting.contact-points.telegram.parse-mode-warning-body\">\n                If you use a <Text variant=\"code\">parse_mode</Text> option other than <Text variant=\"code\">None</Text>,\n                truncation may result in an invalid message, causing the notification to fail. For longer messages, we\n                recommend using an alternative contact method.\n              </Trans>\n            </Alert>\n          )}\n          <ChannelOptions<R>\n            defaultValues={defaultValues}\n            selectedChannelOptions={mandatoryOptions.length ? mandatoryOptions : optionalOptions}\n            errors={errors}\n            onResetSecureField={onResetSecureField}\n            onDeleteSubform={onDeleteSubform}\n            integrationPrefix={channelFieldPath}\n            readOnly={!isEditable}\n            customValidators={customValidators}\n          />\n          {!!(mandatoryOptions.length && optionalOptions.length) && (\n            <CollapsibleSection\n              label={t('alerting.channel-sub-form.label-section', 'Optional {{name}} settings', {\n                name: notifier.dto.name,\n              })}\n            >\n              {notifier.dto.info !== '' && (\n                <Alert title=\"\" severity=\"info\">\n                  {notifier.dto.info}\n                </Alert>\n              )}\n              <ChannelOptions<R>\n                defaultValues={defaultValues}\n                selectedChannelOptions={optionalOptions}\n                onResetSecureField={onResetSecureField}\n                onDeleteSubform={onDeleteSubform}\n                errors={errors}\n                integrationPrefix={channelFieldPath}\n                readOnly={!isEditable}\n                customValidators={customValidators}\n              />\n            </CollapsibleSection>\n          )}\n          <CollapsibleSection\n            label={t('alerting.channel-sub-form.label-notification-settings', 'Notification settings')}\n          >\n            <CommonSettingsComponent pathPrefix={pathPrefix} readOnly={!isEditable} />\n          </CollapsibleSection>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  buttons: css({\n    '& > * + *': {\n      marginLeft: theme.spacing(1),\n    },\n  }),\n  innerContent: css({\n    maxWidth: '536px',\n  }),\n  wrapper: css({\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    border: `solid 1px ${theme.colors.border.medium}`,\n    borderRadius: theme.shape.radius.default,\n  }),\n  topRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n  }),\n  channelSettingsHeader: css({\n    marginTop: theme.spacing(2),\n  }),\n});\n","import { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\ninterface Props {\n  pathPrefix: string;\n}\n\n// we can't drop the deleted item from list entirely because\n// there will be a rece condition with register/unregister calls in react-hook-form\n// and fields will become randomly erroneously unregistered\nexport function DeletedSubForm({ pathPrefix }: Props): JSX.Element {\n  const { register } = useFormContext();\n\n  // required to be registered or react-hook-form will randomly drop the values when it feels like it\n  useEffect(() => {\n    register(`${pathPrefix}.__id`);\n    register(`${pathPrefix}.__deleted`);\n  }, [register, pathPrefix]);\n\n  return <>{null}</>;\n}\n","import { omit } from 'lodash';\n\nimport { ChannelValues, ReceiverFormValues } from '../../../types/receiver-form';\n\nexport interface DeprecatedAuthHTTPConfig {\n  bearer_token?: string;\n  bearer_token_file?: string;\n}\n\nexport interface HTTPAuthConfig {\n  authorization?: {\n    type: string;\n    credentials?: string;\n    credentials_file?: string;\n  };\n}\n\n// convert the newer http_config to the older (deprecated) format\nexport function normalizeFormValues(\n  values?: ReceiverFormValues<ChannelValues>\n): ReceiverFormValues<ChannelValues> | undefined {\n  if (!values) {\n    return;\n  }\n\n  return {\n    ...values,\n    items: values.items.map((item) => ({\n      ...item,\n      settings: {\n        ...item.settings,\n        http_config: item.settings?.http_config ? normalizeHTTPConfig(item.settings?.http_config) : undefined,\n      },\n    })),\n  };\n}\n\nfunction normalizeHTTPConfig(config: HTTPAuthConfig | DeprecatedAuthHTTPConfig): DeprecatedAuthHTTPConfig {\n  if (isDeprecatedHTTPAuthConfig(config)) {\n    return config;\n  }\n\n  return {\n    ...omit(config, 'authorization'),\n    bearer_token: config.authorization?.credentials,\n    bearer_token_file: config.authorization?.credentials_file,\n  };\n}\n\nfunction isDeprecatedHTTPAuthConfig(\n  config: HTTPAuthConfig | DeprecatedAuthHTTPConfig\n): config is DeprecatedAuthHTTPConfig {\n  return ['bearer_token', 'bearer_token_file'].some((prop) => prop in config);\n}\n","import { css } from '@emotion/css';\nimport * as React from 'react';\nimport { FieldErrors, FormProvider, SubmitErrorHandler, useForm } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { isFetchError } from '@grafana/runtime';\nimport { Alert, Button, Field, Input, LinkButton, Stack, useStyles2 } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { useValidateContactPoint } from 'app/features/alerting/unified/components/contact-points/useContactPoints';\nimport { ManagePermissions } from 'app/features/alerting/unified/components/permissions/ManagePermissions';\n\nimport { getMessageFromError } from '../../../../../../core/utils/errors';\nimport { logError } from '../../../Analytics';\nimport { isOnCallFetchError } from '../../../api/onCallApi';\nimport { useControlledFieldArray } from '../../../hooks/useControlledFieldArray';\nimport { ChannelValues, CommonSettingsComponentType, ReceiverFormValues } from '../../../types/receiver-form';\nimport { makeAMLink } from '../../../utils/misc';\nimport { initialAsyncRequestState } from '../../../utils/redux';\n\nimport { ChannelSubForm } from './ChannelSubForm';\nimport { DeletedSubForm } from './fields/DeletedSubform';\nimport { Notifier } from './notifiers';\nimport { normalizeFormValues } from './util';\n\ninterface Props<R extends ChannelValues> {\n  notifiers: Notifier[];\n  defaultItem: R;\n  alertManagerSourceName: string;\n  onTestChannel?: (channel: R) => void;\n  onSubmit: (values: ReceiverFormValues<R>) => Promise<void>;\n  commonSettingsComponent: CommonSettingsComponentType;\n  initialValues?: ReceiverFormValues<R>;\n  isEditable: boolean;\n  isTestable?: boolean;\n  customValidators?: Record<string, React.ComponentProps<typeof ChannelSubForm>['customValidators']>;\n  /**\n   * Should we show a warning that there is no default policy set,\n   * and that contact point being created will be set as the default?\n   */\n  showDefaultRouteWarning?: boolean;\n  contactPointId?: string;\n  canManagePermissions?: boolean;\n}\n\nexport function ReceiverForm<R extends ChannelValues>({\n  initialValues,\n  defaultItem,\n  notifiers,\n  alertManagerSourceName,\n  onSubmit,\n  onTestChannel,\n  commonSettingsComponent,\n  isEditable,\n  isTestable,\n  customValidators,\n  showDefaultRouteWarning,\n  contactPointId,\n  canManagePermissions,\n}: Props<R>) {\n  const notifyApp = useAppNotification();\n  const styles = useStyles2(getStyles);\n  const validateContactPointName = useValidateContactPoint({ alertmanager: alertManagerSourceName });\n\n  // normalize deprecated and new config values\n  const normalizedConfig = normalizeFormValues(initialValues);\n\n  const defaultValues = normalizedConfig ?? {\n    name: '',\n    items: [\n      {\n        ...defaultItem,\n        __id: String(Math.random()),\n      } as any,\n    ],\n  };\n\n  const formAPI = useForm<ReceiverFormValues<R>>({\n    // making a copy here beacuse react-hook-form will mutate these, and break if the object is frozen. for real.\n    defaultValues: structuredClone(defaultValues),\n  });\n\n  useCleanup((state) => (state.unifiedAlerting.saveAMConfig = initialAsyncRequestState));\n\n  const {\n    handleSubmit,\n    register,\n    formState: { errors, isSubmitting },\n    getValues,\n  } = formAPI;\n\n  const { fields, append, remove } = useControlledFieldArray<R>({ name: 'items', formAPI, softDelete: true });\n\n  const submitCallback = async (values: ReceiverFormValues<R>) => {\n    try {\n      await onSubmit({\n        ...values,\n        items: values.items.filter((item) => !item.__deleted),\n      });\n    } catch (e) {\n      if (e instanceof Error || isFetchError(e)) {\n        notifyApp.error('Failed to save the contact point', getErrorMessage(e));\n\n        const error = new Error('Failed to save the contact point');\n        error.cause = e;\n        logError(error);\n      }\n      throw e;\n    }\n  };\n\n  const onInvalid: SubmitErrorHandler<ReceiverFormValues<R>> = () => {\n    notifyApp.error('There are errors in the form. Please correct them and try again!');\n  };\n\n  return (\n    <FormProvider {...formAPI}>\n      {showDefaultRouteWarning && (\n        <Alert severity=\"warning\" title={t('alerting.receiver-form.title-attention', 'Attention')}>\n          <Trans i18nKey=\"alerting.receiver-form.body-attention\">\n            Because there is no default policy configured yet, this contact point will automatically be set as default.\n          </Trans>\n        </Alert>\n      )}\n\n      <form onSubmit={handleSubmit(submitCallback, onInvalid)} className={styles.wrapper}>\n        <Stack justifyContent=\"space-between\" alignItems=\"center\">\n          <h2 className={styles.heading}>\n            {!isEditable && t('alerting.receiver-form.contact-point', 'Contact point')}\n            {isEditable && initialValues && t('alerting.receiver-form.contact-point-update', 'Update contact point')}\n            {isEditable && !initialValues && t('alerting.receiver-form.contact-point-create', 'Create contact point')}\n          </h2>\n          {canManagePermissions && contactPointId && (\n            <ManagePermissions\n              resource=\"receivers\"\n              resourceId={contactPointId}\n              resourceName={initialValues?.name}\n              title={t(\n                'alerting.receiver-form.title-manage-contact-point-permissions',\n                'Manage contact point permissions'\n              )}\n            />\n          )}\n        </Stack>\n        <Field\n          label={t('alerting.receiver-form.label-name', 'Name')}\n          invalid={!!errors.name}\n          error={errors.name && errors.name.message}\n          required\n        >\n          <Input\n            readOnly={!isEditable}\n            id=\"name\"\n            {...register('name', {\n              required: 'Name is required',\n              validate: async (value) => {\n                const existingValue = initialValues?.name;\n                return validateContactPointName(value, existingValue);\n              },\n            })}\n            width={39}\n            placeholder={t('alerting.receiver-form.name-placeholder-name', 'Name')}\n          />\n        </Field>\n        {fields.map((field, index) => {\n          const pathPrefix = `items.${index}.` as const;\n          if (field.__deleted) {\n            return <DeletedSubForm key={field.__id} pathPrefix={pathPrefix} />;\n          }\n          const initialItem = initialValues?.items.find(({ __id }) => __id === field.__id);\n          return (\n            <ChannelSubForm<R>\n              defaultValues={field}\n              initialValues={initialItem}\n              key={field.__id}\n              integrationIndex={index}\n              onDuplicate={() => {\n                const currentValues: R = getValues().items[index];\n                append({ ...currentValues, __id: String(Math.random()) });\n              }}\n              onTest={\n                onTestChannel\n                  ? () => {\n                      const currentValues: R = getValues().items[index];\n                      onTestChannel(currentValues);\n                    }\n                  : undefined\n              }\n              onDelete={() => remove(index)}\n              pathPrefix={pathPrefix}\n              notifiers={notifiers}\n              errors={errors?.items?.[index] as FieldErrors<R>}\n              commonSettingsComponent={commonSettingsComponent}\n              isEditable={isEditable}\n              isTestable={isTestable}\n              customValidators={customValidators ? customValidators[field.type] : undefined}\n            />\n          );\n        })}\n        {isEditable && (\n          <Button\n            type=\"button\"\n            icon=\"plus\"\n            variant=\"secondary\"\n            onClick={() => append({ ...defaultItem, __id: String(Math.random()) })}\n          >\n            <Trans i18nKey=\"alerting.receiver-form.add-contact-point-integration\">Add contact point integration</Trans>\n          </Button>\n        )}\n        <div className={styles.buttons}>\n          {isEditable && (\n            <>\n              {isSubmitting && (\n                <Button disabled={true} icon=\"spinner\" variant=\"primary\">\n                  <Trans i18nKey=\"alerting.receiver-form.saving\">Saving...</Trans>\n                </Button>\n              )}\n              {!isSubmitting && (\n                <Button type=\"submit\">\n                  <Trans i18nKey=\"alerting.receiver-form.save-contact-point\">Save contact point</Trans>\n                </Button>\n              )}\n            </>\n          )}\n          <LinkButton\n            disabled={isSubmitting}\n            variant=\"secondary\"\n            data-testid=\"cancel-button\"\n            href={makeAMLink('/alerting/notifications', alertManagerSourceName)}\n          >\n            <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n          </LinkButton>\n        </div>\n      </form>\n    </FormProvider>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  heading: css({\n    margin: theme.spacing(2, 0, 3, 0),\n  }),\n  buttons: css({\n    marginTop: theme.spacing(4),\n\n    '& > * + *': {\n      marginLeft: theme.spacing(1),\n    },\n  }),\n  wrapper: css({\n    maxWidth: `${theme.breakpoints.values.xl}px`,\n  }),\n});\n\nfunction getErrorMessage(error: unknown) {\n  if (isOnCallFetchError(error)) {\n    return error.data.detail;\n  }\n\n  return getMessageFromError(error);\n}\n"],"names":["CloudCommonChannelSettings","pathPrefix","className","readOnly","register","Field","Checkbox","defaultChannelValues","cloudNotifiers","n","useGetAlertmanagerConfigurationQuery","alertmanagerApi","CloudReceiverForm","contactPoint","alertManagerSourceName","editMode","isLoading","config","isVanillaAM","createContactPoint","updateContactPoint","existingValue","onSubmit","values","newReceiver","isManageableAlertManagerDataSource","Alert","ReceiverForm","GrafanaCommonChannelSettings","NotificationType","notificationOptions","value","defaultValues","TestContactPointModal","isOpen","onDismiss","onTest","notificationType","setNotificationType","styles","getStyles","formMethods","data","alert","key","acc","Modal","Label","RadioButtonGroup","AnnotationsStep","LabelsField","Button","theme","useGrafanaNotifiersQuery","GrafanaReceiverForm","dispatch","onCallNotifierMeta","extendOnCallNotifierFeatures","extendOnCallReceivers","onCallFormValidators","isLoadingOnCallIntegration","hasOnCallError","useOnCallIntegration","grafanaNotifiers","isLoadingNotifiers","testChannelValues","setTestChannelValues","id2original","onTestChannel","testNotification","existing","chan","payload","isEditable","isTestable","LoadingPlaceholder","notifiers","Provisioning","ChannelOptions","selectedChannelOptions","onResetSecureField","onDeleteSubform","errors","integrationPrefix","customValidators","watch","settings","secureFields","settingsPath","getOptionMeta","option","determineRequired","determineReadOnly","index","selectedOptionValue","SecretInput","error","defaultValue","OptionField","ChannelSubForm","initialValues","integrationIndex","onDuplicate","onDelete","CommonSettingsComponent","control","trigger","formState","setValue","getValues","channelFieldPath","typeFieldPath","settingsFieldPath","selectedType","parse_mode","testingReceiver","useUnifiedAlertingSelector","state","isTestAvailable","subscription","formValues","name","type","currentSecureFields","findSecureFieldsRecursively","options","fieldPath","typeOptions","dto","meta","Stack","handleTest","notifier","showTelegramWarning","mandatoryOptions","o","optionalOptions","contactPointTypeInputId","ref","onChange","field","Select","Text","CollapsibleSection","DeletedSubForm","normalizeFormValues","item","normalizeHTTPConfig","isDeprecatedHTTPAuthConfig","prop","defaultItem","commonSettingsComponent","showDefaultRouteWarning","contactPointId","canManagePermissions","notifyApp","validateContactPointName","formAPI","useCleanup","handleSubmit","isSubmitting","fields","append","remove","useControlledFieldArray","submitCallback","e","getErrorMessage","onInvalid","ManagePermissions","Input","initialItem","__id","currentValues"],"sourceRoot":""}