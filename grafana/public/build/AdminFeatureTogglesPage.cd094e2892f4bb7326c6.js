"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7024],{75180:(X,x,s)=>{s.r(x),s.d(x,{default:()=>L});var e=s(74848),f=s(22803),d=s(96540),C=s(16817),i=s(92745),A=s(63142),R=s(30703),y=s(13791),b=s(68143);class B{constructor(){this.baseURL="/apis/featuretoggle.grafana.app/v0alpha1"}async getFeatureToggles(){const t=await(0,b.AI)().get(this.baseURL+"/current");return{restartRequired:!!t.restartRequired,allowEditing:!!t.allowEditing,toggles:t.toggles.map(r=>({name:r.name,description:r.description,enabled:r.enabled,readOnly:!r.writeable,stage:r.stage,hidden:!1}))}}updateFeatureToggles(t){const r={kind:"ResolvedToggleState",enabled:{}};return t.forEach(l=>{r.enabled[l.name]=l.enabled}),(0,b.AI)().patch(this.baseURL+"/current",r)}}const j=()=>new B;var T=s(45967),F=s(21285),I=s(45861),w=s(71599),E=s(27594);const M=(n,t)=>n.original.name.localeCompare(t.original.name),N=(n,t)=>{if(!n.original.description&&!t.original.description)return 0;if(n.original.description){if(!t.original.description)return-1}else return 1;return n.original.description.localeCompare(t.original.description)},G=(n,t)=>n.original.enabled===t.original.enabled?0:n.original.enabled?1:-1;function K({featureToggles:n,allowEditing:t,onUpdateSuccess:r}){n.sort((a,o)=>a.name.localeCompare(o.name));const l=(0,d.useRef)(n),[g,m]=(0,d.useState)(n),[c,u]=(0,d.useState)(!1),[P,U]=(0,d.useState)(!1),D=j(),Y=(a,o)=>{const v={...a,enabled:o},Q=g.map(S=>S.name===a.name?v:S);m(Q)},V=async()=>{u(!0);try{const a=W();await D.updateFeatureToggles(a),l.current=[...g],r()}finally{u(!1)}},h=(0,d.useRef)(null),p=a=>()=>{U(a),!a&&h.current&&h.current.focus()},W=()=>g.filter((a,o)=>a.enabled!==l.current[o].enabled),$=()=>g.some((a,o)=>a.enabled!==l.current[o].enabled),z=a=>t?a?"This is a non-editable feature":"":"Feature management is not configured for editing",H=a=>{switch(a){case"GA":return(0,e.jsx)(T.m,{content:(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.content-general-availability","General availability"),children:(0,e.jsx)("div",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.get-stage-cell.ga",children:"GA"})})});case"privatePreview":case"preview":case"experimental":return(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.beta","Beta");case"deprecated":return(0,i.t)("admin.admin-feature-toggles-table.get-stage-cell.deprecated","Deprecated");default:return a}},J=[{id:"name",header:"Name",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:a}),sortType:M},{id:"description",header:"Description",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:a}),sortType:N},{id:"stage",header:"Stage",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:H(a)})},{id:"enabled",header:"State",cell:({row:a})=>{const o=(0,e.jsx)("div",{children:(0,e.jsx)(F.d,{value:a.original.enabled,disabled:a.original.readOnly,onChange:v=>Y(a.original,v.currentTarget.checked)})});return a.original.readOnly?(0,e.jsx)(T.m,{content:z(a.original.readOnly),children:o}):o},sortType:G}];return(0,e.jsxs)(e.Fragment,{children:[t&&(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0 0 5px 0"},children:[(0,e.jsx)(I.$n,{disabled:!$()||c,onClick:p(!0),ref:h,children:c?(0,i.t)("admin.admin-feature-toggles-table.saving","Saving..."):(0,i.t)("admin.admin-feature-toggles-table.save-changes","Save changes")}),(0,e.jsx)(w.u,{isOpen:P,title:(0,i.t)("admin.admin-feature-toggles-table.title-apply-feature-toggle-changes","Apply feature toggle changes"),body:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.confirm-modal-body-1",children:"Some features are stable (GA) and enabled by default, whereas some are currently in their preliminary Beta phase, available for early adoption."})}),(0,e.jsx)("p",{children:(0,e.jsx)(i.x6,{i18nKey:"admin.admin-feature-toggles-table.confirm-modal-body-2",children:"We advise understanding the implications of each feature change before making modifications."})})]}),confirmText:(0,i.t)("admin.admin-feature-toggles-table.confirmText-save-changes","Save changes"),onConfirm:async()=>{p(!1)(),V()},onDismiss:p(!1)})]}),(0,e.jsx)(E.j,{columns:J,data:g,getRowId:a=>a.name})]})}function L(){const[n,t]=(0,d.useState)(1),r=j(),l=(0,C.A)(()=>r.getFeatureToggles(),[n]),g=(0,A.of)(O),m=()=>{t(n+1)},c=()=>(0,e.jsxs)("div",{className:g.warning,children:[(0,e.jsx)("div",{className:g.icon,children:(0,e.jsx)(R.I,{name:"exclamation-triangle"})}),(0,e.jsx)("span",{className:g.message,children:l.value?.restartRequired?(0,i.t)("admin.feature-toggles.restart-pending","A restart is pending for your Grafana instance to apply the latest feature toggle changes"):(0,i.t)("admin.feature-toggles.restart-required","Saving feature toggle changes will prompt a restart of the instance, which may take a few minutes")})]}),u=(0,e.jsx)("div",{children:(0,e.jsxs)(i.x6,{i18nKey:"admin.feature-toggles.sub-title",children:["View and edit feature toggles. Read more about feature toggles at"," ",(0,e.jsx)("a",{className:"external-link",target:"_new",href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/feature-toggles/",children:"grafana.com"}),"."]})});return(0,e.jsx)(y.Y,{navId:"feature-toggles",subTitle:u,children:(0,e.jsx)(y.Y.Contents,{isLoading:l.loading,children:(0,e.jsxs)(e.Fragment,{children:[l.error?.message,l.loading&&"Fetching feature toggles",(0,e.jsx)(c,{}),l.value&&(0,e.jsx)(K,{featureToggles:l.value.toggles,allowEditing:l.value.allowEditing||!1,onUpdateSuccess:m})]})})})}function O(n){return{warning:(0,f.css)({display:"flex",marginTop:n.spacing(.25),marginBottom:n.spacing(.25)}),icon:(0,f.css)({color:n.colors.warning.main,paddingRight:n.spacing()}),message:(0,f.css)({color:n.colors.text.secondary,marginTop:n.spacing(.25)})}}}}]);

//# sourceMappingURL=AdminFeatureTogglesPage.cd094e2892f4bb7326c6.js.map