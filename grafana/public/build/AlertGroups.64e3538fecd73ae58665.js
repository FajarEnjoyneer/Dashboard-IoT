"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8427],{13549:(te,N,t)=>{t.r(N),t.d(N,{default:()=>re});var e=t(74848),d=t(96540),i=t(92745),v=t(6975),S=t(34999),K=t(31286),z=t(66404),C=t(70958),I=t(52763),T=t(84266),R=t(91984),Q=t(36826),W=t(82658),F=t(22803),E=t(63142),H=t(45861),G=t(77256),L=t(72636),B=t(45967),P=t(30703),J=t(77824);const U=({onStateFilterChange:r,stateFilter:m})=>{const p=Object.entries(T.Or).sort(([l],[n])=>l<n?-1:1).map(([l,n])=>({label:l,value:n}));return(0,e.jsxs)("div",{children:[(0,e.jsxs)(L.J,{children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-state-filter.notification-state",children:"Notification state"}),"\xA0"]}),(0,e.jsx)(B.m,{content:(0,e.jsx)("div",{children:(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-state-filter.active-the-alert-is-firing",children:"Active: The alert notification has been handled. The alert is still firing and continues to be managed."})}),(0,e.jsx)("li",{children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-state-filter.suppressed-the-alert-has-been-silenced",children:"Suppressed: The alert has been silenced."})}),(0,e.jsx)("li",{children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-state-filter.unprocessed-the-alert-is-received",children:"Unprocessed: The alert is received but its notification has not been processed yet."})})]})}),children:(0,e.jsx)(P.I,{name:"info-circle",size:"sm"})})]}),(0,e.jsx)(J.z,{options:p,value:m,onChange:r})]})};var D=t(2543),Y=t(18857),V=t(39659);const X=({groups:r,groupBy:m,onGroupingChange:p})=>{const l=(0,D.uniq)(r.flatMap(n=>n.alerts).flatMap(({labels:n})=>Object.keys(n))).filter(n=>!(0,V.F2)(n)).map(n=>({label:n,value:n}));return(0,e.jsxs)("div",{"data-testid":"group-by-container",children:[(0,e.jsxs)(L.J,{children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(i.x6,{i18nKey:"alerting.group-by.custom-group-by",children:"Custom group by"}),"\xA0"]}),(0,e.jsx)(B.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)(i.x6,{i18nKey:"alerting.group-by.tooltip-group-by",children:"Group notifications using a different combination of labels. This option can help validate the grouping settings of your notification policies."})}),children:(0,e.jsx)(P.I,{name:"info-circle",size:"sm"})})]}),(0,e.jsx)(Y.KF,{"aria-label":(0,i.t)("alerting.group-by.aria-label-group-by-label-keys","Group by label keys"),value:m,placeholder:(0,i.t)("alerting.group-by.placeholder-group-by","Group by"),prefix:(0,e.jsx)(P.I,{name:"tag-alt"}),onChange:n=>{p(n.map(({value:f})=>f))},options:l,width:34})]})};var Z=t(87133);const w=({groups:r})=>{const[m,p]=(0,d.useState)(Math.floor(Math.random()*100)),[l,n]=(0,C.s)(),{groupBy:f=[],queryString:o,alertState:c}=(0,G.Ht)(l),j=`matcher-${m}`,y=(0,E.of)(k),A=()=>{n({groupBy:null,queryString:null,alertState:null,contactPoint:null}),setTimeout(()=>p(m+1),100)},$=!!(f.length>0||o||c);return(0,e.jsx)("div",{className:y.wrapper,children:(0,e.jsxs)("div",{className:y.filterSection,children:[(0,e.jsx)(Z.X,{defaultQueryString:o,onFilterChange:u=>n({queryString:u||null})},j),(0,e.jsx)(X,{groups:r,groupBy:f,onGroupingChange:u=>n({groupBy:u.length?u.join(","):null})}),(0,e.jsx)(U,{stateFilter:c,onStateFilterChange:u=>n({alertState:u||null})}),$&&(0,e.jsx)(H.$n,{className:y.clearButton,variant:"secondary",icon:"times",onClick:A,children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-group-filter.clear-filters",children:"Clear filters"})})]})})},k=r=>({wrapper:(0,F.css)({borderBottom:`1px solid ${r.colors.border.medium}`,marginBottom:r.spacing(3)}),filterSection:(0,F.css)({display:"flex",flexDirection:"row",marginBottom:r.spacing(3),gap:r.spacing(1)}),clearButton:(0,F.css)({marginLeft:r.spacing(1),marginTop:"19px"})});var q=t(86017),_=t(63895);const ee=r=>{const[m]=(0,C.s)(),{queryString:p,alertState:l}=(0,G.Ht)(m);return(0,d.useMemo)(()=>{const n=p?(0,_.Zc)(p):[];return r.reduce((f,o)=>{const c=o.alerts.filter(({labels:j,status:y})=>{const A=(0,q.Av)(j,n),$=l?y.state===l:!0;return A&&$});return c.length>0&&(Object.keys(o.labels).length===0?f.unshift({...o,alerts:c}):f.push({...o,alerts:c})),f},[])},[p,r,l])},s=(r,m)=>(0,d.useMemo)(()=>m.length===0?r.filter(n=>Object.keys(n.labels).length===0).length>1?r.reduce((n,f)=>{if(Object.keys(f.labels).length===0){const o=n.find(({labels:c})=>Object.keys(c));o?o.alerts=(0,D.uniqBy)([...o.alerts,...f.alerts],"labels"):n.push({alerts:f.alerts,labels:{},receiver:{name:"NONE"}})}else n.push(f);return n},[]):r:(0,D.uniqBy)(r.flatMap(({alerts:l})=>l),l=>l.fingerprint).reduce((l,n)=>{if(m.every(o=>Object.keys(n.labels).includes(o)))n.receivers.map(c=>({alerts:[n],labels:m.reduce((j,y)=>(j={...j,[y]:n.labels[y]},j),{}),receiver:c})).forEach(c=>{const j=l.find(y=>Object.keys(c.labels).every(A=>y.labels[A]===c.labels[A])&&y.receiver.name===c.receiver.name);j?j.alerts.push(n):l.push(c)});else{const o=l.find(c=>Object.keys(c.labels).length===0);o?o.alerts.push(n):l.push({alerts:[n],labels:{},receiver:{name:"NONE"}})}return l},[]),[r,m]);var x=t(98127),g=t(5358),b=t(11018),h=t(95443),a=t(52161),O=t(36200),se=t(88547);const ne=()=>{const{selectedAlertmanager:r}=(0,g.VI)(),m=(0,I.wA)(),[p]=(0,C.s)(),{groupBy:l=[]}=(0,G.Ht)(p),{currentData:n}=R.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(),f=(0,x.$)(u=>u.amAlertGroups),{loading:o,error:c,result:j=[]}=f[r||""]??O.jA,y=s(j,l),A=ee(y),$=r===a.hY&&n?.alertmanagersChoice===T.nA.External;return(0,d.useEffect)(()=>{function u(){r&&m((0,b.D3)(r))}u();const M=setInterval(u,h.U3);return()=>{clearInterval(M)}},[m,r]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w,{groups:j}),o&&(0,e.jsx)(v._,{text:(0,i.t)("alerting.alert-groups.text-loading-notifications","Loading notifications")}),c&&!o&&(0,e.jsx)(S.F,{title:(0,i.t)("alerting.alert-groups.title-error-loading-notifications","Error loading notifications"),severity:"error",children:c.message||"Unknown error"}),$&&(0,e.jsx)(S.F,{title:(0,i.t)("alerting.alert-groups.title-grafana-alerts-delivered-alertmanager","Grafana alerts are not delivered to Grafana Alertmanager"),children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-groups.body-grafana-alerted-delivered",children:"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."})}),j&&A.map((u,M)=>(0,e.jsxs)(d.Fragment,{children:[(M===1&&Object.keys(A[0].labels).length===0||M===0&&Object.keys(u.labels).length>0)&&(0,e.jsx)(K.a,{paddingY:2,children:(0,e.jsx)(z.E,{element:"h2",variant:"body",children:(0,e.jsxs)(i.x6,{i18nKey:"alerting.alert-groups.grouped-by",values:{labels:Object.keys(u.labels).join(", ")},children:["Grouped by: ","{{labels}}"]})})}),(0,e.jsx)(W._,{alertManagerSourceName:r||"",group:u})]},`${JSON.stringify(u.labels)}-group-${M}`)),j&&!A.length&&(0,e.jsx)("p",{children:(0,e.jsx)(i.x6,{i18nKey:"alerting.alert-groups.no-results",children:"No results."})})]})};function ae(){return(0,e.jsx)(Q.y,{navId:"groups",accessType:"instance",children:(0,e.jsx)(ne,{})})}const re=(0,se.S)(ae)},12266:(te,N,t)=>{t.d(N,{e:()=>i});var e=t(74848),d=t(45861);const i=({isCollapsed:v,onToggle:S,idControlled:K,className:z,text:C,size:I="xl",...T})=>(0,e.jsx)(d.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!v,"aria-controls":K,className:z,icon:v?"angle-right":"angle-down",onClick:()=>S(!v),...T,children:C})},82658:(te,N,t)=>{t.d(N,{_:()=>_});var e=t(74848),d=t(22803),i=t(96540),v=t(92745),S=t(63142),K=t(41654),z=t(89640),C=t(77256),I=t(7840),T=t(12266),R=t(1625),Q=t(74529),W=t(57487),F=t(83903),E=t(45861),H=t(15130),G=t(84266),L=t(11257),B=t(16692),P=t(52161),J=t(83750),U=t(24898);const D=({alert:s,alertManagerSourceName:x})=>{const g=(0,S.of)(Y),b=(0,P.z2)(x),h=b?H.TP.hasPermission(L.w.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:g.actionsRow,children:[s.status.state===G.Or.Suppressed&&(0,e.jsx)(U._,{actions:[B.QI.CreateSilence,B.QI.UpdateSilence],children:(0,e.jsx)(E.z9,{href:`${(0,C.nL)("/alerting/silences",x)}&silenceIds=${s.status.silencedBy.join(",")}`,className:g.button,icon:"bell",size:"sm",children:(0,e.jsx)(v.x6,{i18nKey:"alerting.alert-details.manage-silences",children:"Manage silences"})})}),s.status.state===G.Or.Active&&(0,e.jsx)(U._,{actions:[B.QI.CreateSilence],children:(0,e.jsx)(E.z9,{href:(0,C.BK)(x,s.labels),className:g.button,icon:"bell-slash",size:"sm",children:(0,e.jsx)(v.x6,{i18nKey:"alerting.alert-details.silence",children:"Silence"})})}),h&&s.generatorURL&&(0,e.jsx)(E.z9,{className:g.button,href:s.generatorURL,icon:"chart-line",size:"sm",children:b?(0,v.t)("alerting.alert-details.button-see-rule","See alert rule"):(0,v.t)("alerting.alert-details.button-see-source","See source")})]}),Object.entries(s.annotations).map(([a,O])=>(0,e.jsx)(J.s,{annotationKey:a,value:O},a)),(0,e.jsx)("div",{className:g.receivers,children:(0,e.jsxs)(v.x6,{i18nKey:"alerting.alert-details.receivers-list",values:{receivers:s.receivers.map(({name:a})=>a).filter(a=>!!a).join(", ")},children:["Receivers: ","{{receivers}}"]})})]})},Y=s=>({button:(0,d.css)({"& + &":{marginLeft:s.spacing(1)}}),actionsRow:(0,d.css)({padding:`${s.spacing(2,0)} !important`,borderBottom:`1px solid ${s.colors.border.medium}`}),receivers:(0,d.css)({padding:s.spacing(1,0)})}),V=({alerts:s,alertManagerSourceName:x})=>{const g=(0,S.of)(X),b=(0,i.useMemo)(()=>[{id:"state",label:(0,v.t)("alerting.alert-group-alerts-table.columns.label.notification-state","Notification state"),renderCell:({data:a})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(F.y,{state:a.status.state}),(0,e.jsx)("span",{className:g.duration,children:(0,e.jsxs)(v.x6,{i18nKey:"alerting.alert-group-alerts-table.duration",values:{time:(0,Q.dU)({start:new Date(a.startsAt),end:new Date(a.endsAt)})},children:["for ","{{time}}"]})})]}),size:"220px"},{id:"labels",label:(0,v.t)("alerting.alert-group-alerts-table.columns.label.instance-labels","Instance labels"),renderCell:({data:{labels:a}})=>(0,e.jsx)(I.m,{labels:a,size:"sm"}),size:1}],[g]),h=(0,i.useMemo)(()=>s.map(a=>({id:a.fingerprint,data:a})),[s]);return(0,e.jsx)("div",{className:g.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(W.B,{cols:b,items:h,isExpandable:!0,renderExpandedContent:({data:a})=>(0,e.jsx)(D,{alert:a,alertManagerSourceName:x})})})},X=s=>({tableWrapper:(0,d.css)({marginTop:s.spacing(3),[s.breakpoints.up("md")]:{marginLeft:s.spacing(4.5)}}),duration:(0,d.css)({marginLeft:s.spacing(1),fontSize:s.typography.bodySmall.fontSize})});var Z=t(55127),w=t.n(Z);const k=s=>({[G.Or.Active]:(0,d.css)({color:s.colors.error.text}),[G.Or.Suppressed]:(0,d.css)({color:s.colors.primary.text}),[G.Or.Unprocessed]:(0,d.css)({color:s.colors.secondary.text})}),q=({group:s})=>{const x=(0,S.of)(k),g=s.alerts.length,b=s.alerts.reduce((h,a)=>(h[a.status.state]?h[a.status.state]+=1:h[a.status.state]=1,h),{});return(0,e.jsxs)("div",{children:[`${g} ${w()("alert",g)}: `,Object.entries(b).map(([h,a],O)=>(0,e.jsxs)("span",{className:x[h],children:[O>0&&", ",`${a} ${h}`]},`${JSON.stringify(s.labels)}-notifications-${O}`))]})},_=({alertManagerSourceName:s,group:x})=>{const[g,b]=(0,i.useState)(!0),h=(0,S.of)(ee),a=x.receiver.name!=="NONE",O=x.receiver.name;return(0,e.jsxs)("div",{className:h.wrapper,children:[(0,e.jsxs)("div",{className:h.header,children:[(0,e.jsxs)("div",{className:h.group,"data-testid":"alert-group",children:[(0,e.jsx)(T.e,{size:"sm",isCollapsed:g,onToggle:()=>b(!g),"data-testid":"alert-group-collapse-toggle"}),Object.keys(x.labels).length?(0,e.jsxs)(K.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(I.m,{labels:x.labels,size:"sm"}),a&&(0,e.jsx)(R.P,{icon:"at",children:(0,e.jsxs)(v.x6,{i18nKey:"alerting.alert-group.delivered-to",values:{name:x.receiver.name},children:["Delivered to"," ",(0,e.jsx)(z.Y,{href:(0,C.bI)(O,s),variant:"bodySmall",color:"primary",inline:!1,children:"{{name}}"})]})})]}):(0,e.jsx)("span",{children:(0,e.jsx)(v.x6,{i18nKey:"alerting.alert-group.no-grouping",children:"No grouping"})})]}),(0,e.jsx)(q,{group:x})]}),!g&&(0,e.jsx)(V,{alertManagerSourceName:s,alerts:x.alerts})]})},ee=s=>({wrapper:(0,d.css)({"& + &":{marginTop:s.spacing(2)}}),header:(0,d.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:s.spacing(1),backgroundColor:s.colors.background.secondary,width:"100%"}),group:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"center"})})}}]);

//# sourceMappingURL=AlertGroups.64e3538fecd73ae58665.js.map