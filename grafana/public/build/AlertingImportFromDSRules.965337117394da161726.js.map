{"version":3,"file":"AlertingImportFromDSRules.965337117394da161726.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/create-folder/CreateNewFolder.tsx","webpack://grafana/./public/app/features/alerting/unified/api/convertToGMAApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/import-to-gma/hooks.ts","webpack://grafana/./public/app/features/alerting/unified/components/import-to-gma/yamlToRulerConverter.ts","webpack://grafana/./public/app/features/alerting/unified/components/import-to-gma/ConfirmConvertModal.tsx","webpack://grafana/./public/app/features/alerting/unified/components/import-to-gma/NamespaceAndGroupFilter.tsx","webpack://grafana/./public/app/features/alerting/unified/components/import-to-gma/ImportToGMARules.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/CloudRulesSourcePicker.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/NeedHelpInfo.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/useAlertRuleSuggestions.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useRuleSourcesWithRuler.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Field, Input, Label, Modal, Stack, useStyles2 } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\nimport { contextSrv } from 'app/core/core';\nimport { useNewFolderMutation } from 'app/features/browse-dashboards/api/browseDashboardsAPI';\nimport { AccessControlAction } from 'app/types/accessControl';\n\nimport { Folder } from '../../types/rule-form';\n\n/**\n * Provides a button and associated modal for creating a new folder\n */\nexport const CreateNewFolder = ({ onCreate }: { onCreate: (folder: Folder) => void }) => {\n  const [isCreatingFolder, setIsCreatingFolder] = useState(false);\n  const handleCreate = (folder: Folder) => {\n    onCreate(folder);\n    setIsCreatingFolder(false);\n  };\n  return (\n    <>\n      <Button\n        onClick={() => setIsCreatingFolder(true)}\n        type=\"button\"\n        icon=\"plus\"\n        fill=\"outline\"\n        variant=\"secondary\"\n        disabled={!contextSrv.hasPermission(AccessControlAction.FoldersCreate)}\n      >\n        <Trans i18nKey=\"alerting.create-new-folder.new-folder\">New folder</Trans>\n      </Button>\n      {isCreatingFolder && <FolderCreationModal onCreate={handleCreate} onClose={() => setIsCreatingFolder(false)} />}\n    </>\n  );\n};\n\nfunction FolderCreationModal({\n  onClose,\n  onCreate,\n}: {\n  onClose: () => void;\n  onCreate: (folder: Folder) => void;\n}): React.ReactElement {\n  const styles = useStyles2(getStyles);\n  const notifyApp = useAppNotification();\n  const [title, setTitle] = useState('');\n  const [createFolder] = useNewFolderMutation();\n\n  const onSubmit = async () => {\n    const { data, error } = await createFolder({ title });\n\n    if (error) {\n      notifyApp.error('Failed to create folder');\n    } else if (data) {\n      onCreate({ title: data.title, uid: data.uid });\n      notifyApp.success('Folder created');\n    }\n  };\n\n  return (\n    <Modal\n      className={styles.modal}\n      isOpen\n      title={t('alerting.create-new-folder.title-new-folder', 'New folder')}\n      onDismiss={onClose}\n      onClickBackdrop={onClose}\n    >\n      <Stack direction=\"column\" gap={2}>\n        <Field\n          label={\n            <Label htmlFor=\"folder\">\n              <Trans i18nKey=\"alerting.create-new-folder.folder.name\">Folder name</Trans>\n            </Label>\n          }\n        >\n          <Input\n            data-testid={selectors.components.AlertRules.newFolderNameField}\n            autoFocus={true}\n            id=\"folderName\"\n            placeholder={t('alerting.create-new-folder.placeholder-enter-a-name', 'Enter a name')}\n            value={title}\n            onChange={(e) => setTitle(e.currentTarget.value)}\n          />\n        </Field>\n\n        <Modal.ButtonRow>\n          <Button variant=\"secondary\" type=\"button\" onClick={onClose}>\n            <Trans i18nKey=\"alerting.create-new-folder.folder.cancel\">Cancel</Trans>\n          </Button>\n          <Button\n            onClick={onSubmit}\n            disabled={!title}\n            data-testid={selectors.components.AlertRules.newFolderNameCreateButton}\n          >\n            <Trans i18nKey=\"alerting.create-new-folder.folder.create\">Create</Trans>\n          </Button>\n        </Modal.ButtonRow>\n      </Stack>\n    </Modal>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  modal: css({\n    width: `${theme.breakpoints.values.sm}px`,\n  }),\n});\n","import { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { alertingApi } from './alertingApi';\n\nexport const convertToGMAApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    convertToGMA: build.mutation<\n      void,\n      {\n        targetFolderUID?: string;\n        dataSourceUID: string;\n        pauseRecordingRules?: boolean;\n        pauseAlerts?: boolean;\n        payload: RulerRulesConfigDTO;\n        /** Target data source UID to store recording rules in */\n        targetDatasourceUID?: string;\n      }\n    >({\n      query: ({ payload, targetFolderUID, pauseRecordingRules, pauseAlerts, dataSourceUID, targetDatasourceUID }) => ({\n        url: `/api/convert/prometheus/config/v1/rules`,\n        method: 'POST',\n        body: payload,\n        headers: {\n          'X-Grafana-Alerting-Datasource-UID': dataSourceUID,\n          'X-Grafana-Alerting-Recording-Rules-Paused': pauseRecordingRules,\n          'X-Grafana-Alerting-Alert-Rules-Paused': pauseAlerts,\n          'X-Disable-Provenance': true,\n          ...(targetFolderUID ? { 'X-Grafana-Alerting-Folder-UID': targetFolderUID } : {}),\n          ...(targetDatasourceUID ? { 'X-Grafana-Alerting-Target-Datasource-UID': targetDatasourceUID } : {}),\n        },\n      }),\n    }),\n  }),\n});\n","import { isEmpty } from 'lodash';\nimport { useEffect, useState } from 'react';\nimport { lastValueFrom } from 'rxjs';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { FolderDTO } from 'app/types/folders';\nimport { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { alertRuleApi } from '../../api/alertRuleApi';\nimport { GRAFANA_RULER_CONFIG } from '../../api/featureDiscoveryApi';\nimport { Folder } from '../../types/rule-form';\nimport { useGetRulerRules } from '../rule-editor/useAlertRuleSuggestions';\n\nasync function getNestedFoldersIn(uid: string) {\n  const response = await lastValueFrom(\n    getBackendSrv().fetch<FolderDTO[]>({\n      url: `/api/folders`,\n      params: { parentUid: uid },\n      method: 'GET',\n      showErrorAlert: false,\n      showSuccessAlert: false,\n    })\n  );\n\n  return response?.data;\n}\n\nexport function useGetNestedFolders(folderUID: string, skip = false) {\n  const [nestedFolders, setNestedFolders] = useState<FolderDTO[]>([]);\n\n  useEffect(() => {\n    (async () => {\n      const nestedFoldersIn = skip ? [] : await getNestedFoldersIn(folderUID);\n      setNestedFolders(nestedFoldersIn);\n    })();\n  }, [folderUID, skip]);\n\n  return nestedFolders;\n}\n\nexport function useGetRulesThatMightBeOverwritten(\n  skip: boolean,\n  targetFolder: Folder | undefined,\n  rulesToBeImported: RulerRulesConfigDTO\n) {\n  // get nested folders in the target folder\n  const nestedFoldersInTargetFolder = useGetNestedFolders(targetFolder?.uid || '', skip);\n  const skipFiltering = skip || nestedFoldersInTargetFolder.length === 0;\n  const rulesThatMightBeOverwritten = useFilterRulesThatMightBeOverwritten(\n    nestedFoldersInTargetFolder,\n    rulesToBeImported,\n    skipFiltering\n  );\n\n  return { rulesThatMightBeOverwritten };\n}\n\nexport function useGetRulesToBeImported(skip: boolean, selectedDatasourceName: string | undefined) {\n  // we need to skip fetching and filtering if the modal is not open\n  const dataSourceToFetch = !skip ? selectedDatasourceName : undefined;\n  const { rulerRules: rulesToBeImported, isLoading: isloadingCloudRules } = useGetRulerRules(dataSourceToFetch);\n\n  return { rulesToBeImported, isloadingCloudRules };\n}\n\nfunction useFilterRulesThatMightBeOverwritten(\n  targetNestedFolders: FolderDTO[],\n  rulesToBeImported: RulerRulesConfigDTO,\n  skip = true\n): RulerRulesConfigDTO {\n  const [fetchRulesByFolderUID] = alertRuleApi.endpoints.rulerNamespace.useLazyQuery();\n  const [rulesThatMightBeOverwritten, setRulesThatMightBeOverwritten] = useState<RulerRulesConfigDTO>({});\n\n  useEffect(() => {\n    if (skip || isEmpty(targetNestedFolders) || isEmpty(rulesToBeImported)) {\n      setRulesThatMightBeOverwritten({});\n      return;\n    }\n    // filter targetNestedFolders to only include folders that are in the rulesToBeImported\n    const targetNestedFoldersFiltered = targetNestedFolders.filter((folder) => {\n      return Object.keys(rulesToBeImported).includes(folder.title);\n    });\n    const fetchRules = async () => {\n      const results: RulerRulesConfigDTO = {};\n\n      await Promise.all(\n        targetNestedFoldersFiltered.map(async (folder) => {\n          const { data: rules } = await fetchRulesByFolderUID({\n            namespace: folder.uid,\n            rulerConfig: GRAFANA_RULER_CONFIG,\n          });\n\n          if (rules) {\n            const folderWithParentTitle = Object.keys(rules)[0];\n            if (folderWithParentTitle) {\n              results[folderWithParentTitle] = rules[folderWithParentTitle] || [];\n            }\n          }\n        })\n      );\n\n      setRulesThatMightBeOverwritten(results);\n    };\n\n    fetchRules();\n  }, [targetNestedFolders, rulesToBeImported, skip, fetchRulesByFolderUID]);\n\n  return rulesThatMightBeOverwritten;\n}\n","import { load } from 'js-yaml';\n\nimport { RulerCloudRuleDTO, RulerRuleGroupDTO, RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\ninterface PrometheusYamlFile {\n  namespace?: string;\n  groups: Array<RulerRuleGroupDTO<RulerCloudRuleDTO>>;\n}\n\nfunction isValidObject(value: unknown): value is Record<string, unknown> {\n  return typeof value === 'object' && Boolean(value);\n}\n\nfunction isRule(yamlRule: unknown): yamlRule is RulerCloudRuleDTO {\n  if (!isValidObject(yamlRule)) {\n    return false;\n  }\n\n  const alert = 'alert' in yamlRule && typeof yamlRule.alert === 'string' ? yamlRule.alert : undefined;\n  const record = 'record' in yamlRule && typeof yamlRule.record === 'string' ? yamlRule.record : undefined;\n  const expr = 'expr' in yamlRule && typeof yamlRule.expr === 'string' ? yamlRule.expr : undefined;\n\n  if (!expr) {\n    return false;\n  }\n\n  if (!alert && !record) {\n    return false;\n  }\n\n  // If both are specified we don't know which one to use\n  if (alert && record) {\n    return false;\n  }\n\n  // Check optional properties if they exist\n  if ('for' in yamlRule && typeof yamlRule.for !== 'string') {\n    return false;\n  }\n\n  if ('labels' in yamlRule && !isValidObject(yamlRule.labels)) {\n    return false;\n  }\n\n  if ('annotations' in yamlRule && !isValidObject(yamlRule.annotations)) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction isGroup(obj: unknown): obj is RulerRuleGroupDTO<RulerCloudRuleDTO> {\n  if (!isValidObject(obj)) {\n    return false;\n  }\n\n  const name = 'name' in obj && typeof obj.name === 'string' ? obj.name : undefined;\n  const rules = 'rules' in obj && Array.isArray(obj.rules) ? obj.rules : undefined;\n\n  if (!name || !rules) {\n    return false;\n  }\n\n  return rules.every(isRule);\n}\n\ntype ValidationResult = { isValid: true; data: PrometheusYamlFile } | { isValid: false; error: string };\n\nfunction validatePrometheusYamlFile(obj: unknown): ValidationResult {\n  if (!isValidObject(obj)) {\n    return { isValid: false, error: 'Invalid YAML format: missing or invalid groups array' };\n  }\n\n  if (!('groups' in obj) || ('groups' in obj && !Array.isArray(obj.groups))) {\n    return { isValid: false, error: 'Invalid YAML format: missing or invalid groups array' };\n  }\n\n  // Check if groups is an array\n  if (!Array.isArray(obj.groups)) {\n    return { isValid: false, error: 'Invalid YAML format: missing or invalid groups array' };\n  }\n\n  // Check optional namespace property if it exists\n  if ('namespace' in obj && typeof obj.namespace !== 'string') {\n    return { isValid: false, error: 'Invalid YAML format: namespace must be a string' };\n  }\n\n  // If we get here, the object is valid - we can safely use it\n  // Since we validated the entire structure above, we know obj conforms to PrometheusYamlFile\n  const validatedGroups = obj.groups.map((group, index) => {\n    if (isGroup(group)) {\n      return group;\n    }\n    throw new Error(`Invalid YAML format: missing or invalid groups array at index ${index}`);\n  });\n\n  const prometheusFile: PrometheusYamlFile = {\n    groups: validatedGroups,\n  };\n\n  if ('namespace' in obj && typeof obj.namespace === 'string') {\n    prometheusFile.namespace = obj.namespace;\n  }\n\n  return {\n    isValid: true,\n    data: prometheusFile,\n  };\n}\n\n// only use this function directly for testing purposes, use parseYamlFileToRulerRulesConfigDTO instead\nexport function parseYamlToRulerRulesConfigDTO(yamlAsString: string, defaultNamespace: string): RulerRulesConfigDTO {\n  const obj = load(yamlAsString);\n  const validation = validatePrometheusYamlFile(obj);\n\n  if (!validation.isValid) {\n    throw new Error(validation.error);\n  }\n\n  // TypeScript now knows validation.data exists and is PrometheusYamlFile\n  const prometheusFile = validation.data;\n  const namespace = prometheusFile.namespace ?? defaultNamespace;\n\n  return {\n    [namespace]: prometheusFile.groups,\n  };\n}\n\nexport async function parseYamlFileToRulerRulesConfigDTO(\n  file: File,\n  defaultNamespace: string\n): Promise<RulerRulesConfigDTO> {\n  const yamlContent = await file.text();\n  return parseYamlToRulerRulesConfigDTO(yamlContent, defaultNamespace);\n}\n","import { css } from '@emotion/css';\nimport { isEmpty } from 'lodash';\nimport { ComponentProps, useMemo } from 'react';\nimport { useAsync, useToggle } from 'react-use';\n\nimport { Trans, t } from '@grafana/i18n';\nimport { locationService } from '@grafana/runtime';\nimport { Alert, CodeEditor, Collapse, ConfirmModal, Modal, Stack, Text, useStyles2 } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\nimport { stringifyErrorLike } from 'app/features/alerting/unified/utils/misc';\nimport { RulerRuleDTO, RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { trackImportToGMAError, trackImportToGMASuccess } from '../../Analytics';\nimport { convertToGMAApi } from '../../api/convertToGMAApi';\nimport { createListFilterLink } from '../../utils/navigation';\nimport { getRuleName, isPluginProvidedRule } from '../../utils/rules';\n\nimport { ImportFormValues } from './ImportToGMARules';\nimport { useGetRulesThatMightBeOverwritten, useGetRulesToBeImported } from './hooks';\nimport { parseYamlFileToRulerRulesConfigDTO } from './yamlToRulerConverter';\n\nexport const SYNTHETICS_RULE_NAMES = [\n  'SyntheticMonitoringCheckFailureAtHighSensitivity',\n  'SyntheticMonitoringCheckFailureAtMediumSensitivity',\n  'SyntheticMonitoringCheckFailureAtLowSensitivity',\n  'instance_job_severity:probe_success:mean5m',\n];\n\ntype ModalProps = Pick<ComponentProps<typeof ConfirmModal>, 'isOpen' | 'onDismiss'> & {\n  isOpen: boolean;\n  importPayload: ImportFormValues;\n};\n\nconst AlertSomeRulesSkipped = () => {\n  return (\n    <Alert\n      title={t(\n        'alerting.import-to-gma.confirm-modal.plugin-rules-warning.title',\n        'Some rules are excluded from import'\n      )}\n      severity=\"info\"\n    >\n      <Text variant=\"body\">\n        <Trans i18nKey=\"alerting.import-to-gma.confirm-modal.plugin-rules-warning.text\">\n          We have detected that some rules are managed by plugins. These rules will not be imported.\n        </Trans>\n      </Text>\n    </Alert>\n  );\n};\n\nconst WarningForImportingRulesManagedByIntegrations = () => {\n  return (\n    <Alert\n      title={t(\n        'alerting.import-to-gma.confirm-modal.not-using-rules-managed-by-integrations-or-plugins.title',\n        'Information'\n      )}\n      severity=\"info\"\n    >\n      <Text variant=\"body\">\n        <Trans i18nKey=\"alerting.import-to-gma.confirm-modal.not-using-rules-managed-by-integrations-or-plugins.text\">\n          Rules managed by integrations or plugins should not be imported to Grafana-managed rules.\n        </Trans>\n      </Text>\n    </Alert>\n  );\n};\n\nconst emptyObject = {};\n\nexport const ConfirmConversionModal = ({ importPayload, isOpen, onDismiss }: ModalProps) => {\n  const appNotification = useAppNotification();\n  const styles = useStyles2(getStyles);\n\n  const {\n    importSource,\n    selectedDatasourceName,\n    selectedDatasourceUID,\n    yamlFile,\n    targetFolder,\n    namespace,\n    ruleGroup,\n    targetDatasourceUID,\n    yamlImportTargetDatasourceUID,\n    pauseRecordingRules,\n    pauseAlertingRules,\n  } = importPayload;\n\n  // for datasource import, we need to fetch the rules from the datasource\n  const dataSourceToFetch = isOpen && importSource === 'datasource' ? (selectedDatasourceName ?? '') : undefined;\n  const { rulesToBeImported: rulesToBeImportedFromDatasource, isloadingCloudRules } = useGetRulesToBeImported(\n    !isOpen || importSource === 'yaml',\n    dataSourceToFetch\n  );\n\n  // for yaml import, we need to fetch the rules from the yaml file\n  const { value: rulesToBeImportedFromYaml = emptyObject } = useAsync(async () => {\n    if (!yamlFile || importSource !== 'yaml') {\n      return emptyObject;\n    }\n    try {\n      const rulerConfigFromYAML = await parseYamlFileToRulerRulesConfigDTO(yamlFile, yamlFile.name);\n      return rulerConfigFromYAML;\n    } catch (error) {\n      appNotification.error(\n        t('alerting.import-to-gma.yaml-error', 'Failed to parse YAML file: {{error}}', {\n          error: stringifyErrorLike(error),\n        })\n      );\n      return emptyObject;\n    }\n  }, [importSource, yamlFile]);\n\n  // filter the rules to be imported from the datasource\n  const { filteredConfig: rulerRulesToPayload, someRulesAreSkipped } = useMemo(() => {\n    if (importSource === 'datasource') {\n      return filterRulerRulesConfig(rulesToBeImportedFromDatasource, namespace, ruleGroup);\n    }\n    // for yaml, we don't filter the rules\n    return {\n      filteredConfig: rulesToBeImportedFromYaml,\n      someRulesAreSkipped: false,\n    };\n  }, [namespace, ruleGroup, importSource, rulesToBeImportedFromYaml, rulesToBeImportedFromDatasource]);\n\n  const { rulesThatMightBeOverwritten } = useGetRulesThatMightBeOverwritten(!isOpen, targetFolder, rulerRulesToPayload);\n\n  const [convert] = convertToGMAApi.useConvertToGMAMutation();\n  const notifyApp = useAppNotification();\n\n  if (isloadingCloudRules) {\n    return (\n      <Modal\n        isOpen={isOpen}\n        title={t('alerting.import-to-gma.confirm-modal.loading', 'Loading...')}\n        onDismiss={onDismiss}\n        onClickBackdrop={onDismiss}\n      >\n        <Text>\n          {t(\n            'alerting.import-to-gma.confirm-modal.loading-body',\n            'Preparing data to be imported. This can take a while...'\n          )}\n        </Text>\n      </Modal>\n    );\n  }\n\n  async function onConvertConfirm() {\n    if (!yamlImportTargetDatasourceUID && !selectedDatasourceUID) {\n      notifyApp.error(\n        t('alerting.import-to-gma.error', 'Failed to import alert rules: {{error}}', {\n          error: 'No data source selected',\n        })\n      );\n      return;\n    }\n    try {\n      await convert({\n        dataSourceUID: importSource === 'yaml' ? (yamlImportTargetDatasourceUID ?? '') : (selectedDatasourceUID ?? ''),\n        targetFolderUID: targetFolder?.uid,\n        pauseRecordingRules: pauseRecordingRules,\n        pauseAlerts: pauseAlertingRules,\n        payload: rulerRulesToPayload,\n        targetDatasourceUID,\n      }).unwrap();\n\n      const isRootFolder = isEmpty(targetFolder?.uid);\n\n      trackImportToGMASuccess({\n        importSource,\n        isRootFolder,\n        namespace,\n        ruleGroup,\n        pauseRecordingRules,\n        pauseAlertingRules,\n      });\n      const ruleListUrl = createListFilterLink(isRootFolder ? [] : [['namespace', targetFolder?.title ?? '']], {\n        skipSubPath: true,\n      });\n      notifyApp.success(\n        t('alerting.import-to-gma.success', 'Successfully imported alert rules to Grafana-managed rules.')\n      );\n      locationService.push(ruleListUrl);\n    } catch (error) {\n      trackImportToGMAError({ importSource });\n      notifyApp.error(\n        t('alerting.import-to-gma.error', 'Failed to import alert rules: {{error}}', {\n          error: stringifyErrorLike(error),\n        })\n      );\n    }\n  }\n\n  const noRulesToImport = isEmpty(rulerRulesToPayload);\n  if (noRulesToImport) {\n    return (\n      <Modal\n        isOpen={isOpen}\n        title={t('alerting.import-to-gma.confirm-modal.no-rules-title', 'No rules to import')}\n        onDismiss={onDismiss}\n        onClickBackdrop={onDismiss}\n      >\n        <Stack direction=\"column\" gap={2}>\n          {someRulesAreSkipped && <AlertSomeRulesSkipped />}\n          <Text>\n            {importSource === 'yaml'\n              ? t(\n                  'alerting.import-to-gma.confirm-modal.no-rules-body-yaml',\n                  'There are no rules to import. Please select a different yaml file.'\n                )\n              : t(\n                  'alerting.import-to-gma.confirm-modal.no-rules-body',\n                  'There are no rules to import. Please select a different namespace or rule group.'\n                )}\n          </Text>\n        </Stack>\n      </Modal>\n    );\n  }\n\n  // translations for texts in the modal\n  const title = t('alerting.import-to-gma.confirm-modal.title', 'Confirm import');\n  const confirmText = t('alerting.import-to-gma.confirm-modal.confirm', 'Import');\n  return (\n    <ConfirmModal\n      isOpen={isOpen}\n      title={title}\n      confirmText={confirmText}\n      confirmButtonVariant=\"primary\"\n      modalClass={styles.modal}\n      body={\n        <Stack direction=\"column\" gap={2}>\n          {!isEmpty(rulesThatMightBeOverwritten) && (\n            <TargetFolderNotEmptyWarning targetFolderRules={rulesThatMightBeOverwritten} />\n          )}\n          <WarningForImportingRulesManagedByIntegrations />\n          {someRulesAreSkipped && <AlertSomeRulesSkipped />}\n          <Text variant=\"h6\">\n            <Trans i18nKey=\"alerting.to-gma.confirm-modal.summary\">The following alert rules will be imported:</Trans>\n          </Text>\n          {rulerRulesToPayload && <RulesPreview rules={rulerRulesToPayload} />}\n        </Stack>\n      }\n      onConfirm={onConvertConfirm}\n      onDismiss={onDismiss}\n    />\n  );\n};\n\n/**\n * Filter the ruler rules config to be imported. It filters the rules by namespace and group name.\n * It also filters out the rules that are managed by integrations or plugins.\n * Precondition: these rules are cloud rules.\n * @param rulerRulesConfig - The ruler rules config to be imported\n * @param namespace - The namespace to filter the rules by\n * @param groupName - The group name to filter the rules by\n * @returns The filtered ruler rules config and if some rules are skipped\n */\nexport function filterRulerRulesConfig(\n  rulerRulesConfig: RulerRulesConfigDTO,\n  namespace?: string,\n  groupName?: string\n): { filteredConfig: RulerRulesConfigDTO; someRulesAreSkipped: boolean } {\n  const filteredConfig: RulerRulesConfigDTO = {};\n  let someRulesAreSkipped = false;\n\n  Object.entries(rulerRulesConfig).forEach(([ns, groups]) => {\n    if (namespace && ns !== namespace) {\n      return;\n    }\n\n    const filteredGroups = groups\n      .filter((group) => {\n        if (groupName && group.name !== groupName) {\n          return false;\n        }\n        return true;\n      })\n      .map((group) => {\n        const filteredRules = group.rules.filter((rule) => {\n          const shouldSkip = isRuleManagedByExternalSystem(rule);\n          if (shouldSkip) {\n            someRulesAreSkipped = true;\n            return false;\n          }\n          return true;\n        });\n\n        return {\n          ...group,\n          rules: filteredRules,\n        };\n      })\n      .filter((group) => group.rules.length > 0);\n\n    if (filteredGroups.length > 0) {\n      filteredConfig[ns] = filteredGroups;\n    }\n  });\n\n  return { filteredConfig, someRulesAreSkipped };\n}\n\n/*\nThis function is used to check if the rule is managed by external system.\nIt checks if the rule has the '__grafana_origin' label, and if the rule is from synthetics.\nThese are the conditions for a rule to be managed by external system:\n- If the rule has the '__grafana_origin' label\n- If the rule is from synthetics\n- If the rule is from integrations\n*/\nfunction isRuleManagedByExternalSystem(rule: RulerRuleDTO): boolean {\n  // check if the rule has the '__grafana_origin' label\n  const hasGrafanaOriginLabel = isPluginProvidedRule(rule);\n  if (hasGrafanaOriginLabel) {\n    return true;\n  }\n  // check if the rule is from intergrations by checking if the namespace starts with 'integrations-'\n  const isIntegration = rule.labels?.namespace?.startsWith('integrations-');\n  if (isIntegration) {\n    return true;\n  }\n  // check if the rule is from synthetics by checking if the namespace is 'synthetic_monitoring'\n  const hasSyntheticsLabels = rule.labels?.namespace === 'synthetic_monitoring';\n\n  if (!hasSyntheticsLabels) {\n    return false;\n  }\n\n  const ruleName = getRuleName(rule);\n\n  return SYNTHETICS_RULE_NAMES.some((name) => name === ruleName);\n}\n\nfunction RulesPreview({ rules }: { rules: RulerRulesConfigDTO }) {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.content}>\n      <CodeEditor\n        width=\"100%\"\n        height={500}\n        language={'json'}\n        value={JSON.stringify(rules, null, 4)}\n        monacoOptions={{\n          minimap: {\n            enabled: false,\n          },\n          scrollBeyondLastLine: false,\n          lineNumbers: 'on',\n          readOnly: true,\n        }}\n      />\n    </div>\n  );\n}\n\nconst getStyles = () => ({\n  content: css({\n    flex: '1 1 100%',\n  }),\n  modal: css({\n    width: '800px',\n  }),\n});\n\nfunction TargetFolderNotEmptyWarning({ targetFolderRules }: { targetFolderRules: RulerRulesConfigDTO }) {\n  const [showTargetRules, toggleShowTargetRules] = useToggle(false);\n  return (\n    <Stack direction=\"column\" gap={2}>\n      <Alert title={t('alerting.to-gma.confirm-modal.title-warning', 'Warning')} severity=\"warning\">\n        <Text variant=\"body\">\n          <Trans i18nKey=\"alerting.to-gma.confirm-modal.body\">\n            The target folder is not empty, some rules may be overwritten or removed. Are you sure you want to import\n            these alert rules to Grafana-managed rules?\n          </Trans>\n        </Text>\n      </Alert>\n      {targetFolderRules && (\n        <Collapse\n          label={t(\n            'alerting.import-to-gma.confirm-modal.target-folder-rules',\n            'Target folder rules that might be overwritten'\n          )}\n          isOpen={showTargetRules}\n          onToggle={toggleShowTargetRules}\n          collapsible={true}\n        >\n          <RulesPreview rules={targetFolderRules} />\n        </Collapse>\n      )}\n    </Stack>\n  );\n}\n","import { useEffect, useMemo } from 'react';\nimport { Controller, useFormContext } from 'react-hook-form';\n\nimport { t } from '@grafana/i18n';\nimport { Combobox, ComboboxOption, Field, Stack } from '@grafana/ui';\n\nimport { useGetNameSpacesByDatasourceName } from '../rule-editor/useAlertRuleSuggestions';\n\nimport { ImportFormValues } from './ImportToGMARules';\n\ninterface Props {\n  rulesSourceName?: string;\n}\n\nexport const NamespaceAndGroupFilter = ({ rulesSourceName }: Props) => {\n  const {\n    control,\n    watch,\n    formState: { errors },\n    setValue,\n  } = useFormContext<ImportFormValues>();\n\n  const namespace = watch('namespace');\n  const { namespaceGroups, isLoading } = useGetNameSpacesByDatasourceName(rulesSourceName);\n\n  const namespaceOptions: Array<ComboboxOption<string>> = useMemo(\n    () =>\n      Array.from(namespaceGroups.keys()).map((namespace) => ({\n        label: namespace,\n        value: namespace,\n      })),\n    [namespaceGroups]\n  );\n\n  const groupOptions: Array<ComboboxOption<string>> = useMemo(\n    () => (namespace && namespaceGroups.get(namespace)?.map((group) => ({ label: group, value: group }))) || [],\n    [namespace, namespaceGroups]\n  );\n\n  useEffect(() => {\n    // Reset namespace/group if datasource changes\n    setValue('namespace', '');\n    setValue('ruleGroup', '');\n  }, [rulesSourceName, setValue]);\n\n  return (\n    <Stack direction=\"row\" gap={2}>\n      <Field\n        htmlFor=\"namespace-picker\"\n        data-testid=\"namespace-picker\"\n        label={t('alerting.import-to-gma.namespace.label', 'Namespace')}\n        description={t('alerting.import-to-gma.namespace.description', 'Type to search for an existing namespace')}\n        error={errors.namespace?.message}\n        invalid={!!errors.namespace?.message}\n      >\n        <Controller\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Combobox\n              {...field}\n              onChange={(value) => {\n                setValue('ruleGroup', ''); //reset if namespace changes\n                onChange(value?.value);\n              }}\n              id=\"namespace-picker\"\n              placeholder={t('alerting.namespace-and-group-filter.select-namespace', 'Select namespace')}\n              options={namespaceOptions}\n              width={42}\n              loading={isLoading}\n              disabled={isLoading || !rulesSourceName}\n              isClearable\n            />\n          )}\n          name=\"namespace\"\n          control={control}\n        />\n      </Field>\n      <Field\n        htmlFor=\"group-picker\"\n        data-testid=\"group-picker\"\n        label={t('alerting.import-to-gma.group.label', 'Group')}\n        description={t('alerting.import-to-gma.group.description', 'Type to search for an existing group')}\n        error={errors.ruleGroup?.message}\n        invalid={!!errors.ruleGroup?.message}\n      >\n        <Controller\n          render={({ field: { ref, ...field } }) => (\n            <Combobox\n              {...field}\n              options={groupOptions}\n              width={42}\n              onChange={(value) => {\n                setValue('ruleGroup', value?.value ?? '');\n              }}\n              id=\"group-picker\"\n              placeholder={t('alerting.namespace-and-group-filter.select-group', 'Select group')}\n              loading={isLoading}\n              disabled={isLoading || !namespace || !rulesSourceName}\n              isClearable\n            />\n          )}\n          name=\"ruleGroup\"\n          control={control}\n        />\n      </Field>\n    </Stack>\n  );\n};\n","import { useState } from 'react';\nimport { Controller, FormProvider, SubmitHandler, useForm, useFormContext } from 'react-hook-form';\nimport { useToggle } from 'react-use';\n\nimport { DataSourceInstanceSettings } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport {\n  Box,\n  Button,\n  Collapse,\n  Divider,\n  Field,\n  FileUpload,\n  InlineField,\n  InlineFieldRow,\n  InlineSwitch,\n  LinkButton,\n  RadioButtonList,\n  Spinner,\n  Stack,\n  Text,\n} from '@grafana/ui';\nimport { NestedFolderPicker } from 'app/core/components/NestedFolderPicker/NestedFolderPicker';\nimport { DataSourcePicker } from 'app/features/datasources/components/picker/DataSourcePicker';\n\nimport { Folder } from '../../types/rule-form';\nimport {\n  DataSourceType,\n  isSupportedExternalPrometheusFlavoredRulesSourceType,\n  isValidRecordingRulesTarget,\n} from '../../utils/datasource';\nimport { stringifyErrorLike } from '../../utils/misc';\nimport { withPageErrorBoundary } from '../../withPageErrorBoundary';\nimport { AlertingPageWrapper } from '../AlertingPageWrapper';\nimport { CreateNewFolder } from '../create-folder/CreateNewFolder';\nimport { CloudRulesSourcePicker } from '../rule-editor/CloudRulesSourcePicker';\nimport { NeedHelpInfo } from '../rule-editor/NeedHelpInfo';\n\nimport { ConfirmConversionModal } from './ConfirmConvertModal';\nimport { NamespaceAndGroupFilter } from './NamespaceAndGroupFilter';\nimport { parseYamlFileToRulerRulesConfigDTO } from './yamlToRulerConverter';\n\nexport interface ImportFormValues {\n  importSource: 'datasource' | 'yaml';\n  yamlFile: File | null;\n  yamlImportTargetDatasourceUID?: string;\n  selectedDatasourceUID?: string;\n  selectedDatasourceName: string | null;\n  pauseAlertingRules: boolean;\n  pauseRecordingRules: boolean;\n  targetFolder?: Folder;\n  namespace?: string;\n  ruleGroup?: string;\n  targetDatasourceUID?: string;\n}\n\nexport const supportedImportTypes: string[] = [DataSourceType.Prometheus, DataSourceType.Loki];\n\nconst ImportToGMARules = () => {\n  const formAPI = useForm<ImportFormValues>({\n    defaultValues: {\n      importSource: 'datasource',\n      yamlFile: null,\n      yamlImportTargetDatasourceUID: undefined,\n      selectedDatasourceUID: undefined,\n      selectedDatasourceName: undefined,\n      pauseAlertingRules: true,\n      pauseRecordingRules: true,\n      targetFolder: undefined,\n      targetDatasourceUID: undefined,\n    },\n  });\n  const {\n    register,\n    handleSubmit,\n    watch,\n    control,\n    setValue,\n    formState: { errors, isSubmitting },\n  } = formAPI;\n\n  const [optionsShowing, toggleOptions] = useToggle(true);\n  const [selectedDatasourceName, importSource] = watch(['selectedDatasourceName', 'importSource']);\n\n  const [formImportPayload, setFormImportPayload] = useState<ImportFormValues | null>(null);\n  const isImportYamlEnabled = config.featureToggles.alertingImportYAMLUI;\n\n  const onSubmit: SubmitHandler<ImportFormValues> = async (formData) => {\n    setFormImportPayload(formData);\n  };\n\n  const importSourceOptions: Array<{ label: string; description: string; value: 'datasource' | 'yaml' }> = [\n    {\n      label: t('alerting.import-to-gma.source.datasource', 'Existing data source-managed rules'),\n      description: t('alerting.import-to-gma.source.datasource-description', 'Import rules from existing data sources'),\n      value: 'datasource',\n    },\n  ];\n\n  if (isImportYamlEnabled) {\n    importSourceOptions.push({\n      label: t('alerting.import-to-gma.source.yaml', 'Prometheus YAML file'),\n      description: t('alerting.import-to-gma.source.yaml-description', 'Import rules from a Prometheus YAML file.'),\n      value: 'yaml',\n    });\n  }\n\n  return (\n    <AlertingPageWrapper\n      navId=\"alert-list\"\n      pageNav={{\n        text: t('alerting.import-to-gma.pageTitle', 'Import alert rules'),\n      }}\n    >\n      <Stack gap={2} direction={'column'}>\n        <FormProvider {...formAPI}>\n          <form onSubmit={handleSubmit(onSubmit)}>\n            <Stack direction=\"column\" gap={1}>\n              <Field\n                label={t('alerting.import-to-gma.import-source', 'Import source')}\n                invalid={!!errors.importSource}\n                error={errors.importSource?.message}\n                htmlFor=\"import-source\"\n                noMargin\n              >\n                <Controller\n                  render={({ field: { onChange, ref, ...field } }) => (\n                    <RadioButtonList\n                      {...field}\n                      onChange={(value) => setValue('importSource', value)}\n                      options={importSourceOptions}\n                    />\n                  )}\n                  control={control}\n                  name=\"importSource\"\n                />\n              </Field>\n\n              {importSource === 'datasource' && <DataSourceField />}\n\n              {isImportYamlEnabled && importSource === 'yaml' && (\n                <>\n                  <YamlFileUpload />\n                  <YamlTargetDataSourceField />\n                </>\n              )}\n              {/* Optional settings */}\n              <Collapse\n                label={t('alerting.import-to-gma.additional-settings', 'Additional settings')}\n                isOpen={optionsShowing}\n                onToggle={toggleOptions}\n                collapsible={true}\n              >\n                <Box marginLeft={1}>\n                  <Box marginBottom={2}>\n                    <Text variant=\"h5\">\n                      {t('alerting.import-to-gma.import-location-and-filters', 'Import location and filters')}\n                    </Text>\n                  </Box>\n\n                  <Stack direction=\"column\" gap={2}>\n                    <TargetFolderField />\n                    {importSource === 'datasource' && (\n                      <NamespaceAndGroupFilter rulesSourceName={selectedDatasourceName || undefined} />\n                    )}\n                  </Stack>\n                </Box>\n\n                <Divider />\n\n                <Box>\n                  <Box marginLeft={1} marginBottom={1}>\n                    <Text variant=\"h5\">{t('alerting.import-to-gma.alert-rules', 'Alert rules')}</Text>\n                  </Box>\n\n                  <InlineField\n                    transparent={true}\n                    label={t('alerting.import-to-gma.pause.label', 'Pause imported alerting rules')}\n                    labelWidth={30}\n                    htmlFor=\"pause-alerting-rules\"\n                  >\n                    <InlineSwitch\n                      transparent\n                      id=\"pause-alerting-rules\"\n                      {...register('pauseAlertingRules')}\n                      showLabel={false}\n                    />\n                  </InlineField>\n                </Box>\n\n                <Divider />\n\n                <Box>\n                  <Box marginBottom={1} marginLeft={1}>\n                    <Text variant=\"h5\">{t('alerting.import-to-gma.recording-rules', 'Recording rules')}</Text>\n                  </Box>\n\n                  <InlineFieldRow>\n                    <InlineField\n                      transparent={true}\n                      label={t('alerting.import-to-gma.pause-recording.label', 'Pause imported recording rules')}\n                      labelWidth={30}\n                      htmlFor=\"pause-recording-rules\"\n                    >\n                      <InlineSwitch transparent id=\"pause-recording-rules\" {...register('pauseRecordingRules')} />\n                    </InlineField>\n                  </InlineFieldRow>\n\n                  <Box marginLeft={1} width={50}>\n                    <TargetDataSourceForRecordingRulesField />\n                  </Box>\n                </Box>\n              </Collapse>\n            </Stack>\n\n            <Box marginTop={2}>\n              <Stack gap={1}>\n                <Button type=\"submit\" variant=\"primary\" disabled={isSubmitting}>\n                  <Stack direction=\"row\" gap={2} alignItems=\"center\">\n                    {isSubmitting && <Spinner inline={true} />}\n                    <Trans i18nKey=\"alerting.import-to-gma.action-button\">Import</Trans>\n                  </Stack>\n                </Button>\n\n                <LinkButton variant=\"secondary\" href=\"/alerting/list\">\n                  <Trans i18nKey=\"common.cancel\">Cancel</Trans>\n                </LinkButton>\n              </Stack>\n            </Box>\n            {formImportPayload && (\n              <ConfirmConversionModal\n                isOpen={!!formImportPayload}\n                onDismiss={() => setFormImportPayload(null)}\n                importPayload={formImportPayload}\n              />\n            )}\n          </form>\n        </FormProvider>\n      </Stack>\n    </AlertingPageWrapper>\n  );\n};\n\nfunction YamlFileUpload() {\n  const {\n    formState: { errors },\n  } = useFormContext<ImportFormValues>();\n\n  return (\n    <Field\n      label={t('alerting.import-to-gma.yaml.label', 'Prometheus YAML file')}\n      invalid={!!errors.yamlFile}\n      error={errors.yamlFile?.message}\n      description={t('alerting.import-to-gma.yaml.description', 'Select a Prometheus-compatible YAML file to import')}\n      noMargin\n    >\n      <Controller<ImportFormValues, 'yamlFile'>\n        name=\"yamlFile\"\n        render={({ field: { onChange, ref, ...field } }) => (\n          <FileUpload\n            {...field}\n            onFileUpload={(event) => {\n              const yamlFile = event.currentTarget.files?.item(0);\n              onChange(yamlFile);\n              // Crucial for allowing re-selection of the same file after external edits\n              event.currentTarget.value = '';\n            }}\n            size=\"sm\"\n            showFileName\n            accept=\".yaml,.yml,.json\"\n          />\n        )}\n        rules={{\n          required: {\n            value: true,\n            message: t('alerting.import-to-gma.yaml.required-message', 'Please select a file'),\n          },\n          validate: async (value) => {\n            if (!value) {\n              return t('alerting.import-to-gma.yaml.required-message', 'Please select a file');\n            }\n            try {\n              await parseYamlFileToRulerRulesConfigDTO(value, value.name);\n              return true;\n            } catch (error) {\n              return t('alerting.import-to-gma.yaml-error', 'Failed to parse YAML file: {{error}}', {\n                error: stringifyErrorLike(error),\n              });\n            }\n          },\n        }}\n      />\n    </Field>\n  );\n}\n\nfunction YamlTargetDataSourceField() {\n  const {\n    formState: { errors },\n    setValue,\n    getValues,\n  } = useFormContext<ImportFormValues>();\n\n  return (\n    <Field\n      label={t('alerting.import-to-gma.yaml.target-datasource', 'Target data source')}\n      description={t(\n        'alerting.import-to-gma.yaml.target-datasource-description',\n        'Select the data source that will be queried by the imported rules. Make sure metrics used in the imported rules are available in this data source.'\n      )}\n      invalid={!!errors.yamlImportTargetDatasourceUID}\n      error={errors.yamlImportTargetDatasourceUID?.message}\n      htmlFor=\"yaml-target-data-source\"\n      noMargin\n    >\n      <Controller<ImportFormValues, 'yamlImportTargetDatasourceUID'>\n        name=\"yamlImportTargetDatasourceUID\"\n        render={({ field: { onChange, ref, value, ...field } }) => (\n          <DataSourcePicker\n            {...field}\n            current={value}\n            noDefault\n            inputId=\"yaml-target-data-source\"\n            alerting\n            filter={(ds: DataSourceInstanceSettings) => isSupportedExternalPrometheusFlavoredRulesSourceType(ds.type)}\n            onChange={(ds: DataSourceInstanceSettings) => {\n              setValue('yamlImportTargetDatasourceUID', ds.uid);\n              const recordingRulesTargetDs = getValues('targetDatasourceUID');\n              if (!recordingRulesTargetDs && isValidRecordingRulesTarget(ds)) {\n                setValue('targetDatasourceUID', ds.uid);\n              }\n            }}\n          />\n        )}\n        rules={{\n          required: {\n            value: true,\n            message: t('alerting.import-to-gma.yaml.target-datasource-required', 'Please select a target data source'),\n          },\n        }}\n      />\n    </Field>\n  );\n}\n\nfunction TargetDataSourceForRecordingRulesField() {\n  const {\n    control,\n    formState: { errors },\n    setValue,\n  } = useFormContext<ImportFormValues>();\n\n  return (\n    <Field\n      required\n      label={t('alerting.recording-rules.label-target-data-source', 'Target data source')}\n      description={t(\n        'alerting.recording-rules.description-target-data-source',\n        'The Prometheus data source to store recording rules in'\n      )}\n      htmlFor=\"recording-rules-target-data-source\"\n      error={errors.targetDatasourceUID?.message}\n      invalid={!!errors.targetDatasourceUID?.message}\n      noMargin\n    >\n      <Controller<ImportFormValues, 'targetDatasourceUID'>\n        render={({ field: { onChange, ref, ...field } }) => (\n          <DataSourcePicker\n            {...field}\n            current={field.value}\n            inputId=\"recording-rules-target-data-source\"\n            noDefault\n            filter={isValidRecordingRulesTarget}\n            onChange={(ds: DataSourceInstanceSettings) => {\n              setValue('targetDatasourceUID', ds.uid);\n            }}\n          />\n        )}\n        name=\"targetDatasourceUID\"\n        control={control}\n        rules={{\n          required: {\n            value: true,\n            message: t('alerting.recording-rules.target-data-source-required', 'Please select a target data source'),\n          },\n        }}\n      />\n    </Field>\n  );\n}\n\nfunction TargetFolderField() {\n  const {\n    control,\n    formState: { errors },\n    setValue,\n  } = useFormContext<ImportFormValues>();\n\n  return (\n    <Field\n      label={t('alerting.import-to-gma.target-folder.label', 'Target folder')}\n      description={t('alerting.import-to-gma.target-folder.description', 'The folder to import the rules to')}\n      error={errors.targetFolder?.message}\n      htmlFor=\"folder-picker\"\n      noMargin\n    >\n      <Stack gap={2}>\n        <Controller<ImportFormValues, 'targetFolder'>\n          name=\"targetFolder\"\n          render={({ field: { onChange, ref, ...field } }) => (\n            <Stack width={42}>\n              <NestedFolderPicker\n                permission=\"view\"\n                showRootFolder={false}\n                invalid={!!errors.targetFolder?.message}\n                {...field}\n                value={field.value?.uid}\n                onChange={(uid, title) => {\n                  if (uid && title) {\n                    setValue('targetFolder', { title, uid });\n                  } else {\n                    setValue('targetFolder', undefined);\n                  }\n                }}\n              />\n            </Stack>\n          )}\n          control={control}\n        />\n        <CreateNewFolder\n          onCreate={(folder) => {\n            setValue('targetFolder', folder);\n          }}\n        />\n      </Stack>\n    </Field>\n  );\n}\n\nfunction DataSourceField() {\n  const {\n    control,\n    formState: { errors },\n    setValue,\n    getValues,\n  } = useFormContext<ImportFormValues>();\n\n  return (\n    <Field\n      label={\n        <Stack direction=\"row\" gap={1}>\n          <Text variant=\"bodySmall\" color=\"secondary\">\n            {t('alerting.import-to-gma.datasource.label', 'Data source')}\n          </Text>\n          <NeedHelpInfo\n            externalLink={'https://grafana.com/docs/grafana/latest/alerting/alerting-rules/alerting-migration/'}\n            linkText={`Read importing to Grafana alerting`}\n            contentText={t(\n              'alerting.import-to-gma.datasource.help-info.content',\n              'The dropdown only displays Mimir or Loki data sources that have the ruler API available.'\n            )}\n            title={t('alerting.import-to-gma.datasource.help-info.title', 'Data source')}\n          />\n        </Stack>\n      }\n      invalid={!!errors.selectedDatasourceName}\n      error={errors.selectedDatasourceName?.message}\n      htmlFor=\"datasource-picker\"\n      noMargin\n    >\n      <Controller<ImportFormValues, 'selectedDatasourceName'>\n        name=\"selectedDatasourceName\"\n        render={({ field: { onChange, ref, ...field } }) => (\n          <CloudRulesSourcePicker\n            {...field}\n            width={50}\n            inputId=\"datasource-picker\"\n            onChange={(ds: DataSourceInstanceSettings) => {\n              setValue('selectedDatasourceUID', ds.uid);\n              setValue('selectedDatasourceName', ds.name);\n\n              // If we've chosen a Prometheus data source, we can set the recording rules target data source to the same as the source\n              const recordingRulesTargetDs = getValues('targetDatasourceUID');\n              if (!recordingRulesTargetDs) {\n                const targetDataSourceUID = isValidRecordingRulesTarget(ds) ? ds.uid : undefined;\n                setValue('targetDatasourceUID', targetDataSourceUID);\n              }\n            }}\n          />\n        )}\n        control={control}\n        rules={{\n          required: {\n            value: true,\n            message: t('alerting.import-to-gma.datasource.required-message', 'Please select a data source'),\n          },\n        }}\n      />\n    </Field>\n  );\n}\n\nexport default withPageErrorBoundary(ImportToGMARules);\n","import { useCallback } from 'react';\n\nimport { DataSourceInstanceSettings } from '@grafana/data';\nimport { DataSourcePicker, DataSourcePickerProps } from 'app/features/datasources/components/picker/DataSourcePicker';\n\nimport { useRulesSourcesWithRuler } from '../../hooks/useRuleSourcesWithRuler';\n\ninterface Props extends DataSourcePickerProps {\n  disabled?: boolean;\n  onChange: (ds: DataSourceInstanceSettings) => void;\n  value: string | null;\n  onBlur?: () => void;\n  name?: string;\n}\n\nexport function CloudRulesSourcePicker({ value, disabled, ...props }: Props): JSX.Element {\n  const { rulesSourcesWithRuler: dataSourcesWithRuler, isLoading } = useRulesSourcesWithRuler();\n\n  const dataSourceFilter = useCallback(\n    (ds: DataSourceInstanceSettings): boolean => {\n      return dataSourcesWithRuler.some(({ uid }) => uid === ds.uid);\n    },\n    [dataSourcesWithRuler]\n  );\n\n  return (\n    <DataSourcePicker\n      disabled={isLoading || disabled}\n      noDefault\n      alerting\n      filter={dataSourceFilter}\n      current={value}\n      {...props}\n    />\n  );\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Icon, Stack, Text, Toggletip, useStyles2 } from '@grafana/ui';\n\ninterface NeedHelpInfoProps {\n  contentText: string | JSX.Element;\n  externalLink?: string;\n  linkText?: string;\n  title?: string;\n}\nexport function NeedHelpInfo({ contentText, externalLink, linkText, title = 'Need help?' }: NeedHelpInfoProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Toggletip\n      content={<div className={styles.mutedText}>{contentText}</div>}\n      title={\n        <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n          <Icon name=\"question-circle\" />\n          {title}\n        </Stack>\n      }\n      footer={\n        externalLink ? (\n          <a href={externalLink} target=\"_blank\" rel=\"noreferrer\">\n            <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n              <Text color=\"link\">\n                {linkText} <Icon size=\"sm\" name=\"external-link-alt\" />\n              </Text>\n            </Stack>\n          </a>\n        ) : undefined\n      }\n      closeButton={true}\n      placement=\"bottom-start\"\n    >\n      <div className={styles.helpInfo}>\n        <Stack direction=\"row\" alignItems=\"center\" gap={0.5}>\n          <Icon name=\"question-circle\" size=\"sm\" />\n          <Text variant=\"bodySmall\" color=\"primary\">\n            <Trans i18nKey=\"alerting.need-help-info.need-help\">Need help?</Trans>\n          </Text>\n        </Stack>\n      </div>\n    </Toggletip>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mutedText: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n  }),\n  helpInfo: css({\n    cursor: 'pointer',\n    textDecoration: 'underline',\n  }),\n});\n","import { skipToken } from '@reduxjs/toolkit/query';\nimport { useEffect, useMemo } from 'react';\n\nimport { RuleNamespace } from 'app/types/unified-alerting';\nimport { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { alertRuleApi } from '../../api/alertRuleApi';\nimport { featureDiscoveryApi } from '../../api/featureDiscoveryApi';\nimport { shouldUsePrometheusRulesPrimary } from '../../featureToggles';\n\nconst { usePrometheusRuleNamespacesQuery, useLazyRulerRulesQuery, useRulerRulesQuery } = alertRuleApi;\nconst { useDiscoverDsFeaturesQuery } = featureDiscoveryApi;\n\nconst emptyRulerConfig: RulerRulesConfigDTO = {};\n\nconst prometheusRulesPrimary = shouldUsePrometheusRulesPrimary();\nexport function useGetLabelsFromDataSourceName(rulesSourceName: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery({ rulesSourceName });\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    { ruleSourceName: rulesSourceName },\n    { skip: !prometheusRulesPrimary }\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig });\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const labels = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, Set<string>>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToLabels(promNamespaces);\n    }\n\n    return rulerRulesToLabels(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return { labels, isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading };\n}\n\nexport function useGetNameSpacesByDatasourceName(rulesSourceName?: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken,\n    { skip: !rulesSourceName }\n  );\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    rulesSourceName && prometheusRulesPrimary ? { ruleSourceName: rulesSourceName } : skipToken\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig });\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const namespaceGroups = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, string[]>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToNamespaceGroups(promNamespaces);\n    }\n\n    return rulerRulesToNamespaceGroups(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return {\n    namespaceGroups,\n    isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading,\n    promNamespaces,\n  };\n}\n\nexport function useGetRulerRules(\n  /** Rules source name to fetch namespaces from */\n  rulesSourceName?: string\n) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken\n  );\n\n  const { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading } = useRulerRulesQuery(\n    features?.rulerConfig ? { rulerConfig: features.rulerConfig } : skipToken\n  );\n\n  return {\n    isLoading: isRulerRulesLoading || isFeaturesLoading,\n    rulerRules,\n  };\n}\n\nfunction promNamespacesToNamespaceGroups(promNamespaces: RuleNamespace[]) {\n  const groups = new Map<string, string[]>();\n  promNamespaces.forEach((namespace) => {\n    groups.set(\n      namespace.name,\n      namespace.groups.map((group) => group.name)\n    );\n  });\n  return groups;\n}\n\nexport function rulerRulesToNamespaceGroups(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, string[]>();\n  Object.entries(rulerConfig).forEach(([namespace, groups]) => {\n    result.set(\n      namespace,\n      groups.map((group) => group.name)\n    );\n  });\n  return result;\n}\n\nfunction promNamespacesToLabels(promNamespace: RuleNamespace[]) {\n  const rules = promNamespace.flatMap((namespace) => namespace.groups).flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, new Map<string, Set<string>>());\n}\n\nfunction rulerRulesToLabels(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, Set<string>>();\n\n  const rules = Object.entries(rulerConfig)\n    .flatMap(([_, groups]) => groups)\n    .flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, result);\n}\n","import { useEffect, useState } from 'react';\n\nimport { DataSourceInstanceSettings } from '@grafana/data';\n\nimport { featureDiscoveryApi } from '../api/featureDiscoveryApi';\nimport { getRulesDataSources } from '../utils/datasource';\n\nconst { useLazyDiscoverDsFeaturesQuery } = featureDiscoveryApi;\n\nexport function useRulesSourcesWithRuler(): {\n  rulesSourcesWithRuler: DataSourceInstanceSettings[];\n  isLoading: boolean;\n} {\n  const [rulesSourcesWithRuler, setRulesSourcesWithRuler] = useState<DataSourceInstanceSettings[]>([]);\n  const [discoverDsFeatures, { isLoading }] = useLazyDiscoverDsFeaturesQuery();\n\n  useEffect(() => {\n    const dataSources = getRulesDataSources();\n    dataSources.forEach(async (ds) => {\n      const { data: dsFeatures } = await discoverDsFeatures({ uid: ds.uid }, true);\n      if (dsFeatures?.rulerConfig) {\n        setRulesSourcesWithRuler((prev) => [...prev, ds]);\n      }\n    });\n  }, [discoverDsFeatures]);\n\n  return { rulesSourcesWithRuler, isLoading };\n}\n"],"names":["CreateNewFolder","onCreate","isCreatingFolder","setIsCreatingFolder","handleCreate","folder","FolderCreationModal","onClose","styles","getStyles","notifyApp","title","setTitle","createFolder","onSubmit","data","error","e","theme","convertToGMAApi","alertingApi","build","payload","targetFolderUID","pauseRecordingRules","pauseAlerts","dataSourceUID","targetDatasourceUID","getNestedFoldersIn","uid","lastValueFrom","useGetNestedFolders","folderUID","skip","nestedFolders","setNestedFolders","nestedFoldersIn","useGetRulesThatMightBeOverwritten","targetFolder","rulesToBeImported","nestedFoldersInTargetFolder","skipFiltering","useFilterRulesThatMightBeOverwritten","useGetRulesToBeImported","selectedDatasourceName","dataSourceToFetch","isloadingCloudRules","targetNestedFolders","fetchRulesByFolderUID","alertRuleApi","rulesThatMightBeOverwritten","setRulesThatMightBeOverwritten","targetNestedFoldersFiltered","results","rules","folderWithParentTitle","isValidObject","value","isRule","yamlRule","alert","record","isGroup","obj","name","validatePrometheusYamlFile","prometheusFile","group","index","parseYamlToRulerRulesConfigDTO","yamlAsString","defaultNamespace","validation","parseYamlFileToRulerRulesConfigDTO","file","yamlContent","SYNTHETICS_RULE_NAMES","AlertSomeRulesSkipped","Alert","Text","WarningForImportingRulesManagedByIntegrations","emptyObject","ConfirmConversionModal","importPayload","isOpen","onDismiss","appNotification","importSource","selectedDatasourceUID","yamlFile","namespace","ruleGroup","yamlImportTargetDatasourceUID","pauseAlertingRules","rulesToBeImportedFromDatasource","rulesToBeImportedFromYaml","useAsync","rulerRulesToPayload","someRulesAreSkipped","filterRulerRulesConfig","convert","Modal","onConvertConfirm","isRootFolder","ruleListUrl","Stack","confirmText","ConfirmModal","TargetFolderNotEmptyWarning","RulesPreview","rulerRulesConfig","groupName","filteredConfig","ns","groups","filteredGroups","filteredRules","rule","isRuleManagedByExternalSystem","ruleName","CodeEditor","targetFolderRules","showTargetRules","toggleShowTargetRules","useToggle","Collapse","NamespaceAndGroupFilter","rulesSourceName","control","watch","errors","setValue","namespaceGroups","isLoading","namespaceOptions","groupOptions","Field","onChange","ref","field","Combobox","supportedImportTypes","ImportToGMARules","formAPI","register","handleSubmit","isSubmitting","optionsShowing","toggleOptions","formImportPayload","setFormImportPayload","isImportYamlEnabled","config","formData","importSourceOptions","AlertingPageWrapper","RadioButtonList","DataSourceField","YamlFileUpload","YamlTargetDataSourceField","Box","TargetFolderField","Divider","InlineField","InlineFieldRow","TargetDataSourceForRecordingRulesField","Button","Spinner","FileUpload","event","getValues","DataSourcePicker","ds","NestedFolderPicker","NeedHelpInfo","CloudRulesSourcePicker","targetDataSourceUID","withPageErrorBoundary","disabled","props","dataSourcesWithRuler","dataSourceFilter","contentText","externalLink","linkText","usePrometheusRuleNamespacesQuery","useLazyRulerRulesQuery","useRulerRulesQuery","useDiscoverDsFeaturesQuery","emptyRulerConfig","prometheusRulesPrimary","useGetLabelsFromDataSourceName","features","isFeaturesLoading","fetchRulerRules","rulerRules","isRulerRulesLoading","promNamespaces","isPrometheusRulesLoading","promNamespacesToLabels","rulerRulesToLabels","useGetNameSpacesByDatasourceName","promNamespacesToNamespaceGroups","rulerRulesToNamespaceGroups","useGetRulerRules","rulerConfig","result","promNamespace","labelKey","labelValue","labelEntry","_","useLazyDiscoverDsFeaturesQuery","useRulesSourcesWithRuler","rulesSourcesWithRuler","setRulesSourcesWithRuler","discoverDsFeatures","dsFeatures","prev"],"sourceRoot":""}