"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2715],{9133:(k,x,n)=>{n.r(x),n.d(x,{BannerSettingsPage:()=>y,default:()=>$});var e=n(74848),b=n(96540),u=n(27489),j=n(13791),i=n(49785),l=n(25229),E=n(32899),a=n(92745),I=n(75234),v=n(41654),C=n(16780),o=n(37386),P=n(21285),Q=n(50992),T=n(27282),F=n(18857),V=n(45861),L=n(83813),Y=n(22803),J=n(63142),M=n(66404),N=n(55320);function O({message:s,variant:d}){const h=(0,J.of)(R);return(0,e.jsxs)(v.B,{direction:"column",width:"100%",gap:2,children:[(0,e.jsx)(M.E,{variant:"h3",children:(0,e.jsx)(a.x6,{i18nKey:"banner.preview.title",children:"Preview"})}),(0,e.jsx)("div",{className:h.container,children:(0,e.jsx)(N.l,{message:s||(0,a.t)("banner.preview.message.default","Update this preview by modifying the message field."),variant:d})})]})}const R=s=>({container:(0,Y.css)({backgroundColor:s.colors.background.canvas})});var S=n(72728);function W(s){return s?{...s,startTime:s.startTime?(0,l.KQ)(s.startTime):(0,l.KQ)(),endTime:s.endTime?(0,l.KQ)(s.endTime):void 0}:{enabled:!1,message:"",variant:"info",visibility:"authenticated",startTime:(0,l.KQ)()}}function U({banner:s,name:d}){const[h,c]=(0,S.Q)(d),{register:w,control:f,handleSubmit:z,watch:A,reset:g,formState:{errors:p,isDirty:D},getValues:K}=(0,i.mN)({defaultValues:W(s)}),[B,G,H]=A(["startTime","message","variant"]);(0,b.useEffect)(()=>{const t=(0,I.J7)();if(c.isSuccess){const r=K();t.publish({type:E.r1.alertSuccess.name,payload:[(0,a.t)("banner.api.result.saved","Banner settings saved")]}),g({...r,startTime:r.startTime||void 0,endTime:r.endTime||void 0})}},[c.isSuccess,g,K]);const X=async t=>{(0,u.rR)("grafana_banner_saved",{enabled:t.enabled,endSelected:!!t.endTime,daysShown:t.endTime?t.startTime&&(0,l.KQ)(t.endTime).diff(t.startTime,"days"):void 0,visibility:t.visibility,variant:t.variant});const r={...t,startTime:t.startTime?t.startTime.toISOString():void 0,endTime:t.endTime?t.endTime.toISOString():void 0};h(r)};return(0,e.jsxs)(v.B,{direction:"column",gap:2,children:[(0,e.jsx)(O,{message:G,variant:H}),(0,e.jsx)("form",{onSubmit:z(X),style:{maxWidth:650},children:(0,e.jsxs)(C.n,{label:(0,a.t)("banner.form.title","Configure banner"),children:[(0,e.jsx)(L.F,{onDiscard:g,confirmRedirect:D}),(0,e.jsx)(o.D,{label:(0,a.t)("banner.form.enabled.label","Enabled"),children:(0,e.jsx)(P.d,{...w("enabled"),label:(0,a.t)("banner.form.enabled.label","Enabled")})}),(0,e.jsx)(o.D,{label:(0,a.t)("banner.form.message.label","Message"),description:(0,e.jsx)(a.x6,{i18nKey:"banner.form.message.description",children:"Text content of the banner. Supports markdown."}),children:(0,e.jsx)(i.xI,{name:"message",control:f,render:({field:{ref:t,...r}})=>(0,e.jsx)(Q.B,{...r,height:200,language:"markdown"})})}),(0,e.jsx)(o.D,{label:(0,a.t)("banner.form.start.label","Starts at"),description:(0,e.jsx)(a.x6,{i18nKey:"banner.form.start.description",children:"The banner will be shown starting from this date/time."}),children:(0,e.jsx)(i.xI,{name:"startTime",control:f,render:({field:{ref:t,value:r,...m}})=>(0,e.jsx)(T.K,{...m,date:r||void 0,showSeconds:!1,clearable:!0,minDate:new Date})})}),(0,e.jsx)(o.D,{label:(0,a.t)("banner.form.end.label","Ends at"),invalid:!!p?.endTime,error:p?.endTime?.message,description:(0,e.jsx)(a.x6,{i18nKey:"banner.form.end.description",children:"If no end date is selected, the banner is displayed indefinitely."}),children:(0,e.jsx)(i.xI,{name:"endTime",control:f,rules:{validate:t=>!B||!t||t>B?!0:(0,a.t)("banner.form.end.error","End time must be after start time")},render:({field:{ref:t,value:r,...m}})=>(0,e.jsx)(T.K,{...m,date:r||void 0,showSeconds:!1,clearable:!0})})}),(0,e.jsx)(v.B,{children:(0,e.jsx)(o.D,{label:(0,a.t)("banner.form.variant.label","Variant"),children:(0,e.jsx)(i.xI,{name:"variant",control:f,render:({field:{ref:t,onChange:r,...m}})=>(0,e.jsx)(F.l6,{...m,onChange:Z=>{r(Z.value)},placeholder:(0,a.t)("banner.form.select.placeholder","Select banner type"),options:[{label:(0,a.t)("banner.form.options.info","Info"),value:"info"},{label:(0,a.t)("banner.form.options.warning","Warning"),value:"warning"},{label:(0,a.t)("banner.form.options.error","Error"),value:"error"}]})})})}),(0,e.jsx)(V.$n,{type:"submit",disabled:!D||c.isLoading,children:c.isLoading?(0,e.jsx)(a.x6,{i18nKey:"banner.form.button-saving",children:"Saving..."}):(0,e.jsx)(a.x6,{i18nKey:"banner.form.button-save",children:"Save"})})]})})]})}function y(){const[s,d]=(0,S.Y)();return(0,b.useEffect)(()=>{(0,u.Jy)()},[]),(0,e.jsx)(j.Y,{navId:"banner-settings",children:(0,e.jsx)(j.Y.Contents,{isLoading:d,children:(0,e.jsx)(U,{banner:s?.spec,name:s?.metadata?.name??""})})})}const $=y}}]);

//# sourceMappingURL=BannerSettingsPage.29b8473954033e195913.js.map