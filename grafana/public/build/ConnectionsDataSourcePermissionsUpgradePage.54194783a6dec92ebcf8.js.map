{"version":3,"file":"ConnectionsDataSourcePermissionsUpgradePage.54194783a6dec92ebcf8.js","mappings":"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","sources":["webpack://grafana/./public/app/extensions/connections/DataSourcePermissionsUpgradePage.tsx","webpack://grafana/./public/app/extensions/permissions/Upgrade.tsx","webpack://grafana/./public/app/features/connections/hooks/useDataSourceSettingsNav.ts","webpack://grafana/./public/app/features/datasources/state/hooks.ts","webpack://grafana/./public/app/features/datasources/utils.ts"],"sourcesContent":["import { useParams } from 'react-router-dom-v5-compat';\n\nimport { Page } from 'app/core/components/Page/Page';\nimport { useDataSourceSettingsNav } from 'app/features/connections/hooks/useDataSourceSettingsNav';\n\nimport Upgrade from '../permissions/Upgrade';\n\nexport const DataSourcePermissionsUpgradePage = () => {\n  const { uid = '' } = useParams<{ uid: string }>();\n  const { navId, pageNav } = useDataSourceSettingsNav('permissions');\n\n  return (\n    <Page navId={navId} pageNav={pageNav}>\n      <Page.Contents>\n        <Upgrade uid={uid} />\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default DataSourcePermissionsUpgradePage;\n","import { t } from '@grafana/i18n';\nimport { useTheme2 } from '@grafana/ui';\nimport { UpgradeBox, UpgradeContent, UpgradeContentProps } from 'app/core/components/Upgrade/UpgradeBox';\nimport { useInitDataSourceSettings } from 'app/features/datasources/state/hooks';\n\nexport type UpgradePageProps = {\n  uid: string;\n};\n\nexport const Upgrade = ({ uid }: UpgradePageProps) => {\n  useInitDataSourceSettings(uid);\n\n  return (\n    <>\n      <UpgradeBox featureName={'data source permissions'} featureId={'data-source-permissions'} />\n      <PermissionsUpgradeContent />\n    </>\n  );\n};\n\nexport interface PermissionsUpgradeContentProps {\n  action?: UpgradeContentProps['action'];\n}\n\nexport const PermissionsUpgradeContent = ({ action }: PermissionsUpgradeContentProps) => {\n  const theme = useTheme2();\n\n  return (\n    <UpgradeContent\n      action={action}\n      featureName={'data source permissions'}\n      description={t(\n        'permissions.permissions-upgrade-content.description-source-permissions-protect-sensitive-limiting-access',\n        'With data source permissions, you can protect sensitive data by limiting access to this data source to specific users, teams, and roles.'\n      )}\n      listItems={[\n        t(\n          'permissions.permissions-upgrade-content.source-permissions-protect-sensitive-data-list-item',\n          'Protect sensitive data, like security logs, production databases, and personally-identifiable information'\n        ),\n        t(\n          'permissions.permissions-upgrade-content.source-permissions-protect-clean-experience-list-item',\n          'Clean up users’ experience by hiding data sources they don’t need to use'\n        ),\n        t(\n          'permissions.permissions-upgrade-content.source-permissions-protect-share-access-list-item',\n          'Share Grafana access more freely, knowing that users will not unwittingly see sensitive data'\n        ),\n      ]}\n      image={`ds-permissions-${theme.isLight ? 'light' : 'dark'}.png`}\n      featureUrl={'https://grafana.com/docs/grafana/latest/enterprise/datasource_permissions'}\n    />\n  );\n};\n\nexport default Upgrade;\n","import { useLocation, useParams } from 'react-router-dom-v5-compat';\n\nimport { NavModel, NavModelItem } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { useDataSource, useDataSourceMeta, useDataSourceSettings } from 'app/features/datasources/state/hooks';\nimport { getDataSourceLoadingNav, buildNavModel, getDataSourceNav } from 'app/features/datasources/state/navModel';\nimport { useGetSingle } from 'app/features/plugins/admin/state/hooks';\nimport { useSelector } from 'app/types/store';\n\nexport function useDataSourceSettingsNav(pageIdParam?: string) {\n  const { uid = '' } = useParams<{ uid: string }>();\n  const location = useLocation();\n  const datasource = useDataSource(uid);\n  const dataSourceMeta = useDataSourceMeta(datasource.type);\n  const datasourcePlugin = useGetSingle(datasource.type);\n  const params = new URLSearchParams(location.search);\n  const pageId = pageIdParam || params.get('page');\n\n  const { plugin, loadError, loading } = useDataSourceSettings();\n  const dsi = getDataSourceSrv()?.getInstanceSettings(uid);\n  const hasAlertingEnabled = Boolean(dsi?.meta?.alerting ?? false);\n  const isAlertManagerDatasource = dsi?.type === 'alertmanager';\n  const alertingSupported = hasAlertingEnabled || isAlertManagerDatasource;\n\n  const navIndex = useSelector((state) => state.navIndex);\n  const navIndexId = pageId ? `datasource-${pageId}-${uid}` : `datasource-settings-${uid}`;\n  let pageNav: NavModel = {\n    node: {\n      text: t('connections.use-data-source-settings-nav.page-nav.text.data-source-nav-node', 'Data Source Nav Node'),\n    },\n    main: {\n      text: t('connections.use-data-source-settings-nav.page-nav.text.data-source-nav-node', 'Data Source Nav Node'),\n    },\n  };\n\n  if (loadError) {\n    const node: NavModelItem = {\n      text: loadError,\n      subTitle: t('connections.use-data-source-settings-nav.node.subTitle.data-source-error', 'Data Source Error'),\n      icon: 'exclamation-triangle',\n    };\n\n    pageNav = {\n      node: node,\n      main: node,\n    };\n  }\n\n  if (loading || !plugin) {\n    pageNav = getNavModel(navIndex, navIndexId, getDataSourceLoadingNav('settings'));\n  }\n\n  if (plugin) {\n    pageNav = getNavModel(\n      navIndex,\n      navIndexId,\n      getDataSourceNav(buildNavModel(datasource, plugin), pageId || 'settings')\n    );\n  }\n\n  const connectionsPageNav = {\n    ...pageNav.main,\n    dataSourcePluginName: datasourcePlugin?.name || plugin?.meta.name || '',\n    active: true,\n    text: datasource.name,\n    subTitle: `Type: ${dataSourceMeta.name}`,\n    children: (pageNav.main.children || []).map((navModelItem) => ({\n      ...navModelItem,\n      url: navModelItem.url?.replace('datasources/edit/', '/connections/datasources/edit/'),\n    })),\n  };\n\n  return {\n    navId: 'connections-datasources',\n    pageNav: connectionsPageNav,\n    dataSourceHeader: {\n      alertingSupported,\n    },\n  };\n}\n","import { useEffect } from 'react';\n\nimport { DataSourcePluginMeta, DataSourceSettings } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { cleanUpAction } from 'app/core/actions/cleanUp';\nimport appEvents from 'app/core/app_events';\nimport { contextSrv } from 'app/core/core';\nimport { AccessControlAction } from 'app/types/accessControl';\nimport { ShowConfirmModalEvent } from 'app/types/events';\nimport { useDispatch, useSelector } from 'app/types/store';\n\nimport { ROUTES } from '../../connections/constants';\nimport { DataSourceRights } from '../types';\nimport { constructDataSourceExploreUrl } from '../utils';\n\nimport {\n  initDataSourceSettings,\n  testDataSource,\n  loadDataSource,\n  loadDataSources,\n  loadDataSourcePlugins,\n  addDataSource,\n  updateDataSource,\n  deleteLoadedDataSource,\n} from './actions';\nimport { initialDataSourceSettingsState } from './reducers';\nimport { getDataSource, getDataSourceMeta } from './selectors';\n\nexport const useInitDataSourceSettings = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(initDataSourceSettings(uid));\n\n    return function cleanUp() {\n      dispatch(\n        cleanUpAction({\n          cleanupAction: (state) => (state.dataSourceSettings = initialDataSourceSettingsState),\n        })\n      );\n    };\n  }, [uid, dispatch]);\n};\n\nexport const useTestDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  return () => dispatch(testDataSource(uid, ROUTES.DataSourcesEdit));\n};\n\nexport const useLoadDataSources = () => {\n  const dispatch = useDispatch();\n  const isLoading = useSelector((state) => state.dataSources.isLoadingDataSources);\n  const dataSources = useSelector((state) => state.dataSources.dataSources);\n\n  useEffect(() => {\n    dispatch(loadDataSources());\n  }, [dispatch]);\n\n  return { isLoading, dataSources };\n};\n\nexport const useLoadDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSource(uid));\n  }, [dispatch, uid]);\n};\n\nexport const useLoadDataSourcePlugins = () => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSourcePlugins());\n  }, [dispatch]);\n};\n\nexport const useAddDatasource = () => {\n  const dispatch = useDispatch();\n\n  return (plugin: DataSourcePluginMeta) => {\n    dispatch(addDataSource(plugin, ROUTES.DataSourcesEdit));\n  };\n};\n\nexport const useUpdateDatasource = () => {\n  const dispatch = useDispatch();\n\n  return async (dataSource: DataSourceSettings) => dispatch(updateDataSource(dataSource));\n};\n\nexport const useDeleteLoadedDataSource = () => {\n  const dispatch = useDispatch();\n  const { name } = useSelector((state) => state.dataSources.dataSource);\n\n  return () => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: t('datasources.use-delete-loaded-data-source.title.delete', 'Delete'),\n        text: `Are you sure you want to delete the \"${name}\" data source?`,\n        yesText: 'Delete',\n        icon: 'trash-alt',\n        onConfirm: () => dispatch(deleteLoadedDataSource()),\n      })\n    );\n  };\n};\n\nexport const useDataSource = (uid: string) => {\n  return useSelector((state) => getDataSource(state.dataSources, uid));\n};\n\nexport const useDataSourceExploreUrl = (uid: string) => {\n  const dataSource = useDataSource(uid);\n  return constructDataSourceExploreUrl(dataSource);\n};\n\nexport const useDataSourceMeta = (pluginType: string): DataSourcePluginMeta => {\n  return useSelector((state) => getDataSourceMeta(state.dataSources, pluginType));\n};\n\nexport const useDataSourceSettings = () => {\n  return useSelector((state) => state.dataSourceSettings);\n};\n\nexport const useDataSourceRights = (uid: string): DataSourceRights => {\n  const dataSource = useDataSource(uid);\n  const readOnly = dataSource.readOnly === true;\n  const hasWriteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesWrite, dataSource);\n  const hasDeleteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesDelete, dataSource);\n\n  return {\n    readOnly,\n    hasWriteRights,\n    hasDeleteRights,\n  };\n};\n","import { DataSourceJsonData, DataSourceSettings, urlUtil, locationUtil } from '@grafana/data';\n\nexport const constructDataSourceExploreUrl = (dataSource: DataSourceSettings<DataSourceJsonData, {}>) => {\n  const exploreState = JSON.stringify({ datasource: dataSource.name, context: 'explore' });\n  const exploreUrl = urlUtil.renderUrl(locationUtil.assureBaseUrl('/explore'), { left: exploreState });\n\n  return exploreUrl;\n};\n"],"names":["DataSourcePermissionsUpgradePage","uid","navId","pageNav","Upgrade","PermissionsUpgradeContent","action","theme","useDataSourceSettingsNav","pageIdParam","location","datasource","dataSourceMeta","datasourcePlugin","params","pageId","plugin","loadError","loading","dsi","hasAlertingEnabled","isAlertManagerDatasource","alertingSupported","navIndex","state","navIndexId","node","navModelItem","useInitDataSourceSettings","dispatch","useTestDataSource","useLoadDataSources","isLoading","dataSources","useLoadDataSource","useLoadDataSourcePlugins","useAddDatasource","useUpdateDatasource","dataSource","useDeleteLoadedDataSource","name","useDataSource","useDataSourceExploreUrl","useDataSourceMeta","pluginType","useDataSourceSettings","useDataSourceRights","readOnly","hasWriteRights","hasDeleteRights","constructDataSourceExploreUrl","exploreState"],"sourceRoot":""}