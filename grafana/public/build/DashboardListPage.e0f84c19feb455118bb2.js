"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{45546:(q,R,t)=>{t.r(R),t.d(R,{default:()=>Wt});var e=t(74848),h=t(22803),n=t(10378),l=t(96540),M=t(54148),E=t(70713),a=t(92745),g=t(27489),v=t(43173),x=t(63142),C=t(41654),b=t(66404),p=t(45861),O=t(12737),D=t(13791),w=t(65642),c=t(52763),L=t(82151),o=t(15130),P=t(75735),T=t(66198),z=t(75793);function K(s=!1){return s?(0,a.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,a.t)("search.search-input.placeholder","Search for dashboards and folders")}function ee(){return(0,a.t)("search.dashboard-actions.new-dashboard","New dashboard")}function ne(){return(0,a.t)("search.dashboard-actions.new-folder","New folder")}function ge(){return(0,a.t)("search.dashboard-actions.import","Import")}function he(){return(0,a.t)("search.dashboard-actions.new","New")}var J=t(18346),xe=t(45967),ue=t(45229),le=t(87745),A=t(80231),Q=t(87186),F=t(72472),oe=t(65542);function de(){const s=(0,c.wA)(),r=(0,A.xK)(),[f]=(0,J.uz)(),[i]=(0,J.wt)(),[,d]=(0,z.ET)(),u=(0,l.useMemo)(()=>!v.$.featureToggles.nestedFolders&&Object.values(r.folder).some($=>$),[r]),y=d.hasSearchFilters(),I=()=>{s((0,Q.cT)({isSelected:!1,folderUID:void 0})),y&&d.doSearchWithDebounce()},j=async()=>{await f({selectedItems:r}),ie("delete",r),I()},m=async $=>{await i({selectedItems:r,destinationUID:$}),ie("move",r),I()},N=()=>{ue.A.publish(new le.S8({component:oe.J,props:{selectedItems:r,onConfirm:m}}))},W=()=>{ue.A.publish(new le.S8({component:F.T,props:{selectedItems:r,onConfirm:j}}))},V=(0,e.jsx)(p.$n,{onClick:N,variant:"secondary",disabled:u,children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(C.B,{gap:1,"data-testid":"manage-actions",children:[u?(0,e.jsx)(xe.m,{content:(0,a.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved"),children:V}):V,(0,e.jsx)(p.$n,{onClick:W,variant:"destructive",children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]})}const Ee={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function ie(s,r){const f=Object.keys(r.dashboard).filter(d=>r.dashboard[d]),i=Object.keys(r.folder).filter(d=>r.folder[d]);(0,g.rR)(Ee[s],{item_counts:{folder:i.length,dashboard:f.length},source:"tree_actions",restore_enabled:!!v.$.featureToggles.restoreDashboards})}var pe=t(63498),te=t(55860);function je(){const[s,r]=(0,z.ET)();return(0,e.jsx)(pe.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:r.getTagOptions,getSortOptions:(0,te.S)().getSortOptions,sortPlaceholder:(0,te.S)().sortPlaceholder,onLayoutChange:r.onLayoutChange,onStarredFilterChange:r.onStarredFilterChange,onSortChange:r.onSortChange,onTagFilterChange:r.onTagFilterChange,onDatasourceChange:r.onDatasourceChange,onPanelTypeChange:r.onPanelTypeChange,onSetIncludePanels:r.onSetIncludePanels})}var Oe=t(50201),re=t(89640),Pe=t(43951),De=t(27044),Te=t(44220),B=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(B||{}),Ce=t(32885),Ie=t(97222),Re=t(10022),we=t(28105),ce=t(51898),be=t(32635),ye=t(62963);function Be({row:{original:s},isSelected:r,onItemSelectionChange:f}){const i=s.item;if(!r)return(0,e.jsx)(Le,{});if(i.kind==="ui")return i.uiKind==="pagination-placeholder"?(0,e.jsx)(be.S,{disabled:!0,value:!1}):(0,e.jsx)(Le,{});if((0,ye.I2)(i.uid))return(0,e.jsx)(Le,{});const d=r(i);return(0,e.jsx)(be.S,{"data-testid":ce.Tp.pages.BrowseDashboards.table.checkbox(i.uid),"aria-label":(0,a.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:d===B.Selected,indeterminate:d===B.Mixed,onChange:u=>f?.(i,u.currentTarget.checked),disabled:i.managedBy===P.Sf.Repo})}function Le(){const s=(0,x.of)(Ue);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const Ue=s=>({checkboxSpacer:(0,h.css)({paddingLeft:s.spacing(2)})});function fe({isSelected:s,onAllSelectionChange:r}){const f=s?.("$all")??B.Unselected;return(0,e.jsx)(be.S,{value:f===B.Selected,indeterminate:f===B.Mixed,"aria-label":(0,a.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:i=>{f===B.Mixed?r?.(!1):r?.(i.currentTarget.checked)}})}var Fe=t(70255),rt=t(76319),nt=t(68079),Ve=t(30703),lt=t(20941),He=t(58851),dt=t(93854),ze=t(90666);const Ke="md",Ge="sm";function it({row:{original:s},onFolderClick:r,treeID:f}){const i=(0,x.of)(ct),{item:d,level:u,isOpen:y}=s,I=(0,A.V6)(),j=y&&!I[d.uid],m=(0,dt.cu)(s.item,y);return d.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ze.T,{level:u,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:i.folderButtonSpacer}),d.uiKind==="empty-folder"?(0,e.jsx)("em",{className:i.emptyText,children:(0,e.jsx)(b.E,{variant:"body",color:"secondary",truncate:!0,children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.name-cell.no-items",children:"No items"})})}):(0,e.jsx)(Fe.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ze.T,{level:u,spacing:{xs:1,md:3}}),d.kind==="folder"?(0,e.jsx)(rt.K,{size:Ke,className:i.chevron,onClick:()=>{r(d.uid,!y)},name:y?"angle-down":"angle-right","aria-label":y?(0,a.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:d.title}):(0,a.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:d.title})}):(0,e.jsx)("span",{className:i.folderButtonSpacer}),(0,e.jsxs)("div",{className:i.iconNameContainer,children:[j?(0,e.jsx)(nt.y,{size:Ge}):(0,e.jsx)(Ve.I,{size:Ge,name:m}),(0,e.jsx)(b.E,{variant:"body",truncate:!0,id:f&&(0,ye.eM)(f,d),children:d.url?(0,e.jsx)(lt.N,{onClick:()=>{(0,g.rR)("manage_dashboards_result_clicked")},href:d.url,className:i.link,children:d.title}):d.title}),(0,e.jsx)(L.b,{folder:d})]})]})}const ct=s=>({chevron:(0,h.css)({marginRight:s.spacing(1),width:(0,He.cs)(Ke)}),emptyText:(0,h.css)({overflow:"hidden"}),folderButtonSpacer:(0,h.css)({paddingLeft:`calc(${(0,He.cs)(Ke)}px + ${s.spacing(1)})`}),iconNameContainer:(0,h.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,h.css)({"&:hover":{textDecoration:"underline"}})});var Qe=t(37658);function ht({row:{original:s}}){const r=(0,x.of)(ut),f=s.item;return f.kind==="ui"?f.uiKind==="pagination-placeholder"?(0,e.jsx)(Qe.L.Skeleton,{}):null:f.tags?(0,e.jsx)(Qe.L,{className:r.tagList,tags:f.tags}):null}function ut(s){return{tagList:(0,h.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var ft=t(75044);const Ye=36,We=36,mt=0;function vt({items:s,width:r,height:f,isSelected:i,onFolderClick:d,onAllSelectionChange:u,onItemSelectionChange:y,isItemLoaded:I,requestLoadMore:j,canSelect:m=!1}){const N=(0,l.useId)(),W=(0,l.useRef)(null),V=(0,l.useRef)(null),$=(0,x.of)(Je);(0,l.useEffect)(()=>{W.current&&W.current.resetloadMoreItemsCache(!0),V.current&&V.current.resetAfterIndex(0)},[s]);const S=(0,l.useMemo)(()=>{const H={id:"checkbox",width:0,Header:fe,Cell:Be},Z={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:X=>(0,e.jsx)(it,{...X,onFolderClick:d})},k={id:"tags",width:2,Header:(0,a.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:ht};return[m&&H,Z,k].filter(we.zz)},[d,m]),U=(0,Ce.useTable)({columns:S,data:s},ft.A),{getTableProps:se,getTableBodyProps:ae,headerGroups:me}=U,_=(0,l.useMemo)(()=>({table:U,isSelected:i,onAllSelectionChange:u,onItemSelectionChange:y,treeID:N}),[U,i,u,y,s,N]),Y=(0,l.useCallback)(H=>I(H),[I]),ve=(0,l.useCallback)((H,Z)=>{const{parentUID:k}=s[H];j(k)},[j,s]),Me=(0,l.useCallback)(H=>{const Z=s[H];return Z.item.kind==="ui"&&Z.item.uiKind==="divider"?mt:We},[s]);return(0,e.jsxs)("div",{...se(),role:"table",children:[me.map(H=>{const{key:Z,...k}=H.getHeaderGroupProps({style:{width:r}});return(0,e.jsx)("div",{...k,className:(0,h.cx)($.row,$.headerRow),children:H.headers.map(G=>{const{key:X,...Se}=G.getHeaderProps();return(0,e.jsx)("div",{...Se,role:"columnheader",className:$.cell,children:G.render("Header",{isSelected:i,onAllSelectionChange:u})},X)})},Z)}),(0,e.jsx)("div",{...ae(),"data-testid":ce.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(Re.A,{ref:W,itemCount:s.length,isItemLoaded:Y,loadMoreItems:ve,children:({onItemsRendered:H,ref:Z})=>(0,e.jsx)(Ie._m,{ref:k=>{Z(k),V.current=k},height:f-Ye,width:r,itemCount:s.length,itemData:_,estimatedItemSize:We,itemSize:Me,onItemsRendered:H,children:gt})})})]})}function gt({index:s,style:r,data:f}){const i=(0,x.of)(Je),{table:d,isSelected:u,onItemSelectionChange:y,treeID:I}=f,{rows:j,prepareRow:m}=d,N=j[s];m(N);const W=N.original.item,{key:V,...$}=N.getRowProps({style:r});return W.kind==="ui"&&W.uiKind==="divider"?(0,e.jsx)("div",{...$,children:(0,e.jsx)("hr",{className:i.divider})},V):(0,e.jsx)("div",{...$,className:(0,h.cx)(i.row,i.bodyRow),"aria-labelledby":(0,ye.eM)(I,W),"data-testid":ce.Tp.pages.BrowseDashboards.table.row("title"in W?W.title:W.uid),children:N.cells.map(S=>{const{key:U,...se}=S.getCellProps();return(0,e.jsx)("div",{...se,className:i.cell,children:S.render("Cell",{isSelected:u,onItemSelectionChange:y,treeID:I})},U)})},V)}const Je=s=>({row:(0,h.css)({gap:s.spacing(1)}),divider:(0,h.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,h.css)({backgroundColor:s.colors.background.secondary,height:Ye}),bodyRow:(0,h.css)({height:We,"&:hover":{backgroundColor:s.colors.action.hover}}),cell:(0,h.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,h.css)({"&:hover":{textDecoration:"underline"}})});function xt({folderUID:s,width:r,height:f,canSelect:i}){const d=(0,A.eC)(s),u=(0,c.wA)(),y=(0,A.q0)(s),I=(0,A.Ms)(),j=(0,A.V6)(),m=(0,l.useCallback)((S,U)=>{u((0,Q.wn)({folderUID:S,isOpen:U})),U&&u((0,Te.Ii)({parentUID:S,pageSize:De.md}))},[u]),N=(0,l.useCallback)((S,U)=>{u((0,Q.t$)({item:S,isSelected:U}))},[u]),W=(0,l.useCallback)(S=>{if(S==="$all"){if(I.$all)return B.Selected;for(const ae of Object.values(I))if(typeof ae!="boolean"){for(const me in ae)if(ae[me])return B.Mixed}return B.Unselected}return I[S.kind][S.uid]?B.Selected:Ze(S,j,I)?B.Mixed:B.Unselected},[I,j]),V=(0,l.useCallback)(S=>{const U=y[S];if(!U)return!1;const se=U.item;return!(se.kind==="ui"&&se.uiKind==="pagination-placeholder")},[y]),$=(0,A.Zg)();return d==="fulfilled"&&y.length===0?(0,e.jsx)("div",{style:{width:r},children:i?(0,e.jsx)(Oe.p,{variant:"call-to-action",button:(0,e.jsx)(p.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,a.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,a.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(a.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(re.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(Pe.c,{callToActionElement:(0,e.jsx)("span",{children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.browse-view.this-folder-is-empty",children:"This folder is empty"})})})}):(0,e.jsx)(vt,{canSelect:i,items:y,width:r,height:f,isSelected:W,onFolderClick:m,onAllSelectionChange:S=>u((0,Q.cT)({isSelected:S,folderUID:s})),onItemSelectionChange:N,isItemLoaded:V,requestLoadMore:$})}function Ze(s,r,f){const i=r[s.uid];return i?i.items.some(d=>{const u=f[d.kind][d.uid];return u||Ze(d,r,f)}):!1}var Et=t(92138),pt=t(36490),Pt=t(87063),Ne=t(94535),bt=t(88559),yt=t(8207),Dt=t(64762),Ct=t(27321),$e=t(49785),Xe=t(37386),_e=t(63527),ke=t(89223);const qe={folderName:""};function Mt({onCancel:s,onConfirm:r}){const{handleSubmit:f,register:i,formState:{errors:d}}=(0,$e.mN)({defaultValues:qe}),u=(0,a.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),y=async j=>{try{return await ke.P.validateNewFolderName(j),!0}catch(m){if(m instanceof Error)return m.message;throw m}},I=(0,a.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:f(j=>r(j.folderName)),"data-testid":ce.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(Xe.D,{label:I,invalid:!!d.folderName,error:d.folderName&&d.folderName.message,children:(0,e.jsx)(_e.p,{"data-testid":ce.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:qe.folderName,...i("folderName",{required:u,validate:async j=>await y(j)})})}),(0,e.jsxs)(C.B,{children:[(0,e.jsx)(p.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(p.$n,{type:"submit",children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}var et=t(32899),St=t(75234),tt=t(34999),jt=t(33680),Ot=t(89314),Tt=t(91555),st=t(96727),It=t(41769);function Rt({initialValues:s,repository:r,workflowOptions:f,folder:i,isGitHub:d,onDismiss:u}){const{prURL:y}=(0,st.H)(),I=(0,M.Zp)(),[j,m]=(0,jt.tj)(),N=(0,$e.mN)({defaultValues:s,mode:"onBlur"}),{handleSubmit:W,watch:V,register:$,formState:S}=N,[U,se]=V(["workflow","ref"]);(0,l.useEffect)(()=>{const _=(0,St.J7)();if(m.isSuccess&&r){u?.(),_.publish({type:et.r1.alertSuccess.name,payload:[(0,a.t)("browse-dashboards.new-provisioned-folder-form.alert-folder-created-successfully","Folder created successfully")]});const Y=m.data.resource?.upsert;if(Y?.metadata?.name){I(`/dashboards/f/${Y?.metadata?.name}/`);return}let ve=`${Tt.mL}/${r.name}/file/${m.data.path}`;m.data.ref?.length&&(ve+="?ref="+m.data.ref),I(ve)}else m.isError&&_.publish({type:et.r1.alertError.name,payload:[(0,a.t)("browse-dashboards.new-provisioned-folder-form.alert-error-creating-folder","Error creating folder"),m.error]})},[m.isSuccess,m.isError,m.error,se,m.data,U,I,r,u]);const ae=async _=>{try{return await ke.P.validateNewFolderName(_),!0}catch(Y){return Y instanceof Error?Y.message:(0,a.t)("browse-dashboards.new-provisioned-folder-form.error-invalid-folder-name","Invalid folder name")}},me=async({ref:_,title:Y,workflow:ve,comment:Me})=>{const H=r?.name;if(!Y||!H)return;const Z=i?.metadata?.annotations?.[P.Y_]??"",k=Y.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),X=`${Z?`${Z}/`:""}${k}/`,Se={title:Y,type:"folder"};ve==="write"&&(_=void 0),j({ref:_,name:H,path:X,message:Me||`Create folder: ${Y}`,body:Se})};return(0,e.jsx)($e.Op,{...N,children:(0,e.jsx)("form",{onSubmit:W(me),children:(0,e.jsxs)(C.B,{direction:"column",gap:2,children:[!r?.workflows?.length&&(0,e.jsx)(tt.F,{title:(0,a.t)("browse-dashboards.new-provisioned-folder-form.title-this-repository-is-read-only","This repository is read only"),children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.text-this-repository-is-read-only",children:"If you have direct access to the target, copy the JSON and paste it there."})}),(0,e.jsx)(Xe.D,{noMargin:!0,label:(0,a.t)("browse-dashboards.new-provisioned-folder-form.label-folder-name","Folder name"),invalid:!!S.errors.title,error:S.errors.title?.message,children:(0,e.jsx)(_e.p,{...$("title",{required:(0,a.t)("browse-dashboards.new-provisioned-folder-form.error-required","Folder name is required"),validate:ae}),placeholder:(0,a.t)("browse-dashboards.new-provisioned-folder-form.folder-name-input-placeholder-enter-folder-name","Enter folder name"),id:"folder-name-input"})}),(0,e.jsx)(Ot.x,{resourceType:"folder",isNew:!1,workflow:U,workflowOptions:f,isGitHub:d,hidePath:!0}),y&&(0,e.jsxs)(tt.F,{severity:"info",title:(0,a.t)("browse-dashboards.new-provisioned-folder-form.title-pull-request-created","Pull request created"),children:[(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.new-provisioned-folder-form.text-pull-request-created",children:"A pull request has been created with changes to this folder:"})," ",(0,e.jsx)("a",{href:y,target:"_blank",rel:"noopener noreferrer",children:y})]}),(0,e.jsxs)(C.B,{gap:2,children:[(0,e.jsx)(p.$n,{variant:"secondary",fill:"outline",onClick:u,children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.new-provisioned-folder-form.cancel",children:"Cancel"})}),(0,e.jsx)(p.$n,{type:"submit",disabled:m.isLoading,children:m.isLoading?(0,a.t)("browse-dashboards.new-provisioned-folder-form.button-creating","Creating..."):(0,a.t)("browse-dashboards.new-provisioned-folder-form.button-create","Create")})]})]})})})}function wt({parentFolder:s,onDismiss:r}){const{workflowOptions:f,isGitHub:i,repository:d,folder:u,initialValues:y}=(0,It.Y)({folderUid:s?.uid,action:"create",title:""});return y?(0,e.jsx)(Rt,{parentFolder:s,onDismiss:r,initialValues:y,repository:d,workflowOptions:f,folder:u,isGitHub:i}):null}function Lt({parentFolder:s,canCreateDashboard:r,canCreateFolder:f}){const[i,d]=(0,l.useState)(!1),u=(0,M.zy)(),[y]=(0,J.Vc)(),[I,j]=(0,l.useState)(!1),m=(0,Dt._2)(),N=(0,Ct.F)(),W=async $=>{try{const S=await y({title:$,parentUid:s?.uid}),U=s?.parents?s.parents.length+1:0;(0,g.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:U}),S.error?m.error("Failed to create folder"):m.success("Folder created"),S.data&&pt.Ny.push(Et.I.stripBaseFromUrl(S.data.url))}finally{j(!1)}},V=(0,e.jsxs)(Pt.W,{children:[r&&(0,e.jsx)(Ne.D,{label:ee(),onClick:()=>(0,g.rR)("grafana_menu_item_clicked",{url:Ae("/dashboard/new",s?.uid),from:u.pathname}),url:Ae("/dashboard/new",s?.uid)}),f&&(0,e.jsx)(Ne.D,{onClick:()=>j(!0),label:ne()}),r&&(0,e.jsx)(Ne.D,{label:ge(),onClick:()=>(0,g.rR)("grafana_menu_item_clicked",{url:Ae("/dashboard/import",s?.uid),from:u.pathname}),url:Ae("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(bt.m,{overlay:V,onVisibleChange:d,children:(0,e.jsxs)(p.$n,{children:[he(),(0,e.jsx)(Ve.I,{name:i?"angle-up":"angle-down"})]})}),I&&(0,e.jsx)(yt._,{title:ne(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>j(!1),size:"sm",children:s?.managedBy===P.Sf.Repo||N?(0,e.jsx)(wt,{onDismiss:()=>j(!1),parentFolder:s}):(0,e.jsx)(Mt,{onConfirm:W,onCancel:()=>j(!1)})})]})}function Ae(s,r){const f=r?s+"?folderUid="+r:s;return v.$.appSubUrl?v.$.appSubUrl+f:f}var At=t(13756),at=t(55001);function Bt({queryParams:s}){const r=v.$.featureToggles.provisioning,{prURL:f,newPrURL:i}=(0,st.H)();return!r||"kiosk"in s?null:f?(0,e.jsx)(at.G,{prParam:f}):i?(0,e.jsx)(at.G,{prParam:i,isNewPr:!0}):null}var Ut=t(85643),Ft=t(83485);const ot=(0,l.memo)(({queryParams:s})=>{const{uid:r}=(0,M.g)(),f=(0,c.wA)(),i=(0,x.of)(Kt),[d,u]=(0,z.ET)(),y=u.hasSearchFilters(),I=(0,M.zy)(),j=(0,l.useMemo)(()=>new URLSearchParams(I.search),[I.search]);(0,l.useEffect)(()=>{u.initStateFromUrl(r),f((0,Q.cT)({isSelected:!1,folderUID:void 0}))},[f,r,u]),(0,l.useEffect)(()=>{u.onSetStarred(j.has("starred"))},[j,u]),(0,l.useEffect)(()=>{!y&&d.result&&u.setState({result:void 0,includePanels:void 0}),y&&d.result?.totalRows===0&&(0,g.rR)("grafana_empty_state_shown",{source:"browse_dashboards"})},[y,d.result,u]);const{data:m}=(0,J.kH)(r??n.hT),[N]=(0,J.iB)(),W=(0,l.useMemo)(()=>{if(!m)return;const G=(0,T.R4)(m),X=(0,T.Cg)(m.uid),Se=G.children?.find(Nt=>Nt.id===X);return Se&&(Se.active=!0),G},[m]),V=(0,A.QE)(),{data:$}=(0,J.kH)(m?n.hT:"general"),S=m??$,{canEditFolders:U,canEditDashboards:se,canCreateDashboards:ae,canCreateFolders:me}=(0,Ft.N)(S),_=o.TP.hasRole("Admin")||o.TP.isGrafanaAdmin,Y=S?.managedBy===P.Sf.Repo,ve=U&&r&&!Y,Me=(U||se)&&!Y,H=async G=>{if(m){const X=await N({...m,title:G});if("error"in X)throw(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error"}),X.error;(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})},Z=()=>{(0,g.rR)("grafana_browse_dashboards_page_button_to_recently_deleted",{origin:window.location.pathname===(0,w.zj)().appSubUrl+"/dashboards"?"Dashboards":"Folder view"})},k=G=>(0,e.jsxs)(C.B,{alignItems:"center",gap:2,children:[(0,e.jsx)(b.E,{element:"h1",children:G})," ",(0,e.jsx)(L.b,{folder:S})]});return(0,e.jsx)(D.Y,{navId:"dashboards/browse",pageNav:W,onEditTitle:ve?H:void 0,renderTitle:k,actions:(0,e.jsxs)(e.Fragment,{children:[v.$.featureToggles.restoreDashboards&&_&&(0,e.jsx)(p.z9,{variant:"secondary",href:(0,w.zj)().appSubUrl+"/dashboard/recently-deleted",onClick:Z,children:(0,e.jsx)(a.x6,{i18nKey:"browse-dashboards.actions.button-to-recently-deleted",children:"Recently deleted"})}),m&&(0,e.jsx)(At.m,{folder:m}),(ae||me)&&(0,e.jsx)(Lt,{parentFolder:m,canCreateDashboard:ae,canCreateFolder:me})]}),children:(0,e.jsxs)(D.Y.Contents,{className:i.pageContents,children:[(0,e.jsx)(Bt,{queryParams:s}),(0,e.jsx)("div",{children:(0,e.jsx)(O.Z,{placeholder:K(d.includePanels),value:d.query,escapeRegex:!1,onChange:G=>u.onQueryChange(G)})}),V?(0,e.jsx)(de,{}):(0,e.jsx)("div",{className:i.filters,children:(0,e.jsx)(je,{})}),(0,e.jsx)("div",{className:i.subView,children:(0,e.jsx)(E.Ay,{children:({width:G,height:X})=>y?(0,e.jsx)(Ut.Q,{canSelect:Me,width:G,height:X,searchState:d,searchStateManager:u}):(0,e.jsx)(xt,{canSelect:Me,width:G,height:X,folderUID:r})})})]})})}),Kt=s=>({pageContents:(0,h.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,h.css)({height:"100%"}),filters:(0,h.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});ot.displayName="BrowseDashboardsPage";const Wt=ot},72472:(q,R,t)=>{t.d(R,{T:()=>b});var e=t(74848),h=t(96540),n=t(92745),l=t(27489),M=t(43173),E=t(71599),a=t(66404),g=t(35137),v=t(34999),x=t(18346),C=t(78059);const b=({onConfirm:p,onDismiss:O,selectedItems:D,...w})=>{const{data:c}=(0,x.G2)(D),L=!!(c&&(c.alertRule||c.libraryPanel)),[o,P]=(0,h.useState)(!1),T=async()=>{(0,l.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(D.dashboard).length,folder:Object.keys(D.folder).length},source:"browse_dashboards",restore_enabled:!1}),P(!0);try{await p(),P(!1),O()}catch{P(!1)}};return(0,e.jsx)(E.u,{body:(0,e.jsxs)(e.Fragment,{children:[M.$.featureToggles.restoreDashboards&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.E,{element:"p",children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(g.$,{v:2})]}),(0,e.jsx)(a.E,{element:"p",children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(C.x,{selectedItems:D}),(0,e.jsx)(g.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:L?(0,e.jsx)(v.F,{severity:"warning",title:(0,n.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,n.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:o?(0,n.t)("browse-dashboards.action.deleting","Deleting..."):(0,n.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:O,onConfirm:T,title:(0,n.t)("browse-dashboards.action.delete-modal-title","Delete"),...w,disabled:L})}},65542:(q,R,t)=>{t.d(R,{J:()=>b});var e=t(74848),h=t(96540),n=t(92745),l=t(22787),M=t(34999),E=t(66404),a=t(35137),g=t(37386),v=t(45861),x=t(91156),C=t(78059);const b=({onConfirm:p,onDismiss:O,selectedItems:D,...w})=>{const[c,L]=(0,h.useState)(),[o,P]=(0,h.useState)(!1),T=Object.keys(D.folder).filter(K=>D.folder[K]),z=async()=>{if(c!==void 0){P(!0);try{await p(c),P(!1),O()}catch{P(!1)}}};return(0,e.jsxs)(l.a,{title:(0,n.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:O,...w,children:[T.length>0&&(0,e.jsx)(M.F,{severity:"info",title:(0,n.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(E.E,{element:"p",children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(C.x,{selectedItems:D}),(0,e.jsx)(a.$,{v:3}),(0,e.jsx)(g.D,{label:(0,n.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(x.d,{value:c,excludeUIDs:T,onChange:L})}),(0,e.jsxs)(l.a.ButtonRow,{children:[(0,e.jsx)(v.$n,{onClick:O,variant:"secondary",fill:"outline",children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(v.$n,{disabled:c===void 0||o,onClick:z,variant:"primary",children:o?(0,n.t)("browse-dashboards.action.moving","Moving..."):(0,n.t)("browse-dashboards.action.move-button","Move")})]})]})}},13756:(q,R,t)=>{t.d(R,{m:()=>Q});var e=t(74848),h=t(96540),n=t(92745),l=t(43173),M=t(27489),E=t(36490),a=t(87063),g=t(94535),v=t(88559),x=t(45861),C=t(30703),b=t(8207),p=t(17159),O=t(73427),D=t(87745),w=t(75735),c=t(18346),L=t(83485),o=t(72472),P=t(65542),T=t(49785),z=t(32899),K=t(75234),ee=t(41654),ne=t(31286),ge=t(33680),he=t(89314),J=t(41769),xe=t(78059),ue=t(62963);function le({initialValues:F,parentFolder:oe,repository:de,workflowOptions:Ee,folder:ie,isGitHub:pe,onDismiss:te}){const je=oe?.uid||"",[Oe,re]=(0,ge.Qo)(),Pe=(0,T.mN)({defaultValues:F}),{handleSubmit:De,watch:Te}=Pe,B=Te("workflow"),Ce=async({repo:Ie,path:Re,comment:we,ref:ce})=>{if(!de?.name)return;const be=we||`Delete folder: ${ie?.metadata?.annotations?.[w.Y_]}`,ye=B==="write"?void 0:ce;Oe({name:Ie,path:`${Re}/`,ref:ye,message:be})};return(0,h.useEffect)(()=>{if(re.isSuccess&&de){if(B==="branch")return;B==="write"&&((0,K.J7)().publish({type:z.r1.alertSuccess.name,payload:[(0,n.t)("browse-dashboards.delete-provisioned-folder-form.alert-folder-deleted-successfully","Folder deleted successfully")]}),oe?.parentUid?window.location.href=(0,ue._0)(oe.parentUid):window.location.href="/dashboards")}if(re.isError){(0,K.J7)().publish({type:z.r1.alertError.name,payload:[(0,n.t)("browse-dashboards.delete-provisioned-folder-form.api-error","Failed to delete folder"),re.error]});return}},[re,de,B,oe]),(0,e.jsx)(T.Op,{...Pe,children:(0,e.jsx)("form",{onSubmit:De(Ce),children:(0,e.jsxs)(ee.B,{direction:"column",gap:2,children:[(0,e.jsxs)(ne.a,{paddingBottom:2,children:[(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.delete-warning",children:"This will delete this folder and all its descendants. In total, this will affect:"}),(0,e.jsx)(xe.x,{selectedItems:{folder:{[je]:!0},dashboard:{},panel:{},$all:!1}})]}),(0,e.jsx)(he.x,{resourceType:"folder",isNew:!1,workflow:B,workflowOptions:Ee,isGitHub:pe}),(0,e.jsxs)(ee.B,{gap:2,children:[(0,e.jsx)(x.$n,{type:"submit",disabled:re.isLoading,variant:"destructive",children:re.isLoading?(0,n.t)("browse-dashboards.delete-provisioned-folder-form.button-deleting","Deleting..."):(0,n.t)("browse-dashboards.delete-provisioned-folder-form.button-delete","Delete")}),(0,e.jsx)(x.$n,{variant:"secondary",fill:"outline",onClick:te,children:(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.button-cancel",children:"Cancel"})})]})]})})})}function A({parentFolder:F,onDismiss:oe}){const{workflowOptions:de,isGitHub:Ee,repository:ie,folder:pe,initialValues:te}=(0,J.Y)({folderUid:F?.uid,action:"delete",title:F?.title});return te?(0,e.jsx)(le,{parentFolder:F,onDismiss:oe,initialValues:te,repository:ie,workflowOptions:de,folder:pe,isGitHub:Ee}):null}function Q({folder:F}){const[oe,de]=(0,h.useState)(!1),[Ee,ie]=(0,h.useState)(!1),[pe,te]=(0,h.useState)(!1),[je]=(0,c.aF)(),[Oe]=(0,c.Ko)(),{canEditFolders:re,canDeleteFolders:Pe,canViewPermissions:De,canSetPermissions:Te}=(0,L.N)(F),B=F.managedBy===w.Sf.Repo,Ce=l.$.featureToggles.nestedFolders&&re&&!B,Ie=async fe=>{await je({folder:F,destinationUID:fe}),(0,M.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Re=async()=>{await Oe(F),(0,M.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:fe}=F,Fe=fe&&fe.length?fe[fe.length-1].url:"/dashboards";E.Ny.push(Fe)},we=()=>{O.lE.publish(new D.S8({component:P.J,props:{selectedItems:{folder:{[F.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Ie}}))},ce=()=>{O.lE.publish(new D.S8({component:o.T,props:{selectedItems:{folder:{[F.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Re}}))},be=()=>{te(!0)},ye=(0,n.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),Be=(0,n.t)("browse-dashboards.folder-actions-button.move","Move"),Le=(0,n.t)("browse-dashboards.folder-actions-button.delete","Delete"),Ue=(0,e.jsxs)(a.W,{children:[De&&(0,e.jsx)(g.D,{onClick:()=>ie(!0),label:ye}),Ce&&(0,e.jsx)(g.D,{onClick:we,label:Be}),Pe&&!B&&(0,e.jsx)(g.D,{destructive:!0,onClick:B?be:ce,label:Le})]});return!De&&!Ce&&!Pe?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.m,{overlay:Ue,onVisibleChange:de,children:(0,e.jsxs)(x.$n,{variant:"secondary",children:[(0,e.jsx)(n.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(C.I,{name:oe?"angle-up":"angle-down"})]})}),Ee&&(0,e.jsx)(b._,{title:(0,n.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:F.title,onClose:()=>ie(!1),size:"md",children:(0,e.jsx)(p.x,{resource:"folders",resourceId:F.uid,canSetPermissions:Te})}),pe&&(0,e.jsx)(b._,{title:(0,n.t)("browse-dashboards.action.delete-provisioned-folder","Delete provisioned folder"),subtitle:F.title,onClose:()=>te(!1),children:(0,e.jsx)(A,{parentFolder:F,onDismiss:()=>te(!1)})})]})}},85643:(q,R,t)=>{t.d(R,{Q:()=>D});var e=t(74848),h=t(96540),n=t(88673),l=t(41119),M=t(92745),E=t(50201),a=t(45861),g=t(5478),v=t(86436),x=t(52763),C=t(80231),b=t(87186);const p=25,O={view:new n.R((0,l.Vc)({fields:[{name:"uid",display:!0,values:Array(p).fill(null)},{name:"kind",display:!0,values:Array(p).fill("dashboard")},{name:"name",display:!0,values:Array(p).fill("")},{name:"location",display:!0,values:Array(p).fill("")},{name:"tags",display:!0,values:Array(p).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:p};function D({width:c,height:L,canSelect:o,searchState:P,searchStateManager:T,emptyState:z}){const K=(0,x.wA)(),ee=(0,x.d4)(A=>A.browseDashboards.selectedItems),ne=(0,C.QE)(),{keyboardEvents:ge}=(0,g.d)(),he=P.result??O,J=(0,h.useCallback)((A,Q)=>A?A==="*"&&Q==="*"?ne:A==="*"?!1:ee[w(A)][Q]??!1:!1,[ee,ne]),xe=(0,h.useCallback)(()=>{K((0,b.cT)({isSelected:!1,folderUID:void 0}))},[K]),ue=(0,h.useCallback)((A,Q)=>{const F=!J(A,Q);K((0,b.t$)({item:{kind:w(A),uid:Q},isSelected:F}))},[J,K]);if(he.totalRows===0){const A=z??(0,e.jsx)(E.p,{button:(0,e.jsx)(a.$n,{variant:"secondary",onClick:T.onClearSearchAndFilters,children:(0,e.jsx)(M.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,M.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:c},children:A})}const le={response:he,selection:o?J:void 0,selectionToggle:o?ue:void 0,clearSelection:xe,width:c,height:L,onTagSelected:T.onAddTag,keyboardEvents:ge,onDatasourceChange:P.datasource?T.onDatasourceChange:void 0,onClickItem:T.onSearchItemClicked};return(0,e.jsx)(v.P,{...le})}function w(c){switch(c){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+c)}},41769:(q,R,t)=>{t.d(R,{Y:()=>E});var e=t(96540),h=t(75735),n=t(99454),l=t(57512),M=t(55266);function E({folderUid:a,action:g,title:v}){const{repository:x,folder:C,isLoading:b}=(0,M.T)({folderName:a}),p=(0,n.a)(x),O=x?.type==="github",D=(0,l.g)(),w=(0,e.useMemo)(()=>{if(!(!x||b))return{title:v||"",comment:"",ref:`folder/${D}`,repo:x.name||"",path:C?.metadata?.annotations?.[h.Y_]||"",workflow:(0,n.r)(x)}},[x,C,v,b,D]);return{repository:x,folder:C,workflowOptions:p,isGitHub:O,initialValues:w}}},83485:(q,R,t)=>{t.d(R,{N:()=>E});var e=t(43173),h=t(73427),n=t(11257);function l(a,g){return g?h.TP.hasPermissionInMetadata(a,g):h.TP.hasPermission(a)}function M(a){return a&&a.uid!=="general"&&!e.$.featureToggles.nestedFolders?!1:l(n.w.FoldersCreate,a)}function E(a){const g=l(n.w.DashboardsCreate,a),v=M(a),x=l(n.w.FoldersDelete,a),C=l(n.w.DashboardsWrite,a),b=l(n.w.FoldersWrite,a),p=l(n.w.FoldersPermissionsWrite,a),O=l(n.w.FoldersPermissionsRead,a);return{canCreateDashboards:g,canCreateFolders:v,canDeleteFolders:x,canEditDashboards:C,canEditFolders:b,canSetPermissions:p,canViewPermissions:O}}},94786:(q,R,t)=>{t.d(R,{h:()=>C,s:()=>v});var e=t(74848),h=t(92745),n=t(43173),l=t(34999),M=t(33680),E=t(96727),a=t(6262),g=t(55001);const v={severity:"info",style:{flex:0}};function x({queryParams:b,slug:p,path:O}){const{prURL:D}=(0,E.H)(),w=(0,M.Kw)({name:p,path:O,ref:b.ref});if(w.data?.errors)return(0,e.jsx)(l.F,{title:(0,h.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:w.data.errors.map((L,o)=>(0,e.jsx)("div",{children:L},o))});if(D?.length)return(0,e.jsx)(g.G,{prParam:D});const c=w.data?.urls?.newPullRequestURL??w.data?.urls?.compareURL;return c?(0,e.jsx)(g.G,{prParam:c,isNewPr:!0}):(0,e.jsx)(l.F,{...v,title:(0,h.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function C({queryParams:b,route:p,slug:O,path:D}){return!n.$.featureToggles.provisioning||"kiosk"in b||!D||p!==a.Z4.Provisioning||!O?null:(0,e.jsx)(x,{queryParams:b,slug:O,path:D})}},55001:(q,R,t)=>{t.d(R,{G:()=>g});var e=t(74848),h=t(63704),n=t(92745),l=t(34999),M=t(41654),E=t(30703),a=t(94786);function g({prParam:v,isNewPr:x}){const C=x?(0,n.t)("provisioned-resource-preview-banner.title-created-branch-git-hub","A new resource has been created in a branch in GitHub."):(0,n.t)("provisioned-resource-preview-banner.title-loaded-pull-request-git-hub","This resource is loaded from a pull request in GitHub.");return(0,e.jsx)(l.F,{...a.s,title:C,buttonContent:(0,e.jsxs)(M.B,{alignItems:"center",children:[x?(0,n.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-git-hub","Open pull request in GitHub"):(0,n.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-git-hub","View pull request in GitHub"),(0,e.jsx)(E.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(h.sQ.sanitizeUrl(v),"_blank"),children:(0,e.jsx)(n.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The value is not yet saved in the Grafana database"})})}},96727:(q,R,t)=>{t.d(R,{H:()=>n});var e=t(63704),h=t(74101);const n=()=>{const[l]=(0,h.z)(),M=l.get("pull_request_url"),E=l.get("new_pull_request_url");return{prURL:M?e.sQ.sanitizeUrl(M):void 0,newPrURL:E?e.sQ.sanitizeUrl(E):void 0}}},63498:(q,R,t)=>{t.d(R,{bj:()=>D});var e=t(74848),h=t(22803),n=t(92745),l=t(43173),M=t(63142),E=t(41654),a=t(32635),g=t(45861),v=t(77824),x=t(18552),C=t(93732),b=t(83458);function p(){return[{value:b.P.Folders,icon:"folder",description:(0,n.t)("search.actions.view-as-folders","View by folders")},{value:b.P.List,icon:"list-ul",description:(0,n.t)("search.actions.view-as-list","View as list")}]}function O(c){const L=c.layout??b.P.Folders;return L===b.P.Folders&&(c.query||c.sort||c.starred||c.tag.length>0)?b.P.List:L}const D=({state:c,showStarredFilter:L,showLayout:o,sortPlaceholder:P,onLayoutChange:T,onSortChange:z,onStarredFilterChange:K=()=>{},onTagFilterChange:ee,getTagOptions:ne,getSortOptions:ge,onDatasourceChange:he,onPanelTypeChange:J,onSetIncludePanels:xe})=>{const ue=(0,M.of)(w),le=O(c),A=c.tag.length||c.starred||c.query||c.datasource||c.panel_type?[b.P.Folders]:[];return(0,e.jsxs)(E.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(E.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(C.$,{isClearable:!1,tags:c.tag,tagOptions:ne,onChange:ee}),l.$.featureToggles.panelTitleSearch&&(0,e.jsx)(a.S,{"data-testid":"include-panels",disabled:le===b.P.Folders,value:c.includePanels,onChange:()=>xe(!c.includePanels),label:(0,n.t)("search.actions.include-panels","Include panels")}),L&&(0,e.jsx)("div",{className:ue.checkboxWrapper,children:(0,e.jsx)(a.S,{label:(0,n.t)("search.actions.starred","Starred"),onChange:K,value:c.starred})}),c.datasource&&(0,e.jsx)(g.$n,{icon:"times",variant:"secondary",onClick:()=>he(void 0),children:(0,e.jsxs)(n.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:c.datasource}]})}),c.panel_type&&(0,e.jsx)(g.$n,{icon:"times",variant:"secondary",onClick:()=>J(void 0),children:(0,e.jsxs)(n.x6,{i18nKey:"search.action-row.panel-type",values:{panel:c.panel_type},children:["Panel: ","{{panel}}"]})})]}),(0,e.jsxs)(E.B,{gap:2,children:[o&&(0,e.jsx)(v.z,{options:p(),disabledOptions:A,onChange:T,value:le}),(0,e.jsx)(x.r,{onChange:Q=>z(Q?.value),value:c.sort,getSortOptions:ge,placeholder:P||(0,n.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};D.displayName="ActionRow";const w=c=>({checkboxWrapper:(0,h.css)({label:{lineHeight:"1.2"}})})},75793:(q,R,t)=>{t.d(R,{ET:()=>c,lC:()=>O,ue:()=>C});var e=t(2543),h=t.n(e),n=t(36490),l=t(5114),M=t(29043),E=t(99090),a=t(67497),g=t(55860),v=t(83458),x=t(35886);const C={query:"",tag:[],starred:!1,layout:v.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},b={sort:null,starred:null,query:null,tag:null,layout:null},p=()=>localStorage.getItem(E.YU)===v.P.List?v.P.List:v.P.Folders;class O extends l.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(o=>n.Ny.partial(o,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...b})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=o=>{this.setStateAndDoSearch({query:o})},this.onRemoveTag=o=>{this.setStateAndDoSearch({tag:this.state.tag.filter(P=>P!==o)})},this.onTagFilterChange=o=>{this.setStateAndDoSearch({tag:o})},this.onAddTag=o=>{this.state.tag&&this.state.tag.includes(o)||this.setStateAndDoSearch({tag:[...this.state.tag,o]})},this.onDatasourceChange=o=>{this.setStateAndDoSearch({datasource:o})},this.onPanelTypeChange=o=>{this.setStateAndDoSearch({panel_type:o})},this.onStarredFilterChange=o=>{const P=o.currentTarget.checked;this.setStateAndDoSearch({starred:P})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=o=>{o!==this.state.starred&&this.setStateAndDoSearch({starred:o})},this.onSortChange=o=>{o?(localStorage.setItem(E.w7,o),localStorage.setItem(E.YU,v.P.List)):localStorage.removeItem(E.w7),this.state.layout===v.P.Folders?this.setStateAndDoSearch({sort:o,layout:v.P.List}):this.setStateAndDoSearch({sort:o})},this.onLayoutChange=o=>{localStorage.setItem(E.YU,o),this.state.sort&&o===v.P.Folders?this.setStateAndDoSearch({layout:o,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:o,sort:this.state.prevSort})},this.onSetIncludePanels=o=>{this.setStateAndDoSearch({includePanels:o}),M.A.set(E.d7,o)},this.getTagOptions=()=>{const o=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,g.S)().tags(o)},this.onSearchItemClicked=o=>{(0,a.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,a.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(o,P=!0){const T=(0,x.N1)(n.Ny.getSearchObject());(T.query||T.datasource||T.panel_type)&&(T.layout=v.P.List);const z=p(),K=localStorage.getItem(E.w7)??void 0,ee=z===v.P.List?T.sort||K:null;this.setState({...C,...T,layout:z,sort:ee??C.sort,prevSort:K,folderUid:o,eventTrackingNamespace:o?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),P&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(o){const P=o.sort||this.state.sort||localStorage.getItem(E.w7)||void 0;this.setState({sort:P,...o}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===v.P.List)}getSearchQuery(){const o={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return o.sort?.length&&!o.sort.includes("name")&&(o.kind=["dashboard","folder"]),o.query?.length||(o.query="*",o.location||(o.kind=["dashboard","folder"])),!this.state.includePanels&&!o.kind&&(o.kind=["dashboard","folder"]),o.panel_type?.length&&(o.kind=["panel"]),o}doSearch(){const o={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,a.J$)(this.state.eventTrackingNamespace,o),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const P=(0,g.S)(),T=Date.now();(this.state.starred?P.starred(this.lastQuery):P.search(this.lastQuery)).then(K=>{T>this.lastSearchTimestamp&&(this.setState({result:K,loading:!1}),this.lastSearchTimestamp=T)}).catch(K=>{(0,a.KZ)(this.state.eventTrackingNamespace,{...o,error:K?.message}),this.setState({loading:!1})})}}let D;function w(){if(!D){const o=localStorage.getItem(E.YU)??C.layout;let P=M.A.getBool(E.d7,!0);P&&(P=!1),D=new O({...C,layout:o,includePanels:P})}return D}function c(){const L=w();return[L.useState(),L]}}}]);

//# sourceMappingURL=DashboardListPage.e0f84c19feb455118bb2.js.map