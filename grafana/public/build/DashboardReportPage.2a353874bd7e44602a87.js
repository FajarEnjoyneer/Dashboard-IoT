"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1538],{33099:(U,S,c)=>{c.r(S),c.d(S,{DashboardReportPage:()=>J,default:()=>Wt});var a=c(74848),m=c(22803),u=c(96540),L=c(54148),R=c(92745),C=c(36674),T=c(63142),k=c(34999),q=c(11098),_=c(47797),tt=c(41644),et=c(1131),st=c(6262);function nt(){return typeof window.ResizeObserver<"u"}function rt(t){const{ref:e,box:s,onResize:n}=t;(0,u.useEffect)(()=>{let i=e?.current;if(i)if(nt()){const r=new window.ResizeObserver(l=>{l.length&&n()});return r.observe(i,{box:s}),()=>{i&&r.unobserve(i)}}else return window.addEventListener("resize",n,!1),()=>{window.removeEventListener("resize",n,!1)}},[n,e,s])}var I=c(95943),A=c(93389),$=c(8285),ot=c(70234),at=c(73583);function it({scaleFactor:t,currentPage:e,totalPageCount:s}){const n=(0,T.$j)(),i=dt(n,t);return(0,a.jsxs)("div",{className:i.footer,children:[(0,a.jsx)("div",{className:i.pageCount,children:(0,a.jsxs)(R.x6,{i18nKey:"reporting.report-footer.page-pagination",children:["Page ",{currentPage:e},"/",{totalPageCount:s}]})}),(0,a.jsx)("div",{className:i.logo,children:(0,a.jsx)("img",{className:i.logoImg,src:lt(),alt:"Report logo"})})]})}function lt(){const t=(0,L.zy)(),s=new URLSearchParams(t.search).get("reportLogo");return s?(0,at.A)(s):ot.xJ}function dt(t,e){return{footer:(0,m.css)({bottom:0,height:t.spacing(4*e),width:"100%",display:"flex",alignItems:"center",marginBottom:t.spacing(1*e)}),pageCount:(0,m.css)({flex:1,textAlign:"center",fontWeight:t.typography.fontWeightMedium,fontSize:`${.85*e}rem`}),logo:(0,m.css)({top:t.spacing(.5*e),right:t.spacing(2+.5*e)}),logoImg:(0,m.css)({maxWidth:t.spacing(3*e),maxHeight:t.spacing(3*e)})}}const ct=it;var B=c(80011),ht=c(33239),ft=c(25229),gt=c(41654),ut=c(18303);function pt(t){const s={timeZone:t.timeZone,format:"YYYY-MM-DD HH:mm:ss Z"},n=(0,B.LE)(t.value.from,s),i=(0,B.LE)(t.value.to,s);return{displayFrom:n,displayTo:i}}const z=(0,u.forwardRef)(({reportTitle:t,dashboardTitle:e,timeRange:s,scaleFactor:n,showTemplateVariables:i,dashboard:r},l)=>{const o=(0,T.$j)(),d=mt(o,n),{displayFrom:h,displayTo:p}=pt(s),g=ht.parse((0,ft.KQ)(Date.now()))?.format("dddd, MMM DD YYYY");return(0,a.jsxs)("div",{ref:l,className:d.header,children:[(0,a.jsxs)("div",{className:d.subHeader,children:[(0,a.jsx)("div",{children:(0,a.jsxs)(R.x6,{i18nKey:"report.report-header.title",children:[{reportTitle:t}," - Generated on ",{generatedOnDate:g}]})}),(0,a.jsx)("div",{className:d.timeRangeBlock,children:(0,a.jsxs)("div",{children:[(0,R.t)("report.report-header.time-range","Data time range:")," ",h,(0,a.jsx)("br",{}),p]})})]}),(0,a.jsx)("div",{className:d.dashboardTitle,children:e}),(0,a.jsx)("hr",{className:d.divider}),i&&(0,a.jsx)("div",{className:d.subHeader,children:(0,a.jsx)(gt.B,{grow:1,wrap:"wrap",children:(0,a.jsx)(ut.v,{dashboard:r})})})]})});function mt(t,e){return{subHeader:(0,m.css)({label:"subheader",display:"flex",fontWeight:t.typography.fontWeightMedium,fontSize:`${.85*e}rem`,paddingTop:t.spacing(2*e)}),timeRangeBlock:(0,m.css)({label:"time-range-block",display:"flex",justifyContent:"flex-end",textAlign:"right",flexGrow:1}),dashboardTitle:(0,m.css)({label:"dashboard-title",fontSize:`${1.7*e}rem`,fontWeight:t.typography.fontWeightMedium}),divider:(0,m.css)({marginTop:0,marginBottom:0}),header:(0,m.css)({paddingBottom:t.spacing(2*e)})}}z.displayName="ReportHeader";const Y=z,E=20;function yt(t,e,s,n){const i=t.slice(),r=[],l=Math.floor(s/(E+I.dU));let o=l;n||(o=l/3);let d=0,h={items:[],h:0};r.push(h);let p=0,g=!1;for(let x=0;x<i.length;x++){const f=i[x],y=f instanceof C.tI,b={x:0,y:d,w:I.cV,h:y?e:g?o-e:o,render:()=>(0,a.jsx)(f.Component,{model:f},f.state.key)};if(y&&(i.splice(x+1,0,...f.state.children),p++),f instanceof A.U&&f.state.repeatedPanels&&f.state.repeatedPanels.length>0){i.splice(x+1,0,...f.state.repeatedPanels);continue}d>=l&&(h.pageBreakAfter=!0,d=0,b.y=0,h={items:[],h:0},r.push(h)),d+=b.h,h.items.push(b),h.h=b.y+b.h,g=y}return r}function xt(t,e,s){const n=t.slice(),i=[],r=Math.floor(s/(E+I.dU));let l=0,o=!1,d={items:[],h:0};i.push(d);const h=vt(n);for(let p=0;p<h.length;p++){const g=h[p],x=g.isRow||!1,f=N(g,l,r,e,o),y=p<h.length-1?N(h[p+1],l,r,e,x):null;let b=Math.max(d.h,f.y+f.h),w=0;x&&y!=null&&(w=Math.max(d.h,y.y-e+1+y.h));const D=h.slice(p+1,h.length);let j=!1;for(const P of D){const v=N(P,l,r,e,o);if(f.y!==v.y)break;if(Math.max(d.h,v.y-e+1+v.h)>r){j=!0;break}}(b>r||x&&w>r||j)&&(d.pageBreakAfter=!0,l=g.y*e,f.y=0,d={items:[],h:0},i.push(d)),d.items.push(f),d.h=Math.max(d.h,f.y+f.h),x?(o=!0,l+=e-1):y!=null&&y.y!==f.y&&(o=!1)}return i}function vt(t){const e=t.slice(),s=[];let n=0,i=0,r=0;for(let l=0;l<e.length;l++){const o=e[l],{y:d}=o.state;if(d>r&&(n=i),r=d,o instanceof A.U&&o.state.repeatedPanels&&o.state.repeatedPanels.length>0){let h=null;const p=e.slice(l+1,e.length);for(const v of p)if(v.state.y!==o.state.y){h=v;break}const{repeatedPanels:g,x,y:f,height:y,width:b}=o.state;let w,D,j=y/g.length,P=b;if(o.getRepeatDirection()==="h"){const v=Math.ceil(g.length/o.getMaxPerRow());j=y/v,P=b/Math.min(o.getMaxPerRow(),g.length)}for(let v=0;v<g.length;v++){const H=g[v];o.getRepeatDirection()==="h"?(w=v%o.getMaxPerRow()*P,D=f+Math.floor(v/o.getMaxPerRow())*j):(w=x,D=f+v*j),s.push({x:w,y:D+n,w:P,h:j,render:()=>(0,a.jsx)(H.Component,{model:H},H.state.key)})}h&&h.state.y<f+y&&(i=Math.max(i,n+y-j))}else{let h=!1;o instanceof C.tI&&(h=!0,e.splice(l+1,0,...o.state.children)),s.push({x:o.state.x,y:o.state.y+n,w:o.state.width,h:o.state.height,render:()=>(0,a.jsx)(o.Component,{model:o},o.state.key),isRow:h})}}return s.sort((l,o)=>l.y-o.y)}function N(t,e,s,n,i){const r={x:t.x,y:t.y*n-e,w:t.w,h:t.h*n,render:t.render};return t.isRow&&(r.h=1),i&&r.h+1>s?r.h=s-1:r.h>s&&(r.h=s),r}function V(t){return{margin:[I.dU,I.dU],containerWidth:t,containerPadding:[0,0],cols:I.cV,rowHeight:E,maxRows:1e4}}function G(t){const{margin:e,containerPadding:s,containerWidth:n,cols:i}=t;return(n-e[0]*(i-1)-s[0]*2)/i}function K(t,e,s){return Number.isFinite(t)?Math.round(e*t+Math.max(0,t-1)*s):t}function Z(t,e,s,n,i){const{margin:r,containerPadding:l,rowHeight:o}=t,d=G(t);return{width:K(n,d,r[0]),height:K(i,o,r[1]),top:Math.round((o+r[1])*s+l[1]),left:Math.round((d+r[0])*e+l[0])}}function Ct(t,e,s,n,i){const{margin:r,cols:l,rowHeight:o,maxRows:d}=t,h=G(t);let p=Math.round((s-r[0])/(h+r[0])),g=Math.round((e-r[1])/(o+r[1]));return p=W(p,0,l-n),g=W(g,0,d-i),{x:p,y:g}}function Tt(t,e,s,n,i,r){const{margin:l,maxRows:o,cols:d,rowHeight:h}=t,p=G(t);let g=Math.round((e+l[0])/(p+l[0])),x=Math.round((s+l[1])/(h+l[1])),f=W(g,0,d-n),y=W(x,0,o-i);return["sw","w","nw"].indexOf(r)!==-1&&(f=W(g,0,d)),["nw","n","ne"].indexOf(r)!==-1&&(y=W(x,0,o)),{w:f,h:y}}function W(t,e,s){return Math.max(Math.min(t,s),e)}const X=794,F=1122,Rt=40,bt=16;function wt({grid:t,dashboardTitle:e,timeRange:s,dashboard:n}){const[i,r]=(0,u.useState)(!1),{scaleFactor:l,isLandscape:o,isSimpleLayout:d,reportTitle:h,showTemplateVariables:p}=jt(),g=(0,T.$j)(),x=It(g,l);Mt(t.state.children);const{children:f}=t.useState(),[y,b]=(0,u.useState)(0),w=(0,u.useRef)(null);if(rt({ref:w,onResize:()=>{const M=w.current;M&&M.offsetHeight!==0&&b(M.offsetHeight)}}),(0,u.useEffect)(()=>(r(!0),C.jh.findDescendents(t,A.U).forEach(M=>{M.isActive||(0,$.sf)(M)}),(0,$.sf)(t)),[t]),!i)return null;let D=o?F:X,j=o?X:F;const P=D*l-2*bt,v=(j-Rt)*l-y;let H=[];return d?H=yt(f,l,v,o):H=xt(f,l,v),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{width:P,visibility:"hidden",position:"absolute",top:0,left:0},children:(0,a.jsx)(Y,{reportTitle:h||e,dashboardTitle:e,timeRange:s,scaleFactor:l,dashboard:n,showTemplateVariables:p,ref:w})}),(0,a.jsx)(a.Fragment,{children:H.map((M,O)=>(0,a.jsxs)("div",{className:x.page,children:[(0,a.jsxs)("div",{className:x.content,children:[(0,a.jsx)(Y,{reportTitle:h||e,dashboardTitle:e,timeRange:s,scaleFactor:l,dashboard:n,showTemplateVariables:p}),(0,a.jsx)("div",{style:Ht(M,P),children:M.items.map((Q,Lt)=>(0,a.jsx)("div",{style:Pt(Q,P),children:Q.render()},Lt))})]},O),(0,a.jsx)(ct,{scaleFactor:l,currentPage:O+1,totalPageCount:H.length}),M.pageBreakAfter&&(0,a.jsx)("div",{style:{pageBreakAfter:"always"}})]},O))})]})}function jt(){const t=(0,L.zy)(),e=new URLSearchParams(t.search),s=parseFloat(e.get("scale")??"");return{scaleFactor:isNaN(s)?1:s,isLandscape:e.get("pdf.landscape")!=="false",isSimpleLayout:e.get("pdf.layout")==="simple",reportTitle:e.get("title"),showTemplateVariables:e.get("pdf.showTemplateVariables")!==null&&e.get("pdf.showTemplateVariables")!=="false"}}function Mt(t){for(const e of t)e instanceof C.tI&&e.state.isCollapsed&&e.onCollapseToggle()}function Pt(t,e){const s=V(e),n=Z(s,t.x,t.y,t.w,t.h);return{top:n.top,left:n.left,width:n.width,height:n.height,position:"absolute"}}function Ht(t,e){const s=V(e),n=Z(s,0,0,I.cV,t.h);return{width:n.width,height:n.height,position:"relative"}}function It(t,e){return{page:(0,m.css)({display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",width:"100%",minHeight:"100vh","&:last-of-type":{marginBottom:t.spacing(2*-1)},padding:"0 "+t.spacing(2*e)}),content:(0,m.css)({flex:1})}}function J({route:t}){const e=(0,tt.sP)(),{dashboard:s,isLoading:n,loadError:i}=e.useState(),{uid:r=""}=(0,L.g)();return(0,u.useEffect)(()=>(e.loadDashboard({uid:r,route:st.Z4.Report}),()=>{e.clearState()}),[e,r,t.routeName]),s?(0,a.jsx)(Dt,{model:s}):(0,a.jsxs)("div",{children:[n&&(0,a.jsx)(q.A,{}),i&&(0,a.jsx)("h2",{children:(0,_.q6)(i)})]})}function Dt({model:t}){const[e,s]=(0,u.useState)(!1),n=t.useState(),i=n.$timeRange.useState(),r=(0,T.of)(St);if((0,u.useEffect)(()=>(s(!0),t.activate()),[t]),!e)return null;const l=n.body;return l instanceof et.D?(0,a.jsx)(C.$L,{scene:t,children:(0,a.jsx)("div",{className:r.canvas,children:(0,a.jsx)("div",{className:r.body,children:(0,a.jsx)(wt,{grid:l.state.grid,dashboardTitle:n.title,timeRange:i,dashboard:t})})})}):(0,a.jsx)(k.F,{title:(0,R.t)("reports.dashbord-report-renderer.title-unsupported-dashboard-layout","Unsupported dashboard layout"),severity:"error"})}function St(){return{canvas:(0,m.css)({label:"canvas",display:"flex",flexDirection:"column",flexBasis:"100%",flexGrow:1}),body:(0,m.css)({label:"body",flexGrow:1,display:"flex",gap:"8px"})}}const Wt=J},60046:(U,S,c)=>{c.d(S,{f:()=>m,g:()=>a});const a=u=>u?m(u)?"file":u.startsWith("http")||u.startsWith("data:")?"url":u.startsWith("#")||u.startsWith("rgb(")||u.startsWith("rgba(")?"color":"file":"url",m=u=>u instanceof File},73583:(U,S,c)=>{c.d(S,{A:()=>u,h:()=>L});var a=c(70234),m=c(60046);const u=R=>(0,m.f)(R)?URL.createObjectURL(R):(0,m.g)(R)==="file"?`${a.Sw}${R}`:R,L=R=>!R||R instanceof File?!0:typeof R=="string"&&R.startsWith("http")}}]);

//# sourceMappingURL=DashboardReportPage.2a353874bd7e44602a87.js.map