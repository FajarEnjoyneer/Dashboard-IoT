"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8758],{70368:(j,p,n)=>{n.d(p,{w:()=>i});var e=n(92745),l=n(79162);function i(o){return o?(0,l.B)(o):{type:"github",title:(0,e.t)("provisioning.get-default-values.title.repository","Repository"),token:"",url:"",branch:"main",generateDashboardPreviews:!1,readOnly:!1,prWorkflow:!0,path:"grafana/",sync:{enabled:!1,target:"instance",intervalSeconds:60}}}},33580:(j,p,n)=>{n.r(p),n.d(p,{default:()=>Q});var e=n(74848),l=n(54148),i=n(92745),o=n(50201),s=n(66404),t=n(89640),m=n(33680),b=n(13791),r=n(96540),y=n(49785),a=n(37386),C=n(43243),d=n(63527),K=n(48767),D=n(32635),k=n(89599),U=n(21285),W=n(77824),G=n(41654),N=n(45861),F=n(83813),H=n(48485),z=n(67170),Y=n(79162),L=n(53247),T=n(91555);function V({register:c}){const g=(0,L.ED)(),x=(0,L.hF)();return(0,e.jsxs)(k.a,{label:(0,i.t)("provisioning.config-form-github-collapse.label-git-hub-features","GitHub features"),isOpen:!0,children:[(0,e.jsx)(a.D,{children:(0,e.jsx)(D.S,{disabled:!x||!g,label:(0,i.t)("provisioning.finish-step.label-enable-previews","Enable dashboard previews in pull requests"),description:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.x6,{i18nKey:"provisioning.finish-step.description-enable-previews",children:"Adds an image preview of dashboard changes in pull requests. Images of your Grafana dashboards will be shared in your Git repository and visible to anyone with repository access."})," ",(0,e.jsx)(s.E,{italic:!0,children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.finish-step.description-image-rendering",children:["Requires image rendering."," ",(0,e.jsx)(t.Y,{variant:"bodySmall",external:!0,href:"https://grafana.com/grafana/plugins/grafana-image-renderer",children:"Set up image rendering"})]})})]}),...c("generateDashboardPreviews")})}),!g&&(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form-github-collapse.label-realtime-feedback","Realtime feedback"),children:(0,e.jsx)(s.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.config-form-github-collapse.description-realtime-feedback",children:[(0,e.jsx)(t.Y,{variant:"bodySmall",href:T.zM,children:"Configure webhooks"})," ","to get instant updates in Grafana as soon as changes are committed. Review and approve changes using pull requests before they go live."]})})})]})}var $=n(70368);const Z=()=>{const c=[{value:"github",label:(0,i.t)("provisioning.config-form.option-github","GitHub")},{value:"local",label:(0,i.t)("provisioning.config-form.option-local","Local")}],g=[{value:"instance",label:(0,i.t)("provisioning.config-form.option-entire-instance","Entire instance")},{value:"folder",label:(0,i.t)("provisioning.config-form.option-managed-folder","Managed folder")}];return[c,g]};function J({data:c}){const[g,x]=(0,z.A)(c?.metadata?.name),{register:u,handleSubmit:X,reset:E,control:O,formState:{errors:f,isDirty:q},setValue:M,watch:_,getValues:w}=(0,y.mN)({defaultValues:(0,$.w)(c?.spec)}),S=!!c?.metadata?.name,[ee,ie]=(0,r.useState)(S),I=(0,l.Zp)(),[P,ne]=_(["type","readOnly"]),[oe,re]=(0,r.useMemo)(()=>Z(),[]),[B,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(x.isSuccess){const v=w();E(v),setTimeout(()=>{I("/admin/provisioning")},300)}},[x.isSuccess,E,w,I]);const se=async v=>{A(!0);const h=(0,Y.t)(v);h.github&&(h.github.token=v.token||c?.spec?.github?.token,h.github.encryptedToken=c?.spec?.github?.encryptedToken),await g(h),A(!1)};return(0,e.jsxs)("form",{onSubmit:X(se),style:{maxWidth:700},children:[(0,e.jsx)(F.F,{onDiscard:E,confirmRedirect:q}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-repository-type","Repository type"),children:(0,e.jsx)(y.xI,{name:"type",control:O,render:({field:{ref:v,onChange:h,...R}})=>(0,e.jsx)(C.G,{options:oe,onChange:te=>h(te?.value),placeholder:(0,i.t)("provisioning.config-form.placeholder-select-repository-type","Select repository type"),disabled:!!c?.spec,...R})})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-title","Title"),description:(0,i.t)("provisioning.config-form.description-title","A human-readable name for the config"),invalid:!!f.title,error:f?.title?.message,children:(0,e.jsx)(d.p,{...u("title",{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")}),placeholder:(0,i.t)("provisioning.config-form.placeholder-my-config","My config")})}),P==="github"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-github-token","GitHub token"),required:!0,error:f?.token?.message,invalid:!!f.token,children:(0,e.jsx)(y.xI,{name:"token",control:O,rules:{required:S?!1:(0,i.t)("provisioning.config-form.error-required","This field is required.")},render:({field:{ref:v,...h}})=>(0,e.jsx)(K.L4,{...h,id:"token",placeholder:(0,i.t)("provisioning.config-form.placeholder-github-token","ghp_yourTokenHere1234567890abcdEFGHijklMNOP"),isConfigured:ee,onReset:()=>{M("token",""),ie(!1)}})})}),(0,e.jsx)(H.c,{}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-repository-url","Repository URL"),error:f?.url?.message,invalid:!!f?.url,description:(0,i.t)("provisioning.config-form.description-repository-url","Enter the GitHub repository URL"),required:!0,children:(0,e.jsx)(d.p,{...u("url",{required:(0,i.t)("provisioning.config-form.error-required","This field is required."),pattern:{value:/^(?:https:\/\/github\.com\/)?[^/]+\/[^/]+$/,message:(0,i.t)("provisioning.config-form.error-valid-github-url","Please enter a valid GitHub repository URL")}}),placeholder:(0,i.t)("provisioning.config-form.placeholder-github-url","https://github.com/username/repo-name")})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-branch","Branch"),children:(0,e.jsx)(d.p,{...u("branch"),placeholder:(0,i.t)("provisioning.config-form.placeholder-branch","main")})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-path","Path"),description:(0,i.t)("provisioning.config-form.description-path","Path to a subdirectory in the Git repository"),children:(0,e.jsx)(d.p,{...u("path")})})]}),P==="local"&&(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-local-path","Local path"),error:f?.path?.message,invalid:!!f?.path,children:(0,e.jsx)(d.p,{...u("path",{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")}),placeholder:(0,i.t)("provisioning.config-form.placeholder-local-path","/path/to/repo")})}),(0,e.jsx)(a.D,{children:(0,e.jsx)(D.S,{...u("readOnly",{onChange:v=>{v.target.checked&&M("prWorkflow",!1)}}),label:(0,i.t)("provisioning.finish-step.label-read-only","Read only"),description:(0,i.t)("provisioning.config-form.description-read-only","Resources can't be modified through Grafana.")})}),(0,e.jsx)(a.D,{children:(0,e.jsx)(D.S,{disabled:ne,...u("prWorkflow"),label:(0,i.t)("provisioning.config-form.label-pr-workflow","Enable pull request option when saving"),description:(0,e.jsx)(i.x6,{i18nKey:"provisioning.finish-step.description-webhooks-enable",children:"Allows users to choose whether to open a pull request when saving changes. If the repository does not allow direct changes to the main branch, a pull request may still be required."})})}),P==="github"&&(0,e.jsx)(V,{register:u}),(0,e.jsxs)(k.a,{label:(0,i.t)("provisioning.config-form.label-automatic-pulling","Automatic pulling"),isOpen:!1,children:[(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-enabled","Enabled"),description:(0,i.t)("provisioning.config-form.description-enabled","Once automatic pulling is enabled, the target cannot be changed."),children:(0,e.jsx)(U.d,{...u("sync.enabled"),id:"sync.enabled"})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-target","Target"),required:!0,error:f?.sync?.target?.message,invalid:!!f?.sync?.target,children:(0,e.jsx)(y.xI,{name:"sync.target",control:O,rules:{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")},render:({field:{ref:v,onChange:h,...R}})=>(0,e.jsx)(W.z,{options:re,onChange:h,disabled:!!c?.status?.sync.state,...R})})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-interval-seconds","Interval (seconds)"),children:(0,e.jsx)(d.p,{...u("sync.intervalSeconds",{valueAsNumber:!0}),type:"number",placeholder:(0,i.t)("provisioning.config-form.placeholder-interval-seconds","60")})})]}),(0,e.jsx)(G.B,{gap:2,children:(0,e.jsx)(N.$n,{type:"submit",disabled:B,children:B?(0,i.t)("provisioning.config-form.button-saving","Saving..."):(0,i.t)("provisioning.config-form.button-save","Save")})})]})}function Q(){const{name:c=""}=(0,l.g)(),g=(0,m.Sw)({name:c}),x=g.isError&&g.error?.status===404;return(0,e.jsx)(b.Y,{navId:"provisioning",pageNav:{text:(0,i.t)("provisioning.edit-repository-page.text.configure-repository","Configure repository"),subTitle:(0,i.t)("provisioning.edit-repository-page.subTitle.configure-repository-storing-resources","Configure a repository for storing your resources.")},children:(0,e.jsx)(b.Y.Contents,{isLoading:g.isLoading,children:x?(0,e.jsxs)(o.p,{message:"Repository config not found",variant:"not-found",children:[(0,e.jsx)(s.E,{element:"p",children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(t.Y,{href:T.mL,children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(J,{data:g.data})})})}},48485:(j,p,n)=>{n.d(p,{c:()=>m});var e=n(74848),l=n(22803),i=n(92745),o=n(63142),s=n(41654),t=n(89640);function m(){const r=(0,o.of)(b);return(0,e.jsxs)("div",{className:r.container,children:[(0,e.jsxs)(s.B,{gap:.5,wrap:"wrap",children:[(0,e.jsx)(i.x6,{i18nKey:"provisioning.token-permissions-info.go-to",children:"Go to"}),(0,e.jsx)(t.Y,{external:!0,href:"https://github.com/settings/personal-access-tokens/new",children:"GitHub Personal Access Tokens"}),(0,e.jsx)(i.x6,{i18nKey:"provisioning.token-permissions-info.and-click",children:"and click"}),(0,e.jsx)("strong",{children:'"Fine-grained token".'}),(0,e.jsx)(i.x6,{i18nKey:"provisioning.token-permissions-info.make-sure",children:"Make sure to include these permissions"}),":"]}),(0,e.jsxs)("ul",{className:r.permissionsList,children:[(0,e.jsxs)("li",{children:["Content: ",(0,e.jsx)("span",{className:r.accessLevel,children:"Read and write"})]}),(0,e.jsxs)("li",{children:["Metadata: ",(0,e.jsx)("span",{className:r.accessLevel,children:"Read only"})]}),(0,e.jsxs)("li",{children:["Pull requests: ",(0,e.jsx)("span",{className:r.accessLevel,children:"Read and write"})]}),(0,e.jsxs)("li",{children:["Webhooks: ",(0,e.jsx)("span",{className:r.accessLevel,children:"Read and write"})]})]})]})}function b(r){return{container:(0,l.css)({marginBottom:r.spacing(1),position:"relative",width:"100%",display:"flex",flexDirection:"column",flex:"1 1 0",padding:r.spacing(r.components.panel.padding)}),permissionsList:(0,l.css)({marginTop:r.spacing(2),marginBottom:r.spacing(1),paddingLeft:r.spacing(3),li:(0,l.css)({marginBottom:r.spacing(1)})}),accessLevel:(0,l.css)({fontFamily:r.typography.fontFamilyMonospace,background:r.colors.background.secondary,borderRadius:r.shape.radius.default,padding:r.spacing(.25,.5)})}}},67170:(j,p,n)=>{n.d(p,{A:()=>i});var e=n(96540),l=n(33680);function i(s){const[t,m]=(0,l.ZL)(),[b,r]=(0,l.hD)(),[y,a]=(0,l.L)();return[(0,e.useCallback)(async d=>(await y({name:s||"new",body:{spec:d}}).unwrap(),s?b({name:s,repository:{metadata:{name:s,finalizers:["cleanup","remove-orphan-resources"]},spec:d}}):t({repository:{metadata:o(d),spec:d}})),[t,s,b,y]),s?r:m,a]}const o=s=>{const t=s.title.toLowerCase().replaceAll(/[^a-z0-9\-_]+/g,"");if(crypto.randomUUID&&t&&t.charAt(0)>="a"&&t.charAt(0)<="z"&&t.replaceAll(/[^a-z]/g,"").length>=3){const m=crypto.randomUUID().substring(0,7);return{name:`${t.substring(0,62-m.length)}-${m}`}}else return{generateName:"r"}}},79162:(j,p,n)=>{n.d(p,{B:()=>i,t:()=>l});const e=o=>{if(o.readOnly)return[];const s=["write"];return o.prWorkflow?[...s,"branch"]:s},l=o=>{const s={type:o.type,sync:o.sync,title:o.title||"",workflows:e(o)};switch(o.type){case"github":s.github={generateDashboardPreviews:o.generateDashboardPreviews,url:o.url||"",branch:o.branch,token:o.token,path:o.path};break;case"local":s.local={path:o.path},s.workflows=s.workflows.filter(t=>t!=="branch");break}return structuredClone(s)},i=o=>structuredClone({...o,...o.github,...o.local,branch:o.github?.branch||"",url:o.github?.url||"",generateDashboardPreviews:o.github?.generateDashboardPreviews||!1,readOnly:!o.workflows.length,prWorkflow:o.workflows.includes("write")})}}]);

//# sourceMappingURL=EditRepositoryPage.5fa0a28051f1ef143cd3.js.map