"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1517,3057],{26225:(W,C,t)=>{t.r(C),t.d(C,{ReportsListPage:()=>pe,default:()=>Be});var e=t(74848),l=t(96540),r=t(92745),F=t(43173),p=t(62061),y=t(41654),K=t(31286),T=t(63527),$=t(30703),M=t(68079),i=t(45861),ce=t(50201),me=t(89640),Q=t(13791),he=t(2989),A=t(73427),k=t(74101),q=t(42939),D=t(68886),R=t(69788),V=t(38362),xe=t(28772),P=t(49785),w=t(6975),_=t(34999),ee=t(8207),te=t(16780),re=t(66404),S=t(37386),ne=t(77824),oe=t(29216),u=t(22803),se=t(63142),ue=t(40279),fe=t(48431),ve=t(13615),G=t(60046),J=t(73583);const je=[{label:"Paste URL",value:"url"},{label:"Upload file",value:"file"},{label:"Custom color",value:"color"}];function ie({name:n,disabled:o,allowedTypes:a=["url","file"]}){const{control:s,register:h,getValues:L,setValue:g,watch:c,formState:{errors:d}}=(0,P.xW)(),[v]=(0,l.useState)(L(n)),j=c(n,v),[U,H]=(0,l.useState)(null),E=U||(0,G.g)(j),b=(0,se.of)(ye);return(0,e.jsxs)(y.B,{gap:2,direction:"column","data-testid":`resource-picker-${n}`,children:[(0,e.jsx)("div",{children:(0,e.jsx)(ne.z,{options:je.filter(m=>a.includes(m.value)),onChange:m=>{H(m),(0,G.g)(v)===m?g(n,v):g(n,"")},disabled:o,className:b.buttonGroup,value:E})}),E==="file"&&(0,e.jsx)(P.xI,{control:s,name:n,render:({field:{onChange:m,ref:O,...X}})=>(0,e.jsxs)("div",{className:(0,u.cx)(b.dropzone,o&&b.disabled),children:[(0,e.jsx)(ue.gH,{...X,readAs:"readAsBinaryString",onFileRemove:o?void 0:()=>g(n,""),options:{disabled:o,multiple:!1,accept:{"image/*":[".jpeg",".jpg",".png"]},onDrop:Z=>{m(Z[0])}}}),!(0,G.f)(j)&&j!==""&&(0,e.jsx)(fe.I,{removeFile:o?void 0:()=>g(n,""),file:{file:new File([j],j),error:null,id:""}})]})}),E==="url"&&(0,e.jsx)(S.D,{invalid:!!d[n],error:d[n]&&String(d[n]?.message),className:b.customField,children:(0,e.jsx)(T.p,{...h(n,{validate:m=>(0,J.h)(m)||"Invalid URL"}),id:n,placeholder:"https://your.site/image.png",disabled:o,"data-testid":`url-field-${n}`})}),E==="color"&&(0,e.jsx)(P.xI,{control:s,name:`branding.${n}`,render:({field:m})=>(0,e.jsx)("div",{className:b.pickerContainer,children:(0,e.jsx)(ve.i,{...m,id:n,placeholder:(0,r.t)("shared.resource-picker.placeholder-select-color","Select color"),disabled:o})})})]})}const ye=n=>({pickerContainer:(0,u.css)({display:"flex",position:"relative"}),dropzone:(0,u.css)({"& > div":{"& > small:first-of-type":{display:"none"}},"& > div:nth-of-type(2)":{"& > span":{"& > span:nth-of-type(2)":{display:"none"}}}}),colorValue:(0,u.css)({marginLeft:n.spacing(1)}),buttonGroup:(0,u.css)({marginBottom:n.spacing(2)}),disabled:(0,u.css)({div:{cursor:"not-allowed"}}),customField:(0,u.css)({marginTop:n.spacing(-2)})});var Re=t(43910);const Ce=n=>n.startsWith("http")?(0,Re.nB)(n):!0,ae=({url:n,altText:o,width:a="200px"})=>{const s=(0,se.IS)(Pe);return n?(0,e.jsx)("div",{className:(0,u.cx)(s.wrapper,(0,u.css)({width:a})),children:Ce(n)?(0,e.jsx)("img",{src:n,className:s.img,alt:o}):(0,r.t)("reporting.image-preview.invalid-image","Invalid image")}):null},Pe=n=>({wrapper:(0,u.css)({padding:n.spacing.sm,border:`1px solid ${n.colors.border3}`,borderRadius:n.border.radius.sm,marginBottom:n.spacing.md}),img:(0,u.css)({width:"100%"})});var f=t(70234);const Le=()=>{const{register:n,control:o,watch:a}=(0,P.xW)(),s=a("branding.reportLogoUrl")||f.xJ,h=a("branding.emailLogoUrl")||f.D3,L=a("branding.emailFooterMode"),g=A.TP.hasPermission(R.AccessControlAction.ReportingSettingsWrite),c=[{label:(0,r.t)("reporting.settings.sent-by-footer-label","Sent By"),value:R.FooterMode.SentBy},{label:(0,r.t)("reporting.settings.none-footer-label","None"),value:R.FooterMode.None}];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.n,{label:(0,r.t)("reporting.settings.attachment-settings-fieldset-label","Attachment settings"),disabled:!g,children:(0,e.jsxs)(y.B,{direction:"column",gap:2,children:[(0,e.jsx)(re.E,{element:"h4",children:(0,e.jsx)(r.x6,{i18nKey:"reporting.settings.pdf-header",children:"PDF"})}),(0,e.jsxs)(y.B,{direction:"column",gap:1,children:[(0,e.jsx)(S.D,{htmlFor:"branding.reportLogoUrl",label:(0,r.t)("reporting.settings.report-logo-url-field-label","Company logo URL"),description:(0,r.t)("reporting.settings.report-logo-url-field-description","The logo will be displayed in the document footer. Supported formats: png, jpg, gif."),children:(0,e.jsx)(ie,{name:"branding.reportLogoUrl"})}),(0,e.jsx)(ae,{url:s===f.xJ?f.xJ:(0,J.A)(s),width:"60px",altText:(0,r.t)("reporting.settings.report-logo-image-preview-altText","Company logo preview")}),F.$.featureToggles.newPDFRendering&&(0,e.jsx)(P.xI,{render:({field:d})=>(0,e.jsx)(oe.w,{description:(0,r.t)("reporting.settings.pdf-theme-picker-description","The theme will be applied to the PDF attached to the report."),selectedTheme:d.value,onChange:d.onChange}),control:o,name:"pdfTheme"})]}),(0,e.jsx)(re.E,{element:"h4",children:(0,e.jsx)(r.x6,{i18nKey:"reporting.settings.embedded-image-header",children:"Embedded image"})}),(0,e.jsx)(y.B,{direction:"column",gap:1,children:(0,e.jsx)(P.xI,{render:({field:d})=>(0,e.jsx)(oe.w,{description:(0,r.t)("reporting.settings.embedded-image-theme-picker-description","The theme will be applied to the dashboard image embedded in the email."),selectedTheme:d.value,onChange:d.onChange}),control:o,name:"embeddedImageTheme"})})]})}),(0,e.jsxs)(te.n,{label:(0,r.t)("reporting.settings.email-branding-fieldset-label","Email branding"),disabled:!g,children:[(0,e.jsx)(S.D,{htmlFor:"emailLogoUrl",label:(0,r.t)("reporting.settings.email-logo-url-field-label","Company logo URL"),description:(0,r.t)("reporting.settings.email-logo-url-field-description","The logo will be displayed in the email header. Supported formats: png, jpg, gif."),children:(0,e.jsx)(ie,{name:"branding.emailLogoUrl"})}),(0,e.jsx)(ae,{url:h===f.D3?f.D3:(0,J.A)(h),altText:(0,r.t)("reporting.settings.email-logo-image-preview-altText","Company logo preview")}),(0,e.jsx)(S.D,{label:(0,r.t)("reporting.settings.email-footer-field-label","Email footer"),children:(0,e.jsx)(P.xI,{name:"branding.emailFooterMode",render:({field:{ref:d,...v}})=>(0,e.jsx)(ne.z,{...v,options:c}),control:o})}),L===R.FooterMode.SentBy&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(S.D,{label:(0,r.t)("reporting.settings.footer-link-field-label","Footer link text"),children:(0,e.jsx)(T.p,{...n("branding.emailFooterText"),id:"emailFooterText",placeholder:"Grafana",type:"text"})}),(0,e.jsx)(S.D,{label:(0,r.t)("reporting.settings.footer-link-url-field-label","Footer link URL"),children:(0,e.jsx)(T.p,{...n("branding.emailFooterLink"),id:"emailFooterLink",placeholder:"https://your.site",type:"url"})})]})]})]})},Fe=({onClose:n})=>{const{data:o,isLoading:a}=(0,D.TM)(),s=()=>a?(0,e.jsx)(w._,{text:(0,r.t)("share-report.settings.loading","Loading settings...")}):o?F.$.rendererAvailable?(0,e.jsx)(Te,{settings:o,onClose:n}):(0,e.jsx)(V.c,{variant:"error"}):(0,e.jsx)(_.F,{title:(0,r.t)("reporting.settings.no-data","No settings data available"),severity:"warning"});return(0,e.jsx)(ee._,{title:(0,r.t)("reporting.settings.drawer-title","Report template settings"),subtitle:(0,r.t)("reporting.settings.settings-subtitle","Manage report template settings."),size:"md",onClose:n,children:s()})},Te=({settings:n,onClose:o})=>{const[a,{isLoading:s}]=(0,D.Bn)(),h=A.TP.hasPermission(R.AccessControlAction.ReportingSettingsWrite),L=async d=>{await a(d).unwrap(),o()},g=(0,P.mN)({defaultValues:{embeddedImageTheme:R.Theme.Dark,pdfTheme:R.Theme.Light,...n,branding:{emailFooterMode:R.FooterMode.None,emailFooterText:"",emailFooterLink:"",emailLogoUrl:"",reportLogoUrl:"",...n?.branding}}}),{handleSubmit:c}=g;return(0,e.jsx)(P.Op,{...g,children:(0,e.jsxs)("form",{onSubmit:c(L),children:[(0,e.jsx)(Le,{}),(0,e.jsx)(i.$n,{type:"submit",disabled:!h||s,icon:s?"spinner":void 0,children:s?(0,e.jsx)(r.x6,{i18nKey:"reporting.settings.saving-button",children:"Saving..."}):(0,e.jsx)(r.x6,{i18nKey:"reporting.settings.save-button",children:"Save"})})]})})};var be=t(8011),De=t(52237),I=t(16904),Y=t(47006),Se=t(2556);const Ee=(0,l.lazy)(()=>t.e(1661).then(t.bind(t,81661)));function Ie(){const[n,o]=(0,l.useState)(!1),[a,s]=(0,k.z)(),h=Number(a.get("reportId")),{data:L,isLoading:g,isFetching:c,isError:d}=(0,D.qJ)(h,{skip:!h}),v=!!h,j=()=>{s({reportView:null,reportId:null})},U=()=>{n?(0,Se.p)(j,Y.vc.ReportPage):j()};return(0,e.jsx)(ee._,{title:v?(0,r.t)("reporting.update-report.title","Update report"):(0,r.t)("reporting.create-report.title","Create new report"),size:"md",onClose:U,children:(0,e.jsx)(y.B,{direction:"column",flex:1,height:"100%",children:g?(0,e.jsx)(w._,{text:(0,r.t)("reporting.create-report.loading-report","Loading report...")}):(0,e.jsx)(e.Fragment,{children:d?(0,e.jsx)(_.F,{title:(0,r.t)("reporting.create-report.alert-title","Error loading report"),severity:"error"}):(0,e.jsx)(l.Suspense,{fallback:(0,e.jsx)(w._,{text:(0,r.t)("share-report.loading-report-form","Loading report form...")}),children:(0,e.jsx)(Y.oZ,{renderingFormContext:{renderingContext:Y.vc.ReportPage},children:(0,e.jsx)(Ee,{report:h?L:void 0,setIsDirty:o,onSuccess:j,defaultOpenSections:{[I.P.SelectDashboards]:!0,[I.P.Schedule]:!0,[I.P.EmailConfiguration]:v,[I.P.Recipients]:!0,[I.P.Attachments]:v},headerActions:c&&(0,e.jsx)(M.y,{})})})})})})})}var le=t(95955),Ue=t(76686),de=t(9229);const pe=()=>{const[n,o]=(0,l.useState)(""),[a,s]=(0,k.z)(),h=a.get("reportView")==="settings",L=Number(a.get("reportId")),g=a.get("reportView")==="new"||!!L,c=F.$.featureToggles.newShareReportDrawer,{data:d,isLoading:v,isFetching:j}=(0,D.B)(),[U,{isLoading:H}]=(0,D.iJ)(),[E,{isLoading:b}]=(0,D.yi)(),m=d?.map(x=>(0,de.zn)(x))||[],O=()=>{s({reportView:"new"})},X=x=>{U(x.id)},Z=async x=>{const z=(0,de.Jh)(x);E(z)},Me=()=>{s({reportView:"settings"})},Ae=()=>{s({reportView:null})},Oe=()=>{const{rendererAvailable:x}=F.$,z=(0,Ue.D)(),Ne=A.TP.hasPermission(R.AccessControlAction.ReportingCreate),N=x&&Ne,ge=(0,e.jsx)(xe.R,{reports:m,deleteReport:X,updateReport:Z,filter:n,redirectTo:c?B=>`${f.lb}?reportId=${B.id}`:B=>`${f.lb}/confirm/${B.id}`});return(0,p.a)("reports.creation")?(0,e.jsxs)(e.Fragment,{children:[!x&&(0,e.jsx)(V.c,{variant:"error"}),x&&z!==null&&z<3&&(0,e.jsx)(V.E,{}),(0,q.z5)()&&(0,e.jsx)(he.Iz,{featureId:"reporting",eventVariant:"trial",featureName:"reporting",text:(0,r.t)("reports.reports-list-page.render-list.text-create-unlimited-reports-during-trial-grafana","Create unlimited reports during your trial of Grafana Pro.")}),m.length>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"page-action-bar",children:(0,e.jsxs)(y.B,{direction:{xs:"column",md:"row"},justifyContent:"space-between",flex:1,children:[(0,e.jsx)(K.a,{maxWidth:56,width:"100%",children:(0,e.jsx)(T.p,{placeholder:(0,r.t)("reports.reports-list-page.render-list.placeholder-search-reports-report-dashboard-recipients","Search reports by report name, dashboard name or recipients"),prefix:(0,e.jsx)($.I,{name:"search"}),onChange:B=>o(B.target.value)})}),(0,e.jsxs)(y.B,{alignItems:"center",children:[(b||H||j)&&(0,e.jsx)(M.y,{}),c?(0,e.jsx)(i.$n,{variant:"primary",onClick:O,disabled:!N,icon:"plus",children:(0,e.jsx)(r.x6,{i18nKey:"reports.reports-list-page.render-list.create-a-new-report",children:"Create a new report"})}):(0,e.jsx)(i.z9,{variant:"primary",href:f.km,disabled:!N,icon:"plus",children:(0,e.jsx)(r.x6,{i18nKey:"reports.reports-list-page.render-list.create-a-new-report",children:"Create a new report"})})]})]})}),ge]}):x&&((0,q.z5)()?(0,e.jsx)(be.ReportUpgradeContent,{action:{text:(0,r.t)("reports.reports-list-page.render-list.text.create-report","Create report"),link:c?void 0:f.km,onClick:c?O:void 0}}):(0,e.jsx)(ce.p,{variant:"call-to-action",button:c?(0,e.jsx)(i.$n,{disabled:!N,onClick:O,icon:"plus",size:"lg","data-testid":le.Tp.components.ReportingListPage.createButton,children:(0,e.jsx)(r.x6,{i18nKey:"reporting.page.empty-button",children:"Create report"})}):(0,e.jsx)(i.z9,{disabled:!N,href:f.km,icon:"plus",size:"lg","data-testid":le.Tp.components.ReportingListPage.createButton,children:(0,e.jsx)(r.x6,{i18nKey:"reporting.page.empty-button",children:"Create report"})}),message:(0,r.t)("reporting.page.empty-title","There are no reports created yet"),children:(0,e.jsxs)(r.x6,{i18nKey:"reporting.page.empty-pro-tip",children:["Create a report from any existing dashboards."," ",(0,e.jsx)(me.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/dashboards/create-reports/",children:"Learn more"})]})}))]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(De.o,{message:`Creating new reports is not available with an expired license.
              Existing reports continue to be processed but you need to update your license to create a new one.`}),m.length>0&&ge]})},ze=()=>{const x=A.TP.hasPermission(R.AccessControlAction.ReportingSettingsRead);return(0,e.jsx)(i.$n,{icon:"cog",variant:"secondary",onClick:Me,disabled:!x,children:(0,e.jsx)(r.x6,{i18nKey:"reporting.page.settings-button",children:"Report settings"})})};return(0,e.jsxs)(Q.Y,{navId:"reports",subTitle:"Manage automatically generated PDF reports from any dashboards and have Grafana email them to interested parties.",actions:ze(),children:[(0,e.jsx)(Q.Y.Contents,{isLoading:v,children:Oe()}),h&&(0,e.jsx)(Fe,{onClose:Ae}),g&&c&&(0,e.jsx)(Ie,{})]})},Be=pe},8011:(W,C,t)=>{t.r(C),t.d(C,{ReportUpgradeContent:()=>T,default:()=>M});var e=t(74848),l=t(22803),r=t(92745),F=t(63142),p=t(13791),y=t(2989);const K=()=>{const i=(0,F.of)($);return(0,e.jsxs)(p.Y,{navId:"reports",subTitle:"Manage automatically generated PDF reports from any dashboards and have Grafana email them to interested parties.",children:[(0,e.jsx)("div",{className:i.box,children:(0,e.jsx)(y.Iz,{featureName:"reporting",featureId:"reporting"})}),(0,e.jsx)(p.Y.Contents,{className:i.contents,children:(0,e.jsx)(T,{})}),(0,e.jsx)("div",{className:i.spacer})]})},T=({action:i})=>(0,e.jsx)(y.El,{featureName:"reporting",description:(0,r.t)("reports.report-upgrade-content.description-reporting-allows-automatically-generate-dashboards-grafana","Reporting allows you to automatically generate PDFs from any of your dashboards and have Grafana email them to interested parties on a schedule."),listItems:["Customize your exact layout and orientation","Personalize with your unique branding","Specify permissions for users across your company","Choose to send a report at custom intervals"],featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/reporting/",image:"reporting-email.png",caption:"Create reports to share your SLO performance, business metrics, cost and utilization metrics or anything else you can express in a Grafana dashboard.",action:i}),$=i=>({contents:(0,l.css)({"&.page-body":{flex:0}}),spacer:(0,l.css)({flex:1}),box:(0,l.css)({[i.breakpoints.up("sm")]:{padding:i.spacing(0,1)},[i.breakpoints.up("md")]:{padding:i.spacing(0,2)}})}),M=K},60046:(W,C,t)=>{t.d(C,{f:()=>l,g:()=>e});const e=r=>r?l(r)?"file":r.startsWith("http")||r.startsWith("data:")?"url":r.startsWith("#")||r.startsWith("rgb(")||r.startsWith("rgba(")?"color":"file":"url",l=r=>r instanceof File},73583:(W,C,t)=>{t.d(C,{A:()=>r,h:()=>F});var e=t(70234),l=t(60046);const r=p=>(0,l.f)(p)?URL.createObjectURL(p):(0,l.g)(p)==="file"?`${e.Sw}${p}`:p,F=p=>!p||p instanceof File?!0:typeof p=="string"&&p.startsWith("http")}}]);

//# sourceMappingURL=ReportsListPage.7abd46f6fdc1a4fdf728.js.map