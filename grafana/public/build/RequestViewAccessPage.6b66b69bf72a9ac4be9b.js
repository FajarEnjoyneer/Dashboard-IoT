"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4351,5318],{58102:(y,m,s)=>{s.d(m,{GU:()=>f,YO:()=>v,qm:()=>l});var e=s(74848),i=s(22803),p=s(96540),_=s(92745),g=s(63142),c=s(92948),E=s(10388);const l=({children:n,enterAnimation:u=!0})=>{const h=(0,g.of)(v);return(0,e.jsx)("div",{className:(0,i.cx)(h.loginInnerBox,u&&h.enterAnimation),children:n})},f=({children:n,branding:u,isChangingPassword:h})=>{const d=(0,g.of)(v),[o,a]=(0,p.useState)(!1),t=u?.loginSubtitle??c.M.GetLoginSubTitle(),r=u?.loginTitle??c.M.LoginTitle,x=u?.loginBoxBackground||c.M.LoginBoxBackground(),D=u?.loginLogo,T=u?.hideEdition??c.M.HideEdition;return(0,p.useEffect)(()=>a(!0),[]),(0,e.jsxs)(c.M.LoginBackground,{className:(0,i.cx)(d.container,o&&d.loginAnim,u?.loginBackground),children:[(0,e.jsx)("div",{className:d.loginMain,children:(0,e.jsxs)("div",{className:(0,i.cx)(d.loginContent,x,"login-content-box"),children:[(0,e.jsxs)("div",{className:d.loginLogoWrapper,children:[(0,e.jsx)(c.M.LoginLogo,{className:d.loginLogo,logo:D}),(0,e.jsx)("div",{className:d.titleWrapper,children:h?(0,e.jsx)("h1",{className:d.mainTitle,children:(0,e.jsx)(_.x6,{i18nKey:"login.layout.update-password",children:"Update your password"})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h1",{className:d.mainTitle,children:r}),t&&(0,e.jsx)("h3",{className:d.subTitle,children:t})]})})]}),(0,e.jsx)("div",{className:d.loginOuterBox,children:n})]})}),u?.hideFooter?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(E.wi,{hideEdition:T,customLinks:u?.footerLinks})]})},b=(0,i.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,v=n=>({loginMain:(0,i.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,i.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,i.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,i.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,i.css)({width:"100%",maxWidth:60,marginBottom:n.spacing(2),[n.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,i.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:n.spacing(3)}),titleWrapper:(0,i.css)({textAlign:"center"}),mainTitle:(0,i.css)({fontSize:22,[n.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,i.css)({fontSize:n.typography.size.md,color:n.colors.text.secondary}),loginContent:(0,i.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:n.shape.radius.default,padding:n.spacing(2,0),opacity:0,[n.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[n.breakpoints.up("sm")]:{minHeight:n.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,i.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,i.css)({padding:n.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[n.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,i.css)({[n.transitions.handleMotion("no-preference")]:{animation:`${b} ease-out 0.2s`}})})},24359:(y,m,s)=>{s.r(m),s.d(m,{default:()=>D});var e=s(74848),i=s(22803),p=s(49785),_=s(54148),g=s(51898),c=s(92745),E=s(63142),l=s(37386),f=s(63527),b=s(45861),v=s(68079),n=s(58102),u=s(70958),h=s(24313),d=s(54351),o=s(18393);const a=(0,i.css)({justifyContent:"center",width:"100%"}),t=g.Tp.pages.RequestViewAccess,r=()=>{const T=(0,E.of)(x),{accessToken:L=""}=(0,_.g)(),[{error:P}]=(0,u.s)(),[R,{isLoading:I,isSuccess:M}]=(0,d.useRequestAccessMutation)(),{register:B,handleSubmit:U,formState:{errors:O},reset:C}=(0,p.mN)({mode:"onSubmit"}),A=(0,o.Z)(P?String(P):void 0),S=async W=>{await R({accessToken:L,email:W.email}).unwrap(),C()};return(0,e.jsx)(n.GU,{branding:{loginTitle:A.title,loginSubtitle:A.description,hideFooter:!0},children:(0,e.jsx)(n.qm,{children:(0,e.jsxs)("form",{className:a,onSubmit:U(S),children:[(0,e.jsx)(l.D,{label:(0,c.t)("public-dashboards.request-view-access-page.label-email","Email"),error:O?.email?.message,invalid:!!O.email,children:(0,e.jsx)(f.p,{"data-testid":t.recipientInput,placeholder:(0,c.t)("public-dashboards.request-view-access-page.placeholder-email","email"),autoCapitalize:"none",...B("email",{required:(0,c.t)("public-dashboards.request-view-access-page.register-required-email","Email is required"),pattern:{value:h._l,message:(0,c.t)("public-dashboards.request-view-access-page.register-pattern-invalid-email","Invalid email")}})})}),(0,e.jsxs)(b.$n,{"data-testid":t.submitButton,disabled:M,type:"submit",className:a,children:[M?(0,c.t)("public-dashboards.request-view-access-page.access-requested","Access requested"):(0,c.t)("public-dashboards.request-view-access-page.request-access","Request access")," ",I&&(0,e.jsx)(v.y,{className:T.loadingSpinner})]})]})})})},x=T=>({loadingSpinner:(0,i.css)({marginLeft:T.spacing(1)})}),D=r},54351:(y,m,s)=>{s.r(m),s.d(m,{default:()=>d,useConfirmAccessMutation:()=>h,useGetActiveUserDashboardsQuery:()=>n,useGetActiveUsersQuery:()=>u,useRequestAccessMutation:()=>v});var e=s(92745),i=s(68143),p=s(43173),_=s(6890),g=s(64762),c=s(62905),E=s(18393);function l(o){return typeof o=="object"&&o!=null&&"error"in o}function f(o){return l(o)&&(0,i.NF)(o.error)}const b=c.Sm.injectEndpoints({endpoints:o=>({requestAccess:o.mutation({query:a=>({url:"/public/dashboards/share/request-access",method:"POST",body:a})}),confirmAccess:o.mutation({query:({magicLinkToken:a,accessToken:t})=>({url:`/public/dashboards/share/${a}`,method:"POST",manageError:c.Ht}),async onQueryStarted({accessToken:a},{dispatch:t,queryFulfilled:r}){try{await r,t((0,_.dx)((0,g.tZ)((0,e.t)("public-dashboard.email-sharing.success-confirm-access","Access confirmed!")))),window.location.assign(p.$.appSubUrl+`public-dashboards/${a}`)}catch(x){if(f(x)){const{data:{messageId:D}}=x.error;D&&Object.values(E.b5).includes(D)&&window.location.assign(p.$.appSubUrl+`public-dashboards/${a}/request-access?error=${D}`)}}}}),addRecipient:o.mutation({query:({recipient:a,uid:t})=>({url:`/public-dashboards/${t}/share/recipients`,method:"POST",body:{recipient:a}}),async onQueryStarted(a,{dispatch:t,queryFulfilled:r}){await r,t((0,_.dx)((0,g.tZ)((0,e.t)("public-dashboard.email-sharing.success-send-recipient-invitation","The email invitation has been sent."))))},invalidatesTags:(a,t,{dashboardUid:r})=>[{type:"PublicDashboard",id:r}]}),deleteRecipient:o.mutation({query:({uid:a,recipientUid:t})=>({url:`/public-dashboards/${a}/share/recipients/${t}`,method:"DELETE"}),async onQueryStarted({recipientEmail:a},{dispatch:t,queryFulfilled:r}){await r,t((0,_.dx)((0,g.tZ)((0,e.t)("public-dashboard.email-sharing.success-revoke-access-title","Access Revoked"),(0,e.t)("public-dashboard.email-sharing.success-revoke-access-description","You have successfully revoked access for {{recipientEmail}}.",{recipientEmail:a}))))},invalidatesTags:(a,t,{dashboardUid:r})=>[{type:"PublicDashboard",id:r},"UsersWithActiveSessions","ActiveUserDashboards"]}),reshareAccessToRecipient:o.mutation({query:({uid:a,recipientUid:t})=>({url:`/public-dashboards/${a}/share/recipients/${t}`,method:"PATCH"}),async onQueryStarted(a,{dispatch:t,queryFulfilled:r}){await r,t((0,_.dx)((0,g.tZ)((0,e.t)("public-dashboard.email-sharing.success-resend-recipient-invitation","The email invitation has been resent."))))}}),getActiveUsers:o.query({query:()=>({url:"/public-dashboards/share/users?status=active"}),providesTags:["UsersWithActiveSessions"]}),getActiveUserDashboards:o.query({query:a=>({url:`/public-dashboards/share/users/${a}/dashboards?status=active`}),providesTags:(a,t,r)=>[{type:"ActiveUserDashboards",id:r}]}),revokeAllAccess:o.mutation({query:({email:a})=>({url:`/public-dashboards/share/users/${a}`,method:"DELETE"}),async onQueryStarted({email:a},{dispatch:t,queryFulfilled:r}){await r,t((0,_.dx)((0,g.tZ)((0,e.t)("public-dashboard.email-sharing.success-revoke-all-accesses-title","Access Revoked"),(0,e.t)("public-dashboard.email-sharing.success-revoke-all-accesses-description","{{email}}'s access to all public dashboards has been successfully removed.",{email:a}))))},invalidatesTags:["UsersWithActiveSessions"]})}),overrideExisting:!0}),{useRequestAccessMutation:v,useGetActiveUserDashboardsQuery:n,useGetActiveUsersQuery:u,useConfirmAccessMutation:h}=b,d=b},18393:(y,m,s)=>{s.d(m,{Z:()=>E,b5:()=>e});var e=(l=>(l.NOT_FOUND_MAGIC_LINK="publicdashboards.magicLinkNotFound",l.EXPIRED_MAGIC_LINK="publicdashboards.magicLinkExpired",l))(e||{}),i=(l=>(l.INTERNAL_SERVER_ERROR="publicdashboards.internalServerError",l.INVALID_SESSION="publicdashboards.invalidSession",l.EXPIRED_SESSION="publicdashboards.sessionExpired",l))(i||{});const p={title:"Request access",description:"You'll receive an email with a one-time link."},_="Something went wrong",g="To request access to the dashboard again, enter your email. You'll receive an email with a one-time link.",c={"publicdashboards.internalServerError":_,"publicdashboards.magicLinkNotFound":"This link has expired or already been used","publicdashboards.magicLinkExpired":"This magic link has expired","publicdashboards.invalidSession":"You no longer have access","publicdashboards.sessionExpired":"Your access has expired"},E=l=>l?{title:c[String(l)]||_,description:g}:p}}]);

//# sourceMappingURL=RequestViewAccessPage.6b66b69bf72a9ac4be9b.js.map