"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2212],{19192:(b,I,e)=>{e.d(I,{A:()=>d});var s=e(74848),M=e(22803),m=e(51898),A=e(92745),P=e(30703),x=e(34999),v=e(45861),y=e(43951);const g=(0,M.css)({textAlign:"center"}),f=(0,M.css)({maxWidth:"700px",margin:"0 auto"}),d=({title:r,buttonIcon:c,buttonLink:h,buttonTitle:t,buttonDisabled:O,onClick:U,proTip:D,proTipLink:B,proTipLinkTitle:C,proTipTarget:L,infoBox:o,infoBoxTitle:n})=>{const u=()=>(0,s.jsxs)(s.Fragment,{children:[D?(0,s.jsxs)("span",{children:[(0,s.jsx)(P.I,{name:"rocket"}),(0,s.jsxs)(A.x6,{i18nKey:"empty-list-cta.pro-tip",children:["ProTip: ",{proTip:D}]}),B&&(0,s.jsx)("a",{href:B,target:L,className:"text-link",children:C})]},"proTipFooter"):"",o?(0,s.jsx)(x.F,{severity:"info",title:n??"",className:f,children:(0,s.jsx)("div",{dangerouslySetInnerHTML:o})}):""]}),E=u()?"":(0,M.css)({marginBottom:"20px"}),j=h?v.z9:v.$n,R=(0,s.jsx)(j,{size:"lg",onClick:U,href:h,icon:c,className:E,"data-testid":m.Tp.components.CallToActionCard.buttonV2(t),disabled:O,children:t});return(0,s.jsx)(y.c,{className:g,message:r,footer:u(),callToActionElement:R})}},99929:(b,I,e)=>{e.d(I,{Y:()=>y});var s=e(74848),M=e(96540),m=e(41053),A=e(73427),P=e(11257),x=e(59812),v=e(34418);const y=({teamId:g,roleOptions:f,disabled:l,roles:d,onApplyRoles:r,pendingRoles:c,apply:h=!1,maxWidth:t,width:O,isLoading:U})=>{const[{loading:D,value:B=d||[]},C]=(0,m.A)(async()=>{try{if(d)return d;if(h&&c?.length)return c;if(A.TP.hasPermission(P.w.ActionTeamsRolesList)&&g>0)return await(0,v.xN)(g)}catch(n){console.error("Error loading options",n)}return[]},[g,c,d]);(0,M.useEffect)(()=>{C()},[C]);const L=async n=>{h?r&&r(n):(await(0,v.G3)(n,g),await C())},o=A.TP.hasPermission(P.w.ActionTeamsRolesAdd)&&A.TP.hasPermission(P.w.ActionTeamsRolesRemove);return(0,s.jsx)(x.n,{apply:h,onRolesChange:L,roleOptions:f,appliedRoles:B,isLoading:D||U,disabled:l,basicRoleDisabled:!0,canUpdateRoles:o,maxWidth:t,width:O})}},99686:(b,I,e)=>{e.d(I,{P:()=>f,o:()=>g});var s=e(2543),M=e.n(s),m=e(96540),A=e(45214),P=e(24705),x=e(73427),v=e(11257),y=e(34418);const g=l=>{const[d,r]=(0,m.useState)(l),{value:c=[]}=(0,P.A)(async()=>x.TP.licensedAccessControlEnabled()&&x.TP.hasPermission(v.w.ActionRolesList)?(0,y.RL)(d):Promise.resolve([]),[d]);return[{roleOptions:c},r]},f=l=>{const[d,r]=(0,m.useState)({});return(0,A.A)(()=>{if(!x.TP.licensedAccessControlEnabled()||!x.TP.hasPermission(v.w.ActionRolesList))return;const c=Object.keys(d).map(t=>typeof t=="number"?t:parseInt(t,10)),h=(0,s.difference)(l,c);Promise.all(h.map(t=>(0,y.RL)(t).then(O=>[t,O]))).then(t=>{r({...d,...Object.fromEntries(t)})})},[l]),d}},81395:(b,I,e)=>{e.r(I),e.d(I,{default:()=>Pe});var s=e(74848),M=e(25508),m=e(96540),A=e(54148),P=e(16817),x=e(62061),v=e(13791),y=e(2989),g=e(65642),f=e(84057),l=e(15130),d=e(11257),r=e(52763),c=e(22803),h=e(71468),t=e(92745),O=e(45861),U=e(30703),D=e(45967),B=e(97095),C=e(18027),L=e(63527),o=e(63142),n=e(63722),u=e(15840),E=e(19192),j=e(42939),R=e(77174);const X=a=>a.groups,N=(a,i)=>a.team.uid===i?a.team:null;function z(a){return{groups:X(a.team)}}const F={loadTeamGroups:R.aK,addTeamGroup:R.It,removeTeamGroup:R.nC},Y=(0,h.connect)(z,F),W="Sync LDAP, OAuth or SAML groups with your Grafana teams.";class ee extends m.PureComponent{constructor(i){super(i),this.onToggleAdding=()=>{this.setState({isAdding:!this.state.isAdding})},this.onNewGroupIdChanged=p=>{this.setState({newGroupId:p.currentTarget.value})},this.onAddGroup=p=>{p.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})},this.onRemoveGroup=p=>{this.props.removeTeamGroup(p.groupId)},this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(i){const{isReadOnly:p}=this.props;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:i.groupId}),(0,s.jsx)("td",{style:{width:"1%"},children:(0,s.jsx)(O.$n,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(i),disabled:p,"aria-label":(0,t.t)("teams.team-group-sync.aria-label-remove","Remove group {{groupName}}",{groupName:i.groupId}),children:(0,s.jsx)(U.I,{name:"times"})})})]},i.groupId)}render(){const{isAdding:i,newGroupId:p}=this.state,{groups:T,isReadOnly:S}=this.props,K=te();return(0,s.jsxs)("div",{children:[(0,j.z5)()&&(0,s.jsx)(y.Iz,{featureId:"team-sync",eventVariant:"trial",featureName:"team sync",text:(0,t.t)("teams.team-group-sync.team-sync-upgrade","Add a group to enable team sync for free during your trial of Grafana Pro")}),(0,s.jsxs)("div",{className:"page-action-bar",children:[(!(0,j.z5)()||T.length>0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"page-sub-heading",children:(0,s.jsx)(t.x6,{i18nKey:"teams.team-group-sync.external-group-sync",children:"External group sync"})}),(0,s.jsx)(D.m,{placement:"auto",content:W,children:(0,s.jsx)(U.I,{className:(0,c.cx)(K.icon,"page-sub-heading-icon"),name:"question-circle"})})]}),(0,s.jsx)("div",{className:"page-action-bar__spacer"}),T.length>0&&(0,s.jsx)(O.$n,{onClick:this.onToggleAdding,icon:"plus",disabled:S,children:(0,s.jsx)(t.x6,{i18nKey:"teams.team-group-sync.add-group-button",children:"Add group"})})]}),(0,s.jsx)(n.a,{in:i,children:(0,s.jsxs)("div",{className:"cta-form",children:[(0,s.jsx)(u.J,{onClick:this.onToggleAdding}),(0,s.jsx)("form",{onSubmit:this.onAddGroup,children:(0,s.jsxs)(B.C,{children:[(0,s.jsx)(C.I,{label:(0,t.t)("teams.team-group-sync.label-add-external-group","Add external group"),tooltip:(0,t.t)("teams.team-group-sync.tooltip-add-external-group","LDAP group example: {{example}}",{example:"cn=users,ou=groups,dc=grafana,dc=org"}),children:(0,s.jsx)(L.p,{type:"text",id:"add-external-group",placeholder:"",value:p,onChange:this.onNewGroupIdChanged,disabled:S})}),(0,s.jsx)(O.$n,{type:"submit",disabled:S||!this.isNewGroupValid(),style:{marginLeft:4},children:(0,s.jsx)(t.x6,{i18nKey:"teams.team-group-sync.add-group",children:"Add group"})})]})})]})}),T.length===0&&!i&&((0,j.z5)()?(0,s.jsx)(w,{action:{onClick:this.onToggleAdding,text:(0,t.t)("teams.team-group-sync.text.add-group","Add group")}}):(0,s.jsx)(E.A,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:(0,t.t)("teams.team-group-sync.title-there-external-groups","There are no external groups to sync with"),buttonTitle:"Add group",proTip:W,proTipLinkTitle:"Learn more",proTipLink:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-team-sync/",proTipTarget:"_blank",buttonDisabled:S})),T.length>0&&(0,s.jsx)("div",{className:"admin-list-table",children:(0,s.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)(t.x6,{i18nKey:"teams.team-group-sync.external-group-id",children:"External Group ID"})}),(0,s.jsx)("th",{style:{width:"1%"}})]})}),(0,s.jsx)("tbody",{children:T.map($=>this.renderGroup($))})]})})]})}}const w=({action:a})=>{const i=(0,o.$j)();return(0,s.jsx)(y.El,{action:a,listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users' permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${i.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:(0,t.t)("teams.team-sync-upgrade-content.description","Team Sync makes it easier for you to manage users' access in Grafana, by immediately updating each user's Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in")})},se=(0,h.connect)(z,F)(ee),te=()=>({icon:(0,c.css)({opacity:.7,"&:hover":{opacity:1}})});var ae=e(17159);const ne=a=>{let i=l.TP.hasPermissionInMetadata(d.w.ActionTeamsPermissionsWrite,a.team);return a.team.isProvisioned&&(i=!1),(0,s.jsx)(ae.x,{title:"",addPermissionTitle:"Add member",buttonLabel:"Add member",emptyLabel:"There are no members in this team or you do not have the permissions to list the current members.",resource:"teams",resourceId:a.team.id,canSetPermissions:i})};var oe=e(49785),ie=e(41654),re=e(16780),V=e(37386),de=e(99929),le=e(99686),me=e(13126);const ce={updateTeam:R.n7},ue=(0,h.connect)(null,ce)(({team:a,updateTeam:i})=>{const p=l.TP.hasPermissionInMetadata(d.w.ActionTeamsWrite,a),T=l.TP.user.orgId,[{roleOptions:S}]=(0,le.o)(T),{handleSubmit:K,register:$,formState:{errors:H}}=(0,oe.mN)({defaultValues:a}),Q=l.TP.hasPermission(d.w.ActionTeamsRolesAdd)&&l.TP.hasPermission(d.w.ActionTeamsRolesRemove),Z=l.TP.hasPermissionInMetadata(d.w.ActionTeamsRolesList,a)&&l.TP.hasPermission(d.w.ActionRolesList),G=async J=>{i(J.name,J.email||"")};return(0,s.jsxs)(ie.B,{direction:"column",gap:3,children:[(0,s.jsx)("form",{onSubmit:K(G),style:{maxWidth:"600px"},children:(0,s.jsxs)(re.n,{label:(0,t.t)("teams.team-settings.label-team-details","Team details"),children:[(0,s.jsx)(V.D,{label:(0,t.t)("teams.team-settings.label-numerical-identifier","Numerical identifier"),disabled:!0,children:(0,s.jsx)(L.p,{value:a.id,id:"id-input"})}),(0,s.jsx)(V.D,{label:(0,t.t)("teams.team-settings.label-name","Name"),disabled:!p||!!a.isProvisioned,required:!0,invalid:!!H.name,error:"Name is required",children:(0,s.jsx)(L.p,{...$("name",{required:!0}),id:"name-input"})}),l.TP.licensedAccessControlEnabled()&&Z&&(0,s.jsx)(V.D,{label:(0,t.t)("teams.team-settings.label-role","Role"),children:(0,s.jsx)(de.Y,{teamId:a.id,roleOptions:S,disabled:!Q,maxWidth:"100%"})}),(0,s.jsx)(V.D,{label:(0,t.t)("teams.team-settings.label-email","Email"),description:(0,t.t)("teams.team-settings.description-email","This is optional and is primarily used to set the team profile avatar (via gravatar service)"),disabled:!p,children:(0,s.jsx)(L.p,{...$("email"),placeholder:"team@email.com",type:"email",id:"email-input"})}),(0,s.jsx)(O.$n,{type:"submit",disabled:!p,children:(0,s.jsx)(t.x6,{i18nKey:"teams.team-settings.save",children:"Save"})})]})}),(0,s.jsx)(me.u,{resourceUri:`teams/${a.id}`,disabled:!p,preferenceType:"team"})]})});var ge=e(67145),he=(a=>(a.Members="members",a.Settings="settings",a.GroupSync="groupsync",a))(he||{});const k=["members","settings","groupsync"],pe=(0,M.Mz)([a=>a.team,(a,i)=>i],(a,i)=>N(a,i)),Te=(0,M.Mz)([a=>a.navIndex,(a,i)=>i,(a,i,p)=>p],(a,i,p)=>{const T=(0,ge.X)(i);return(0,f.tc)(a,`team-${i}-${p}`,T).main}),_=(0,m.memo)(()=>{const a=(0,m.useRef)((0,x.a)("teamsync")),{uid:i="",page:p}=(0,A.g)(),T=(0,r.d4)(G=>pe(G,i));let S="members";(!T||!l.TP.hasPermissionInMetadata(d.w.ActionTeamsPermissionsRead,T))&&(S="settings");const K=p??S,$=(0,r.d4)(G=>Te(G,K,i)),H=(0,r.wA)(),{loading:Q}=(0,P.A)(async()=>H((0,R.eo)(i)),[i]),Z=()=>{const G=k.includes(K)?K:k[0],J=l.TP.hasPermissionInMetadata(d.w.ActionTeamsRead,T),q=l.TP.hasPermissionInMetadata(d.w.ActionTeamsPermissionsRead,T),ve=l.TP.hasPermissionInMetadata(d.w.ActionTeamsPermissionsWrite,T);switch(G){case"members":return q?(0,s.jsx)(ne,{team:T}):null;case"settings":return J&&(0,s.jsx)(ue,{team:T});case"groupsync":if(a.current){if(q)return(0,s.jsx)(se,{isReadOnly:!ve})}else if(g.Ay.featureToggles.featureHighlights)return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Iz,{featureName:"team sync",featureId:"team-sync"}),(0,s.jsx)(w,{})]})}return null};return(0,s.jsx)(v.Y,{navId:"teams",pageNav:$,children:(0,s.jsx)(v.Y.Contents,{isLoading:Q,children:T&&Object.keys(T).length!==0&&Z()})})});_.displayName="TeamPages";const Pe=_},77174:(b,I,e)=>{e.d(I,{Bu:()=>f,It:()=>B,To:()=>r,Vk:()=>t,aK:()=>D,eo:()=>d,n7:()=>U,nC:()=>C,nM:()=>c,yd:()=>h});var s=e(2543),M=e.n(s),m=e(68143),A=e(6890),P=e(73427),x=e(81871),v=e(11257),y=e(67145),g=e(27104);function f(o=!1){return async(n,u)=>{const{query:E,page:j,perPage:R,sort:X}=u().teams;if(!P.TP.hasPermission(v.w.ActionTeamsRead)){n((0,g.Q9)({teams:[],totalCount:0,page:1,perPage:R,noTeams:!0}));return}const N=await(0,m.AI)().get("/api/teams/search",(0,x.F)({query:E,page:j,perpage:R,sort:X}));let z=!1;if(o&&(z=N.teams.length===0),P.TP.licensedAccessControlEnabled()&&P.TP.hasPermission(v.w.ActionTeamsRolesList)){n((0,g.dJ)());const F=N?.teams.map(W=>W.id),Y=await(0,m.AI)().post("/api/access-control/teams/roles/search",{teamIds:F});N.teams.forEach(W=>{W.roles=Y?Y[W.id]||[]:[]}),n((0,g.jE)())}n((0,g.Q9)({noTeams:z,...N}))}}const l=(0,s.debounce)(o=>o(f()),500);function d(o){return async n=>{const u=await(0,m.AI)().get(`/api/teams/${o}`,(0,x.F)());n((0,g.$T)(u)),n((0,A.Vz)((0,y.R)(u)))}}function r(o){return async n=>{await(0,m.AI)().delete(`/api/teams/${o}`),await P.TP.fetchUserPermissions(),n(f())}}function c(o){return async n=>{n((0,g.L5)(o)),l(n)}}function h(o){return async n=>{n((0,g.EC)(o)),n(f())}}function t({sortBy:o}){const n=o.length?`${o[0].id}-${o[0].desc?"desc":"asc"}`:void 0;return async u=>{u((0,g.$u)(n)),u(f())}}function O(){return async(o,n)=>{const u=n().team.team,E=await getBackendSrv().get(`/api/teams/${u.uid}/members`);o(teamMembersLoaded(E))}}function U(o,n){return async(u,E)=>{const j=E().team.team;await(0,m.AI)().put(`/api/teams/${j.uid}`,{name:o,email:n}),u(d(j.uid))}}function D(){return async(o,n)=>{const u=n().team.team,E=await(0,m.AI)().get(`/api/teams/${u.uid}/groups`);o((0,g.tC)(E))}}function B(o){return async(n,u)=>{const E=u().team.team;await(0,m.AI)().post(`/api/teams/${E.uid}/groups`,{groupId:o}),n(D())}}function C(o){return async(n,u)=>{const E=u().team.team;await(0,m.AI)().delete(`/api/teams/${E.uid}/groups?groupId=${encodeURIComponent(o)}`),n(D())}}function L(o){return async n=>{await getBackendSrv().put(`/api/teams/${o.teamId}/members/${o.userId}`,{permission:o.permission}),n(O())}}},67145:(b,I,e)=>{e.d(I,{R:()=>l,X:()=>d});var s=e(92745),M=e(62061),m=e(25096),A=e(65642),P=e(15130),x=e(42939),v=e(11257),y=e(70590);const f={avatarUrl:e.p+"static/img/user_profile.4d4fc140.png",id:1,uid:"",name:"Loading",email:"loading",memberCount:0,permission:y.Xe.Member,accessControl:{isEditor:!1},orgId:0,updated:"",isProvisioned:!1};function l(r){const c={img:r.avatarUrl,id:"team-"+r.uid,subTitle:(0,s.t)("teams.build-nav-model.nav-model.subTitle.manage-members-and-settings","Manage members and settings"),url:`org/teams/edit/${r.uid}`,text:r.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${r.uid}`,text:(0,s.t)("teams.build-nav-model.nav-model.text.settings","Settings"),url:`org/teams/edit/${r.uid}/settings`}]};(r===f||P.TP.hasPermissionInMetadata(v.w.ActionTeamsPermissionsRead,r))&&c.children.unshift({active:!1,icon:"users-alt",id:`team-members-${r.uid}`,text:(0,s.t)("teams.build-nav-model.text.members","Members"),url:`org/teams/edit/${r.uid}/members`});const h={active:!1,icon:"sync",id:`team-groupsync-${r.uid}`,text:(0,s.t)("teams.build-nav-model.team-group-sync.text.external-group-sync","External group sync"),url:`org/teams/edit/${r.uid}/groupsync`},t=r===f;return(0,x.z5)()&&(h.tabSuffix=()=>(0,m.J)({experimentId:t?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,M.a)("teamsync")?(t||P.TP.hasPermissionInMetadata(v.w.ActionTeamsPermissionsRead,r))&&c.children.push(h):A.Ay.featureToggles.featureHighlights&&c.children.push({...h,tabSuffix:()=>(0,m.J)({experimentId:t?"":"feature-highlights-team-sync-badge"})}),c}function d(r){const c=l(f);let h;for(const t of c.children)if(t.id.indexOf(r)>0){t.active=!0,h=t;break}return{main:c,node:h}}}}]);

//# sourceMappingURL=TeamPages.05f1c42371e7e7b92d12.js.map