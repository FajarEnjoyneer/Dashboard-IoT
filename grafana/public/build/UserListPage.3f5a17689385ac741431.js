"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{91087:(ss,A,a)=>{a.d(A,{y:()=>x});var s=a(74848),l=a(96540),m=a(41053),u=a(73427),r=a(11257),h=a(59812),j=a(34418);const x=({basicRole:O,roles:U,userId:v,orgId:b,onBasicRoleChange:y,roleOptions:D,disabled:G,basicRoleDisabled:Y,basicRoleDisabledMessage:C,apply:M=!1,onApplyRoles:B,pendingRoles:P,maxWidth:X,width:z,isLoading:$})=>{const[{loading:es,value:as=U||[]},Z]=(0,m.A)(async()=>{try{if(U)return U;if(M&&P?.length)return P;if(u.TP.hasPermission(r.w.ActionUserRolesList)&&v>0)return await(0,j.Xh)(v,b)}catch{console.error("Error loading options")}return[]},[b,v,P,U]);(0,l.useEffect)(()=>{b&&Z()},[Z,b]);const S=async V=>{M?B&&B(V,v,b):(await(0,j.eA)(V,v,b),await Z())},H=u.TP.hasPermission(r.w.ActionUserRolesAdd)&&u.TP.hasPermission(r.w.ActionUserRolesRemove);return(0,s.jsx)(h.n,{appliedRoles:as,basicRole:O,onRolesChange:S,onBasicRoleChange:y,roleOptions:D,isLoading:es||$,disabled:G,basicRoleDisabled:Y,basicRoleDisabledMessage:C,showBasicRole:!0,apply:M,canUpdateRoles:H,maxWidth:X,width:z})}},31908:(ss,A,a)=>{a.d(A,{I:()=>b});var s=a(74848),l=a(49785),m=a(90382),u=a(47184),r=a(92745),h=a(89640),j=a(8207),x=a(37386),O=a(77824);const U=Object.keys(m.X).map(u.z),v=(0,s.jsxs)(r.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,s.jsx)(h.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),b=({onClose:y})=>{const D=(0,l.xW)(),{control:G,getValues:Y,setValue:C}=D,[M,B]=Y(["name","roles"]);return(0,s.jsx)(j._,{title:M,subtitle:v,onClose:y,children:(0,s.jsx)(x.D,{label:(0,r.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,s.jsx)(l.xI,{name:"role",control:G,render:({field:{onChange:P,ref:X,...z}})=>(0,s.jsx)(O.z,{...z,options:U,onChange:$=>{C("roleCollection",[$,...B]),P($)}})})})})}},9390:(ss,A,a)=>{a.d(A,{r:()=>j});var s=a(74848),l=a(90382),m=a(92745),u=a(18857);const h=Object.values(l.X).filter(x=>x!==l.X.None).map(x=>({label:x,value:x}));function j({value:x,onChange:O,"aria-label":U,inputId:v,autoFocus:b,...y}){return(0,s.jsx)(u.l6,{inputId:v,value:x,options:h,onChange:D=>O(D.value??l.X.None),placeholder:(0,m.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":U,autoFocus:b,...y})}},596:(ss,A,a)=>{a.r(A),a.d(A,{default:()=>oe});var s=a(74848),l=a(22803),m=a(96540),u=a(51898),r=a(92745),h=a(43173),j=a(60208),x=a(63142),O=a(54314),U=a(15130),v=a(24313),b=a(11257),y=a(13791),D=a(71468),G=a(67458),Y=a(34999),C=a(73427),M=a(77527),B=a(47931),P=a(45861),X=a(61666);const z={revokeInvite:X.eb},$=(0,D.connect)(null,z);class es extends m.PureComponent{render(){const{invitee:n,revokeInvite:t}=this.props;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n.email}),(0,s.jsx)("td",{children:n.name}),(0,s.jsxs)("td",{className:"text-right",children:[(0,s.jsx)(B.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,s.jsx)("td",{children:(0,s.jsx)(P.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(n.code),"aria-label":(0,r.t)("invites.invitee-row.aria-label-revoke-invite","Revoke invite")})})]})}}const as=$(es);class Z extends m.PureComponent{render(){const{invitees:n}=this.props;return(0,s.jsxs)("table",{className:"filter-table form-inline",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"invites.invitees-table.email",children:"Email"})}),(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"invites.invitees-table.name",children:"Name"})}),(0,s.jsx)("th",{}),(0,s.jsx)("th",{style:{width:"34px"}})]})}),(0,s.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((t,i)=>(0,s.jsx)(as,{invitee:t},`${t.id}-${i}`))})]})}}var S=a(25508),H=a(38748);const{selectAll:V,selectById:ps,selectTotal:os}=H.Tp,cs=(e,n)=>n,ds=(0,S.Mz)([V,cs],(e,n)=>{const t=new RegExp(n,"i");return e.filter(c=>t.test(c.name)||t.test(c.email))});var R=a(27489),f=a(18027),Q=a(12737),K=a(77824),k=a(65642),ns=a(2543),N=a(68143),q=a(81871),T=a(1302);function E(){return async(e,n)=>{try{e((0,T.Cj)());const{perPage:t,page:i,searchQuery:c,sort:g}=n().users,I=await(0,N.AI)().get("/api/org/users/search",(0,q.F)({perpage:t,page:i,query:c,sort:g}));if(C.TP.licensedAccessControlEnabled()&&C.TP.hasPermission(b.w.ActionUserRolesList)){e((0,T.dJ)());const d=C.TP.user.orgId,W=I?.orgUsers.map(L=>L.userId),F=await(0,N.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:W,orgId:d});I.orgUsers.forEach(L=>{L.roles=F?F[L.userId]||[]:[]}),e((0,T.jE)())}e((0,T.Y_)(I))}catch{(0,T.g4)()}}}const _=(0,ns.debounce)(e=>e(E()),300);function ts(e){return async n=>{await(0,N.AI)().patch(`/api/org/users/${e.userId}`,{role:e.role}),n(E())}}function ls(e){return async n=>{await(0,N.AI)().delete(`/api/org/users/${e}`),n(E())}}function us(e){return async n=>{n((0,T.EC)(e)),n(E())}}function hs({sortBy:e}){const n=e.length?`${e[0].id}-${e[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,T.$u)(n)),t(E())}}function o(e){return async n=>{n((0,T.t_)(e)),_(n)}}const p=e=>{const n=new RegExp(e.searchQuery,"i");return e.users.filter(t=>n.test(t.login)||n.test(t.email)||n.test(t.name))},J=e=>e.searchQuery;var gs=a(79776);function w(e){return{searchQuery:J(e.users),pendingInvitesCount:os(e.invites),externalUserMngLinkName:e.users.externalUserMngLinkName,externalUserMngLinkUrl:e.users.externalUserMngLinkUrl}}const ms={changeSearchQuery:o},Is=(0,D.connect)(w,ms)(({externalUserMngLinkName:e,externalUserMngLinkUrl:n,searchQuery:t,pendingInvitesCount:i,changeSearchQuery:c,onShowInvites:g,showInvites:I})=>{const d=[{label:(0,r.t)("users.users-action-bar-unconnected.options.label.users","Users"),value:"users"},{label:`Pending Invites (${i})`,value:"invites"}],F=C.TP.hasPermission(b.w.OrgUsersAdd)&&!(k.Ay.disableLoginForm&&k.Ay.externalUserMngInfo),L=()=>{(0,R.rR)("users_admin_actions_clicked",{category:"org_users",item:"manage_users_external"})};return(0,s.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,s.jsx)(f.I,{grow:!0,children:(0,s.jsx)(Q.Z,{value:t,onChange:c,placeholder:(0,r.t)("users.users-action-bar-unconnected.placeholder-search-login-email","Search user by login, email or name")})}),i>0&&(0,s.jsx)("div",{style:{marginLeft:"1rem"},children:(0,s.jsx)(K.z,{value:I?"invites":"users",options:d,onChange:g})}),F&&(0,s.jsx)(P.z9,{href:"org/users/invite",children:(0,s.jsx)(r.x6,{i18nKey:"users.users-action-bar-unconnected.invite",children:"Invite"})}),n&&(0,s.jsx)(P.z9,{onClick:L,href:(0,gs.o)("manage-users"),target:"_blank",rel:"noopener",children:e})]})});function Os(e){const n=J(e.users);return{users:p(e.users),searchQuery:J(e.users),page:e.users.page,totalPages:e.users.totalPages,perPage:e.users.perPage,invitees:ds(e.invites,n),externalUserMngInfo:e.users.externalUserMngInfo,isLoading:e.users.isLoading,rolesLoading:e.users.rolesLoading}}const Ms={loadUsers:E,fetchInvitees:X.G7,changePage:us,changeSort:hs,updateUser:ts,removeUser:ls},xs=(0,D.connect)(Os,Ms)(({users:e,page:n,totalPages:t,invitees:i,externalUserMngInfo:c,isLoading:g,rolesLoading:I,loadUsers:d,fetchInvitees:W,changePage:F,updateUser:L,removeUser:Ps,changeSort:ie})=>{const[fs,ce]=(0,m.useState)(!1),Cs=c?(0,G.G)(c):"";(0,m.useEffect)(()=>{d(),W()},[W,d]);const de=(ys,xe)=>{L({...xe,role:ys})},ue=ys=>Ps(ys.userId),he=()=>{ce(!fs)},ge=()=>{d()},me=()=>fs?(0,s.jsx)(Z,{invitees:i}):(0,s.jsx)(M.b,{users:e,orgId:C.TP.user.orgId,rolesLoading:I,onRoleChange:de,onRemoveUser:ue,onUserRolesChange:ge,fetchData:ie,changePage:F,page:n,totalPages:t});return(0,s.jsxs)(y.Y.Contents,{isLoading:!g,children:[(0,s.jsx)(Is,{onShowInvites:he,showInvites:fs}),Cs&&(0,s.jsx)(Y.F,{severity:"info",title:"",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:Cs}})}),g&&me()]})});function Pe(){return jsx(Page,{navId:"users",children:jsx(xs,{})})}var Rs=a(82853),As=a(45967),Bs=a(71555),Ss=a(99887),vs=a(41654),Ks=a(27594),Ns=a(34213),Ws=a(58887);const zs=e=>{if(!e.includes(" "))return{browser:e,computer:""};const n=e.split(" ");return{browser:n[0],computer:n[1]}},Ds=(e,n)=>e.length>n?e.substring(0,n)+"...":e,$s=({value:e})=>{const n=zs(e);return(0,s.jsx)(As.m,{theme:"info-alt",content:e,placement:"top-end",interactive:!0,children:(0,s.jsxs)("span",{children:[Ds(n.browser,10),Ds(n.computer,10)]})})},Qs=({devices:e,showPaging:n,totalPages:t,onChangePage:i,currentPage:c,fetchData:g})=>{const I=(0,m.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:d}})=>d&&(0,s.jsx)(Bs.e,{src:d,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:d}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:d}})=>(0,s.jsx)($s,{value:d}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:d}})=>d,sortType:(d,W)=>new Date(d.original.updatedAt).getTime()-new Date(W.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:d}})=>d&&(0,s.jsx)(Ss.E,{text:d,color:"orange"})}],[]);return(0,s.jsxs)(vs.B,{direction:"column",gap:2,children:[(0,s.jsx)(Ks.j,{columns:I,data:e,getRowId:d=>d.deviceId,fetchData:g}),n&&(0,s.jsx)(vs.B,{justifyContent:"flex-end",children:(0,s.jsx)(Ns.d,{numberOfPages:t,currentPage:c,onNavigate:i})}),e.length===0&&(0,s.jsx)(Ws.Z,{children:(0,s.jsx)("span",{children:(0,s.jsx)(r.x6,{i18nKey:"admin.anon-users.not-found",children:"No anonymous users found."})})})]})};var is=a(74267);const Fs={fetchUsersAnonymousDevices:is.xq,changeAnonUserSort:is.A5,changeAnonPage:is.is,changeAnonQuery:is.Bc},Gs=e=>({devices:e.userListAnonymousDevices.devices,query:e.userListAnonymousDevices.query,showPaging:e.userListAnonymousDevices.showPaging,totalPages:e.userListAnonymousDevices.totalPages,page:e.userListAnonymousDevices.page,filters:e.userListAnonymousDevices.filters}),Ys=u.Tp.pages.UserListPage.UserListAdminPage,Ts=(0,D.connect)(Gs,Fs)(({devices:e,fetchUsersAnonymousDevices:n,query:t,changeAnonQuery:i,filters:c,showPaging:g,totalPages:I,page:d,changeAnonPage:W,changeAnonUserSort:F})=>{const L=(0,x.of)(Xs);return(0,m.useEffect)(()=>{n()},[n]),(0,s.jsxs)(y.Y.Contents,{children:[(0,s.jsx)("div",{className:L.actionBar,"data-testid":Ys.container,children:(0,s.jsxs)("div",{className:L.row,children:[(0,s.jsx)(Q.Z,{placeholder:(0,r.t)("admin.user-list-anonymous-devices-page-un-connected.placeholder-search-devices-by-ip-address","Search devices by IP address."),autoFocus:!0,value:t,onChange:i}),(0,s.jsx)(K.z,{options:[{label:(0,r.t)("admin.user-list-anonymous-devices-page-un-connected.label.active-last-days","Active last 30 days"),value:!0}],value:c.find(Ps=>Ps.name==="activeLast30Days")?.value,className:L.filter})]})}),(0,s.jsx)(Qs,{devices:e,showPaging:g,totalPages:I,onChangePage:W,currentPage:d,fetchData:F})]})});function pe(){return jsx(Page,{navId:"anonymous-users",children:jsx(Ts,{})})}const Xs=e=>({filter:(0,l.css)({margin:e.spacing(0,1),[e.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,l.css)({marginBottom:e.spacing(2),display:"flex",alignItems:"flex-start",gap:e.spacing(2),[e.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,l.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:e.spacing(.5),flexGrow:1,[e.breakpoints.down("sm")]:{flexWrap:"wrap",gap:e.spacing(2),width:"100%"}})}),Ue=null;var Zs=a(30703),Hs=a(94018),bs=a(62905),js=a(22787),Vs=a(6975),Es=a(8515);const Js=u.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,ws=({email:e,onDismiss:n})=>{const t=(0,x.of)(qs),{data:i,isLoading:c}=(0,bs.kd)(e);return(0,s.jsx)(js.a,{className:t.modal,isOpen:!0,title:h.$.featureToggles.newDashboardSharingComponent?(0,r.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,r.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:c?(0,s.jsx)("div",{className:t.loading,children:(0,s.jsx)(Vs._,{text:(0,r.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):i?.map(g=>(0,s.jsxs)("div",{className:t.listItem,"data-testid":Js.listItem(g.dashboardUid),children:[(0,s.jsx)("p",{className:t.dashboardTitle,children:g.dashboardTitle}),(0,s.jsxs)("div",{className:t.urlsContainer,children:[(0,s.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,l.cx)("external-link",t.url),href:(0,v.mL)(g.publicDashboardAccessToken),onClick:n,children:h.$.featureToggles.newDashboardSharingComponent?(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,s.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,s.jsx)("a",{className:(0,l.cx)("external-link",t.url),href:(0,v.gN)(g.dashboardUid,g.slug),onClick:n,children:h.$.featureToggles.newDashboardSharingComponent?(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,s.jsx)("hr",{className:t.divider})]},g.dashboardUid))})},ks=({email:e})=>{const n=(0,r.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,s.jsx)(Es.$s,{children:({showModal:t,hideModal:i})=>(0,s.jsx)(P.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>t(ws,{email:e,onDismiss:i})})})},qs=e=>({modal:(0,l.css)({width:"590px"}),loading:(0,l.css)({display:"flex",justifyContent:"center"}),listItem:(0,l.css)({display:"flex",flexDirection:"column",gap:e.spacing(.5)}),divider:(0,l.css)({margin:e.spacing(1.5,0),color:e.colors.text.secondary}),urlsContainer:(0,l.css)({display:"flex",gap:e.spacing(.5),[e.breakpoints.down("sm")]:{flexDirection:"column"}}),urlsDivider:(0,l.css)({color:e.colors.text.secondary,[e.breakpoints.down("sm")]:{display:"none"}}),dashboardTitle:(0,l.css)({fontSize:e.typography.body.fontSize,fontWeight:e.typography.fontWeightBold,marginBottom:0}),url:(0,l.css)({fontSize:e.typography.body.fontSize})}),_s=({user:e,hideModal:n})=>{const[t]=(0,bs.g9)(),i=(0,x.of)(ee),c=()=>{t({email:e.email}),n()};return(0,s.jsxs)(js.a,{className:i.modal,isOpen:!0,title:(0,r.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,s.jsx)("p",{className:i.description,children:(0,s.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:e.email},"?"]})}),(0,s.jsx)("p",{className:i.description,children:h.$.featureToggles.newDashboardSharingComponent?(0,s.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:e.email},"'s access to all shared dashboards."]}):(0,s.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:e.email},"'s access to all public dashboards."]})}),(0,s.jsxs)(js.a.ButtonRow,{children:[(0,s.jsx)(P.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,s.jsx)(P.$n,{type:"button",variant:"destructive",onClick:c,children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},se=({user:e})=>{const n=(0,r.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,s.jsx)(Es.$s,{children:({showModal:t,hideModal:i})=>(0,s.jsx)(P.$n,{size:"sm",variant:"destructive",onClick:()=>t(_s,{user:e,hideModal:i}),icon:"times","aria-label":n,title:n})})},ee=e=>({modal:(0,l.css)({width:"500px"}),description:(0,l.css)({fontSize:e.typography.body.fontSize,margin:0})}),ae=u.Tp.pages.UserListPage.publicDashboards,ne=()=>{const{data:e,isLoading:n}=(0,bs.AK)();return(0,s.jsx)(y.Y.Contents,{isLoading:n,children:(0,s.jsxs)("table",{className:"filter-table form-inline","data-testid":ae.container,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,s.jsxs)("th",{children:[(0,s.jsx)("span",{children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,s.jsx)(As.m,{placement:"top",content:(0,r.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,s.jsx)(Zs.I,{name:"info-circle"})})]}),(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,s.jsx)("th",{children:(0,s.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:e?.map(t=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,s.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsxs)(vs.B,{gap:2,children:[(0,s.jsx)("span",{children:(0,s.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-body.dashboard-count",count:t.totalDashboards,children:[{count:t.totalDashboards}," dashboards"]})}),(0,s.jsx)(ks,{email:t.email})]})}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)(Hs.v,{name:"Viewer",colorIndex:19})}),(0,s.jsx)("td",{className:"text-right",children:(0,s.jsx)(se,{user:t})})]},t.email))})]})})};var te=(e=>(e.ADMIN="admin",e.ORG="org",e.PUBLIC_DASHBOARDS="public-dashboards",e.ANON="anon",e))(te||{});const rs=u.Tp.pages.UserListPage,Ls=({view:e,setView:n})=>(0,s.jsx)(j.o,{label:h.$.featureToggles.newDashboardSharingComponent?(0,r.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,r.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:e==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":rs.tabs.publicDashboardsUsers}),re={admin:(0,s.jsx)(Rs.PU,{}),org:(0,s.jsx)(xs,{}),"public-dashboards":(0,s.jsx)(ne,{}),anon:(0,s.jsx)(Ts,{})};function oe(){const e=(0,x.of)(le),n=U.TP.hasPermission(b.w.UsersRead),t=U.TP.hasPermission(b.w.OrgUsersRead),[i,c]=(0,m.useState)(()=>n?"admin":t?"org":null),g=t&&n;return(0,s.jsxs)(y.Y,{navId:"global-users",children:[g?(0,s.jsxs)(O.U,{className:e.tabsMargin,children:[(0,s.jsx)(j.o,{label:(0,r.t)("admin.user-list-page.label-all-users","All users"),active:i==="admin",onChangeTab:()=>c("admin"),"data-testid":rs.tabs.allUsers}),(0,s.jsx)(j.o,{label:(0,r.t)("admin.user-list-page.label-organization-users","Organization users"),active:i==="org",onChangeTab:()=>c("org"),"data-testid":rs.tabs.orgUsers}),h.$.anonymousEnabled&&(0,s.jsx)(j.o,{label:(0,r.t)("admin.user-list-page.label-anonymous-devices","Anonymous devices"),active:i==="anon",onChangeTab:()=>c("anon"),"data-testid":rs.tabs.anonUserDevices}),(0,v.AY)()&&(0,s.jsx)(Ls,{view:i,setView:c})]}):(0,v.AY)()&&(0,s.jsxs)(O.U,{className:e.tabsMargin,children:[(0,s.jsx)(j.o,{label:(0,r.t)("admin.user-list-page.label-users","Users"),active:i==="org",onChangeTab:()=>c("org"),"data-testid":rs.tabs.users}),(0,s.jsx)(Ls,{view:i,setView:c})]}),i?re[i]:(0,s.jsx)(xs,{})]})}const le=e=>({tabsMargin:(0,l.css)({marginBottom:e.spacing(3)})})},77527:(ss,A,a)=>{a.d(A,{b:()=>ds});var s=a(74848),l=a(96540),m=a(51898),u=a(92745),r=a(43173),h=a(71555),j=a(66404),x=a(31286),O=a(45967),U=a(30703),v=a(94018),b=a(45861),y=a(41654),D=a(27594),G=a(34213),Y=a(71599),C=a(91087),M=a(34418),B=a(22803),P=a(49785),X=a(63142),z=a(99887),$=a(31908);const es=({disabled:R,user:f})=>{const[Q,K]=(0,l.useState)(!1),{badge:k,badgeDisabled:ns}=(0,X.of)(as),N=R?ns:k,q=(0,P.mN)({defaultValues:{name:f.name,role:f.role,roles:f.roles}}),{watch:T}=q,E=()=>{R||K(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(y.B,{gap:1,children:[(0,s.jsx)(z.E,{className:N,color:"blue",onClick:E,text:T("role")}),f.roles&&f.roles.length>0&&(0,s.jsx)(z.E,{className:N,color:"blue",onClick:E,text:(0,u.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:f.roles.length})})]}),Q&&(0,s.jsx)(P.Op,{...q,children:(0,s.jsx)($.I,{onClose:()=>K(!1)})})]})};function as(R){return{badge:(0,B.css)({cursor:"pointer"}),badgeDisabled:(0,B.css)({cursor:"not-allowed"})}}var Z=a(11297),S=a(73427),H=a(11257),V=a(9390);const ps=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,os=R=>{const f=R?.isExternallySynced;return!S.TP.hasPermissionInMetadata(H.w.OrgUsersWrite,R)||f},cs=m.Tp.pages.UserListPage.UsersListPage,ds=({users:R,orgId:f,onRoleChange:Q,onUserRolesChange:K,onRemoveUser:k,fetchData:ns,changePage:N,page:q,totalPages:T,rolesLoading:E})=>{const[_,ts]=(0,l.useState)(null),[ls,us]=(0,l.useState)([]);(0,l.useEffect)(()=>{async function o(){try{if(S.TP.hasPermission(H.w.ActionRolesList)){let p=await(0,M.RL)(f);us(p)}}catch{console.error("Error loading options")}}S.TP.licensedAccessControlEnabled()&&o()},[f]);const hs=(0,l.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&(0,s.jsx)(h.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:o}})=>(0,s.jsx)("div",{children:o}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(s.Fragment,{children:o==="10 years"?(0,s.jsx)(j.E,{color:"disabled",children:(0,s.jsx)(u.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):o})}),sortType:(o,p)=>new Date(o.original.lastSeenAt).getTime()-new Date(p.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:o},row:{original:p}})=>{const J=os(p),gs=async(w,ms,Us)=>{await(0,M.eA)(w,ms,Us),K&&K()};return r.$.featureToggles.rolePickerDrawer?(0,s.jsx)(es,{disabled:J,user:p}):S.TP.licensedAccessControlEnabled()?(0,s.jsx)(C.y,{userId:p.userId,roles:p.roles,apply:!0,onApplyRoles:gs,isLoading:E,orgId:f,roleOptions:ls,basicRole:o,onBasicRoleChange:w=>Q(w,p),basicRoleDisabled:J,basicRoleDisabledMessage:ps,width:40}):(0,s.jsx)(V.r,{"aria-label":(0,u.t)("admin.org-users-table.columns.aria-label-role","Role"),value:o,disabled:J,onChange:w=>Q(w,p)})}},{id:"info",header:"",cell:({row:{original:o}})=>os(o)&&(0,s.jsx)(x.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(O.m,{interactive:!0,content:(0,s.jsx)("div",{children:(0,s.jsxs)(u.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,s.jsx)(U.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(o)&&o.length>0&&(0,s.jsx)(Z.E,{label:o[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(v.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(v.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:o}})=>S.TP.hasPermissionInMetadata(H.w.OrgUsersRemove,o)&&(0,s.jsx)(b.$n,{size:"sm",variant:"destructive",onClick:()=>{ts(o)},icon:"times","aria-label":(0,u.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:o.name})})}],[E,f,ls,K,Q]);return(0,s.jsxs)(y.B,{direction:"column",gap:2,"data-testid":cs.container,children:[(0,s.jsx)(D.j,{columns:hs,data:R,getRowId:o=>String(o.userId),fetchData:ns}),(0,s.jsx)(y.B,{justifyContent:"flex-end",children:(0,s.jsx)(G.d,{onNavigate:N,currentPage:q,numberOfPages:T,hideWhenSinglePage:!0})}),!!_&&(0,s.jsx)(Y.u,{body:(0,u.t)("admin.org-users-table.body-delete","Are you sure you want to delete user {{user}}?",{user:_?.login}),confirmText:(0,u.t)("admin.org-users-table.confirmText-delete","Delete"),title:(0,u.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{ts(null)},isOpen:!0,onConfirm:()=>{_&&(k(_),ts(null))}})]})}},58887:(ss,A,a)=>{a.d(A,{Z:()=>u});var s=a(74848),l=a(22803),m=a(63142);const u=({children:h})=>{const j=(0,m.of)(r);return(0,s.jsx)("div",{className:j.container,children:h})},r=h=>({container:(0,l.css)({backgroundColor:h.colors.background.secondary,color:h.colors.text.secondary,padding:h.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.3f5a17689385ac741431.js.map