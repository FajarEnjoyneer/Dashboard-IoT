{"version":3,"file":"WriteTargetConfig.259ec6ebedf5c3339d2e.js","mappings":"gZAsBA,SAASA,EAAgBC,EAA6B,CACpD,MAAO,CACL,YAAU,MAAYA,EAAM,SAAU,iBAAiB,EACvD,yBAAuB,KAAuBA,EAAM,eAAe,CACrE,CACF,CAEA,MAAMC,EAAqB,CACzB,yBAAwB,IAC1B,EAEMC,KAAY,WAAQH,EAAiBE,CAAkB,EAEhDE,EAA+B,CAAC,CAAE,SAAAC,EAAU,sBAAAC,EAAuB,yBAAAC,CAAyB,IAAa,CACpH,KAAM,CAACC,EAAoBC,CAAqB,KAAI,YAAiD,EAC/F,CAACC,EAAWC,CAAY,KAAI,YAA6BL,GAAuB,iBAAiB,EACjGM,KAAS,MAAWC,CAAS,EAC7B,CAAE,SAAAC,EAAU,aAAAC,CAAa,KAAI,MAAQ,CAAE,cAAeT,CAAsB,CAAC,KACnF,aAAU,IAAM,CACdC,EAAyB,CAC3B,EAAG,CAACA,CAAwB,CAAC,KAC7B,aAAU,IAAM,EACS,SAAY,CACjC,GAAID,EAAuB,CACzB,MAAME,EAAqB,QAAM,KAAiB,EAAE,oBAAoBF,EAAsB,eAAe,EAC7GG,EAAsBD,CAAkB,CAC1C,CACF,GACe,CACjB,EAAG,CAACF,CAAqB,CAAC,EAE1B,MAAMU,EAAYC,GAAgC,CAChDC,EAAkBV,GAAoB,IAAMS,EAAK,iBAAiB,CACpE,EAEME,KACJ,QAAC,QACE,kBACC,4EACA,sDACF,KACA,OAAC,KACC,KAAK,2FACL,UAAWP,EAAO,SAClB,OAAO,SACP,IAAI,aAEJ,mBAAC,IAAI,CAAC,KAAK,aAAc,GAC3B,GACF,EAGF,SACE,OAAC,IAAI,CAAC,SAAAP,EACJ,mBAAC,IAAK,SAAL,CACC,oBAAC,QAEC,SAAUU,EAAaC,CAAQ,EAC/B,MAAO,CAAE,SAAU,OAAQ,EAE3B,oBAAC,IAAK,CAAC,MAAOG,EACZ,mBAAC,KACC,SAAUV,EACV,QAASD,GAAoB,KAC7B,eAAa,KACX,oFACA,sBACF,EACA,KAAM,aACN,UAAW,GACX,SAAU,GACV,QAAQ,qBACV,EACF,KACA,OAAC,KACC,SAAO,KAAE,2EAA4E,mBAAmB,EAExG,mBAAC,KACE,GAAGM,EAAS,mBAAmB,EAChC,SAAWM,GAAMT,EAAaS,EAAE,cAAc,KAAK,EAEnD,YAAY,gBACZ,GAAG,oBACL,EACF,KACA,OAAC,KAAM,CAAC,SAAkB,CAACV,GAAa,CAACF,EAAqB,KAAK,SACjE,mBAAC,KAAK,CAAC,QAAQ,wDAAwD,gBAAI,EAC7E,IA/BKF,GAAuB,eAgC9B,EACF,EACF,CAEJ,EAEA,SAASY,EAAkBG,EAAyBC,EAA4B,IAC9E,MAA0B,CACxB,gBAAAD,EACA,kBAAAC,CACF,CAA0B,EACvB,KAAK,IAAM,CACV,IAAU,KAAK,KAAU,aAAc,CAAC,wCAAwC,CAAC,CACnF,CAAC,EACA,MAAOC,GAAU,CAChB,IAAU,KAAK,KAAU,WAAY,CAACA,EAAM,KAAK,OAAO,CAAC,CAC3D,CAAC,CACL,CAEA,MAAMV,EAAaW,IACV,CACL,YAAU,OAAI,CACZ,WAAYA,EAAM,QAAQ,CAAC,CAC7B,CAAC,CACH,GAGWC,EAAoBtB,EAAUC,CAA4B,EACvE,EAAeqB,C","sources":["webpack://grafana/./public/app/extensions/recorded-queries/WriteTargetConfig.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport { AppEvents, DataSourceInstanceSettings, GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { Button, Field, Icon, Input, useStyles2 } from '@grafana/ui';\nimport appEvents from 'app/core/app_events';\nimport { Page } from 'app/core/components/Page/Page';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { DataSourcePicker } from 'app/features/datasources/components/picker/DataSourcePicker';\n\nimport { EnterpriseStoreState, PrometheusWriteTarget } from '../types';\n\nimport { getPrometheusWriteTarget, savePrometheusWriteTarget } from './state/actions';\nimport { getRecordedQueryWriter } from './state/selectors';\n\nexport type Props = GrafanaRouteComponentProps & ConnectedProps<typeof connector>;\n\nfunction mapStateToProps(state: EnterpriseStoreState) {\n  return {\n    navModel: getNavModel(state.navIndex, 'recordedQueries'),\n    prometheusWriteTarget: getRecordedQueryWriter(state.recordedQueries),\n  };\n}\n\nconst mapDispatchToProps = {\n  getPrometheusWriteTarget,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nexport const WriteTargetConfigUnconnected = ({ navModel, prometheusWriteTarget, getPrometheusWriteTarget }: Props) => {\n  const [selectedDataSource, setSelectedDataSource] = useState<DataSourceInstanceSettings | undefined>();\n  const [writePath, setWritePath] = useState<string | undefined>(prometheusWriteTarget?.remote_write_path);\n  const styles = useStyles2(getStyles);\n  const { register, handleSubmit } = useForm({ defaultValues: prometheusWriteTarget });\n  useEffect(() => {\n    getPrometheusWriteTarget();\n  }, [getPrometheusWriteTarget]);\n  useEffect(() => {\n    const getWriteTarget = async () => {\n      if (prometheusWriteTarget) {\n        const selectedDataSource = await getDataSourceSrv().getInstanceSettings(prometheusWriteTarget.data_source_uid);\n        setSelectedDataSource(selectedDataSource);\n      }\n    };\n    getWriteTarget();\n  }, [prometheusWriteTarget]);\n\n  const onSubmit = (data: PrometheusWriteTarget) => {\n    updateWriteTarget(selectedDataSource?.uid!, data.remote_write_path);\n  };\n\n  const datasourceLabel = (\n    <span>\n      {t(\n        'recorded-queries.write-target-config-unconnected.select-data-source-label',\n        'Select the data source where metrics will be written'\n      )}\n      <a\n        href=\"https://grafana.com/docs/grafana/latest/enterprise/recorded-queries/#remote-write-target\"\n        className={styles.docsLink}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        <Icon name=\"info-circle\" />\n      </a>\n    </span>\n  );\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        <form\n          key={prometheusWriteTarget?.data_source_uid}\n          onSubmit={handleSubmit(onSubmit)}\n          style={{ maxWidth: '600px' }}\n        >\n          <Field label={datasourceLabel}>\n            <DataSourcePicker\n              onChange={setSelectedDataSource}\n              current={selectedDataSource?.name}\n              placeholder={t(\n                'recorded-queries.write-target-config-unconnected.placeholder-select-a-data-source',\n                'Select a data source'\n              )}\n              type={'prometheus'}\n              noDefault={true}\n              alerting={true}\n              inputId=\"data-source-picker\"\n            />\n          </Field>\n          <Field\n            label={t('recorded-queries.write-target-config-unconnected.label-remote-write-path', 'Remote write path')}\n          >\n            <Input\n              {...register('remote_write_path')}\n              onChange={(e) => setWritePath(e.currentTarget.value)}\n              // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n              placeholder=\"/api/v1/write\"\n              id=\"remote-write-path\"\n            />\n          </Field>\n          <Button disabled={Boolean(!writePath || !selectedDataSource)} type=\"submit\">\n            <Trans i18nKey=\"recorded-queries.write-target-config-unconnected.save\">Save</Trans>\n          </Button>\n        </form>\n      </Page.Contents>\n    </Page>\n  );\n};\n\nfunction updateWriteTarget(data_source_uid: string, remote_write_path?: string) {\n  savePrometheusWriteTarget({\n    data_source_uid,\n    remote_write_path,\n  } as PrometheusWriteTarget)\n    .then(() => {\n      appEvents.emit(AppEvents.alertSuccess, [`Prometheus remote write target created`]);\n    })\n    .catch((error) => {\n      appEvents.emit(AppEvents.alertError, [error.data.message]);\n    });\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    docsLink: css({\n      marginLeft: theme.spacing(1),\n    }),\n  };\n};\n\nexport const WriteTargetConfig = connector(WriteTargetConfigUnconnected);\nexport default WriteTargetConfig;\n"],"names":["mapStateToProps","state","mapDispatchToProps","connector","WriteTargetConfigUnconnected","navModel","prometheusWriteTarget","getPrometheusWriteTarget","selectedDataSource","setSelectedDataSource","writePath","setWritePath","styles","getStyles","register","handleSubmit","onSubmit","data","updateWriteTarget","datasourceLabel","e","data_source_uid","remote_write_path","error","theme","WriteTargetConfig"],"sourceRoot":""}