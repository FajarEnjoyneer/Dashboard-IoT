"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3090],{80959:(qe,ye,t)=>{t.r(ye),t.d(ye,{plugin:()=>Xe});var de=t(95004),he=t(16515),Fe=t(16207),r=t(92745),Pe=t(43173),Oe=t(79277),Ae=t(41069),ke=t(12241),w=t(74848),ge=t(96540),Ie=t(11576),De=t(14477),Se=t(21275),X=t(739),Te=t(64400),je=t(63142),Ne=t(93630),Re=t(18667),ve=t(69234),$e=t(3041),re=t(65642),Be=t(78308),We=t(36327),Le=t(57632),Ue=t(13507),be=t(66881),we=t(8721),He=t(32503),ze=t(76234),p=(l=>(l.Candles="candles",l.CandlesVolume="candles+volume",l.Volume="volume",l))(p||{}),ce=(l=>(l.Candles="candles",l.OHLCBars="ohlcbars",l))(ce||{}),H=(l=>(l.CloseClose="close-close",l.OpenClose="open-close",l))(H||{});const pe={down:"red",flat:"gray",up:"green"},Z={...{candleStyle:"candles",colorStrategy:"open-close",colors:{down:"red",up:"green",flat:"gray"},fields:{},includeAllFields:!1,mode:"candles+volume"},legend:{displayMode:X.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:X.$N.Multi,sort:X.xB.None}},Me=()=>({open:{key:"open",name:(0,r.t)("candlestick.name-open","Open"),defaults:["open","o"],description:(0,r.t)("candlestick.description-open","Value at the start of the period")},high:{key:"high",name:(0,r.t)("candlestick.name-high","High"),defaults:["high","h","max"],description:(0,r.t)("candlestick.description-high","Maximum value within the period")},low:{key:"low",name:(0,r.t)("candlestick.name-low","Low"),defaults:["low","l","min"],description:(0,r.t)("candlestick.description-low","Minimum value within the period")},close:{key:"close",name:(0,r.t)("candlestick.name-close","Close"),defaults:["close","c"],description:(0,r.t)("candlestick.description-close","Value at the end of the period")},volume:{key:"volume",name:(0,r.t)("candlestick.name-volume","Volume"),defaults:["volume","v"],description:(0,r.t)("candlestick.description-volume","Sample count within the period")}});function Ee(l,d,a){const i=(0,He.UI)(l,a[d.key]);if(!i)for(const f of l.fields){const m=(0,he.Ct)(f,l).toLowerCase();if(d.defaults.includes(m)||d.defaults.includes(f.name))return f}return i}function xe(l,d,a,i){if(!l?.length)return null;const f=Me(),m=d.fields??{},u=l.length===1?(0,we.Yj)(l[0],l[0].fields.findIndex(o=>o.type===de.PU.time)):(0,we.Fd)({frames:l});if(!u?.length)return null;const e={aligned:u,frame:u,names:{}},R=(0,ze.B_)([u],a,i);if(!R)return null;const x=e.frame=R[0],F=x.fields.findIndex(o=>o.type===de.PU.time);if(F<0)return null;const M=new Set;for(const o of Object.values(f)){const C=Ee(x,o,m);C&&(e[o.key]=C,M.add(C))}if(!e.open&&!e.close&&(e.open=x.fields.find(o=>o.type===de.PU.number),e.open&&M.add(e.open)),e.open&&!e.close&&!m.close){const o=e.open.values.slice(1);o.push(o[o.length-1]),e.close={...e.open,values:o,name:"Next open",state:void 0},M.add(e.close),x.fields.push(e.close),e.autoOpenClose=!0}if(e.close&&!e.open&&!m.open){const o=e.close.values.slice();o.unshift(o[0]),o.length=x.length,e.open={...e.close,values:o,name:"Previous close",state:void 0},M.add(e.open),x.fields.push(e.open),e.autoOpenClose=!0}!e.high&&!m.high&&(e.high=e.open),!e.low&&!m.low&&(e.low=e.open),d.mode===p.Volume?(e.high&&(e.high!==e.open&&M.delete(e.high),e.high=void 0),e.low&&(e.low!==e.open&&M.delete(e.low),e.low=void 0)):d.mode===p.Candles&&e.volume&&(M.delete(e.volume),e.volume=void 0);for(const o of Object.values(f)){const C=e[o.key];C&&(e.names[o.key]=(0,he.Ct)(C,e.frame))}const $=x.fields[F],B=[$];d.includeAllFields?B.push(...x.fields.filter(o=>o!==$)):B.push(...M),e.frame={...e.frame,fields:B};for(let o=0;o<e.frame.fields.length;o++){const C=e.frame.fields[o];C.state={...C.state,seriesIndex:o-1,origin:{fieldIndex:o,frameIndex:0}}}return e}var Ke=t(6773);const{alpha:Ce}=Ke.MV;function Qe(l){let{mode:d,candleStyle:a,fields:i,colorStrategy:f,upColor:m,downColor:u,flatColor:e,volumeAlpha:R,flatAsUp:x=!0}=l;const F=d!==p.Volume&&i.high!=null&&i.low!=null,M=F&&a===ce.Candles,$=d!==p.Candles&&i.volume!=null;function B(n,O,V,T,W){return n>0?V:n<0?T:W?V:O}let o=0,C=i.open,fe=i.high,ue=i.low,oe=i.close,P=i.volume;return n=>{let O,V,T,W,G,J;F&&(T=new Path2D,V=new Path2D,O=new Path2D),$&&(W=new Path2D,G=new Path2D,J=new Path2D);let ne=new Path2D,s=n.ctx,k=n.data[o],S=n.data[C],A=n.data[oe],z=F?n.data[fe]:null,se=F?n.data[ue]:null,q=$?n.data[P]:null,E=P!=null?Math.round(n.valToPos(0,n.series[P].scale,!0)):null,[I,_]=n.series[0].idxs,D=n.data[0],L=S,ae=n.bbox.width;if(D.length>1){let c=null;for(let g=0,h=1/0;g<D.length;g++)if(L[g]!==void 0){if(c!=null){let y=Math.abs(D[g]-D[c]);y<h&&(h=y,ae=Math.abs(n.valToPos(D[g],"x",!0)-n.valToPos(D[c],"x",!0)))}c=g}}let K=Math.round(.6*ae),Q=2,j=2;K<=12&&(Q=j=1);let N=Math.floor(K/2);for(let c=I;c<=_;c++){let g=Math.round(n.valToPos(k[c],"x",!0)),h=c===I?0:Math.sign(A[c]-A[c-1]),y=Math.sign(A[c]-S[c]);if($&&J&&G&&W){let v=B(f===H.CloseClose?h:y,J,G,W,c===I&&H.CloseClose?!1:x),U=Math.round(n.valToPos(q[c],n.series[P].scale,!0));v.rect(g-N,U,K,E-U)}if(F&&T&&V&&O){let v=B(f===H.CloseClose?h:y,T,V,O,c===I&&H.CloseClose?!1:x),U=Math.round(n.valToPos(z[c],n.series[fe].scale,!0)),ie=Math.round(n.valToPos(se[c],n.series[ue].scale,!0));v.rect(g-Math.floor(Q/2),U,Q,ie-U);let ee=Math.round(n.valToPos(S[c],n.series[C].scale,!0)),b=Math.round(n.valToPos(A[c],n.series[oe].scale,!0));if(M){let le=Math.min(ee,b),me=Math.max(ee,b),Y=Math.max(1,me-le);v.rect(g-N,le,K,Y),f===H.CloseClose&&y>=0&&Y>j*2&&ne.rect(g-N+j,le+j,K-j*2,Y-j*2)}else v.rect(g-N,ee,N,Q),v.rect(g,b,N,Q)}}s.save(),s.rect(n.bbox.left,n.bbox.top,n.bbox.width,n.bbox.height),s.clip(),$&&J&&G&&W&&(s.fillStyle=Ce(m,R),s.fill(G),s.fillStyle=Ce(u,R),s.fill(W),s.fillStyle=Ce(e,R),s.fill(J)),F&&T&&V&&O&&(s.fillStyle=m,s.fill(V),s.fillStyle=u,s.fill(O),s.fillStyle=e,s.fill(T),s.globalCompositeOperation="destination-out",s.fill(ne)),s.restore()}}const Ye=({data:l,id:d,timeRange:a,timeZone:i,width:f,height:m,options:u,fieldConfig:e,onChangeTimeRange:R,replaceVariables:x})=>{const{sync:F,eventsScope:M,canAddAnnotations:$,onThresholdsChange:B,canEditThresholds:o,showThresholds:C,dataLinkPostProcessor:fe,eventBus:ue}=(0,Te.d2)(),oe=(0,je.$j)(),P=(0,ge.useMemo)(()=>xe(l.series,u,oe,a),[l.series,u,oe,a]),[n,O]=(0,ge.useState)(null),V=F?.()??Se.yV.Off,{renderers:T,tweakScale:W,tweakAxis:G,shouldRenderPrice:J}=(0,ge.useMemo)(()=>{let s=(h,y)=>h,k=(h,y)=>h,S={renderers:[],tweakScale:s,tweakAxis:k,shouldRenderPrice:!1};if(!P)return S;const A=P.names;if(!Object.keys(A).length)return S;const{mode:z,candleStyle:se,colorStrategy:q}=u,E={...pe,...u.colors};let{open:I,high:_,low:D,close:L,volume:ae}=A;if(I==null||L==null)return S;let K=.5,Q=-1,j=!1;if(ae!=null&&z!==p.Candles){let h=P.volume;if(h!=null){j=!0;let{fillOpacity:y}=h.config.custom;y&&(K=y/100),z!==p.Volume&&(h.config={...h.config},h.config.unit="short",h.display=(0,Ie.J)({field:h,theme:re.$W.theme2}),k=(v,U)=>{if(U.name===P.volume?.name){let ie=(ee,b)=>{let le=[],me=ee.series[Q].max;for(let Y=0;Y<b.length&&(le.push(b[Y]),!(me&&b[Y]>me));Y++);return le};v.space=20,v.filter=ie,v.ticks={...v.ticks,filter:ie}}return v},s=(v,U)=>(U.name===P.volume?.name&&(v.range=(ie,ee,b)=>[0,b*7]),v))}}let N=z!==p.Volume&&_!=null&&D!=null;if(!N&&!j)return S;let c={},g=[];return N?c={open:I,high:_,low:D,close:L}:g.push(I,L),j&&(c.volume=ae,c.open=I,c.close=L),{shouldRenderPrice:N,renderers:[{fieldMap:c,indicesOnly:g,init:(h,y)=>{Q=y.volume,h.addHook("drawAxes",Qe({mode:z,fields:y,upColor:re.$W.theme2.visualization.getColorByName(E.up),downColor:re.$W.theme2.visualization.getColorByName(E.down),flatColor:re.$W.theme2.visualization.getColorByName(E.flat),volumeAlpha:K,colorStrategy:q,candleStyle:se,flatAsUp:!0}))}}],tweakScale:s,tweakAxis:k}},[u,l.structureRev,l.series.length]);if(!P)return(0,w.jsx)(De.a,{panelId:d,fieldConfig:e,data:l,needsTimeField:!0,needsNumberField:!0});if(J)for(let s in T[0].fieldMap){let k=P[s];k.config={...k.config,custom:{...k.config.custom,hideFrom:{legend:!0,tooltip:!1,viz:!1}}}}const ne=!!$?.();return(0,w.jsx)($e.Z,{frames:[P.frame],structureRev:l.structureRev,timeRange:a,timeZone:i,width:f,height:m,legend:u.legend,renderers:T,tweakAxis:G,tweakScale:W,options:u,replaceVariables:x,dataLinkPostProcessor:fe,cursorSync:V,children:(s,k)=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Ne.Z,{config:s}),V!==Se.yV.Off&&(0,w.jsx)(Re.K,{config:s,eventBus:ue,frame:k}),u.tooltip.mode!==X.$N.None&&(0,w.jsx)(ve.xl,{config:s,hoverMode:u.tooltip.mode===X.$N.Single?ve.b3.xOne:ve.b3.xAll,queryZoom:R,clientZoom:!0,syncMode:V,syncScope:M,getDataLinks:(S,A)=>k.fields[S].getLinks?.({valueRowIndex:A})??[],render:(S,A,z,se=!1,q,E,I,_)=>{if(ne&&E!=null){O(E),q();return}const D=()=>{let L=S.posToVal(S.cursor.left,"x");O({from:L,to:L}),q()};return(0,w.jsx)(Be.k,{series:k,dataIdxs:A,seriesIdx:z,mode:I?X.$N.Multi:u.tooltip.mode,sortOrder:u.tooltip.sort,isPinned:se,annotate:ne?D:void 0,maxHeight:u.tooltip.maxHeight,replaceVariables:x,dataLinks:_})},maxWidth:u.tooltip.maxWidth}),(0,w.jsx)(We.W,{annotations:l.annotations??[],config:s,timeZone:i,newRange:n,setNewRange:O}),(0,w.jsx)(Ue.U,{config:s,onChangeTimeRange:R}),l.annotations&&(0,w.jsx)(Le.z,{config:s,exemplars:l.annotations,timeZone:i}),(o&&B||C)&&(0,w.jsx)(be.p,{config:s,fieldConfig:e,onThresholdsChange:o?B:void 0})]})})};var Ve=t(38919),Ze=t(73495);class Ge{getSuggestionsForData(d){const{dataSummary:a}=d;if(!d.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const i=xe(d.data.series,Z,Pe.$.theme2);if(!i||i.open===i.high&&i.open===i.low)return;d.getListAppender({name:"",pluginId:"candlestick",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}).append({name:Ze.m.Candlestick,options:Z,fieldConfig:{defaults:{},overrides:[]},score:i.autoOpenClose?Ve.nQ.Good:Ve.nQ.Best})}}const Je=l=>l.type===de.PU.number;function te(l,d,a,i){let f="Auto ";if(a){const m=a[d.key];m?.config?(f+="= "+(0,he.Ct)(m),m===a?.open&&d.key!=="open"&&(f+=` (${d.defaults.join(",")})`)):f+=`(${d.defaults.join(",")})`}l.addFieldNamePicker({path:`fields.${d.key}`,name:d.name,description:d.description,category:i,settings:{filter:Je,placeholderText:f}})}const Xe=new Fe.m(Ye).useFieldConfig((0,ke.V)(ke.S)).setPanelOptions((l,d)=>{const a=[(0,r.t)("candlestick.category-candlestick","Candlestick")],i=d.options??Z,f=xe(d.data,i,Pe.$.theme2);l.addRadio({path:"mode",name:(0,r.t)("candlestick.name-mode","Mode"),category:a,description:"",defaultValue:Z.mode,settings:{options:[{label:(0,r.t)("candlestick.mode-options.label-candles","Candles"),value:p.Candles},{label:(0,r.t)("candlestick.mode-options.label-volume","Volume"),value:p.Volume},{label:(0,r.t)("candlestick.mode-options.label-both","Both"),value:p.CandlesVolume}]}}).addRadio({path:"candleStyle",name:(0,r.t)("candlestick.name-candle-style","Candle style"),category:a,description:"",defaultValue:Z.candleStyle,settings:{options:[{label:(0,r.t)("candlestick.candle-style-options.label-candles","Candles"),value:ce.Candles},{label:(0,r.t)("candlestick.candle-style-options.label-ohlc-bars","OHLC Bars"),value:ce.OHLCBars}]},showIf:u=>u.mode!==p.Volume}).addRadio({path:"colorStrategy",name:(0,r.t)("candlestick.name-color-strategy","Color strategy"),category:a,description:"",defaultValue:Z.colorStrategy,settings:{options:[{label:(0,r.t)("candlestick.color-strategy-options.label-since-open","Since Open"),value:H.OpenClose},{label:(0,r.t)("candlestick.color-strategy-options.label-since-prior-close","Since Prior Close"),value:H.CloseClose}]}}).addColorPicker({path:"colors.up",name:(0,r.t)("candlestick.name-up-color","Up color"),category:a,defaultValue:pe.up}).addColorPicker({path:"colors.down",name:(0,r.t)("candlestick.name-down-color","Down color"),category:a,defaultValue:pe.down});const m=Me();te(l,m.open,f,a),i.mode!==p.Volume&&(te(l,m.high,f,a),te(l,m.low,f,a)),te(l,m.close,f,a),i.mode!==p.Candles&&te(l,m.volume,f,a),l.addRadio({path:"includeAllFields",name:(0,r.t)("candlestick.name-additional-fields","Additional fields"),category:a,description:(0,r.t)("candlestick.description-additional-fields","Use standard timeseries options to configure any fields not mapped above"),defaultValue:Z.includeAllFields,settings:{options:[{label:(0,r.t)("candlestick.additional-fields-options.label-ignore","Ignore"),value:!1},{label:(0,r.t)("candlestick.additional-fields-options.label-include","Include"),value:!0}]}}),Oe.D(l,!1,!0),Ae.H(l)}).setDataSupport({annotations:!0,alertStates:!0}).setSuggestionsSupplier(new Ge)}}]);

//# sourceMappingURL=candlestickPanel.a068aacc4ea348d6ba90.js.map