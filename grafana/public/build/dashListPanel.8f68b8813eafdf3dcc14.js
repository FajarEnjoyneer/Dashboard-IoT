"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8995],{30783:(fe,P,s)=>{s.r(P),s.d(P,{plugin:()=>ne});var h=s(74848),L=s(16207),u=s(92745),M=s(10928),E=s(91156),F=s(2543),g=s(96540),$=s(64305),A=function(e,t){t===void 0&&(t=200);var n=(0,g.useState)(e),l=n[0],d=n[1],c=(0,g.useRef)(),w=(0,g.useRef)(null),S=(0,g.useRef)(0);return(0,g.useEffect)(function(){if(c.current)w.current=e,S.current=!0;else{d(e);var y=function(){S.current?(S.current=!1,d(w.current),c.current=setTimeout(y,t)):c.current=void 0};c.current=setTimeout(y,t)}},[e]),(0,$.A)(function(){c.current&&clearTimeout(c.current)}),l};const z=A;var b=s(83175),O=s(63704),j=s(38036),Q=s(63142),G=s(76319),K=s(92807),J=s(6890),W=s(65642),X=s(73427),Y=s(94232),T=s(38206),Z=s(43550),R=s(83873),k=s(67020),q=s(22429),_=s(88813),B=s(52763),v=s(22803);const ee=e=>({dashlistSectionHeader:(0,v.css)({padding:e.spacing(.25,1),marginRight:e.spacing(1)}),dashlistSection:(0,v.css)({marginBottom:e.spacing(2),paddingTop:e.spacing(.5)}),dashlistLink:(0,v.css)({display:"flex",cursor:"pointer",borderBottom:`1px solid ${e.colors.border.weak}`,margin:e.spacing(1),padding:e.spacing(1),alignItems:"center","&:hover":{a:{color:e.colors.text.link,textDecoration:"underline"}}}),dashlistFolder:(0,v.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,lineHeight:e.typography.body.lineHeight}),dashlistTitle:(0,v.css)({"&::after":{position:"absolute",content:'""',left:0,top:0,bottom:0,right:0}}),dashlistLinkBody:(0,v.css)({flexGrow:1}),dashlistItem:(0,v.css)({position:"relative",listStyle:"none"})});async function te(e,t){let n=Promise.resolve([]);if(e.showStarred){const r={limit:e.maxItems,starred:"true"};n=(0,R.AI)().search(r)}let l=Promise.resolve([]),d=[];if(e.showRecentlyViewed){let r=await k.A.getDashboardOpened();d=(0,F.take)(r,e.maxItems),l=(0,R.AI)().search({dashboardUIDs:d,limit:e.maxItems})}let c=Promise.resolve([]);if(e.showSearch){const r=e.folderUID===""?"general":e.folderUID,x={limit:e.maxItems,query:t(e.query,{},"text"),folderUIDs:r,tag:e.tags.map(V=>t(V,{},"text")),type:"dash-db"};c=(0,R.AI)().search(x)}const[w,S,y]=await Promise.all([n,c,l]);let f=new Map;for(const r of d){const x=y.find(V=>V.uid===r);x&&f.set(r,{...x,isRecent:!0})}return S.forEach(r=>{r.uid&&(f.has(r.uid)?f.get(r.uid).isSearchResult=!0:f.set(r.uid,{...r,isSearchResult:!0}))}),w.forEach(r=>{r.uid&&(f.has(r.uid)?f.get(r.uid).isStarred=!0:f.set(r.uid,{...r,isStarred:!0}))}),f}function se(e){const[t,n]=(0,g.useState)(new Map),l=(0,B.wA)(),d=(0,B.d4)(i=>i.navIndex),c=z(e.renderCounter,5e3);(0,g.useEffect)(()=>{te(e.options,e.replaceVariables).then(i=>{n(i)})},[e.options,e.replaceVariables,c]);const w=async(i,a)=>{const{uid:o,title:D,url:H}=a;i.preventDefault(),i.stopPropagation();const U=await(0,q.UA)().starDashboard(a.uid,a.isStarred),N=new Map(t);N.set(a?.uid??"",{...a,isStarred:U}),n(N),l((0,T.ci)({id:o??"",title:D,url:H,isStarred:U}));const p=d.starred;if(U)p.children?.push({id:T.L1+o,text:D,url:H??"",parentItem:p});else{l((0,Z.Im)(T.L1+o));const C=p.children?.findIndex(me=>me.id===T.L1+o);C&&p.children?.splice(C,1)}l((0,J.Vz)(p))},[S,y,f]=(0,g.useMemo)(()=>{const i=[...t.values()];return[i.filter(a=>a.isStarred).sort((a,o)=>a.title.localeCompare(o.title)),i.filter(a=>a.isRecent),i.filter(a=>a.isSearchResult).sort((a,o)=>a.title.localeCompare(o.title))]},[t]),{showStarred:r,showRecentlyViewed:x,showHeadings:V,showFolderNames:ie,showSearch:le}=e.options,ce=[{header:"Starred dashboards",dashboards:S,show:r},{header:"Recently viewed dashboards",dashboards:y,show:x},{header:"Search",dashboards:f,show:le}],I=(0,Q.of)(ee),he=ae(e),ue=i=>(0,h.jsx)("ul",{children:i.map(a=>{let o=a.url;return o=b.kM.appendQueryToUrl(o,he),o=(0,W.zj)().disableSanitizeHtml?o:O.sQ.sanitizeUrl(o),(0,h.jsx)("li",{className:I.dashlistItem,children:(0,h.jsxs)("div",{className:I.dashlistLink,children:[(0,h.jsxs)("div",{className:I.dashlistLinkBody,children:[(0,h.jsx)("a",{className:I.dashlistTitle,href:o,children:a.title}),ie&&a.folderTitle&&(0,h.jsx)("div",{className:I.dashlistFolder,children:a.folderTitle})]}),(0,h.jsx)(G.K,{tooltip:a.isStarred?`Unmark "${a.title}" as favorite`:`Mark "${a.title}" as favorite`,name:a.isStarred?"favorite":"star",iconType:a.isStarred?"mono":"default",onClick:D=>w(D,a)})]})},`dash-${a.uid}`)})});return(0,h.jsx)(K.P,{minHeight:"100%",children:ce.map(({show:i,header:a,dashboards:o},D)=>i&&(0,h.jsxs)("div",{className:I.dashlistSection,children:[V&&(0,h.jsx)("h6",{className:I.dashlistSectionHeader,children:a}),ue(o)]},`dash-group-${D}`))})}function ae(e){(0,Y.u)(X.lE,_.og);let t={};return e.options.keepTime&&(t[`$${j.c.keepTime}`]=!0),e.options.includeVars&&(t[`$${j.c.includeVars}`]=!0),e.replaceVariables(b.kM.toUrlParams(t))}var re=s(68143);async function oe(e){return e===0?"":(await(0,re.AI)().get(`/api/folders/id/${e}`,void 0,void 0,{showErrorAlert:!1})).uid}async function de(e){const t={...e.options,showStarred:e.options.showStarred??e.starred,showRecentlyViewed:e.options.showRecentlyViewed??e.recent,showSearch:e.options.showSearch??e.search,showHeadings:e.options.showHeadings??e.headings,maxItems:e.options.maxItems??e.limit,query:e.options.query??e.query,folderId:e.options.folderId??e.folderId,tags:e.options.tags??e.tags};if(parseFloat(e.pluginVersion||"6.1")<6.3&&["starred","recent","search","headings","limit","query","folderId"].forEach(d=>delete e[d]),t.folderId!==void 0){const l=t.folderId;try{const d=await oe(l);t.folderUID=d,delete t.folderId}catch(d){console.warn("Dashlist: Error migrating folder ID to UID",d)}}return t}const m={includeVars:!1,keepTime:!1,maxItems:10,query:"",showFolderNames:!0,showHeadings:!0,showRecentlyViewed:!1,showSearch:!1,showStarred:!0,tags:[]},ne=new L.m(se).setPanelOptions(e=>{const t=[(0,u.t)("dashlist.category-dashboard-list","Dashboard list")];e.addBooleanSwitch({path:"keepTime",name:(0,u.t)("dashlist.name-include-current-time-range","Include current time range"),category:t,defaultValue:m.keepTime}).addBooleanSwitch({path:"includeVars",name:(0,u.t)("dashlist.name-include-current-template-variables","Include current template variable values"),category:t,defaultValue:m.includeVars}).addBooleanSwitch({path:"showStarred",name:(0,u.t)("dashlist.name-starred","Starred"),category:t,defaultValue:m.showStarred}).addBooleanSwitch({path:"showRecentlyViewed",name:(0,u.t)("dashlist.name-recently-viewed","Recently viewed"),category:t,defaultValue:m.showRecentlyViewed}).addBooleanSwitch({path:"showSearch",name:(0,u.t)("dashlist.name-search","Search"),category:t,defaultValue:m.showSearch}).addBooleanSwitch({path:"showHeadings",name:(0,u.t)("dashlist.name-show-headings","Show headings"),category:t,defaultValue:m.showHeadings}).addBooleanSwitch({path:"showFolderNames",name:(0,u.t)("dashlist.name-show-folder-names","Show folder names"),category:t,defaultValue:m.showFolderNames}).addNumberInput({path:"maxItems",name:(0,u.t)("dashlist.name-max-items","Max items"),category:t,defaultValue:m.maxItems}).addTextInput({path:"query",name:(0,u.t)("dashlist.name-query","Query"),category:t,defaultValue:m.query}).addCustomEditor({path:"folderUID",name:(0,u.t)("dashlist.name-folder","Folder"),category:t,id:"folderUID",defaultValue:void 0,editor:function({value:l,onChange:d}){return(0,h.jsx)(E.d,{clearable:!0,permission:"view",value:l,onChange:c=>d(c)})}}).addCustomEditor({id:"tags",path:"tags",name:(0,u.t)("dashlist.name-tags","Tags"),category:t,description:"",defaultValue:m.tags,editor(n){return(0,h.jsx)(M.u,{tags:n.value,onChange:n.onChange})}})}).setMigrationHandler(de)}}]);

//# sourceMappingURL=dashListPanel.8f68b8813eafdf3dcc14.js.map