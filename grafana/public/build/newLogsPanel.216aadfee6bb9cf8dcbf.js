"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3976,9604],{6567:(S,w,n)=>{n.r(w),n.d(w,{plugin:()=>k});var V=n(16207),o=n(739),u=n(67770),t=n(92745),p=n(74848),j=n(22803),l=n(96540),B=n(28105),O=n(57852),d=n(1906),T=n(75234),Y=n(43173),F=n(63142),I=n(64400),J=n(49356),A=n(88642),L=n(37234),N=n(78368),$=n(24567);function G(e){return typeof e=="function"}function U(e){return typeof e=="function"}function Q(e){return e!==null&&typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype}function W(e){const s=Object.values(d.Jk).map(g=>g.toString());return typeof e=="string"&&s.includes(e)}const z=({data:e,timeZone:s,fieldConfig:g,options:{controlsStorageKey:i,dedupStrategy:f,enableInfiniteScrolling:q,grammar:b,onLogOptionsChange:C,onNewLogsReceived:m,showControls:_,showTime:ee,sortOrder:c,syntaxHighlighting:ne,wrapLogMessage:te},id:h})=>{const se=(0,F.of)(K),[D,oe]=(0,l.useState)(null),[r,P]=(0,l.useState)(e),E=(0,$.O)(e.request?.targets),le=(0,l.useRef)(!1),v=(0,l.useRef)(!1),{app:M,eventBus:H}=(0,I.d2)(),y=(0,l.useMemo)(()=>{const a=r?(0,L.HT)(r.series,r.request?.intervalMs,void 0,r.request?.targets):null;return a?(0,L.M0)(a.rows,f):[]},[f,r]);(0,l.useEffect)(()=>{(0,T.J7)().publish(new u.Df({order:c}))},[c]),(0,l.useEffect)(()=>{e.state!==B.Gu.Loading&&P(e)},[e]);const ae=(0,l.useCallback)(async a=>{if(!e.request||!Y.$.featureToggles.logsInfiniteScrolling||v.current)return;v.current=!0;const ue=G(m)?m:void 0;let R=[];try{R=await(0,N.g)(E,r,a,s,ue)}catch(ce){console.error(ce)}finally{v.current=!1}le.current=!0,P({...r,series:R})},[e.request,E,m,r,s]),ie=(0,l.useCallback)(a=>{a&&H.publish(new O.b_({point:{time:a.timeEpochMs}}))},[H]),re=(0,l.useMemo)(()=>(e.request?.app===d.Jk.Dashboard||e.request?.app===d.Jk.PanelEditor)&&c===o.uH.Ascending?"bottom":"top",[e.request?.app,c]),ge=(0,l.useMemo)(()=>{if(i)return i;if(e.request)return`${e.request?.dashboardUID}.${h}`},[i,e.request,h]);return y.length?(0,p.jsx)("div",{className:se.container,ref:a=>oe(a),children:y.length>0&&D&&(0,p.jsx)(J.Z,{app:W(M)?M:d.Jk.Dashboard,containerElement:D,dedupStrategy:f,displayedFields:[],enableLogDetails:!0,grammar:Q(b)?b:void 0,initialScrollPosition:re,logs:y,loadMore:q?ae:void 0,onLogOptionsChange:U(C)?C:void 0,onLogLineHover:ie,showControls:_,showTime:ee,sortOrder:c,logOptionsStorageKey:ge,syntaxHighlighting:ne,timeRange:e.timeRange,timeZone:s,wrapLogMessage:te})}):(0,p.jsx)(A.a,{fieldConfig:g,panelId:h,data:e,needsStringField:!0})},K=e=>({container:(0,j.css)({marginBottom:e.spacing(1.5),minHeight:"100%",maxHeight:"100%",display:"flex",flex:1,flexDirection:"column"})});var X=n(38919),x=n(73495);class Z{getSuggestionsForData(s){const g=s.getListAppender({name:"",pluginId:"logs-new",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}),{dataSummary:i}=s;!i.hasData||!i.hasTimeField||!i.hasStringField||(i.preferredVisualisationType==="logs"?g.append({name:x.m.Logs,score:X.nQ.Best}):g.append({name:x.m.Logs}))}}const k=new V.m(z).setPanelOptions(e=>{const s=[(0,t.t)("logs-new.category-logs","Logs")];e.addBooleanSwitch({path:"showTime",name:(0,t.t)("logs-new.name-time","Time"),category:s,description:"",defaultValue:!1}).addBooleanSwitch({path:"wrapLogMessage",name:(0,t.t)("logs-new.name-wrap-lines","Wrap lines"),category:s,description:"",defaultValue:!1}).addBooleanSwitch({path:"syntaxHighlighting",name:(0,t.t)("logs-new.name-syntax-highlighting","Enable syntax highlighting"),category:s,description:(0,t.t)("logs-new.description-syntax-highlighting","Use a predefined syntax coloring grammar to highlight relevant parts of the log lines"),defaultValue:!0}).addBooleanSwitch({path:"enableLogDetails",name:(0,t.t)("logs-new.name-enable-log-details","Enable log details"),category:s,description:"",defaultValue:!0}).addBooleanSwitch({path:"showControls",name:(0,t.t)("logs-new.name-show-controls","Show controls"),category:s,description:(0,t.t)("logs-new.description-show-controls","Display controls to jump to the last or first log line, and filters by log level"),defaultValue:!1}).addBooleanSwitch({path:"enableInfiniteScrolling",name:(0,t.t)("logs-new.name-infinite-scrolling","Enable infinite scrolling"),category:s,description:(0,t.t)("logs-new.description-infinite-scrolling","Experimental. Request more results by scrolling to the bottom of the logs list."),defaultValue:!1}).addRadio({path:"dedupStrategy",name:(0,t.t)("logs-new.name-deduplication","Deduplication"),category:s,description:"",settings:{options:[{value:o.fY.none,label:(0,t.t)("logs-new.deduplication-options.label-none","None"),description:u._C[o.fY.none]},{value:o.fY.exact,label:(0,t.t)("logs-new.deduplication-options.label-exact","Exact"),description:u._C[o.fY.exact]},{value:o.fY.numbers,label:(0,t.t)("logs-new.deduplication-options.label-numbers","Numbers"),description:u._C[o.fY.numbers]},{value:o.fY.signature,label:(0,t.t)("logs-new.deduplication-options.label-signature","Signature"),description:u._C[o.fY.signature]}]},defaultValue:o.fY.none}).addRadio({path:"sortOrder",name:(0,t.t)("logs-new.name-order","Order"),category:s,description:"",settings:{options:[{value:o.uH.Descending,label:(0,t.t)("logs-new.order-options.label-newest-first","Newest first")},{value:o.uH.Ascending,label:(0,t.t)("logs-new.order-options.label-oldest-first","Oldest first")}]},defaultValue:o.uH.Descending})}).setSuggestionsSupplier(new Z)},51814:S=>{S.exports={}}}]);

//# sourceMappingURL=newLogsPanel.216aadfee6bb9cf8dcbf.js.map