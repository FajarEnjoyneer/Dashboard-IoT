"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[563],{55569:(Ke,E,s)=>{s.r(E),s.d(E,{plugin:()=>ke});var se=s(16207),A=s(92745),V=s(79277),oe=s(41069),g=s(74848),M=s(96540),ne=s(39443),U=s(84229),le=s(14477),t=s(739),ae=s(64400),re=s(93630),de=s(18667),G=s(69234),fe=s(3041),me=s(65642),ce=s(78308),ue=s(36327),Y=s(57632),he=s(13507),ge=s(66881),B=s(64394),pe=s(64761),Z=s(22429),x=s(73495);class ve{getSuggestionsForData(o){const{dataSummary:i}=o;if(!i.hasTimeField||!i.hasNumberField||i.rowCountTotal<2)return;const d=o.getListAppender({name:x.m.LineChart,pluginId:"timeseries",options:{legend:{calcs:[],displayMode:t.lm.Hidden,placement:"right",showLegend:!1}},fieldConfig:{defaults:{custom:{}},overrides:[]},cardOptions:{previewModifier:n=>{n.fieldConfig?.defaults.custom?.drawStyle!==t.GR.Bars&&(n.fieldConfig.defaults.custom.lineWidth=Math.max(n.fieldConfig.defaults.custom.lineWidth??1,2))}}}),f=100;if(d.append({name:x.m.LineChart}),i.rowCountMax<200&&d.append({name:x.m.LineChartSmooth,fieldConfig:{defaults:{custom:{lineInterpolation:t.dx.Smooth}},overrides:[]}}),i.numberFieldCount===1){d.append({name:x.m.AreaChart,fieldConfig:{defaults:{custom:{fillOpacity:25}},overrides:[]}}),d.append({name:x.m.LineChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:B.Y.ContinuousGrYlRd},custom:{gradientMode:t.on.Scheme,lineInterpolation:t.dx.Smooth,lineWidth:3,fillOpacity:20}},overrides:[]}}),i.rowCountMax<f&&(d.append({name:x.m.BarChart,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue}},overrides:[]}}),d.append({name:x.m.BarChartGradientColorScheme,fieldConfig:{defaults:{color:{mode:B.Y.ContinuousGrYlRd},custom:{drawStyle:t.GR.Bars,fillOpacity:90,lineWidth:1,gradientMode:t.on.Scheme}},overrides:[]}}));return}d.append({name:x.m.AreaChartStacked,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.AreaChartStackedPercent,fieldConfig:{defaults:{custom:{fillOpacity:25,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}),i.rowCountTotal/i.numberFieldCount<f&&(d.append({name:x.m.BarChartStacked,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Normal,group:"A"}}},overrides:[]}}),d.append({name:x.m.BarChartStackedPercent,fieldConfig:{defaults:{custom:{drawStyle:t.GR.Bars,fillOpacity:100,lineWidth:1,gradientMode:t.on.Hue,stacking:{mode:t.gs.Percent,group:"A"}}},overrides:[]}}))}}function ye(e){const o=(0,Z.UA)().getCurrent()?.getPanelById(e);if(o){const i=o.transformations?[...o.transformations]:[];return i.push({id:pe.F.prepareTimeSeries,options:{format:"wide"}}),{name:"Transform to wide time series format",pluginId:"timeseries",transformations:i}}}var K=s(76234);const Ce=({data:e,timeRange:o,timeZone:i,width:d,height:f,options:n,fieldConfig:u,onChangeTimeRange:l,replaceVariables:h,id:S})=>{const{sync:L,eventsScope:c,canAddAnnotations:a,onThresholdsChange:r,canEditThresholds:p,showThresholds:T,dataLinkPostProcessor:m,eventBus:v}=(0,ae.d2)(),O=n.orientation===t.wV.Vertical,N=(0,M.useMemo)(()=>(0,K.B_)(e.series,me.$W.theme2,o),[e.series,o]),be=(0,M.useMemo)(()=>(0,K.Fg)(n.timezone,i),[n.timezone,i]),H=(0,M.useMemo)(()=>{if(N?.length&&N.every(C=>C.meta?.type===ne.m.TimeSeriesLong)){const C=ye(S);return{message:"Long data must be converted to wide",suggestions:C?[C]:void 0}}},[N,S]),_=!!(a&&a()),[we,j]=(0,M.useState)(null),k=L?.()??U.y.Off;return!N||H?(0,g.jsx)(le.a,{panelId:S,message:H?.message,fieldConfig:u,data:e,needsTimeField:!0,needsNumberField:!0,suggestions:H?.suggestions}):(0,g.jsx)(fe.Z,{frames:N,structureRev:e.structureRev,timeRange:o,timeZone:be,width:d,height:f,legend:n.legend,options:n,replaceVariables:h,dataLinkPostProcessor:m,cursorSync:k,children:(C,b)=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(re.Z,{config:C}),k!==U.y.Off&&(0,g.jsx)(de.K,{config:C,eventBus:v,frame:b}),n.tooltip.mode!==t.$N.None&&(0,g.jsx)(G.xl,{config:C,hoverMode:n.tooltip.mode===t.$N.Single?G.b3.xOne:G.b3.xAll,queryZoom:l,clientZoom:!0,syncMode:k,syncScope:c,getDataLinks:(F,w)=>b.fields[F].getLinks?.({valueRowIndex:w})??[],render:(F,w,Ee,Ve=!1,ee,te,Ue,Ye)=>{if(_&&te!=null){j(te),ee();return}const Ze=()=>{let ie=F.posToVal(F.cursor.left,"x");j({from:ie,to:ie}),ee()};return(0,g.jsx)(ce.k,{series:b,dataIdxs:w,seriesIdx:Ee,mode:Ue?t.$N.Multi:n.tooltip.mode,sortOrder:n.tooltip.sort,hideZeros:n.tooltip.hideZeros,isPinned:Ve,annotate:_?Ze:void 0,maxHeight:n.tooltip.maxHeight,replaceVariables:h,dataLinks:Ye})},maxWidth:n.tooltip.maxWidth}),!O&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(ue.W,{annotations:e.annotations??[],config:C,timeZone:i,newRange:we,setNewRange:j}),(0,g.jsx)(he.U,{config:C,onChangeTimeRange:l}),e.annotations&&(0,g.jsx)(Y.z,{visibleSeries:(0,Y.e)(C,N),config:C,exemplars:e.annotations,timeZone:i,maxHeight:n.tooltip.maxHeight}),(p&&r||T)&&(0,g.jsx)(ge.p,{config:C,fieldConfig:u,onThresholdsChange:p?r:void 0})]})]})})};var J=s(22803),z=s(62717),xe=s(63142),Se=s(59310),Q=s(76319);const Te=({value:e,onChange:o})=>{const i=(0,xe.of)(Le);(!e||e.length<1)&&(e=[""]);const d=()=>{o([...e,z.g$.default])},f=u=>{const l=e.slice();l.splice(u,1),o(l)},n=(u,l)=>{const h=e.slice();h[u]=l??z.g$.default,h.length===0||h.length===1&&h[0]===""?o(void 0):o(h)};return(0,g.jsx)("ul",{className:i.list,children:e.map((u,l)=>(0,g.jsxs)("li",{className:i.listItem,children:[(0,g.jsx)(Se.U,{onChange:h=>n(l,h),includeInternal:!0,value:u??z.g$.default}),l===e.length-1?(0,g.jsx)(Q.K,{name:"plus",onClick:d,tooltip:(0,A.t)("timeseries.timezones-editor.tooltip-add-timezone","Add timezone")}):(0,g.jsx)(Q.K,{name:"times",onClick:()=>f(l),tooltip:(0,A.t)("timeseries.timezones-editor.tooltip-remove-timezone","Remove timezone")})]},`${l}.${u}`))})},Le=e=>({list:(0,J.css)({listStyle:"none",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),listItem:(0,J.css)({display:"flex",gap:e.spacing(1)})});var R=s(12241),y=s(2543),P=s(57866),Oe=s(83340),Ne=s(28105),W=s(46644),Pe=s(33553),Ae=s(95004),Me=s(75421),Be=s(49e3),Re=s(72746),Fe=s(1682),Ge=s(8095);let D=null;const ze=(e,o,i,d)=>{if(o==="graph"&&i.angular){const{fieldConfig:f,options:n,annotations:u}=We({...i.angular,fieldConfig:d,panel:e});return u?.length>0&&je(u),e.fieldConfig=f,e.alert=i.angular.alert,n}return $e(e),{}};function We(e){let o=[];const i=e.fieldConfig?.overrides??[],d=e.yaxes??[];let f=X(d[0]);e.fieldConfig?.defaults&&(f={...e.fieldConfig?.defaults,...f});const n={fill:e.dashes?"dash":"solid",dash:[e.dashLength??10,e.spaceLength??10]};if(e.aliasColors)for(const c of Object.keys(e.aliasColors)){const a=e.aliasColors[c];a&&i.push({matcher:{id:P.Ct.byName,options:c},properties:[{id:Oe.uo.Color,value:{mode:B.Y.Fixed,fixedColor:a}}]})}let u=!1;if(e.seriesOverrides?.length)for(const c of e.seriesOverrides){if(!c.alias)continue;const r={matcher:{id:/^([/~@;%#'])(.*?)\1([gimsuy]*)$/.test(c.alias)?P.Ct.byRegexp:P.Ct.byName,options:c.alias},properties:[]};let p;for(const T of Object.keys(c)){const m=c[T];switch(T){case"alias":case"$$hashKey":break;case"yaxis":if(m===2){const v=X(d[1]);De(f,v,r.properties)}break;case"fill":r.properties.push({id:"custom.fillOpacity",value:m*10});break;case"fillBelowTo":u=!0,r.properties.push({id:"custom.fillBelowTo",value:m});break;case"fillGradient":m&&(r.properties.push({id:"custom.fillGradient",value:"opacity"}),r.properties.push({id:"custom.fillOpacity",value:m*10}));break;case"points":r.properties.push({id:"custom.showPoints",value:m?t.yL.Always:t.yL.Never});break;case"bars":m?(r.properties.push({id:"custom.drawStyle",value:t.GR.Bars}),r.properties.push({id:"custom.fillOpacity",value:100})):r.properties.push({id:"custom.drawStyle",value:t.GR.Line});break;case"lines":m?r.properties.push({id:"custom.drawStyle",value:"line"}):r.properties.push({id:"custom.lineWidth",value:0});break;case"linewidth":r.properties.push({id:"custom.lineWidth",value:m});break;case"pointradius":r.properties.push({id:"custom.pointSize",value:2+m*2});break;case"dashLength":case"spaceLength":case"dashes":switch(p||(p={fill:n.fill,dash:[...n.dash]}),T){case"dashLength":p.dash[0]=m;break;case"spaceLength":p.dash[1]=m;break;case"dashes":p.fill=m?"dash":"solid";break}break;case"stack":r.properties.push({id:"custom.stacking",value:He(m)});break;case"color":r.properties.push({id:"color",value:{fixedColor:m,mode:B.Y.Fixed}});break;case"transform":r.properties.push({id:"custom.transform",value:m==="negative-Y"?t.NU.NegativeY:t.NU.Constant});break;default:console.log("Ignore override migration:",c.alias,T,m)}}p&&r.properties.push({id:"custom.lineStyle",value:p}),r.properties.length&&i.push(r)}const l=f.custom??{};l.drawStyle=e.bars?t.GR.Bars:e.lines?t.GR.Line:t.GR.Points,e.points?(l.showPoints=t.yL.Always,(0,y.isNumber)(e.pointradius)&&(l.pointSize=2+e.pointradius*2)):l.drawStyle!==t.GR.Points&&(l.showPoints=t.yL.Never),l.lineWidth=e.linewidth,n.fill!=="solid"&&(l.lineStyle=n),u?l.fillOpacity=35:(0,y.isNumber)(e.fill)&&(l.fillOpacity=e.fill*10),(0,y.isNumber)(e.fillGradient)&&e.fillGradient>0&&(l.gradientMode=t.on.Opacity,l.fillOpacity=e.fillGradient*10),l.spanNulls=e.nullPointMode===Ne.UW.Ignore,e.steppedLine&&(l.lineInterpolation=t.dx.StepAfter),l.drawStyle===t.GR.Bars&&(l.fillOpacity=100),e.stack&&(l.stacking={mode:e.percentage?t.gs.Percent:t.gs.Normal,group:R.S.stacking.group},e.percentage&&e.yaxis&&(delete f.min,delete f.max,f.decimals===0&&delete f.decimals)),f.custom=(0,y.omitBy)(l,y.isNil),f.nullValueMode=e.nullPointMode;const h={legend:{displayMode:t.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:t.$N.Single,sort:t.xB.None}},S=e.legend;if(S){if(S.show?h.legend.displayMode=S.alignAsTable?t.lm.Table:t.lm.List:h.legend.showLegend=!1,S.rightSide&&(h.legend.placement="right"),e.legend.values){const c=(0,y.pickBy)(e.legend);h.legend.calcs=Ie(c)}e.legend.sideWidth&&(h.legend.width=e.legend.sideWidth),S.hideZero&&i.push(q(W.gy.allIsZero)),S.hideEmpty&&i.push(q(W.gy.allIsNull))}e.timeRegions?.length&&e.timeRegions.map((a,r)=>({name:`T${r}`,color:a.colorMode!=="custom"?a.colorMode:a.fillColor,line:a.line,fill:a.fill,fromDayOfWeek:a.fromDayOfWeek,toDayOfWeek:a.toDayOfWeek,from:a.from,to:a.to})).forEach((a,r)=>{const p={datasource:{type:"datasource",uid:"grafana"},enable:!0,hide:!0,filter:{exclude:!1,ids:[e.panel.id]},iconColor:a.fillColor??a.color,name:`Time region for panel ${e.panel.title}${r>0?` ${r}`:""}`,target:{queryType:Ge.nj.TimeRegions,refId:"Anno",timeRegion:{fromDayOfWeek:a.fromDayOfWeek,toDayOfWeek:a.toDayOfWeek,from:a.from,to:a.to,timezone:"utc"}}};a.fill?o.push(p):a.line&&(p.iconColor=a.lineColor??"white",o.push(p))});const L=e.tooltip;if(L&&(L.shared!==void 0&&(h.tooltip.mode=L.shared?t.$N.Multi:t.$N.Single),L.sort!==void 0&&L.shared))switch(L.sort){case 1:h.tooltip.sort=t.xB.Ascending;break;case 2:h.tooltip.sort=t.xB.Descending;break;default:h.tooltip.sort=t.xB.None}if(e.thresholds&&e.thresholds.length>0){let c=[],a=!1,r=!1;const p=e.thresholds.sort((m,v)=>m.value>v.value?1:-1);for(let m=0;m<p.length;m++){const v=p[m],O=p.length>m+1?p[m+1]:null;v.fill&&(a=!0),v.line&&(r=!0),v.op==="gt"&&c.push({value:v.value,color:I(v)}),v.op==="lt"&&(c.length===0&&c.push({value:-1/0,color:I(v)}),O&&O.op==="gt"&&O.value>v.value?c.push({value:v.value,color:"transparent"}):O&&O.op==="lt"?c.push({value:v.value,color:I(O)}):c.push({value:v.value,color:"transparent"}))}c.length>0&&c[0].value!==-1/0&&c.unshift({color:"transparent",value:-1/0});let T=a?t.Ly.Area:t.Ly.Line;r&&a&&(T=t.Ly.LineAndArea),f.custom.thresholdsStyle={mode:T},f.thresholds={mode:Pe.O.Absolute,steps:c}}return e.xaxis&&e.xaxis.show===!1&&e.xaxis.mode==="time"&&i.push({matcher:{id:P.Ct.byType,options:Ae.PU.time},properties:[{id:"custom.axisPlacement",value:t.vM.Hidden}]}),{fieldConfig:{defaults:(0,y.omitBy)(f,y.isNil),overrides:i},options:h,annotations:o}}function I(e){return e.colorMode==="critical"?"red":e.colorMode==="warning"?"orange":e.colorMode==="custom"?e.fillColor||e.lineColor:"red"}function X(e){if(!e)return{};const o={axisPlacement:e.show?t.vM.Auto:t.vM.Hidden};if(e.label&&(o.axisLabel=e.label),e.logBase){const i=e.logBase;(i===2||i===10)&&(o.scaleDistribution={type:t.L4.Log,log:i})}return(0,y.omitBy)({unit:e.format,decimals:$(e.decimals),min:$(e.min),max:$(e.max),custom:o},y.isNil)}function De(e,o,i){for(const[n,u]of Object.entries(o))n!=="custom"&&u!==e[n]&&i.push({id:n,value:u});i.push({id:"custom.axisPlacement",value:t.vM.Right});const d=e.custom??{},f=o.custom??{};for(const[n,u]of Object.entries(f))u!==d[n]&&i.push({id:`custom.${n}`,value:u})}function $(e){if((0,y.isNumber)(e))return e;if((0,y.isString)(e)){const o=Number(e);if(!isNaN(o))return o}}function Ie(e){const o=[];for(const i in e){const d=W.AS.getIfExists(i);d&&o.push(d.id)}return o}function $e(e){e.fieldConfig?.defaults?.custom?.hideFrom?.graph!==void 0&&(e.fieldConfig.defaults.custom.hideFrom.viz=e.fieldConfig.defaults.custom.hideFrom.graph,delete e.fieldConfig.defaults.custom.hideFrom.graph),e.fieldConfig?.overrides&&(e.fieldConfig.overrides=e.fieldConfig.overrides.map(o=>(o.properties=o.properties.map(i=>(i.id==="custom.hideFrom"&&i.value.graph&&(i.value.viz=i.value.graph,delete i.value.graph),i)),o)))}function q(e){return{matcher:{id:P.Ct.byValue,options:{reducer:e,op:t.zT.GTE,value:0}},properties:[{id:"custom.hideFrom",value:{tooltip:!0,viz:!1,legend:!0}}]}}function He(e){const o=R.S.stacking?.group;return{mode:e?t.gs.Normal:t.gs.None,group:(0,y.isString)(e)?e:o}}function je(e){const o=window.__grafanaSceneContext;if(o instanceof Re.H$){const d=Fe.b4.getDataLayers(o),f=[...d.state.annotationLayers];for(let n of e){const u=new Be.g({key:`annotations-${n.name}`,query:n,name:n.name,isEnabled:n.enable,isHidden:n.hide});f.push(u)}d.setState({annotationLayers:f});return}const i=(0,Z.UA)().getCurrent();i&&(i.annotations.list=[...i.annotations.list,...e],D==null&&(D=setTimeout(()=>{D=null,(0,Me.jG)().refreshTimeModel()})))}const ke=new se.m(Ce).setPanelChangeHandler(ze).useFieldConfig((0,R.V)(R.S)).setPanelOptions(e=>{V.D(e,!1,!0,V.U),oe.H(e),e.addCustomEditor({id:"timezone",name:(0,A.t)("timeseries.name-time-zone","Time zone"),path:"timezone",category:[(0,A.t)("timeseries.category-axis","Axis")],editor:Te,defaultValue:void 0})}).setSuggestionsSupplier(new ve).setDataSupport({annotations:!0,alertStates:!0})}}]);

//# sourceMappingURL=timeseriesPanel.207e38bf6845ace1e501.js.map