(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1213],{11908:(S,v,d)=>{"use strict";d.d(v,{s:()=>n});var n;(function(o){o[o.UNSET=0]="UNSET",o[o.OK=1]="OK",o[o.ERROR=2]="ERROR"})(n||(n={}))},75888:(S,v,d)=>{"use strict";S.exports=function(n,o){var h=this,I=h.constructor;return h.options=Object.assign({storeInstancesGlobally:!0},o||{}),h.callbacks={},h.directMap={},h.sequenceLevels={},h.resetTimer=null,h.ignoreNextKeyup=!1,h.ignoreNextKeypress=!1,h.nextExpectedAction=!1,h.element=n,h.addEvents(),h.options.storeInstancesGlobally&&I.instances.push(h),h},S.exports.prototype.bind=d(61210),S.exports.prototype.bindMultiple=d(74382),S.exports.prototype.unbind=d(43709),S.exports.prototype.trigger=d(43149),S.exports.prototype.reset=d(26726),S.exports.prototype.stopCallback=d(84446),S.exports.prototype.handleKey=d(94320),S.exports.prototype.addEvents=d(96687),S.exports.prototype.bindSingle=d(22214),S.exports.prototype.getKeyInfo=d(84174),S.exports.prototype.pickBestAction=d(16004),S.exports.prototype.getReverseMap=d(95193),S.exports.prototype.getMatches=d(19132),S.exports.prototype.resetSequences=d(55610),S.exports.prototype.fireCallback=d(7922),S.exports.prototype.bindSequence=d(90875),S.exports.prototype.resetSequenceTimer=d(80602),S.exports.prototype.detach=d(93502),S.exports.instances=[],S.exports.reset=d(6255),S.exports.REVERSE_MAP=null},96687:(S,v,d)=>{"use strict";S.exports=function(){var n=this,o=d(12904),h=n.element;n.eventHandler=d(88178).bind(n),o(h,"keypress",n.eventHandler),o(h,"keydown",n.eventHandler),o(h,"keyup",n.eventHandler)}},61210:S=>{"use strict";S.exports=function(v,d,n){var o=this;return v=v instanceof Array?v:[v],o.bindMultiple(v,d,n),o}},74382:S=>{"use strict";S.exports=function(v,d,n){for(var o=this,h=0;h<v.length;++h)o.bindSingle(v[h],d,n)}},90875:(S,v,d)=>{"use strict";S.exports=function(n,o,h,I){var R=this;R.sequenceLevels[n]=0;function E(V){return function(){R.nextExpectedAction=V,++R.sequenceLevels[n],R.resetSequenceTimer()}}function f(V){var F;R.fireCallback(h,V,n),I!=="keyup"&&(F=d(23970),R.ignoreNextKeyup=F(V)),setTimeout(function(){R.resetSequences()},10)}for(var B=0;B<o.length;++B){var U=B+1===o.length,H=U?f:E(I||R.getKeyInfo(o[B+1]).action);R.bindSingle(o[B],H,I,n,B)}}},22214:S=>{"use strict";S.exports=function(v,d,n,o,h){var I=this;I.directMap[v+":"+n]=d,v=v.replace(/\s+/g," ");var R=v.split(" "),E;if(R.length>1){I.bindSequence(v,R,d,n);return}E=I.getKeyInfo(v,n),I.callbacks[E.key]=I.callbacks[E.key]||[],I.getMatches(E.key,E.modifiers,{type:E.action},o,v,h),I.callbacks[E.key][o?"unshift":"push"]({callback:d,modifiers:E.modifiers,action:E.action,seq:o,level:h,combo:v})}},93502:(S,v,d)=>{var n=d(12904).off;S.exports=function(){var o=this,h=o.element;n(h,"keypress",o.eventHandler),n(h,"keydown",o.eventHandler),n(h,"keyup",o.eventHandler)}},12904:S=>{S.exports=v,S.exports.on=v,S.exports.off=d;function v(n,o,h,I){return!n.addEventListener&&(o="on"+o),(n.addEventListener||n.attachEvent).call(n,o,h,I),h}function d(n,o,h,I){return!n.removeEventListener&&(o="on"+o),(n.removeEventListener||n.detachEvent).call(n,o,h,I),h}},7922:(S,v,d)=>{"use strict";S.exports=function(n,o,h,I){var R=this,E,f;R.stopCallback(o,o.target||o.srcElement,h,I)||n(o,h)===!1&&(E=d(12156),E(o),f=d(31849),f(o))}},84174:(S,v,d)=>{"use strict";S.exports=function(n,o){var h=this,I,R,E,f,B=[],U,H,V;for(I=d(27486),R=I(n),U=d(7641),H=d(57984),V=d(95962),f=0;f<R.length;++f)E=R[f],U[E]&&(E=U[E]),o&&o!=="keypress"&&H[E]&&(E=H[E],B.push("shift")),V(E)&&B.push(E);return o=h.pickBestAction(E,B,o),{key:E,modifiers:B,action:o}}},19132:(S,v,d)=>{"use strict";S.exports=function(n,o,h,I,R,E){var f=this,B,U,H=[],V=h.type,F,z;if(V==="keypress"&&!(h.code&&h.code.slice(0,5)==="Arrow")){var ue=f.callbacks["any-character"]||[];ue.forEach(function(w){H.push(w)})}if(!f.callbacks[n])return H;for(F=d(95962),V==="keyup"&&F(n)&&(o=[n]),B=0;B<f.callbacks[n].length;++B)if(U=f.callbacks[n][B],!(!I&&U.seq&&f.sequenceLevels[U.seq]!==U.level)&&V===U.action&&(z=d(27238),V==="keypress"&&!h.metaKey&&!h.ctrlKey||z(o,U.modifiers))){var Y=!I&&U.combo===R,x=I&&U.seq===I&&U.level===E;(Y||x)&&f.callbacks[n].splice(B,1),H.push(U)}return H}},95193:(S,v,d)=>{"use strict";S.exports=function(){var n=this,o=n.constructor,h;if(!o.REVERSE_MAP){o.REVERSE_MAP={},h=d(56814);for(var I in h)I>95&&I<112||h.hasOwnProperty(I)&&(o.REVERSE_MAP[h[I]]=I)}return o.REVERSE_MAP}},94320:(S,v,d)=>{"use strict";S.exports=function(n,o,h){var I=this,R,E,f={},B=0,U=!1,H,V;for(R=I.getMatches(n,o,h),E=0;E<R.length;++E)R[E].seq&&(B=Math.max(B,R[E].level));for(E=0;E<R.length;++E){if(R[E].seq){if(R[E].level!==B)continue;U=!0,f[R[E].seq]=1,I.fireCallback(R[E].callback,h,R[E].combo,R[E].seq);continue}U||I.fireCallback(R[E].callback,h,R[E].combo)}V=h.type==="keypress"&&I.ignoreNextKeypress,H=d(95962),h.type===I.nextExpectedAction&&!H(n)&&!V&&I.resetSequences(f),I.ignoreNextKeypress=U&&h.type==="keydown"}},88178:(S,v,d)=>{"use strict";S.exports=function(n){var o=this,h,I;typeof n.which!="number"&&(n.which=n.keyCode),h=d(23970);var R=h(n);if(R!==void 0){if(n.type==="keyup"&&o.ignoreNextKeyup===R){o.ignoreNextKeyup=!1;return}I=d(25273),o.handleKey(R,I(n),n)}}},27238:S=>{"use strict";S.exports=function(v,d){return v.sort().join(",")===d.sort().join(",")}},16004:S=>{"use strict";S.exports=function(v,d,n){var o=this;return n||(n=o.getReverseMap()[v]?"keydown":"keypress"),n==="keypress"&&d.length&&(n="keydown"),n}},26726:S=>{"use strict";S.exports=function(){var v=this;return v.callbacks={},v.directMap={},this}},80602:S=>{"use strict";S.exports=function(){var v=this;clearTimeout(v.resetTimer),v.resetTimer=setTimeout(function(){v.resetSequences()},1e3)}},55610:S=>{"use strict";S.exports=function(v){var d=this;v=v||{};var n=!1,o;for(o in d.sequenceLevels){if(v[o]){n=!0;continue}d.sequenceLevels[o]=0}n||(d.nextExpectedAction=!1)}},84446:S=>{"use strict";S.exports=function(v,d){if((" "+d.className+" ").indexOf(" combokeys ")>-1)return!1;var n=d.tagName.toLowerCase();return n==="input"||n==="select"||n==="textarea"||d.isContentEditable}},43149:S=>{"use strict";S.exports=function(v,d){var n=this;return n.directMap[v+":"+d]&&n.directMap[v+":"+d]({},v),this}},43709:S=>{"use strict";S.exports=function(v,d){var n=this;return n.bind(v,function(){},d)}},6255:S=>{"use strict";S.exports=function(){var v=this;v.instances.forEach(function(d){d.reset()})}},23970:(S,v,d)=>{"use strict";S.exports=function(n){var o,h;if(o=d(56814),h=d(14082),n.type==="keypress"){var I=String.fromCharCode(n.which);return n.shiftKey||(I=I.toLowerCase()),I}return o[n.which]!==void 0?o[n.which]:h[n.which]!==void 0?h[n.which]:String.fromCharCode(n.which).toLowerCase()}},25273:S=>{"use strict";S.exports=function(v){var d=[];return v.shiftKey&&d.push("shift"),v.altKey&&d.push("alt"),v.ctrlKey&&d.push("ctrl"),v.metaKey&&d.push("meta"),d}},95962:S=>{"use strict";S.exports=function(v){return v==="shift"||v==="ctrl"||v==="alt"||v==="meta"}},27486:S=>{"use strict";S.exports=function(v){return v==="+"?["+"]:v.split("+")}},12156:S=>{"use strict";S.exports=function(v){if(v.preventDefault){v.preventDefault();return}v.returnValue=!1}},57984:S=>{"use strict";S.exports={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"}},7641:S=>{"use strict";S.exports={option:"alt",command:"meta",return:"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"}},14082:S=>{"use strict";S.exports={106:"*",107:"plus",109:"minus",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}},56814:S=>{"use strict";S.exports={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",173:"minus",187:"plus",189:"minus",224:"meta"};for(var v=1;v<20;++v)S.exports[111+v]="f"+v;for(v=0;v<=9;++v)S.exports[v+96]=v},31849:S=>{"use strict";S.exports=function(v){if(v.stopPropagation){v.stopPropagation();return}v.cancelBubble=!0}},38138:(S,v,d)=>{"use strict";d.d(v,{V:()=>yi});var n=d(74848),o=d(22803),h=d(96540),I=d(42941),R=d(1906),E=d(38036),f=d(92745);function B(e){if(e?.tracesToLogsV2)return e.tracesToLogsV2;if(!e?.tracesToLogs)return;const t={customQuery:!1};return t.datasourceUid=e.tracesToLogs.datasourceUid,t.tags=e.tracesToLogs.mapTagNamesEnabled?e.tracesToLogs.mappedTags:e.tracesToLogs.tags?.map(s=>({key:s})),t.filterByTraceID=e.tracesToLogs.filterByTraceID,t.filterBySpanID=e.tracesToLogs.filterBySpanID,t.spanStartTimeShift=e.tracesToLogs.spanStartTimeShift,t.spanEndTimeShift=e.tracesToLogs.spanEndTimeShift,t}function U({options:e,onOptionsChange:t}){const s=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],r=useMemo(()=>B(e.jsonData)||{customQuery:!1},[e.jsonData]),{query:a="",tags:i,customQuery:l}=r,c=useCallback(u=>{t({...e,jsonData:{...e.jsonData,tracesToLogsV2:{...r,...u},tracesToLogs:void 0}})},[t,e,r]);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:jsx(DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:u=>s.includes(u.type),current:r.datasourceUid,noDefault:!0,width:40,onChange:u=>c({datasourceUid:u.uid}),onClear:()=>c({datasourceUid:void 0})})})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:V("start"),tooltip:F("start","0"),value:r.spanStartTimeShift||"",onChange:u=>{c({spanStartTimeShift:u})},isInvalidError:z})}),jsx(InlineFieldRow,{children:jsx(IntervalInput,{label:V("end"),tooltip:F("end","0"),value:r.spanEndTimeShift||"",onChange:u=>{c({spanEndTimeShift:u})},isInvalidError:z})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:jsx(TagMappingInput,{values:i??[],onChange:u=>c({tags:u})})})}),jsx(H,{disabled:l,type:"trace",id:"filterByTraceID",value:!!r.filterByTraceID,onChange:u=>c({filterByTraceID:u})}),jsx(H,{disabled:l,type:"span",id:"filterBySpanID",value:!!r.filterBySpanID,onChange:u=>c({filterBySpanID:u})}),jsx(InlineFieldRow,{children:jsx(InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:jsx(InlineSwitch,{id:"customQuerySwitch",value:l,onChange:u=>c({customQuery:u.currentTarget.checked})})})}),l&&jsx(InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:jsx(Input,{label:"Query",type:"text",allowFullScreen:!0,value:a,onChange:u=>c({query:u.currentTarget.value})})})]})}function H(e){return jsx(InlineFieldRow,{children:jsx(InlineField,{disabled:e.disabled,label:`Filter by ${e.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${e.type} ID, where the ${e.type} ID should be part of the log line`,children:jsx(InlineSwitch,{id:e.id,value:e.value,onChange:t=>e.onChange(t.currentTarget.checked)})})})}const V=e=>`Span ${e} time shift`,F=(e,t)=>`Shifts the ${e} time of the span. Default: ${t} (Time units can be used here, for example: 5s, -1m, 3h)`,z="Invalid time shift. See tooltip for examples.",ue=({options:e,onOptionsChange:t})=>{let s=e.type;return s+=e.type==="tempo"?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",jsx(ConfigSection,{title:"Trace to logs",description:jsx(ConfigDescriptionLink,{description:"Navigate from a trace span to the selected data source's logs.",suffix:s,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:jsx(U,{options:e,onOptionsChange:t})})};var Y=d(2863),x=d(63142),w=d(28998),M=d(34984),K=d(52763),L=d(51845),N=d(41811);const $=(e,t,s)=>{let r;return s?r=t?.childSpanIds.find(a=>e.has(a)&&e.get(a).startTime+e.get(a).duration<s):r=t.childSpanIds[0],r?e.get(r):void 0},ne=e=>{const t=[],s=[];e.forEach(i=>{if(i.references[0]?.refType==="FOLLOWS_FROM"){t.push(i.spanID);const l=e.get(i.references[0].spanID);l.childSpanIds=l.childSpanIds.filter(c=>c!==i.spanID),e.set(l.spanID,{...l})}});const r=i=>{i.forEach(l=>{const c=e.get(l);c.hasChildren&&(s.push(...c.childSpanIds),r(c.childSpanIds))})};return r(t),[...t,...s].forEach(i=>e.delete(i)),e},J=e=>{let t=[...e.keys()];return t.forEach(s=>{const r=e.get(s);if(!(r&&r.references.length&&r.depth))return;const a=e.get(r.references[0].spanID);if(!a){e.delete(r.spanID);return}const i=r.startTime+r.duration,l=a.startTime+a.duration;if(r.startTime>=a.startTime){if(r.startTime>=l){e.delete(r.spanID),a.childSpanIds=a.childSpanIds.filter(c=>c!==r.spanID);return}if(i>l){e.set(r.spanID,{...r,duration:l-r.startTime});return}return}i<=a.startTime?(e.delete(r.spanID),a.childSpanIds=a.childSpanIds.filter(c=>c!==r.spanID)):i<=l?e.set(r.spanID,{...r,startTime:a.startTime,duration:i-a.startTime}):e.set(r.spanID,{...r,startTime:a.startTime,duration:l-a.startTime})}),t=[...e.keys()],t.forEach(s=>{const r=e.get(s);if(r.references.length){const a=e.get(r.references[0].spanID);r.references[0].span=a,e.set(s,{...r})}}),e},C=(e,t,s,r)=>{const a=e.get(t);if(!a)return s;const i=$(e,a,r);let l;if(i)l={spanId:a.spanID,section_start:i.startTime+i.duration,section_end:r||a.startTime+a.duration},l.section_start!==l.section_end&&s.push(l),C(e,i.spanID,s);else if(l={spanId:a.spanID,section_start:a.startTime,section_end:r||a.startTime+a.duration},l.section_start!==l.section_end&&s.push(l),a.references.length){const c=a.references.filter(u=>u.refType==="CHILD_OF")[0].spanID;C(e,c,s,a.startTime)}return s};function Z(e){let t=[];const s=e?.spans[0].spanID;if(s){const r=e.spans.reduce((a,i)=>(a.set(i.spanID,i),a),new Map);try{const a=ne(r),i=J(a);t=C(i,s,t)}catch(a){console.log("error while computing critical path for a trace",a)}}return t}const ie=(0,N.default)(Z);var se=d(46942),W=d.n(se),he=d(80011),re=d(45967),Oe=d(99887),ee=d(30703);const Ie=()=>({NewWindowIconLarge:(0,o.css)({label:"NewWindowIconLarge",fontSize:"1.5em"})});function tt({isLarge:e=!1,className:t}){const s=(0,x.of)(Ie),r=W()({[s.NewWindowIconLarge]:e},t);return(0,n.jsx)(ee.I,{className:r,name:"anchor"})}const Fe=e=>(0,n.jsxs)("a",{href:e.href,title:e.title,target:"_blank",rel:"noopener noreferrer",className:e.className,children:[e.children," ",(0,n.jsx)(tt,{})]});function dt(e){const{links:t}=e;return(0,n.jsx)(Fe,{href:t[0].url,title:t[0].text,className:e.className})}var Ys=d(87844);const Js=()=>({BreakableText:(0,o.css)({label:"BreakableText",display:"inline-block",whiteSpace:"pre"})}),qs=/\W*\w+\W*/g;function en({text:e,className:t,wordRegexp:s=qs}){const r=(0,x.of)(Js);if(!e)return null;const a=[];s.exec("");let i=s.exec(e)||[e];for(;i;)a.push((0,n.jsx)("span",{className:t||r.BreakableText,children:i[0]},`${e}-${a.length}`)),i=s.exec(e);return(0,n.jsx)(n.Fragment,{children:a})}const tn=e=>({TraceName:(0,o.css)({label:"TraceName",fontSize:e.typography.size.lg})});function sn(e){const{className:t,traceName:s}=e,r=(0,x.of)(tn),a=String(s||Ys.D),i=(0,n.jsx)(en,{text:a});return(0,n.jsx)("span",{className:W()(r.TraceName,t),children:i})}var Se=d(2543),Ht=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)};function nn(e,t){function s(r,a){if(e(r,a))return!0;if(Array.isArray(r))return!(!Array.isArray(a)||r.length!==a.length||!r.every(function(g,m){return s(g,a[m])}));if(Array.isArray(a))return!1;if(typeof r=="object"){if(typeof a!="object")return!1;var i=r===null,l=a===null;if(i||l)return i===l;var c=Object.keys(r),u=Object.keys(a);if(c.length!==u.length)return!1;var p=t?s:e;return!!c.every(function(g){return Ht(r,g)&&Ht(a,g)&&p(r[g],a[g])})}return!1}return s}var rn=function(t,s){for(var r=0;r<t.length;r++)if(s(t[r]))return r;return-1};function an(e,t){var s=[];function r(i){var l=rn(s,function(u){return t(i,u.key)});if(l>-1){var c=s[l];return l>0&&(s.splice(l,1),s.unshift(c)),c.value}}function a(i,l){r(i)||(s.unshift({key:i,value:l}),s.length>e&&s.pop())}return{get:r,put:a}}function on(e){var t;return{get:function(r){if(t&&e(r,t.key))return t.value},put:function(r,a){t={key:r,value:a}}}}function ln(e,t){return e===1?on(t):an(e,t)}function cn(e,t){var s=t?nn(e,t):e;return function(r,a){if(r.length!==a.length)return!1;for(var i=0;i<r.length;i+=1)if(!s(r[i],a[i]))return!1;return!0}}function dn(){for(var e=1,t=function(u,p){return u===p},s=!1,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];typeof a[0]=="number"&&(e=a.shift()),typeof a[0]=="function"?t=a.shift():typeof a[0]>"u"&&a.shift(),typeof a[0]=="boolean"&&(s=a[0]);var l=ln(e,cn(t,s));return function(c){return function(){for(var u=arguments.length,p=new Array(u),g=0;g<u;g++)p[g]=arguments[g];var m=l.get(p);return m===void 0&&(m=c.apply(c,p),l.put(p,m)),m}}}const un=dn;var pn=d(43304);const $t=/#\{([^{}]*)\}/g;function hn(e){const t=new Set;return e.replace($t,(s,r)=>(t.add(r),s)),Array.from(t)}function gn(e,t,s){return e.replace($t,(r,a)=>{const i=s[a];return i==null?"":t(i)})}function Wt(e,t){if(typeof e!="string")throw new Error("Invalid template");return{parameters:hn(e),template:gn.bind(null,e,t)}}function wt(e){if(typeof e=="string")return t=>t===e;if(Array.isArray(e))return t=>e.indexOf(t)>-1;if(e==null)return()=>!0;throw new Error(`Invalid value: ${e}`)}const fn=e=>e;function mn(e){try{const t=Wt(e.url,encodeURIComponent),s=Wt(e.text,fn);return{object:e,type:wt(e.type),key:wt(e.key),value:wt(e.value),url:t,text:s,parameters:(0,Se.uniq)(t.parameters.concat(s.parameters))}}catch(t){return console.error(`Ignoring invalid link pattern: ${t}`,e),null}}function Kt(e,t){return e.template(t)}function xn(e,t){const s=[],r=Object.keys(t).filter(a=>typeof t[a]=="string"||typeof t[a]=="number");return e?.filter(a=>a?.type("traces")).forEach(a=>{const i={};a?.parameters.every(c=>{const u=c;return r.includes(u)?(i[c]=t[u],!0):!1})&&s.push({url:Kt(a.url,i),text:Kt(a.text,i)})}),s}const vn=((0,pn.C)("linkPatterns")||[]).map(mn).filter(e=>!!e),yn=un(10)(e=>{const t=[];return e?xn(vn,e):t});var zt=d(57944),ki=d(84743);const bn="YYYY-MM-DD",In="HH:mm",Ke=1e3,Tt=1e3*Ke,Ut=60*Tt,Gt=60*Ut,Sn=24*Gt,Zt=Math.log10(Ke),Qt=[{unit:"d",microseconds:Sn,ofPrevious:24},{unit:"h",microseconds:Gt,ofPrevious:60},{unit:"m",microseconds:Ut,ofPrevious:60},{unit:"s",microseconds:Tt,ofPrevious:1e3},{unit:"ms",microseconds:Ke,ofPrevious:1e3},{unit:"\u03BCs",microseconds:1,ofPrevious:1e3}],Xt=(e,t,s)=>toFloatPrecision(e/s,t)*s;function Ri(e){return moment(e/Ke).format(bn)}function Li(e){return moment(e/Ke).format(In)}function Ei(e){const t=Xt(e,Zt,Ke);return`${moment.duration(t/Ke).asMilliseconds()}ms`}function ji(e){const t=Xt(e,Zt,Tt);return`${moment.duration(t/Ke).asSeconds()}s`}function Ze(e){const[t,s]=(0,Se.dropWhile)(Qt,({microseconds:c},u)=>u<Qt.length-1&&c>e);if(t.ofPrevious===1e3)return`${(0,Se.round)(e/t.microseconds,2)}${t.unit}`;const a=`${Math.floor(e/t.microseconds)}${t.unit}`,i=Math.round(e/s.microseconds%t.ofPrevious),l=`${i}${s.unit}`;return i===0?a:`${a} ${l}`}var Ve=d(27489),Yt=d(65642),wn=d(54334),He=d(45861);const Tn=e=>({ActionButton:(0,o.css)({label:"ActionButton",overflow:"hidden",position:"relative","&:after":{content:'""',background:e.colors.primary.main,display:"block",position:"absolute",right:0,width:"100%",height:"100%",opacity:0,transition:"all 0.8s"},"&:active:after":{margin:0,opacity:.3,transition:"0s"}})});function Jt(e){const{onClick:t,ariaLabel:s,label:r,icon:a}=e,i=(0,x.of)(Tn);return(0,n.jsx)(He.$n,{className:i.ActionButton,size:"sm",variant:"secondary",fill:"outline",type:"button",icon:a,"aria-label":s,onClick:t,children:r})}const Dn=e=>({TracePageActions:(0,o.css)({label:"TracePageActions",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",marginBottom:"10px"}),feedbackContainer:(0,o.css)({color:e.colors.text.link}),feedback:(0,o.css)({margin:"6px",color:e.colors.text.link,fontSize:e.typography.bodySmall.fontSize,"&:hover":{textDecoration:"underline"}})});function Cn(e){const{traceId:t,data:s,app:r}=e,a=(0,x.$j)(),i=Dn(a),[l,c]=(0,h.useState)(!1),u=()=>{navigator.clipboard.writeText(t),c(!0),setTimeout(()=>{c(!1)},5e3)},p=()=>{const g=(0,wn.ek)(s,"Trace-"+t.substring(t.length-6));(0,Ve.rR)("grafana_traces_download_traces_clicked",{app:r,grafana_version:Yt.$W.buildInfo.version,trace_format:g,location:"trace-view"})};return(0,n.jsxs)("div",{className:i.TracePageActions,children:[Yt.$W.feedbackLinksEnabled&&(0,n.jsxs)("div",{className:i.feedbackContainer,children:[(0,n.jsx)(ee.I,{name:"comment-alt-message"}),(0,n.jsx)("a",{href:"https://forms.gle/RZDEx8ScyZNguDoC8",className:i.feedback,title:(0,f.t)("explore.trace-page-actions.title-share-thoughts-about-tracing-grafana","Share your thoughts about tracing in Grafana."),target:"_blank",rel:"noreferrer noopener",children:(0,n.jsx)(f.x6,{i18nKey:"explore.trace-page-actions.give-feedback",children:"Give feedback"})})]}),(0,n.jsx)(Jt,{onClick:u,ariaLabel:(0,f.t)("explore.trace-page-actions.ariaLabel-copy-trace-id","Copy Trace ID"),label:l?(0,f.t)("explore.trace-page-actions.label-copied","Copied!"):(0,f.t)("explore.trace-page-actions.label-trace-id","Trace ID"),icon:"copy"}),(0,n.jsx)(Jt,{onClick:p,ariaLabel:(0,f.t)("explore.trace-page-actions.ariaLabel-export-trace","Export Trace"),label:(0,f.t)("explore.trace-page-actions.label-export","Export"),icon:"save"})]})}var Ee=d(47184),kn=d(40996),st=d(18027),qt=d(63527);const Rn=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,es=(e,t=Rn)=>!(e.match(t)||!e),ts=e=>{const[t,s]=(0,h.useState)(()=>e.value?es(e.value,e.validationRegex):!1);(0,kn.A)(()=>{s(es(e.value,e.validationRegex))},500,[e.value]);const r={labelWidth:26,disabled:e.disabled??!1,invalid:t,error:e.isInvalidError};return e.label&&(r.label=e.label,r.tooltip=e.tooltip||""),(0,n.jsx)(st.I,{...r,children:(0,n.jsx)(qt.p,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:a=>{e.onChange(a.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})})};var Ln=d(89599),ut=d(97095),Dt=d(41654),Xe=d(18857),ss=d(77806),ns=d(65445),nt=d(76319);class En extends h.PureComponent{constructor(){super(...arguments),this.clearUiFind=()=>{this.props.onChange("")}}static{this.defaultProps={value:void 0}}render(){const{value:t}=this.props,s=(0,n.jsx)(n.Fragment,{children:t&&t.length&&(0,n.jsx)(nt.K,{name:"times",onClick:this.clearUiFind,tooltip:(0,f.t)("explore.search-bar-input.suffix.tooltip-clear-input","Clear input")})});return(0,n.jsx)("div",{style:{width:"200px"},children:(0,n.jsx)(qt.p,{placeholder:(0,f.t)("explore.search-bar-input.placeholder-find","Find..."),onChange:r=>this.props.onChange(r.currentTarget.value),suffix:s,value:t})})}}var _e=d(43173);const rs=(0,h.memo)(function(t){const{trace:s,spanFilterMatches:r,setFocusedSpanIdForSearch:a,focusedSpanIndexForSearch:i,setFocusedSpanIndexForSearch:l,datasourceType:c,showSpanFilters:u}=t,p=jn((0,x.$j)(),u);(0,h.useEffect)(()=>{if(r&&i!==-1){const _=Array.from(r);a(_[i])}},[i,a,r]);const g=(_,te)=>{if(_.preventDefault(),_.stopPropagation(),te){if((0,Ve.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:c,grafana_version:_e.$.buildInfo.version,direction:"next"}),i===-1||r&&i===r.size-1){l(0);return}l(i+1)}},m=(_,te)=>{if(_.preventDefault(),_.stopPropagation(),te){if((0,Ve.rR)("grafana_traces_trace_view_find_next_prev_clicked",{datasourceType:c,grafana_version:_e.$.buildInfo.version,direction:"prev"}),r&&(i===-1||i===0)){l(r.size-1);return}l(i-1)}},b=(_,te)=>{_.key==="Enter"&&g(_,te)},y=(_,te)=>{_.key==="Enter"&&m(_,te)},j=(r&&r?.size>0)??!1,O=j?p.button:(0,o.cx)(p.button,p.buttonDisabled),A=(0,h.useCallback)(_=>(0,n.jsx)(re.m,{content:_,placement:"top",children:(0,n.jsx)("span",{className:p.tooltip,children:(0,n.jsx)(ee.I,{name:"info-circle",size:"md"})})}),[p.tooltip]),P=(0,h.useCallback)((_,te)=>{let oe=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:`${s.spans.length} spans`}),A((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.next-prev-result.services",children:["Services: ",{services:te}]})}),(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.next-prev-result.depth",children:["Depth: ",{depth:_}]})})]}))]});if(r)if(r.size===0)oe=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:(0,n.jsx)(f.x6,{i18nKey:"explore.get-matches-metadata.matches",children:"0 matches"})}),A("There are 0 span matches for the filters selected. Please try removing some of the selected filters.")]});else{const de=r.size===1?"match":"matches",le=i!==-1?`${i+1}/${r.size} ${de}`:`${r.size} ${de}`,fe=[];r.forEach(ye=>{s.processes[ye]&&fe.push(s.processes[ye].serviceName)}),oe=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:le}),A((0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.next-prev-result.services-span-filter-matches",values:{total:new Set(fe).size},children:["Services: ","{{total}}","/",{services:te}]})}),(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.next-prev-result.depth-span-filter-matches",children:["Depth: ",{depth:_}]})})]}))]})}return oe},[i,A,r,s.processes,s.spans]),G=new Set((0,Se.values)(s.processes).map(_=>_.serviceName)).size,Q=(0,Se.get)((0,Se.maxBy)(s.spans,"depth"),"depth",0)+1;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:p.matches,children:P(Q,G)}),(0,n.jsxs)("div",{className:j?p.buttons:(0,o.cx)(p.buttons,p.buttonsDisabled),children:[(0,n.jsx)("div",{"aria-label":(0,f.t)("explore.next-prev-result.aria-label-prev","Prev result button"),className:O,onClick:_=>m(_,j),onKeyDown:_=>y(_,j),role:"button",tabIndex:j?0:-1,children:(0,n.jsx)(f.x6,{i18nKey:"explore.prev",children:"Prev"})}),(0,n.jsx)("div",{"aria-label":(0,f.t)("explore.next-prev-result.aria-label-next","Next result button"),className:O,onClick:_=>g(_,j),onKeyDown:_=>b(_,j),role:"button",tabIndex:j?0:-1,children:(0,n.jsx)(f.x6,{i18nKey:"explore.next",children:"Next"})})]})]})}),jn=(e,t)=>{const s=(0,He.hs)({theme:e,variant:"secondary",size:t?"md":"sm",iconOnly:!1,fill:"outline"});return{buttons:(0,o.css)({display:"inline-flex",gap:"4px"}),buttonsDisabled:(0,o.css)({cursor:"not-allowed"}),button:s.button,buttonDisabled:(0,o.css)(s.disabled,{pointerEvents:"none"}),matches:(0,o.css)({marginRight:e.spacing(2),textWrap:"nowrap"}),tooltip:(0,o.css)({color:"#aaa",margin:"0 0 0 5px"})}};var as=d(21285),is=d(57208);const Nn=(0,h.memo)(function(t){const{trace:s,search:r,spanFilterMatches:a,setShowSpanFilterMatchesOnly:i,setShowCriticalPathSpansOnly:l,focusedSpanIndexForSearch:c,setFocusedSpanIndexForSearch:u,setFocusedSpanIdForSearch:p,datasourceType:g,clear:m,showSpanFilters:b}=t,y=(0,x.of)(Mn),j=(0,h.useMemo)(()=>r.serviceName&&r.serviceName!==""||r.spanName&&r.spanName!==""||(0,is.BL)(r.from||"")||(0,is.BL)(r.to||"")||r.tags.length>1||r.tags.some(O=>O.key)||r.query&&r.query!==""||r.matchesOnly,[r.serviceName,r.spanName,r.from,r.to,r.tags,r.query,r.matchesOnly]);return(0,n.jsx)("div",{className:y.container,children:(0,n.jsx)("div",{className:y.controls,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(He.$n,{variant:"destructive",disabled:!j,type:"button",fill:"outline","aria-label":(0,f.t)("explore.trace-page-search-bar.aria-label-clear-filters","Clear filters button"),onClick:m,children:(0,n.jsx)(f.x6,{i18nKey:"explore.clear",children:"Clear"})}),(0,n.jsxs)("div",{className:y.matchesOnly,children:[(0,n.jsx)(as.d,{value:r.matchesOnly,onChange:O=>i(O.currentTarget.checked??!1),label:(0,f.t)("explore.trace-page-search-bar.label-show-matches","Show matches only switch"),disabled:!a?.size}),(0,n.jsx)(He.$n,{onClick:()=>i(!r.matchesOnly),className:y.clearMatchesButton,variant:"secondary",fill:"text",disabled:!a?.size,children:(0,n.jsx)(f.x6,{i18nKey:"explore.show-matches-only",children:"Show matches only"})})]}),(0,n.jsxs)("div",{className:y.matchesOnly,children:[(0,n.jsx)(as.d,{value:r.criticalPathOnly,onChange:O=>l(O.currentTarget.checked??!1),label:(0,f.t)("explore.trace-page-search-bar.label-show-paths","Show critical path only switch")}),(0,n.jsx)(He.$n,{onClick:()=>l(!r.criticalPathOnly),className:y.clearMatchesButton,variant:"secondary",fill:"text",children:(0,n.jsx)(f.x6,{i18nKey:"explore.show-critical-path-only",children:"Show critical path only"})})]})]}),(0,n.jsx)("div",{className:y.nextPrevResult,children:(0,n.jsx)(rs,{trace:s,spanFilterMatches:a,setFocusedSpanIdForSearch:p,focusedSpanIndexForSearch:c,setFocusedSpanIndexForSearch:u,datasourceType:g,showSpanFilters:b})})]})})})}),Mn=e=>{const t=(0,He.hs)({theme:e,variant:"secondary",size:"md",iconOnly:!1,fill:"outline"});return{button:(0,o.css)(t.button),buttonDisabled:(0,o.css)(t.disabled,{pointerEvents:"none",cursor:"not-allowed"}),container:(0,o.css)({display:"inline"}),controls:(0,o.css)({display:"flex",justifyContent:"flex-end",margin:"5px 0 0 0"}),matchesOnly:(0,o.css)({display:"inline-flex",margin:"0 0 0 25px",verticalAlign:"middle",alignItems:"center"}),clearMatchesButton:(0,o.css)({color:e.colors.text.primary,"&:hover":{background:"inherit"}}),nextPrevResult:(0,o.css)({marginLeft:"auto",display:"flex",alignItems:"center"})}};var On=d(69192);const os=(0,h.memo)(e=>{const{trace:t,search:s,setSearch:r,showSpanFilters:a,setShowSpanFilters:i,setFocusedSpanIdForSearch:l,spanFilterMatches:c,datasourceType:u}=e,p={...(0,x.of)(An)},[g,m]=(0,h.useState)(),[b,y]=(0,h.useState)(),[j,O]=(0,h.useState)(-1),[A,P]=(0,h.useState)(),[G,Q]=(0,h.useState)({}),_=/^\d+(?:\.\d)?\d*(?:ns|us|Âµs|ms|s|m|h)$/,te=(0,h.useCallback)(()=>{m(void 0),y(void 0),P(void 0),Q({}),r(ss.Ji)},[r]);(0,h.useEffect)(()=>{te()},[te,t]);const oe=(0,h.useCallback)(ae=>{r({...s,matchesOnly:ae})},[s,r]),de=(0,h.useCallback)(ae=>{r({...s,criticalPathOnly:ae})},[s,r]);if(!t)return null;const le=ae=>{O(-1),l(""),r(ae)},fe=()=>{g||m((0,ns.pG)(t).map(Ee.z))},ye=()=>{b||y((0,ns.m8)(t).map(Ee.z))},Re=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(re.m,{content:(0,f.t)("explore.span-filters.tooltip-collapse","Filter your spans below. You can continue to apply filters until you have narrowed down your resulting spans to the select few you are most interested in."),placement:"right",children:(0,n.jsxs)("span",{className:p.collapseLabel,children:[(0,n.jsx)(f.x6,{i18nKey:"explore.span-filters.label-collapse",children:"Span Filters"}),(0,n.jsx)(ee.I,{size:"md",name:"info-circle"})]})}),!a&&(0,n.jsx)("div",{className:p.nextPrevResult,children:(0,n.jsx)(rs,{trace:t,spanFilterMatches:c,setFocusedSpanIdForSearch:l,focusedSpanIndexForSearch:j,setFocusedSpanIndexForSearch:O,datasourceType:u,showSpanFilters:a})})]});return(0,n.jsx)("div",{className:p.container,children:(0,n.jsxs)(Ln.S,{label:Re,collapsible:!0,isOpen:a,onToggle:i,children:[(0,n.jsxs)(ut.C,{className:p.flexContainer,children:[(0,n.jsx)(st.I,{label:(0,f.t)("explore.span-filters.label-service-name","Service name"),labelWidth:16,children:(0,n.jsxs)(Dt.B,{gap:.5,children:[(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-service-name-operator","Select service name operator"),onChange:ae=>le({...s,serviceNameOperator:ae.value}),options:[(0,Ee.z)("="),(0,Ee.z)("!=")],value:s.serviceNameOperator}),(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-service-name","Select service name"),isClearable:!0,onChange:ae=>le({...s,serviceName:ae?.value||""}),onOpenMenu:fe,options:g||(s.serviceName?[s.serviceName].map(Ee.z):[]),placeholder:(0,f.t)("explore.span-filters.placeholder-all-service-names","All service names"),value:s.serviceName||null,defaultValue:s.serviceName||null})]})}),(0,n.jsx)(En,{onChange:ae=>{le({...s,query:ae,matchesOnly:ae!==""})},value:s.query||""})]}),(0,n.jsx)(ut.C,{children:(0,n.jsx)(st.I,{label:(0,f.t)("explore.span-filters.label-span-name","Span name"),labelWidth:16,children:(0,n.jsxs)(Dt.B,{gap:.5,children:[(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-span-name-operator","Select span name operator"),onChange:ae=>le({...s,spanNameOperator:ae.value}),options:[(0,Ee.z)("="),(0,Ee.z)("!=")],value:s.spanNameOperator}),(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-span-name","Select span name"),isClearable:!0,onChange:ae=>le({...s,spanName:ae?.value||""}),onOpenMenu:ye,options:b||(s.spanName?[s.spanName].map(Ee.z):[]),placeholder:(0,f.t)("explore.span-filters.placeholder-all-span-names","All span names"),value:s.spanName||null})]})})}),(0,n.jsx)(ut.C,{children:(0,n.jsx)(st.I,{label:(0,f.t)("explore.span-filters.label-duration","Duration"),labelWidth:16,tooltip:(0,f.t)("explore.span-filters.tooltip-duration","Filter by duration. Accepted units are {{units}}",{units:"ns, us, ms, s, m, h"}),children:(0,n.jsxs)(Dt.B,{alignItems:"flex-start",gap:.5,children:[(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-min-span-operator","Select min span operator"),onChange:ae=>le({...s,fromOperator:ae.value}),options:[(0,Ee.z)(">"),(0,Ee.z)(">=")],value:s.fromOperator}),(0,n.jsx)("div",{className:p.intervalInput,children:(0,n.jsx)(ts,{ariaLabel:(0,f.t)("explore.span-filters.ariaLabel-select-min-span-duration","Select min span duration"),onChange:ae=>le({...s,from:ae}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:s.from||"",validationRegex:_})}),(0,n.jsx)(Xe.l6,{"aria-label":(0,f.t)("explore.span-filters.aria-label-select-max-span-operator","Select max span operator"),onChange:ae=>le({...s,toOperator:ae.value}),options:[(0,Ee.z)("<"),(0,Ee.z)("<=")],value:s.toOperator}),(0,n.jsx)(ts,{ariaLabel:(0,f.t)("explore.span-filters.ariaLabel-select-max-span-duration","Select max span duration"),onChange:ae=>le({...s,to:ae}),isInvalidError:"Invalid duration",placeholder:"e.g. 100ms, 1.2s",width:18,value:s.to||"",validationRegex:_})]})})}),(0,n.jsx)(ut.C,{className:p.tagsRow,children:(0,n.jsx)(st.I,{label:(0,f.t)("explore.span-filters.label-tags","Tags"),labelWidth:16,tooltip:(0,f.t)("explore.span-filters.tooltip-tags","Filter by tags, process tags or log fields in your spans."),children:(0,n.jsx)(On.T,{search:s,setSearch:le,trace:t,tagKeys:A,setTagKeys:P,tagValues:G,setTagValues:Q})})}),(0,n.jsx)(Nn,{trace:t,search:s,spanFilterMatches:c,setShowSpanFilterMatchesOnly:oe,setShowCriticalPathSpansOnly:de,setFocusedSpanIdForSearch:l,focusedSpanIndexForSearch:j,setFocusedSpanIndexForSearch:O,datasourceType:u,clear:te,showSpanFilters:a})]})})});os.displayName="SpanFilters";const An=e=>({container:(0,o.css)({label:"SpanFilters",margin:`0.5em 0 -${e.spacing(1)} 0`,zIndex:5,"& > div":{borderLeft:"none",borderRight:"none"}}),collapseLabel:(0,o.css)({svg:{color:"#aaa",margin:"-2px 0 0 10px"}}),flexContainer:(0,o.css)({display:"flex",justifyContent:"space-between"}),intervalInput:(0,o.css)({margin:"0 -4px 0 0"}),tagsRow:(0,o.css)({margin:"-4px 0 0 0"}),nextPrevResult:(0,o.css)({flex:1,alignItems:"center",display:"flex",justifyContent:"flex-end",marginRight:e.spacing(1)})}),ls=(0,h.memo)(e=>{const{trace:t,data:s,app:r,timeZone:a,search:i,setSearch:l,showSpanFilters:c,setShowSpanFilters:u,setFocusedSpanIdForSearch:p,spanFilterMatches:g,datasourceType:m,setHeaderHeight:b}=e,y=(0,x.of)(Fn);(0,h.useEffect)(()=>{b(document.querySelector("."+y.header)?.scrollHeight??0)},[b,c,y.header]);const j=(0,h.useMemo)(()=>t?yn(t):[],[t]);if(!t)return null;const O=(oe,de)=>{const le=(0,he.LE)(oe.startTime/1e3,{timeZone:de,defaultWithMS:!0}),fe=le.match(/^(.+)(:\d\d\.\d+)$/);return fe?(0,n.jsxs)("span",{className:y.TracePageHeaderOverviewItemValue,children:[fe[1],(0,n.jsx)("span",{className:y.TracePageHeaderOverviewItemValueDetail,children:fe[2]})]}):le},A=(0,n.jsxs)("h1",{className:W()(y.title),children:[(0,n.jsx)(sn,{traceName:(0,zt.tV)(t.spans)}),(0,n.jsx)("small",{className:y.duration,children:Ze(t.duration)})]}),{method:P,status:G,url:Q}=(0,zt.h9)(t.spans);let _="green";G&&G.length>0&&(G[0].value.toString().charAt(0)==="4"?_="orange":G[0].value.toString().charAt(0)==="5"&&(_="red"));const te=oe=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.trace-page-header.tooltip-url",values:{url:"http.url",target:"http.target",path:"http.path"},children:["{{url}}"," or ","{{target}}"," or ","{{path}}"]})}),(0,n.jsxs)("div",{children:["(",oe,")"]})]});return(0,n.jsxs)("header",{className:y.header,children:[(0,n.jsxs)("div",{className:y.titleRow,children:[j&&j.length>0&&(0,n.jsx)(dt,{links:j,className:y.TracePageHeaderBack}),A,(0,n.jsx)(Cn,{traceId:t.traceID,data:s,app:r})]}),(0,n.jsxs)("div",{className:y.subtitle,children:[(0,n.jsx)("span",{className:y.timestamp,children:O(t,a)}),(0,n.jsxs)("span",{className:y.tagMeta,children:[s.meta?.custom?.partial&&(0,n.jsx)(re.m,{content:s.meta?.custom?.message,interactive:!0,children:(0,n.jsx)("span",{className:y.tag,children:(0,n.jsx)(Oe.E,{icon:"info-circle",text:(0,f.t)("explore.trace-page-header.text-partial-trace","Partial trace"),color:"orange"})})}),P&&P.length>0&&(0,n.jsx)(re.m,{content:"http.method",interactive:!0,children:(0,n.jsx)("span",{className:y.tag,children:(0,n.jsx)(Oe.E,{text:P[0].value,color:"blue"})})}),G&&G.length>0&&(0,n.jsx)(re.m,{content:"http.status_code",interactive:!0,children:(0,n.jsx)("span",{className:y.tag,children:(0,n.jsx)(Oe.E,{text:G[0].value,color:_})})}),Q&&Q.length>0&&(0,n.jsx)(re.m,{content:te(Q[0].value),interactive:!0,children:(0,n.jsx)("span",{className:y.url,children:Q[0].value})})]})]}),(0,n.jsx)(os,{trace:t,showSpanFilters:c,setShowSpanFilters:u,search:i,setSearch:l,spanFilterMatches:g,setFocusedSpanIdForSearch:p,datasourceType:m})]})});ls.displayName="TracePageHeader";const Fn=e=>({TracePageHeaderBack:(0,o.css)({label:"TracePageHeaderBack",alignItems:"center",alignSelf:"stretch",backgroundColor:"#fafafa",borderBottom:"1px solid #ddd",borderRight:"1px solid #ddd",color:"inherit",display:"flex",fontSize:"1.4rem",padding:"0 1rem",marginBottom:"-1px","&:hover":{backgroundColor:"#f0f0f0",borderColor:"#ccc"}}),TracePageHeaderOverviewItemValueDetail:W()((0,o.css)({label:"TracePageHeaderOverviewItemValueDetail",color:"#aaa"}),"trace-item-value-detail"),TracePageHeaderOverviewItemValue:(0,o.css)({label:"TracePageHeaderOverviewItemValue","&:hover > .trace-item-value-detail":{color:"unset"}}),header:(0,o.css)({label:"TracePageHeader",backgroundColor:e.colors.background.primary,padding:"0.5em 0 0 0",position:"sticky",top:0,zIndex:5,textAlign:"left"}),titleRow:(0,o.css)({alignItems:"flex-start",display:"flex",padding:"0 8px",flexWrap:"wrap"}),title:(0,o.css)({color:"inherit",flex:1,fontSize:"1.7em",lineHeight:"1em",marginBottom:0,minWidth:"200px"}),subtitle:(0,o.css)({flex:1,lineHeight:"1em",margin:"-0.5em 0.5em 0.75em 0.5em"}),tag:(0,o.css)({margin:"0 0.5em 0 0"}),duration:(0,o.css)({color:"#aaa",margin:"0 0.75em"}),timestamp:(0,o.css)({verticalAlign:"middle"}),tagMeta:(0,o.css)({margin:"0 0.75em",verticalAlign:"text-top"}),url:(0,o.css)({margin:"-2.5px 0.3em",height:"15px",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"700px",display:"inline-block"}),TracePageHeaderTraceId:(0,o.css)({label:"TracePageHeaderTraceId",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"30%",display:"inline-block"})});var ze=d(65240),T=d(11065),Ct=d(84140),cs=d(8255);function Vn(e){if(e.length!==7)return[0,0,0];const t=e.slice(1,3),s=e.slice(3,5),r=e.slice(5);return[parseInt(t,16),parseInt(s,16),parseInt(r,16)]}class _n{constructor(t,s){const r=Bn(t,s);this.colorsHex=r,this.colorsRgb=r.map(Vn),this.cache=new Map,this.prevColorIndex=void 0}_getColorIndex(t){let s=this.cache.get(t);if(s==null){const r=this.hashCode(t?t.toLowerCase():"");if(s=Math.abs(r%this.colorsHex.length),this.prevColorIndex!==void 0){this.prevColorIndex===s&&(s=this.getNextIndex(s));const a=this.colorsHex[this.prevColorIndex];if(Ct.A.readability(a,this.colorsHex[s])<1.5){let i=s;for(let l=0;l<this.colorsHex.length;l++)if(i=this.getNextIndex(i),Ct.A.readability(a,this.colorsHex[i])>1.5){s=i;break}}}this.cache.set(t,s),this.prevColorIndex=s}return s}getNextIndex(t){return t+1<this.colorsHex.length?t+1:0}hashCode(t){let s=0,r,a;for(r=0;r<t.length;r++)a=t.charCodeAt(r),s=(s<<5)-s+a;return s}getColorByKey(t){const s=this._getColorIndex(t);return this.colorsHex[s]}getRgbColorByKey(t){const s=this._getColorIndex(t);return this.colorsRgb[s]}clear(){this.cache.clear()}}const kt=(0,N.default)((e,t)=>new _n(e,t));function Ni(e){kt([],e)}function pt(e,t){return kt(cs.Tj,t).getColorByKey(e)}function Pn(e,t){return kt(cs.Tj,t).getRgbColorByKey(e)}function Bn(e,t){const s=[...e],r=s.indexOf("#E24D42");r>-1&&s.splice(r,1);const a=e.indexOf("#BF1B00");a>-1&&s.splice(a,1);let i=[];for(const l of s)Ct.A.readability(t.colors.background.primary,l)>=3&&i.push(l);return i}const Hn=.8,$n=2,Wn=200,ds=10,us=60,Kn=6;function zn(e,t,s,r,a){const i=new Map,l=t.length<us?us:Math.min(t.length,Wn),c=window.innerWidth*2;e.width=c,e.height=l;const u=Math.min(Kn,Math.max($n,l/t.length)),p=l/t.length,g=e.getContext("2d",{alpha:!1});if(g){g.fillStyle=a,g.fillRect(0,0,c,l);for(let m=0;m<t.length;m++){const{valueWidth:b,valueOffset:y,serviceName:j}=t[m],O=y/s*c;let A=b/s*c;A<ds&&(A=ds);let P=i.get(j);P||(P=`rgba(${r(j).concat(Hn).join()})`,i.set(j,P)),g.fillStyle=P,g.fillRect(O,m*p,A,u)}}}const Un=(0,ze.N)(e=>({CanvasSpanGraph:(0,o.css)({label:"CanvasSpanGraph",background:(0,T.R)(e,"#fafafa"),height:"60px",position:"absolute",width:"100%"})}));class Gn extends h.PureComponent{constructor(t){super(t),this.getColor=s=>Pn(s,this.props.theme),this._setCanvasRef=s=>{this._canvasElm=s},this._canvasElm=void 0}componentDidMount(){this._draw()}componentDidUpdate(){this._draw()}_draw(){if(this._canvasElm){const{valueWidth:t,items:s}=this.props;zn(this._canvasElm,s,t,this.getColor,(0,T.R)(this.props.theme,"#fff"))}}render(){return(0,n.jsx)("canvas",{className:Un(this.props.theme).CanvasSpanGraph,ref:this._setCanvasRef,"data-testid":"CanvasSpanGraph"})}}const Zn=(0,x.cV)(Gn),Qn=()=>({TickLabels:(0,o.css)({label:"TickLabels",height:"1rem",position:"relative"}),TickLabelsLabel:(0,o.css)({label:"TickLabelsLabel",color:"#717171",fontSize:"0.7rem",position:"absolute",userSelect:"none"})});function Xn(e){const{numTicks:t,duration:s}=e,r=(0,x.of)(Qn),a=[];for(let i=0;i<t+1;i++){const l=i/t,c=l===1?{right:"0%"}:{left:`${l*100}%`};a.push((0,n.jsx)("div",{className:r.TickLabelsLabel,style:c,"data-testid":"tick",children:Ze(s*l)},l))}return(0,n.jsx)("div",{className:r.TickLabels,"data-testid":"TickLabels",children:a})}var ps=(e=>(e.DragEnd="DragEnd",e.DragMove="DragMove",e.DragStart="DragStart",e.MouseEnter="MouseEnter",e.MouseLeave="MouseLeave",e.MouseMove="MouseMove",e))(ps||{});const Ue=ps,hs=0;class rt{constructor({getBounds:t,tag:s,resetBoundsOnResize:r=!0,...a}){this.resetBounds=()=>{this._bounds=void 0},this._handleMinorMouseEvent=i=>{const{button:l,clientX:c,type:u}=i;if(this._isDragging||l!==hs)return;let p=null,g;if(u==="mouseenter")p=Ue.MouseEnter,g=this._onMouseEnter;else if(u==="mouseleave")p=Ue.MouseLeave,g=this._onMouseLeave;else if(u==="mousemove")p=Ue.MouseMove,g=this._onMouseMove;else throw new Error(`invalid event type: ${u}`);if(!g)return;const{value:m,x:b}=this._getPosition(c);g({event:i,type:p,value:m,x:b,manager:this,tag:this.tag})},this._handleDragEvent=i=>{const{button:l,clientX:c,type:u}=i;let p=null,g;if(u==="mousedown"){if(this._isDragging||l!==hs)return;window.addEventListener("mousemove",this._handleDragEvent),window.addEventListener("mouseup",this._handleDragEvent);const y=(0,Se.get)(document,"body.style");y&&(y.userSelect="none"),this._isDragging=!0,p=Ue.DragStart,g=this._onDragStart}else if(u==="mousemove"){if(!this._isDragging)return;p=Ue.DragMove,g=this._onDragMove}else if(u==="mouseup"){if(!this._isDragging)return;this._stopDragging(),p=Ue.DragEnd,g=this._onDragEnd}else throw new Error(`invalid event type: ${u}`);if(!g)return;const{value:m,x:b}=this._getPosition(c);g({event:i,type:p,value:m,x:b,manager:this,tag:this.tag})},this.handleMouseDown=this._handleDragEvent,this.handleMouseEnter=this._handleMinorMouseEvent,this.handleMouseMove=this._handleMinorMouseEvent,this.handleMouseLeave=this._handleMinorMouseEvent,this.getBounds=t,this.tag=s,this._isDragging=!1,this._bounds=void 0,this._resetBoundsOnResize=!!r,this._resetBoundsOnResize&&window.addEventListener("resize",this.resetBounds),this._onMouseEnter=a.onMouseEnter,this._onMouseLeave=a.onMouseLeave,this._onMouseMove=a.onMouseMove,this._onDragStart=a.onDragStart,this._onDragMove=a.onDragMove,this._onDragEnd=a.onDragEnd}_getBounds(){return this._bounds||(this._bounds=this.getBounds(this.tag)),this._bounds}_getPosition(t){const{clientXLeft:s,maxValue:r,minValue:a,width:i}=this._getBounds();let l=t-s,c=l/i;return a!=null&&c<a?(c=a,l=a*i):r!=null&&c>r&&(c=r,l=r*i),{value:c,x:l}}_stopDragging(){window.removeEventListener("mousemove",this._handleDragEvent),window.removeEventListener("mouseup",this._handleDragEvent);const t=(0,Se.get)(document,"body.style");t&&(t.userSelect="auto"),this._isDragging=!1}isDragging(){return this._isDragging}dispose(){this._isDragging&&this._stopDragging(),this._resetBoundsOnResize&&window.removeEventListener("resize",this.resetBounds),this._bounds=void 0,this._onMouseEnter=void 0,this._onMouseLeave=void 0,this._onMouseMove=void 0,this._onDragStart=void 0,this._onDragMove=void 0,this._onDragEnd=void 0}}const Yn=()=>({GraphTick:(0,o.css)({label:"GraphTick",stroke:"#aaa",strokeWidth:"1px"})});function Jn(e){const{numTicks:t}=e,s=(0,x.of)(Yn),r=[];for(let a=1;a<t;a++){const i=`${a/t*100}%`;r.push((0,n.jsx)("line",{className:s.GraphTick,x1:i,y1:"0%",x2:i,y2:"100%"},a/t))}return(0,n.jsx)("g",{"data-testid":"ticks","aria-hidden":"true",children:r})}const qn=()=>({ScrubberHandleExpansion:W()((0,o.css)({label:"ScrubberHandleExpansion",cursor:"col-resize",fillOpacity:0,fill:"#44f"}),"scrubber-handle-expansion"),ScrubberHandle:W()((0,o.css)({label:"ScrubberHandle",cursor:"col-resize",fill:"#555"}),"scrubber-handle"),ScrubberLine:W()((0,o.css)({label:"ScrubberLine",pointerEvents:"none",stroke:"#555"}),"scrubber-line"),ScrubberDragging:(0,o.css)({label:"ScrubberDragging","& .scrubber-handle-expansion":{fillOpacity:1},"& .scrubber-handle":{fill:"#44f"},"& > .scrubber-line":{stroke:"#44f"}}),ScrubberHandles:(0,o.css)({label:"ScrubberHandles","&:hover > .scrubber-handle-expansion":{fillOpacity:1},"&:hover > .scrubber-handle":{fill:"#44f"},"&:hover + .scrubber.line":{stroke:"#44f"}})});function gs({isDragging:e,onMouseDown:t,onMouseEnter:s,onMouseLeave:r,position:a}){const i=`${a*100}%`,l=(0,x.of)(qn),c=W()({[l.ScrubberDragging]:e});return(0,n.jsxs)("g",{className:c,"data-testid":"scrubber-component",children:[(0,n.jsxs)("g",{"data-testid":"scrubber-component-g",className:l.ScrubberHandles,onMouseDown:t,onMouseEnter:s,onMouseLeave:r,children:[(0,n.jsx)("rect",{"data-testid":"scrubber-component-rect-1",x:i,className:l.ScrubberHandleExpansion,style:{transform:"translate(-4.5px)"},width:"9",height:"20"}),(0,n.jsx)("rect",{"data-testid":"scrubber-component-rect-2",x:i,className:l.ScrubberHandle,style:{transform:"translate(-1.5px)"},width:"3",height:"20"})]}),(0,n.jsx)("line",{className:l.ScrubberLine,y2:"100%",x1:i,x2:i,"data-testid":"scrubber-component-line"})]})}const fs=(0,ze.N)(e=>{const t="JaegerUiComponents__ViewingLayerResetZoomHoverClassName",s=(0,o.css)({label:"ViewingLayerResetZoom",display:"none",position:"absolute",right:"1%",top:"10%",zIndex:1});return{ViewingLayer:(0,o.css)({label:"ViewingLayer",cursor:"vertical-text",position:"relative",zIndex:1,[`&:hover > .${t}`]:{display:"unset"}}),ViewingLayerGraph:(0,o.css)({label:"ViewingLayerGraph",border:`1px solid ${(0,T.R)(e,"#999")}`,overflow:"visible !important",position:"relative",transformOrigin:"0 0",width:"100%"}),ViewingLayerInactive:(0,o.css)({label:"ViewingLayerInactive",fill:(0,T.R)(e,"rgba(214, 214, 214, 0.5)")}),ViewingLayerCursorGuide:(0,o.css)({label:"ViewingLayerCursorGuide",stroke:(0,T.R)(e,"#f44"),strokeWidth:1}),ViewingLayerDraggedShift:(0,o.css)({label:"ViewingLayerDraggedShift",fillOpacity:.2}),ViewingLayerDrag:(0,o.css)({label:"ViewingLayerDrag",fill:(0,T.R)(e,"#44f")}),ViewingLayerFullOverlay:(0,o.css)({label:"ViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"}),ViewingLayerResetZoom:s,ViewingLayerResetZoomHoverClassName:t}}),$e={SHIFT_END:"SHIFT_END",SHIFT_START:"SHIFT_START",REFRAME:"REFRAME"};function er(e,t){const[s,r]=e<t?[e,t]:[t,e];return{x:`${s*100}%`,width:`${(r-s)*100}%`,leadingX:`${t*100}%`}}class tr extends h.PureComponent{constructor(t){super(t),this._setRoot=s=>{this._root=s},this._getDraggingBounds=s=>{if(!this._root)throw new Error("invalid state");const{left:r,width:a}=this._root.getBoundingClientRect(),[i,l]=this.props.viewRange.time.current;let c=1,u=0;return s===$e.SHIFT_START?c=l:s===$e.SHIFT_END&&(u=i),{clientXLeft:r,maxValue:c,minValue:u,width:a}},this._handleReframeMouseMove=({value:s})=>{this.props.updateNextViewRangeTime({cursor:s})},this._handleReframeMouseLeave=()=>{this._draggerReframe.resetBounds(),this.props.updateNextViewRangeTime({cursor:null})},this._handleReframeDragUpdate=({value:s})=>{const r=s,{time:a}=this.props.viewRange,l={reframe:{anchor:a.reframe?a.reframe.anchor:r,shift:r}};this.props.updateNextViewRangeTime(l)},this._handleReframeDragEnd=({manager:s,value:r})=>{const{time:a}=this.props.viewRange,i=a.reframe?a.reframe.anchor:r,[l,c]=r<i?[r,i]:[i,r];s.resetBounds(),this.props.updateViewRangeTime(l,c,"minimap")},this._handleScrubberEnterLeave=({type:s})=>{const r=s===Ue.MouseEnter;this.setState({preventCursorLine:r})},this._handleScrubberDragUpdate=({event:s,tag:r,type:a,value:i})=>{a===Ue.DragStart&&s.stopPropagation(),r===$e.SHIFT_START?this.props.updateNextViewRangeTime({shiftStart:i}):r===$e.SHIFT_END&&this.props.updateNextViewRangeTime({shiftEnd:i})},this._handleScrubberDragEnd=({manager:s,tag:r,value:a})=>{const[i,l]=this.props.viewRange.time.current;let c;if(r===$e.SHIFT_START)c=[a,l];else if(r===$e.SHIFT_END)c=[i,a];else throw new Error("bad state");s.resetBounds(),this.setState({preventCursorLine:!1}),this.props.updateViewRangeTime(c[0],c[1],"minimap")},this._resetTimeZoomClickHandler=()=>{this.props.updateViewRangeTime(0,1)},this._draggerReframe=new rt({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseMove:this._handleReframeMouseMove,onMouseLeave:this._handleReframeMouseLeave,tag:$e.REFRAME}),this._draggerStart=new rt({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:$e.SHIFT_START}),this._draggerEnd=new rt({getBounds:this._getDraggingBounds,onDragEnd:this._handleScrubberDragEnd,onDragMove:this._handleScrubberDragUpdate,onDragStart:this._handleScrubberDragUpdate,onMouseEnter:this._handleScrubberEnterLeave,onMouseLeave:this._handleScrubberEnterLeave,tag:$e.SHIFT_END}),this._root=void 0,this.state={preventCursorLine:!1}}componentWillUnmount(){this._draggerReframe.dispose(),this._draggerEnd.dispose(),this._draggerStart.dispose()}_getMarkers(t,s){const r=fs(this.props.theme),a=er(t,s);return[(0,n.jsx)("rect",{className:W()(r.ViewingLayerDraggedShift,r.ViewingLayerDrag),x:a.x,y:"0",width:a.width,height:this.props.height-2},"fill"),(0,n.jsx)("rect",{className:W()(r.ViewingLayerDrag),x:a.leadingX,y:"0",width:"1",height:this.props.height-2},"edge")]}render(){const{height:t,viewRange:s,numTicks:r,theme:a}=this.props,{preventCursorLine:i}=this.state,{current:l,cursor:c,shiftStart:u,shiftEnd:p,reframe:g}=s.time,m=u!=null||p!=null||g!=null,[b,y]=l;let j=0;b&&(j=b*100);let O=100;y&&(O=100-y*100);let A;!m&&c!=null&&!i&&(A=`${c*100}%`);const P=fs(a);return(0,n.jsxs)("div",{"aria-hidden":!0,className:P.ViewingLayer,style:{height:t},children:[(b!==0||y!==1)&&(0,n.jsx)(He.$n,{onClick:this._resetTimeZoomClickHandler,className:W()(P.ViewingLayerResetZoom,P.ViewingLayerResetZoomHoverClassName),type:"button",variant:"secondary",children:(0,n.jsx)(f.x6,{i18nKey:"explore.unthemed-viewing-layer.reset-selection",children:"Reset selection"})}),(0,n.jsxs)("svg",{height:t,className:P.ViewingLayerGraph,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,children:[j>0&&(0,n.jsx)("rect",{x:0,y:0,height:"100%",width:`${j}%`,className:P.ViewingLayerInactive,"data-testid":"left-ViewingLayerInactive"}),O>0&&(0,n.jsx)("rect",{x:`${100-O}%`,y:0,height:"100%",width:`${O}%`,className:P.ViewingLayerInactive,"data-testid":"right-ViewingLayerInactive"}),(0,n.jsx)(Jn,{numTicks:r}),A&&(0,n.jsx)("line",{className:P.ViewingLayerCursorGuide,x1:A,y1:"0",x2:A,y2:t-2,strokeWidth:"1","data-testid":"ViewingLayerCursorGuide"}),u!=null&&this._getMarkers(b,u),p!=null&&this._getMarkers(y,p),(0,n.jsx)(gs,{isDragging:u!=null,onMouseDown:this._draggerStart.handleMouseDown,onMouseEnter:this._draggerStart.handleMouseEnter,onMouseLeave:this._draggerStart.handleMouseLeave,position:b||0}),(0,n.jsx)(gs,{isDragging:p!=null,position:y||1,onMouseDown:this._draggerEnd.handleMouseDown,onMouseEnter:this._draggerEnd.handleMouseEnter,onMouseLeave:this._draggerEnd.handleMouseLeave}),g!=null&&this._getMarkers(g.anchor,g.shift)]}),m&&(0,n.jsx)("div",{className:P.ViewingLayerFullOverlay})]})}}const sr=(0,x.cV)(tr),nr=()=>({container:(0,o.css)({padding:"0 0.5rem 0.5rem 0.5rem"}),canvasContainer:(0,o.css)({position:"relative"})}),ms=60,xs=4;function rr(e){return{valueOffset:e.relativeStartTime,valueWidth:e.duration,serviceName:e.process.serviceName}}function ar(e){return e.spans.map(rr)}const ir=(0,N.default)(ar);class or extends h.PureComponent{static{this.defaultProps={height:ms}}render(){const{height:t,trace:s,viewRange:r,updateNextViewRangeTime:a,updateViewRangeTime:i}=this.props,l=nr();if(!s)return(0,n.jsx)("div",{});const c=ir(s);return(0,n.jsxs)("div",{className:l.container,children:[(0,n.jsx)(Xn,{numTicks:xs,duration:s.duration}),(0,n.jsxs)("div",{className:l.canvasContainer,children:[(0,n.jsx)(Zn,{valueWidth:s.duration,items:c}),(0,n.jsx)(sr,{viewRange:r,numTicks:xs,height:t||ms,updateViewRangeTime:i,updateNextViewRangeTime:a})]})]})}}var lr=d(75888),cr=d.n(lr);const dr={scrollPageDown:{binding:"s",label:"Scroll down"},scrollPageUp:{binding:"w",label:"Scroll up"},scrollToNextVisibleSpan:{binding:"f",label:"Scroll to the next visible span"},scrollToPrevVisibleSpan:{binding:"b",label:"Scroll to the previous visible span"},panLeft:{binding:["a","left"],label:"Pan left"},panLeftFast:{binding:["shift+a","shift+left"],label:"Pan left \u2014 Large"},panRight:{binding:["d","right"],label:"Pan right"},panRightFast:{binding:["shift+d","shift+right"],label:"Pan right \u2014 Large"},zoomIn:{binding:"up",label:"Zoom in"},zoomInFast:{binding:"shift+up",label:"Zoom in \u2014 Large"},zoomOut:{binding:"down",label:"Zoom out"},zoomOutFast:{binding:"shift+down",label:"Zoom out \u2014 Large"},collapseAll:{binding:"]",label:"Collapse All"},expandAll:{binding:"[",label:"Expand All"},collapseOne:{binding:"p",label:"Collapse One Level"},expandOne:{binding:"o",label:"Expand One Level"},searchSpans:{binding:"ctrl+b",label:"Search Spans"},clearSearch:{binding:"escape",label:"Clear Search"}};let Rt;function vs(){if(Rt)return Rt;const e=new(cr())(document.body);return Rt=e,e}function ur(e){const t=vs();Object.keys(e).forEach(s=>{const r=e[s];r&&t.bind(dr[s].binding,r)})}function Oi(){vs().reset()}function pr(e){const{min:t,max:s,viewStart:r,viewEnd:a}=e,i=s-t,l=t+r*i,u=s-(1-a)*i-l;return(p,g)=>({start:(p-l)/u,end:(g-l)/u})}function ht(e,t,s){return!Array.isArray(s.tags)||!s.tags.length?!1:s.tags.some(r=>r.key===e&&r.value===t)}const hr=e=>e.kind==="client",gr=ht.bind(null,"span.kind","client"),fr=e=>hr(e)||gr(e),mr=e=>e.kind==="server",xr=ht.bind(null,"span.kind","server"),vr=e=>mr(e)||xr(e),yr=e=>e.statusCode===2,br=ht.bind(null,"error",!0),Ir=ht.bind(null,"error","true"),ys=e=>yr(e)||br(e)||Ir(e);function Sr(e,t){const{depth:s}=e[t];let r=t+1;for(;r<e.length&&e[r].depth>s;r++)if(ys(e[r]))return!0;return!1}function wr(e){if(e.length<=1||!fr(e[0]))return!1;const s=e[0].depth+1;let r=1;for(;r<e.length&&e[r].depth===s;){if(vr(e[r]))return e[r];r++}return null}const Tr=e=>e.kind?e.kind==="client":e.tags.some(({key:t,value:s})=>t==="span.kind"&&s==="client"),Dr=e=>({Ticks:(0,o.css)({label:"Ticks",pointerEvents:"none"}),TicksTick:(0,o.css)({label:"TicksTick",position:"absolute",height:"100%",width:"1px",background:(0,T.R)(e,"#d8d8d8"),"&:last-child":{width:0}}),TicksTickLabel:(0,o.css)({label:"TicksTickLabel",left:"0.25rem",position:"absolute",whiteSpace:"nowrap"}),TicksTickLabelEndAnchor:(0,o.css)({label:"TicksTickLabelEndAnchor",left:"initial",right:"0.25rem"})});function bs({endTime:e=null,numTicks:t,showLabels:s=null,startTime:r=null}){let a;if(s){a=[];const c=(e||0)-(r||0);for(let u=0;u<t;u++){const p=(r||0)+u/(t-1)*c;a.push(Ze(p))}}const i=(0,x.of)(Dr),l=[];for(let c=0;c<t;c++){const u=c/(t-1);l.push((0,n.jsx)("div",{"data-testid":"TicksID",className:i.TicksTick,style:{left:`${u*100}%`},children:a&&(0,n.jsx)("span",{className:W()(i.TicksTickLabel,{[i.TicksTickLabelEndAnchor]:u>=1}),children:a[c]})},u))}return(0,n.jsx)("div",{className:i.Ticks,children:l})}const Is=()=>({row:(0,o.css)({display:"flex",flex:"0 1 auto",flexDirection:"row"}),rowCell:(0,o.css)({position:"relative"})});function Pe({children:e,className:t="",...s}){const r=(0,x.of)(Is);return(0,n.jsx)("div",{className:W()(r.row,t),...s,children:e})}function Cr({children:e,className:t="",width:s,style:r={},...a}){const i=`${s*100}%`,l={...r,flexBasis:i,maxWidth:i},c=(0,x.of)(Is);return(0,n.jsx)("div",{className:W()(c.rowCell,t),style:l,"data-testid":"TimelineRowCell",...a,children:e})}Pe.Cell=Cr;const kr=()=>({TimelineCollapser:(0,o.css)({alignItems:"center",display:"flex",flex:"none",justifyContent:"center",marginRight:"0.5rem"})});function Rr(e){const{onExpandAll:t,onExpandOne:s,onCollapseAll:r,onCollapseOne:a}=e,i=(0,x.of)(kr);return(0,n.jsxs)("div",{className:i.TimelineCollapser,"data-testid":"TimelineCollapser",children:[(0,n.jsx)(nt.K,{tooltip:(0,f.t)("explore.timeline-collapser.tooltip-expand","Expand +1"),size:"xl",tooltipPlacement:"top",name:"angle-down",onClick:s}),(0,n.jsx)(nt.K,{tooltip:(0,f.t)("explore.timeline-collapser.tooltip-collapse","Collapse +1"),size:"xl",tooltipPlacement:"top",name:"angle-right",onClick:a}),(0,n.jsx)(nt.K,{tooltip:(0,f.t)("explore.timeline-collapser.tooltip-expand-all","Expand all"),size:"xl",tooltipPlacement:"top",name:"angle-double-down",onClick:t}),(0,n.jsx)(nt.K,{tooltip:(0,f.t)("explore.timeline-collapser.tooltip-collapse-all","Collapse all"),size:"xl",tooltipPlacement:"top",name:"angle-double-right",onClick:r})]})}const Lr=()=>({TimelineColumnResizer:(0,o.css)({left:0,position:"absolute",right:0,top:0}),wrapper:(0,o.css)({bottom:0,position:"absolute",top:0}),dragger:(0,o.css)({borderLeft:"2px solid transparent",cursor:"col-resize",height:"5000px",marginLeft:"-1px",position:"absolute",top:0,width:"1px",zIndex:10,"&:hover":{borderLeft:"2px solid rgba(0, 0, 0, 0.3)"},"&::before":{position:"absolute",top:0,bottom:0,left:"-8px",right:0,content:'" "'}}),draggerDragging:(0,o.css)({background:"rgba(136, 0, 136, 0.05)",width:"unset","&::before":{left:-2e3,right:-2e3}}),draggerDraggingLeft:(0,o.css)({borderLeft:"2px solid #808",borderRight:"1px solid #999"}),draggerDraggingRight:(0,o.css)({borderLeft:"1px solid #999",borderRight:"2px solid #808"}),gripIcon:(0,o.css)({position:"absolute",top:0,bottom:0,"&::before, &::after":{borderRight:"1px solid #ccc",content:'" "',height:"9px",position:"absolute",right:"9px",top:"25px"},"&::after":{right:"5px"}}),gripIconDragging:(0,o.css)({"&::before, &::after":{borderRight:"1px solid rgba(136, 0, 136, 0.5)"}})});class Er extends h.PureComponent{constructor(t){super(t),this._setRootElm=s=>{this._rootElm=s},this._getDraggingBounds=()=>{if(!this._rootElm)throw new Error("invalid state");const{left:s,width:r}=this._rootElm.getBoundingClientRect(),{min:a,max:i}=this.props;return{clientXLeft:s,width:r,maxValue:i,minValue:a}},this._handleDragUpdate=({value:s})=>{this.setState({dragPosition:s})},this._handleDragEnd=({manager:s,value:r})=>{s.resetBounds(),this.setState({dragPosition:null}),this.props.onChange(r)},this._dragManager=new rt({getBounds:this._getDraggingBounds,onDragEnd:this._handleDragEnd,onDragMove:this._handleDragUpdate,onDragStart:this._handleDragUpdate}),this._rootElm=void 0,this.state={dragPosition:null}}componentWillUnmount(){this._dragManager.dispose()}render(){let t,s;const{position:r,columnResizeHandleHeight:a}=this.props,{dragPosition:i}=this.state;t=`${r*100}%`;const l={left:t};let c=!1,u=!1;const p=Lr();if(this._dragManager.isDragging()&&this._rootElm&&i!=null){c=i<r,u=i>r;const m=`${Math.min(r,i)*100}%`,b=`calc(${(1-Math.max(r,i))*100}% - 1px)`;s={left:m,right:b}}else s=l;s.height=a;const g=c||u;return(0,n.jsxs)("div",{className:p.TimelineColumnResizer,ref:this._setRootElm,"data-testid":"TimelineColumnResizer",children:[(0,n.jsx)("div",{className:W()(p.gripIcon,g&&p.gripIconDragging),style:l,"data-testid":"TimelineColumnResizer--gripIcon"}),(0,n.jsx)("div",{"aria-hidden":!0,className:W()(p.dragger,g&&p.draggerDragging,u&&p.draggerDraggingRight,c&&p.draggerDraggingLeft),onMouseDown:this._dragManager.handleMouseDown,style:s,"data-testid":"TimelineColumnResizer--dragger"})]})}}const Ss=(0,ze.N)(()=>({TimelineViewingLayer:(0,o.css)({label:"TimelineViewingLayer",bottom:0,cursor:"vertical-text",left:0,position:"absolute",right:0,top:0}),TimelineViewingLayerCursorGuide:(0,o.css)({label:"TimelineViewingLayerCursorGuide",position:"absolute",top:0,bottom:0,left:0,width:"1px",backgroundColor:"red"}),TimelineViewingLayerDragged:(0,o.css)({label:"TimelineViewingLayerDragged",position:"absolute",top:0,bottom:0}),TimelineViewingLayerDraggedDraggingLeft:(0,o.css)({label:"TimelineViewingLayerDraggedDraggingLeft",borderLeft:"1px solid"}),TimelineViewingLayerDraggedDraggingRight:(0,o.css)({label:"TimelineViewingLayerDraggedDraggingRight",borderRight:"1px solid"}),TimelineViewingLayerDraggedShiftDrag:(0,o.css)({label:"TimelineViewingLayerDraggedShiftDrag",backgroundColor:"rgba(68, 68, 255, 0.2)",borderColor:"#44f"}),TimelineViewingLayerDraggedReframeDrag:(0,o.css)({label:"TimelineViewingLayerDraggedReframeDrag",backgroundColor:"rgba(255, 68, 68, 0.2)",borderColor:"#f44"}),TimelineViewingLayerFullOverlay:(0,o.css)({label:"TimelineViewingLayerFullOverlay",bottom:0,cursor:"col-resize",left:0,position:"fixed",right:0,top:0,userSelect:"none"})}));function jr(e){return Reflect.has(e,"isOutOfView")}function Lt(e,t,s){return e+s*(t-e)}function Et(e,t,s){return(s-e)/(t-e)}function Nr(e,t){let[s,r]=e<t?[e,t]:[t,e];return s>=1||r<=0?{isOutOfView:!0}:(s<0&&(s=0),r>1&&(r=1),{isDraggingLeft:e>t,left:`${s*100}%`,width:`${(r-s)*100}%`})}function jt(e,t,s,r,a){const i=Et(e,t,s),l=Et(e,t,r),c=Nr(i,l);if(jr(c))return null;const{isDraggingLeft:u,left:p,width:g}=c,m=Ss(),b=(0,o.cx)({[m.TimelineViewingLayerDraggedDraggingRight]:!u,[m.TimelineViewingLayerDraggedReframeDrag]:!a,[m.TimelineViewingLayerDraggedShiftDrag]:a});return(0,n.jsx)("div",{className:(0,o.cx)(m.TimelineViewingLayerDragged,m.TimelineViewingLayerDraggedDraggingLeft,b),style:{left:p,width:g},"data-testid":"Dragged"})}class Mr extends h.PureComponent{constructor(t){super(t),this._setRoot=s=>{this._root=s},this._getDraggingBounds=()=>{if(!this._root)throw new Error("invalid state");const{left:s,width:r}=this._root.getBoundingClientRect();return{clientXLeft:s,width:r}},this._handleReframeMouseMove=({value:s})=>{const[r,a]=this.props.viewRangeTime.current,i=Lt(r,a,s);this.props.updateNextViewRangeTime({cursor:i})},this._handleReframeMouseLeave=()=>{this.props.updateNextViewRangeTime({cursor:void 0})},this._handleReframeDragUpdate=({value:s})=>{const{current:r,reframe:a}=this.props.viewRangeTime,[i,l]=r,c=Lt(i,l,s),p={reframe:{anchor:a?a.anchor:c,shift:c}};this.props.updateNextViewRangeTime(p)},this._handleReframeDragEnd=({manager:s,value:r})=>{const{current:a,reframe:i}=this.props.viewRangeTime,[l,c]=a,u=Lt(l,c,r),p=i?i.anchor:u,[g,m]=u<p?[u,p]:[p,u];s.resetBounds(),this.props.updateViewRangeTime(g,m,"timeline-header")},this._draggerReframe=new rt({getBounds:this._getDraggingBounds,onDragEnd:this._handleReframeDragEnd,onDragMove:this._handleReframeDragUpdate,onDragStart:this._handleReframeDragUpdate,onMouseLeave:this._handleReframeMouseLeave,onMouseMove:this._handleReframeMouseMove}),this._root=void 0}UNSAFE_componentWillReceiveProps(t){const{boundsInvalidator:s}=this.props;s!==t.boundsInvalidator&&this._draggerReframe.resetBounds()}componentWillUnmount(){this._draggerReframe.dispose()}render(){const{viewRangeTime:t}=this.props,{current:s,cursor:r,reframe:a,shiftEnd:i,shiftStart:l}=t,[c,u]=s,p=a!=null||i!=null||l!=null;let g;!p&&r!=null&&r>=c&&r<=u&&(g=`${Et(c,u,r)*100}%`);const m=Ss();return(0,n.jsxs)("div",{"aria-hidden":!0,className:m.TimelineViewingLayer,ref:this._setRoot,onMouseDown:this._draggerReframe.handleMouseDown,onMouseLeave:this._draggerReframe.handleMouseLeave,onMouseMove:this._draggerReframe.handleMouseMove,"data-testid":"TimelineViewingLayer",children:[g!=null&&(0,n.jsx)("div",{className:m.TimelineViewingLayerCursorGuide,style:{left:g},"data-testid":"TimelineViewingLayer--cursorGuide"}),a!=null&&jt(c,u,a.anchor,a.shift,!1),i!=null&&jt(c,u,u,i,!0),l!=null&&jt(c,u,c,l,!0)]})}}const Or=e=>({TimelineHeaderRow:(0,o.css)({label:"TimelineHeaderRow",background:(0,T.R)(e,"#ececec"),borderBottom:`1px solid ${(0,T.R)(e,"#ccc")}`,height:"38px",lineHeight:"38px",width:"100%",zIndex:4,position:"relative"}),TimelineHeaderRowTitle:(0,o.css)({label:"TimelineHeaderRowTitle",flex:1,overflow:"hidden",margin:0,textOverflow:"ellipsis",whiteSpace:"nowrap"}),TimelineHeaderWrapper:(0,o.css)({label:"TimelineHeaderWrapper",alignItems:"center",display:"flex",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)})});function Ar(e){const{duration:t,nameColumnWidth:s,numTicks:r,onCollapseAll:a,onCollapseOne:i,onColummWidthChange:l,onExpandAll:c,onExpandOne:u,updateViewRangeTime:p,updateNextViewRangeTime:g,viewRangeTime:m,columnResizeHandleHeight:b}=e,[y,j]=m.current,O=(0,x.of)(Or);return(0,n.jsxs)(Pe,{className:O.TimelineHeaderRow,"data-testid":"TimelineHeaderRow",children:[(0,n.jsxs)(Pe.Cell,{className:O.TimelineHeaderWrapper,width:s,children:[(0,n.jsx)("h4",{className:O.TimelineHeaderRowTitle,children:(0,n.jsx)(f.x6,{i18nKey:"explore.timeline-header-row.title",children:"Service & Operation"})}),(0,n.jsx)(Rr,{onCollapseAll:a,onExpandAll:c,onCollapseOne:i,onExpandOne:u})]}),(0,n.jsxs)(Pe.Cell,{width:1-s,children:[(0,n.jsx)(Mr,{boundsInvalidator:s,updateNextViewRangeTime:g,updateViewRangeTime:p,viewRangeTime:m}),(0,n.jsx)(bs,{numTicks:r,startTime:y*t,endTime:j*t,showLabels:!0})]}),(0,n.jsx)(Er,{columnResizeHandleHeight:b,position:s,onChange:l,min:.2,max:.85})]})}var ws=d(7895);const Fr="peer.service";class Vr{constructor(t){this.ys=[],this.heights=[],this.bufferLen=t,this.dataLen=-1,this.lastI=-1}profileData(t){t!==this.dataLen&&(this.dataLen=t,this.ys.length=t,this.heights.length=t,this.lastI>=t&&(this.lastI=t-1))}calcHeights(t,s,r){r!=null&&(this.lastI=r);let a=t+this.bufferLen;if(a<=this.lastI)return;a>=this.heights.length&&(a=this.heights.length-1);let i=this.lastI;for(this.lastI===-1&&(i=0,this.ys[0]=0);i<=a;){const l=this.heights[i]=s(i);this.ys[i+1]=this.ys[i]+l,i++}this.lastI=a}calcYs(t,s){for(;(this.ys[this.lastI]==null||t>this.ys[this.lastI])&&this.lastI<this.dataLen-1;)this.calcHeights(this.lastI,s)}confirmHeight(t,s){let r=t;if(r>this.lastI){this.calcHeights(r,s);return}const a=s(r);if(a===this.heights[r])return;const i=a-this.heights[r];for(this.heights[r]=a;++r<=this.lastI;)this.ys[r]+=i;this.ys[this.lastI+1]!=null&&(this.ys[this.lastI+1]+=i)}findFloorIndex(t,s){this.calcYs(t,s);let r=0,a=this.lastI;if(this.ys.length<2||t<this.ys[1])return 0;if(t>this.ys[a])return a;let i;for(;r<a;)if(i=r+.5*(a-r)|0,t>this.ys[i]){if(t<=this.ys[i+1])return i;r=i}else if(t<this.ys[i]){if(t>=this.ys[i-1])return i-1;a=i}else return i;throw new Error(`unable to find floor index for y=${t}`)}getRowPosition(t,s){return this.confirmHeight(t,s),{height:this.heights[t],y:this.ys[t]}}getEstimatedHeight(){const t=this.ys[this.lastI]+this.heights[this.lastI];return this.lastI>=this.dataLen-1?t|0:t/(this.lastI+1)*this.heights.length|0}}const Ts=100;class _r extends h.Component{constructor(t){super(t),this.getViewHeight=()=>this._viewHeight,this.getBottomVisibleIndex=()=>{const s=this._scrollTop+this._viewHeight;return this._yPositions.findFloorIndex(s,this._getHeight)},this.getTopVisibleIndex=()=>this._yPositions.findFloorIndex(this._scrollTop,this._getHeight),this.getRowPosition=s=>this._yPositions.getRowPosition(s,this._getHeight),this.scrollToIndex=(s,r)=>{const{scrollElement:a}=this.props,i=a?.getBoundingClientRect().top||0,c=(a?.scrollTop||0)+(this._itemHolderElm?.getBoundingClientRect().top||0)-i,u=this.getRowPosition(s).y;this.props.scrollElement?.scrollTo({top:u+c-r-80})},this._onScroll=()=>{this._isScrolledOrResized||(this._isScrolledOrResized=!0,window.requestAnimationFrame(this._positionList))},this._positionList=()=>{if(this._isScrolledOrResized=!1,!this._wrapperElm)return;this._calcViewIndexes();const s=this.props.viewBufferMin>this._startIndex?0:this._startIndex-this.props.viewBufferMin,r=this.props.viewBufferMin<this.props.dataLength-this._endIndex?this._endIndex+this.props.viewBufferMin:this.props.dataLength-1;(s<this._startIndexDrawn||r>this._endIndexDrawn)&&this.forceUpdate()},this._initWrapper=s=>{this.props.windowScroller&&(this._wrapperElm=s,s&&(this._viewHeight=s.clientHeight))},this._initItemHolder=s=>{this._itemHolderElm=s,this._scanItemHeights()},this._scanItemHeights=()=>{const s=this.props.getIndexFromKey;if(!this._itemHolderElm)return;let r=null,a=null,i=!1;const l=this._itemHolderElm.childNodes,c=l.length;for(let u=0;u<c;u++){const p=l[u];if(p instanceof HTMLElement){const g=p.getAttribute("data-item-key");if(!g){console.warn("itemKey not found");continue}const b=(p.firstElementChild||p).clientHeight,y=this._knownHeights.get(g);b!==y&&(this._knownHeights.set(g,b),i?a=g:(i=!0,r=a=g))}}if(r!=null&&a!=null){const u=s(r),p=a===r?u:s(a);this._yPositions.calcHeights(p,this._getHeight,u),this.forceUpdate()}},this._getHeight=s=>{const r=this.props.getKeyFromIndex(s),a=this._knownHeights.get(r);return a!=null&&a===a?a:this.props.itemHeightGetter(s,r)},this._yPositions=new Vr(200),this._knownHeights=new Map,this._startIndexDrawn=2**20,this._endIndexDrawn=-(2**20),this._startIndex=0,this._endIndex=0,this._viewHeight=-1,this._scrollTop=-1,this._isScrolledOrResized=!1,this._htmlTopOffset=-1,this._windowScrollListenerAdded=!1,this._htmlElm=document.documentElement,this._wrapperElm=void 0,this._itemHolderElm=void 0}static{this.defaultProps={initialDraw:Ts,itemsWrapperClassName:"",windowScroller:!1}}componentDidMount(){if(this.props.windowScroller){if(this._wrapperElm){const{top:t}=this._wrapperElm.getBoundingClientRect();this._htmlTopOffset=t+this._htmlElm.scrollTop}window.addEventListener("scroll",this._onScroll),this._windowScrollListenerAdded=!0}else this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll)}componentDidUpdate(t){this._itemHolderElm&&this._scanItemHeights(),!this.props.windowScroller&&t.scrollElement!==this.props.scrollElement&&(t.scrollElement?.removeEventListener("scroll",this._onScroll),this._wrapperElm=this.props.scrollElement,this._wrapperElm?.addEventListener("scroll",this._onScroll))}componentWillUnmount(){this._windowScrollListenerAdded?window.removeEventListener("scroll",this._onScroll):this._wrapperElm?.removeEventListener("scroll",this._onScroll)}_isViewChanged(){if(!this._wrapperElm)return!1;const t=this.props.windowScroller,s=t?this._htmlElm.clientHeight:this._wrapperElm.clientHeight,r=t?this._htmlElm.scrollTop:this._wrapperElm.scrollTop;return s!==this._viewHeight||r!==this._scrollTop}_calcViewIndexes(){if(this.props.windowScroller)this._viewHeight=window.innerHeight-this._htmlTopOffset,this._scrollTop=window.scrollY;else{if(!this._wrapperElm){this._viewHeight=-1,this._startIndex=0,this._endIndex=0;return}this._viewHeight=this._wrapperElm.clientHeight,this._scrollTop=this._wrapperElm.scrollTop}const s=this._scrollTop,r=this._scrollTop+this._viewHeight;this._startIndex=this._yPositions.findFloorIndex(s,this._getHeight),this._endIndex=this._yPositions.findFloorIndex(r,this._getHeight)}render(){const{dataLength:t,getKeyFromIndex:s,initialDraw:r=Ts,itemRenderer:a,viewBuffer:i,viewBufferMin:l}=this.props,c=this._getHeight,u=[];let p,g;if(this._yPositions.profileData(t),!this._wrapperElm)p=0,g=(r<t?r:t)-1;else{this._isViewChanged()&&this._calcViewIndexes();const y=l>this._startIndex?0:this._startIndex-l,j=l<t-this._endIndex?this._endIndex+l:t-1;y<this._startIndexDrawn||j>this._endIndexDrawn?(p=i>this._startIndex?0:this._startIndex-i,g=this._endIndex+i,g>=t&&(g=t-1)):(p=this._startIndexDrawn>t-1?0:this._startIndexDrawn,g=this._endIndexDrawn>t-1?t-1:this._endIndexDrawn)}this._yPositions.calcHeights(g,c,p||-1),this._startIndexDrawn=p,this._endIndexDrawn=g,u.length=g-p+1;for(let y=p;y<=g;y++){const{y:j,height:O}=this._yPositions.getRowPosition(y,c),A={height:O,top:j,position:"absolute"},P=s(y),G={"data-item-key":P};u.push(a(P,A,y,G))}const m={style:{position:"relative"},ref:this._initWrapper};this.props.windowScroller||(m.onScroll=this._onScroll,m.style.height="100%",m.style.overflowY="auto");const b={position:"relative",height:this._yPositions.getEstimatedHeight()};return(0,n.jsx)("div",{...m,"data-testid":"ListView",children:(0,n.jsx)("div",{style:b,children:(0,n.jsx)("div",{style:{position:"absolute",top:0,margin:0,padding:0},className:this.props.itemsWrapperClassName,ref:this._initItemHolder,children:u})})})}}const Ds="None",Cs="Duration",Nt="Tag";function Pr({options:e,onOptionsChange:t}){const s=useStyles2(Br),r=[Ds,Cs,Nt].map(toOption);return jsxs("div",{className:css({width:"100%"}),children:[jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:jsx(Select,{inputId:"label",options:r,value:e.jsonData.spanBar?.type||"",onChange:a=>{updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,type:a?.value??""})},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),e.jsonData.spanBar?.type===Nt&&jsx(InlineFieldRow,{className:s.row,children:jsx(InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:jsx(Input,{type:"text",placeholder:"Enter tag key",onChange:a=>updateDatasourcePluginJsonDataOption({onOptionsChange:t,options:e},"spanBar",{...e.jsonData.spanBar,tag:a.currentTarget.value}),value:e.jsonData.spanBar?.tag||"",width:40})})})]})}const Ai=({options:e,onOptionsChange:t})=>{let s=e.type;return s+=e.type==="tempo"?"/configure-tempo-data-source/#span-bar":"/#span-bar",jsx(ConfigSubSection,{title:"Span bar",description:jsx(ConfigDescriptionLink,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:s,feature:"the span bar"}),children:jsx(Pr,{options:e,onOptionsChange:t})})},Br=e=>({infoText:css({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:css({label:"row",alignItems:"baseline"})});var Hr=d(51898),$r=d(43533),Wr=d(2381);function Kr({children:e,content:t,overlayClassName:s}){const r=(0,h.useRef)(null);return(0,n.jsx)($r.I,{content:t,hideAfter:300,children:(a,i,l)=>(0,n.jsxs)(n.Fragment,{children:[r.current&&(0,n.jsx)(Wr.A,{...l,referenceElement:r.current,wrapperClassName:s,onMouseLeave:i,onMouseEnter:a}),(0,h.cloneElement)(e,{ref:r,onMouseEnter:a,onMouseLeave:i})]})})}const zr="label";var Ur=d(21961),Gr=d(11908),ks=d(54092),Rs=d(46907),Zr=d(3271),Qr=d(87105),gt=d(17548),ft=d(25229),Ls=d(78529),ge=(e=>(e.Logs="log",e.Traces="trace",e.Metrics="metric",e.Profiles="profile",e.ProfilesDrilldown="profile-drilldown",e.Session="session",e.Unknown="unknown",e))(ge||{});function Xr({splitOpenFn:e,traceToLogsOptions:t,traceToMetricsOptions:s,traceToProfilesOptions:r,dataFrame:a,createFocusSpanLink:i,trace:l}){if(!a)return;let c=Os(l.duration,l.traceName,l.traceID);const u=a.fields.some(g=>!!g.config.links?.length),p=Jr(e,a.fields[0],t,s,i,c);return function(m){let b=p(m);if(u){c={...c,...Ot(m),...As(m,r)};const y=a.fields.filter(j=>!!j.config.links?.length);try{let j;r?.datasourceUid&&(j=(0,w.tR)().getInstanceSettings(r.datasourceUid));const O=j?.type==="grafana-pyroscope-datasource",A=m.tags.some(_=>_.key===mt),P=O&&A;let G=[];y.forEach(_=>{const te=(0,Ls.QL)({field:_,rowIndex:m.dataFrameRowIndex,splitOpenFn:e,range:Mt(m,void 0,void 0,P),dataFrame:a,vars:c});G=G.concat(te)});const Q=G.map(_=>({title:_.title,href:_.href,onClick:_.onClick,content:(0,n.jsx)(ee.I,{name:"link",title:_.title||"Link"}),field:_.origin,type:P?ge.Profiles:ge.Unknown,target:_.target}));b.push.apply(b,Q)}catch(j){return console.error(j),b}}return b}}const Es=e=>e.map(t=>({key:t,value:t.includes(".")?t.replace(".","_"):void 0})),js=Es(["cluster","hostname","namespace","pod","service.name","service.namespace"]),Ns=Es(["service.name","service.namespace"]),mt="pyroscope.profile.id",Yr="gf.feo11y.app.id";function Jr(e,t,s,r,a,i){let l;s?.datasourceUid&&(l=(0,w.tR)().getInstanceSettings(s.datasourceUid));const c=l?.type==="grafana-splunk-datasource";let u;return r?.datasourceUid&&(u=(0,w.tR)().getInstanceSettings(r.datasourceUid)),function(g){i={...i,...Ot(g)};const m=[];let b,y="";if(l&&s){const O=s.customQuery?s.query:void 0,A=s.tags&&s.tags.length>0?s.tags:js;switch(l?.type){case"loki":y=Ge(g,A),b=qr(g,s,y,O);break;case"grafana-splunk-datasource":y=Ge(g,A,{joinBy:" "}),b=sa(g,s,y,O);break;case"elasticsearch":case"grafana-opensearch-datasource":y=Ge(g,A,{labelValueSign:":",joinBy:" AND "}),b=ta(g,s,y,O);break;case"grafana-falconlogscale-datasource":y=Ge(g,A,{joinBy:" OR "}),b=ra(g,s,y,O);break;case"googlecloud-logging-datasource":y=Ge(g,A,{joinBy:" AND "}),b=na(g,s,y,O)}if(b){const P={title:l.name,url:"",internal:{datasourceUid:l.uid,datasourceName:l.name,query:b}};if(i={...i,__tags:{text:(0,f.t)("explore.legacy-create-span-link-factory.text.tags","Tags"),value:y}},(0,Ls.O1)(P.internal.query,i).allVariablesDefined){const G=(0,E.u)({link:P,internalLink:P.internal,scopedVars:i,range:Mt(g,{startMs:s.spanStartTimeShift?gt.intervalToMs(s.spanStartTimeShift):0,endMs:s.spanEndTimeShift?gt.intervalToMs(s.spanEndTimeShift):0},c),field:{},onClickFn:e,replaceVariables:(0,Y.w)().replace.bind((0,Y.w)())});m.push({href:G.href,title:(0,f.t)("explore.legacy-create-span-link-factory.title.related-logs","Related logs"),onClick:G.onClick,content:(0,n.jsx)(ee.I,{name:"gf-logs",title:(0,f.t)("explore.legacy-create-span-link-factory.title-explore-split","Explore the logs for this in split view")}),field:t,type:ge.Logs})}}}if(u&&r?.queries)for(const O of r.queries){const A=O.query||`histogram_quantile(0.5, sum(rate(traces_spanmetrics_latency_bucket{service="${g.process.serviceName}"}[5m])) by (le))`,P={title:u.name,url:"",internal:{datasourceUid:u.uid,datasourceName:u.name,query:{expr:A,refId:"A"}}},G=r.tags&&r.tags.length>0?r.tags:js;i={...i,__tags:{text:(0,f.t)("explore.legacy-create-span-link-factory.text.tags","Tags"),value:Ge(g,G)}};const Q=(0,E.u)({link:P,internalLink:P.internal,scopedVars:i,range:Mt(g,{startMs:r.spanStartTimeShift?gt.intervalToMs(r.spanStartTimeShift):-12e4,endMs:r.spanEndTimeShift?gt.intervalToMs(r.spanEndTimeShift):12e4}),field:{},onClickFn:e,replaceVariables:(0,Y.w)().replace.bind((0,Y.w)())});m.push({title:O?.name,href:Q.href,onClick:Q.onClick,content:(0,n.jsx)(ee.I,{name:"chart-line",title:(0,f.t)("explore.legacy-create-span-link-factory.title-explore-metrics-for-this-span","Explore metrics for this span")}),field:t,type:ge.Metrics})}if(g.references&&a)for(const O of g.references){if(O.refType==="CHILD_OF")continue;const A=a(O.traceID,O.spanID),P=Ms(O);m.push({href:A.href,title:P,content:(0,n.jsx)(ee.I,{name:"link",title:P}),onClick:A.onClick,field:A.origin,type:ge.Traces})}if(g.subsidiarilyReferencedBy&&a)for(const O of g.subsidiarilyReferencedBy){const A=a(O.traceID,O.spanID),P=Ms(O);m.push({href:A.href,title:P,content:(0,n.jsx)(ee.I,{name:"link",title:P}),onClick:A.onClick,field:A.origin,type:ge.Traces})}const j=ea(g);return j&&m.push({title:(0,f.t)("explore.legacy-create-span-link-factory.title.session-for-this-span","Session for this span"),href:j,content:(0,n.jsx)(ee.I,{name:"frontend-observability",title:(0,f.t)("explore.legacy-create-span-link-factory.title-session-for-this-span","Session for this span")}),field:t,type:ge.Session}),m}}const Ms=e=>{let t=e.span?e.span.operationName:"View linked span";return e.refType==="EXTERNAL"&&(t="View linked span"),t};function qr(e,t,s,r){const{filterByTraceID:a,filterBySpanID:i}=t;if(r)return{expr:r,refId:""};if(!s)return;let l="{${__tags}}";return a&&e.traceID&&(l+=' | label_format log_line_contains_trace_id=`{{ contains "${__span.traceId}" __line__  }}` | log_line_contains_trace_id="true" OR trace_id="${__span.traceId}"'),i&&e.spanID&&(l+=' | label_format log_line_contains_span_id=`{{ contains "${__span.spanId}" __line__  }}` | log_line_contains_span_id="true" OR span_id="${__span.spanId}"'),{expr:l,refId:""}}function ea(e){const t=e.process.tags.find(r=>r.key===Yr)?.value,s=e.tags.find(r=>r.key==="session_id"||r.key==="session.id")?.value;return t&&s?`/a/grafana-kowalski-app/apps/${t}/sessions/${s}`:void 0}function ta(e,t,s,r){const{filterByTraceID:a,filterBySpanID:i}=t;if(r)return{query:r,refId:"",metrics:[{id:"1",type:"logs"}]};let l=[];return i&&e.spanID&&l.push('"${__span.spanId}"'),a&&e.traceID&&l.push('"${__span.traceId}"'),s&&l.push("${__tags}"),{query:l.join(" AND "),refId:"",metrics:[{id:"1",type:"logs"}]}}function sa(e,t,s,r){const{filterByTraceID:a,filterBySpanID:i}=t;if(r)return{query:r,refId:""};let l="";return s&&(l+="${__tags}"),a&&e.traceID&&(l+=' "${__span.traceId}"'),i&&e.spanID&&(l+=' "${__span.spanId}"'),{query:l,refId:""}}function na(e,t,s,r){const{filterByTraceID:a,filterBySpanID:i}=t;if(r)return{query:r,refId:""};let l=[];return i&&e.spanID&&l.push('"${__span.spanId}"'),a&&e.traceID&&l.push('"${__span.traceId}"'),s&&l.push("${__tags}"),{query:l.join(" AND "),refId:""}}function ra(e,t,s,r){const{filterByTraceID:a,filterBySpanID:i}=t;if(r)return{lsql:r,refId:""};if(!s)return;let l="${__tags}";return a&&e.traceID&&(l+=' or "${__span.traceId}"'),i&&e.spanID&&(l+=' or "${__span.spanId}"'),{lsql:l,refId:""}}function Ge(e,t,{labelValueSign:s="=",joinBy:r=", "}={}){return[...e.process.tags,...e.tags,{key:"spanId",value:e.spanID},{key:"traceId",value:e.traceID},{key:"name",value:e.operationName},{key:"duration",value:e.duration}].map(a=>{const i=t.find(l=>l.key===a.key);if(i)return`${i.value?i.value:i.key}${s}"${a.value}"`}).filter(a=>!!a).join(r)}function Mt(e,t={startMs:0,endMs:0},s=!1,r=!1){let a=Math.floor(e.startTime/1e3+t.startMs);const i=(e.startTime+e.duration)/1e3;let l=Math.floor(i+t.endMs);s&&l-a<1e3?l=a+1e3:r?(a=a-6e4,l=l+6e4):a===l&&l++;const c=(0,ft.KQ)(l),u=(0,ft.KQ)(a);return{from:u,to:c,raw:{from:u,to:c}}}function Os(e,t,s){return{__trace:{text:(0,f.t)("explore.scoped-vars-from-trace.text.trace","Trace"),value:{duration:e,name:t,traceId:s}}}}function Ot(e){const t={};for(const s of e.process.tags)t[s.key]=s.value;for(const s of e.tags)t[s.key]=s.value;return{__span:{text:(0,f.t)("explore.scoped-vars-from-span.text.span","Span"),value:{spanId:e.spanID,traceId:e.traceID,duration:e.duration,name:e.operationName,tags:t}}}}function As(e,t){let s={};if(t){const r=t.tags&&t.tags.length>0?t.tags:Ns;s={__tags:{text:(0,f.t)("explore.scoped-vars-from-tags.text.tags","Tags"),value:Ge(e,r)}}}return s}const aa=e=>t=>({LabeledList:(0,o.css)({label:"LabeledList",listStyle:"none",margin:0,padding:0,...e?{marginRight:"-8px",display:"flex",flexWrap:"wrap",justifyContent:"flex-end"}:{}}),LabeledListItem:(0,o.css)({label:"LabeledListItem",display:"inline-block",...e?{borderRight:`1px solid ${(0,T.R)(t,"#ddd")}`,padding:"0 8px"}:{}}),LabeledListLabel:(0,o.css)({label:"LabeledListLabel",color:t.isLight?"#999":"#666",marginRight:"0.25rem"}),LabeledListValue:(0,o.css)({label:"LabeledListValue",marginRight:e?void 0:"0.55rem"})});function ia(e){const{className:t,divider:s=!1,items:r}=e,a=(0,x.of)(aa(s));return(0,n.jsx)("ul",{className:W()(a.LabeledList,t),children:r.map(({key:i,label:l,value:c})=>(0,n.jsxs)("li",{className:a.LabeledListItem,children:[(0,n.jsx)("span",{className:a.LabeledListLabel,children:l}),(0,n.jsx)("strong",{className:a.LabeledListValue,children:c})]},`${i}`))})}var Ye=d(34282);function oa(e){const{reference:t,children:s,createFocusSpanLink:r}=e,a=r(t.traceID,t.spanID);return(0,n.jsx)("a",{href:a.href,target:a.target,rel:"noopener noreferrer",onClick:a.onClick?i=>{i.preventDefault(),a.onClick(i)}:void 0,children:s})}const Fs=e=>({AccordianReferenceItem:(0,o.css)({borderBottom:`1px solid ${(0,T.R)(e,"#d8d8d8")}`}),AccordianKeyValues:(0,o.css)({marginLeft:"10px"}),AccordianReferences:(0,o.css)({label:"AccordianReferences",border:`1px solid ${(0,T.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianReferencesHeader:(0,o.css)({label:"AccordianReferencesHeader",background:(0,T.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,T.R)(e,"#dadada")}}),AccordianReferencesContent:(0,o.css)({label:"AccordianReferencesContent",background:(0,T.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,T.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianReferencesFooter:(0,o.css)({label:"AccordianReferencesFooter",color:(0,T.R)(e,"#999")}),AccordianKeyValuesItem:(0,o.css)({marginBottom:e.spacing(.5)}),ReferencesList:(0,o.css)({background:"#fff",border:"1px solid #ddd",marginBottom:"0.7em",maxHeight:"450px",overflow:"auto"}),list:(0,o.css)({width:"100%",listStyle:"none",padding:0,margin:0,background:"#fff"}),itemContent:(0,o.css)({padding:"0.25rem 0.5rem",display:"flex",width:"100%",justifyContent:"space-between"}),item:(0,o.css)({"&:nth-child(2n)":{background:"#f5f5f5"}}),debugInfo:(0,o.css)({letterSpacing:"0.25px",margin:"0.5em 0 0",flexWrap:"wrap",display:"flex",justifyContent:"flex-end"}),debugLabel:(0,o.css)({margin:"0 5px 0 5px","&::before":{color:"#bbb",content:"attr(data-label)"}}),serviceName:(0,o.css)({marginRight:"8px"}),title:(0,o.css)({display:"flex",alignItems:"center",gap:"4px"})});function la(e){const{data:t,createFocusSpanLink:s,openedItems:r,onItemToggle:a,interactive:i}=e,l=(0,x.of)(Fs);return(0,n.jsx)("div",{className:l.AccordianReferencesContent,children:t.map((c,u)=>(0,n.jsxs)("div",{className:u<t.length-1?l.AccordianReferenceItem:void 0,children:[(0,n.jsx)("div",{className:l.item,children:(0,n.jsx)(oa,{reference:c,createFocusSpanLink:s,children:(0,n.jsxs)("span",{className:l.itemContent,children:[c.span?(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:(0,o.cx)("span-svc-name",l.serviceName),children:c.span.process.serviceName}),(0,n.jsx)("small",{className:"endpoint-name",children:c.span.operationName})]}):(0,n.jsxs)("span",{className:(0,o.cx)("span-svc-name",l.title),children:[(0,n.jsx)(f.x6,{i18nKey:"explore.accordian-references.view-linked-span",children:"View Linked Span"})," ",(0,n.jsx)(ee.I,{name:"external-link-alt"})]}),(0,n.jsxs)("small",{className:l.debugInfo,children:[(0,n.jsx)("span",{className:l.debugLabel,"data-label":"TraceID:",children:c.traceID}),(0,n.jsx)("span",{className:l.debugLabel,"data-label":"SpanID:",children:c.spanID})]})]})})},`${c.spanID}`),!!c.tags?.length&&(0,n.jsx)("div",{className:l.AccordianKeyValues,children:(0,n.jsx)(xt,{className:u<t.length-1?l.AccordianKeyValuesItem:null,data:c.tags||[],highContrast:!0,interactive:i,isOpen:r?r.has(c):!1,label:(0,f.t)("explore.references.label-attributes","attributes"),onToggle:i&&a?()=>a(c):null})})]},u))})}const ca=({data:e,interactive:t=!0,isOpen:s,onToggle:r,onItemToggle:a,openedItems:i,createFocusSpanLink:l})=>{const c=!Array.isArray(e)||!e.length;let u=null,p="span",g=null;t&&(u=s?(0,n.jsx)(ee.I,{name:"angle-down",className:Je}):(0,n.jsx)(ee.I,{name:"angle-right",className:Je}),p="a",g={"aria-checked":s,onClick:c?null:r,role:"switch"});const m=(0,x.of)(Fs);return(0,n.jsxs)("div",{className:m.AccordianReferences,children:[(0,n.jsxs)(p,{className:m.AccordianReferencesHeader,...g,children:[u,(0,n.jsx)("strong",{children:(0,n.jsx)("span",{children:(0,n.jsx)(f.x6,{i18nKey:"explore.accordian-references.references",children:"References"})})})," ","(",e.length,")"]}),s&&(0,n.jsx)(la,{data:e,openedItems:i,createFocusSpanLink:l,onItemToggle:a,interactive:t})]})},da=h.memo(ca),ua=()=>({TextList:(0,o.css)({maxHeight:"450px",overflow:"auto"}),List:(0,o.css)({width:"100%",listStyle:"none",padding:0,margin:0}),item:(0,o.css)({padding:"0.25rem 0.5rem",verticalAlign:"top","&:nth-child(2n)":{background:"#f5f5f5"}})});function pa(e){const{data:t}=e,s=(0,x.of)(ua);return(0,n.jsx)("div",{className:W()(s.TextList),"data-testid":"TextList",children:(0,n.jsx)("ul",{className:s.List,children:t.map((r,a)=>(0,n.jsx)("li",{className:s.item,children:r},`${a}`))})})}const ha=e=>({header:(0,o.css)({cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,T.R)(e,"#e8e8e8")}})});function ga({data:e}){return(0,n.jsx)(pa,{data:e})}function Vs({className:e=null,data:t,headerClassName:s,highContrast:r=!1,interactive:a=!0,isOpen:i,label:l,onToggle:c=null,TextComponent:u=ga}){const p=!Array.isArray(t)||!t.length,g=(0,x.of)(At),m=W()(Je,{[g.emptyIcon]:p});let b=null,y=null;a&&(b=i?(0,n.jsx)(ee.I,{name:"angle-down",className:m}):(0,n.jsx)(ee.I,{name:"angle-right",className:m}),y={"aria-checked":i,onClick:p?null:c,role:"switch"});const j=(0,x.of)(ha);return(0,n.jsxs)("div",{className:e||"",children:[(0,n.jsxs)("div",{className:W()(j.header,s),...y,"data-testid":"AccordianText--header",children:[b,(0,n.jsx)("strong",{children:l})," (",t.length,")"]}),i&&(0,n.jsx)(u,{data:t})]})}var fa=d(36490),ma=d(28134),_s=d(87063),xa=d(88559),va=d(25192);const Ps=[ge.Metrics,ge.Logs,ge.Profiles,ge.ProfilesDrilldown,ge.Session],ya=3,ba=/^https?:\/\//i,Ia=e=>{const{span:t,createSpanLink:s,traceToProfilesOptions:r,timeRange:a,datasourceType:i,app:l}=e;let c;if(s){const u=(s(t)||[]).filter(p=>p.type!==ge.Traces).map(p=>p.type===ge.Logs?at(p,ge.Logs,"Logs for this span","gf-logs",i):p.type===ge.Profiles&&p.title===va.cd?(c=p,at(p,ge.Profiles,"Profiles for this span","link",i)):p.type===ge.Session?at(p,ge.Session,"Session for this span","frontend-observability",i):at(p,ge.Unknown,p.title||"","link",i));if(c&&l===R.Jk.Explore){const p="grafana-pyroscope-app",g=wa(t,r,a),m=ks.S.TraceViewDetails,{links:b}=(0,Rs.U)({extensionPointId:m,context:g,limitPerPlugin:1}),y=b&&b.length>0?b.find(A=>A.pluginId===p):null,j="Open in Profiles Drilldown",O={...c,href:"",onClick:()=>{y?.onClick?.()}};u.push(at(O,ge.ProfilesDrilldown,j,"link",i))}return u.sort((p,g)=>{const m=Ps.indexOf(p.type),b=Ps.indexOf(g.type),y=m===-1?Number.MAX_SAFE_INTEGER:m,j=b===-1?Number.MAX_SAFE_INTEGER:b;return y-j}),u.length>ya?(0,n.jsx)(Sa,{links:u}):(0,n.jsx)(n.Fragment,{children:u.map(({linkModel:p,icon:g,className:m},b)=>(0,n.jsx)(ma.R,{link:p,buttonProps:{icon:g,className:m}},b))})}return(0,n.jsx)(n.Fragment,{})},Sa=({links:e})=>{const[t,s]=h.useState(!1),r=(0,n.jsx)(_s.W,{children:e.map(({linkModel:a},i)=>(0,n.jsx)(_s.W.Item,{label:a.title,onClick:l=>a.onClick?.(l)},i))});return(0,n.jsx)(xa.m,{overlay:r,placement:"bottom-start",onVisibleChange:s,children:(0,n.jsx)(ws.I,{variant:"primary",icon:"link",isOpen:t,"aria-label":(0,f.t)("explore.drop-down-menu.aria-label-links","Links"),children:(0,n.jsx)(f.x6,{i18nKey:"explore.drop-down-menu.links",children:"Links"})})})},wa=(e,t,s)=>{const r=e.tags.filter(i=>i.key===mt);return{serviceName:e.process.serviceName??"",profileTypeId:t?.profileTypeId??"",spanSelector:r.length===1&&r[0].value?r[0].value:"",explorationType:"flame-graph",timeRange:{from:s.from.toISOString(),to:s.to.toISOString()},datasource:{uid:t?.datasourceUid}}},at=(e,t,s,r,a,i)=>({icon:r,className:i,type:t,linkModel:{...e,title:s,target:"_blank",origin:e.field,onClick:l=>{(0,Ve.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:a,grafana_version:_e.$.buildInfo.version,type:t,location:"spanDetails"}),e.onClick?e.onClick?.(l):ba.test(e.href)?window.open(e.href,"_blank","noopener,noreferrer"):fa.Ny.push(e.href)}}});var Ta=d(49185),Da=d(75505),Ca=d(10020),ka=d(36580);function Ra(e){const{span:t,traceToProfilesOptions:s,timeZone:r,traceFlameGraphs:a,setTraceFlameGraphs:i,setRedrawListView:l,traceDuration:c,traceName:u}=e,[p,{height:g}]=(0,Ta.A)(),m=(0,x.of)(La),b=t.tags.filter(P=>P.key===mt),y=b.length>0?b[0].value:void 0,j=(0,h.useCallback)(()=>{const P=Math.floor(t.startTime/1e3)-3e4,G=(t.startTime+t.duration)/1e3+3e4,Q=(0,ft.KQ)(G),_=(0,ft.KQ)(P);return{from:_,to:Q,raw:{from:_,to:Q}}},[t.duration,t.startTime]),O=async(P,G)=>{const Q=await(0,w.tR)().get(G);if(Q instanceof ka.iy){const te=(await(0,Da.s)(Q.query(P))).data.find(oe=>oe.name==="response");if(te&&te.length>1)return te}},A=(0,h.useCallback)(async(P,G,Q)=>{let _="{}";if(G.customQuery&&G.query){const de={...Os(c,u,Q.traceID),...Ot(Q),...As(Q,G)};_=(0,Y.w)().replace(G.query,de)}else{const de=G.tags&&G.tags.length>0?G.tags:Ns;_=`{${Ge(Q,de)}}`}const te={requestId:"span-flamegraph-requestId",interval:"2s",intervalMs:2e3,range:j(),scopedVars:{},app:R.Jk.Unknown,timezone:r,startTime:Q.startTime,targets:[{labelSelector:_,groupBy:[],profileTypeId:G.profileTypeId??"",queryType:"profile",spanSelector:[y],refId:"span-flamegraph-refId",datasource:{type:P.type,uid:P.uid}}]},oe=await O(te,P.uid);oe&&oe.length>0&&i({...a,[y]:oe})},[j,y,i,r,c,a,u]);return(0,h.useEffect)(()=>{if(!Object.keys(a).includes(y)){let P;s&&s?.datasourceUid&&(P=(0,w.tR)().getInstanceSettings(s.datasourceUid)),s&&P&&A(P,s,t)}},[i,t,a,s,j,r,A,y]),(0,h.useEffect)(()=>{l({})},[g,l]),a[y]?(0,n.jsxs)("div",{className:m.flameGraph,ref:p,children:[(0,n.jsx)("div",{className:m.flameGraphTitle,children:(0,n.jsx)(f.x6,{i18nKey:"explore.span-flame-graph.flame-graph",children:"Flame graph"})}),(0,n.jsx)(Ca.Ay,{data:a[y],getTheme:()=>_e.$.theme2,showFlameGraphOnly:!0,disableCollapsing:!0})]}):(0,n.jsx)(n.Fragment,{})}const La=()=>({flameGraph:(0,o.css)({label:"flameGraphInSpan",margin:"5px"}),flameGraphTitle:(0,o.css)({label:"flameGraphTitleInSpan",marginBottom:"5px",fontWeight:"bold"})}),Ea=(e,t,s)=>{const r=(0,h.useMemo)(()=>({attributes:(e.tags??[]).reduce((c,u)=>(c[u.key]?c[u.key].push(u.value):c[u.key]=[u.value],c),{}),datasource:{type:t,uid:s}}),[e.tags,t,s]),{links:a}=(0,Rs.U)({extensionPointId:ks.S.TraceViewResourceAttributes,limitPerPlugin:10,context:r});return(0,h.useCallback)((l,c)=>{const{key:u}=l[c]??{};return a.filter(p=>p.category===u)},[a])},ja=e=>({header:(0,o.css)({display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"0 1rem",marginBottom:"0.25rem"}),listWrapper:(0,o.css)({overflow:"hidden"}),list:(0,o.css)({textAlign:"right"}),operationName:(0,o.css)({margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexBasis:"50%",flexGrow:0,flexShrink:0}),debugInfo:(0,o.css)({label:"debugInfo",display:"block",letterSpacing:"0.25px",margin:"0.5em 0 -0.75em",textAlign:"right"}),debugLabel:(0,o.css)({label:"debugLabel","&::before":{color:(0,T.R)(e,"#bbb"),content:"attr(data-label)"}}),debugValue:(0,o.css)({label:"debugValue",backgroundColor:"inherit",border:"none",color:(0,T.R)(e,"#888"),cursor:"pointer","&:hover":{color:(0,T.R)(e,"#333")}}),AccordianWarnings:(0,o.css)({label:"AccordianWarnings",background:(0,T.R)(e,"#fafafa"),border:`1px solid ${(0,T.R)(e,"#e4e4e4")}`,marginBottom:"0.25rem"}),AccordianWarningsHeader:(0,o.css)({label:"AccordianWarningsHeader",background:(0,T.R)(e,"#fff7e6"),padding:"0.25rem 0.5rem","&:hover":{background:(0,T.R)(e,"#ffe7ba")}}),AccordianWarningsHeaderOpen:(0,o.css)({label:"AccordianWarningsHeaderOpen",borderBottom:`1px solid ${(0,T.R)(e,"#e8e8e8")}`}),AccordianWarningsLabel:(0,o.css)({label:"AccordianWarningsLabel",color:(0,T.R)(e,"#d36c08")}),AccordianKeyValuesItem:(0,o.css)({marginBottom:e.spacing(.5)}),Textarea:(0,o.css)({wordBreak:"break-all",whiteSpace:"pre"}),LinkIcon:(0,o.css)({fontSize:"1.5em"}),linkList:(0,o.css)({display:"flex",flexWrap:"wrap",gap:"10px"})}),Je=(0,o.css)({margin:"-0.2rem 0.25rem 0 0"});function Na(e){const{detailState:t,logItemToggle:s,logsToggle:r,processToggle:a,span:i,tagsToggle:l,traceStartTime:c,traceDuration:u,traceName:p,warningsToggle:g,stackTracesToggle:m,referencesToggle:b,referenceItemToggle:y,createSpanLink:j,createFocusSpanLink:O,datasourceType:A,datasourceUid:P,traceFlameGraphs:G,setTraceFlameGraphs:Q,traceToProfilesOptions:_,setRedrawListView:te,timeRange:oe,app:de}=e,{isTagsOpen:le,isProcessOpen:fe,logs:ye,isWarningsOpen:Re,references:ae,isStackTracesOpen:we}=t,{operationName:Le,process:be,duration:Te,relativeStartTime:De,startTime:Ae,traceID:je,spanID:q,logs:Ce,tags:Ne,warnings:Me,references:xe,stackTraces:We}=i,{timeZone:pe}=e;let ke=[{key:"svc",label:(0,f.t)("explore.span-detail.overview-items.label.service","Service:"),value:be.serviceName},{key:"duration",label:(0,f.t)("explore.span-detail.overview-items.label.duration","Duration:"),value:Ze(Te)},{key:"start",label:(0,f.t)("explore.span-detail.overview-items.label.start-time","Start Time:"),value:Ze(De)+Ma(Ae,pe)},...i.childSpanCount>0?[{key:"child_count",label:(0,f.t)("explore.span-detail.overview-items.label.child-count","Child Count:"),value:i.childSpanCount}]:[]];const ve=(0,x.of)(ja);i.kind&&ke.push({key:Ye.Nd,label:(0,f.t)("explore.span-detail.label.kind","Kind:"),value:i.kind}),i.statusCode!==void 0&&ke.push({key:Ye.XQ,label:(0,f.t)("explore.span-detail.label.status","Status:"),value:Gr.s[i.statusCode].toLowerCase()}),i.statusMessage&&ke.push({key:Ye.x9,label:(0,f.t)("explore.span-detail.label.status-message","Status Message:"),value:i.statusMessage}),i.instrumentationLibraryName&&ke.push({key:Ye.mT,label:(0,f.t)("explore.span-detail.label.library-name","Library Name:"),value:i.instrumentationLibraryName}),i.instrumentationLibraryVersion&&ke.push({key:Ye.Zh,label:(0,f.t)("explore.span-detail.label.library-version","Library Version:"),value:i.instrumentationLibraryVersion}),i.traceState&&ke.push({key:Ye.gz,label:(0,f.t)("explore.span-detail.label.trace-state","Trace State:"),value:i.traceState});const It=Ia({span:i,createSpanLink:j,datasourceType:A,traceToProfilesOptions:_,timeRange:oe,app:de}),ot=O(je,q),_t=Ea(be,A,P);return(0,n.jsxs)("div",{"data-testid":"span-detail-component",children:[(0,n.jsxs)("div",{className:ve.header,children:[(0,n.jsx)("h2",{className:ve.operationName,title:Le,children:Le}),(0,n.jsx)("div",{className:ve.listWrapper,children:(0,n.jsx)(ia,{className:ve.list,divider:!0,items:ke})})]}),(0,n.jsx)("div",{className:ve.linkList,children:It}),(0,n.jsx)(Zr.c,{spacing:1}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(xt,{data:Ne,label:(0,f.t)("explore.span-detail.label-span-attributes","Span attributes"),isOpen:le,onToggle:()=>l(q)}),be.tags&&(0,n.jsx)(xt,{className:ve.AccordianKeyValuesItem,data:be.tags,label:(0,f.t)("explore.span-detail.label-resource-attributes","Resource attributes"),linksGetter:_t,isOpen:fe,onToggle:()=>a(q)})]}),Ce&&Ce.length>0&&(0,n.jsx)(Bs,{logs:Ce,isOpen:ye.isOpen,openedItems:ye.openedItems,onToggle:()=>r(q),onItemToggle:me=>s(q,me),timestamp:c}),Me&&Me.length>0&&(0,n.jsx)(Vs,{className:ve.AccordianWarnings,headerClassName:ve.AccordianWarningsHeader,label:(0,n.jsx)("span",{className:ve.AccordianWarningsLabel,children:(0,n.jsx)(f.x6,{i18nKey:"explore.span-detail.warnings",children:"Warnings"})}),data:Me,isOpen:Re,onToggle:()=>g(q)}),We?.length?(0,n.jsx)(Vs,{label:(0,f.t)("explore.span-detail.label-stack-trace","Stack trace"),data:We,isOpen:we,TextComponent:me=>{let lt;return me.data?.length>1?lt=me.data.map((ct,Pt)=>`StackTrace ${Pt+1}:
${ct}`).join(`
`):lt=me.data?.[0],(0,n.jsx)(Qr.f,{className:ve.Textarea,style:{cursor:"unset"},readOnly:!0,cols:10,rows:10,value:lt})},onToggle:()=>m(q)}):null,xe&&xe.length>0&&(xe.length>1||xe[0].refType!=="CHILD_OF")&&(0,n.jsx)(da,{data:xe,isOpen:ae.isOpen,openedItems:ae.openedItems,onToggle:()=>b(q),onItemToggle:me=>y(q,me),createFocusSpanLink:O}),i.tags.some(me=>me.key===mt)&&(0,n.jsx)(Ra,{span:i,timeZone:pe,traceFlameGraphs:G,setTraceFlameGraphs:Q,traceToProfilesOptions:_,setRedrawListView:te,traceDuration:u,traceName:p}),(0,n.jsxs)("small",{className:ve.debugInfo,children:[(0,n.jsx)("a",{...ot,onClick:me=>{ot.onClick&&me.button===0&&(!me.currentTarget.target||me.currentTarget.target==="_self")&&!(me.metaKey||me.altKey||me.ctrlKey||me.shiftKey)&&(me.preventDefault(),ot.onClick(me))},children:(0,n.jsx)(ee.I,{name:"link",className:W()(Je,ve.LinkIcon)})}),(0,n.jsx)("span",{className:ve.debugLabel,"data-label":"SpanID:"})," ",q]})]})]})}const Ma=(e,t)=>{const s=(0,he.LE)(e/1e3,{timeZone:t,defaultWithMS:!0}),r=s.split(" ");return` (${r[1]?r[1]:s})`},At=e=>({container:(0,o.css)({textOverflow:"ellipsis"}),header:(0,o.css)({label:"header",cursor:"pointer",overflow:"hidden",padding:"0.25em 0.1em",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{background:(0,T.R)(e,"#e8e8e8")}}),headerEmpty:(0,o.css)({label:"headerEmpty",background:"none",cursor:"initial"}),headerHighContrast:(0,o.css)({label:"headerHighContrast","&:hover":{background:(0,T.R)(e,"#ddd")}}),emptyIcon:(0,o.css)({label:"emptyIcon",color:(0,T.R)(e,"#aaa")}),summary:(0,o.css)({label:"summary",display:"inline",listStyle:"none",padding:0}),summaryItem:(0,o.css)({label:"summaryItem",display:"inline",paddingRight:"0.5rem",borderRight:`1px solid ${(0,T.R)(e,"#ddd")}`,"&:last-child":{paddingRight:0,borderRight:"none"}}),summaryLabel:(0,o.css)({label:"summaryLabel",color:(0,T.R)(e,"#777")}),summaryDelim:(0,o.css)({label:"summaryDelim",color:(0,T.R)(e,"#bbb"),padding:"0 0.2em"})});function Oa({data:e=null}){const t=(0,x.of)(At);return!Array.isArray(e)||!e.length?null:(0,n.jsx)("ul",{className:t.summary,children:e.map((s,r)=>(0,n.jsxs)("li",{className:t.summaryItem,children:[(0,n.jsx)("span",{className:t.summaryLabel,children:s.key}),(0,n.jsx)("span",{className:t.summaryDelim,children:"="}),String(s.value)]},`${s.key}-${r}`))})}function xt({className:e=null,data:t,logName:s,highContrast:r=!1,interactive:a=!0,isOpen:i,label:l,linksGetter:c,onToggle:u=null}){const p=(!Array.isArray(t)||!t.length)&&!s,g=(0,x.of)(At),m=W()(Je,{[g.emptyIcon]:p});let b=null,y=null;const j=s?[{key:"event name",value:s},...t]:t;a&&(b=i?(0,n.jsx)(ee.I,{name:"angle-down",className:m}):(0,n.jsx)(ee.I,{name:"angle-right",className:m}),y={"aria-checked":i,onClick:p?null:u,role:"switch"});const O=t.length>0&&!i;return(0,n.jsxs)("div",{className:W()(e,g.container),children:[(0,n.jsxs)("div",{className:W()(g.header,{[g.headerEmpty]:p,[g.headerHighContrast]:r&&!p}),...y,"data-testid":"AccordianKeyValues--header",children:[b,(0,n.jsxs)("strong",{"data-test":zr,children:[l,O&&":"]}),O&&(0,n.jsx)("span",{className:(0,o.css)({marginLeft:"0.7em"}),children:(0,n.jsx)(Oa,{data:t})})]}),i&&(0,n.jsx)(Ur.Ay,{data:j,linksGetter:c})]})}const Aa=e=>({AccordianLogs:(0,o.css)({label:"AccordianLogs",border:`1px solid ${(0,T.R)(e,"#d8d8d8")}`,position:"relative",marginBottom:"0.25rem"}),AccordianLogsHeader:(0,o.css)({label:"AccordianLogsHeader",background:(0,T.R)(e,"#e4e4e4"),color:"inherit",display:"block",padding:"0.25rem 0.5rem","&:hover":{background:(0,T.R)(e,"#dadada")}}),AccordianLogsContent:(0,o.css)({label:"AccordianLogsContent",background:(0,T.R)(e,"#f0f0f0"),borderTop:`1px solid ${(0,T.R)(e,"#d8d8d8")}`,padding:"0.5rem 0.5rem 0.25rem 0.5rem"}),AccordianLogsFooter:(0,o.css)({label:"AccordianLogsFooter",color:(0,T.R)(e,"#999")}),AccordianKeyValuesItem:(0,o.css)({marginBottom:e.spacing(.5)}),parenthesis:(0,o.css)({color:`${(0,T.R)(e,"#777")}`})});function Bs({interactive:e=!0,isOpen:t,logs:s,openedItems:r,onItemToggle:a,onToggle:i,timestamp:l}){let c=null,u="span",p=null;e&&(c=t?(0,n.jsx)(ee.I,{name:"angle-down",className:Je}):(0,n.jsx)(ee.I,{name:"angle-right",className:"u-align-icon"}),u="a",p={"aria-checked":t,onClick:i,role:"switch"});const g=(0,x.of)(Aa);return(0,n.jsxs)("div",{className:g.AccordianLogs,children:[(0,n.jsxs)(u,{className:g.AccordianLogsHeader,...p,children:[c," ",(0,n.jsx)("strong",{children:(0,n.jsx)(f.x6,{i18nKey:"explore.accordian-logs.events",children:"Events"})})," ","(",s.length,")"]}),t&&(0,n.jsxs)("div",{className:g.AccordianLogsContent,children:[(0,Se.sortBy)(s,"timestamp").map((m,b)=>{const y=Ze(m.timestamp-l),j=m.name&&m.name.length>20,O=m.name&&j?m.name.slice(0,20)+"...":m.name,A=O?(0,n.jsxs)("span",{children:[y," ",(0,n.jsxs)("span",{children:["(",O,")"]})]}):y;return(0,n.jsx)(xt,{className:b<s.length-1?g.AccordianKeyValuesItem:null,data:m.fields||[],logName:j?m.name:void 0,highContrast:!0,interactive:e,isOpen:r?r.has(m):!1,label:A,onToggle:e&&a?()=>a(m):null},`${m.timestamp}-${b}`)}),(0,n.jsx)("small",{className:g.AccordianLogsFooter,children:(0,n.jsx)(f.x6,{i18nKey:"explore.accordian-logs.footer",children:"Event timestamps are relative to the start time of the full trace."})})]})]})}const Fa=e=>({wrapper:(0,o.css)({label:"wrapper",bottom:0,left:0,position:"absolute",right:0,top:0,overflow:"hidden",zIndex:0}),bar:(0,o.css)({label:"bar",borderRadius:e.shape.radius.default,minWidth:"2px",position:"absolute",height:"36%",top:"32%"}),rpc:(0,o.css)({label:"rpc",position:"absolute",top:"35%",bottom:"35%",zIndex:1}),label:(0,o.css)({label:"label",color:"#aaa",fontSize:"12px",fontFamily:"'Helvetica Neue', Helvetica, Arial, sans - serif",lineHeight:"1em",whiteSpace:"nowrap",padding:"0 0.5em",position:"absolute"}),logMarker:(0,o.css)({label:"logMarker",backgroundColor:(0,T.R)(e,"#2c3235"),cursor:"pointer",height:"60%",minWidth:"1px",position:"absolute",top:"20%","&:hover":{backgroundColor:(0,T.R)(e,"#464c54")},"&::before, &::after":{content:"''",position:"absolute",top:0,bottom:0,right:0,border:"1px solid transparent"},"&::after":{left:0}}),criticalPath:(0,o.css)({position:"absolute",top:"45%",height:"11%",zIndex:2,overflow:"hidden",background:(0,T.R)(e,"#f1f1f1"),borderLeft:`1px solid ${(0,T.R)(e,"#2c3235")}`,borderRight:`1px solid ${(0,T.R)(e,"#2c3235")}`})});function it(e){return`${(e*100).toFixed(1)}%`}function Hs(e){return`${e*100}%`}function Va({criticalPath:e,viewEnd:t,viewStart:s,getViewedBounds:r,color:a,shortLabel:i,longLabel:l,onClick:c,rpc:u,traceStartTime:p,span:g,className:m,labelClassName:b}){const[y,j]=(0,h.useState)(i),O=()=>j(i),A=()=>j(l),P=(0,Se.groupBy)(g.logs,Q=>{const _=r(Q.timestamp,Q.timestamp).start;return it(Math.round(_*500)/500)}),G=(0,x.of)(Fa);return(0,n.jsxs)("div",{className:W()(G.wrapper,m),onBlur:O,onClick:c,onFocus:A,onMouseOut:O,onMouseOver:A,"aria-hidden":!0,"data-testid":Hr.Tp.components.TraceViewer.spanBar,children:[(0,n.jsx)("div",{"aria-label":y,className:W()(G.bar),style:{background:a,left:it(s),width:it(t-s)},children:(0,n.jsx)("div",{className:W()(G.label,b),"data-testid":"SpanBar--label",children:y})}),(0,n.jsx)("div",{children:Object.keys(P).map(Q=>(0,n.jsx)(Kr,{content:(0,n.jsx)(Bs,{interactive:!1,isOpen:!0,logs:P[Q],timestamp:p}),children:(0,n.jsx)("div",{"data-testid":"SpanBar--logMarker",className:W()(G.logMarker),style:{left:Q}})},Q))}),u&&(0,n.jsx)("div",{className:W()(G.rpc),style:{background:u.color,left:it(u.viewStart),width:it(u.viewEnd-u.viewStart)}}),e?.map((Q,_)=>{const te=r(Q.section_start,Q.section_end),oe=te.start,de=te.end,le=`${Q.spanId}-${_}`;return(0,n.jsx)(re.m,{placement:"top",content:(0,n.jsx)("div",{children:(0,n.jsxs)(f.x6,{i18nKey:"explore.span-bar.tooltip-critical-path",children:["A segment on the ",(0,n.jsx)("em",{children:"critical path"})," of the overall trace / request / workflow."]})}),children:(0,n.jsx)("div",{"data-testid":"SpanBar--criticalPath",className:G.criticalPath,style:{left:Hs(oe),width:Hs(de-oe)}})},le)})]})}const _a=h.memo(Va);var Pa=d(94535),Ba=d(97375);const Ha=(e,t,s,r)=>(e.sort(function(a,i){return(a.title||"link").toLowerCase().localeCompare((i.title||"link").toLowerCase())}),e.map((a,i)=>(0,n.jsx)(Pa.D,{label:a.title||"Link",onClick:a.onClick?l=>{(0,Ve.rR)("grafana_traces_trace_view_span_link_clicked",{datasourceType:r,grafana_version:_e.$.buildInfo.version,type:a.type,location:"menu"}),l?.preventDefault(),a.onClick(l),s()}:void 0,url:a.href,target:a.target,className:t.menuItem},i))),$a=({links:e,datasourceType:t,color:s})=>{const r=(0,x.of)(()=>Wa(s)),[a,i]=(0,h.useState)(!1),[l,c]=(0,h.useState)({x:0,y:0}),u=()=>i(!1);return(0,n.jsxs)("div",{"data-testid":"SpanLinksMenu",className:r.wrapper,children:[(0,n.jsx)("button",{onClick:p=>{i(!0),c({x:p.clientX,y:p.clientY})},className:r.button,children:(0,n.jsx)(ee.I,{name:"link",className:r.icon})}),a?(0,n.jsx)(Ba.t,{onClose:()=>i(!1),renderMenuItems:()=>Ha(e,r,u,t),focusOnOpen:!1,x:l.x,y:l.y}):null]})},Wa=e=>({wrapper:(0,o.css)({border:"none",background:`${e}10`,borderBottom:`1px solid ${e}CF`,paddingRight:"4px"}),button:(0,o.css)({background:"transparent",border:"none",padding:0}),icon:(0,o.css)({background:"transparent",border:"none",padding:0}),menuItem:(0,o.css)({maxWidth:"60ch",overflow:"hidden"})});function $s(e){return(0,Se.get)((0,Se.find)(e.references,({span:t,refType:s})=>t&&t.spanID&&(s==="CHILD_OF"||s==="FOLLOWS_FROM")),"span")}function Ka(e){const t=[];if(!e)return t;let s=$s(e);for(;s;)t.push(s.spanID),s=$s(s);return t}const za=(0,ze.N)(e=>({SpanTreeOffset:(0,o.css)({label:"SpanTreeOffset",color:(0,T.R)(e,"#000"),position:"relative"}),SpanTreeOffsetParent:(0,o.css)({label:"SpanTreeOffsetParent","&:hover":{cursor:"pointer"}}),indentGuide:(0,o.css)({label:"indentGuide",paddingRight:"1rem",height:"100%",display:"inline-flex",[e.transitions.handleMotion("no-preference")]:{transition:"padding 300ms ease-out"},"&::before":{content:'""',paddingLeft:"1px",backgroundColor:(0,T.R)(e,"lightgrey")}}),indentGuideActive:(0,o.css)({label:"indentGuideActive","&::before":{backgroundColor:(0,T.R)(e,"#777")}}),indentGuideThin:(0,o.css)({paddingRight:"0.3rem"}),iconWrapper:(0,o.css)({label:"iconWrapper",position:"absolute",right:0})}));class Ua extends h.PureComponent{constructor(t){super(t),this.handleMouseLeave=(s,r)=>{(!(s.relatedTarget instanceof HTMLSpanElement)||(0,Se.get)(s,"relatedTarget.dataset.ancestorId")!==r)&&this.props.removeHoverIndentGuideId(r)},this.handleMouseEnter=(s,r)=>{(!(s.relatedTarget instanceof HTMLSpanElement)||(0,Se.get)(s,"relatedTarget.dataset.ancestorId")!==r)&&this.props.addHoverIndentGuideId(r)},this.ancestorIds=Ka(t.span),this.ancestorIds.push("root"),this.ancestorIds.reverse()}static{this.displayName="UnthemedSpanTreeOffset"}static{this.defaultProps={childrenVisible:!1,showChildrenIcon:!0}}render(){const{childrenVisible:t,onClick:s,showChildrenIcon:r,span:a,theme:i,visibleSpanIds:l}=this.props,{hasChildren:c,spanID:u}=a,p=c?{onClick:s,role:"switch","aria-checked":t}:null,g=r&&c&&(t?(0,n.jsx)(ee.I,{name:"angle-down","data-testid":"icon-arrow-down",size:"sm"}):(0,n.jsx)(ee.I,{name:"angle-right","data-testid":"icon-arrow-right",size:"sm"})),m=za(i);return(0,n.jsxs)("span",{className:W()(m.SpanTreeOffset,{[m.SpanTreeOffsetParent]:c}),...p,children:[this.ancestorIds.map((b,y)=>(0,n.jsx)("span",{className:W()(m.indentGuide,{[m.indentGuideActive]:this.props.hoverIndentGuideIds.has(b),[m.indentGuideThin]:y!==this.ancestorIds.length-1&&b!=="root"&&!l.includes(b)}),"data-ancestor-id":b,"data-testid":"SpanTreeOffset--indentGuide",onMouseEnter:j=>this.handleMouseEnter(j,b),onMouseLeave:j=>this.handleMouseLeave(j,b)},b)),g&&(0,n.jsx)("span",{className:m.iconWrapper,onMouseEnter:b=>this.handleMouseEnter(b,u),onMouseLeave:b=>this.handleMouseLeave(b,u),"data-testid":"icon-wrapper",children:g})]})}}const Ws=(0,x.cV)(Ua),vt="spanBar",yt="spanBarLabel",qe="nameWrapper",Ks="nameWrapperMatchingFilter",Qe="jaegerView",zs="nameColumn",Ga=(0,ze.N)((e,t)=>{const s={flash:(0,o.keyframes)`
    from {
      background-color: ${(0,T.R)(e,"#68b9ff")};
    }
    to {
      background-color: 'default';
    }
  `},r=t?"":(0,T.R)(e,"#fffce4");return{nameWrapper:(0,o.css)({label:"nameWrapper",lineHeight:"27px",overflow:"hidden",display:"flex"}),nameWrapperMatchingFilter:(0,o.css)({label:"nameWrapperMatchingFilter",backgroundColor:r}),nameColumn:(0,o.css)({label:"nameColumn",position:"relative",whiteSpace:"nowrap",zIndex:1,"&:hover":{zIndex:1}}),endpointName:(0,o.css)({label:"endpointName",color:(0,T.R)(e,"#484848"),fontSize:"0.9em"}),view:(0,o.css)({label:"view",position:"relative"}),viewExpanded:(0,o.css)({label:"viewExpanded",background:(0,T.R)(e,"#f8f8f8"),outline:`1px solid ${(0,T.R)(e,"#ddd")}`}),viewExpandedAndMatchingFilter:(0,o.css)({label:"viewExpandedAndMatchingFilter",background:(0,T.R)(e,"#fff3d7"),outline:`1px solid ${(0,T.R)(e,"#ddd")}`}),row:(0,o.css)({label:"row",fontSize:"0.9em",[`&:hover .${vt}`]:{opacity:1},[`&:hover .${yt}`]:{color:(0,T.R)(e,"#000")},[`&:hover .${qe}`]:{background:`linear-gradient(
          90deg,
          ${(0,T.R)(e,"#fafafa")},
          ${(0,T.R)(e,"#f8f8f8")} 75%,
          ${(0,T.R)(e,"#eee")}
        )`},[`&:hover .${Qe}`]:{backgroundColor:(0,T.R)(e,"#f5f5f5"),outline:`1px solid ${(0,T.R)(e,"#ddd")}`}}),rowClippingLeft:(0,o.css)({label:"rowClippingLeft",[`& .${zs}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to right,
          ${(0,T.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,T.R)(e,"rgba(32, 32, 32, 0)")}
        )`,left:"100%",zIndex:-1}}),rowClippingRight:(0,o.css)({label:"rowClippingRight",[`& .${Qe}::before`]:{content:'" "',height:"100%",position:"absolute",width:"6px",backgroundImage:`linear-gradient(
          to left,
          ${(0,T.R)(e,"rgba(25, 25, 25, 0.25)")},
          ${(0,T.R)(e,"rgba(25, 25, 25, 0.25)")}
        )`,right:"0%",zIndex:1}}),rowExpanded:(0,o.css)({label:"rowExpanded",[`& .${vt}`]:{opacity:1},[`& .${yt}`]:{color:(0,T.R)(e,"#000")},[`& .${qe}, &:hover .${qe}`]:{background:(0,T.R)(e,"#f0f0f0"),boxShadow:`0 1px 0 ${(0,T.R)(e,"#ddd")}`},[`& .${Ks}`]:{background:(0,T.R)(e,"#fff3d7")},[`&:hover .${Qe}`]:{background:(0,T.R)(e,"#eee")}}),rowMatchingFilter:(0,o.css)({label:"rowMatchingFilter",[`&:hover .${qe}`]:{background:`linear-gradient(
          90deg,
          ${(0,T.R)(e,"#fffbde")},
          ${(0,T.R)(e,"#fffbde")} 75%,
          ${(0,T.R)(e,"#f7f1c6")}
        )`},[`&:hover .${Qe}`]:{backgroundColor:(0,T.R)(e,"#f7f1c6"),outline:`1px solid ${(0,T.R)(e,"#ddd")}`}}),rowFocused:(0,o.css)({label:"rowFocused",backgroundColor:(0,T.R)(e,"#cbe7ff"),[e.transitions.handleMotion("no-preference","reduce")]:{animation:`${s.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${qe}, .${Qe}, .${Ks}`]:{backgroundColor:(0,T.R)(e,"#cbe7ff"),animation:`${s.flash} 1s cubic-bezier(0.12, 0, 0.39, 0)`},[`& .${vt}`]:{opacity:1},[`& .${yt}`]:{color:(0,T.R)(e,"#000")},"&:hover .${nameWrapperClassName}, :hover .${viewClassName}":{background:(0,T.R)(e,"#d5ebff"),boxShadow:`0 1px 0 ${(0,T.R)(e,"#ddd")}`}}),rowExpandedAndMatchingFilter:(0,o.css)({label:"rowExpandedAndMatchingFilter",[`&:hover .${Qe}`]:{background:(0,T.R)(e,"#ffeccf")}}),name:(0,o.css)({label:"name",color:(0,T.R)(e,"#000"),cursor:"pointer",flex:"1 1 auto",outline:"none",overflowY:"hidden",overflowX:"auto",paddingLeft:"4px",paddingRight:"0.25em",position:"relative","-ms-overflow-style":"none",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},"&:focus":{textDecoration:"none"},"&:hover > span":{color:(0,T.R)(e,"#000")},textAlign:"left",background:"transparent",border:"none",borderBottomWidth:"1px",borderBottomStyle:"solid"}),nameDetailExpanded:(0,o.css)({label:"nameDetailExpanded","&::before":{bottom:0}}),svcName:(0,o.css)({label:"svcName",fontSize:"0.9em",fontWeight:"bold",marginRight:"0.25rem"}),svcNameChildrenCollapsed:(0,o.css)({label:"svcNameChildrenCollapsed",fontWeight:"bold",fontStyle:"italic"}),errorIcon:(0,o.css)({label:"errorIcon",borderRadius:"6.5px",color:(0,T.R)(e,"#fff"),fontSize:"0.85em",marginRight:"0.25rem",padding:"1px"}),rpcColorMarker:(0,o.css)({label:"rpcColorMarker",borderRadius:"6.5px",display:"inline-block",fontSize:"0.85em",height:"1em",marginRight:"0.25rem",padding:"1px",width:"1em",verticalAlign:"middle"}),labelRight:(0,o.css)({label:"labelRight",left:"100%"}),labelLeft:(0,o.css)({label:"labelLeft",right:"100%"})}});class Za extends h.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)},this._childrenToggle=()=>{this.props.onChildrenToggled(this.props.span.spanID)},this.getSpanBarLabel=(t,s,r)=>{const a=s?.type??"";if(a===Ds)return"";if(a===""||a===Cs)return`(${r})`;if(a===Nt){const i=s?.tag?.trim()??"";if(i!==""&&t.tags){const l=t.tags?.find(u=>u.key===i);if(l)return`(${l.value})`;const c=t.process?.tags?.find(u=>u.key===i);if(c)return`(${c.value})`}}return""}}static{this.displayName="UnthemedSpanBarRow"}static{this.defaultProps={className:"",rpc:null}}render(){const{className:t,color:s,spanBarOptions:r,columnDivision:a,isChildrenExpanded:i,isDetailExpanded:l,isMatchingFilter:c,showSpanFilterMatchesOnly:u,isFocused:p,numTicks:g,rpc:m,noInstrumentedServer:b,showErrorIcon:y,getViewedBounds:j,traceStartTime:O,span:A,hoverIndentGuideIds:P,addHoverIndentGuideId:G,removeHoverIndentGuideId:Q,clippingLeft:_,clippingRight:te,theme:oe,createSpanLink:de,datasourceType:le,showServiceName:fe,visibleSpanIds:ye,criticalPath:Re}=this.props,{duration:ae,hasChildren:we,operationName:Le,process:{serviceName:be}}=A,Te=Ze(ae),De=j(A.startTime,A.startTime+A.duration),Ae=De.start,je=De.end,q=Ga(oe,u),Ce=`${be}::${Le}`;let Ne,Me;return Ae>1-je?(Ne=`${Ce} | ${Te}`,Me=q.labelLeft):(Ne=`${Te} | ${Ce}`,Me=q.labelRight),(0,n.jsxs)(Pe,{className:W()(q.row,{[q.rowExpanded]:l,[q.rowMatchingFilter]:c,[q.rowExpandedAndMatchingFilter]:c&&l,[q.rowFocused]:p,[q.rowClippingLeft]:_,[q.rowClippingRight]:te},t),children:[(0,n.jsx)(Pe.Cell,{className:W()(q.nameColumn,zs),width:a,children:(0,n.jsxs)("div",{className:W()(q.nameWrapper,qe,{[q.nameWrapperMatchingFilter]:c,nameWrapperMatchingFilter:c}),children:[(0,n.jsx)(Ws,{onClick:we?this._childrenToggle:void 0,childrenVisible:i,span:A,hoverIndentGuideIds:P,addHoverIndentGuideId:G,removeHoverIndentGuideId:Q,visibleSpanIds:ye}),(0,n.jsxs)("button",{type:"button",className:W()(q.name,{[q.nameDetailExpanded]:l}),"aria-checked":l,title:Ce,onClick:this._detailToggle,role:"switch",style:{background:`${s}10`,borderBottomColor:`${s}CF`},tabIndex:0,children:[y&&(0,n.jsx)(ee.I,{name:"exclamation-circle",style:{backgroundColor:A.errorIconColor?(0,T.R)(oe,A.errorIconColor):(0,T.R)(oe,"#db2828")},className:q.errorIcon}),fe&&(0,n.jsx)("span",{className:W()(q.svcName,{[q.svcNameChildrenCollapsed]:we&&!i}),children:`${be} `}),m&&(0,n.jsxs)("span",{children:[(0,n.jsx)(ee.I,{name:"arrow-right"})," ",(0,n.jsx)("i",{className:q.rpcColorMarker,style:{background:m.color}}),m.serviceName]}),b&&(0,n.jsxs)("span",{children:[(0,n.jsx)(ee.I,{name:"arrow-right"})," ",(0,n.jsx)("i",{className:q.rpcColorMarker,style:{background:b.color}}),b.serviceName]}),(0,n.jsx)("span",{className:q.endpointName,children:m?m.operationName:Le}),(0,n.jsxs)("span",{className:q.endpointName,children:[" ",this.getSpanBarLabel(A,r,Te)]})]}),de&&(()=>{const xe=de(A),We=xe?.length||0;return xe&&We===1?xe[0]?(0,n.jsx)("a",{href:xe[0].href,target:"_blank",style:{background:`${s}10`,borderBottom:`1px solid ${s}CF`,paddingRight:"4px"},rel:"noopener noreferrer",onClick:xe[0].onClick?pe=>{!(pe.ctrlKey||pe.metaKey||pe.shiftKey)&&xe[0].onClick&&(pe.preventDefault(),xe[0].onClick(pe))}:void 0,children:xe[0].content}):null:xe&&We>1?(0,n.jsx)($a,{links:xe,datasourceType:le,color:s}):null})()]})}),(0,n.jsxs)(Pe.Cell,{className:W()(q.view,Qe,{[q.viewExpanded]:l,[q.viewExpandedAndMatchingFilter]:c&&l}),"data-testid":"span-view",style:{cursor:"pointer"},width:1-a,onClick:this._detailToggle,children:[(0,n.jsx)(bs,{numTicks:g}),(0,n.jsx)(_a,{criticalPath:Re,rpc:m,viewStart:Ae,viewEnd:je,getViewedBounds:j,color:s,shortLabel:Te,longLabel:Ne,traceStartTime:O,span:A,labelClassName:`${yt} ${Me}`,className:vt})]})]})}}const Qa=(0,x.cV)(Za),Xa=(0,ze.N)(e=>({expandedAccent:(0,o.css)({cursor:"pointer",height:"100%",overflow:"hidden",position:"absolute",width:"100%","&::before":{borderLeft:"1px solid",pointerEvents:"none",width:"1000px"},"&::after":{borderRight:"1000px solid",borderColor:"inherit",cursor:"pointer",opacity:.2},"&::before, &::after":{borderColor:"inherit",content:'" "',position:"absolute",height:"100%"},"&:hover::after":{opacity:.35}}),infoWrapper:(0,o.css)({label:"infoWrapper",border:`1px solid ${(0,T.R)(e,"#d3d3d3")}`,borderTop:"3px solid",padding:"0.75rem"})}));class Ya extends h.PureComponent{constructor(){super(...arguments),this._detailToggle=()=>{this.props.onDetailToggled(this.props.span.spanID)}}render(){const{color:t,columnDivision:s,detailState:r,logItemToggle:a,logsToggle:i,processToggle:l,referenceItemToggle:c,referencesToggle:u,warningsToggle:p,stackTracesToggle:g,span:m,traceToProfilesOptions:b,timeZone:y,tagsToggle:j,traceStartTime:O,traceDuration:A,traceName:P,hoverIndentGuideIds:G,addHoverIndentGuideId:Q,removeHoverIndentGuideId:_,theme:te,createSpanLink:oe,focusedSpanId:de,createFocusSpanLink:le,datasourceType:fe,datasourceUid:ye,visibleSpanIds:Re,traceFlameGraphs:ae,setTraceFlameGraphs:we,setRedrawListView:Le,timeRange:be,app:Te}=this.props,De=Xa(te);return(0,n.jsxs)(Pe,{children:[(0,n.jsxs)(Pe.Cell,{width:s,style:{overflow:"hidden"},children:[(0,n.jsx)(Ws,{span:m,showChildrenIcon:!1,hoverIndentGuideIds:G,addHoverIndentGuideId:Q,removeHoverIndentGuideId:_,visibleSpanIds:Re}),(0,n.jsx)(He.$n,{fill:"text",onClick:this._detailToggle,className:W()(De.expandedAccent,(0,He.my)(te)),style:{borderColor:t},"data-testid":"detail-row-expanded-accent"})]}),(0,n.jsx)(Pe.Cell,{width:1-s,children:(0,n.jsx)("div",{className:De.infoWrapper,style:{borderTopColor:t},children:(0,n.jsx)(Na,{detailState:r,logItemToggle:a,logsToggle:i,processToggle:l,referenceItemToggle:c,referencesToggle:u,warningsToggle:p,stackTracesToggle:g,span:m,traceToProfilesOptions:b,timeZone:y,tagsToggle:j,traceStartTime:O,traceDuration:A,traceName:P,createSpanLink:oe,focusedSpanId:de,createFocusSpanLink:le,datasourceType:fe,datasourceUid:ye,traceFlameGraphs:ae,setTraceFlameGraphs:we,setRedrawListView:Le,timeRange:be,app:Te})})})]})}}const Ja=(0,x.cV)(Ya),Ft=(0,ze.N)(()=>({rowsWrapper:(0,o.css)({width:"100%"}),row:(0,o.css)({width:"100%"}),scrollToTopButton:(0,o.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"40px",height:"40px",position:"absolute",bottom:"30px",right:"30px",zIndex:1})})),Vt={bar:28,detail:161,detailWithLogs:197},qa=5,bt=33;function ei(e,t,s,r,a,i,l){if(!e)return[];a&&r&&(e=e.filter(p=>r.has(p.spanID))),i&&l&&(e=e.filter(p=>l.find(g=>g.spanId===p.spanID)));let c=null;const u=[];for(let p=0;p<e.length;p++){const g=e[p],{spanID:m,depth:b}=g;let y=!1;c!=null&&(b>=c?y=!0:c=null),!y&&(t.has(m)&&(c=b+1),u.push({span:g,isDetail:!1,spanIndex:p}),s.has(m)&&u.push({span:g,isDetail:!0,spanIndex:p}))}return u}function ti(e){const[t,s]=e;return{left:t>0,right:s<1}}function si(e,t,s,r,a,i,l){return e?ei(e.spans,t,s,r,a,i,l):[]}function ni(e){const t=new Map;return e&&e.spans.forEach(s=>{s.childSpanIds.length&&t.set(s.spanID,s.childSpanIds)}),t}const ri=(0,N.default)(si),ai=(0,N.default)(pr,Se.isEqual),ii=(0,N.default)(ti,Se.isEqual),oi=(0,N.default)(ni);class li extends h.Component{constructor(){super(...arguments),this.hasScrolledToSpan=!1,this.getViewRange=()=>this.props.currentViewRangeTime,this.getSearchedSpanIDs=()=>this.props.findMatchesIDs,this.getCollapsedChildren=()=>this.props.childrenHiddenIDs,this.mapRowIndexToSpanIndex=t=>this.getRowStates()[t].spanIndex,this.mapSpanIndexToRowIndex=t=>{const s=this.getRowStates().length;for(let r=0;r<s;r++){const{spanIndex:a}=this.getRowStates()[r];if(a===t)return r}throw new Error(`unable to find row for span index: ${t}`)},this.setListView=t=>{this.listView=t},this.getKeyFromIndex=t=>{const{isDetail:s,span:r}=this.getRowStates()[t];return`${r.traceID}--${r.spanID}--${s?"detail":"bar"}`},this.getIndexFromKey=t=>{const s=t.split("--"),r=s[0],a=s[1],i=s[2]==="detail",l=this.getRowStates().length;for(let c=0;c<l;c++){const{span:u,isDetail:p}=this.getRowStates()[c];if(u.spanID===a&&u.traceID===r&&p===i)return c}return-1},this.getRowHeight=t=>{const{span:s,isDetail:r}=this.getRowStates()[t];return r?Array.isArray(s.logs)&&s.logs.length?Vt.detailWithLogs:Vt.detail:Vt.bar},this.renderRow=(t,s,r,a)=>{const{isDetail:i,span:l,spanIndex:c}=this.getRowStates()[r],u=Math.max((this.listView?.getTopVisibleIndex()||0)-bt,0),p=(this.listView?.getBottomVisibleIndex()||0)+bt,g=this.getVisibleSpanIds(u,p);return i?this.renderSpanDetailRow(l,t,s,a,g):this.renderSpanBarRow(l,c,t,s,a,g)},this.scrollToSpan=(t,s)=>{if(s==null)return;const r=this.getRowStates().findIndex(a=>a.span.spanID===s);r>=0&&this.listView?.scrollToIndex(r,t)},this.scrollToTop=()=>{const{topOfViewRef:t,datasourceType:s,trace:r}=this.props;t?.current?.scrollIntoView({behavior:"smooth"}),(0,Ve.rR)("grafana_traces_trace_view_scroll_to_top_clicked",{datasourceType:s,grafana_version:_e.$.buildInfo.version,numServices:r.services.length,numSpans:r.spans.length})},this.getVisibleSpanIds=(0,N.default)((t,s)=>{const r=[];for(let a=t;a<s;a++){const i=this.getRowStates()[a];i?.span&&r.push(i.span.spanID)}return r})}componentDidMount(){this.scrollToSpan(this.props.headerHeight,this.props.focusedSpanId)}shouldComponentUpdate(t){let s;for(s in t)if(t[s]!==this.props[s])return!0;return!1}componentDidUpdate(t){const{headerHeight:s,focusedSpanId:r,focusedSpanIdForSearch:a}=this.props;this.hasScrolledToSpan||(this.scrollToSpan(s,r),this.hasScrolledToSpan=!0),r!==t.focusedSpanId&&this.scrollToSpan(s,r),a!==t.focusedSpanIdForSearch&&this.scrollToSpan(s,a)}getRowStates(){const{childrenHiddenIDs:t,detailStates:s,trace:r,findMatchesIDs:a,showSpanFilterMatchesOnly:i,showCriticalPathSpansOnly:l,criticalPath:c}=this.props;return ri(r,t,s,a,i,l,c)}getClipping(){const{currentViewRangeTime:t}=this.props;return ii(t)}getViewedBounds(){const{currentViewRangeTime:t,trace:s}=this.props,[r,a]=t;return ai({min:s.startTime,max:s.endTime,viewStart:r,viewEnd:a})}getChildSpansMap(){return oi(this.props.trace)}getAccessors(){const t=this.listView;if(!t)throw new Error("ListView unavailable");return{getViewRange:this.getViewRange,getSearchedSpanIDs:this.getSearchedSpanIDs,getCollapsedChildren:this.getCollapsedChildren,getViewHeight:t.getViewHeight,getBottomRowIndexVisible:t.getBottomVisibleIndex,getTopRowIndexVisible:t.getTopVisibleIndex,getRowPosition:t.getRowPosition,mapRowIndexToSpanIndex:this.mapRowIndexToSpanIndex,mapSpanIndexToRowIndex:this.mapSpanIndexToRowIndex}}renderSpanBarRow(t,s,r,a,i,l){const{spanID:c,childSpanIds:u}=t,{serviceName:p}=t.process,{childrenHiddenIDs:g,childrenToggle:m,detailStates:b,detailToggle:y,findMatchesIDs:j,spanNameColumnWidth:O,trace:A,spanBarOptions:P,hoverIndentGuideIds:G,addHoverIndentGuideId:Q,removeHoverIndentGuideId:_,createSpanLink:te,focusedSpanId:oe,focusedSpanIdForSearch:de,showSpanFilterMatchesOnly:le,theme:fe,datasourceType:ye,criticalPath:Re}=this.props;if(!A)return null;const ae=pt(p,fe),we=g.has(c),Le=b.has(c),be=j?j.has(c):!1,Te=c===oe||c===de,De=ys(t)||we&&Sr(A.spans,s);let Ae=null;if(we){const pe=wr(A.spans.slice(s));if(pe){const ke=this.getViewedBounds()(pe.startTime,pe.startTime+pe.duration);Ae={color:pt(pe.process.serviceName,fe),operationName:pe.operationName,serviceName:pe.process.serviceName,viewEnd:ke.end,viewStart:ke.start}}}const je=t.tags.find(pe=>pe.key===Fr);let q=null;!t.hasChildren&&je&&Tr(t)&&(q={serviceName:je.value,color:pt(je.value,fe)});const Ce=s>0?A.spans[s-1]:null,Ne=[c,...u],Me=pe=>{pe.forEach(ke=>{const ve=this.getChildSpansMap().get(ke);ve?.length&&(Ne.push(...ve),Me(ve))})};Me(u);const xe=Re?.filter(pe=>we?Ne.includes(pe.spanId):pe.spanId===c),We=Ft();return(0,n.jsx)("div",{className:We.row,style:a,...i,children:(0,n.jsx)(Qa,{clippingLeft:this.getClipping().left,clippingRight:this.getClipping().right,color:ae,spanBarOptions:P,columnDivision:O,isChildrenExpanded:!we,isDetailExpanded:Le,isMatchingFilter:be,isFocused:Te,showSpanFilterMatchesOnly:le,numTicks:qa,onDetailToggled:y,onChildrenToggled:m,rpc:Ae,noInstrumentedServer:q,showErrorIcon:De,getViewedBounds:this.getViewedBounds(),traceStartTime:A.startTime,span:t,hoverIndentGuideIds:G,addHoverIndentGuideId:Q,removeHoverIndentGuideId:_,createSpanLink:te,datasourceType:ye,showServiceName:Ce===null||Ce.process.serviceName!==t.process.serviceName,visibleSpanIds:l,criticalPath:xe})},r)}renderSpanDetailRow(t,s,r,a,i){const{spanID:l}=t,{serviceName:c}=t.process,{detailLogItemToggle:u,detailLogsToggle:p,detailProcessToggle:g,detailReferencesToggle:m,detailReferenceItemToggle:b,detailWarningsToggle:y,detailStackTracesToggle:j,detailStates:O,detailTagsToggle:A,detailToggle:P,spanNameColumnWidth:G,trace:Q,traceToProfilesOptions:_,timeZone:te,hoverIndentGuideIds:oe,addHoverIndentGuideId:de,removeHoverIndentGuideId:le,createSpanLink:fe,focusedSpanId:ye,createFocusSpanLink:Re,theme:ae,datasourceType:we,datasourceUid:Le,traceFlameGraphs:be,setTraceFlameGraphs:Te,setRedrawListView:De,timeRange:Ae,app:je}=this.props,q=O.get(l);if(!Q||!q)return null;const Ce=pt(c,ae),Ne=Ft();return(0,n.jsx)("div",{className:(0,o.cx)(Ne.row,"span-detail-row"),style:{...r,zIndex:1},...a,children:(0,n.jsx)(Ja,{color:Ce,columnDivision:G,onDetailToggled:P,detailState:q,logItemToggle:u,logsToggle:p,processToggle:g,referenceItemToggle:b,referencesToggle:m,warningsToggle:y,stackTracesToggle:j,span:t,traceToProfilesOptions:_,timeZone:te,tagsToggle:A,traceStartTime:Q.startTime,traceDuration:Q.duration,traceName:Q.traceName,hoverIndentGuideIds:oe,addHoverIndentGuideId:de,removeHoverIndentGuideId:le,createSpanLink:fe,focusedSpanId:ye,createFocusSpanLink:Re,datasourceType:we,datasourceUid:Le,visibleSpanIds:i,traceFlameGraphs:be,setTraceFlameGraphs:Te,setRedrawListView:De,timeRange:Ae,app:je})},s)}render(){const t=Ft(),{scrollElement:s,redrawListView:r}=this.props;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_r,{ref:this.setListView,dataLength:this.getRowStates().length,itemHeightGetter:this.getRowHeight,itemRenderer:this.renderRow,viewBuffer:bt,viewBufferMin:bt,itemsWrapperClassName:t.rowsWrapper,getKeyFromIndex:this.getKeyFromIndex,getIndexFromKey:this.getIndexFromKey,windowScroller:!1,scrollElement:s,redraw:r}),this.props.topOfViewRef&&(0,n.jsx)(ws.I,{className:t.scrollToTopButton,onClick:this.scrollToTop,title:(0,f.t)("explore.unthemed-virtualized-trace-view.title-scroll-to-top","Scroll to top"),icon:"arrow-up"})]})}}const ci=(0,x.cV)(li),di=(0,ze.N)(e=>({TraceTimelineViewer:(0,o.css)({label:"TraceTimelineViewer",borderBottom:`1px solid ${(0,T.R)(e,"#bbb")}`,"& .json-markup":{lineHeight:"17px",fontSize:"13px",fontFamily:"monospace",whiteSpace:"pre-wrap"},"& .json-markup-key":{fontWeight:"bold"},"& .json-markup-bool":{color:(0,T.R)(e,"firebrick")},"& .json-markup-string":{color:(0,T.R)(e,"teal")},"& .json-markup-null":{color:(0,T.R)(e,"teal")},"& .json-markup-number":{color:(0,T.R)(e,"blue","black")}})})),ui=5;class pi extends h.PureComponent{constructor(t){super(t),this.collapseAll=()=>{this.props.collapseAll(this.props.trace.spans),(0,Ve.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_e.$.buildInfo.version,type:"collapseAll"})},this.collapseOne=()=>{this.props.collapseOne(this.props.trace.spans),(0,Ve.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_e.$.buildInfo.version,type:"collapseOne"})},this.expandAll=()=>{this.props.expandAll(),(0,Ve.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_e.$.buildInfo.version,type:"expandAll"})},this.expandOne=()=>{this.props.expandOne(this.props.trace.spans),(0,Ve.rR)("grafana_traces_traceID_expand_collapse_clicked",{datasourceType:this.props.datasourceType,grafana_version:_e.$.buildInfo.version,type:"expandOne"})},this.state={height:0}}componentDidMount(){ur({collapseAll:this.collapseAll,expandAll:this.expandAll,collapseOne:this.collapseOne,expandOne:this.expandOne})}render(){const{setSpanNameColumnWidth:t,updateNextViewRangeTime:s,updateViewRangeTime:r,viewRange:a,traceTimeline:i,theme:l,topOfViewRef:c,focusedSpanIdForSearch:u,...p}=this.props,{trace:g}=p,m=di(l);return(0,n.jsxs)("div",{className:m.TraceTimelineViewer,ref:b=>b&&this.setState({height:b.getBoundingClientRect().height}),children:[(0,n.jsx)(Ar,{duration:g.duration,nameColumnWidth:i.spanNameColumnWidth,numTicks:ui,onCollapseAll:this.collapseAll,onCollapseOne:this.collapseOne,onColummWidthChange:t,onExpandAll:this.expandAll,onExpandOne:this.expandOne,viewRangeTime:a.time,updateNextViewRangeTime:s,updateViewRangeTime:r,columnResizeHandleHeight:this.state.height}),(0,n.jsx)(ci,{...p,...i,setSpanNameColumnWidth:t,currentViewRangeTime:a.time.current,topOfViewRef:c,focusedSpanIdForSearch:u,datasourceType:this.props.datasourceType,datasourceUid:this.props.datasourceUid})]})}}const hi=(0,x.cV)(pi);function gi(){const[e,t]=(0,h.useState)(new Set),s=(0,h.useCallback)(function(u){if(e.size===0)return;let p=-1,g=!0;const m=u.reduce((b,y)=>(y.depth<=p&&(g=!0),g&&b.has(y.spanID)&&(b.delete(y.spanID),g=!1,p=y.depth),b),new Set(e));t(m)},[e]),r=(0,h.useCallback)(function(u){if(Us(u,e))return;let p;const g=u.reduce((m,b)=>(p&&b.depth<=p.depth?(m.add(p.spanID),b.hasChildren&&(p=b)):b.hasChildren&&!m.has(b.spanID)&&(p=b),m),new Set(e));p&&g.add(p.spanID),t(g)},[e]),a=(0,h.useCallback)(function(){t(new Set)},[]),i=(0,h.useCallback)(function(u){if(Us(u,e))return;const p=u.reduce((g,m)=>(m.hasChildren&&g.add(m.spanID),g),new Set);t(p)},[e]),l=(0,h.useCallback)(function(u){const p=new Set(e);e.has(u)?p.delete(u):p.add(u),t(p)},[e]);return{childrenHiddenIDs:e,expandOne:s,collapseOne:r,expandAll:a,collapseAll:i,childrenToggle:l}}function Us(e,t){return e.filter(r=>r.hasChildren).length===t.size}class Be{constructor(t){const{isTagsOpen:s,isProcessOpen:r,isReferencesOpen:a,isWarningsOpen:i,isStackTracesOpen:l,logs:c,references:u}=t||{};this.isTagsOpen=!!s,this.isProcessOpen=!!r,this.isReferencesOpen=!!a,this.isWarningsOpen=!!i,this.isStackTracesOpen=!!l,this.logs={isOpen:!!(c&&c.isOpen),openedItems:c&&c.openedItems?new Set(c.openedItems):new Set},this.references={isOpen:!!(u&&u.isOpen),openedItems:u&&u.openedItems?new Set(u.openedItems):new Set}}toggleTags(){const t=new Be(this);return t.isTagsOpen=!this.isTagsOpen,t}toggleProcess(){const t=new Be(this);return t.isProcessOpen=!this.isProcessOpen,t}toggleReferences(){const t=new Be(this);return t.references.isOpen=!this.references.isOpen,t}toggleReferenceItem(t){const s=new Be(this);return s.references.openedItems.has(t)?s.references.openedItems.delete(t):s.references.openedItems.add(t),s}toggleWarnings(){const t=new Be(this);return t.isWarningsOpen=!this.isWarningsOpen,t}toggleStackTraces(){const t=new Be(this);return t.isStackTracesOpen=!this.isStackTracesOpen,t}toggleLogs(){const t=new Be(this);return t.logs.isOpen=!this.logs.isOpen,t}toggleLogItem(t){const s=new Be(this);return s.logs.openedItems.has(t)?s.logs.openedItems.delete(t):s.logs.openedItems.add(t),s}}function fi(e){const[t,s]=(0,h.useState)(new Map);(0,h.useEffect)(()=>{s(new Map)},[e,s]);const r=(0,h.useCallback)(function(c){const u=new Map(t);u.has(c)?u.delete(c):u.set(c,new Be),s(u)},[t]),a=(0,h.useCallback)(function(c,u){const p=t.get(c);if(!p)return;const g=p.toggleLogItem(u),m=new Map(t);return m.set(c,g),s(m)},[t]),i=(0,h.useCallback)(function(c,u){const p=t.get(c);if(!p)return;const g=p.toggleReferenceItem(u),m=new Map(t);return m.set(c,g),s(m)},[t]);return{detailStates:t,toggleDetail:r,detailLogItemToggle:a,detailLogsToggle:(0,h.useCallback)(l=>et("logs",t,s)(l),[t]),detailWarningsToggle:(0,h.useCallback)(l=>et("warnings",t,s)(l),[t]),detailStackTracesToggle:(0,h.useCallback)(l=>et("stackTraces",t,s)(l),[t]),detailReferenceItemToggle:i,detailReferencesToggle:(0,h.useCallback)(l=>et("references",t,s)(l),[t]),detailProcessToggle:(0,h.useCallback)(l=>et("process",t,s)(l),[t]),detailTagsToggle:(0,h.useCallback)(l=>et("tags",t,s)(l),[t])}}function et(e,t,s){return r=>{const a=t.get(r);if(!a)return;let i;e==="tags"?i=a.toggleTags():e==="process"?i=a.toggleProcess():e==="warnings"?i=a.toggleWarnings():e==="references"?i=a.toggleReferences():e==="stackTraces"?i=a.toggleStackTraces():i=a.toggleLogs();const l=new Map(t);l.set(r,i),s(l)}}function mi(){const[e,t]=(0,h.useState)(new Set),s=(0,h.useCallback)(function(i){t(l=>{const c=new Set(l);return c.add(i),c})},[]),r=(0,h.useCallback)(function(i){t(l=>{const c=new Set(l);return c.delete(i),c})},[]);return{hoverIndentGuideIds:e,addHoverIndentGuideId:s,removeHoverIndentGuideId:r}}function xi(){const[e,t]=(0,h.useState)({time:{current:[0,1]}}),s=(0,h.useCallback)(function(i){t(l=>{const c={...l.time,...i};return{...l,time:c}})},[]),r=(0,h.useCallback)(function(i,l){const u={current:[i,l]};t(p=>({...p,time:u}))},[]);return{viewRange:e,updateViewRangeTime:r,updateNextViewRangeTime:s}}const vi=e=>({noDataMsg:(0,o.css)({height:"100%",width:"100%",display:"grid",placeItems:"center",fontSize:e.typography.h4.fontSize,color:e.colors.text.secondary})});function yi(e){const{traceProp:t,datasource:s,topOfViewRef:r,exploreId:a,createSpanLink:i,focusedSpanId:l,createFocusSpanLink:c,spanFilters:u}=e,{detailStates:p,toggleDetail:g,detailLogItemToggle:m,detailLogsToggle:b,detailProcessToggle:y,detailReferencesToggle:j,detailReferenceItemToggle:O,detailTagsToggle:A,detailWarningsToggle:P,detailStackTracesToggle:G}=fi(e.dataFrames[0]),{removeHoverIndentGuideId:Q,addHoverIndentGuideId:_,hoverIndentGuideIds:te}=mi(),{viewRange:oe,updateViewRangeTime:de,updateNextViewRangeTime:le}=xi(),{expandOne:fe,collapseOne:ye,childrenToggle:Re,collapseAll:ae,childrenHiddenIDs:we,expandAll:Le}=gi(),{search:be,setSearch:Te,spanFilterMatches:De}=(0,ss.SQ)(t?.spans,u),[Ae,je]=(0,h.useState)(""),[q,Ce]=(0,I.A)(!1),[Ne,Me]=(0,h.useState)(100),[xe,We]=(0,h.useState)({}),[pe,ke]=(0,h.useState)({}),ve=(0,x.of)(vi),[It,ot]=(0,h.useState)(.4),[_t,me]=bi({refId:e.dataFrames[0]?.refId,exploreId:e.exploreId,datasource:s,splitOpenFn:e.splitOpenFn}),lt=l??_t,ct=c??me,Pt=(0,h.useMemo)(()=>({childrenHiddenIDs:we,detailStates:p,hoverIndentGuideIds:te,spanNameColumnWidth:It,traceID:e.traceProp?.traceID}),[we,p,te,It,e.traceProp?.traceID]),St=(0,w.tR)().getInstanceSettings(s?.name),Gs=B(St?.jsonData),Zs=St?.jsonData?.tracesToMetrics,Bt=St?.jsonData?.tracesToProfiles,Ii=St?.jsonData,Si=(0,h.useMemo)(()=>i??Xr({splitOpenFn:e.splitOpenFn,traceToLogsOptions:Gs,traceToMetricsOptions:Zs,traceToProfilesOptions:Bt,dataFrame:e.dataFrames[0],createFocusSpanLink:ct,trace:t}),[e.splitOpenFn,Gs,Zs,Bt,e.dataFrames,ct,t,i]),Qs=(0,K.d4)(Ci=>(0,M.O)(Ci.user)),Xs=s?s?.type:"unknown",wi=s?s?.uid:"",Ti=e.scrollElement?e.scrollElement:document.getElementsByClassName(e.scrollElementClass??"")[0],Di=ie(t);return(0,n.jsx)(n.Fragment,{children:e.dataFrames?.length&&t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ls,{trace:t,data:e.dataFrames[0],timeZone:Qs,search:be,setSearch:Te,showSpanFilters:q,setShowSpanFilters:Ce,setFocusedSpanIdForSearch:je,spanFilterMatches:De,datasourceType:Xs,setHeaderHeight:Me,app:a?R.Jk.Explore:R.Jk.Unknown}),(0,n.jsx)(or,{trace:t,viewRange:oe,updateNextViewRangeTime:le,updateViewRangeTime:de}),(0,n.jsx)(hi,{findMatchesIDs:De,trace:t,traceToProfilesOptions:Bt,datasourceType:Xs,datasourceUid:wi,spanBarOptions:Ii?.spanBar,traceTimeline:Pt,updateNextViewRangeTime:le,updateViewRangeTime:de,viewRange:oe,timeZone:Qs,setSpanNameColumnWidth:ot,collapseAll:ae,collapseOne:ye,expandAll:Le,expandOne:fe,childrenToggle:Re,detailLogItemToggle:m,detailLogsToggle:b,detailWarningsToggle:P,detailStackTracesToggle:G,detailReferencesToggle:j,detailReferenceItemToggle:O,detailProcessToggle:y,detailTagsToggle:A,detailToggle:g,addHoverIndentGuideId:_,removeHoverIndentGuideId:Q,createSpanLink:Si,scrollElement:Ti,focusedSpanId:lt,focusedSpanIdForSearch:Ae,showSpanFilterMatchesOnly:be.matchesOnly,showCriticalPathSpansOnly:be.criticalPathOnly,createFocusSpanLink:ct,topOfViewRef:r,headerHeight:Ne,criticalPath:Di,traceFlameGraphs:xe,setTraceFlameGraphs:We,redrawListView:pe,setRedrawListView:ke,timeRange:e.timeRange,app:a?R.Jk.Explore:R.Jk.Unknown})]}):(0,n.jsx)("div",{className:ve.noDataMsg,children:(0,n.jsx)(f.x6,{i18nKey:"explore.trace-view.no-data",children:"No data"})})})}function bi(e){const t=(0,K.d4)(c=>c.explore.panes[e.exploreId]?.panelsState.trace),s=t?.spanId,r=(0,K.wA)(),a=c=>r((0,L.EA)(e.exploreId,"trace",{...t,spanId:c})),i=(0,K.d4)(c=>c.explore.panes[e.exploreId]?.queries.find(u=>u.refId===e.refId));return[s,(c,u)=>{const p={title:(0,f.t)("explore.use-focus-span-link.create-focus-span-link.link.title.deep-link-to-this-span","Deep link to this span"),url:"",internal:{datasourceUid:e.datasource?.uid,datasourceName:e.datasource?.name,query:{...i,query:c},panelsState:{trace:{spanId:u}}}},g=i?.queryType==="traceql"&&i.query===c;return(0,E.u)({link:p,internalLink:p.internal,scopedVars:{},field:{},onClickFn:g?()=>a(s===u?void 0:u):e.splitOpenFn?()=>e.splitOpenFn({datasourceUid:e.datasource?.uid,queries:[{...i,query:c}],panelsState:{trace:{spanId:u}}}):void 0,replaceVariables:(0,Y.w)().replace.bind((0,Y.w)())})}]}},11065:(S,v,d)=>{"use strict";d.d(v,{R:()=>o});var n=d(84140);function o(h,I,R){if(h.isLight)return I;{if(R){const B=(0,n.A)(I);return n.A.mostReadable(R,[B.clone().lighten(25),B.clone().lighten(10),B,B.clone().darken(10),B.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const E=(0,n.A)(I).toHsl();E.l=1-E.l;const f=(0,n.A)(E);return f.isLight()?f.darken(5).toHex8String():f.lighten(5).toHex8String()}}},69192:(S,v,d)=>{"use strict";d.d(v,{T:()=>z});var n=d(74848),o=d(22803),h=d(4392),I=d(47184),R=d(92745),E=d(20301),f=d(63142),B=d(41654),U=d(18857),H=d(63527),V=d(77806),F=d(65445);const z=({search:Y,trace:x,setSearch:w,tagKeys:M,setTagKeys:K,tagValues:L,setTagValues:N})=>{const D={...(0,f.of)(ue)},$=()=>{M||K((0,F._g)(x).map(I.z))},X=C=>(0,F.Io)(x,C).map(I.z);(0,h.A)(()=>{Y.tags&&Y.tags.forEach(C=>{C.key&&N({...L,[C.id]:X(C.key)})})});const ne=(C,Z)=>{w({...Y,tags:Y.tags?.map(ie=>ie.id===C.id?{...ie,key:Z?.value||"",value:void 0}:ie)}),(async()=>{if(Z?.value)N({...L,[C.id]:X(Z.value)});else{const ie={...L};ie[C.id]&&delete ie[C.id],N(ie)}})()},k=()=>{const C={id:(0,V.zE)(),operator:"="};w({...Y,tags:[...Y.tags,C]})},J=C=>{let Z=Y.tags.filter(ce=>ce.id!==C);Z.length===0&&(Z=[{id:(0,V.zE)(),operator:"="}]),w({...Y,tags:Z})};return(0,n.jsx)("div",{children:Y.tags?.map((C,Z)=>(0,n.jsx)("div",{children:(0,n.jsxs)(B.B,{gap:0,width:"auto",justifyContent:"flex-start",alignItems:"center",children:[(0,n.jsx)("div",{children:(0,n.jsx)(U.l6,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-select-tag-key","Select tag key"),isClearable:!0,onChange:ce=>ne(C,ce),onOpenMenu:$,options:M||(C.key?[C.key].map(I.z):[]),placeholder:(0,R.t)("explore.span-filters-tags.placeholder-select-tag","Select tag"),value:C.key||null},C.key)}),(0,n.jsx)("div",{children:(0,n.jsx)(U.l6,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-select-tag-operator","Select tag operator"),onChange:ce=>{w({...Y,tags:Y.tags?.map(ie=>ie.id===C.id?{...ie,operator:ce.value}:ie)})},options:[(0,I.z)("="),(0,I.z)("!="),(0,I.z)("=~"),(0,I.z)("!~")],value:C.operator})}),(0,n.jsxs)("span",{className:D.tagValues,children:[(C.operator==="="||C.operator==="!=")&&(0,n.jsx)(U.l6,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-select-tag-value","Select tag value"),isClearable:!0,onChange:ce=>{w({...Y,tags:Y.tags?.map(ie=>ie.id===C.id?{...ie,value:ce?.value||""}:ie)})},options:L[C.id]?L[C.id]:C.value?[C.value].map(I.z):[],placeholder:(0,R.t)("explore.span-filters-tags.placeholder-select-value","Select value"),value:C.value},C.value),(C.operator==="=~"||C.operator==="!~")&&(0,n.jsx)(H.p,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-input-tag-value","Input tag value"),onChange:ce=>{w({...Y,tags:Y.tags?.map(ie=>ie.id===C.id?{...ie,value:ce?.currentTarget?.value||""}:ie)})},placeholder:(0,R.t)("explore.span-filters-tags.placeholder-tag-value","Tag value"),width:18,value:C.value||""})]}),(C.key||C.value||Y.tags.length>1)&&(0,n.jsx)(E.Z,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-remove-tag","Remove tag"),variant:"secondary",icon:"times",onClick:()=>J(C.id),tooltip:(0,R.t)("explore.span-filters-tags.tooltip-remove-tag","Remove tag")}),(C.key||C.value)&&Z===Y.tags.length-1&&(0,n.jsx)("span",{className:D.addTag,children:(0,n.jsx)(E.Z,{"aria-label":(0,R.t)("explore.span-filters-tags.aria-label-add-tag","Add tag"),variant:"secondary",icon:"plus",onClick:k,tooltip:(0,R.t)("explore.span-filters-tags.tooltip-add-tag","Add tag")})})]})},C.id))})},ue=Y=>({addTag:(0,o.css)({marginLeft:Y.spacing(1)}),tagValues:(0,o.css)({maxWidth:"200px"})})},21961:(S,v,d)=>{"use strict";d.d(v,{Ay:()=>ne});var n=d(74848),o=d(22803),h=d(46942),I=d.n(h),R=d(30703),E=d(63142),f=d(11065),B=d(96540),U=d(92745),H=d(45967),V=d(45861);const F=()=>({CopyIcon:(0,o.css)({backgroundColor:"transparent",border:"none",color:"inherit",height:"100%",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function z({copyText:k,icon:J="copy",tooltipTitle:C}){const Z=(0,E.of)(F),[ce,ie]=(0,B.useState)(!1),se=()=>{navigator.clipboard.writeText(k),ie(!0)};return(0,n.jsx)(H.m,{content:ce?(0,U.t)("explore.trace-view.tooltip-copy-icon","Copied"):C,children:(0,n.jsx)(V.$n,{className:I()(Z.CopyIcon),type:"button",icon:J,onClick:se})})}const ue="    ";function Y(k){let J="";return k&&Object.keys(k).forEach(function(C){J+=C+":"+k[C]+";"}),J}function x(k){function J(Z){return'class="'+Z+'"'}function C(Z){return'style="'+Y(k["."+Z])+'"'}return k?C:J}function w(k){return k===null?"null":Array.isArray(k)?"array":typeof k=="string"&&/^https?:/.test(k)?"link":typeof k=="object"&&typeof k.toISOString=="function"?"date":typeof k}function M(k){return k.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function K(k,J){let C="";const Z=x(J);let ce=function(se,W,he,re){if(!se.length)return W+" "+he;let Oe=W+`
`;return C+=ue,se.forEach(function(ee,Ie){Oe+=C+re(ee)+(Ie<se.length-1?",":"")+`
`}),C=C.slice(0,-ue.length),Oe+C+he};function ie(se){if(se===void 0)return"";switch(w(se)){case"boolean":return"<span "+Z("json-markup-bool")+">"+se+"</span>";case"number":return"<span "+Z("json-markup-number")+">"+se+"</span>";case"date":return'<span class="json-markup-string">"'+M(se.toISOString())+'"</span>';case"null":return"<span "+Z("json-markup-null")+">null</span>";case"string":return"<span "+Z("json-markup-string")+'>"'+M(se.replace(/\n/g,`
`+C))+'"</span>';case"link":return"<span "+Z("json-markup-string")+'>"<a href="'+encodeURI(se)+'">'+M(se)+'</a>"</span>';case"array":return ce(se,"[","]",ie);case"object":const W=Object.keys(se).filter(function(he){return se[he]!==void 0});return ce(W,"{","}",function(he){return"<span "+Z("json-markup-key")+'>"'+M(he)+'":</span> '+ie(se[he])})}return""}return"<div "+Z("json-markup")+">"+ie(k)+"</div>"}const L="copyIcon",N=k=>({KeyValueTable:(0,o.css)({label:"KeyValueTable",background:(0,f.R)(k,"#fff"),border:`1px solid ${(0,f.R)(k,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,o.css)({width:"100%"}),body:(0,o.css)({label:"body",verticalAlign:"baseline"}),row:(0,o.css)({label:"row","& > td":{padding:"0.5rem 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,f.R)(k,"#f5f5f5")},[`&:not(:hover) .${L}`]:{visibility:"hidden"},"a span":{color:`${k.colors.text.link} !important`},"a:hover span":{textDecoration:"underline"}}),keyColumn:(0,o.css)({label:"keyColumn",color:(0,f.R)(k,"#888"),whiteSpace:"pre",width:"125px",verticalAlign:"top"}),copyColumn:(0,o.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,o.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,o.css)({display:"inline-block"})}),D=/^(\[|\{)/;function $(k){if(typeof k=="string"&&D.test(k))try{return JSON.parse(k)}catch{}return k}const X=({link:k,children:J})=>{const{path:C,title:Z="",onClick:ce,icon:ie="external-link-alt"}=k;return(0,n.jsxs)("a",{href:C,title:Z,onClick:ce,target:"_blank",rel:"noopener noreferrer",children:[J," ",(0,n.jsx)(R.I,{name:ie})]})};function ne(k){const{data:J,linksGetter:C}=k,Z=(0,E.of)(N);return(0,n.jsx)("div",{className:I()(Z.KeyValueTable),"data-testid":"KeyValueTable",children:(0,n.jsx)("table",{className:Z.table,children:(0,n.jsx)("tbody",{className:Z.body,children:J.map((ce,ie)=>{const se={__html:K($(ce.value))},W=(0,n.jsx)("div",{className:Z.jsonTable,dangerouslySetInnerHTML:se}),he=C?.(J,ie);let re;return he&&he.length?re=(0,n.jsx)("div",{children:(0,n.jsx)(X,{link:he[0],children:W})}):re=W,(0,n.jsxs)("tr",{className:Z.row,children:[(0,n.jsx)("td",{className:Z.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:ce.key}),(0,n.jsx)("td",{children:re}),(0,n.jsx)("td",{className:Z.copyColumn,children:(0,n.jsx)(z,{className:L,copyText:JSON.stringify(ce,null,2),tooltipTitle:"Copy JSON"})})]},`${ce.key}-${ie}`)})})})})}},87844:(S,v,d)=>{"use strict";d.d(v,{D:()=>o,f:()=>n});const n=100,o="<trace-without-root-span>"},34282:(S,v,d)=>{"use strict";d.d(v,{ID:()=>f,Nd:()=>n,XQ:()=>o,Zh:()=>R,gz:()=>E,mT:()=>I,x9:()=>h});const n="kind",o="status",h="status.message",I="library.name",R="library.version",E="trace.state",f="id"},57944:(S,v,d)=>{"use strict";d.d(v,{h9:()=>E,tV:()=>I});var n=d(2543),o=d.n(n);function h(f){let B;const U=new Set(f.map(({spanID:H})=>H));for(let H=0;H<f.length;H++){if(f[H].references&&f[H].references.some(({traceID:ue,spanID:Y})=>ue===f[H].traceID&&U.has(Y)))continue;if(!B){B=f[H];continue}const F=f[H].references&&f[H].references.length||0,z=B.references&&B.references.length||0;(F<z||F===z&&f[H].startTime<B.startTime)&&(B=f[H])}return B?`${B.process.serviceName}: ${B.operationName}`:""}const I=(0,n.memoize)(h,f=>f.length?f[0].traceID:0);function R(f){for(let B=0;B<f.length;B++){const U=f[B].tags.filter(F=>F.key==="http.request.method"),H=f[B].tags.filter(F=>F.key==="http.response.status_code"),V=f[B].tags.filter(F=>F.key==="http.route");if(U.length>0||H.length>0||V.length>0)return{method:U,status:H,url:V}}for(let B=0;B<f.length;B++){const U=f[B].tags.filter(F=>F.key==="http.method"),H=f[B].tags.filter(F=>F.key==="http.status_code"),V=f[B].tags.filter(F=>F.key==="http.url"||F.key==="http.target"||F.key==="http.path");if(U.length>0||H.length>0||V.length>0)return{method:U,status:H,url:V}}return{}}const E=(0,n.memoize)(R,f=>f.length?f[0].traceID:0)},43304:(S,v,d)=>{"use strict";d.d(v,{C:()=>R});var n=d(2543),o=d(87844);const h=Object.defineProperty({archiveEnabled:!1,dependencies:{dagMaxNumServices:o.f,menuEnabled:!0},linkPatterns:[],search:{maxLookback:{label:"2 Days",value:"2d"},maxLimit:1500},tracking:{gaID:null,trackErrors:!0}},"__mergeFields",{value:["dependencies","search","tracking"]});function I(){return h}function R(E){return(0,n.get)(I(),E)}},57208:(S,v,d)=>{"use strict";d.d(v,{BL:()=>Y,od:()=>h});var n=d(11908),o=d(34282);function h(x,w){if(!w)return;let M=!1;x.serviceName&&(w=F(w,x),M=!0),x.spanName&&(w=z(w,x),M=!0),(x.from||x.to)&&(w=ue(w,x),M=!0);const K=R(w,x.tags);if(K&&(w=K,M=!0),x.query){const L=I(x.query,w);L&&(w=L,M=!0)}return M?new Set(w.map(L=>L.spanID)):void 0}function I(x,w){if(!w)return;const M=[];x.split(/\s+/).filter(Boolean).forEach(D=>{M.push(D.toLowerCase())});const K=(D,$)=>D.some(X=>$.toLowerCase().includes(X)),L=D=>D?D.some($=>K(M,$.key)||K(M,V($.value))):!1,N=D=>K(M,D.operationName)||K(M,D.process.serviceName)||L(D.tags)||D.kind&&K(M,D.kind)||D.statusCode!==void 0&&K(M,n.s[D.statusCode])||D.statusMessage&&K(M,D.statusMessage)||D.instrumentationLibraryName&&K(M,D.instrumentationLibraryName)||D.instrumentationLibraryVersion&&K(M,D.instrumentationLibraryVersion)||D.traceState&&K(M,D.traceState)||D.logs!==null&&D.logs.some($=>$.name&&K(M,$.name)||L($.fields))||L(D.process.tags)||M.some($=>$===D.spanID);return w.filter(N)}const R=(x,w)=>{if(w=w.filter(M=>M.key&&M.key!==""||M.value),w.length>0)return x.filter(M=>w.every(K=>K.key&&K.value?!!(K.operator==="="&&f(K,M)||K.operator==="=~"&&E(K,M)||K.operator==="!="&&!f(K,M)||K.operator==="!~"&&!E(K,M)):K.key?M.tags.some(L=>B(K.key,L.key))||M.process.tags.some(L=>B(K.key,L.key))||M.logs&&M.logs.some(L=>L.fields.some(N=>B(K.key,N.key)))||M.kind&&K.key===o.Nd||M.statusCode!==void 0&&K.key===o.XQ||M.statusMessage&&K.key===o.x9||M.instrumentationLibraryName&&K.key===o.mT||M.instrumentationLibraryVersion&&K.key===o.Zh||M.traceState&&K.key===o.gz||K.key===o.ID?K.operator==="="||K.operator==="=~":!(K.operator==="="||K.operator==="=~"):!1))},E=(x,w)=>w.tags.some(M=>H(x,M))||w.process.tags.some(M=>H(x,M))||w.logs&&w.logs.some(M=>M.fields.some(K=>H(x,K)))||w.kind&&x.key===o.Nd&&x.value?.includes(w.kind)||w.statusCode!==void 0&&x.key===o.XQ&&x.value?.includes(n.s[w.statusCode].toLowerCase())||w.statusMessage&&x.key===o.x9&&x.value?.includes(w.statusMessage)||w.instrumentationLibraryName&&x.key===o.mT&&x.value?.includes(w.instrumentationLibraryName)||w.instrumentationLibraryVersion&&x.key===o.Zh&&x.value?.includes(w.instrumentationLibraryVersion)||w.traceState&&x.key===o.gz&&x.value?.includes(w.traceState)||x.key===o.ID&&x.value?.includes(w.spanID),f=(x,w)=>w.tags.some(M=>U(x,M))||w.process.tags.some(M=>U(x,M))||w.logs&&w.logs.some(M=>M.fields.some(K=>U(x,K)))||w.kind&&x.key===o.Nd&&x.value===w.kind||w.statusCode!==void 0&&x.key===o.XQ&&x.value===n.s[w.statusCode].toLowerCase()||w.statusMessage&&x.key===o.x9&&x.value===w.statusMessage||w.instrumentationLibraryName&&x.key===o.mT&&x.value===w.instrumentationLibraryName||w.instrumentationLibraryVersion&&x.key===o.Zh&&x.value===w.instrumentationLibraryVersion||w.traceState&&x.key===o.gz&&x.value===w.traceState||x.key===o.ID&&x.value===w.spanID,B=(x,w)=>x===w.toString(),U=(x,w)=>x.key===w.key&&x.value===V(w.value),H=(x,w)=>w.key.includes(x.key||"")&&V(w.value).includes(x.value||""),V=x=>x?x.toString():"",F=(x,w)=>x.filter(M=>w.serviceNameOperator==="="?M.process.serviceName===w.serviceName:M.process.serviceName!==w.serviceName),z=(x,w)=>x.filter(M=>w.spanNameOperator==="="?M.operationName===w.spanName:M.operationName!==w.spanName),ue=(x,w)=>{const M=Y(w?.from||""),K=Y(w?.to||"");let L=[];if(M&&(L=x.filter(N=>w.fromOperator===">"?N.duration>M:N.duration>=M)),K){const N=D=>w.toOperator==="<"?D.duration<K:D.duration<=K;L=L.length>0?L.filter(D=>N(D)):x.filter(D=>N(D))}return L},Y=x=>{if(x.includes("ns"))return parseFloat(x.split("ns")[0])/1e3;if(x.includes("us"))return parseFloat(x.split("us")[0]);if(x.includes("\xB5s"))return parseFloat(x.split("\xB5s")[0]);if(x.includes("ms"))return parseFloat(x.split("ms")[0])*1e3;if(x.includes("s"))return parseFloat(x.split("s")[0])*1e3*1e3;if(x.includes("m"))return parseFloat(x.split("m")[0])*1e3*1e3*60;if(x.includes("h"))return parseFloat(x.split("h")[0])*1e3*1e3*60*60}},77806:(S,v,d)=>{"use strict";d.d(v,{Ji:()=>B,Qh:()=>H,SQ:()=>U,_g:()=>f,zE:()=>E});var n=d(2543),o=d.n(n),h=d(96540),I=d(24726),R=d(57208);const E=()=>(0,I.A)().slice(0,12),f={id:E(),operator:"="},B={spanNameOperator:"=",serviceNameOperator:"=",fromOperator:">",toOperator:"<",tags:[f],matchesOnly:!1,criticalPathOnly:!1};function U(V,F){const[z,ue]=(0,h.useState)((0,n.merge)((0,n.cloneDeep)(B),F??{}));(0,h.useEffect)(()=>{F&&ue(x=>(0,n.merge)((0,n.cloneDeep)(x),F))},[F]);const Y=(0,h.useMemo)(()=>V&&(0,R.od)(z,V),[z,V]);return{search:z,setSearch:ue,spanFilterMatches:Y}}function H(V,F){if(!F)return F;const z={...F};return z.query&&(z.query=V(z.query)),z.serviceNameOperator&&(z.serviceNameOperator=V(z.serviceNameOperator)),z.serviceName&&(z.serviceName=V(z.serviceName)),z.spanNameOperator&&(z.spanNameOperator=V(z.spanNameOperator)),z.spanName&&(z.spanName=V(z.spanName)),z.from&&(z.from=V(z.from)),z.to&&(z.to=V(z.to)),z.tags&&(z.tags=z.tags.map(ue=>({...ue,key:V(ue.key??""),value:V(ue.value??"")}))),z}},65445:(S,v,d)=>{"use strict";d.d(v,{Io:()=>B,_g:()=>f,m8:()=>E,pG:()=>R});var n=d(11908),o=d(2543),h=d.n(o),I=d(34282);const R=U=>{const H=U.spans.map(V=>V.process.serviceName);return(0,o.uniq)(H).sort()},E=U=>{const H=U.spans.map(V=>V.operationName);return(0,o.uniq)(H).sort()},f=U=>{let H=[],V=[];return U.spans.forEach(F=>{F.tags.forEach(z=>{H.push(z.key)}),F.process.tags.forEach(z=>{H.push(z.key)}),F.logs!==null&&F.logs.forEach(z=>{z.fields.forEach(ue=>{V.push(ue.key)})}),F.kind&&H.push(I.Nd),F.statusCode!==void 0&&H.push(I.XQ),F.statusMessage&&H.push(I.x9),F.instrumentationLibraryName&&H.push(I.mT),F.instrumentationLibraryVersion&&H.push(I.Zh),F.traceState&&H.push(I.gz),H.push(I.ID)}),H=(0,o.uniq)(H).sort(),V=(0,o.uniq)(V).sort(),[...H,...V]},B=(U,H)=>{const V=[];return U.spans.forEach(F=>{const z=F.tags.find(Y=>Y.key===H)?.value;z&&V.push(z.toString());const ue=F.process.tags.find(Y=>Y.key===H)?.value;switch(ue&&V.push(ue.toString()),F.logs!==null&&F.logs.forEach(Y=>{const x=Y.fields.find(w=>w.key===H)?.value;x&&V.push(x.toString())}),H){case I.Nd:F.kind&&V.push(F.kind);break;case I.XQ:F.statusCode!==void 0&&V.push(n.s[F.statusCode].toLowerCase());break;case I.x9:F.statusMessage&&V.push(F.statusMessage);break;case I.mT:F.instrumentationLibraryName&&V.push(F.instrumentationLibraryName);break;case I.Zh:F.instrumentationLibraryVersion&&V.push(F.instrumentationLibraryVersion);break;case I.gz:F.traceState&&V.push(F.traceState);break;case I.ID:V.push(F.spanID);break;default:break}}),(0,o.uniq)(V).sort()}},23398:(S,v,d)=>{"use strict";d.d(v,{L:()=>M});var n=d(88673),o=d(2543),h=d(25508);class I{static iterFunction(N,D=0){return $=>N($.value,$,D)}static searchFunction(N){return typeof N=="function"?N:(D,$)=>N instanceof I?$===N:D===N}constructor(N,D=[]){this.value=N,this.children=D}get depth(){return this.children.reduce((N,D)=>Math.max(D.depth+1,N),1)}get size(){let N=0;return this.walk(()=>N++),N}addChild(N){return this.children.push(N instanceof I?N:new I(N)),this}find(N){if(I.iterFunction(I.searchFunction(N))(this))return this;for(let $=0;$<this.children.length;$++){const X=this.children[$].find(N);if(X)return X}return null}getPath(N){const D=I.iterFunction(I.searchFunction(N)),$=(X,ne)=>{const k=ne.concat([X]);if(D(X))return k;for(let J=0;J<X.children.length;J++){const C=X.children[J],Z=$(C,k);if(Z)return Z}return null};return $(this,[])}walk(N,D=0){const $=[];let X=D;for($.push({node:this,depth:X});$.length;){const ne=$[$.length-1];$.pop();const{node:k,depth:J}=ne;N(k.value,k,J),X=J+1;let C=k.children.length-1;for(;C>=0;)$.push({node:k.children[C],depth:X}),C--}}paths(N){const D=[];D.push({node:this,childIndex:0});const $=[];for(;D.length;){const{node:X,childIndex:ne}=D[D.length-1];if(X.children.length>=ne+1)D[D.length-1].childIndex++,D.push({node:X.children[ne],childIndex:0});else{if(X.children.length===0){const k=D.map(J=>J.node.value);N(k)}D.pop()}}return $}}const R=L=>L.spanID,E=L=>L.references||[],f=(0,h.Mz)((0,h.Mz)(({span:L})=>L,E),({type:L})=>L,(L,N)=>L.find(D=>D.refType===N)),B=(0,h.Mz)(L=>f({span:L,type:"CHILD_OF"}),L=>L?L.spanID:null),U=L=>L.spans,H=(0,h.Mz)(U,L=>L.reduce((N,D)=>N.set(R(D),D),new Map)),V="__root__";function F(L,N=null){const D=new Map(L.spans.map(k=>[k.spanID,new I(k.spanID)])),$=N??new Map(L.spans.map(k=>[k.spanID,k])),X=new I(V);L.spans.forEach(k=>{const J=D.get(k.spanID);if(Array.isArray(k.references)&&k.references.length){const{refType:C,spanID:Z}=k.references[0];if(C==="CHILD_OF"||C==="FOLLOWS_FROM")(D.get(Z)||X).children?.push(J);else throw new Error(`Unrecognized ref type: ${C}`)}else X.children.push(J)});const ne=(k,J)=>{const C=k?.value?$.get(k.value.toString()):void 0,Z=J?.value?$.get(J.value.toString()):void 0;return+(C?.startTime>Z?.startTime)||+(C?.startTime===Z?.startTime)-1};return L.spans.forEach(k=>{const J=D.get(k.spanID);J.children.length>1&&J?.children.sort(ne)}),X.children.sort(ne),X}var z=d(43304),ue=d(57944);function Y(L){const N=new Map,D=L.reduce((X,ne)=>(X.some(k=>k.key===ne.key&&k.value===ne.value)?N.set(`${ne.key}:${ne.value}`,`Duplicate tag "${ne.key}:${ne.value}"`):X.push(ne),X),[]),$=Array.from(N.values());return{dedupedTags:D,warnings:$}}function x(L,N){const D=L?.slice()??[],$=(N||[]).map(X=>X.toLowerCase());return D.sort((X,ne)=>{const k=X.key.toLowerCase(),J=ne.key.toLowerCase();for(let C=0;C<$.length;C++){const Z=$[C];if(k.startsWith(Z)&&!J.startsWith(Z))return-1;if(!k.startsWith(Z)&&J.startsWith(Z))return 1}return k>J?1:k<J?-1:0}),D}function w(L){if(!L?.traceID)return null;const N=L.traceID.toLowerCase();let D=0,$=Number.MAX_SAFE_INTEGER;const X=new Map,ne=new Map;L.spans=L.spans.filter(se=>!!se.startTime),L.processes=Object.entries(L.processes).reduce((se,[W,he])=>(se[W]={...he,tags:x(he.tags)},se),{});const k=L.spans.length;for(let se=0;se<k;se++){const W=L.spans[se],{startTime:he,duration:re,processID:Oe}=W;let ee=W.spanID;he<$&&($=he),he+re>D&&(D=he+re);const Ie=X.get(ee);Ie!=null?(console.warn(`Dupe spanID, ${Ie+1} x ${ee}`,W,ne.get(ee)),(0,o.isEqual)(W,ne.get(ee))&&console.warn("	 two spans with same ID have `isEqual(...) === true`"),X.set(ee,Ie+1),ee=`${ee}_${Ie}`,W.spanID=ee):X.set(ee,1),W.process=L.processes[Oe],ne.set(ee,W)}const J=F(L,ne),C=[],Z={};J.walk((se,W,he=0)=>{if(se==="__root__"||typeof se!="string")return;const re=ne.get(se);if(!re)return;const{serviceName:Oe}=re.process;Z[Oe]=(Z[Oe]||0)+1,re.relativeStartTime=re.startTime-$,re.depth=he-1,re.hasChildren=W.children.length>0,re.childSpanCount=W.children.length,re.warnings=re.warnings||[],re.tags=re.tags||[],re.references=re.references||[],re.childSpanIds=W.children.slice().sort((Ie,tt)=>{const Fe=ne.get(Ie.value),dt=ne.get(tt.value);return dt.startTime+dt.duration-(Fe.startTime+Fe.duration)}).map(Ie=>Ie.value);const ee=Y(re.tags);re.tags=x(ee.dedupedTags,(0,z.C)("topTagPrefixes")),re.warnings=re.warnings.concat(ee.warnings),re.references.forEach((Ie,tt)=>{const Fe=ne.get(Ie.spanID);Fe&&(Ie.span=Fe,tt>0&&(Fe.subsidiarilyReferencedBy=Fe.subsidiarilyReferencedBy||[],Fe.subsidiarilyReferencedBy.push({spanID:se,traceID:N,span:re,refType:Ie.refType})))}),C.push(re)});const ce=(0,ue.tV)(C);return{services:Object.keys(Z).map(se=>({name:se,numberOfSpans:Z[se]})),spans:C,traceID:N,traceName:ce,processes:L.processes,duration:D-$,startTime:$,endTime:D}}function M(L){if(!L)return null;let N=L.fields.length===1?L.fields[0].values[0]:K(L);return N?w(N):null}function K(L){const N=new n.R(L),D={};for(let $=0;$<N.length;$++){const X=N.get($);if(!X.spanID)return null;D[X.spanID]||(D[X.spanID]={serviceName:X.serviceName,tags:X.serviceTags})}return{traceID:N.get(0).traceID,processes:D,spans:N.toArray().map(($,X)=>{const ne=[];return $.parentSpanID&&ne.push({refType:"CHILD_OF",spanID:$.parentSpanID,traceID:$.traceID}),$.references&&ne.push(...$.references.map(k=>({refType:"FOLLOWS_FROM",...k}))),{...$,duration:$.duration*1e3,startTime:$.startTime*1e3,processID:$.spanID,flags:0,references:ne,logs:$.logs?.map(k=>({...k,timestamp:k.timestamp*1e3}))||[],dataFrameRowIndex:X}})}}},4392:(S,v,d)=>{"use strict";d.d(v,{A:()=>h});var n=d(94701),o=function(I){(0,n.A)(function(){I()})};const h=o},20301:(S,v,d)=>{"use strict";d.d(v,{Z:()=>R});var n=d(22803),o=d(96540),h=d(63142),I=d(45861);const R=({className:f,...B})=>{const U=(0,h.of)(E);return o.createElement(I.$n,{...B,className:(0,n.cx)(f,U.button)})},E=f=>({button:(0,n.css)({paddingLeft:f.spacing(3/2),paddingRight:f.spacing(3/2)})})}}]);

//# sourceMappingURL=1213.49753de32a452190910c.js.map