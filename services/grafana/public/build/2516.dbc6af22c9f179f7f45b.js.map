{"version":3,"file":"2516.dbc6af22c9f179f7f45b.js","mappings":"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","sources":["webpack://grafana/./public/app/features/explore/Logs/LogsColumnSearch.tsx","webpack://grafana/./public/app/features/explore/Logs/LogsTableEmptyFields.tsx","webpack://grafana/./public/app/features/explore/Logs/LogsTableNavField.tsx","webpack://grafana/./public/app/features/explore/Logs/LogsTableActiveFields.tsx","webpack://grafana/./public/app/features/explore/Logs/LogsTableAvailableFields.tsx","webpack://grafana/./public/app/features/explore/Logs/LogsTableMultiSelect.tsx","webpack://grafana/./public/app/features/explore/Logs/utils/uFuzzy.ts","webpack://grafana/./public/app/features/explore/Logs/LogsTableWrap.tsx","webpack://grafana/./public/app/features/explore/Logs/PopoverMenu.tsx","webpack://grafana/./public/app/features/explore/Logs/utils/logs.ts","webpack://grafana/./public/app/features/logs/components/ControlledLogsTable.tsx","webpack://grafana/./public/app/features/logs/components/ControlledLogRows.tsx","webpack://grafana/./public/app/features/logs/components/InfiniteScroll.tsx","webpack://grafana/./public/app/features/logs/components/LoadingIndicator.tsx","webpack://grafana/./public/app/features/logs/components/LogDetailsRow.tsx","webpack://grafana/./public/app/features/logs/components/LogDetails.tsx","webpack://grafana/./public/app/features/logs/components/LogDetailsBody.tsx","webpack://grafana/./public/app/features/logs/components/LogLabelStatsRow.tsx","webpack://grafana/./public/app/features/logs/components/LogLabelStats.tsx","webpack://grafana/./public/app/features/logs/components/LogLabels.tsx","webpack://grafana/./public/app/features/logs/components/LogMessageAnsi.tsx","webpack://grafana/./public/app/features/logs/UniqueKeyMaker.ts","webpack://grafana/./public/app/features/logs/components/LogRowMenuCell.tsx","webpack://grafana/./public/app/features/logs/components/LogRowMessage.tsx","webpack://grafana/./public/app/features/logs/components/LogRowMessageDisplayedFields.tsx","webpack://grafana/./public/app/features/logs/components/LogRow.tsx","webpack://grafana/./public/app/features/logs/components/PreviewLogRow.tsx","webpack://grafana/./public/app/features/logs/components/LogRows.tsx","webpack://grafana/./public/app/features/logs/components/getLogRowStyles.ts","webpack://grafana/./public/app/features/logs/components/log-context/LogContextButtons.tsx","webpack://grafana/./public/app/features/logs/components/log-context/LogRowContextModal.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineDetailsDisplayedFields.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineDetailsFields.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineDetailsHeader.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineDetailsComponent.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineDetails.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineMenu.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLine.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogLineMessage.tsx","webpack://grafana/./public/app/features/logs/components/panel/InfiniteScroll.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogListSearch.tsx","webpack://grafana/./public/app/features/logs/components/panel/grammar.ts","webpack://grafana/./public/app/features/logs/components/panel/processing.ts","webpack://grafana/./public/app/features/logs/components/panel/useKeyBindings.ts","webpack://grafana/./public/app/features/logs/components/panel/usePopoverMenu.ts","webpack://grafana/./public/app/features/logs/components/panel/LogList.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogListContext.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogListControls.tsx","webpack://grafana/./public/app/features/logs/components/panel/LogListSearchContext.tsx","webpack://grafana/./public/app/features/logs/components/panel/virtualization.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/monaco-completion-provider/validation.ts","webpack://grafana/./node_modules/lru-cache/dist/esm/index.js","webpack://grafana/./public/app/plugins/datasource/loki/LanguageProvider.ts","webpack://grafana/./node_modules/rxjs/dist/esm5/internal/observable/dom/WebSocketSubject.js","webpack://grafana/./node_modules/rxjs/dist/esm5/internal/observable/dom/webSocket.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/sha1.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/parse.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/v35.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/v5.js","webpack://grafana/./public/app/plugins/datasource/loki/liveStreamsResultTransformer.ts","webpack://grafana/./public/app/plugins/datasource/loki/LiveStreams.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiContextUi.tsx","webpack://grafana/./public/app/plugins/datasource/loki/sortDataFrame.ts","webpack://grafana/./public/app/plugins/datasource/loki/LogContextProvider.ts","webpack://grafana/./public/app/plugins/datasource/loki/migrations/variableQueryMigrations.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/VariableQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/LokiVariableSupport.ts","webpack://grafana/./public/app/plugins/datasource/loki/getDerivedFields.ts","webpack://grafana/./public/app/plugins/datasource/loki/makeTableFrames.ts","webpack://grafana/./public/app/plugins/datasource/loki/backendResultTransformer.ts","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiOptionFields.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldLazy.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/monaco-query-field/MonacoQueryFieldWrapper.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/LokiQueryField.tsx","webpack://grafana/./public/app/plugins/datasource/loki/components/AnnotationsQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/queryHints.ts","webpack://grafana/./public/app/plugins/datasource/loki/shardQuerySplitting.ts","webpack://grafana/./public/app/plugins/datasource/loki/streaming.ts","webpack://grafana/./public/app/plugins/datasource/loki/datasource.ts","webpack://grafana/./public/app/plugins/datasource/loki/languageUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/mergeResponses.ts","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/VisualQueryBuilder/QueryModellerBase.js","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/LokiQueryModeller.ts","webpack://grafana/./public/app/plugins/datasource/loki/modifyQuery.ts","webpack://grafana/./public/app/plugins/datasource/loki/logsTimeSplitting.ts","webpack://grafana/./public/app/plugins/datasource/loki/metricTimeSplitting.ts","webpack://grafana/./public/app/plugins/datasource/loki/querySplitting.ts","webpack://grafana/./public/app/plugins/datasource/loki/queryUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/binaryScalarOperations.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/LabelParamEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/operationUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/components/UnwrapParamEditor.tsx","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/operations.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/parsing.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/parsingUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/querybuilder/types.ts","webpack://grafana/./public/app/plugins/datasource/loki/lineParser.ts","webpack://grafana/./public/app/plugins/datasource/loki/responseUtils.ts","webpack://grafana/./public/app/plugins/datasource/loki/tracking.ts","webpack://grafana/./node_modules/rxjs/dist/esm5/internal/observable/defer.js","webpack://grafana/./node_modules/@grafana/lezer-logql/index.es.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorRow.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorStack.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/VisualQueryBuilder/components/RawQuery.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/VisualQueryBuilder/types.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/regex.js","webpack://grafana/./node_modules/uuid/dist/esm-browser/validate.js"],"sourcesContent":["import { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Field, Input, useTheme2 } from '@grafana/ui';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    searchWrap: css({\n      padding: `${theme.spacing(0.4)} 0 ${theme.spacing(0.4)} ${theme.spacing(0.4)}`,\n    }),\n  };\n}\n\nexport function LogsColumnSearch(props: { onChange: (e: React.FormEvent<HTMLInputElement>) => void; value: string }) {\n  const theme = useTheme2();\n\n  const styles = getStyles(theme);\n  return (\n    <Field className={styles.searchWrap}>\n      <Input\n        value={props.value}\n        type={'text'}\n        placeholder={t('explore.logs-column-search.placeholder-search-fields-by-name', 'Search fields by name')}\n        onChange={props.onChange}\n      />\n    </Field>\n  );\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    empty: css({\n      marginBottom: theme.spacing(2),\n      marginLeft: theme.spacing(1.75),\n      fontSize: theme.typography.fontSize,\n    }),\n  };\n}\n\nexport function LogsTableEmptyFields() {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.empty}>\n      <Trans i18nKey=\"explore.logs-table-empty-fields.no-fields\">No fields</Trans>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Checkbox, Icon, useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from './LogsTableWrap';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    dragIcon: css({\n      cursor: 'drag',\n      marginLeft: theme.spacing(1),\n      opacity: 0.4,\n    }),\n    labelCount: css({\n      marginLeft: theme.spacing(0.5),\n      marginRight: theme.spacing(0.5),\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n      opacity: 0.6,\n    }),\n    contentWrap: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n    }),\n    // Hide text that overflows, had to select elements within the Checkbox component, so this is a bit fragile\n    checkboxLabel: css({\n      '> span': {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        display: 'block',\n        maxWidth: '100%',\n      },\n    }),\n  };\n}\n\nexport function LogsTableNavField(props: {\n  label: string;\n  onChange: () => void;\n  labels: Record<string, FieldNameMeta>;\n  draggable?: boolean;\n  showCount?: boolean;\n}): React.JSX.Element | undefined {\n  const theme = useTheme2();\n\n  const styles = getStyles(theme);\n\n  if (props.labels[props.label]) {\n    return (\n      <>\n        <div className={styles.contentWrap}>\n          <Checkbox\n            className={styles.checkboxLabel}\n            label={props.label}\n            onChange={props.onChange}\n            checked={props.labels[props.label]?.active ?? false}\n          />\n          {props.showCount && (\n            <button className={styles.labelCount} onClick={props.onChange}>\n              {props.labels[props.label]?.percentOfLinesWithLabel}%\n            </button>\n          )}\n        </div>\n        {props.draggable && (\n          <Icon\n            aria-label={t('explore.logs-table-nav-field.aria-label-drag-and-drop-icon', 'Drag and drop icon')}\n            title={t('explore.logs-table-nav-field.title-drag-and-drop-to-reorder', 'Drag and drop to reorder')}\n            name=\"draggabledots\"\n            size=\"lg\"\n            className={styles.dragIcon}\n          />\n        )}\n      </>\n    );\n  }\n  return undefined;\n}\n","import { css, cx } from '@emotion/css';\nimport { DragDropContext, Draggable, DraggableProvided, Droppable, DropResult } from '@hello-pangea/dnd';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\nimport { FieldNameMeta } from './LogsTableWrap';\n\nexport function getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      display: 'flex',\n      background: theme.colors.background.primary,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // Sort by index\n    if (la.index != null && lb.index != null) {\n      return la.index - lb.index;\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableActiveFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n  reorderColumn: (sourceIndex: number, destinationIndex: number) => void;\n  id: string;\n}): JSX.Element => {\n  const { reorderColumn, labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    reorderColumn(result.source.index, result.destination.index);\n  };\n\n  const renderTitle = (labelName: string) => {\n    const label = labels[labelName];\n    if (label) {\n      return `${labelName} appears in ${label?.percentOfLinesWithLabel}% of log lines`;\n    }\n\n    return undefined;\n  };\n\n  if (labelKeys.length) {\n    return (\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"order-fields\" direction=\"vertical\">\n          {(provided) => (\n            <div className={styles.columnWrapper} {...provided.droppableProps} ref={provided.innerRef}>\n              {labelKeys.sort(sortLabels(labels)).map((labelName, index) => (\n                <Draggable draggableId={labelName} key={labelName} index={index}>\n                  {(provided: DraggableProvided, snapshot) => (\n                    <div\n                      className={cx(styles.wrap, snapshot.isDragging ? styles.dragging : undefined)}\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      {...provided.dragHandleProps}\n                      title={renderTitle(labelName)}\n                    >\n                      <LogsTableNavField\n                        label={labelName}\n                        onChange={() => toggleColumn(labelName)}\n                        labels={labels}\n                        draggable={true}\n                      />\n                    </div>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import { t } from '@grafana/i18n';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { getLogsFieldsStyles } from './LogsTableActiveFields';\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\nimport { FieldNameMeta } from './LogsTableWrap';\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // ...sort by type and alphabetically\n    if (la != null && lb != null) {\n      return (\n        Number(lb.type === 'TIME_FIELD') - Number(la.type === 'TIME_FIELD') ||\n        Number(lb.type === 'BODY_FIELD') - Number(la.type === 'BODY_FIELD') ||\n        collator.compare(a, b)\n      );\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableAvailableFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n}): JSX.Element => {\n  const { labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n  if (labelKeys.length) {\n    // Otherwise show list with a hardcoded order\n    return (\n      <div className={styles.columnWrapper}>\n        {labelKeys.sort(sortLabels(labels)).map((labelName, index) => (\n          <div\n            key={labelName}\n            className={styles.wrap}\n            title={t(\n              'explore.logs-table-available-fields.title-label-percentage',\n              '{{labelName}} appears in {{percentage}}% of log lines',\n              { labelName, percentage: labels[labelName]?.percentOfLinesWithLabel }\n            )}\n          >\n            <LogsTableNavField\n              showCount={true}\n              label={labelName}\n              onChange={() => toggleColumn(labelName)}\n              labels={labels}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableActiveFields } from './LogsTableActiveFields';\nimport { LogsTableAvailableFields } from './LogsTableAvailableFields';\nimport { FieldNameMeta } from './LogsTableWrap';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sidebarWrap: css({\n      overflowY: 'scroll',\n      height: 'calc(100% - 50px)',\n      /* Hide scrollbar for Chrome, Safari, and Opera */\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n      /* Hide scrollbar for Firefox */\n      scrollbarWidth: 'none',\n    }),\n    columnHeaderButton: css({\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n    }),\n    columnHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: theme.typography.h6.fontSize,\n      background: theme.colors.background.secondary,\n      position: 'sticky',\n      top: 0,\n      left: 0,\n      paddingTop: theme.spacing(0.75),\n      paddingRight: theme.spacing(0.75),\n      paddingBottom: theme.spacing(0.75),\n      paddingLeft: theme.spacing(1.5),\n      zIndex: 3,\n      marginBottom: theme.spacing(2),\n    }),\n  };\n}\n\nexport const LogsTableMultiSelect = (props: {\n  toggleColumn: (columnName: string) => void;\n  filteredColumnsWithMeta: Record<string, FieldNameMeta> | undefined;\n  columnsWithMeta: Record<string, FieldNameMeta>;\n  clear: () => void;\n  reorderColumn: (oldIndex: number, newIndex: number) => void;\n}) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.sidebarWrap}>\n      {/* Sidebar columns */}\n      <>\n        <div className={styles.columnHeader}>\n          <Trans i18nKey=\"explore.logs-table-multi-select.selected-fields\">Selected fields</Trans>\n          <button onClick={props.clear} className={styles.columnHeaderButton}>\n            <Trans i18nKey=\"explore.logs-table-multi-select.reset\">Reset</Trans>\n          </button>\n        </div>\n        <LogsTableActiveFields\n          reorderColumn={props.reorderColumn}\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => props.columnsWithMeta[value]?.active ?? false}\n          id={'selected-fields'}\n        />\n\n        <div className={styles.columnHeader}>\n          <Trans i18nKey=\"explore.logs-table-multi-select.fields\">Fields</Trans>\n        </div>\n        <LogsTableAvailableFields\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => !props.columnsWithMeta[value]?.active}\n        />\n      </>\n    </div>\n  );\n};\n","import uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, dispatcher: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for hilighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    dispatcher([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    dispatcher([[], []]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","import { css } from '@emotion/css';\nimport { Resizable, ResizeCallback } from 're-resizable';\nimport { useCallback, useEffect, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  DataFrame,\n  ExploreLogsPanelState,\n  GrafanaTheme2,\n  Labels,\n  LogsSortOrder,\n  SelectableValue,\n  SplitOpen,\n  TimeRange,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { InlineField, Select, Themeable2 } from '@grafana/ui';\n\nimport { parseLogsFrame } from '../../logs/logsFrame';\n\nimport { LogsColumnSearch } from './LogsColumnSearch';\nimport { LogsTable } from './LogsTable';\nimport { LogsTableMultiSelect } from './LogsTableMultiSelect';\nimport { fuzzySearch } from './utils/uFuzzy';\n\ninterface Props extends Themeable2 {\n  logsFrames: DataFrame[];\n  width: number;\n  timeZone: string;\n  splitOpen: SplitOpen;\n  range: TimeRange;\n  logsSortOrder: LogsSortOrder;\n  panelState: ExploreLogsPanelState | undefined;\n  updatePanelState: (panelState: Partial<ExploreLogsPanelState>) => void;\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  datasourceType?: string;\n}\n\ntype ActiveFieldMeta = {\n  active: false;\n  index: undefined; // if undefined the column is not selected\n};\n\ntype InactiveFieldMeta = {\n  active: true;\n  index: number; // if undefined the column is not selected\n};\n\ntype GenericMeta = {\n  percentOfLinesWithLabel: number;\n  type?: 'BODY_FIELD' | 'TIME_FIELD';\n};\n\nexport type FieldNameMeta = (InactiveFieldMeta | ActiveFieldMeta) & GenericMeta;\n\ntype FieldName = string;\ntype FieldNameMetaStore = Record<FieldName, FieldNameMeta>;\n\nexport function LogsTableWrap(props: Props) {\n  const { logsFrames, updatePanelState, panelState } = props;\n  const propsColumns = panelState?.columns;\n  // Save the normalized cardinality of each label\n  const [columnsWithMeta, setColumnsWithMeta] = useState<FieldNameMetaStore | undefined>(undefined);\n\n  // Filtered copy of columnsWithMeta that only includes matching results\n  const [filteredColumnsWithMeta, setFilteredColumnsWithMeta] = useState<FieldNameMetaStore | undefined>(undefined);\n  const [searchValue, setSearchValue] = useState<string>('');\n\n  const height = getLogsTableHeight();\n  const panelStateRefId = props?.panelState?.refId;\n\n  // The current dataFrame containing the refId of the current query\n  const [currentDataFrame, setCurrentDataFrame] = useState<DataFrame>(\n    logsFrames.find((f) => f.refId === panelStateRefId) ?? logsFrames[0]\n  );\n\n  const getColumnsFromProps = useCallback(\n    (fieldNames: FieldNameMetaStore) => {\n      const previouslySelected = props.panelState?.columns;\n      if (previouslySelected) {\n        Object.values(previouslySelected).forEach((key, index) => {\n          if (fieldNames[key]) {\n            fieldNames[key].active = true;\n            fieldNames[key].index = index;\n          }\n        });\n      }\n      return fieldNames;\n    },\n    [props.panelState?.columns]\n  );\n  const logsFrame = parseLogsFrame(currentDataFrame);\n\n  useEffect(() => {\n    if (logsFrame?.timeField.name && logsFrame?.bodyField.name && !propsColumns) {\n      const defaultColumns = { 0: logsFrame?.timeField.name ?? '', 1: logsFrame?.bodyField.name ?? '' };\n      updatePanelState({\n        columns: Object.values(defaultColumns),\n        visualisationType: 'table',\n        labelFieldName: logsFrame?.getLabelFieldName() ?? undefined,\n      });\n    }\n  }, [logsFrame, propsColumns, updatePanelState]);\n\n  /**\n   * When logs frame updates (e.g. query|range changes), we need to set the selected frame to state\n   */\n  useEffect(() => {\n    const newFrame = logsFrames.find((f) => f.refId === panelStateRefId) ?? logsFrames[0];\n    if (newFrame) {\n      setCurrentDataFrame(newFrame);\n    }\n  }, [logsFrames, panelStateRefId]);\n\n  /**\n   * Keeps the filteredColumnsWithMeta state in sync with the columnsWithMeta state,\n   * which can be updated by explore browser history state changes\n   * This prevents an edge case bug where the user is navigating while a search is open.\n   */\n  useEffect(() => {\n    if (!columnsWithMeta || !filteredColumnsWithMeta) {\n      return;\n    }\n    let newFiltered = { ...filteredColumnsWithMeta };\n    let flag = false;\n    Object.keys(columnsWithMeta).forEach((key) => {\n      if (newFiltered[key] && newFiltered[key].active !== columnsWithMeta[key].active) {\n        newFiltered[key] = columnsWithMeta[key];\n        flag = true;\n      }\n    });\n    if (flag) {\n      setFilteredColumnsWithMeta(newFiltered);\n    }\n  }, [columnsWithMeta, filteredColumnsWithMeta]);\n\n  /**\n   * when the query results change, we need to update the columnsWithMeta state\n   * and reset any local search state\n   *\n   * This will also find all the unique labels, and calculate how many log lines have each label into the labelCardinality Map\n   * Then it normalizes the counts\n   *\n   */\n  useEffect(() => {\n    // If the data frame is empty, there's nothing to viz, it could mean the user has unselected all columns\n    if (!currentDataFrame.length) {\n      return;\n    }\n    const numberOfLogLines = currentDataFrame ? currentDataFrame.length : 0;\n    const logsFrame = parseLogsFrame(currentDataFrame);\n    const labels = logsFrame?.getLogFrameLabelsAsLabels();\n\n    const otherFields = [];\n\n    if (logsFrame) {\n      otherFields.push(...logsFrame.extraFields.filter((field) => !field?.config?.custom?.hidden));\n    }\n    if (logsFrame?.severityField) {\n      otherFields.push(logsFrame?.severityField);\n    }\n    if (logsFrame?.bodyField) {\n      otherFields.push(logsFrame?.bodyField);\n    }\n    if (logsFrame?.timeField) {\n      otherFields.push(logsFrame?.timeField);\n    }\n\n    // Use a map to dedupe labels and count their occurrences in the logs\n    const labelCardinality = new Map<FieldName, FieldNameMeta>();\n\n    // What the label state will look like\n    let pendingLabelState: FieldNameMetaStore = {};\n\n    // If we have labels and log lines\n    if (labels?.length && numberOfLogLines) {\n      // Iterate through all of Labels\n      labels.forEach((labels: Labels) => {\n        const labelsArray = Object.keys(labels);\n        // Iterate through the label values\n        labelsArray.forEach((label) => {\n          // If it's already in our map, increment the count\n          if (labelCardinality.has(label)) {\n            const value = labelCardinality.get(label);\n            if (value) {\n              if (value?.active) {\n                labelCardinality.set(label, {\n                  percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                  active: true,\n                  index: value.index,\n                });\n              } else {\n                labelCardinality.set(label, {\n                  percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                  active: false,\n                  index: undefined,\n                });\n              }\n            }\n            // Otherwise add it\n          } else {\n            labelCardinality.set(label, { percentOfLinesWithLabel: 1, active: false, index: undefined });\n          }\n        });\n      });\n\n      // Converting the map to an object\n      pendingLabelState = Object.fromEntries(labelCardinality);\n\n      // Convert count to percent of log lines\n      Object.keys(pendingLabelState).forEach((key) => {\n        pendingLabelState[key].percentOfLinesWithLabel = normalize(\n          pendingLabelState[key].percentOfLinesWithLabel,\n          numberOfLogLines\n        );\n      });\n    }\n\n    // Normalize the other fields\n    otherFields.forEach((field) => {\n      const isActive = pendingLabelState[field.name]?.active;\n      const index = pendingLabelState[field.name]?.index;\n      if (isActive && index !== undefined) {\n        pendingLabelState[field.name] = {\n          percentOfLinesWithLabel: normalize(\n            field.values.filter((value) => value !== null && value !== undefined).length,\n            numberOfLogLines\n          ),\n          active: true,\n          index: index,\n        };\n      } else {\n        pendingLabelState[field.name] = {\n          percentOfLinesWithLabel: normalize(\n            field.values.filter((value) => value !== null && value !== undefined).length,\n            numberOfLogLines\n          ),\n          active: false,\n          index: undefined,\n        };\n      }\n    });\n\n    pendingLabelState = getColumnsFromProps(pendingLabelState);\n\n    // Get all active columns\n    const active = Object.keys(pendingLabelState).filter((key) => pendingLabelState[key].active);\n\n    // If nothing is selected, then select the default columns\n    if (active.length === 0) {\n      if (logsFrame?.bodyField?.name) {\n        pendingLabelState[logsFrame.bodyField.name].active = true;\n      }\n      if (logsFrame?.timeField?.name) {\n        pendingLabelState[logsFrame.timeField.name].active = true;\n      }\n    }\n\n    if (logsFrame?.bodyField?.name && logsFrame?.timeField?.name) {\n      pendingLabelState[logsFrame.bodyField.name].type = 'BODY_FIELD';\n      pendingLabelState[logsFrame.timeField.name].type = 'TIME_FIELD';\n    }\n\n    setColumnsWithMeta(pendingLabelState);\n\n    // The panel state is updated when the user interacts with the multi-select sidebar\n  }, [currentDataFrame, getColumnsFromProps]);\n\n  const [sidebarWidth, setSidebarWidth] = useState(220);\n  const tableWidth = props.width - sidebarWidth;\n\n  if (!columnsWithMeta) {\n    return null;\n  }\n\n  function columnFilterEvent(columnName: string) {\n    if (columnsWithMeta) {\n      const newState = !columnsWithMeta[columnName]?.active;\n      const priorActiveCount = Object.keys(columnsWithMeta).filter((column) => columnsWithMeta[column]?.active)?.length;\n      const event = {\n        columnAction: newState ? 'add' : 'remove',\n        columnCount: newState ? priorActiveCount + 1 : priorActiveCount - 1,\n        datasourceType: props.datasourceType,\n      };\n      reportInteraction('grafana_explore_logs_table_column_filter_clicked', event);\n    }\n  }\n\n  function searchFilterEvent(searchResultCount: number) {\n    reportInteraction('grafana_explore_logs_table_text_search_result_count', {\n      resultCount: searchResultCount,\n      datasourceType: props.datasourceType ?? 'unknown',\n    });\n  }\n\n  const clearSelection = () => {\n    const pendingLabelState = { ...columnsWithMeta };\n    let index = 0;\n    Object.keys(pendingLabelState).forEach((key) => {\n      const isDefaultField = !!pendingLabelState[key].type;\n      // after reset the only active fields are the special time and body fields\n      pendingLabelState[key].active = isDefaultField;\n      // reset the index\n      pendingLabelState[key].index = isDefaultField ? index++ : undefined;\n    });\n    setColumnsWithMeta(pendingLabelState);\n  };\n\n  const reorderColumn = (sourceIndex: number, destinationIndex: number) => {\n    if (sourceIndex === destinationIndex) {\n      return;\n    }\n\n    const pendingLabelState = { ...columnsWithMeta };\n\n    const keys = Object.keys(pendingLabelState)\n      .filter((key) => pendingLabelState[key].active)\n      .map((key) => ({\n        fieldName: key,\n        index: pendingLabelState[key].index ?? 0,\n      }))\n      .sort((a, b) => a.index - b.index);\n\n    const [source] = keys.splice(sourceIndex, 1);\n    keys.splice(destinationIndex, 0, source);\n\n    keys.forEach((key, index) => {\n      pendingLabelState[key.fieldName].index = index;\n    });\n\n    // Set local state\n    setColumnsWithMeta(pendingLabelState);\n\n    // Sync the explore state\n    updateExploreState(pendingLabelState);\n  };\n\n  function updateExploreState(pendingLabelState: FieldNameMetaStore) {\n    // Get all active columns and sort by index\n    const newColumnsArray = Object.keys(pendingLabelState)\n      // Only include active filters\n      .filter((key) => pendingLabelState[key]?.active)\n      .sort((a, b) => {\n        const pa = pendingLabelState[a];\n        const pb = pendingLabelState[b];\n        if (pa.index !== undefined && pb.index !== undefined) {\n          return pa.index - pb.index; // sort by index\n        }\n        return 0;\n      });\n\n    const newColumns: Record<number, string> = Object.assign(\n      {},\n      // Get the keys of the object as an array\n      newColumnsArray\n    );\n\n    const defaultColumns = { 0: logsFrame?.timeField.name ?? '', 1: logsFrame?.bodyField.name ?? '' };\n    const newPanelState: ExploreLogsPanelState = {\n      ...props.panelState,\n      // URL format requires our array of values be an object, so we convert it using object.assign\n      columns: Object.keys(newColumns).length ? newColumns : defaultColumns,\n      refId: currentDataFrame.refId,\n      visualisationType: 'table',\n      labelFieldName: logsFrame?.getLabelFieldName() ?? undefined,\n    };\n\n    // Update url state\n    updatePanelState(newPanelState);\n  }\n\n  // Toggle a column on or off when the user interacts with an element in the multi-select sidebar\n  const toggleColumn = (columnName: FieldName) => {\n    if (!columnsWithMeta || !(columnName in columnsWithMeta)) {\n      console.warn('failed to get column', columnsWithMeta);\n      return;\n    }\n\n    const length = Object.keys(columnsWithMeta).filter((c) => columnsWithMeta[c].active).length;\n    const isActive = !columnsWithMeta[columnName].active ? true : undefined;\n\n    let pendingLabelState: FieldNameMetaStore;\n    if (isActive) {\n      pendingLabelState = {\n        ...columnsWithMeta,\n        [columnName]: {\n          ...columnsWithMeta[columnName],\n          active: isActive,\n          index: length,\n        },\n      };\n    } else {\n      pendingLabelState = {\n        ...columnsWithMeta,\n        [columnName]: {\n          ...columnsWithMeta[columnName],\n          active: false,\n          index: undefined,\n        },\n      };\n    }\n\n    // Analytics\n    columnFilterEvent(columnName);\n\n    // Set local state\n    setColumnsWithMeta(pendingLabelState);\n\n    // If user is currently filtering, update filtered state\n    if (filteredColumnsWithMeta) {\n      const active = !filteredColumnsWithMeta[columnName]?.active;\n      let pendingFilteredLabelState: FieldNameMetaStore;\n      if (active) {\n        pendingFilteredLabelState = {\n          ...filteredColumnsWithMeta,\n          [columnName]: {\n            ...filteredColumnsWithMeta[columnName],\n            active: active,\n            index: length,\n          },\n        };\n      } else {\n        pendingFilteredLabelState = {\n          ...filteredColumnsWithMeta,\n          [columnName]: {\n            ...filteredColumnsWithMeta[columnName],\n            active: false,\n            index: undefined,\n          },\n        };\n      }\n\n      setFilteredColumnsWithMeta(pendingFilteredLabelState);\n    }\n\n    updateExploreState(pendingLabelState);\n  };\n\n  // uFuzzy search dispatcher, adds any matches to the local state\n  const dispatcher = (data: string[][]) => {\n    const matches = data[0];\n    let newColumnsWithMeta: FieldNameMetaStore = {};\n    let numberOfResults = 0;\n    matches.forEach((match) => {\n      if (match in columnsWithMeta) {\n        newColumnsWithMeta[match] = columnsWithMeta[match];\n        numberOfResults++;\n      }\n    });\n    setFilteredColumnsWithMeta(newColumnsWithMeta);\n    searchFilterEvent(numberOfResults);\n  };\n\n  // uFuzzy search\n  const search = (needle: string) => {\n    fuzzySearch(Object.keys(columnsWithMeta), needle, dispatcher);\n  };\n\n  // onChange handler for search input\n  const onSearchInputChange = (e: React.FormEvent<HTMLInputElement>) => {\n    const value = e.currentTarget?.value;\n    setSearchValue(value);\n    if (value) {\n      search(value);\n    } else {\n      // If the search input is empty, reset the local search state.\n      setFilteredColumnsWithMeta(undefined);\n    }\n  };\n\n  const onFrameSelectorChange = (value: SelectableValue<string>) => {\n    const matchingDataFrame = logsFrames.find((frame) => frame.refId === value.value);\n    if (matchingDataFrame) {\n      setCurrentDataFrame(logsFrames.find((frame) => frame.refId === value.value) ?? logsFrames[0]);\n    }\n    props.updatePanelState({ refId: value.value, labelFieldName: logsFrame?.getLabelFieldName() ?? undefined });\n  };\n\n  const styles = getStyles(props.theme, height, sidebarWidth);\n\n  const getOnResize: ResizeCallback = (event, direction, ref) => {\n    const newSidebarWidth = Number(ref.style.width.slice(0, -2));\n    if (!isNaN(newSidebarWidth)) {\n      setSidebarWidth(newSidebarWidth);\n    }\n  };\n\n  return (\n    <>\n      <div>\n        {logsFrames.length > 1 && (\n          <div>\n            <InlineField\n              label={t('explore.logs-table-wrap.label-select-query', 'Select query')}\n              htmlFor=\"explore_logs_table_frame_selector\"\n              labelWidth={22}\n              tooltip={t(\n                'explore.logs-table-wrap.tooltip-select-query-visualize-table',\n                'Select a query to visualize in the table'\n              )}\n            >\n              <Select\n                inputId={'explore_logs_table_frame_selector'}\n                aria-label={t('explore.logs-table-wrap.aria-label-select-query-by-name', 'Select query by name')}\n                value={currentDataFrame.refId}\n                options={logsFrames.map((frame) => {\n                  return {\n                    label: frame.refId,\n                    value: frame.refId,\n                  };\n                })}\n                onChange={onFrameSelectorChange}\n              />\n            </InlineField>\n          </div>\n        )}\n      </div>\n      <div className={styles.wrapper}>\n        <Resizable\n          enable={{\n            right: true,\n          }}\n          handleClasses={{ right: styles.rzHandle }}\n          onResize={getOnResize}\n        >\n          <section className={styles.sidebar}>\n            <LogsColumnSearch value={searchValue} onChange={onSearchInputChange} />\n            <LogsTableMultiSelect\n              reorderColumn={reorderColumn}\n              toggleColumn={toggleColumn}\n              filteredColumnsWithMeta={filteredColumnsWithMeta}\n              columnsWithMeta={columnsWithMeta}\n              clear={clearSelection}\n            />\n          </section>\n        </Resizable>\n        <LogsTable\n          logsFrame={logsFrame}\n          onClickFilterLabel={props.onClickFilterLabel}\n          onClickFilterOutLabel={props.onClickFilterOutLabel}\n          logsSortOrder={props.logsSortOrder}\n          range={props.range}\n          splitOpen={props.splitOpen}\n          timeZone={props.timeZone}\n          width={tableWidth}\n          dataFrame={currentDataFrame}\n          columnsWithMeta={columnsWithMeta}\n          height={height}\n        />\n      </div>\n    </>\n  );\n}\n\nconst normalize = (value: number, total: number): number => {\n  return Math.ceil((100 * value) / total);\n};\n\nfunction getStyles(theme: GrafanaTheme2, height: number, width: number) {\n  return {\n    wrapper: css({\n      display: 'flex',\n    }),\n    sidebar: css({\n      height: height,\n      fontSize: theme.typography.pxToRem(11),\n      overflowY: 'hidden',\n      width: width,\n      paddingRight: theme.spacing(3),\n    }),\n    rzHandle: css({\n      background: theme.colors.secondary.main,\n      [theme.transitions.handleMotion('no-preference', 'reduce')]: {\n        transition: '0.3s background ease-in-out',\n      },\n      position: 'relative',\n      height: '50% !important',\n      width: `${theme.spacing(1)} !important`,\n      top: '25% !important',\n      right: `${theme.spacing(1)} !important`,\n      cursor: 'grab',\n      borderRadius: theme.shape.radius.pill,\n      ['&:hover']: {\n        background: theme.colors.secondary.shade,\n      },\n    }),\n  };\n}\n\nexport const getLogsTableHeight = () => {\n  // Instead of making the height of the table based on the content (like in the table panel itself), let's try to use the vertical space that is available.\n  // Since this table is in explore, we can expect the user to be running multiple queries that return disparate numbers of rows and labels in the same session\n  // Also changing the height of the table between queries can be and cause content to jump, so we'll set a minimum height of 500px, and a max based on the innerHeight\n  // Ideally the table container should always be able to fit in the users viewport without needing to scroll\n  return Math.max(window.innerHeight - 500, 500);\n};\n","import { css } from '@emotion/css';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { GrafanaTheme2, LogRowModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Menu, useStyles2 } from '@grafana/ui';\n\nimport { copyText } from '../../logs/utils';\n\ninterface PopoverMenuProps {\n  selection: string;\n  x: number;\n  y: number;\n  onClickFilterString?: (value: string, refId?: string) => void;\n  onClickFilterOutString?: (value: string, refId?: string) => void;\n  onDisable: () => void;\n  row: LogRowModel;\n  close: () => void;\n}\n\nexport const PopoverMenu = ({\n  x,\n  y,\n  onClickFilterString,\n  onClickFilterOutString,\n  selection,\n  row,\n  close,\n  ...props\n}: PopoverMenuProps) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    function handleEscape(e: KeyboardEvent) {\n      if (e.key === 'Escape') {\n        close();\n      }\n    }\n    document.addEventListener('keyup', handleEscape);\n\n    return () => {\n      document.removeEventListener('keyup', handleEscape);\n    };\n  }, [close]);\n\n  const onDisable = useCallback(() => {\n    track('popover_menu_disabled', selection.length, row.datasourceType);\n    props.onDisable();\n  }, [props, row.datasourceType, selection.length]);\n\n  const supported = onClickFilterString || onClickFilterOutString;\n\n  if (!supported) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className={styles.menu} style={{ top: y, left: x }}>\n        <Menu ref={containerRef}>\n          <Menu.Item\n            label={t('logs.popover-menu.copy', 'Copy selection')}\n            onClick={() => {\n              copyText(selection, containerRef);\n              close();\n              track('copy', selection.length, row.datasourceType);\n            }}\n          />\n          {onClickFilterString && (\n            <Menu.Item\n              label={t('logs.popover-menu.line-contains', 'Add as line contains filter')}\n              onClick={() => {\n                onClickFilterString(selection, row.dataFrame.refId);\n                close();\n                track('line_contains', selection.length, row.datasourceType);\n              }}\n            />\n          )}\n          {onClickFilterOutString && (\n            <Menu.Item\n              label={t('logs.popover-menu.line-contains-not', 'Add as line does not contain filter')}\n              onClick={() => {\n                onClickFilterOutString(selection, row.dataFrame.refId);\n                close();\n                track('line_does_not_contain', selection.length, row.datasourceType);\n              }}\n            />\n          )}\n          <Menu.Divider />\n          <Menu.Item label={t('logs.popover-menu.disable-menu', 'Disable menu')} onClick={onDisable} />\n        </Menu>\n      </div>\n    </>\n  );\n};\n\nfunction track(action: string, selectionLength: number, dataSourceType: string | undefined) {\n  reportInteraction(`grafana_explore_logs_popover_menu`, {\n    action,\n    selectionLength: selectionLength,\n    datasourceType: dataSourceType || 'unknown',\n  });\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  menu: css({\n    position: 'fixed',\n    zIndex: theme.zIndex.modal,\n  }),\n});\n","export const SETTINGS_KEYS = {\n  showLabels: 'grafana.explore.logs.showLabels',\n  showTime: 'grafana.explore.logs.showTime',\n  wrapLogMessage: 'grafana.explore.logs.wrapLogMessage',\n  prettifyLogMessage: 'grafana.explore.logs.prettifyLogMessage',\n  logsSortOrder: 'grafana.explore.logs.sortOrder',\n  logContextWrapLogMessage: 'grafana.explore.logs.logContext.wrapLogMessage',\n  commonLabels: 'grafana.explore.logs.commonLabels',\n};\n\nexport const SETTING_KEY_ROOT = 'grafana.explore.logs';\n\nexport const visualisationTypeKey = 'grafana.explore.logs.visualisationType';\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { EventBusSrv, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableWrap } from '../../explore/Logs/LogsTableWrap';\n\nimport { LogRowsComponentProps } from './ControlledLogRows';\nimport { useLogListContext } from './panel/LogListContext';\nimport { LogListControls } from './panel/LogListControls';\n\nexport const ControlledLogsTable = ({\n  loading,\n  loadMoreLogs,\n  deduplicatedRows = [],\n  range,\n  splitOpen,\n  onClickFilterLabel,\n  onClickFilterOutLabel,\n  panelState,\n  datasourceType,\n  updatePanelState,\n  width,\n  logsTableFrames,\n  visualisationType,\n  ...rest\n}: LogRowsComponentProps) => {\n  const { sortOrder } = useLogListContext();\n  const eventBus = useMemo(() => new EventBusSrv(), []);\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  if (!splitOpen || !width || !updatePanelState) {\n    console.error('<ControlledLogsTable>: Missing required props.');\n    return;\n  }\n\n  return (\n    <div className={styles.logRowsContainer}>\n      <LogListControls eventBus={eventBus} visualisationType={visualisationType} />\n      <div className={styles.logRows} data-testid=\"logRowsTable\">\n        {/* Width should be full width minus logs navigation and padding */}\n        <LogsTableWrap\n          logsSortOrder={sortOrder}\n          range={range}\n          splitOpen={splitOpen}\n          timeZone={rest.timeZone}\n          width={width - 45}\n          logsFrames={logsTableFrames ?? []}\n          onClickFilterLabel={onClickFilterLabel}\n          onClickFilterOutLabel={onClickFilterOutLabel}\n          panelState={panelState}\n          theme={theme}\n          updatePanelState={updatePanelState}\n          datasourceType={datasourceType}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    logRows: css({\n      overflowY: 'visible',\n      width: '100%',\n    }),\n    logRowsContainer: css({\n      display: 'flex',\n      flexDirection: 'row-reverse',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { useEffect, useMemo, useRef, forwardRef, useImperativeHandle, useCallback } from 'react';\n\nimport {\n  AbsoluteTimeRange,\n  CoreApp,\n  DataFrame,\n  EventBusSrv,\n  ExploreLogsPanelState,\n  LogLevel,\n  LogsMetaItem,\n  LogsSortOrder,\n  SplitOpen,\n  TimeRange,\n} from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { LogsVisualisationType } from '../../explore/Logs/Logs';\n\nimport { ControlledLogsTable } from './ControlledLogsTable';\nimport { InfiniteScroll } from './InfiniteScroll';\nimport { LogRows, Props } from './LogRows';\nimport { LogListControlOptions } from './panel/LogList';\nimport { LogListContextProvider, useLogListContext } from './panel/LogListContext';\nimport { LogListControls } from './panel/LogListControls';\nimport { ScrollToLogsEvent } from './panel/virtualization';\n\nexport interface ControlledLogRowsProps extends Omit<Props, 'scrollElement'> {\n  hasUnescapedContent?: boolean;\n  loading: boolean;\n  logsMeta?: LogsMetaItem[];\n  loadMoreLogs?: (range: AbsoluteTimeRange) => void;\n  logOptionsStorageKey?: string;\n  onLogOptionsChange?: (option: keyof LogListControlOptions, value: string | boolean | string[]) => void;\n  range: TimeRange;\n  filterLevels?: LogLevel[];\n\n  /** Props added for Table **/\n  visualisationType: LogsVisualisationType;\n  splitOpen?: SplitOpen;\n  panelState?: ExploreLogsPanelState;\n  updatePanelState?: (panelState: Partial<ExploreLogsPanelState>) => void;\n  datasourceType?: string;\n  width?: number;\n  logsTableFrames?: DataFrame[];\n}\n\nexport type LogRowsComponentProps = Omit<\n  ControlledLogRowsProps,\n  | 'app'\n  | 'dedupStrategy'\n  | 'filterLevels'\n  | 'showLabels'\n  | 'showTime'\n  | 'logsSortOrder'\n  | 'prettifyLogMessage'\n  | 'wrapLogMessage'\n>;\n\nexport const ControlledLogRows = forwardRef<HTMLDivElement | null, ControlledLogRowsProps>(\n  (\n    {\n      deduplicatedRows,\n      dedupStrategy,\n      filterLevels,\n      hasUnescapedContent,\n      showLabels,\n      showTime,\n      logsMeta,\n      logOptionsStorageKey,\n      logsSortOrder,\n      prettifyLogMessage,\n      onLogOptionsChange,\n      wrapLogMessage,\n      ...rest\n    }: ControlledLogRowsProps,\n    ref\n  ) => {\n    return (\n      <LogListContextProvider\n        app={rest.app || CoreApp.Unknown}\n        displayedFields={[]}\n        dedupStrategy={dedupStrategy}\n        enableLogDetails={false}\n        filterLevels={filterLevels}\n        fontSize=\"default\"\n        hasUnescapedContent={hasUnescapedContent}\n        logOptionsStorageKey={logOptionsStorageKey}\n        logs={deduplicatedRows ?? []}\n        logsMeta={logsMeta}\n        prettifyJSON={prettifyLogMessage}\n        showControls\n        showTime={showTime}\n        showUniqueLabels={showLabels}\n        sortOrder={logsSortOrder || LogsSortOrder.Descending}\n        onLogOptionsChange={onLogOptionsChange}\n        wrapLogMessage={wrapLogMessage}\n      >\n        {rest.visualisationType === 'logs' && (\n          <LogRowsComponent ref={ref} {...rest} deduplicatedRows={deduplicatedRows} />\n        )}\n        {rest.visualisationType === 'table' && rest.updatePanelState && <ControlledLogsTable {...rest} />}\n      </LogListContextProvider>\n    );\n  }\n);\n\nControlledLogRows.displayName = 'ControlledLogRows';\n\nconst LogRowsComponent = forwardRef<HTMLDivElement | null, LogRowsComponentProps>(\n  (\n    {\n      loading,\n      loadMoreLogs,\n      deduplicatedRows = [],\n      range,\n      scrollIntoView: scrollIntoViewProp,\n      ...rest\n    }: LogRowsComponentProps,\n    ref\n  ) => {\n    const {\n      app,\n      dedupStrategy,\n      filterLevels,\n      forceEscape,\n      prettifyJSON,\n      sortOrder,\n      showTime,\n      showUniqueLabels,\n      wrapLogMessage,\n    } = useLogListContext();\n    const eventBus = useMemo(() => new EventBusSrv(), []);\n    const scrollElementRef = useRef<HTMLDivElement | null>(null);\n\n    useEffect(() => {\n      const subscription = eventBus.subscribe(ScrollToLogsEvent, (e: ScrollToLogsEvent) =>\n        handleScrollToEvent(e, scrollElementRef.current)\n      );\n      return () => subscription.unsubscribe();\n    }, [eventBus]);\n\n    useImperativeHandle<HTMLDivElement | null, HTMLDivElement | null>(ref, () => scrollElementRef.current);\n\n    const filteredLogs = useMemo(\n      () =>\n        filterLevels.length === 0\n          ? deduplicatedRows\n          : deduplicatedRows.filter((log) => filterLevels.includes(log.logLevel)),\n      [filterLevels, deduplicatedRows]\n    );\n\n    const scrollElementClassName = useMemo(() => {\n      if (ref) {\n        return styles.forwardedScrollableLogRows;\n      }\n      return config.featureToggles.logsInfiniteScrolling ? styles.scrollableLogRows : styles.logRows;\n    }, [ref]);\n\n    const scrollIntoView = useCallback(\n      (element: HTMLElement) => {\n        if (scrollIntoViewProp) {\n          scrollIntoViewProp(element);\n          return;\n        }\n        if (scrollElementRef.current) {\n          scrollElementRef.current.scroll({\n            behavior: 'smooth',\n            top: scrollElementRef.current.scrollTop + element.getBoundingClientRect().top - window.innerHeight / 2,\n          });\n        }\n      },\n      [scrollIntoViewProp]\n    );\n\n    return (\n      <div className={styles.logRowsContainer}>\n        <LogListControls eventBus={eventBus} />\n        <div ref={scrollElementRef} className={scrollElementClassName}>\n          <InfiniteScroll\n            loading={loading}\n            loadMoreLogs={loadMoreLogs}\n            range={range}\n            timeZone={rest.timeZone}\n            rows={filteredLogs}\n            scrollElement={scrollElementRef.current}\n            sortOrder={sortOrder}\n          >\n            <LogRows\n              {...rest}\n              app={app}\n              dedupStrategy={dedupStrategy}\n              deduplicatedRows={filteredLogs}\n              forceEscape={forceEscape}\n              logRows={filteredLogs}\n              logsSortOrder={sortOrder}\n              scrollElement={scrollElementRef.current}\n              prettifyLogMessage={Boolean(prettifyJSON)}\n              scrollIntoView={scrollIntoView}\n              showLabels={Boolean(showUniqueLabels)}\n              showTime={showTime}\n              wrapLogMessage={wrapLogMessage}\n            />\n          </InfiniteScroll>\n        </div>\n      </div>\n    );\n  }\n);\n\nLogRowsComponent.displayName = 'LogRowsComponent';\n\nfunction handleScrollToEvent(event: ScrollToLogsEvent, scrollElement: HTMLDivElement | null) {\n  if (event.payload.scrollTo === 'top') {\n    scrollElement?.scrollTo(0, 0);\n  } else if (scrollElement) {\n    scrollElement.scrollTo(0, scrollElement.scrollHeight);\n  }\n}\n\nconst styles = {\n  scrollableLogRows: css({\n    overflowY: 'auto',\n    width: '100%',\n    maxHeight: '80vh',\n  }),\n  forwardedScrollableLogRows: css({\n    overflowY: 'auto',\n    width: '100%',\n    maxHeight: '100%',\n  }),\n  logRows: css({\n    overflowX: 'scroll',\n    overflowY: 'visible',\n    width: '100%',\n  }),\n  logRowsContainer: css({\n    display: 'flex',\n    flexDirection: 'row-reverse',\n    height: '100%',\n  }),\n};\n","import { css } from '@emotion/css';\nimport { ReactNode, MutableRefObject, useCallback, useEffect, useRef, useState } from 'react';\n\nimport { AbsoluteTimeRange, CoreApp, LogRowModel, TimeRange, rangeUtil } from '@grafana/data';\n// import { convertRawToRange, isRelativeTime, isRelativeTimeRange } from '@grafana/data/internal';\nimport { Trans } from '@grafana/i18n';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { LogsSortOrder, TimeZone } from '@grafana/schema';\nimport { Button, Icon } from '@grafana/ui';\n\nimport { LoadingIndicator } from './LoadingIndicator';\n\nexport type Props = {\n  app?: CoreApp;\n  children: ReactNode;\n  loading: boolean;\n  loadMoreLogs?: (range: AbsoluteTimeRange) => void;\n  range: TimeRange;\n  rows: LogRowModel[];\n  scrollElement: HTMLDivElement | null;\n  sortOrder: LogsSortOrder;\n  timeZone: TimeZone;\n  topScrollEnabled?: boolean;\n};\n\nexport const InfiniteScroll = ({\n  app,\n  children,\n  loading,\n  loadMoreLogs,\n  range,\n  rows,\n  scrollElement,\n  sortOrder,\n  timeZone,\n  topScrollEnabled = false,\n}: Props) => {\n  const [upperOutOfRange, setUpperOutOfRange] = useState(false);\n  const [lowerOutOfRange, setLowerOutOfRange] = useState(false);\n  const [upperLoading, setUpperLoading] = useState(false);\n  const [lowerLoading, setLowerLoading] = useState(false);\n  const rowsRef = useRef<LogRowModel[]>(rows);\n  const lastScroll = useRef<number>(scrollElement?.scrollTop || 0);\n  const lastEvent = useRef<Event | WheelEvent | null>(null);\n  const countRef = useRef(0);\n\n  // Reset messages when range/order/rows change\n  useEffect(() => {\n    setUpperOutOfRange(false);\n    setLowerOutOfRange(false);\n  }, [range, rows, sortOrder]);\n\n  // Reset loading messages when loading stops\n  useEffect(() => {\n    if (!loading) {\n      setUpperLoading(false);\n      setLowerLoading(false);\n    }\n  }, [loading]);\n\n  // Ensure bottom loader visibility\n  useEffect(() => {\n    if (lowerLoading && scrollElement) {\n      scrollElement.scrollTo(0, scrollElement.scrollHeight - scrollElement.clientHeight);\n    }\n  }, [lowerLoading, scrollElement]);\n\n  // Request came back with no new past rows\n  useEffect(() => {\n    if (rows !== rowsRef.current && rows.length === rowsRef.current.length && (upperLoading || lowerLoading)) {\n      if (sortOrder === LogsSortOrder.Descending && lowerLoading) {\n        setLowerOutOfRange(true);\n      } else if (sortOrder === LogsSortOrder.Ascending && upperLoading) {\n        setUpperOutOfRange(true);\n      }\n    }\n    rowsRef.current = rows;\n  }, [lowerLoading, rows, sortOrder, upperLoading]);\n\n  useEffect(() => {\n    if (!scrollElement || !loadMoreLogs) {\n      return;\n    }\n\n    function handleScroll(event: Event | WheelEvent) {\n      if (!scrollElement || !loadMoreLogs || !rows.length || loading || !config.featureToggles.logsInfiniteScrolling) {\n        return;\n      }\n      const scrollDirection = shouldLoadMore(event, lastEvent.current, countRef, scrollElement, lastScroll.current);\n      lastEvent.current = event;\n      lastScroll.current = scrollElement.scrollTop;\n      if (scrollDirection === ScrollDirection.NoScroll) {\n        return;\n      }\n      event.stopImmediatePropagation();\n      if (scrollDirection === ScrollDirection.Top && topScrollEnabled) {\n        scrollTop();\n      } else if (scrollDirection === ScrollDirection.Bottom) {\n        scrollBottom();\n      }\n      lastEvent.current = null;\n    }\n\n    function scrollTop() {\n      const newRange = canScrollTop(getVisibleRange(rows), range, timeZone, sortOrder);\n      if (!newRange) {\n        setUpperOutOfRange(true);\n        return;\n      }\n      setUpperOutOfRange(false);\n      loadMoreLogs?.(newRange);\n      setUpperLoading(true);\n      reportInteraction('grafana_logs_infinite_scrolling', {\n        direction: 'top',\n        sort_order: sortOrder,\n      });\n    }\n\n    function scrollBottom() {\n      const newRange = canScrollBottom(getVisibleRange(rows), range, timeZone, sortOrder);\n      if (!newRange) {\n        setLowerOutOfRange(true);\n        return;\n      }\n      setLowerOutOfRange(false);\n      loadMoreLogs?.(newRange);\n      setLowerLoading(true);\n      reportInteraction('grafana_logs_infinite_scrolling', {\n        direction: 'bottom',\n        sort_order: sortOrder,\n      });\n    }\n\n    scrollElement.addEventListener('scroll', handleScroll);\n    scrollElement.addEventListener('wheel', handleScroll);\n\n    return () => {\n      scrollElement.removeEventListener('scroll', handleScroll);\n      scrollElement.removeEventListener('wheel', handleScroll);\n    };\n  }, [loadMoreLogs, loading, range, rows, scrollElement, sortOrder, timeZone, topScrollEnabled]);\n\n  // We allow \"now\" to move when using relative time, so we hide the message so it doesn't flash.\n  const hideTopMessage = sortOrder === LogsSortOrder.Descending && rangeUtil.isRelativeTime(range.raw.to);\n  const hideBottomMessage = sortOrder === LogsSortOrder.Ascending && rangeUtil.isRelativeTime(range.raw.to);\n\n  const loadOlderLogs = useCallback(() => {\n    //If we are not on the last page, use next page's range\n    reportInteraction('grafana_explore_logs_infinite_pagination_clicked', {\n      pageType: 'olderLogsButton',\n    });\n    const newRange = canScrollTop(getVisibleRange(rows), range, timeZone, sortOrder);\n    if (!newRange) {\n      setUpperOutOfRange(true);\n      return;\n    }\n    setUpperOutOfRange(false);\n    loadMoreLogs?.(newRange);\n    setUpperLoading(true);\n    scrollElement?.scroll({\n      behavior: 'auto',\n      top: 0,\n    });\n  }, [loadMoreLogs, range, rows, scrollElement, sortOrder, timeZone]);\n\n  return (\n    <>\n      {upperLoading && <LoadingIndicator adjective={sortOrder === LogsSortOrder.Descending ? 'newer' : 'older'} />}\n      {!hideTopMessage && upperOutOfRange && outOfRangeMessage}\n      {sortOrder === LogsSortOrder.Ascending && app === CoreApp.Explore && loadMoreLogs && (\n        <Button className={styles.navButton} variant=\"secondary\" onClick={loadOlderLogs} disabled={loading}>\n          <div className={styles.navButtonContent}>\n            <Icon name=\"angle-up\" size=\"lg\" />\n            <Trans i18nKey=\"logs.infinite-scroll.older-logs\">Older logs</Trans>\n          </div>\n        </Button>\n      )}\n      {children}\n      {!hideBottomMessage && lowerOutOfRange && outOfRangeMessage}\n      {lowerLoading && <LoadingIndicator adjective={sortOrder === LogsSortOrder.Descending ? 'older' : 'newer'} />}\n    </>\n  );\n};\n\nconst styles = {\n  messageContainer: css({\n    textAlign: 'center',\n    padding: 0.25,\n  }),\n  navButton: css({\n    width: '58px',\n    height: '68px',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    lineHeight: '1',\n    position: 'absolute',\n    top: 0,\n    right: -3,\n    zIndex: 1,\n  }),\n  navButtonContent: css({\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    whiteSpace: 'normal',\n  }),\n};\n\nconst outOfRangeMessage = (\n  <div className={styles.messageContainer} data-testid=\"end-of-range\">\n    <Trans i18nKey=\"logs.out-of-range-message.end-of-the-selected-time-range\">End of the selected time range.</Trans>\n  </div>\n);\n\nexport enum ScrollDirection {\n  Top = -1,\n  Bottom = 1,\n  NoScroll = 0,\n}\nexport function shouldLoadMore(\n  event: Event | WheelEvent,\n  lastEvent: Event | WheelEvent | null,\n  countRef: MutableRefObject<number>,\n  element: HTMLDivElement,\n  lastScroll: number\n): ScrollDirection {\n  // Disable behavior if there is no scroll\n  if (element.scrollHeight <= element.clientHeight) {\n    return ScrollDirection.NoScroll;\n  }\n  const delta = event instanceof WheelEvent ? event.deltaY : element.scrollTop - lastScroll;\n  if (delta === 0) {\n    return ScrollDirection.NoScroll;\n  }\n\n  const scrollDirection = delta < 0 ? ScrollDirection.Top : ScrollDirection.Bottom;\n  const diff =\n    scrollDirection === ScrollDirection.Top\n      ? element.scrollTop\n      : element.scrollHeight - element.scrollTop - element.clientHeight;\n\n  if (diff > 1) {\n    return ScrollDirection.NoScroll;\n  }\n\n  if (!lastEvent || shouldIgnoreChainOfEvents(event, lastEvent, countRef)) {\n    return ScrollDirection.NoScroll;\n  }\n\n  return scrollDirection;\n}\n\nfunction shouldIgnoreChainOfEvents(\n  event: Event | WheelEvent,\n  lastEvent: Event | WheelEvent,\n  countRef: MutableRefObject<number>\n) {\n  const deltaTime = event.timeStamp - lastEvent.timeStamp;\n  // Not a chain of events\n  if (deltaTime > 500) {\n    countRef.current = 0;\n    return false;\n  }\n  countRef.current++;\n  // Likely trackpad\n  if (deltaTime < 100) {\n    // User likely to want more results\n    if (countRef.current >= 180) {\n      countRef.current = 0;\n      return false;\n    }\n    return true;\n  }\n  // Likely mouse wheel\n  if (deltaTime < 400) {\n    // User likely to want more results\n    if (countRef.current >= 25) {\n      countRef.current = 0;\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function getVisibleRange(rows: LogRowModel[]) {\n  const firstTimeStamp = rows[0].timeEpochMs;\n  const lastTimeStamp = rows[rows.length - 1].timeEpochMs;\n\n  const visibleRange =\n    lastTimeStamp < firstTimeStamp\n      ? { from: lastTimeStamp, to: firstTimeStamp }\n      : { from: firstTimeStamp, to: lastTimeStamp };\n\n  return visibleRange;\n}\n\nfunction getPrevRange(visibleRange: AbsoluteTimeRange, currentRange: TimeRange) {\n  return { from: currentRange.from.valueOf(), to: visibleRange.from };\n}\n\nfunction getNextRange(visibleRange: AbsoluteTimeRange, currentRange: TimeRange, timeZone: TimeZone) {\n  // When requesting new logs, update the current range if using relative time ranges.\n  currentRange = updateCurrentRange(currentRange, timeZone);\n  return { from: visibleRange.to, to: currentRange.to.valueOf() };\n}\n\nexport const SCROLLING_THRESHOLD = 1e3;\n\n// To get more logs, the difference between the visible range and the current range should be 1 second or more.\nfunction canScrollTop(\n  visibleRange: AbsoluteTimeRange,\n  currentRange: TimeRange,\n  timeZone: TimeZone,\n  sortOrder: LogsSortOrder\n): AbsoluteTimeRange | undefined {\n  if (sortOrder === LogsSortOrder.Descending) {\n    // When requesting new logs, update the current range if using relative time ranges.\n    currentRange = updateCurrentRange(currentRange, timeZone);\n    const canScroll = currentRange.to.valueOf() - visibleRange.to > SCROLLING_THRESHOLD;\n    return canScroll ? getNextRange(visibleRange, currentRange, timeZone) : undefined;\n  }\n\n  const canScroll = Math.abs(currentRange.from.valueOf() - visibleRange.from) > SCROLLING_THRESHOLD;\n  return canScroll ? getPrevRange(visibleRange, currentRange) : undefined;\n}\n\nexport function canScrollBottom(\n  visibleRange: AbsoluteTimeRange,\n  currentRange: TimeRange,\n  timeZone: TimeZone,\n  sortOrder: LogsSortOrder\n): AbsoluteTimeRange | undefined {\n  if (sortOrder === LogsSortOrder.Descending) {\n    const canScroll = Math.abs(currentRange.from.valueOf() - visibleRange.from) > SCROLLING_THRESHOLD;\n    return canScroll ? getPrevRange(visibleRange, currentRange) : undefined;\n  }\n  // When requesting new logs, update the current range if using relative time ranges.\n  currentRange = updateCurrentRange(currentRange, timeZone);\n  const canScroll = currentRange.to.valueOf() - visibleRange.to > SCROLLING_THRESHOLD;\n  return canScroll ? getNextRange(visibleRange, currentRange, timeZone) : undefined;\n}\n\n// Given a TimeRange, returns a new instance if using relative time, or else the same.\nfunction updateCurrentRange(timeRange: TimeRange, timeZone: TimeZone) {\n  return rangeUtil.isRelativeTimeRange(timeRange.raw)\n    ? rangeUtil.convertRawToRange(timeRange.raw, timeZone)\n    : timeRange;\n}\n","import { css } from '@emotion/css';\n\nimport { Spinner } from '@grafana/ui';\n\n// ideally we'd use `@grafana/ui/LoadingPlaceholder`, but that\n// one has a large margin-bottom.\ntype Props = {\n  adjective?: string;\n};\n\nexport const LoadingIndicator = ({ adjective = 'newer' }: Props) => {\n  const text = `Loading ${adjective} logs...`;\n  return (\n    <div className={loadingIndicatorStyles}>\n      <div>\n        {text} <Spinner inline />\n      </div>\n    </div>\n  );\n};\n\nconst loadingIndicatorStyles = css({\n  display: 'flex',\n  justifyContent: 'center',\n});\n","import { css, cx } from '@emotion/css';\nimport { isEqual } from 'lodash';\nimport memoizeOne from 'memoize-one';\nimport { PureComponent, useEffect, useState } from 'react';\nimport * as React from 'react';\n\nimport {\n  CoreApp,\n  DataFrame,\n  Field,\n  GrafanaTheme2,\n  IconName,\n  LinkModel,\n  LogLabelStatsModel,\n  LogRowModel,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  ClipboardButton,\n  DataLinkButton,\n  IconButton,\n  PopoverContent,\n  Themeable2,\n  Tooltip,\n  withTheme2,\n} from '@grafana/ui';\n\nimport { logRowToSingleRowDataFrame } from '../logsModel';\nimport { getLabelTypeFromRow } from '../utils';\n\nimport { LogLabelStats } from './LogLabelStats';\nimport { getLogRowStyles } from './getLogRowStyles';\n\ninterface LinkModelWithIcon extends LinkModel<Field> {\n  icon?: IconName;\n}\n\nexport interface Props extends Themeable2 {\n  parsedValues: string[];\n  parsedKeys: string[];\n  disableActions: boolean;\n  wrapLogMessage?: boolean;\n  isLabel?: boolean;\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  links?: LinkModelWithIcon[];\n  getStats: () => LogLabelStatsModel[] | null;\n  displayedFields?: string[];\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  row: LogRowModel;\n  app?: CoreApp;\n  isFilterLabelActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n  onPinLine?: (row: LogRowModel, allowUnPin?: boolean) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n}\n\ninterface State {\n  showFieldsStats: boolean;\n  fieldCount: number;\n  fieldStats: LogLabelStatsModel[] | null;\n}\n\nconst getStyles = memoizeOne((theme: GrafanaTheme2) => {\n  return {\n    labelType: css({\n      border: `solid 1px ${theme.colors.text.secondary}`,\n      color: theme.colors.text.secondary,\n      borderRadius: theme.shape.radius.circle,\n      fontSize: theme.spacing(1),\n      lineHeight: theme.spacing(1.25),\n      height: theme.spacing(1.5),\n      width: theme.spacing(1.5),\n      display: 'flex',\n      justifyContent: 'center',\n      verticalAlign: 'middle',\n      marginLeft: theme.spacing(1),\n    }),\n    wordBreakAll: css({\n      label: 'wordBreakAll',\n      wordBreak: 'break-all',\n    }),\n    copyButton: css({\n      '& > button': {\n        color: theme.colors.text.secondary,\n        padding: 0,\n        justifyContent: 'center',\n        borderRadius: theme.shape.radius.circle,\n        height: theme.spacing(theme.components.height.sm),\n        width: theme.spacing(theme.components.height.sm),\n        svg: {\n          margin: 0,\n        },\n\n        'span > div': {\n          top: '-5px',\n          '& button': {\n            color: theme.colors.success.main,\n          },\n        },\n      },\n    }),\n    adjoiningLinkButton: css({\n      marginLeft: theme.spacing(1),\n    }),\n    wrapLine: css({\n      label: 'wrapLine',\n      whiteSpace: 'pre-wrap',\n    }),\n    logDetailsStats: css({\n      padding: `0 ${theme.spacing(1)}`,\n    }),\n    logDetailsValue: css({\n      display: 'flex',\n      alignItems: 'center',\n      lineHeight: '22px',\n\n      '.log-details-value-copy': {\n        visibility: 'hidden',\n      },\n      '&:hover': {\n        '.log-details-value-copy': {\n          visibility: 'visible',\n        },\n      },\n    }),\n    buttonRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(0.5),\n      marginLeft: theme.spacing(0.5),\n    }),\n  };\n});\n\nclass UnThemedLogDetailsRow extends PureComponent<Props, State> {\n  state: State = {\n    showFieldsStats: false,\n    fieldCount: 0,\n    fieldStats: null,\n  };\n\n  componentDidUpdate() {\n    if (this.state.showFieldsStats) {\n      this.updateStats();\n    }\n  }\n\n  showField = () => {\n    const { onClickShowField: onClickShowDetectedField, parsedKeys, row } = this.props;\n    if (onClickShowDetectedField) {\n      onClickShowDetectedField(parsedKeys[0]);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_replace_line_clicked', {\n      datasourceType: row.datasourceType,\n      logRowUid: row.uid,\n      type: 'enable',\n    });\n  };\n\n  hideField = () => {\n    const { onClickHideField: onClickHideDetectedField, parsedKeys, row } = this.props;\n    if (onClickHideDetectedField) {\n      onClickHideDetectedField(parsedKeys[0]);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_replace_line_clicked', {\n      datasourceType: row.datasourceType,\n      logRowUid: row.uid,\n      type: 'disable',\n    });\n  };\n\n  isFilterLabelActive = async () => {\n    const { isFilterLabelActive, parsedKeys, parsedValues, row } = this.props;\n    if (isFilterLabelActive) {\n      return await isFilterLabelActive(parsedKeys[0], parsedValues[0], row.dataFrame?.refId);\n    }\n    return false;\n  };\n\n  filterLabel = () => {\n    const { onClickFilterLabel, parsedKeys, parsedValues, row } = this.props;\n    if (onClickFilterLabel) {\n      onClickFilterLabel(parsedKeys[0], parsedValues[0], logRowToSingleRowDataFrame(row) || undefined);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_filter_clicked', {\n      datasourceType: row.datasourceType,\n      filterType: 'include',\n      logRowUid: row.uid,\n    });\n  };\n\n  filterOutLabel = () => {\n    const { onClickFilterOutLabel, parsedKeys, parsedValues, row } = this.props;\n    if (onClickFilterOutLabel) {\n      onClickFilterOutLabel(parsedKeys[0], parsedValues[0], logRowToSingleRowDataFrame(row) || undefined);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_filter_clicked', {\n      datasourceType: row.datasourceType,\n      filterType: 'exclude',\n      logRowUid: row.uid,\n    });\n  };\n\n  updateStats = () => {\n    const { getStats } = this.props;\n    const fieldStats = getStats();\n    const fieldCount = fieldStats ? fieldStats.reduce((sum, stat) => sum + stat.count, 0) : 0;\n    if (!isEqual(this.state.fieldStats, fieldStats) || fieldCount !== this.state.fieldCount) {\n      this.setState({ fieldStats, fieldCount });\n    }\n  };\n\n  showStats = () => {\n    const { isLabel, row, app } = this.props;\n    const { showFieldsStats } = this.state;\n    if (!showFieldsStats) {\n      this.updateStats();\n    }\n    this.toggleFieldsStats();\n\n    reportInteraction('grafana_explore_logs_log_details_stats_clicked', {\n      dataSourceType: row.datasourceType,\n      fieldType: isLabel ? 'label' : 'detectedField',\n      type: showFieldsStats ? 'close' : 'open',\n      logRowUid: row.uid,\n      app,\n    });\n  };\n\n  toggleFieldsStats() {\n    this.setState((state) => {\n      return {\n        showFieldsStats: !state.showFieldsStats,\n      };\n    });\n  }\n\n  generateClipboardButton(val: string) {\n    const { theme } = this.props;\n    const styles = getStyles(theme);\n\n    return (\n      <div className={`log-details-value-copy ${styles.copyButton}`}>\n        <ClipboardButton\n          getText={() => val}\n          title={t('logs.un-themed-log-details-row.title-copy-value-to-clipboard', 'Copy value to clipboard')}\n          fill=\"text\"\n          variant=\"secondary\"\n          icon=\"copy\"\n          size=\"md\"\n        />\n      </div>\n    );\n  }\n\n  generateMultiVal(value: string[], showCopy?: boolean) {\n    return (\n      <table>\n        <tbody>\n          {value?.map((val, i) => {\n            return (\n              <tr key={`${val}-${i}`}>\n                <td>\n                  {val}\n                  {showCopy && val !== '' && this.generateClipboardButton(val)}\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    );\n  }\n\n  render() {\n    const {\n      theme,\n      parsedKeys,\n      parsedValues,\n      isLabel,\n      links,\n      displayedFields,\n      wrapLogMessage,\n      onClickFilterLabel,\n      onClickFilterOutLabel,\n      disableActions,\n      row,\n      app,\n      onPinLine,\n      pinLineButtonTooltipTitle,\n    } = this.props;\n    const { showFieldsStats, fieldStats, fieldCount } = this.state;\n    const styles = getStyles(theme);\n    const rowStyles = getLogRowStyles(theme);\n    const singleKey = parsedKeys == null ? false : parsedKeys.length === 1;\n    const singleVal = parsedValues == null ? false : parsedValues.length === 1;\n    const hasFilteringFunctionality = !disableActions && onClickFilterLabel && onClickFilterOutLabel;\n    const refIdTooltip = app === CoreApp.Explore && row.dataFrame?.refId ? ` in query ${row.dataFrame?.refId}` : '';\n    const labelType = singleKey ? getLabelTypeFromRow(parsedKeys[0], row) : null;\n\n    const isMultiParsedValueWithNoContent =\n      !singleVal && parsedValues != null && !parsedValues.every((val) => val === '');\n\n    const toggleFieldButton =\n      displayedFields && parsedKeys != null && displayedFields.includes(parsedKeys[0]) ? (\n        <IconButton\n          variant=\"primary\"\n          tooltip={t('logs.un-themed-log-details-row.toggle-field-button.tooltip-hide-this-field', 'Hide this field')}\n          name=\"eye\"\n          onClick={this.hideField}\n        />\n      ) : (\n        <IconButton\n          tooltip={t(\n            'logs.un-themed-log-details-row.toggle-field-button.tooltip-field-instead-message',\n            'Show this field instead of the message'\n          )}\n          name=\"eye\"\n          onClick={this.showField}\n        />\n      );\n\n    return (\n      <>\n        <tr className={rowStyles.logDetailsValue}>\n          <td className={rowStyles.logsDetailsIcon}>\n            <div className={styles.buttonRow}>\n              {hasFilteringFunctionality && (\n                <>\n                  <AsyncIconButton\n                    name=\"search-plus\"\n                    onClick={this.filterLabel}\n                    // We purposely want to pass a new function on every render to allow the active state to be updated when log details remains open between updates.\n                    isActive={() => this.isFilterLabelActive()}\n                    tooltipSuffix={refIdTooltip}\n                  />\n                  <IconButton\n                    name=\"search-minus\"\n                    tooltip={\n                      app === CoreApp.Explore && row.dataFrame?.refId\n                        ? t('logs.un-themed-log-details-row.filter-out-query', 'Filter out value in query {{query}}', {\n                            query: row.dataFrame?.refId,\n                          })\n                        : t('logs.un-themed-log-details-row.filter-out', 'Filter out value')\n                    }\n                    onClick={this.filterOutLabel}\n                  />\n                </>\n              )}\n              {!disableActions && displayedFields && toggleFieldButton}\n              {!disableActions && (\n                <IconButton\n                  variant={showFieldsStats ? 'primary' : 'secondary'}\n                  name=\"signal\"\n                  tooltip={t('logs.un-themed-log-details-row.tooltip-adhoc-statistics', 'Ad-hoc statistics')}\n                  className=\"stats-button\"\n                  disabled={!singleKey}\n                  onClick={this.showStats}\n                />\n              )}\n            </div>\n          </td>\n\n          <td>{labelType && <LabelTypeBadge type={labelType} styles={styles} />}</td>\n          {/* Key - value columns */}\n          <td className={rowStyles.logDetailsLabel}>{singleKey ? parsedKeys[0] : this.generateMultiVal(parsedKeys)}</td>\n          <td className={cx(styles.wordBreakAll, wrapLogMessage && styles.wrapLine)}>\n            <div className={styles.logDetailsValue}>\n              {singleVal ? parsedValues[0] : this.generateMultiVal(parsedValues, true)}\n              {singleVal && this.generateClipboardButton(parsedValues[0])}\n              <div className={cx((singleVal || isMultiParsedValueWithNoContent) && styles.adjoiningLinkButton)}>\n                {links?.map((link, i) => {\n                  if (link.onClick && onPinLine) {\n                    const originalOnClick = link.onClick;\n                    link.onClick = (e, origin) => {\n                      // Pin the line\n                      onPinLine(row, false);\n\n                      // Execute the link onClick function\n                      originalOnClick(e, origin);\n                    };\n                  }\n                  return (\n                    <span key={`${link.title}-${i}`}>\n                      <DataLinkButton\n                        buttonProps={{\n                          // Show tooltip message if max number of pinned lines has been reached\n                          tooltip:\n                            typeof pinLineButtonTooltipTitle === 'object' && link.onClick\n                              ? pinLineButtonTooltipTitle\n                              : undefined,\n                          variant: 'secondary',\n                          fill: 'outline',\n                          ...(link.icon && { icon: link.icon }),\n                        }}\n                        link={link}\n                      />\n                    </span>\n                  );\n                })}\n              </div>\n            </div>\n          </td>\n        </tr>\n        {showFieldsStats && singleKey && singleVal && (\n          <tr>\n            <td colSpan={2}>\n              <IconButton\n                variant={showFieldsStats ? 'primary' : 'secondary'}\n                name=\"signal\"\n                tooltip={t('logs.un-themed-log-details-row.tooltip-hide-adhoc-statistics', 'Hide ad-hoc statistics')}\n                onClick={this.showStats}\n              />\n            </td>\n            <td colSpan={2}>\n              <div className={styles.logDetailsStats}>\n                <LogLabelStats\n                  stats={fieldStats!}\n                  label={parsedKeys[0]}\n                  value={parsedValues[0]}\n                  rowCount={fieldCount}\n                  isLabel={isLabel}\n                />\n              </div>\n            </td>\n          </tr>\n        )}\n      </>\n    );\n  }\n}\n\nfunction LabelTypeBadge({ type, styles }: { type: string; styles: ReturnType<typeof getStyles> }) {\n  return (\n    <Tooltip content={type}>\n      <div className={styles.labelType}>\n        <span>{type.substring(0, 1)}</span>\n      </div>\n    </Tooltip>\n  );\n}\n\ninterface AsyncIconButtonProps extends Pick<React.ButtonHTMLAttributes<HTMLButtonElement>, 'onClick'> {\n  name: IconName;\n  isActive(): Promise<boolean>;\n  tooltipSuffix: string;\n}\n\nconst AsyncIconButton = ({ isActive, tooltipSuffix, ...rest }: AsyncIconButtonProps) => {\n  const [active, setActive] = useState(false);\n  const tooltip = active ? 'Remove filter' : 'Filter for value';\n\n  useEffect(() => {\n    isActive().then(setActive);\n  }, [isActive]);\n\n  return <IconButton {...rest} variant={active ? 'primary' : undefined} tooltip={tooltip + tooltipSuffix} />;\n};\n\nexport const LogDetailsRow = withTheme2(UnThemedLogDetailsRow);\nLogDetailsRow.displayName = 'LogDetailsRow';\n","import { cx } from '@emotion/css';\nimport { PureComponent, useMemo } from 'react';\n\nimport {\n  CoreApp,\n  DataFrame,\n  DataFrameType,\n  IconName,\n  LinkModel,\n  LogRowModel,\n  PluginExtensionPoints,\n  PluginExtensionResourceAttributesContext,\n} from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { usePluginLinks } from '@grafana/runtime';\nimport { PopoverContent, Themeable2, withTheme2 } from '@grafana/ui';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { calculateLogsLabelStats, calculateStats } from '../utils';\n\nimport { LogDetailsBody } from './LogDetailsBody';\nimport { LogDetailsRow } from './LogDetailsRow';\nimport { getLogLevelStyles, LogRowStyles } from './getLogRowStyles';\nimport { getAllFields, createLogLineLinks } from './logParser';\n\nexport interface Props extends Themeable2 {\n  row: LogRowModel;\n  showDuplicates: boolean;\n  getRows: () => LogRowModel[];\n  wrapLogMessage: boolean;\n  className?: string;\n  hasError?: boolean;\n  app?: CoreApp;\n  styles: LogRowStyles;\n\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  getFieldLinks?: GetFieldLinksFn;\n  displayedFields?: string[];\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  isFilterLabelActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n\n  onPinLine?: (row: LogRowModel) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  links?: Record<string, LinkModel[]>;\n}\n\ninterface LinkModelWithIcon extends LinkModel {\n  icon?: IconName;\n}\n\nexport const useAttributesExtensionLinks = (row: LogRowModel) => {\n  // Stable context for useMemo inside usePluginLinks\n  const context: PluginExtensionResourceAttributesContext = useMemo(() => {\n    return {\n      attributes: Object.fromEntries(Object.entries(row.labels).map(([key, value]) => [key, [value]])),\n      datasource: {\n        type: row.datasourceType ?? '',\n        uid: row.datasourceUid ?? '',\n      },\n    };\n  }, [row.labels, row.datasourceType, row.datasourceUid]);\n\n  const { links } = usePluginLinks({\n    extensionPointId: PluginExtensionPoints.LogsViewResourceAttributes,\n    limitPerPlugin: 10,\n    context,\n  });\n\n  return useMemo(() => {\n    return links.reduce<Record<string, LinkModelWithIcon[]>>((acc, link) => {\n      if (link.category) {\n        const linkModel: LinkModelWithIcon = {\n          href: link.path ?? '',\n          target: '_blank',\n          origin: undefined,\n          title: link.title,\n          onClick: link.onClick,\n          icon: link.icon,\n        };\n\n        if (acc[link.category]) {\n          acc[link.category].push(linkModel);\n        } else {\n          acc[link.category] = [linkModel];\n        }\n      }\n      return acc;\n    }, {});\n  }, [links]);\n};\n\nconst withAttributesExtensionLinks = (Component: React.ComponentType<Props>) => {\n  function ComponentWithLinks(props: Props) {\n    const labelLinks = useAttributesExtensionLinks(props.row);\n    return <Component {...props} links={labelLinks} />;\n  }\n\n  return ComponentWithLinks;\n};\n\nclass UnThemedLogDetails extends PureComponent<Props> {\n  render() {\n    const {\n      app,\n      row,\n      theme,\n      hasError,\n      onClickFilterOutLabel,\n      onClickFilterLabel,\n      getRows,\n      showDuplicates,\n      className,\n      onClickShowField,\n      onClickHideField,\n      displayedFields,\n      getFieldLinks,\n      wrapLogMessage,\n      onPinLine,\n      styles,\n      pinLineButtonTooltipTitle,\n      links,\n    } = this.props;\n    const levelStyles = getLogLevelStyles(theme, row.logLevel);\n    const labels = row.labels ? row.labels : {};\n    const labelsAvailable = Object.keys(labels).length > 0;\n    const fieldsAndLinks = getAllFields(row, getFieldLinks);\n    let fieldsWithLinks = fieldsAndLinks.filter((f) => f.links?.length);\n    const displayedFieldsWithLinks = fieldsWithLinks.filter((f) => f.fieldIndex !== row.entryFieldIndex).sort();\n    const hiddenFieldsWithLinks = fieldsWithLinks.filter((f) => f.fieldIndex === row.entryFieldIndex).sort();\n    const fieldsWithLinksFromVariableMap = createLogLineLinks(hiddenFieldsWithLinks);\n    const fieldsWithLinksAvailable =\n      (displayedFieldsWithLinks && displayedFieldsWithLinks.length > 0) ||\n      (fieldsWithLinksFromVariableMap && fieldsWithLinksFromVariableMap.length > 0);\n\n    const fields =\n      row.dataFrame.meta?.type === DataFrameType.LogLines\n        ? // for LogLines frames (dataplane) we don't want to show any additional fields besides already extracted labels and links\n          []\n        : // for other frames, do not show the log message unless there is a link attached\n          fieldsAndLinks.filter((f) => f.links?.length === 0 && f.fieldIndex !== row.entryFieldIndex).sort();\n    const fieldsAvailable = fields && fields.length > 0;\n\n    // If logs with error, we are not showing the level color\n    const levelClassName = hasError\n      ? ''\n      : `${levelStyles.logsRowLevelColor} ${styles.logsRowLevel} ${styles.logsRowLevelDetails}`;\n\n    return (\n      <tr className={cx(className, styles.logDetails)}>\n        {showDuplicates && <td />}\n        <td className={levelClassName} aria-label={t('logs.un-themed-log-details.aria-label-log-level', 'Log level')} />\n        <td colSpan={4}>\n          <div className={styles.logDetailsContainer}>\n            <table className={styles.logDetailsTable}>\n              <tbody>\n                {displayedFields && displayedFields.length > 0 && (\n                  <>\n                    <tr>\n                      <td\n                        colSpan={100}\n                        className={styles.logDetailsHeading}\n                        aria-label={t('logs.un-themed-log-details.aria-label-line', 'Log line')}\n                      >\n                        <Trans i18nKey=\"logs.log-details.log-line\">Log line</Trans>\n                      </td>\n                    </tr>\n                    <LogDetailsBody\n                      onClickShowField={onClickShowField}\n                      onClickHideField={onClickHideField}\n                      row={row}\n                      app={app}\n                      displayedFields={displayedFields}\n                      disableActions={false}\n                      theme={theme}\n                    />\n                  </>\n                )}\n                {(labelsAvailable || fieldsAvailable) && (\n                  <tr>\n                    <td\n                      colSpan={100}\n                      className={styles.logDetailsHeading}\n                      aria-label={t('logs.un-themed-log-details.aria-label-fields', 'Fields')}\n                    >\n                      <Trans i18nKey=\"logs.log-details.fields\">Fields</Trans>\n                    </td>\n                  </tr>\n                )}\n                {Object.keys(labels)\n                  .sort()\n                  .map((key, i) => {\n                    const value = labels[key];\n                    return (\n                      <LogDetailsRow\n                        key={`${key}=${value}-${i}`}\n                        parsedKeys={[key]}\n                        parsedValues={[value]}\n                        isLabel={true}\n                        getStats={() => calculateLogsLabelStats(getRows(), key)}\n                        onClickFilterOutLabel={onClickFilterOutLabel}\n                        onClickFilterLabel={onClickFilterLabel}\n                        onClickShowField={onClickShowField}\n                        onClickHideField={onClickHideField}\n                        row={row}\n                        app={app}\n                        wrapLogMessage={wrapLogMessage}\n                        displayedFields={displayedFields}\n                        disableActions={false}\n                        isFilterLabelActive={this.props.isFilterLabelActive}\n                        links={links?.[key]}\n                      />\n                    );\n                  })}\n                {fields.map((field, i) => {\n                  const { keys, values, fieldIndex } = field;\n                  return (\n                    <LogDetailsRow\n                      key={`${keys[0]}=${values[0]}-${i}`}\n                      parsedKeys={keys}\n                      parsedValues={values}\n                      onClickShowField={onClickShowField}\n                      onClickHideField={onClickHideField}\n                      onClickFilterOutLabel={onClickFilterOutLabel}\n                      onClickFilterLabel={onClickFilterLabel}\n                      getStats={() => calculateStats(row.dataFrame.fields[fieldIndex].values)}\n                      displayedFields={displayedFields}\n                      wrapLogMessage={wrapLogMessage}\n                      row={row}\n                      app={app}\n                      disableActions={false}\n                      isFilterLabelActive={this.props.isFilterLabelActive}\n                    />\n                  );\n                })}\n\n                {fieldsWithLinksAvailable && (\n                  <tr>\n                    <td\n                      colSpan={100}\n                      className={styles.logDetailsHeading}\n                      aria-label={t('logs.un-themed-log-details.aria-label-data-links', 'Data links')}\n                    >\n                      <Trans i18nKey=\"logs.log-details.links\">Links</Trans>\n                    </td>\n                  </tr>\n                )}\n                {displayedFieldsWithLinks.map((field, i) => {\n                  const { keys, values, links, fieldIndex } = field;\n                  return (\n                    <LogDetailsRow\n                      key={`${keys[0]}=${values[0]}-${i}`}\n                      parsedKeys={keys}\n                      parsedValues={values}\n                      links={links}\n                      onClickShowField={onClickShowField}\n                      onClickHideField={onClickHideField}\n                      onPinLine={onPinLine}\n                      pinLineButtonTooltipTitle={pinLineButtonTooltipTitle}\n                      getStats={() => calculateStats(row.dataFrame.fields[fieldIndex].values)}\n                      displayedFields={displayedFields}\n                      wrapLogMessage={wrapLogMessage}\n                      row={row}\n                      app={app}\n                      disableActions={false}\n                    />\n                  );\n                })}\n                {fieldsWithLinksFromVariableMap?.map((field, i) => {\n                  const { keys, values, links, fieldIndex } = field;\n                  return (\n                    <LogDetailsRow\n                      key={`${keys[0]}=${values[0]}-${i}`}\n                      parsedKeys={keys}\n                      parsedValues={values}\n                      links={links}\n                      onClickShowField={onClickShowField}\n                      onClickHideField={onClickHideField}\n                      onPinLine={onPinLine}\n                      pinLineButtonTooltipTitle={pinLineButtonTooltipTitle}\n                      getStats={() => calculateStats(row.dataFrame.fields[fieldIndex].values)}\n                      displayedFields={displayedFields}\n                      wrapLogMessage={wrapLogMessage}\n                      row={row}\n                      app={app}\n                      disableActions={true}\n                    />\n                  );\n                })}\n\n                {!fieldsAvailable && !labelsAvailable && !fieldsWithLinksAvailable && (\n                  <tr>\n                    <td colSpan={100} aria-label={t('logs.un-themed-log-details.aria-label-no-details', 'No details')}>\n                      <Trans i18nKey=\"logs.log-details.no-details\">No details available</Trans>\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </td>\n      </tr>\n    );\n  }\n}\n\nexport const LogDetails = withTheme2(withAttributesExtensionLinks(UnThemedLogDetails));\nLogDetails.displayName = 'LogDetails';\n","import { css } from '@emotion/css';\nimport memoizeOne from 'memoize-one';\n\nimport { CoreApp, GrafanaTheme2, LogRowModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { IconButton, Themeable2 } from '@grafana/ui';\n\nimport { getLogRowStyles } from './getLogRowStyles';\n\nexport interface Props extends Themeable2 {\n  app?: CoreApp;\n  disableActions: boolean;\n  displayedFields?: string[];\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  row: LogRowModel;\n  theme: GrafanaTheme2;\n}\n\nconst getStyles = memoizeOne((theme: GrafanaTheme2) => {\n  return {\n    buttonRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(0.5),\n      marginLeft: theme.spacing(0.5),\n    }),\n  };\n});\n\nexport const LOG_LINE_BODY_FIELD_NAME = '___LOG_LINE_BODY___';\n\nexport const LogDetailsBody = (props: Props) => {\n  const showField = () => {\n    const { onClickShowField, row } = props;\n    if (onClickShowField) {\n      onClickShowField(LOG_LINE_BODY_FIELD_NAME);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_show_body_clicked', {\n      datasourceType: row.datasourceType,\n      logRowUid: row.uid,\n      type: 'enable',\n      app: props.app,\n    });\n  };\n\n  const hideField = () => {\n    const { onClickHideField, row } = props;\n    if (onClickHideField) {\n      onClickHideField(LOG_LINE_BODY_FIELD_NAME);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_show_body_clicked', {\n      datasourceType: row.datasourceType,\n      logRowUid: row.uid,\n      type: 'disable',\n      app: props.app,\n    });\n  };\n\n  const { theme, displayedFields, disableActions, row } = props;\n  const styles = getStyles(theme);\n  const rowStyles = getLogRowStyles(theme);\n\n  const toggleFieldButton =\n    displayedFields != null && displayedFields.includes(LOG_LINE_BODY_FIELD_NAME) ? (\n      <IconButton\n        variant=\"primary\"\n        tooltip={t('logs.log-details-body.toggle-field-button.tooltip-hide-log-line', 'Hide log line')}\n        name=\"eye\"\n        onClick={hideField}\n      />\n    ) : (\n      <IconButton\n        tooltip={t('logs.log-details-body.toggle-field-button.tooltip-show-log-line', 'Show log line')}\n        name=\"eye\"\n        onClick={showField}\n      />\n    );\n\n  return (\n    <tr className={rowStyles.logDetailsValue}>\n      <td className={rowStyles.logsDetailsIcon}>\n        <div className={styles.buttonRow}>{!disableActions && displayedFields && toggleFieldButton}</div>\n      </td>\n\n      <td className={rowStyles.logDetailsLabel} colSpan={100}>\n        {row.entry}\n      </td>\n    </tr>\n  );\n};\n","import { css, cx } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStatsRow: css({\n    label: 'logs-stats-row',\n    margin: `${parseInt(theme.spacing(2), 10) / 1.75}px 0`,\n  }),\n  logsStatsRowActive: css({\n    label: 'logs-stats-row--active',\n    color: theme.colors.primary.text,\n    position: 'relative',\n  }),\n  logsStatsRowLabel: css({\n    label: 'logs-stats-row__label',\n    display: 'flex',\n    marginBottom: '1px',\n  }),\n  logsStatsRowValue: css({\n    label: 'logs-stats-row__value',\n    flex: 1,\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  }),\n  logsStatsRowCount: css({\n    label: 'logs-stats-row__count',\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n  }),\n  logsStatsRowPercent: css({\n    label: 'logs-stats-row__percent',\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n    width: theme.spacing(4.5),\n  }),\n  logsStatsRowBar: css({\n    label: 'logs-stats-row__bar',\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.text.disabled,\n  }),\n  logsStatsRowInnerBar: css({\n    label: 'logs-stats-row__innerbar',\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.primary.main,\n  }),\n});\n\nexport interface Props {\n  active?: boolean;\n  count: number;\n  proportion: number;\n  value?: string;\n}\n\nexport const LogLabelStatsRow = ({ active, count, proportion, value }: Props) => {\n  const style = useStyles2(getStyles);\n  const percent = `${Math.round(proportion * 100)}%`;\n  const barStyle = { width: percent };\n  const className = active ? cx([style.logsStatsRow, style.logsStatsRowActive]) : cx([style.logsStatsRow]);\n\n  return (\n    <div className={className}>\n      <div className={cx([style.logsStatsRowLabel])}>\n        <div className={cx([style.logsStatsRowValue])} title={value}>\n          {value}\n        </div>\n        <div className={cx([style.logsStatsRowCount])}>{count}</div>\n        <div className={cx([style.logsStatsRowPercent])}>{percent}</div>\n      </div>\n      <div className={cx([style.logsStatsRowBar])}>\n        <div className={cx([style.logsStatsRowInnerBar])} style={barStyle} />\n      </div>\n    </div>\n  );\n};\n\nLogLabelStatsRow.displayName = 'LogLabelStatsRow';\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { LogLabelStatsModel, GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { LogLabelStatsRow } from './LogLabelStatsRow';\n\nconst STATS_ROW_LIMIT = 5;\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    logsStats: css({\n      label: 'logs-stats',\n      background: 'inherit',\n      color: theme.colors.text.primary,\n      wordBreak: 'break-all',\n      width: 'fit-content',\n      maxWidth: '100%',\n    }),\n    logsStatsHeader: css({\n      label: 'logs-stats__header',\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n      display: 'flex',\n    }),\n    logsStatsTitle: css({\n      label: 'logs-stats__title',\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingRight: theme.spacing(2),\n      display: 'inline-block',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      flexGrow: 1,\n    }),\n    logsStatsClose: css({\n      label: 'logs-stats__close',\n      cursor: 'pointer',\n    }),\n    logsStatsBody: css({\n      label: 'logs-stats__body',\n      padding: '5px 0px',\n    }),\n  };\n};\n\ninterface Props {\n  className?: string;\n  stats: LogLabelStatsModel[];\n  label: string;\n  value: string;\n  rowCount: number;\n  isLabel?: boolean;\n}\n\nexport const LogLabelStats = ({ className, label, rowCount, stats, value, isLabel }: Props) => {\n  const style = useStyles2(getStyles);\n  const rows = useMemo(() => {\n    const topRows = stats.slice(0, STATS_ROW_LIMIT);\n    let activeRow = topRows.find((row) => row.value === value);\n    let otherRows = stats.slice(STATS_ROW_LIMIT);\n    const insertActiveRow = !activeRow;\n\n    // Remove active row from other to show extra\n    if (insertActiveRow) {\n      activeRow = otherRows.find((row) => row.value === value);\n      otherRows = otherRows.filter((row) => row.value !== value);\n    }\n    return { topRows, otherRows, insertActiveRow, activeRow };\n  }, [stats, value]);\n\n  const otherCount = useMemo(() => rows.otherRows.reduce((sum, row) => sum + row.count, 0), [rows.otherRows]);\n  const topCount = useMemo(() => rows.topRows.reduce((sum, row) => sum + row.count, 0), [rows.topRows]);\n  const total = topCount + otherCount;\n  const otherProportion = otherCount / total;\n\n  return (\n    <div className={className ?? style.logsStats} data-testid=\"logLabelStats\">\n      <div className={style.logsStatsHeader}>\n        <div className={style.logsStatsTitle}>\n          {isLabel\n            ? t(\n                'logs.un-themed-log-label-stats.label-log-stats',\n                '{{label}}: {{total}} of {{rowCount}} rows have that label',\n                {\n                  label,\n                  total,\n                  rowCount,\n                }\n              )\n            : t(\n                'logs.un-themed-log-label-stats.field-log-stats',\n                '{{label}}: {{total}} of {{rowCount}} rows have that field'\n              )}\n        </div>\n      </div>\n      <div className={style.logsStatsBody}>\n        {rows.topRows.map((stat) => (\n          <LogLabelStatsRow key={stat.value} {...stat} active={stat.value === value} />\n        ))}\n        {rows.insertActiveRow && rows.activeRow && (\n          <LogLabelStatsRow key={rows.activeRow.value} {...rows.activeRow} active />\n        )}\n        {otherCount > 0 && (\n          <LogLabelStatsRow key=\"__OTHERS__\" count={otherCount} value=\"Other\" proportion={otherProportion} />\n        )}\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport { memo, forwardRef, useMemo, useState } from 'react';\n\nimport { GrafanaTheme2, Labels } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Button, Icon, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { LOG_LINE_BODY_FIELD_NAME } from './LogDetailsBody';\n\n// Levels are already encoded in color, filename is a Loki-ism\nconst HIDDEN_LABELS = ['detected_level', 'level', 'lvl', 'filename'];\n\nexport interface Props {\n  labels: Labels;\n  emptyMessage?: string;\n  addTooltip?: boolean;\n  displayMax?: number;\n  displayAll?: boolean;\n  onDisplayMaxToggle?(state: boolean): void;\n}\n\nexport const LogLabels = memo(\n  ({\n    labels,\n    emptyMessage,\n    addTooltip = true,\n    displayMax,\n    onDisplayMaxToggle,\n    displayAll: initialDisplayAll = false,\n  }: Props) => {\n    const [displayAll, setDisplayAll] = useState<boolean | undefined>(displayMax ? initialDisplayAll : undefined);\n    const styles = useStyles2(getStyles);\n    const allLabels = useMemo(\n      () =>\n        Object.keys(labels)\n          .filter((label) => !label.startsWith('_') && !HIDDEN_LABELS.includes(label) && labels[label])\n          .map((label) => `${label}=${labels[label]}`),\n      [labels]\n    );\n    const displayLabels = useMemo(\n      () => allLabels.slice(0, !displayAll && displayMax ? displayMax : Infinity),\n      [allLabels, displayAll, displayMax]\n    );\n\n    if (displayLabels.length === 0 && emptyMessage) {\n      return (\n        <span className={styles.logsLabels}>\n          <span className={styles.logsLabel}>{emptyMessage}</span>\n        </span>\n      );\n    }\n\n    return (\n      <span className={styles.logsLabels}>\n        {displayLabels.map((labelValue) => {\n          return addTooltip ? (\n            <Tooltip content={labelValue} key={labelValue} placement=\"top\">\n              <LogLabel styles={styles}>{labelValue}</LogLabel>\n            </Tooltip>\n          ) : (\n            <LogLabel styles={styles} tooltip={labelValue} key={labelValue}>\n              {labelValue}\n            </LogLabel>\n          );\n        })}\n        {displayLabels.length < allLabels.length && !displayAll && (\n          <Button\n            size=\"sm\"\n            fill=\"outline\"\n            variant=\"secondary\"\n            aria-label={t('logs.log-labels.expand', 'Expand labels')}\n            onClick={() => {\n              setDisplayAll(true);\n              onDisplayMaxToggle?.(true);\n            }}\n          >\n            <Icon name=\"plus\" size=\"xs\" />\n            {allLabels.length - displayLabels.length}\n          </Button>\n        )}\n        {displayAll === true && (\n          <Button\n            size=\"sm\"\n            fill=\"outline\"\n            variant=\"secondary\"\n            aria-label={t('logs.log-labels.collapse', 'Collapse labels')}\n            onClick={() => {\n              setDisplayAll(false);\n              onDisplayMaxToggle?.(false);\n            }}\n          >\n            <Icon name=\"minus\" size=\"xs\" />\n          </Button>\n        )}\n      </span>\n    );\n  }\n);\nLogLabels.displayName = 'LogLabels';\n\ninterface LogLabelsArrayProps {\n  labels: string[];\n}\n\nexport const LogLabelsList = memo(({ labels }: LogLabelsArrayProps) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <span className={styles.logsLabels}>\n      {labels.map((label) => (\n        <LogLabel key={label} styles={styles} tooltip={label}>\n          {label === LOG_LINE_BODY_FIELD_NAME ? t('logs.log-labels-list.log-line', 'log line') : label}\n        </LogLabel>\n      ))}\n    </span>\n  );\n});\nLogLabelsList.displayName = 'LogLabelsList';\n\ninterface LogLabelProps {\n  styles: Record<string, string>;\n  tooltip?: string;\n  children: JSX.Element | string;\n}\n\nconst LogLabel = forwardRef<HTMLSpanElement, LogLabelProps>(({ styles, tooltip, children }: LogLabelProps, ref) => {\n  return (\n    <span className={styles.logsLabel} ref={ref}>\n      <span className={styles.logsLabelValue} title={tooltip}>\n        {children}\n      </span>\n    </span>\n  );\n});\nLogLabel.displayName = 'LogLabel';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    logsLabels: css({\n      display: 'flex',\n      flexWrap: 'wrap',\n      fontSize: theme.typography.size.xs,\n      alignItems: 'center',\n    }),\n    logsLabel: css({\n      label: 'logs-label',\n      display: 'flex',\n      padding: theme.spacing(0, 0.25),\n      backgroundColor: theme.colors.background.secondary,\n      borderRadius: theme.shape.radius.default,\n      margin: theme.spacing(0.125, 0.5, 0, 0),\n      textOverflow: 'ellipsis',\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n      maxHeight: theme.spacing(2),\n    }),\n    logsLabelValue: css({\n      label: 'logs-label__value',\n      display: 'inline-block',\n      maxWidth: theme.spacing(25),\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n    }),\n  };\n};\n","import ansicolor from 'ansicolor';\nimport { PureComponent } from 'react';\nimport Highlighter from 'react-highlight-words';\n\nimport { findHighlightChunksInText, GrafanaTheme2 } from '@grafana/data';\nimport { withTheme2, Themeable2 } from '@grafana/ui';\n\ninterface Style {\n  [key: string]: string;\n}\n\ninterface ParsedChunk {\n  style: Style;\n  text: string;\n}\n\nfunction convertCSSToStyle(theme: GrafanaTheme2, css: string): Style {\n  return css.split(/;\\s*/).reduce<Style>((accumulated, line) => {\n    // The ansicolor package returns this color if the chunk has the ANSI dim\n    // style (`\\e[2m`), but it is nearly unreadable in the dark theme, so we use\n    // GrafanaTheme2 instead to style it in a way that works across all themes.\n    if (line === 'color:rgba(0,0,0,0.5)') {\n      return { color: theme.colors.text.secondary };\n    }\n\n    const match = line.match(/([^:\\s]+)\\s*:\\s*(.+)/);\n\n    if (match && match[1] && match[2]) {\n      const key = match[1].replace(/-([a-z])/g, (_, character) => character.toUpperCase());\n      accumulated[key] = match[2];\n    }\n\n    return accumulated;\n  }, {});\n}\n\ninterface Props extends Themeable2 {\n  value: string;\n  highlight?: {\n    searchWords: string[];\n    highlightClassName: string;\n  };\n}\n\ninterface State {\n  chunks: ParsedChunk[];\n  prevValue: string;\n}\n\nexport class UnThemedLogMessageAnsi extends PureComponent<Props, State> {\n  state: State = {\n    chunks: [],\n    prevValue: '',\n  };\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    if (props.value === state.prevValue) {\n      return null;\n    }\n\n    const parsed = ansicolor.parse(props.value);\n\n    return {\n      chunks: parsed.spans.map((span) => {\n        return span.css\n          ? {\n              style: convertCSSToStyle(props.theme, span.css),\n              text: span.text,\n            }\n          : { text: span.text };\n      }),\n      prevValue: props.value,\n    };\n  }\n\n  render() {\n    const { chunks } = this.state;\n\n    return chunks.map((chunk, index) => {\n      const chunkText = this.props.highlight?.searchWords ? (\n        <Highlighter\n          key={index}\n          textToHighlight={chunk.text}\n          searchWords={this.props.highlight.searchWords}\n          findChunks={findHighlightChunksInText}\n          highlightClassName={this.props.highlight.highlightClassName}\n        />\n      ) : (\n        chunk.text\n      );\n      return chunk.style ? (\n        <span key={index} style={chunk.style} data-testid=\"ansiLogLine\">\n          {chunkText}\n        </span>\n      ) : (\n        chunkText\n      );\n    });\n  }\n}\n\nexport const LogMessageAnsi = withTheme2(UnThemedLogMessageAnsi);\nLogMessageAnsi.displayName = 'LogMessageAnsi';\n","// this class generates react-keys that are guaranteed to be unique.\n// it will try to use the provided `maybeId`, but if that's a duplicate,\n// it will use an index-based key.\n// NOTE: it will always add a prefix to the string, this is necessary\n// to avoid the problem if your proposed key would conflict with\n// the index-based names\nexport class UniqueKeyMaker {\n  seen: Set<string>;\n  count: number;\n  constructor() {\n    this.seen = new Set();\n    this.count = 0;\n  }\n\n  getKey(proposedKey: string) {\n    this.count += 1;\n    const maybeKey = `k_${proposedKey}`;\n    if (this.seen.has(maybeKey)) {\n      return `i_${this.count}`;\n    } else {\n      this.seen.add(maybeKey);\n      return maybeKey;\n    }\n  }\n}\n","import {\n  memo,\n  FocusEvent,\n  SyntheticEvent,\n  useCallback,\n  ReactNode,\n  useMemo,\n  cloneElement,\n  isValidElement,\n  MouseEvent,\n} from 'react';\n\nimport { LogRowContextOptions, LogRowModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { DataQuery } from '@grafana/schema';\nimport { ClipboardButton, IconButton, PopoverContent } from '@grafana/ui';\n\nimport { handleOpenLogsContextClick } from '../utils';\n\nimport { LogRowStyles } from './getLogRowStyles';\n\ninterface Props {\n  logText: string;\n  row: LogRowModel;\n  showContextToggle?: (row: LogRowModel) => boolean;\n  onOpenContext: (row: LogRowModel) => void;\n  getRowContextQuery?: (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    cacheFilters?: boolean\n  ) => Promise<DataQuery | null>;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  onPinLine?: (row: LogRowModel) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  pinned?: boolean;\n  styles: LogRowStyles;\n  mouseIsOver: boolean;\n  onBlur: () => void;\n  addonBefore?: ReactNode[];\n  addonAfter?: ReactNode[];\n}\n\nexport const LogRowMenuCell = memo(\n  ({\n    logText,\n    onOpenContext,\n    onPermalinkClick,\n    onPinLine,\n    onUnpinLine,\n    pinLineButtonTooltipTitle,\n    pinned,\n    row,\n    showContextToggle,\n    styles,\n    mouseIsOver,\n    onBlur,\n    getRowContextQuery,\n    addonBefore,\n    addonAfter,\n  }: Props) => {\n    const shouldShowContextToggle = useMemo(\n      () => (showContextToggle ? showContextToggle(row) : false),\n      [row, showContextToggle]\n    );\n    const onLogRowClick = useCallback((e: SyntheticEvent) => {\n      e.stopPropagation();\n    }, []);\n    const onShowContextClick = useCallback(\n      async (event: MouseEvent<HTMLElement>) => {\n        event.stopPropagation();\n        handleOpenLogsContextClick(event, row, getRowContextQuery, onOpenContext);\n      },\n      [onOpenContext, getRowContextQuery, row]\n    );\n    /**\n     * For better accessibility support, we listen to the onBlur event here (to hide this component), and\n     * to onFocus in LogRow (to show this component).\n     */\n    const handleBlur = useCallback(\n      (e: FocusEvent) => {\n        if (!e.currentTarget.contains(e.relatedTarget) && onBlur) {\n          onBlur();\n        }\n      },\n      [onBlur]\n    );\n    const getLogText = useCallback(() => logText, [logText]);\n\n    const beforeContent = useMemo(() => {\n      if (!addonBefore) {\n        return null;\n      }\n      return addClickListenersToNode(addonBefore, row);\n    }, [addonBefore, row]);\n\n    const afterContent = useMemo(() => {\n      if (!addonAfter) {\n        return null;\n      }\n      return addClickListenersToNode(addonAfter, row);\n    }, [addonAfter, row]);\n\n    return (\n      // We keep this click listener here to prevent the row from being selected when clicking on the menu.\n      // eslint-disable-next-line jsx-a11y/click-events-have-key-events, jsx-a11y/no-static-element-interactions\n      <span className={`log-row-menu ${styles.rowMenu}`} onClick={onLogRowClick} onBlur={handleBlur}>\n        {pinned && !mouseIsOver && (\n          <IconButton\n            className={styles.unPinButton}\n            size=\"md\"\n            name=\"gf-pin\"\n            onClick={() => onUnpinLine && onUnpinLine(row)}\n            tooltip={t('logs.log-row-menu-cell.tooltip-unpin-line', 'Unpin line')}\n            tooltipPlacement=\"top\"\n            aria-label={t('logs.log-row-menu-cell.aria-label-unpin-line', 'Unpin line')}\n            tabIndex={0}\n          />\n        )}\n        {mouseIsOver && (\n          <>\n            {beforeContent}\n            {shouldShowContextToggle && (\n              <IconButton\n                size=\"md\"\n                name=\"gf-show-context\"\n                onClick={onShowContextClick}\n                tooltip={t('logs.log-row-menu-cell.tooltip-show-context', 'Show context')}\n                tooltipPlacement=\"top\"\n                aria-label={t('logs.log-row-menu-cell.aria-label-show-context', 'Show context')}\n                tabIndex={0}\n              />\n            )}\n            <ClipboardButton\n              className={styles.copyLogButton}\n              icon=\"copy\"\n              variant=\"secondary\"\n              fill=\"text\"\n              size=\"md\"\n              getText={getLogText}\n              tooltip={t('logs.log-row-menu-cell.tooltip-copy-to-clipboard', 'Copy to clipboard')}\n              tooltipPlacement=\"top\"\n              tabIndex={0}\n            />\n            {pinned && onUnpinLine && (\n              <IconButton\n                className={styles.unPinButton}\n                size=\"md\"\n                name=\"gf-pin\"\n                onClick={() => onUnpinLine && onUnpinLine(row)}\n                tooltip={t('logs.log-row-menu-cell.tooltip-unpin-line', 'Unpin line')}\n                tooltipPlacement=\"top\"\n                aria-label={t('logs.log-row-menu-cell.aria-label-unpin-line', 'Unpin line')}\n                tabIndex={0}\n              />\n            )}\n            {!pinned && onPinLine && (\n              <IconButton\n                className={styles.unPinButton}\n                size=\"md\"\n                name=\"gf-pin\"\n                onClick={() => onPinLine && onPinLine(row)}\n                tooltip={pinLineButtonTooltipTitle ?? 'Pin line'}\n                tooltipPlacement=\"top\"\n                aria-label={t('logs.log-row-menu-cell.aria-label-pin-line', 'Pin line')}\n                tabIndex={0}\n              />\n            )}\n            {onPermalinkClick && row.rowId !== undefined && row.uid && (\n              <IconButton\n                tooltip={t('logs.log-row-menu-cell.tooltip-copy-shortlink', 'Copy shortlink')}\n                aria-label={t('logs.log-row-menu-cell.aria-label-copy-shortlink', 'Copy shortlink')}\n                tooltipPlacement=\"top\"\n                size=\"md\"\n                name=\"share-alt\"\n                onClick={() => onPermalinkClick(row)}\n                tabIndex={0}\n              />\n            )}\n            {afterContent}\n          </>\n        )}\n      </span>\n    );\n  }\n);\n\ntype AddonOnClickListener = (event: MouseEvent, row: LogRowModel) => void | undefined;\nfunction addClickListenersToNode(nodes: ReactNode[], row: LogRowModel) {\n  return nodes.map((node, index) => {\n    if (isValidElement(node)) {\n      const onClick: AddonOnClickListener = node.props.onClick;\n      if (!onClick) {\n        return node;\n      }\n      return cloneElement(node, {\n        // @ts-expect-error\n        onClick: (event: MouseEvent<HTMLElement>) => {\n          onClick(event, row);\n        },\n        key: index,\n      });\n    }\n    return node;\n  });\n}\n\nLogRowMenuCell.displayName = 'LogRowMenuCell';\n","import { css } from '@emotion/css';\nimport { memo, ReactNode, SyntheticEvent, useMemo, useState } from 'react';\nimport Highlighter from 'react-highlight-words';\n\nimport { CoreApp, findHighlightChunksInText, GrafanaTheme2, LogRowContextOptions, LogRowModel } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { DataQuery } from '@grafana/schema';\nimport { PopoverContent, useTheme2 } from '@grafana/ui';\n\nimport { escapeUnescapedString } from '../utils';\n\nimport { LogMessageAnsi } from './LogMessageAnsi';\nimport { LogRowMenuCell } from './LogRowMenuCell';\nimport { LogRowStyles } from './getLogRowStyles';\n\nexport const MAX_CHARACTERS = 100000;\n\ninterface Props {\n  row: LogRowModel;\n  wrapLogMessage: boolean;\n  prettifyLogMessage: boolean;\n  app?: CoreApp;\n  showContextToggle?: (row: LogRowModel) => boolean;\n  onOpenContext: (row: LogRowModel) => void;\n  getRowContextQuery?: (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    cacheFilters?: boolean\n  ) => Promise<DataQuery | null>;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  onPinLine?: (row: LogRowModel) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  pinned?: boolean;\n  styles: LogRowStyles;\n  mouseIsOver: boolean;\n  onBlur: () => void;\n  expanded?: boolean;\n  logRowMenuIconsBefore?: ReactNode[];\n  logRowMenuIconsAfter?: ReactNode[];\n  forceEscape?: boolean;\n}\n\ninterface LogMessageProps {\n  hasAnsi: boolean;\n  entry: string;\n  highlights: string[] | undefined;\n  styles: LogRowStyles;\n}\n\nconst LogMessage = ({ hasAnsi, entry, highlights, styles }: LogMessageProps) => {\n  const excessCharacters = useMemo(() => entry.length - MAX_CHARACTERS, [entry]);\n  const needsHighlighter =\n    highlights && highlights.length > 0 && highlights[0] && highlights[0].length > 0 && excessCharacters <= 0;\n  const searchWords = highlights ?? [];\n  const [showFull, setShowFull] = useState(excessCharacters < 0);\n  const truncatedEntry = useMemo(() => (showFull ? entry : entry.substring(0, MAX_CHARACTERS)), [entry, showFull]);\n\n  if (hasAnsi) {\n    const highlight = needsHighlighter ? { searchWords, highlightClassName: styles.logsRowMatchHighLight } : undefined;\n    return <LogMessageAnsi value={truncatedEntry} highlight={highlight} />;\n  } else if (needsHighlighter) {\n    return (\n      <Highlighter\n        textToHighlight={truncatedEntry}\n        searchWords={searchWords}\n        findChunks={findHighlightChunksInText}\n        highlightClassName={styles.logsRowMatchHighLight}\n      />\n    );\n  }\n  return (\n    <>\n      {truncatedEntry}\n      {!showFull && <Ellipsis showFull={showFull} toggle={setShowFull} diff={excessCharacters} />}\n    </>\n  );\n};\n\ninterface EllipsisProps {\n  showFull: boolean;\n  toggle(state: boolean): void;\n  diff: number;\n}\nconst Ellipsis = ({ toggle, diff }: EllipsisProps) => {\n  const styles = getEllipsisStyles(useTheme2());\n  const handleClick = (e: SyntheticEvent) => {\n    e.stopPropagation();\n    toggle(true);\n  };\n  return (\n    <>\n      <Trans i18nKey=\"logs.log-row-message.ellipsis\"> </Trans>\n      <button className={styles.showMore} onClick={handleClick}>\n        {diff} <Trans i18nKey=\"logs.log-row-message.more\">more</Trans>\n      </button>\n    </>\n  );\n};\n\nconst getEllipsisStyles = (theme: GrafanaTheme2) => ({\n  showMore: css({\n    backgroundColor: 'transparent',\n    display: 'inline-flex',\n    fontWeight: theme.typography.fontWeightMedium,\n    fontSize: theme.typography.size.sm,\n    fontFamily: theme.typography.fontFamily,\n    height: theme.spacing(3),\n    padding: theme.spacing(0.25, 1),\n    color: theme.colors.secondary.text,\n    border: `1px solid ${theme.colors.border.strong}`,\n    '&:hover': {\n      background: theme.colors.secondary.transparent,\n      borderColor: theme.colors.emphasize(theme.colors.border.strong, 0.25),\n      color: theme.colors.secondary.text,\n    },\n  }),\n});\n\nconst restructureLog = (\n  row: LogRowModel,\n  prettifyLogMessage: boolean,\n  wrapLogMessage: boolean,\n  expanded: boolean,\n  forceEscape: boolean\n): string => {\n  let line = row.raw;\n  if (prettifyLogMessage) {\n    try {\n      line = JSON.stringify(JSON.parse(line), undefined, 2);\n      return row.hasUnescapedContent && forceEscape ? escapeUnescapedString(line) : line;\n    } catch (error) {}\n  }\n  if (row.hasUnescapedContent && forceEscape) {\n    line = escapeUnescapedString(line);\n  }\n  // With wrapping disabled, we want to turn it into a single-line log entry unless the line is expanded\n  if (!wrapLogMessage && !expanded) {\n    line = line.replace(/(\\r\\n|\\n|\\r)/g, '');\n  }\n  return line;\n};\n\nexport const LogRowMessage = memo((props: Props) => {\n  const {\n    row,\n    wrapLogMessage,\n    prettifyLogMessage,\n    showContextToggle,\n    styles,\n    onOpenContext,\n    onPermalinkClick,\n    onUnpinLine,\n    onPinLine,\n    pinLineButtonTooltipTitle,\n    pinned,\n    mouseIsOver,\n    onBlur,\n    getRowContextQuery,\n    expanded,\n    logRowMenuIconsBefore,\n    logRowMenuIconsAfter,\n    forceEscape,\n  } = props;\n  const { hasAnsi } = row;\n  const restructuredEntry = useMemo(\n    () => restructureLog(row, prettifyLogMessage, wrapLogMessage, Boolean(expanded), Boolean(forceEscape)),\n    [expanded, forceEscape, prettifyLogMessage, row, wrapLogMessage]\n  );\n  const shouldShowMenu = mouseIsOver || pinned;\n\n  return (\n    <>\n      {\n        // When context is open, the position has to be NOT relative. // Setting the postion as inline-style to\n        // overwrite the more sepecific style definition from `styles.logsRowMessage`.\n      }\n      <td className={styles.logsRowMessage}>\n        <div className={wrapLogMessage ? styles.positionRelative : styles.horizontalScroll}>\n          <div className={`${styles.logLine} ${styles.positionRelative}`}>\n            <LogMessage hasAnsi={hasAnsi} entry={restructuredEntry} highlights={row.searchWords} styles={styles} />\n          </div>\n        </div>\n      </td>\n      <td className={`log-row-menu-cell ${styles.logRowMenuCell}`}>\n        {shouldShowMenu && (\n          <LogRowMenuCell\n            logText={restructuredEntry}\n            row={row}\n            showContextToggle={showContextToggle}\n            getRowContextQuery={getRowContextQuery}\n            onOpenContext={onOpenContext}\n            onPermalinkClick={onPermalinkClick}\n            onPinLine={onPinLine}\n            onUnpinLine={onUnpinLine}\n            pinLineButtonTooltipTitle={pinLineButtonTooltipTitle}\n            pinned={pinned}\n            styles={styles}\n            mouseIsOver={mouseIsOver}\n            onBlur={onBlur}\n            addonBefore={logRowMenuIconsBefore}\n            addonAfter={logRowMenuIconsAfter}\n          />\n        )}\n      </td>\n    </>\n  );\n});\n\nLogRowMessage.displayName = 'LogRowMessage';\n","import { css } from '@emotion/css';\nimport { memo, ReactNode, useMemo } from 'react';\n\nimport { LogRowModel } from '@grafana/data';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { LOG_LINE_BODY_FIELD_NAME } from './LogDetailsBody';\nimport { LogRowMenuCell } from './LogRowMenuCell';\nimport { LogRowStyles } from './getLogRowStyles';\nimport { getAllFields } from './logParser';\n\nexport interface Props {\n  row: LogRowModel;\n  detectedFields: string[];\n  wrapLogMessage: boolean;\n  getFieldLinks?: GetFieldLinksFn;\n  styles: LogRowStyles;\n  showContextToggle?: (row: LogRowModel) => boolean;\n  onOpenContext: (row: LogRowModel) => void;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  onPinLine?: (row: LogRowModel) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  pinned?: boolean;\n  mouseIsOver: boolean;\n  onBlur: () => void;\n  logRowMenuIconsBefore?: ReactNode[];\n  logRowMenuIconsAfter?: ReactNode[];\n  preview?: boolean;\n}\n\nexport const LogRowMessageDisplayedFields = memo((props: Props) => {\n  const {\n    row,\n    detectedFields,\n    getFieldLinks,\n    wrapLogMessage,\n    styles,\n    mouseIsOver,\n    pinned,\n    logRowMenuIconsBefore,\n    logRowMenuIconsAfter,\n    preview,\n    ...rest\n  } = props;\n  const wrapClassName = wrapLogMessage ? '' : displayedFieldsStyles.noWrap;\n  const fields = useMemo(() => getAllFields(row, getFieldLinks), [getFieldLinks, row]);\n  // only single key/value rows are filterable, so we only need the first field key for filtering\n  const line = useMemo(() => {\n    let line = '';\n    for (let i = 0; i < detectedFields.length; i++) {\n      const parsedKey = detectedFields[i];\n\n      if (parsedKey === LOG_LINE_BODY_FIELD_NAME) {\n        line += ` ${row.entry}`;\n      }\n\n      const field = fields.find((field) => {\n        return field.keys[0] === parsedKey;\n      });\n\n      if (field != null) {\n        line += ` ${parsedKey}=${field.values}`;\n      }\n\n      if (row.labels[parsedKey] != null && row.labels[parsedKey] != null) {\n        line += ` ${parsedKey}=${row.labels[parsedKey]}`;\n      }\n    }\n    return line.trimStart();\n  }, [detectedFields, fields, row.entry, row.labels]);\n\n  const shouldShowMenu = mouseIsOver || pinned;\n\n  if (preview) {\n    return (\n      <>\n        <td>\n          <div>{line}</div>\n        </td>\n        <td></td>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <td className={styles.logsRowMessage}>\n        <div className={wrapClassName}>{line}</div>\n      </td>\n      <td className={`log-row-menu-cell ${styles.logRowMenuCell}`}>\n        {shouldShowMenu && (\n          <LogRowMenuCell\n            logText={line}\n            row={row}\n            styles={styles}\n            pinned={pinned}\n            mouseIsOver={mouseIsOver}\n            addonBefore={logRowMenuIconsBefore}\n            addonAfter={logRowMenuIconsAfter}\n            {...rest}\n          />\n        )}\n      </td>\n    </>\n  );\n});\n\nconst displayedFieldsStyles = {\n  noWrap: css({\n    whiteSpace: 'nowrap',\n  }),\n};\n\nLogRowMessageDisplayedFields.displayName = 'LogRowMessageDisplayedFields';\n","import { debounce } from 'lodash';\nimport { MouseEvent, ReactNode, useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { CoreApp, DataFrame, dateTimeFormat, LogRowContextOptions, LogRowModel, LogsSortOrder } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { DataQuery, TimeZone } from '@grafana/schema';\nimport { Icon, PopoverContent, Tooltip, useTheme2 } from '@grafana/ui';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { checkLogsError, checkLogsSampled, escapeUnescapedString } from '../utils';\n\nimport { LogDetails } from './LogDetails';\nimport { LogLabels } from './LogLabels';\nimport { LogRowMessage } from './LogRowMessage';\nimport { LogRowMessageDisplayedFields } from './LogRowMessageDisplayedFields';\nimport { getLogLevelStyles, LogRowStyles } from './getLogRowStyles';\n\nexport interface Props {\n  row: LogRowModel;\n  showDuplicates: boolean;\n  showLabels: boolean;\n  showTime: boolean;\n  wrapLogMessage: boolean;\n  prettifyLogMessage: boolean;\n  timeZone: TimeZone;\n  enableLogDetails: boolean;\n  logsSortOrder?: LogsSortOrder | null;\n  forceEscape?: boolean;\n  app?: CoreApp;\n  displayedFields?: string[];\n  getRows: () => LogRowModel[];\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onContextClick?: () => void;\n  getFieldLinks?: GetFieldLinksFn;\n  showContextToggle?: (row: LogRowModel) => boolean;\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  onLogRowHover?: (row?: LogRowModel) => void;\n  onOpenContext: (row: LogRowModel, onClose: () => void) => void;\n  getRowContextQuery?: (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    cacheFilters?: boolean\n  ) => Promise<DataQuery | null>;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  styles: LogRowStyles;\n  permalinkedRowId?: string;\n  scrollIntoView?: (element: HTMLElement) => void;\n  isFilterLabelActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n  onPinLine?: (row: LogRowModel, allowUnPin?: boolean) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  pinned?: boolean;\n  handleTextSelection?: (e: MouseEvent<HTMLTableRowElement>, row: LogRowModel) => boolean;\n  logRowMenuIconsBefore?: ReactNode[];\n  logRowMenuIconsAfter?: ReactNode[];\n}\n\nexport const LogRow = ({\n  getRows,\n  onClickFilterLabel,\n  onClickFilterOutLabel,\n  onClickShowField,\n  onClickHideField,\n  enableLogDetails,\n  row,\n  showDuplicates,\n  showContextToggle,\n  showLabels,\n  showTime,\n  displayedFields,\n  wrapLogMessage,\n  prettifyLogMessage,\n  getFieldLinks,\n  forceEscape,\n  app,\n  styles,\n  getRowContextQuery,\n  pinned,\n  logRowMenuIconsBefore,\n  logRowMenuIconsAfter,\n  timeZone,\n  permalinkedRowId,\n  scrollIntoView,\n  handleTextSelection,\n  onLogRowHover,\n  ...props\n}: Props) => {\n  const [showingContext, setShowingContext] = useState(false);\n  const [showDetails, setShowDetails] = useState(false);\n  const [mouseIsOver, setMouseIsOver] = useState(false);\n  const [permalinked, setPermalinked] = useState(false);\n  const logLineRef = useRef<HTMLTableRowElement | null>(null);\n  const theme = useTheme2();\n\n  const timestamp = useMemo(\n    () =>\n      dateTimeFormat(row.timeEpochMs, {\n        timeZone: timeZone,\n        defaultWithMS: true,\n      }),\n    [row.timeEpochMs, timeZone]\n  );\n  const levelStyles = useMemo(() => getLogLevelStyles(theme, row.logLevel), [row.logLevel, theme]);\n  const processedRow = useMemo(\n    () => (row.hasUnescapedContent && forceEscape ? { ...row, entry: escapeUnescapedString(row.entry) } : row),\n    [forceEscape, row]\n  );\n  const errorMessage = checkLogsError(row);\n  const hasError = errorMessage !== undefined;\n  const sampleMessage = checkLogsSampled(row);\n  const isSampled = sampleMessage !== undefined;\n\n  useEffect(() => {\n    if (permalinkedRowId !== row.uid) {\n      setPermalinked(false);\n      return;\n    }\n    if (!permalinked) {\n      setPermalinked(true);\n      return;\n    }\n\n    if (logLineRef.current && scrollIntoView) {\n      // at this point this row is the permalinked row, so we need to scroll to it and highlight it if possible.\n      scrollIntoView(logLineRef.current);\n      reportInteraction('grafana_explore_logs_permalink_opened', {\n        datasourceType: row.datasourceType ?? 'unknown',\n        logRowUid: row.uid,\n      });\n      setPermalinked(true);\n    }\n  }, [permalinked, permalinkedRowId, row.datasourceType, row.uid, scrollIntoView]);\n\n  // we are debouncing the state change by 3 seconds to highlight the logline after the context closed.\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const debouncedContextClose = useCallback(\n    debounce(() => {\n      setShowingContext(false);\n    }, 3000),\n    []\n  );\n\n  const onOpenContext = useCallback(\n    (row: LogRowModel) => {\n      setShowingContext(true);\n      props.onOpenContext(row, debouncedContextClose);\n    },\n    [debouncedContextClose, props]\n  );\n\n  const onRowClick = useCallback(\n    (e: MouseEvent<HTMLTableRowElement>) => {\n      if (handleTextSelection?.(e, row)) {\n        // Event handled by the parent.\n        return;\n      }\n\n      if (!enableLogDetails) {\n        return;\n      }\n\n      setShowDetails((showDetails: boolean) => !showDetails);\n    },\n    [enableLogDetails, handleTextSelection, row]\n  );\n\n  const onMouseEnter = useCallback(() => {\n    setMouseIsOver(true);\n    if (onLogRowHover) {\n      onLogRowHover(row);\n    }\n  }, [onLogRowHover, row]);\n\n  const onMouseMove = useCallback(\n    (e: MouseEvent) => {\n      // No need to worry about text selection.\n      if (!handleTextSelection) {\n        return;\n      }\n      // The user is selecting text, so hide the log row menu so it doesn't interfere.\n      if (document.getSelection()?.toString() && e.buttons > 0) {\n        setMouseIsOver(false);\n      }\n    },\n    [handleTextSelection]\n  );\n\n  const onMouseLeave = useCallback(() => {\n    setMouseIsOver(false);\n  }, []);\n\n  return (\n    <>\n      <tr\n        ref={logLineRef}\n        className={`${styles.logsRow} ${hasError ? styles.errorLogRow : ''} ${showingContext || permalinked || pinned ? styles.highlightBackground : ''}`}\n        onClick={onRowClick}\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n        onMouseMove={onMouseMove}\n        /**\n         * For better accessibility support, we listen to the onFocus event here (to display the LogRowMenuCell), and\n         * to onBlur event in the LogRowMenuCell (to hide it). This way, the LogRowMenuCell is displayed when the user navigates\n         * using the keyboard.\n         */\n        onFocus={onMouseEnter}\n      >\n        {showDuplicates && (\n          <td className={styles.logsRowDuplicates}>\n            {processedRow.duplicates && processedRow.duplicates > 0 ? `${processedRow.duplicates + 1}x` : null}\n          </td>\n        )}\n        <td\n          className={\n            hasError || isSampled ? styles.logsRowWithError : `${levelStyles.logsRowLevelColor} ${styles.logsRowLevel}`\n          }\n        >\n          {hasError && (\n            <Tooltip\n              content={t('logs.log-row-message.tooltip-error', 'Error: {{errorMessage}}', { errorMessage })}\n              placement=\"right\"\n              theme=\"error\"\n            >\n              <Icon className={styles.logIconError} name=\"exclamation-triangle\" size=\"xs\" />\n            </Tooltip>\n          )}\n          {isSampled && (\n            <Tooltip content={sampleMessage} placement=\"right\" theme=\"info\">\n              <Icon className={styles.logIconInfo} name=\"info-circle\" size=\"xs\" />\n            </Tooltip>\n          )}\n        </td>\n        <td\n          title={enableLogDetails ? (showDetails ? 'Hide log details' : 'See log details') : ''}\n          className={enableLogDetails ? styles.logsRowToggleDetails : ''}\n        >\n          {enableLogDetails && (\n            <button\n              aria-label={t('logs.log-row-message.see-details', `See log details`)}\n              className={styles.detailsToggle}\n              aria-expanded={showDetails}\n            >\n              <Icon className={styles.topVerticalAlign} name={showDetails ? 'angle-down' : 'angle-right'} />\n            </button>\n          )}\n        </td>\n        {showTime && <td className={styles.logsRowLocalTime}>{timestamp}</td>}\n        {showLabels && processedRow.uniqueLabels && (\n          <td className={styles.logsRowLabels}>\n            <LogLabels labels={processedRow.uniqueLabels} addTooltip={false} />\n          </td>\n        )}\n        {displayedFields && displayedFields.length > 0 ? (\n          <LogRowMessageDisplayedFields\n            row={processedRow}\n            showContextToggle={showContextToggle}\n            detectedFields={displayedFields}\n            getFieldLinks={getFieldLinks}\n            wrapLogMessage={wrapLogMessage}\n            onOpenContext={onOpenContext}\n            onPermalinkClick={props.onPermalinkClick}\n            styles={styles}\n            onPinLine={props.onPinLine}\n            onUnpinLine={props.onUnpinLine}\n            pinned={pinned}\n            mouseIsOver={mouseIsOver}\n            onBlur={onMouseLeave}\n            logRowMenuIconsBefore={logRowMenuIconsBefore}\n            logRowMenuIconsAfter={logRowMenuIconsAfter}\n          />\n        ) : (\n          <LogRowMessage\n            row={processedRow}\n            showContextToggle={showContextToggle}\n            getRowContextQuery={getRowContextQuery}\n            wrapLogMessage={wrapLogMessage}\n            prettifyLogMessage={prettifyLogMessage}\n            onOpenContext={onOpenContext}\n            onPermalinkClick={props.onPermalinkClick}\n            app={app}\n            styles={styles}\n            onPinLine={props.onPinLine}\n            onUnpinLine={props.onUnpinLine}\n            pinLineButtonTooltipTitle={props.pinLineButtonTooltipTitle}\n            pinned={pinned}\n            mouseIsOver={mouseIsOver}\n            onBlur={onMouseLeave}\n            expanded={showDetails}\n            forceEscape={forceEscape}\n            logRowMenuIconsBefore={logRowMenuIconsBefore}\n            logRowMenuIconsAfter={logRowMenuIconsAfter}\n          />\n        )}\n      </tr>\n      {showDetails && (\n        <LogDetails\n          onPinLine={props.onPinLine}\n          className={`${styles.logsRow} ${hasError ? styles.errorLogRow : ''} ${permalinked && !showDetails ? styles.highlightBackground : ''}`}\n          showDuplicates={showDuplicates}\n          getFieldLinks={getFieldLinks}\n          onClickFilterLabel={onClickFilterLabel}\n          onClickFilterOutLabel={onClickFilterOutLabel}\n          onClickShowField={onClickShowField}\n          onClickHideField={onClickHideField}\n          getRows={getRows}\n          row={processedRow}\n          wrapLogMessage={wrapLogMessage}\n          hasError={hasError}\n          displayedFields={displayedFields}\n          app={app}\n          styles={styles}\n          isFilterLabelActive={props.isFilterLabelActive}\n          pinLineButtonTooltipTitle={props.pinLineButtonTooltipTitle}\n        />\n      )}\n    </>\n  );\n};\n","import { Props } from './LogRow';\nimport { LogRowMessageDisplayedFields } from './LogRowMessageDisplayedFields';\n\nconst emptyFn = () => {};\nexport const PreviewLogRow = ({ row, showDuplicates, showLabels, showTime, displayedFields, ...rest }: Props) => {\n  return (\n    <tr>\n      {showDuplicates && <td></td>}\n      <td></td>\n      <td></td>\n      {showTime && <td>{row.timeEpochMs}</td>}\n      {showLabels && row.uniqueLabels && <td></td>}\n      {displayedFields && displayedFields.length > 0 ? (\n        <LogRowMessageDisplayedFields\n          {...rest}\n          row={row}\n          detectedFields={displayedFields}\n          mouseIsOver={false}\n          onBlur={emptyFn}\n          onOpenContext={emptyFn}\n          preview\n        />\n      ) : (\n        <td className={rest.styles.logsRowMessage}>{row.entry}</td>\n      )}\n      <td className={`log-row-menu-cell ${rest.styles.logRowMenuCell}`}></td>\n    </tr>\n  );\n};\n","import { cx } from '@emotion/css';\nimport { MouseEvent, ReactNode, useState, useMemo, useCallback, useRef, useEffect, memo } from 'react';\n\nimport {\n  TimeZone,\n  LogsDedupStrategy,\n  LogRowModel,\n  LogsSortOrder,\n  CoreApp,\n  DataFrame,\n  LogRowContextOptions,\n} from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport { DataQuery } from '@grafana/schema';\nimport { ConfirmModal, Icon, PopoverContent, useTheme2 } from '@grafana/ui';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { PopoverMenu } from '../../explore/Logs/PopoverMenu';\nimport { UniqueKeyMaker } from '../UniqueKeyMaker';\nimport { disablePopoverMenu, enablePopoverMenu, isPopoverMenuDisabled, sortLogRows, targetIsElement } from '../utils';\n\n//Components\nimport { LogRow } from './LogRow';\nimport { PreviewLogRow } from './PreviewLogRow';\nimport { getLogRowStyles } from './getLogRowStyles';\n\nexport interface Props {\n  logRows?: LogRowModel[];\n  deduplicatedRows?: LogRowModel[];\n  dedupStrategy: LogsDedupStrategy;\n  showLabels: boolean;\n  showTime: boolean;\n  wrapLogMessage: boolean;\n  prettifyLogMessage: boolean;\n  timeZone: TimeZone;\n  enableLogDetails: boolean;\n  logsSortOrder?: LogsSortOrder | null;\n  previewLimit?: number;\n  forceEscape?: boolean;\n  displayedFields?: string[];\n  app?: CoreApp;\n  showContextToggle?: (row: LogRowModel) => boolean;\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  getFieldLinks?: GetFieldLinksFn;\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  onPinLine?: (row: LogRowModel, allowUnPin?: boolean) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  onLogRowHover?: (row?: LogRowModel) => void;\n  onOpenContext?: (row: LogRowModel, onClose: () => void) => void;\n  getRowContextQuery?: (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    cacheFilters?: boolean\n  ) => Promise<DataQuery | null>;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  permalinkedRowId?: string;\n  scrollIntoView?: (element: HTMLElement) => void;\n  isFilterLabelActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n  pinnedLogs?: string[];\n  /**\n   * If false or undefined, the `contain:strict` css property will be added to the wrapping `<table>` for performance reasons.\n   * Any overflowing content will be clipped at the table boundary.\n   */\n  overflowingContent?: boolean;\n  onClickFilterString?: (value: string, refId?: string) => void;\n  onClickFilterOutString?: (value: string, refId?: string) => void;\n  logRowMenuIconsBefore?: ReactNode[];\n  logRowMenuIconsAfter?: ReactNode[];\n  scrollElement: HTMLDivElement | null;\n  renderPreview?: boolean;\n}\n\nexport type PopoverStateType = {\n  selection: string;\n  selectedRow: LogRowModel | null;\n  popoverMenuCoordinates: { x: number; y: number };\n};\n\nexport const LogRows = memo(\n  ({\n    deduplicatedRows,\n    logRows = [],\n    dedupStrategy,\n    logsSortOrder,\n    previewLimit,\n    pinnedLogs,\n    onOpenContext,\n    onClickFilterOutString,\n    onClickFilterString,\n    scrollElement,\n    renderPreview = false,\n    enableLogDetails,\n    permalinkedRowId,\n    ...props\n  }: Props) => {\n    const [previewSize, setPreviewSize] = useState(\n      /**\n       * If renderPreview is enabled, either half of the log rows or twice the screen size of log rows will be rendered.\n       * The biggest of those values will be used. Else, all rows are rendered.\n       */\n      renderPreview && !permalinkedRowId\n        ? Math.max(2 * Math.ceil(window.innerHeight / 20), Math.ceil(logRows.length / 3))\n        : Infinity\n    );\n    const [popoverState, setPopoverState] = useState<PopoverStateType>({\n      selection: '',\n      selectedRow: null,\n      popoverMenuCoordinates: { x: 0, y: 0 },\n    });\n    const [showDisablePopoverOptions, setShowDisablePopoverOptions] = useState(false);\n    const logRowsRef = useRef<HTMLDivElement>(null);\n    const theme = useTheme2();\n    const styles = getLogRowStyles(theme);\n    const dedupedRows = deduplicatedRows ? deduplicatedRows : logRows;\n    const dedupCount = useMemo(\n      () => dedupedRows.reduce((sum, row) => (row.duplicates ? sum + row.duplicates : sum), 0),\n      [dedupedRows]\n    );\n    const showDuplicates = dedupStrategy !== LogsDedupStrategy.none && dedupCount > 0;\n    const orderedRows = useMemo(\n      () => (logsSortOrder ? sortLogRows(dedupedRows, logsSortOrder) : dedupedRows),\n      [dedupedRows, logsSortOrder]\n    );\n    // React profiler becomes unusable if we pass all rows to all rows and their labels, using getter instead\n    const getRows = useMemo(() => () => orderedRows, [orderedRows]);\n    const handleDeselectionRef = useRef<((e: Event) => void) | null>(null);\n    const keyMaker = new UniqueKeyMaker();\n\n    useEffect(() => {\n      return () => {\n        if (handleDeselectionRef.current) {\n          document.removeEventListener('click', handleDeselectionRef.current);\n          document.removeEventListener('contextmenu', handleDeselectionRef.current);\n        }\n      };\n    }, []);\n\n    useEffect(() => {\n      if (!scrollElement) {\n        return;\n      }\n\n      function renderAll() {\n        setPreviewSize(Infinity);\n        scrollElement?.removeEventListener('scroll', renderAll);\n        scrollElement?.removeEventListener('wheel', renderAll);\n      }\n\n      scrollElement.addEventListener('scroll', renderAll);\n      scrollElement.addEventListener('wheel', renderAll);\n    }, [logRows.length, scrollElement]);\n\n    /**\n     * Toggle the `contextIsOpen` state when a context of one LogRow is opened in order to not show the menu of the other log rows.\n     */\n    const openContext = useCallback(\n      (row: LogRowModel, onClose: () => void): void => {\n        if (onOpenContext) {\n          onOpenContext(row, onClose);\n        }\n      },\n      [onOpenContext]\n    );\n\n    const popoverMenuSupported = useCallback(() => {\n      if (!config.featureToggles.logRowsPopoverMenu || isPopoverMenuDisabled()) {\n        return false;\n      }\n      return Boolean(onClickFilterOutString || onClickFilterString);\n    }, [onClickFilterOutString, onClickFilterString]);\n\n    const closePopoverMenu = useCallback(() => {\n      if (handleDeselectionRef.current) {\n        document.removeEventListener('click', handleDeselectionRef.current);\n        document.removeEventListener('contextmenu', handleDeselectionRef.current);\n        handleDeselectionRef.current = null;\n      }\n      setPopoverState({\n        selection: '',\n        popoverMenuCoordinates: { x: 0, y: 0 },\n        selectedRow: null,\n      });\n    }, []);\n\n    const handleDeselection = useCallback(\n      (e: Event) => {\n        if (targetIsElement(e.target) && !logRowsRef.current?.contains(e.target)) {\n          // The mouseup event comes from outside the log rows, close the menu.\n          closePopoverMenu();\n          return;\n        }\n        if (document.getSelection()?.toString()) {\n          return;\n        }\n        closePopoverMenu();\n      },\n      [closePopoverMenu]\n    );\n\n    const handleSelection = useCallback(\n      (e: MouseEvent<HTMLElement>, row: LogRowModel): boolean => {\n        const selection = document.getSelection()?.toString();\n        if (!selection) {\n          return false;\n        }\n        if (e.altKey) {\n          enablePopoverMenu();\n        }\n        if (popoverMenuSupported() === false) {\n          // This signals onRowClick inside LogRow to skip the event because the user is selecting text\n          return selection ? true : false;\n        }\n\n        if (!logRowsRef.current) {\n          return false;\n        }\n\n        const MENU_WIDTH = 270;\n        const MENU_HEIGHT = 105;\n        const x = e.clientX + MENU_WIDTH > window.innerWidth ? window.innerWidth - MENU_WIDTH : e.clientX;\n        const y = e.clientY + MENU_HEIGHT > window.innerHeight ? window.innerHeight - MENU_HEIGHT : e.clientY;\n\n        setPopoverState({\n          selection,\n          popoverMenuCoordinates: { x, y },\n          selectedRow: row,\n        });\n        handleDeselectionRef.current = handleDeselection;\n        document.addEventListener('click', handleDeselection);\n        document.addEventListener('contextmenu', handleDeselection);\n        return true;\n      },\n      [handleDeselection, popoverMenuSupported]\n    );\n\n    const onDisablePopoverMenu = useCallback(() => {\n      setShowDisablePopoverOptions(true);\n    }, []);\n\n    const onDisableCancel = useCallback(() => {\n      setShowDisablePopoverOptions(false);\n    }, []);\n\n    const onDisableConfirm = useCallback(() => {\n      disablePopoverMenu();\n      setShowDisablePopoverOptions(false);\n    }, []);\n\n    return (\n      <div className={styles.logRows} ref={logRowsRef}>\n        {popoverState.selection && popoverState.selectedRow && (\n          <PopoverMenu\n            close={closePopoverMenu}\n            row={popoverState.selectedRow}\n            selection={popoverState.selection}\n            {...popoverState.popoverMenuCoordinates}\n            onClickFilterString={onClickFilterString}\n            onClickFilterOutString={onClickFilterOutString}\n            onDisable={onDisablePopoverMenu}\n          />\n        )}\n        {showDisablePopoverOptions && (\n          <ConfirmModal\n            isOpen\n            title={t('logs.log-rows.disable-popover.title', 'Disable menu')}\n            body={\n              <>\n                <Trans i18nKey=\"logs.log-rows.disable-popover.message\">\n                  You are about to disable the logs filter menu. To re-enable it, select text in a log line while\n                  holding the alt key.\n                </Trans>\n                <div className={styles.shortcut}>\n                  <Icon name=\"keyboard\" />\n                  <Trans i18nKey=\"logs.log-rows.disable-popover-message.shortcut\">alt+select to enable again</Trans>\n                </div>\n              </>\n            }\n            confirmText={t('logs.log-rows.disable-popover.confirm', 'Confirm')}\n            icon=\"exclamation-triangle\"\n            onConfirm={onDisableConfirm}\n            onDismiss={onDisableCancel}\n          />\n        )}\n        <table className={cx(styles.logsRowsTable, props.overflowingContent ? '' : styles.logsRowsTableContain)}>\n          <tbody>\n            {orderedRows.map((row, index) =>\n              index < previewSize ? (\n                <LogRow\n                  key={keyMaker.getKey(row.uid)}\n                  getRows={getRows}\n                  row={row}\n                  showDuplicates={showDuplicates}\n                  logsSortOrder={logsSortOrder}\n                  onOpenContext={openContext}\n                  styles={styles}\n                  onPermalinkClick={props.onPermalinkClick}\n                  scrollIntoView={props.scrollIntoView}\n                  permalinkedRowId={permalinkedRowId}\n                  onPinLine={props.onPinLine}\n                  onUnpinLine={props.onUnpinLine}\n                  pinLineButtonTooltipTitle={props.pinLineButtonTooltipTitle}\n                  pinned={pinnedLogs?.some((logId) => logId === row.rowId || logId === row.uid)}\n                  isFilterLabelActive={props.isFilterLabelActive}\n                  handleTextSelection={handleSelection}\n                  enableLogDetails={enableLogDetails}\n                  {...props}\n                />\n              ) : (\n                <PreviewLogRow\n                  key={`preview_${keyMaker.getKey(row.uid)}`}\n                  enableLogDetails={false}\n                  getRows={getRows}\n                  onOpenContext={openContext}\n                  styles={styles}\n                  showDuplicates={showDuplicates}\n                  {...props}\n                  row={row}\n                />\n              )\n            )}\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n);\n","import { css } from '@emotion/css';\nimport memoizeOne from 'memoize-one';\nimport tinycolor from 'tinycolor2';\n\nimport { colorManipulator, GrafanaTheme2, LogLevel } from '@grafana/data';\nimport { styleMixins } from '@grafana/ui';\n\nexport const getLogLevelStyles = (theme: GrafanaTheme2, logLevel?: LogLevel) => {\n  let logColor = theme.isLight ? theme.v1.palette.gray5 : theme.v1.palette.gray2;\n  switch (logLevel) {\n    case LogLevel.crit:\n    case LogLevel.critical:\n      logColor = '#705da0';\n      break;\n    case LogLevel.error:\n    case LogLevel.err:\n      logColor = '#e24d42';\n      break;\n    case LogLevel.warning:\n    case LogLevel.warn:\n      logColor = theme.colors.warning.main;\n      break;\n    case LogLevel.info:\n      logColor = '#7eb26d';\n      break;\n    case LogLevel.debug:\n      logColor = '#1f78c1';\n      break;\n    case LogLevel.trace:\n      logColor = '#6ed0e0';\n      break;\n  }\n\n  return {\n    logsRowLevelColor: css({\n      '&::after': {\n        backgroundColor: logColor,\n      },\n    }),\n  };\n};\n\nexport const getLogRowStyles = memoizeOne((theme: GrafanaTheme2) => {\n  const hoverBgColor = styleMixins.hoverColor(theme.colors.background.secondary, theme);\n  const contextOutlineColor = tinycolor(theme.components.dashboard.background).setAlpha(0.7).toRgbString();\n  return {\n    logsRowLevel: css({\n      label: 'logs-row__level',\n      maxWidth: theme.spacing(1.25),\n      cursor: 'default',\n      '&::after': {\n        content: \"''\",\n        display: 'block',\n        position: 'absolute',\n        top: '1px',\n        bottom: '1px',\n        width: '3px',\n        left: theme.spacing(0.5),\n      },\n    }),\n    // Compared to logsRowLevel we need to make error logs wider to accommodate the icon\n    logsRowWithError: css({\n      maxWidth: `${theme.spacing(1.5)}`,\n    }),\n    logsRowMatchHighLight: css({\n      label: 'logs-row__match-highlight',\n      background: 'inherit',\n      padding: 'inherit',\n      color: theme.components.textHighlight.text,\n      backgroundColor: theme.components.textHighlight.background,\n    }),\n    logRows: css({\n      position: 'relative',\n    }),\n    shortcut: css({\n      display: 'inline-flex',\n      alignItems: 'center',\n      gap: theme.spacing(1),\n      color: theme.colors.text.secondary,\n      opacity: 0.7,\n      fontSize: theme.typography.bodySmall.fontSize,\n      marginTop: theme.spacing(1),\n    }),\n    logsRowsTable: css({\n      label: 'logs-rows',\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n      width: '100%',\n      position: 'relative',\n    }),\n    logsRowsTableContain: css({\n      contain: 'strict',\n    }),\n    highlightBackground: css({\n      backgroundColor: tinycolor(theme.colors.info.transparent).setAlpha(0.25).toString(),\n    }),\n    logsRow: css({\n      label: 'logs-row',\n      width: '100%',\n      cursor: 'pointer',\n      verticalAlign: 'top',\n\n      '&:focus-within': {\n        outline: `2px solid ${theme.colors.primary.border}`,\n        outlineOffset: '-2px',\n      },\n\n      '&:hover': {\n        '.log-row-menu': {\n          zIndex: 1,\n        },\n\n        background: hoverBgColor,\n      },\n\n      'td:not(.log-row-menu-cell):last-child': {\n        width: '100%',\n      },\n\n      '> td:not(.log-row-menu-cell)': {\n        position: 'relative',\n        paddingRight: theme.spacing(1),\n        borderTop: '1px solid transparent',\n        borderBottom: '1px solid transparent',\n        height: '100%',\n      },\n    }),\n    logsRowDuplicates: css({\n      label: 'logs-row__duplicates',\n      textAlign: 'right',\n      width: '4em',\n      cursor: 'default',\n    }),\n    logIconError: css({\n      color: theme.colors.warning.main,\n      position: 'relative',\n      top: '-2px',\n    }),\n    logIconInfo: css({\n      color: theme.colors.info.main,\n      position: 'relative',\n      top: '-2px',\n    }),\n    logsRowToggleDetails: css({\n      label: 'logs-row-toggle-details__level',\n      fontSize: '9px',\n      maxWidth: '15px',\n    }),\n    logsRowLocalTime: css({\n      label: 'logs-row__localtime',\n      whiteSpace: 'nowrap',\n    }),\n    logsRowLabels: css({\n      label: 'logs-row__labels',\n      whiteSpace: 'nowrap',\n      maxWidth: '22em',\n\n      /* This is to make the labels vertical align */\n      '> span': {\n        marginTop: '0.75px',\n      },\n    }),\n    logsRowMessage: css({\n      label: 'logs-row__message',\n      whiteSpace: 'pre-wrap',\n      wordBreak: 'break-all',\n      overflowWrap: 'anywhere',\n      width: '100%',\n      textAlign: 'left',\n    }),\n    copyLogButton: css({\n      padding: theme.spacing(0, 0, 0, 0.5),\n      height: theme.spacing(3),\n      width: theme.spacing(3.25),\n      lineHeight: theme.spacing(2.5),\n      overflow: 'hidden',\n      '&:hover': {\n        backgroundColor: colorManipulator.alpha(theme.colors.text.primary, 0.12),\n      },\n    }),\n    //Log details specific CSS\n    logDetailsContainer: css({\n      label: 'logs-row-details-table',\n      border: `1px solid ${theme.colors.border.medium}`,\n      padding: theme.spacing(0, 1, 1),\n      borderRadius: theme.shape.radius.default,\n      margin: theme.spacing(2.5, 1, 2.5, 2),\n      cursor: 'default',\n    }),\n    logDetailsTable: css({\n      label: 'logs-row-details-table',\n      lineHeight: '18px',\n      width: '100%',\n      'td:last-child': {\n        width: '100%',\n      },\n    }),\n    logsDetailsIcon: css({\n      label: 'logs-row-details__icon',\n      position: 'relative',\n      color: theme.v1.palette.gray3,\n      paddingTop: '1px',\n      paddingBottom: '1px',\n      paddingRight: theme.spacing(0.75),\n    }),\n    logDetailsLabel: css({\n      label: 'logs-row-details__label',\n      maxWidth: '30em',\n      padding: theme.spacing(0, 1),\n      overflowWrap: 'break-word',\n    }),\n    logDetailsHeading: css({\n      label: 'logs-row-details__heading',\n      fontWeight: theme.typography.fontWeightBold,\n      padding: theme.spacing(1, 0, 0.5),\n    }),\n    logDetailsValue: css({\n      label: 'logs-row-details__row',\n      position: 'relative',\n      verticalAlign: 'middle',\n      cursor: 'default',\n\n      '&:hover': {\n        backgroundColor: hoverBgColor,\n      },\n    }),\n    detailsToggle: css({\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      padding: 0,\n      // Don't increase the height of the row\n      maxHeight: '19px',\n\n      // Don't show default button box-shadow on focus, we apply outline to the entire row instead\n      '&:focus-visible': {\n        boxShadow: 'none',\n      },\n\n      '&:focus': {\n        outline: 0,\n      },\n      '&:after': {\n        content: '\"\"',\n        inset: 0,\n        position: 'absolute',\n      },\n    }),\n\n    // Log row\n    topVerticalAlign: css({\n      label: 'topVerticalAlign',\n      marginTop: theme.spacing(-0.9),\n      marginLeft: theme.spacing(-0.25),\n    }),\n    detailsOpen: css({\n      '&:hover': {\n        backgroundColor: styleMixins.hoverColor(theme.colors.background.primary, theme),\n      },\n    }),\n    errorLogRow: css({\n      label: 'erroredLogRow',\n      color: theme.colors.text.secondary,\n    }),\n    // Log Row Message\n    positionRelative: css({\n      label: 'positionRelative',\n      position: 'relative',\n    }),\n    rowWithContext: css({\n      label: 'rowWithContext',\n      zIndex: 1,\n      outline: `9999px solid ${contextOutlineColor}`,\n      display: 'inherit',\n    }),\n    horizontalScroll: css({\n      label: 'horizontalScroll',\n      whiteSpace: 'pre',\n    }),\n    contextNewline: css({\n      display: 'block',\n      marginLeft: '0px',\n    }),\n    rowMenu: css({\n      label: 'rowMenu',\n      display: 'flex',\n      flexWrap: 'nowrap',\n      flexDirection: 'row',\n      alignContent: 'flex-end',\n      justifyContent: 'space-evenly',\n      alignItems: 'center',\n      position: 'absolute',\n      top: 0,\n      bottom: 'auto',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      padding: theme.spacing(0.5, 1, 0.5, 1),\n      zIndex: 100,\n      gap: theme.spacing(0.5),\n\n      '& > button': {\n        margin: 0,\n      },\n    }),\n    logRowMenuCell: css({\n      position: 'sticky',\n      zIndex: theme.zIndex.dropdown,\n      marginTop: theme.spacing(-0.125),\n      right: 0,\n\n      '& > span': {\n        transform: 'translateX(-100%)',\n      },\n    }),\n    logLine: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n      letterSpacing: theme.typography.bodySmall.letterSpacing,\n      textAlign: 'left',\n      padding: 0,\n      userSelect: 'text',\n    }),\n    // Log details\n    logsRowLevelDetails: css({\n      label: 'logs-row__level_details',\n      '&::after': {\n        top: '-3px',\n      },\n    }),\n    logDetails: css({\n      label: 'logDetailsDefaultCursor',\n      cursor: 'default',\n\n      '&:hover': {\n        backgroundColor: theme.colors.background.primary,\n      },\n    }),\n    visibleRowMenu: css({\n      label: 'visibleRowMenu',\n      aspectRatio: '1/1',\n      zIndex: 90,\n    }),\n    linkButton: css({\n      label: 'linkButton',\n      '> button': {\n        paddingTop: theme.spacing(0.5),\n      },\n    }),\n    hidden: css({\n      label: 'hidden',\n      visibility: 'hidden',\n    }),\n    unPinButton: css({\n      height: theme.spacing(3),\n      lineHeight: theme.spacing(2.5),\n    }),\n  };\n});\n\nexport type LogRowStyles = ReturnType<typeof getLogRowStyles>;\n","import { css } from '@emotion/css';\nimport { useCallback } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, InlineSwitch, useStyles2 } from '@grafana/ui';\n\nexport type Props = {\n  wrapLines?: boolean;\n  onChangeWrapLines: (wrapLines: boolean) => void;\n  onScrollCenterClick: () => void;\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    buttons: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n  };\n}\n\nexport const LogContextButtons = (props: Props) => {\n  const styles = useStyles2(getStyles);\n  const { wrapLines, onChangeWrapLines, onScrollCenterClick } = props;\n  const internalOnChangeWrapLines = useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      const state = event.currentTarget.checked;\n      reportInteraction('grafana_explore_logs_log_context_toggle_lines_clicked', {\n        state,\n      });\n      onChangeWrapLines(state);\n    },\n    [onChangeWrapLines]\n  );\n\n  return (\n    <div className={styles.buttons}>\n      <InlineSwitch\n        showLabel\n        value={wrapLines}\n        onChange={internalOnChangeWrapLines}\n        label={t('logs.log-context-buttons.label-wrap-lines', 'Wrap lines')}\n      />\n      <Button variant=\"secondary\" onClick={onScrollCenterClick}>\n        <Trans i18nKey=\"logs.log-context-buttons.center-matched-line\">Center matched line</Trans>\n      </Button>\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport { partition } from 'lodash';\nimport { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { useAsync } from 'react-use';\n\nimport {\n  DataQueryResponse,\n  DataSourceWithLogsContextSupport,\n  GrafanaTheme2,\n  LogRowContextOptions,\n  LogRowContextQueryDirection,\n  LogRowModel,\n  LogsDedupStrategy,\n  LogsSortOrder,\n  dateTime,\n  TimeRange,\n  LoadingState,\n} from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { DataQuery, TimeZone } from '@grafana/schema';\nimport { Button, Modal, useTheme2 } from '@grafana/ui';\nimport store from 'app/core/store';\nimport { SETTINGS_KEYS } from 'app/features/explore/Logs/utils/logs';\nimport { splitOpen } from 'app/features/explore/state/main';\nimport { useDispatch } from 'app/types/store';\n\nimport { dataFrameToLogsModel } from '../../logsModel';\nimport { sortLogRows } from '../../utils';\nimport { LoadingIndicator } from '../LoadingIndicator';\nimport { LogRows } from '../LogRows';\n\nimport { LogContextButtons } from './LogContextButtons';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    modal: css({\n      width: '85vw',\n      [theme.breakpoints.down('md')]: {\n        width: '100%',\n      },\n      top: '50%',\n      left: '50%',\n      transform: 'translate(-50%, -50%)',\n    }),\n    sticky: css({\n      position: 'sticky',\n      zIndex: 1,\n      top: '-1px',\n      bottom: '-1px',\n    }),\n    entry: css({\n      '& > td': {\n        padding: theme.spacing(1, 0, 1, 0),\n      },\n      background: theme.colors.emphasize(theme.colors.background.secondary),\n\n      '& > table': {\n        marginBottom: 0,\n      },\n\n      '& .log-row-menu': {\n        marginTop: '-6px',\n      },\n    }),\n    datasourceUi: css({\n      paddingBottom: theme.spacing(1.25),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    logRowGroups: css({\n      overflow: 'auto',\n      maxHeight: '75%',\n      alignSelf: 'stretch',\n      display: 'inline-block',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      '& > table': {\n        minWidth: '100%',\n      },\n    }),\n    flexColumn: css({\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.spacing(0, 3, 3, 3),\n    }),\n    flexRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      '& > div:last-child': {\n        marginLeft: 'auto',\n      },\n    }),\n    noMarginBottom: css({\n      '& > table': {\n        marginBottom: 0,\n      },\n    }),\n    hidden: css({\n      display: 'none',\n    }),\n    paddingTop: css({\n      paddingTop: theme.spacing(1),\n    }),\n    paddingBottom: css({\n      paddingBottom: theme.spacing(1),\n    }),\n    link: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      ':hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n    loadingCell: css({\n      position: 'sticky',\n      left: '50%',\n      display: 'inline-block',\n      transform: 'translateX(-50%)',\n    }),\n  };\n};\n\ninterface LogRowContextModalProps {\n  row: LogRowModel;\n  open: boolean;\n  timeZone: TimeZone;\n  onClose: () => void;\n  getRowContext: (row: LogRowModel, options: LogRowContextOptions) => Promise<DataQueryResponse>;\n\n  getRowContextQuery?: (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    cacheFilters?: boolean\n  ) => Promise<DataQuery | null>;\n  logsSortOrder: LogsSortOrder;\n  runContextQuery?: () => void;\n  getLogRowContextUi?: DataSourceWithLogsContextSupport['getLogRowContextUi'];\n}\n\ntype Section = {\n  loadingState: LoadingState;\n  rows: LogRowModel[];\n};\ntype Place = 'above' | 'below';\ntype Context = Record<Place, Section>;\n\nconst makeEmptyContext = (): Context => ({\n  above: { loadingState: LoadingState.NotStarted, rows: [] },\n  below: { loadingState: LoadingState.NotStarted, rows: [] },\n});\n\nconst getLoadMoreDirection = (place: Place, sortOrder: LogsSortOrder): LogRowContextQueryDirection => {\n  if (place === 'above' && sortOrder === LogsSortOrder.Descending) {\n    return LogRowContextQueryDirection.Forward;\n  }\n  if (place === 'below' && sortOrder === LogsSortOrder.Ascending) {\n    return LogRowContextQueryDirection.Forward;\n  }\n\n  return LogRowContextQueryDirection.Backward;\n};\n\ntype LoadCounter = Record<Place, number>;\n\nconst normalizeLogRowRefId = (row: LogRowModel, counter: LoadCounter): LogRowModel => {\n  // the datasoure plugins often create the context-query based on the row's dataframe's refId,\n  // by appending something to it. for example:\n  // - let's say the row's dataframe's refId is \"query\"\n  // - the datasource plugin will take \"query\" and append \"-context\" to it, so it becomes \"query-context\".\n  // - later we want to load even more lines, so we make a context query\n  // - the datasource plugin does the same transform again, but now the source is \"query-context\",\n  //   so the new refId becomes \"query-context-context\"\n  // - next time it becomes \"query-context-context-context\", and so on.\n  // we do not want refIds to grow unbounded.\n  // to avoid this, we set the refId to a value that does not grow.\n  // on the other hand, the refId is also used in generating the row's UID, so it is useful\n  // when the refId is not always the exact same string, otherwise UID duplication can occur,\n  // which may cause problems.\n  // so we go with an approach where the refId always changes, but does not grow.\n  return {\n    ...row,\n    dataFrame: {\n      ...row.dataFrame,\n      refId: `context_${counter.above}_${counter.below}`,\n    },\n  };\n};\n\nconst containsRow = (rows: LogRowModel[], row: LogRowModel) => {\n  return rows.some((r) => r.entry === row.entry && r.timeEpochNs === row.timeEpochNs);\n};\n\nconst PAGE_SIZE = 100;\n\nexport const LogRowContextModal: React.FunctionComponent<LogRowContextModalProps> = ({\n  row,\n  open,\n  logsSortOrder,\n  timeZone,\n  getLogRowContextUi,\n  getRowContextQuery,\n  onClose,\n  getRowContext,\n}) => {\n  const scrollElement = useRef<HTMLDivElement | null>(null);\n  const entryElement = useRef<HTMLTableRowElement | null>(null);\n  // We can not use `entryElement` to scroll to the right element because it's\n  // sticky. That's why we add another row and use this ref to scroll to that\n  // first.\n  const preEntryElement = useRef<HTMLTableRowElement | null>(null);\n\n  const prevScrollHeightRef = useRef<number | null>(null);\n  const prevClientHeightRef = useRef<number | null>(null);\n\n  const aboveLoadingElement = useRef<HTMLDivElement | null>(null);\n  const belowLoadingElement = useRef<HTMLDivElement | null>(null);\n\n  const loadCountRef = useRef<LoadCounter>({ above: 0, below: 0 });\n\n  const dispatch = useDispatch();\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  const [sticky, setSticky] = useState(true);\n\n  // we need to keep both the \"above\" and \"below\" rows\n  // in the same react-state, to be able to atomically change both\n  // at the same time.\n  // we create the `setSection` convenience function to adjust any\n  // part of it easily.\n  const [context, setContext] = useState<Context>(makeEmptyContext());\n  const setSection = (place: Place, fun: (s: Section) => Section) => {\n    setContext((c) => {\n      const newContext = { ...c };\n      newContext[place] = fun(c[place]);\n      return newContext;\n    });\n  };\n\n  // this is used to \"cancel\" the ongoing load-more requests.\n  // whenever we want to cancel them, we increment this number.\n  // and when those requests return, we check if the number\n  // is still the same as when we started. and if it is not the same,\n  // we ignore the results.\n  //\n  // best would be to literally cancel those requests,\n  // but right now there's no way with the current logs-context API.\n  const generationRef = useRef(1);\n\n  const [contextQuery, setContextQuery] = useState<DataQuery | null>(null);\n  const [wrapLines, setWrapLines] = useState(\n    store.getBool(SETTINGS_KEYS.logContextWrapLogMessage, store.getBool(SETTINGS_KEYS.wrapLogMessage, true))\n  );\n  const getFullTimeRange = useCallback(() => {\n    const { below, above } = context;\n    const allRows = sortLogRows([...below.rows, row, ...above.rows], LogsSortOrder.Ascending);\n    const fromMs = allRows[0].timeEpochMs;\n    let toMs = allRows[allRows.length - 1].timeEpochMs;\n    // In case we have a lot of logs and from and to have same millisecond\n    // we add 1 millisecond to toMs to make sure we have a range\n    if (fromMs === toMs) {\n      toMs += 1;\n    }\n    const from = dateTime(fromMs);\n    const to = dateTime(toMs);\n\n    const range: TimeRange = {\n      from,\n      to,\n      raw: {\n        from,\n        to,\n      },\n    };\n    return range;\n  }, [context, row]);\n\n  const updateContextQuery = useCallback(async () => {\n    const contextQuery = getRowContextQuery ? await getRowContextQuery(row) : null;\n    setContextQuery(contextQuery);\n  }, [row, getRowContextQuery]);\n\n  const updateResults = async () => {\n    await updateContextQuery();\n    setContext(makeEmptyContext());\n    loadCountRef.current = { above: 0, below: 0 };\n    generationRef.current += 1; // results from currently running loadMore calls will be ignored\n  };\n\n  const loadMore = async (place: Place, allRows: LogRowModel[]): Promise<LogRowModel[]> => {\n    loadCountRef.current[place] += 1;\n    const refRow = allRows.at(place === 'above' ? 0 : -1);\n    if (refRow == null) {\n      throw new Error('should never happen. the array always contains at least 1 item (the middle row)');\n    }\n\n    reportInteraction('grafana_explore_logs_log_context_load_more_called', {\n      datasourceType: refRow.datasourceType,\n      above: loadCountRef.current.above,\n      below: loadCountRef.current.below,\n    });\n\n    const direction = getLoadMoreDirection(place, logsSortOrder);\n\n    const result = await getRowContext(normalizeLogRowRefId(refRow, loadCountRef.current), {\n      limit: PAGE_SIZE,\n      direction,\n    });\n    const newRows = dataFrameToLogsModel(result.data).rows;\n\n    if (logsSortOrder === LogsSortOrder.Ascending) {\n      newRows.reverse();\n    }\n\n    const out = newRows.filter((r) => {\n      return !containsRow(allRows, r);\n    });\n\n    return out;\n  };\n\n  useEffect(() => {\n    if (open) {\n      updateContextQuery();\n    }\n  }, [updateContextQuery, open]);\n\n  const [displayedFields, setDisplayedFields] = useState<string[]>([]);\n\n  const showField = (key: string) => {\n    const index = displayedFields.indexOf(key);\n\n    if (index === -1) {\n      setDisplayedFields([...displayedFields, key]);\n    }\n  };\n\n  const hideField = (key: string) => {\n    const index = displayedFields.indexOf(key);\n\n    if (index > -1) {\n      displayedFields.splice(index, 1);\n      setDisplayedFields([...displayedFields]);\n    }\n  };\n\n  const maybeLoadMore = async (place: Place) => {\n    const { below, above } = context;\n    const section = context[place];\n    if (section.loadingState === LoadingState.Loading) {\n      return;\n    }\n\n    setSection(place, (section) => ({\n      ...section,\n      loadingState: LoadingState.Loading,\n    }));\n\n    const currentGen = generationRef.current;\n    try {\n      // we consider all the currently existing rows, even the original row,\n      // this way this array of rows will never be empty\n      const allRows = [...above.rows, row, ...below.rows];\n\n      const newRows = (await loadMore(place, allRows)).map((r) =>\n        // apply the original row's searchWords to all the rows for highlighting\n        !r.searchWords || !r.searchWords?.length ? { ...r, searchWords: row.searchWords } : r\n      );\n      const [older, newer] = partition(newRows, (newRow) => newRow.timeEpochNs > row.timeEpochNs);\n      const newAbove = logsSortOrder === LogsSortOrder.Ascending ? newer : older;\n      const newBelow = logsSortOrder === LogsSortOrder.Ascending ? older : newer;\n\n      if (currentGen === generationRef.current) {\n        setContext((c) => {\n          // we should only modify the row-arrays if necessary\n          const sortedNewAbove =\n            newAbove.length > 0 ? sortLogRows([...newAbove, ...c.above.rows], logsSortOrder) : c.above.rows;\n          const sortedNewBelow =\n            newBelow.length > 0 ? sortLogRows([...c.below.rows, ...newBelow], logsSortOrder) : c.below.rows;\n          return {\n            above: {\n              rows: sortedNewAbove,\n              loadingState:\n                place === 'above'\n                  ? newRows.length === 0\n                    ? LoadingState.Done\n                    : LoadingState.NotStarted\n                  : c.above.loadingState,\n            },\n            below: {\n              rows: sortedNewBelow,\n              loadingState:\n                place === 'below'\n                  ? newRows.length === 0\n                    ? LoadingState.Done\n                    : LoadingState.NotStarted\n                  : c.below.loadingState,\n            },\n          };\n        });\n      }\n    } catch {\n      setSection(place, (section) => ({\n        rows: section.rows,\n        loadingState: LoadingState.Error,\n      }));\n    }\n  };\n\n  const onScrollHit = async (entries: IntersectionObserverEntry[], observer: IntersectionObserver) => {\n    for (const entry of entries) {\n      // If the element is not intersecting, skip to the next one\n      if (!entry.isIntersecting) {\n        continue;\n      }\n\n      const targetElement = entry.target;\n\n      if (targetElement === aboveLoadingElement.current) {\n        maybeLoadMore('above');\n      } else if (targetElement === belowLoadingElement.current) {\n        maybeLoadMore('below');\n      }\n    }\n  };\n\n  useEffect(() => {\n    const scroll = scrollElement.current;\n    const aboveElem = aboveLoadingElement.current;\n    const belowElem = belowLoadingElement.current;\n\n    if (scroll == null) {\n      // should not happen, but need to make typescript happy\n      return;\n    }\n\n    const observer = new IntersectionObserver(onScrollHit, { root: scroll });\n\n    if (aboveElem != null) {\n      observer.observe(aboveElem);\n    }\n\n    if (belowElem != null) {\n      observer.observe(belowElem);\n    }\n\n    return () => {\n      observer.disconnect();\n    };\n  }); // on every render, why not\n\n  const scrollToCenter = useCallback(() => {\n    preEntryElement.current?.scrollIntoView({ block: 'center' });\n    entryElement.current?.scrollIntoView({ block: 'center' });\n  }, [preEntryElement, entryElement]);\n\n  useLayoutEffect(() => {\n    const scrollE = scrollElement.current;\n    if (scrollE == null) {\n      return;\n    }\n\n    const prevClientHeight = prevClientHeightRef.current;\n    const currentClientHeight = scrollE.clientHeight;\n    prevClientHeightRef.current = currentClientHeight;\n    if (prevClientHeight !== currentClientHeight) {\n      // height has changed, we scroll to the center\n      scrollToCenter();\n      return;\n    }\n\n    // if the newly loaded content is part of the initial load of `above` and `below`,\n    // we scroll to center, to keep the chosen log-row centered\n    if (loadCountRef.current.above <= 1 && loadCountRef.current.below <= 1) {\n      scrollToCenter();\n      return;\n    }\n\n    const prevScrollHeight = prevScrollHeightRef.current;\n    const currentHeight = scrollE.scrollHeight;\n    prevScrollHeightRef.current = currentHeight;\n    if (prevScrollHeight != null) {\n      const newScrollTop = scrollE.scrollTop + (currentHeight - prevScrollHeight);\n      scrollE.scrollTop = newScrollTop;\n    }\n  }, [context.above.rows, scrollToCenter]);\n\n  useAsync(updateContextQuery, [getRowContextQuery, row]);\n\n  const loadingStateAbove = context.above.loadingState;\n  const loadingStateBelow = context.below.loadingState;\n\n  return (\n    <Modal\n      isOpen={open}\n      title={t('logs.log-row-context-modal.title-log-context', 'Log context')}\n      contentClassName={styles.flexColumn}\n      className={styles.modal}\n      onDismiss={onClose}\n    >\n      {config.featureToggles.logsContextDatasourceUi && getLogRowContextUi && (\n        <div className={styles.datasourceUi}>{getLogRowContextUi(row, updateResults)}</div>\n      )}\n      <div className={cx(styles.flexRow, styles.paddingBottom)}>\n        <div>\n          <LogContextButtons\n            wrapLines={wrapLines}\n            onChangeWrapLines={setWrapLines}\n            onScrollCenterClick={scrollToCenter}\n          />\n        </div>\n      </div>\n      <div ref={scrollElement} className={styles.logRowGroups}>\n        <table>\n          <tbody>\n            <tr>\n              <td className={styles.loadingCell}>\n                {loadingStateAbove !== LoadingState.Done && loadingStateAbove !== LoadingState.Error && (\n                  <div ref={aboveLoadingElement}>\n                    <LoadingIndicator adjective=\"newer\" />\n                  </div>\n                )}\n                {loadingStateAbove === LoadingState.Error && (\n                  <div>\n                    <Trans i18nKey=\"logs.log-row-context-modal.error-loading-log-more-logs\">\n                      Error loading more logs.\n                    </Trans>\n                  </div>\n                )}\n                {loadingStateAbove === LoadingState.Done && (\n                  <div>\n                    <Trans i18nKey=\"logs.log-row-context-modal.no-more-logs-available\">No more logs available.</Trans>\n                  </div>\n                )}\n              </td>\n            </tr>\n            <tr>\n              <td className={styles.noMarginBottom}>\n                <LogRows\n                  logRows={context.above.rows}\n                  dedupStrategy={LogsDedupStrategy.none}\n                  showLabels={store.getBool(SETTINGS_KEYS.showLabels, false)}\n                  showTime={store.getBool(SETTINGS_KEYS.showTime, true)}\n                  wrapLogMessage={wrapLines}\n                  prettifyLogMessage={store.getBool(SETTINGS_KEYS.prettifyLogMessage, false)}\n                  enableLogDetails={true}\n                  timeZone={timeZone}\n                  displayedFields={displayedFields}\n                  onClickShowField={showField}\n                  onClickHideField={hideField}\n                  scrollElement={null}\n                />\n              </td>\n            </tr>\n            <tr ref={preEntryElement}></tr>\n            <tr ref={entryElement} className={cx(styles.entry, sticky ? styles.sticky : null)} data-testid=\"entry-row\">\n              <td className={styles.noMarginBottom}>\n                <LogRows\n                  logRows={[row]}\n                  dedupStrategy={LogsDedupStrategy.none}\n                  showLabels={store.getBool(SETTINGS_KEYS.showLabels, false)}\n                  showTime={store.getBool(SETTINGS_KEYS.showTime, true)}\n                  wrapLogMessage={wrapLines}\n                  prettifyLogMessage={store.getBool(SETTINGS_KEYS.prettifyLogMessage, false)}\n                  enableLogDetails={true}\n                  timeZone={timeZone}\n                  displayedFields={displayedFields}\n                  onClickShowField={showField}\n                  onClickHideField={hideField}\n                  onUnpinLine={() => setSticky(false)}\n                  onPinLine={() => setSticky(true)}\n                  pinnedLogs={sticky ? [row.uid] : undefined}\n                  overflowingContent={true}\n                  scrollElement={null}\n                />\n              </td>\n            </tr>\n            <tr>\n              <td>\n                <>\n                  <LogRows\n                    logRows={context.below.rows}\n                    dedupStrategy={LogsDedupStrategy.none}\n                    showLabels={store.getBool(SETTINGS_KEYS.showLabels, false)}\n                    showTime={store.getBool(SETTINGS_KEYS.showTime, true)}\n                    wrapLogMessage={wrapLines}\n                    prettifyLogMessage={store.getBool(SETTINGS_KEYS.prettifyLogMessage, false)}\n                    enableLogDetails={true}\n                    timeZone={timeZone}\n                    displayedFields={displayedFields}\n                    onClickShowField={showField}\n                    onClickHideField={hideField}\n                    scrollElement={null}\n                  />\n                </>\n              </td>\n            </tr>\n            <tr>\n              <td className={styles.loadingCell}>\n                {loadingStateBelow !== LoadingState.Done && loadingStateBelow !== LoadingState.Error && (\n                  <div ref={belowLoadingElement}>\n                    <LoadingIndicator adjective=\"older\" />\n                  </div>\n                )}\n                {loadingStateBelow === LoadingState.Error && (\n                  <div>\n                    <Trans i18nKey=\"logs.log-row-context-modal.error-loading-log-more-logs\">\n                      Error loading more logs.\n                    </Trans>\n                  </div>\n                )}\n                {loadingStateBelow === LoadingState.Done && (\n                  <div>\n                    <Trans i18nKey=\"logs.log-row-context-modal.no-more-logs-available\">No more logs available.</Trans>\n                  </div>\n                )}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <Modal.ButtonRow>\n        {contextQuery?.datasource?.uid && (\n          <Button\n            variant=\"secondary\"\n            onClick={async () => {\n              let rowId = row.uid;\n              if (row.dataFrame.refId) {\n                // the orignal row has the refid from the base query and not the refid from the context query, so we need to replace it.\n                rowId = row.uid.replace(row.dataFrame.refId, contextQuery.refId);\n              }\n\n              dispatch(\n                splitOpen({\n                  queries: [contextQuery],\n                  range: getFullTimeRange(),\n                  datasourceUid: contextQuery.datasource!.uid!,\n                  panelsState: {\n                    logs: {\n                      id: rowId,\n                    },\n                  },\n                })\n              );\n              onClose();\n              reportInteraction('grafana_explore_logs_log_context_open_split_view_clicked', {\n                datasourceType: row.datasourceType,\n                logRowUid: row.uid,\n              });\n            }}\n          >\n            <Trans i18nKey=\"logs.log-row-context-modal.open-in-split-view\">Open in split view</Trans>\n          </Button>\n        )}\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n","import { css } from '@emotion/css';\nimport { DragDropContext, Draggable, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { useCallback } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Card, IconButton, useStyles2 } from '@grafana/ui';\n\nimport { LOG_LINE_BODY_FIELD_NAME } from '../LogDetailsBody';\n\nimport { useLogListContext } from './LogListContext';\n\nexport const LogLineDetailsDisplayedFields = () => {\n  const { displayedFields, setDisplayedFields } = useLogListContext();\n\n  const onDragEnd = useCallback(\n    (result: DropResult) => {\n      if (result.destination == null) {\n        return;\n      }\n\n      const newDisplayedFields = [...displayedFields];\n      const element = displayedFields[result.source.index];\n      newDisplayedFields.splice(result.source.index, 1);\n      newDisplayedFields.splice(result.destination.index, 0, element);\n\n      setDisplayedFields?.(newDisplayedFields);\n    },\n    [displayedFields, setDisplayedFields]\n  );\n\n  return (\n    <div>\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable ignoreContainerClipping={true} droppableId=\"displayed-fields\" direction=\"vertical\">\n          {(provided) => {\n            return (\n              <>\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {displayedFields.map((field, index) => (\n                    <DraggableDisplayedField key={field} field={field} index={index} />\n                  ))}\n                </div>\n                {provided.placeholder}\n              </>\n            );\n          }}\n        </Droppable>\n      </DragDropContext>\n    </div>\n  );\n};\n\ninterface DraggableDisplayedFieldProps {\n  field: string;\n  index: number;\n}\n\nconst DraggableDisplayedField = ({ field, index }: DraggableDisplayedFieldProps) => {\n  const { onClickHideField } = useLogListContext();\n  const styles = useStyles2(getStyles);\n  return (\n    <Draggable draggableId={field} index={index}>\n      {(provided) => (\n        <div ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps}>\n          <Card noMargin className={styles.fieldCard}>\n            <div>\n              {field === LOG_LINE_BODY_FIELD_NAME ? t('logs.log-line-details.log-line-field', 'Log line') : field}\n            </div>\n            {onClickHideField && (\n              <IconButton\n                name=\"times\"\n                onClick={() => onClickHideField(field)}\n                tooltip={t('logs.log-line-details.remove-displayed-field', 'Remove field')}\n              />\n            )}\n          </Card>\n        </div>\n      )}\n    </Draggable>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  fieldCard: css({\n    cursor: 'move',\n    padding: theme.spacing(1),\n    marginBottom: theme.spacing(1),\n    wordBreak: 'break-word',\n  }),\n});\n","import { css } from '@emotion/css';\nimport { isEqual } from 'lodash';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport * as React from 'react';\n\nimport { CoreApp, Field, fuzzySearch, GrafanaTheme2, IconName, LinkModel, LogLabelStatsModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { ClipboardButton, DataLinkButton, IconButton, useStyles2 } from '@grafana/ui';\n\nimport { logRowToSingleRowDataFrame } from '../../logsModel';\nimport { calculateLogsLabelStats, calculateStats } from '../../utils';\nimport { LogLabelStats } from '../LogLabelStats';\nimport { FieldDef } from '../logParser';\n\nimport { useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\n\ninterface LogLineDetailsFieldsProps {\n  disableActions?: boolean;\n  fields: FieldDef[];\n  log: LogListModel;\n  logs: LogListModel[];\n  search?: string;\n}\n\nexport const LogLineDetailsFields = ({ disableActions, fields, log, logs, search }: LogLineDetailsFieldsProps) => {\n  if (!fields.length) {\n    return null;\n  }\n  const styles = useStyles2(getFieldsStyles);\n  const getLogs = useCallback(() => logs, [logs]);\n  const filteredFields = useMemo(() => (search ? filterFields(fields, search) : fields), [fields, search]);\n\n  if (filteredFields.length === 0) {\n    return t('logs.log-line-details.search.no-results', 'No results to display.');\n  }\n\n  return (\n    <div className={disableActions ? styles.fieldsTableNoActions : styles.fieldsTable}>\n      {filteredFields.map((field, i) => (\n        <LogLineDetailsField\n          key={`${field.keys[0]}=${field.values[0]}-${i}`}\n          disableActions={disableActions}\n          getLogs={getLogs}\n          fieldIndex={field.fieldIndex}\n          keys={field.keys}\n          links={field.links}\n          log={log}\n          values={field.values}\n        />\n      ))}\n    </div>\n  );\n};\n\ninterface LinkModelWithIcon extends LinkModel<Field> {\n  icon?: IconName;\n}\n\nexport interface LabelWithLinks {\n  key: string;\n  value: string;\n  links?: LinkModelWithIcon[];\n}\n\ninterface LogLineDetailsLabelFieldsProps {\n  fields: LabelWithLinks[];\n  log: LogListModel;\n  logs: LogListModel[];\n  search?: string;\n}\n\nexport const LogLineDetailsLabelFields = ({ fields, log, logs, search }: LogLineDetailsLabelFieldsProps) => {\n  if (!fields.length) {\n    return null;\n  }\n  const styles = useStyles2(getFieldsStyles);\n  const getLogs = useCallback(() => logs, [logs]);\n  const filteredFields = useMemo(() => (search ? filterLabels(fields, search) : fields), [fields, search]);\n\n  if (filteredFields.length === 0) {\n    return t('logs.log-line-details.search.no-results', 'No results to display.');\n  }\n\n  return (\n    <div className={styles.fieldsTable}>\n      {filteredFields.map((field, i) => (\n        <LogLineDetailsField\n          key={`${field.key}=${field.value}-${i}`}\n          getLogs={getLogs}\n          isLabel\n          keys={[field.key]}\n          links={field.links}\n          log={log}\n          values={[field.value]}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst getFieldsStyles = (theme: GrafanaTheme2) => ({\n  fieldsTable: css({\n    display: 'grid',\n    gap: theme.spacing(1),\n    gridTemplateColumns: `${theme.spacing(11.5)} minmax(15%, 30%) 1fr`,\n  }),\n  fieldsTableNoActions: css({\n    display: 'grid',\n    gap: theme.spacing(1),\n    gridTemplateColumns: `minmax(15%, 30%) 1fr`,\n  }),\n});\n\ninterface LogLineDetailsFieldProps {\n  keys: string[];\n  values: string[];\n  disableActions?: boolean;\n  fieldIndex?: number;\n  getLogs(): LogListModel[];\n  isLabel?: boolean;\n  links?: LinkModelWithIcon[];\n  log: LogListModel;\n}\n\nexport const LogLineDetailsField = ({\n  disableActions = false,\n  fieldIndex,\n  getLogs,\n  isLabel,\n  links,\n  log,\n  keys,\n  values,\n}: LogLineDetailsFieldProps) => {\n  const [showFieldsStats, setShowFieldStats] = useState(false);\n  const [fieldCount, setFieldCount] = useState(0);\n  const [fieldStats, setFieldStats] = useState<LogLabelStatsModel[] | null>(null);\n  const {\n    app,\n    closeDetails,\n    displayedFields,\n    isLabelFilterActive,\n    onClickFilterLabel,\n    onClickFilterOutLabel,\n    onClickShowField,\n    onClickHideField,\n    onPinLine,\n    pinLineButtonTooltipTitle,\n  } = useLogListContext();\n\n  const styles = useStyles2(getFieldStyles);\n\n  const getStats = useCallback(() => {\n    if (isLabel) {\n      return calculateLogsLabelStats(getLogs(), keys[0]);\n    }\n    if (fieldIndex !== undefined) {\n      return calculateStats(log.dataFrame.fields[fieldIndex].values);\n    }\n    return [];\n  }, [fieldIndex, getLogs, isLabel, keys, log.dataFrame.fields]);\n\n  const updateStats = useCallback(() => {\n    const newStats = getStats();\n    const newCount = newStats.reduce((sum, stat) => sum + stat.count, 0);\n    if (!isEqual(fieldStats, newStats) || fieldCount !== newCount) {\n      setFieldStats(newStats);\n      setFieldCount(newCount);\n    }\n  }, [fieldCount, fieldStats, getStats]);\n\n  useEffect(() => {\n    if (showFieldsStats) {\n      updateStats();\n    }\n  }, [showFieldsStats, updateStats]);\n\n  const showField = useCallback(() => {\n    if (onClickShowField) {\n      onClickShowField(keys[0]);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_replace_line_clicked', {\n      datasourceType: log.datasourceType,\n      logRowUid: log.uid,\n      type: 'enable',\n    });\n  }, [onClickShowField, keys, log.datasourceType, log.uid]);\n\n  const hideField = useCallback(() => {\n    if (onClickHideField) {\n      onClickHideField(keys[0]);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_replace_line_clicked', {\n      datasourceType: log.datasourceType,\n      logRowUid: log.uid,\n      type: 'disable',\n    });\n  }, [onClickHideField, keys, log.datasourceType, log.uid]);\n\n  const filterLabel = useCallback(() => {\n    if (onClickFilterLabel) {\n      onClickFilterLabel(keys[0], values[0], logRowToSingleRowDataFrame(log) || undefined);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_filter_clicked', {\n      datasourceType: log.datasourceType,\n      filterType: 'include',\n      logRowUid: log.uid,\n    });\n  }, [onClickFilterLabel, keys, values, log]);\n\n  const filterOutLabel = useCallback(() => {\n    if (onClickFilterOutLabel) {\n      onClickFilterOutLabel(keys[0], values[0], logRowToSingleRowDataFrame(log) || undefined);\n    }\n\n    reportInteraction('grafana_explore_logs_log_details_filter_clicked', {\n      datasourceType: log.datasourceType,\n      filterType: 'exclude',\n      logRowUid: log.uid,\n    });\n  }, [onClickFilterOutLabel, keys, values, log]);\n\n  const labelFilterActive = useCallback(async () => {\n    if (isLabelFilterActive) {\n      return await isLabelFilterActive(keys[0], values[0], log.dataFrame?.refId);\n    }\n    return false;\n  }, [isLabelFilterActive, keys, values, log.dataFrame?.refId]);\n\n  const showStats = useCallback(() => {\n    setShowFieldStats((showFieldStats: boolean) => !showFieldStats);\n\n    reportInteraction('grafana_explore_logs_log_details_stats_clicked', {\n      dataSourceType: log.datasourceType,\n      fieldType: isLabel ? 'label' : 'detectedField',\n      type: showFieldsStats ? 'close' : 'open',\n      logRowUid: log.uid,\n      app,\n    });\n  }, [app, isLabel, log.datasourceType, log.uid, showFieldsStats]);\n\n  const refIdTooltip = useMemo(\n    () => (app === CoreApp.Explore && log.dataFrame?.refId ? ` in query ${log.dataFrame?.refId}` : ''),\n    [app, log.dataFrame?.refId]\n  );\n  const singleKey = keys.length === 1;\n  const singleValue = values.length === 1;\n\n  return (\n    <>\n      <div className={styles.row}>\n        {!disableActions && (\n          <div className={styles.actions}>\n            {onClickFilterLabel && (\n              <AsyncIconButton\n                name=\"search-plus\"\n                onClick={filterLabel}\n                // We purposely want to pass a new function on every render to allow the active state to be updated when log details remains open between updates.\n                isActive={labelFilterActive}\n                tooltipSuffix={refIdTooltip}\n              />\n            )}\n            {onClickFilterOutLabel && (\n              <IconButton\n                name=\"search-minus\"\n                tooltip={\n                  app === CoreApp.Explore && log.dataFrame?.refId\n                    ? t('logs.log-line-details.fields.filter-out-query', 'Filter out value in query {{query}}', {\n                        query: log.dataFrame?.refId,\n                      })\n                    : t('logs.log-line-details.fields.filter-out', 'Filter out value')\n                }\n                onClick={filterOutLabel}\n              />\n            )}\n            {singleKey && displayedFields.includes(keys[0]) && (\n              <IconButton\n                variant=\"primary\"\n                tooltip={t('logs.log-line-details.fields.toggle-field-button.hide-this-field', 'Hide this field')}\n                name=\"eye\"\n                onClick={hideField}\n              />\n            )}\n            {singleKey && !displayedFields.includes(keys[0]) && (\n              <IconButton\n                tooltip={t(\n                  'logs.log-line-details.fields.toggle-field-button.field-instead-message',\n                  'Show this field instead of the message'\n                )}\n                name=\"eye\"\n                onClick={showField}\n              />\n            )}\n            <IconButton\n              variant={showFieldsStats ? 'primary' : 'secondary'}\n              name=\"signal\"\n              tooltip={t('logs.log-line-details.fields.adhoc-statistics', 'Ad-hoc statistics')}\n              className=\"stats-button\"\n              disabled={!singleKey}\n              onClick={showStats}\n            />\n          </div>\n        )}\n        <div className={styles.label}>{singleKey ? keys[0] : <MultipleValue values={keys} />}</div>\n        <div className={styles.value}>\n          <div className={styles.valueContainer}>\n            {singleValue ? values[0] : <MultipleValue showCopy={true} values={values} />}\n            {singleValue && <ClipboardButtonWrapper value={values[0]} />}\n          </div>\n        </div>\n      </div>\n      {links?.map((link, i) => {\n        if (link.onClick && onPinLine) {\n          const originalOnClick = link.onClick;\n          link.onClick = (e, origin) => {\n            // Pin the line\n            onPinLine(log);\n\n            // Execute the link onClick function\n            originalOnClick(e, origin);\n\n            closeDetails();\n          };\n        }\n        return (\n          <div className={styles.row} key={`${link.title}-${i}`}>\n            <div className={disableActions ? styles.linkNoActions : styles.link}>\n              <DataLinkButton\n                buttonProps={{\n                  // Show tooltip message if max number of pinned lines has been reached\n                  tooltip:\n                    typeof pinLineButtonTooltipTitle === 'object' && link.onClick\n                      ? pinLineButtonTooltipTitle\n                      : undefined,\n                  variant: 'secondary',\n                  fill: 'outline',\n                  ...(link.icon && { icon: link.icon }),\n                }}\n                link={link}\n              />\n            </div>\n          </div>\n        );\n      })}\n      {showFieldsStats && fieldStats && (\n        <div className={styles.row}>\n          <div />\n          <div className={disableActions ? undefined : styles.statsColumn}>\n            <LogLabelStats\n              className={styles.stats}\n              stats={fieldStats}\n              label={keys[0]}\n              value={values[0]}\n              rowCount={fieldCount}\n              isLabel={isLabel}\n            />\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nconst getFieldStyles = (theme: GrafanaTheme2) => ({\n  row: css({\n    display: 'contents',\n  }),\n  actions: css({\n    whiteSpace: 'nowrap',\n  }),\n  label: css({\n    overflowWrap: 'break-word',\n    wordBreak: 'break-word',\n  }),\n  value: css({\n    overflowWrap: 'break-word',\n    wordBreak: 'break-word',\n    button: {\n      visibility: 'hidden',\n    },\n    '&:hover': {\n      button: {\n        visibility: 'visible',\n      },\n    },\n  }),\n  link: css({\n    gridColumn: 'span 3',\n  }),\n  linkNoActions: css({\n    gridColumn: 'span 2',\n  }),\n  stats: css({\n    paddingRight: theme.spacing(1),\n    wordBreak: 'break-all',\n    width: '100%',\n    maxWidth: '50vh',\n  }),\n  statsColumn: css({\n    gridColumn: 'span 2',\n  }),\n  valueContainer: css({\n    display: 'flex',\n    alignItems: 'center',\n    lineHeight: theme.typography.body.lineHeight,\n    whiteSpace: 'pre-wrap',\n    wordBreak: 'break-all',\n  }),\n});\n\nconst ClipboardButtonWrapper = ({ value }: { value: string }) => {\n  const styles = useStyles2(getClipboardButtonStyles);\n  return (\n    <div className={styles.button}>\n      <ClipboardButton\n        getText={() => value}\n        title={t('logs.log-line-details.fields.copy-value-to-clipboard', 'Copy value to clipboard')}\n        fill=\"text\"\n        variant=\"secondary\"\n        icon=\"copy\"\n        size=\"md\"\n      />\n    </div>\n  );\n};\n\nconst getClipboardButtonStyles = (theme: GrafanaTheme2) => ({\n  button: css({\n    '& > button': {\n      color: theme.colors.text.secondary,\n      padding: 0,\n      justifyContent: 'center',\n      borderRadius: theme.shape.radius.circle,\n      height: theme.spacing(theme.components.height.sm),\n      width: theme.spacing(theme.components.height.sm),\n      svg: {\n        margin: 0,\n      },\n\n      'span > div': {\n        top: '-5px',\n        '& button': {\n          color: theme.colors.success.main,\n        },\n      },\n    },\n  }),\n});\n\nconst MultipleValue = ({ showCopy, values = [] }: { showCopy?: boolean; values: string[] }) => {\n  if (values.every((val) => val === '')) {\n    return null;\n  }\n  return (\n    <table>\n      <tbody>\n        {values.map((val, i) => {\n          return (\n            <tr key={`${val}-${i}`}>\n              <td>{val}</td>\n              <td>{showCopy && val !== '' && <ClipboardButtonWrapper value={val} />}</td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\ninterface AsyncIconButtonProps extends Pick<React.ButtonHTMLAttributes<HTMLButtonElement>, 'onClick'> {\n  name: IconName;\n  isActive(): Promise<boolean>;\n  tooltipSuffix: string;\n}\n\nconst AsyncIconButton = ({ isActive, tooltipSuffix, ...rest }: AsyncIconButtonProps) => {\n  const [active, setActive] = useState(false);\n  const tooltip = active ? 'Remove filter' : 'Filter for value';\n\n  useEffect(() => {\n    isActive().then(setActive);\n  }, [isActive]);\n\n  return <IconButton {...rest} variant={active ? 'primary' : undefined} tooltip={tooltip + tooltipSuffix} />;\n};\n\nfunction filterFields(fields: FieldDef[], search: string) {\n  const keys = fields.map((field) => field.keys.join(' '));\n  const keysIdx = fuzzySearch(keys, search);\n  const values = fields.map((field) => field.values.join(' '));\n  const valuesIdx = fuzzySearch(values, search);\n\n  const results = keysIdx.map((index) => fields[index]);\n  valuesIdx.forEach((index) => {\n    if (!results.includes(fields[index])) {\n      results.push(fields[index]);\n    }\n  });\n\n  return results;\n}\n\nfunction filterLabels(labels: LabelWithLinks[], search: string) {\n  const keys = labels.map((field) => field.key);\n  const keysIdx = fuzzySearch(keys, search);\n  const values = labels.map((field) => field.value);\n  const valuesIdx = fuzzySearch(values, search);\n\n  const results = keysIdx.map((index) => labels[index]);\n  valuesIdx.forEach((index) => {\n    if (!results.includes(labels[index])) {\n      results.push(labels[index]);\n    }\n  });\n\n  return results;\n}\n","import { css } from '@emotion/css';\nimport { useCallback, useMemo, MouseEvent, useRef, ChangeEvent } from 'react';\n\nimport { colorManipulator, GrafanaTheme2, LogRowModel, store } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { IconButton, Input, useStyles2 } from '@grafana/ui';\n\nimport { copyText, handleOpenLogsContextClick } from '../../utils';\nimport { LOG_LINE_BODY_FIELD_NAME } from '../LogDetailsBody';\n\nimport { LogLineDetailsMode } from './LogLineDetails';\nimport { useLogIsPinned, useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\n\ninterface Props {\n  log: LogListModel;\n  search: string;\n  onSearch(newSearch: string): void;\n}\n\nexport const LogLineDetailsHeader = ({ log, search, onSearch }: Props) => {\n  const {\n    closeDetails,\n    detailsMode,\n    displayedFields,\n    getRowContextQuery,\n    logOptionsStorageKey,\n    logSupportsContext,\n    setDetailsMode,\n    onClickHideField,\n    onClickShowField,\n    onOpenContext,\n    onPermalinkClick,\n    onPinLine,\n    onUnpinLine,\n    wrapLogMessage,\n  } = useLogListContext();\n  const pinned = useLogIsPinned(log);\n  const styles = useStyles2(getStyles, detailsMode, wrapLogMessage);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const copyLogLine = useCallback(() => {\n    copyText(log.entry, containerRef);\n  }, [log.entry]);\n\n  const copyLinkToLogLine = useCallback(() => {\n    onPermalinkClick?.(log);\n  }, [log, onPermalinkClick]);\n\n  const togglePinning = useCallback(() => {\n    if (pinned) {\n      onUnpinLine?.(log);\n    } else {\n      onPinLine?.(log);\n    }\n  }, [log, onPinLine, onUnpinLine, pinned]);\n\n  const shouldlogSupportsContext = useMemo(\n    () => (logSupportsContext ? logSupportsContext(log) : false),\n    [log, logSupportsContext]\n  );\n\n  const showContext = useCallback(\n    async (event: MouseEvent<HTMLElement>) => {\n      handleOpenLogsContextClick(event, log, getRowContextQuery, (log: LogRowModel) => onOpenContext?.(log, () => {}));\n    },\n    [onOpenContext, getRowContextQuery, log]\n  );\n\n  const showLogLineToggle = onClickHideField && onClickShowField && displayedFields.length > 0;\n  const logLineDisplayed = displayedFields.includes(LOG_LINE_BODY_FIELD_NAME);\n\n  const toggleDetailsMode = useCallback(() => {\n    const newMode = detailsMode === 'inline' ? 'sidebar' : 'inline';\n    if (logOptionsStorageKey) {\n      store.set(`${logOptionsStorageKey}.detailsMode`, newMode);\n    }\n\n    setDetailsMode(newMode);\n  }, [detailsMode, logOptionsStorageKey, setDetailsMode]);\n\n  const toggleLogLine = useCallback(() => {\n    if (logLineDisplayed) {\n      onClickHideField?.(LOG_LINE_BODY_FIELD_NAME);\n    } else {\n      onClickShowField?.(LOG_LINE_BODY_FIELD_NAME);\n    }\n  }, [logLineDisplayed, onClickHideField, onClickShowField]);\n\n  const clearSearch = useMemo(\n    () => (\n      <IconButton\n        name=\"times\"\n        size=\"sm\"\n        onClick={() => {\n          onSearch('');\n          if (inputRef.current) {\n            inputRef.current.value = '';\n          }\n        }}\n        tooltip={t('logs.log-line-details.clear-search', 'Clear')}\n      />\n    ),\n    [onSearch]\n  );\n\n  const handleSearch = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      onSearch(e.target.value);\n    },\n    [onSearch]\n  );\n\n  return (\n    <div className={styles.header} ref={containerRef}>\n      <Input\n        onChange={handleSearch}\n        placeholder={t('logs.log-line-details.search-placeholder', 'Search field names and values')}\n        ref={inputRef}\n        suffix={search !== '' ? clearSearch : undefined}\n      />\n      {showLogLineToggle && (\n        <IconButton\n          tooltip={\n            logLineDisplayed\n              ? t('logs.log-line-details.hide-log-line', 'Hide log line')\n              : t('logs.log-line-details.show-log-line', 'Show log line')\n          }\n          tooltipPlacement=\"top\"\n          size=\"md\"\n          name=\"eye\"\n          onClick={toggleLogLine}\n          tabIndex={0}\n          variant={logLineDisplayed ? 'primary' : undefined}\n        />\n      )}\n      <div className={styles.icons}>\n        <IconButton\n          tooltip={t('logs.log-line-details.copy-to-clipboard', 'Copy to clipboard')}\n          tooltipPlacement=\"top\"\n          size=\"md\"\n          name=\"copy\"\n          onClick={copyLogLine}\n          tabIndex={0}\n        />\n        {onPermalinkClick && log.rowId !== undefined && log.uid && (\n          <IconButton\n            tooltip={t('logs.log-line-details.copy-shortlink', 'Copy shortlink')}\n            tooltipPlacement=\"top\"\n            size=\"md\"\n            name=\"share-alt\"\n            onClick={copyLinkToLogLine}\n            tabIndex={0}\n          />\n        )}\n        {pinned && onUnpinLine && (\n          <IconButton\n            size=\"md\"\n            name=\"gf-pin\"\n            onClick={togglePinning}\n            tooltip={t('logs.log-line-details.unpin-line', 'Unpin log')}\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n            variant=\"primary\"\n          />\n        )}\n        {!pinned && onPinLine && (\n          <IconButton\n            size=\"md\"\n            name=\"gf-pin\"\n            onClick={togglePinning}\n            tooltip={t('logs.log-line-details.pin-line', 'Pin log')}\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n          />\n        )}\n        {shouldlogSupportsContext && (\n          <IconButton\n            size=\"md\"\n            name=\"gf-show-context\"\n            onClick={showContext}\n            tooltip={t('logs.log-line-details.show-context', 'Show context')}\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n          />\n        )}\n        <IconButton\n          name={detailsMode === 'inline' ? 'columns' : 'gf-layout-simple'}\n          tooltip={\n            detailsMode === 'inline'\n              ? t('logs.log-line-details.sidebar-mode', 'Anchor to the right')\n              : t('logs.log-line-details.inline-mode', 'Display inline')\n          }\n          onClick={toggleDetailsMode}\n        />\n        <IconButton\n          name=\"times\"\n          aria-label={t('logs.log-line-details.close', 'Close log details')}\n          onClick={closeDetails}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, mode: LogLineDetailsMode, wrapLogMessage: boolean) => ({\n  container: css({\n    overflow: 'auto',\n    height: '100%',\n  }),\n  scrollContainer: css({\n    overflow: 'auto',\n    height: '100%',\n  }),\n  header: css({\n    alignItems: 'center',\n    background: theme.colors.background.canvas,\n    display: 'flex',\n    flexDirection: !wrapLogMessage && mode === 'inline' ? 'row-reverse' : 'row',\n    gap: theme.spacing(0.75),\n    zIndex: theme.zIndex.navbarFixed,\n    height: theme.spacing(5.5),\n    marginBottom: theme.spacing(1),\n    padding: theme.spacing(0.5, 1),\n    position: 'sticky',\n    top: 0,\n  }),\n  icons: css({\n    display: 'flex',\n    gap: theme.spacing(0.75),\n  }),\n  copyLogButton: css({\n    padding: 0,\n    height: theme.spacing(4),\n    width: theme.spacing(2.5),\n    overflow: 'hidden',\n    '&:hover': {\n      backgroundColor: colorManipulator.alpha(theme.colors.text.primary, 0.12),\n    },\n  }),\n  componentWrapper: css({\n    padding: theme.spacing(0, 1, 1, 1),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { camelCase, groupBy } from 'lodash';\nimport { startTransition, useCallback, useMemo, useRef, useState } from 'react';\n\nimport { DataFrameType, GrafanaTheme2, store } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { ControlledCollapse, useStyles2 } from '@grafana/ui';\n\nimport { getLabelTypeFromRow } from '../../utils';\nimport { useAttributesExtensionLinks } from '../LogDetails';\nimport { createLogLineLinks } from '../logParser';\n\nimport { LogLineDetailsDisplayedFields } from './LogLineDetailsDisplayedFields';\nimport { LabelWithLinks, LogLineDetailsFields, LogLineDetailsLabelFields } from './LogLineDetailsFields';\nimport { LogLineDetailsHeader } from './LogLineDetailsHeader';\nimport { useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\n\ninterface LogLineDetailsComponentProps {\n  log: LogListModel;\n  logs: LogListModel[];\n}\n\nexport const LogLineDetailsComponent = ({ log, logs }: LogLineDetailsComponentProps) => {\n  const { displayedFields, logOptionsStorageKey, setDisplayedFields } = useLogListContext();\n  const [search, setSearch] = useState('');\n  const inputRef = useRef('');\n  const styles = useStyles2(getStyles);\n  const extensionLinks = useAttributesExtensionLinks(log);\n  const fieldsWithLinks = useMemo(() => {\n    const fieldsWithLinks = log.fields.filter((f) => f.links?.length);\n    const displayedFieldsWithLinks = fieldsWithLinks.filter((f) => f.fieldIndex !== log.entryFieldIndex).sort();\n    const hiddenFieldsWithLinks = fieldsWithLinks.filter((f) => f.fieldIndex === log.entryFieldIndex).sort();\n    const fieldsWithLinksFromVariableMap = createLogLineLinks(hiddenFieldsWithLinks);\n    return {\n      links: displayedFieldsWithLinks,\n      linksFromVariableMap: fieldsWithLinksFromVariableMap,\n    };\n  }, [log.entryFieldIndex, log.fields]);\n  const fieldsWithoutLinks =\n    log.dataFrame.meta?.type === DataFrameType.LogLines\n      ? // for LogLines frames (dataplane) we don't want to show any additional fields besides already extracted labels and links\n        []\n      : // for other frames, do not show the log message unless there is a link attached\n        log.fields.filter((f) => f.links?.length === 0 && f.fieldIndex !== log.entryFieldIndex).sort();\n  const labelsWithLinks: LabelWithLinks[] = useMemo(\n    () =>\n      Object.keys(log.labels)\n        .sort()\n        .map((label) => ({\n          key: label,\n          value: log.labels[label],\n          link: extensionLinks?.[label],\n        })),\n    [extensionLinks, log.labels]\n  );\n  const groupedLabels = useMemo(\n    () => groupBy(labelsWithLinks, (label) => getLabelTypeFromRow(label.key, log, true) ?? ''),\n    [labelsWithLinks, log]\n  );\n  const labelGroups = useMemo(() => Object.keys(groupedLabels), [groupedLabels]);\n\n  const logLineOpen = logOptionsStorageKey\n    ? store.getBool(`${logOptionsStorageKey}.log-details.logLineOpen`, false)\n    : false;\n  const linksOpen = logOptionsStorageKey ? store.getBool(`${logOptionsStorageKey}.log-details.linksOpen`, true) : true;\n  const fieldsOpen = logOptionsStorageKey\n    ? store.getBool(`${logOptionsStorageKey}.log-details.fieldsOpen`, true)\n    : true;\n  const displayedFieldsOpen = logOptionsStorageKey\n    ? store.getBool(`${logOptionsStorageKey}.log-details.displayedFieldsOpen`, false)\n    : false;\n\n  const handleToggle = useCallback(\n    (option: string, isOpen: boolean) => {\n      store.set(`${logOptionsStorageKey}.log-details.${option}`, isOpen);\n    },\n    [logOptionsStorageKey]\n  );\n\n  const handleSearch = useCallback((newSearch: string) => {\n    inputRef.current = newSearch;\n    startTransition(() => {\n      setSearch(inputRef.current);\n    });\n  }, []);\n\n  const noDetails =\n    !fieldsWithLinks.links.length &&\n    !fieldsWithLinks.linksFromVariableMap.length &&\n    !labelGroups.length &&\n    !fieldsWithoutLinks.length;\n\n  return (\n    <>\n      <LogLineDetailsHeader log={log} search={search} onSearch={handleSearch} />\n      <div className={styles.componentWrapper}>\n        <ControlledCollapse\n          className={styles.collapsable}\n          label={t('logs.log-line-details.log-line-section', 'Log line')}\n          collapsible\n          isOpen={logLineOpen}\n          onToggle={(isOpen: boolean) => handleToggle('logLineOpen', isOpen)}\n        >\n          <div className={styles.logLineWrapper}>{log.raw}</div>\n        </ControlledCollapse>\n        {displayedFields.length > 0 && setDisplayedFields && (\n          <ControlledCollapse\n            label={t('logs.log-line-details.displayed-fields-section', 'Organize displayed fields')}\n            collapsible\n            isOpen={displayedFieldsOpen}\n            onToggle={(isOpen: boolean) => handleToggle('displayedFieldsOpen', isOpen)}\n          >\n            <LogLineDetailsDisplayedFields />\n          </ControlledCollapse>\n        )}\n        {fieldsWithLinks.links.length > 0 && (\n          <ControlledCollapse\n            className={styles.collapsable}\n            label={t('logs.log-line-details.links-section', 'Links')}\n            collapsible\n            isOpen={linksOpen}\n            onToggle={(isOpen: boolean) => handleToggle('linksOpen', isOpen)}\n          >\n            <LogLineDetailsFields log={log} logs={logs} fields={fieldsWithLinks.links} search={search} />\n            <LogLineDetailsFields\n              disableActions\n              log={log}\n              logs={logs}\n              fields={fieldsWithLinks.linksFromVariableMap}\n              search={search}\n            />\n          </ControlledCollapse>\n        )}\n        {labelGroups.map((group) =>\n          group === '' ? (\n            <ControlledCollapse\n              className={styles.collapsable}\n              key={'fields'}\n              label={t('logs.log-line-details.fields-section', 'Fields')}\n              collapsible\n              isOpen={fieldsOpen}\n              onToggle={(isOpen: boolean) => handleToggle('fieldsOpen', isOpen)}\n            >\n              <LogLineDetailsLabelFields log={log} logs={logs} fields={groupedLabels[group]} search={search} />\n              <LogLineDetailsFields log={log} logs={logs} fields={fieldsWithoutLinks} search={search} />\n            </ControlledCollapse>\n          ) : (\n            <ControlledCollapse\n              className={styles.collapsable}\n              key={group}\n              label={group}\n              collapsible\n              isOpen={store.getBool(`${logOptionsStorageKey}.log-details.${groupOptionName(group)}`, true)}\n              onToggle={(isOpen: boolean) => handleToggle(groupOptionName(group), isOpen)}\n            >\n              <LogLineDetailsLabelFields log={log} logs={logs} fields={groupedLabels[group]} search={search} />\n            </ControlledCollapse>\n          )\n        )}\n        {!labelGroups.length && fieldsWithoutLinks.length > 0 && (\n          <ControlledCollapse\n            className={styles.collapsable}\n            key={'fields'}\n            label={t('logs.log-line-details.fields-section', 'Fields')}\n            collapsible\n            isOpen={fieldsOpen}\n            onToggle={(isOpen: boolean) => handleToggle('fieldsOpen', isOpen)}\n          >\n            <LogLineDetailsFields log={log} logs={logs} fields={fieldsWithoutLinks} search={search} />\n          </ControlledCollapse>\n        )}\n        {noDetails && <Trans i18nKey=\"logs.log-line-details.no-details\">No fields to display.</Trans>}\n      </div>\n    </>\n  );\n};\n\nfunction groupOptionName(group: string) {\n  return `${camelCase(group)}Open`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  collapsable: css({\n    '&:last-of-type': {\n      marginBottom: 0,\n    },\n  }),\n  componentWrapper: css({\n    padding: theme.spacing(0, 1, 1, 1),\n  }),\n  logLineWrapper: css({\n    maxHeight: '50vh',\n    overflow: 'auto',\n  }),\n});\n","import { css } from '@emotion/css';\nimport { Resizable } from 're-resizable';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { getDragStyles, useStyles2 } from '@grafana/ui';\n\nimport { LogLineDetailsComponent } from './LogLineDetailsComponent';\nimport { useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\nimport { LOG_LIST_MIN_WIDTH } from './virtualization';\n\nexport interface Props {\n  containerElement: HTMLDivElement;\n  focusLogLine: (log: LogListModel) => void;\n  logs: LogListModel[];\n  onResize(): void;\n}\n\nexport type LogLineDetailsMode = 'inline' | 'sidebar';\n\nexport const LogLineDetails = ({ containerElement, focusLogLine, logs, onResize }: Props) => {\n  const { detailsWidth, setDetailsWidth, showDetails } = useLogListContext();\n  const styles = useStyles2(getStyles, 'sidebar');\n  const dragStyles = useStyles2(getDragStyles);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    focusLogLine(showDetails[0]);\n    // Just once\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleResize = useCallback(() => {\n    if (containerRef.current) {\n      setDetailsWidth(containerRef.current.clientWidth);\n    }\n    onResize();\n  }, [onResize, setDetailsWidth]);\n\n  const maxWidth = containerElement.clientWidth - LOG_LIST_MIN_WIDTH;\n\n  if (!showDetails.length) {\n    return null;\n  }\n\n  return (\n    <Resizable\n      onResize={handleResize}\n      handleClasses={{ left: dragStyles.dragHandleVertical }}\n      defaultSize={{ width: detailsWidth, height: containerElement.clientHeight }}\n      size={{ width: detailsWidth, height: containerElement.clientHeight }}\n      enable={{ left: true }}\n      minWidth={40}\n      maxWidth={maxWidth}\n    >\n      <div className={styles.container} ref={containerRef}>\n        <div className={styles.scrollContainer}>\n          <LogLineDetailsComponent log={showDetails[0]} logs={logs} />\n        </div>\n      </div>\n    </Resizable>\n  );\n};\n\nexport interface InlineLogLineDetailsProps {\n  logs: LogListModel[];\n}\n\nexport const InlineLogLineDetails = ({ logs }: InlineLogLineDetailsProps) => {\n  const { showDetails } = useLogListContext();\n  const styles = useStyles2(getStyles, 'inline');\n\n  if (!showDetails.length) {\n    return null;\n  }\n\n  return (\n    <div className={`${styles.inlineWrapper} log-line-inline-details`}>\n      <div className={styles.container}>\n        <div className={styles.scrollContainer}>\n          <LogLineDetailsComponent log={showDetails[0]} logs={logs} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const LOG_LINE_DETAILS_HEIGHT = 35;\n\nconst getStyles = (theme: GrafanaTheme2, mode: LogLineDetailsMode) => ({\n  inlineWrapper: css({\n    gridColumn: '1 / -1',\n    height: `${LOG_LINE_DETAILS_HEIGHT}vh`,\n    paddingBottom: theme.spacing(0.5),\n    marginRight: 1,\n  }),\n  container: css({\n    overflow: 'auto',\n    height: '100%',\n    boxShadow: theme.shadows.z1,\n    border: `1px solid ${theme.colors.border.medium}`,\n    borderRight: mode === 'sidebar' ? 'none' : undefined,\n  }),\n  scrollContainer: css({\n    overflow: 'auto',\n    height: '100%',\n  }),\n  componentWrapper: css({\n    padding: theme.spacing(0, 1, 1, 1),\n  }),\n});\n","import { useCallback, useMemo, useRef, MouseEvent } from 'react';\n\nimport { LogRowContextOptions, LogRowModel } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { DataQuery } from '@grafana/schema';\nimport { Dropdown, IconButton, Menu } from '@grafana/ui';\n\nimport { copyText, handleOpenLogsContextClick } from '../../utils';\n\nimport { LogLineStyles } from './LogLine';\nimport { useLogIsPinned, useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\n\nexport type GetRowContextQueryFn = (\n  row: LogRowModel,\n  options?: LogRowContextOptions,\n  cacheFilters?: boolean\n) => Promise<DataQuery | null>;\n\ntype MenuItem = {\n  label: string;\n  onClick(log: LogListModel): void;\n};\n\ntype MenuItemDivider = {\n  divider: true;\n};\n\nexport type LogLineMenuCustomItem = MenuItem | MenuItemDivider;\n\ninterface Props {\n  log: LogListModel;\n  styles: LogLineStyles;\n}\n\nexport const LogLineMenu = ({ log, styles }: Props) => {\n  const {\n    enableLogDetails,\n    detailsDisplayed,\n    getRowContextQuery,\n    onOpenContext,\n    onPermalinkClick,\n    onPinLine,\n    onUnpinLine,\n    logLineMenuCustomItems = [],\n    logSupportsContext,\n    toggleDetails,\n  } = useLogListContext();\n  const pinned = useLogIsPinned(log);\n  const menuRef = useRef(null);\n\n  const copyLogLine = useCallback(() => {\n    copyText(log.entry, menuRef);\n  }, [log.entry]);\n\n  const copyLinkToLogLine = useCallback(() => {\n    onPermalinkClick?.(log);\n  }, [log, onPermalinkClick]);\n\n  const shouldlogSupportsContext = useMemo(\n    () => (logSupportsContext ? logSupportsContext(log) : false),\n    [log, logSupportsContext]\n  );\n\n  const showContext = useCallback(\n    async (event: MouseEvent<HTMLElement>) => {\n      handleOpenLogsContextClick(event, log, getRowContextQuery, (log: LogRowModel) => onOpenContext?.(log, () => {}));\n    },\n    [onOpenContext, getRowContextQuery, log]\n  );\n\n  const toggleLogDetails = useCallback(() => {\n    toggleDetails(log);\n  }, [log, toggleDetails]);\n\n  const togglePinning = useCallback(() => {\n    if (pinned) {\n      onUnpinLine?.(log);\n    } else {\n      onPinLine?.(log);\n    }\n  }, [log, onPinLine, onUnpinLine, pinned]);\n\n  const menu = useCallback(\n    () => (\n      <Menu ref={menuRef}>\n        {enableLogDetails && (\n          <Menu.Item\n            onClick={toggleLogDetails}\n            label={\n              detailsDisplayed(log)\n                ? t('logs.log-line-menu.show-details', 'Hide log details')\n                : t('logs.log-line-menu.hide-details', 'Show log details')\n            }\n          />\n        )}\n        {shouldlogSupportsContext && (\n          <Menu.Item onClick={showContext} label={t('logs.log-line-menu.show-context', 'Show context')} />\n        )}\n        {!pinned && onPinLine && (\n          <Menu.Item onClick={togglePinning} label={t('logs.log-line-menu.pin-to-outline', 'Pin log')} />\n        )}\n        {pinned && onUnpinLine && (\n          <Menu.Item onClick={togglePinning} label={t('logs.log-line-menu.unpin-from-outline', 'Unpin log')} />\n        )}\n        <Menu.Divider />\n        <Menu.Item onClick={copyLogLine} label={t('logs.log-line-menu.copy-log', 'Copy log line')} />\n        {onPermalinkClick && log.rowId !== undefined && log.uid && (\n          <Menu.Item onClick={copyLinkToLogLine} label={t('logs.log-line-menu.copy-link', 'Copy link to log line')} />\n        )}\n        {logLineMenuCustomItems.map((item, i) => {\n          if (isDivider(item)) {\n            return <Menu.Divider key={i} />;\n          }\n          if (isItem(item)) {\n            return <Menu.Item onClick={() => item.onClick(log)} label={item.label} key={i} />;\n          }\n          return null;\n        })}\n      </Menu>\n    ),\n    [\n      copyLinkToLogLine,\n      copyLogLine,\n      detailsDisplayed,\n      enableLogDetails,\n      log,\n      logLineMenuCustomItems,\n      onPermalinkClick,\n      onPinLine,\n      onUnpinLine,\n      pinned,\n      shouldlogSupportsContext,\n      showContext,\n      toggleLogDetails,\n      togglePinning,\n    ]\n  );\n\n  return (\n    <Dropdown overlay={menu} placement=\"bottom-start\">\n      <IconButton\n        className={styles.menuIcon}\n        name=\"ellipsis-v\"\n        aria-label={t('logs.log-line-menu.icon-label', 'Log menu')}\n      />\n    </Dropdown>\n  );\n};\n\nfunction isDivider(item: LogLineMenuCustomItem) {\n  return 'divider' in item && item.divider;\n}\n\nfunction isItem(item: LogLineMenuCustomItem) {\n  return 'onClick' in item && 'label' in item;\n}\n","import { css } from '@emotion/css';\nimport { CSSProperties, memo, useCallback, useEffect, useMemo, useRef, useState, MouseEvent } from 'react';\nimport Highlighter from 'react-highlight-words';\nimport tinycolor from 'tinycolor2';\n\nimport { findHighlightChunksInText, GrafanaTheme2, LogsDedupStrategy } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Button, Icon, Tooltip } from '@grafana/ui';\n\nimport { LOG_LINE_BODY_FIELD_NAME } from '../LogDetailsBody';\nimport { LogMessageAnsi } from '../LogMessageAnsi';\n\nimport { InlineLogLineDetails } from './LogLineDetails';\nimport { LogLineMenu } from './LogLineMenu';\nimport { useLogIsPermalinked, useLogIsPinned, useLogListContext } from './LogListContext';\nimport { useLogListSearchContext } from './LogListSearchContext';\nimport { LogListModel } from './processing';\nimport {\n  FIELD_GAP_MULTIPLIER,\n  hasUnderOrOverflow,\n  LogFieldDimension,\n  LogLineVirtualization,\n  DEFAULT_LINE_HEIGHT,\n} from './virtualization';\n\nexport interface Props {\n  displayedFields: string[];\n  index: number;\n  log: LogListModel;\n  showTime: boolean;\n  style: CSSProperties;\n  styles: LogLineStyles;\n  onClick: (e: MouseEvent<HTMLElement>, log: LogListModel) => void;\n  onOverflow?: (index: number, id: string, height?: number) => void;\n  variant?: 'infinite-scroll';\n  virtualization?: LogLineVirtualization;\n  wrapLogMessage: boolean;\n}\n\nexport const LogLine = ({\n  displayedFields,\n  index,\n  log,\n  style,\n  styles,\n  onClick,\n  onOverflow,\n  showTime,\n  variant,\n  virtualization,\n  wrapLogMessage,\n}: Props) => {\n  return (\n    <div style={wrapLogMessage ? style : { ...style, width: 'max-content', minWidth: '100%' }}>\n      <LogLineComponent\n        displayedFields={displayedFields}\n        height={style.height}\n        index={index}\n        log={log}\n        styles={styles}\n        onClick={onClick}\n        onOverflow={onOverflow}\n        showTime={showTime}\n        variant={variant}\n        virtualization={virtualization}\n        wrapLogMessage={wrapLogMessage}\n      />\n    </div>\n  );\n};\n\ninterface LogLineComponentProps extends Omit<Props, 'style'> {\n  height?: number | string;\n}\n\nconst LogLineComponent = memo(\n  ({\n    displayedFields,\n    height,\n    index,\n    log,\n    styles,\n    onClick,\n    onOverflow,\n    showTime,\n    variant,\n    virtualization,\n    wrapLogMessage,\n  }: LogLineComponentProps) => {\n    const {\n      detailsDisplayed,\n      detailsMode,\n      dedupStrategy,\n      enableLogDetails,\n      fontSize,\n      hasLogsWithErrors,\n      hasSampledLogs,\n      onLogLineHover,\n    } = useLogListContext();\n    const [collapsed, setCollapsed] = useState<boolean | undefined>(\n      wrapLogMessage && log.collapsed !== undefined ? log.collapsed : undefined\n    );\n    const logLineRef = useRef<HTMLDivElement | null>(null);\n    const pinned = useLogIsPinned(log);\n    const permalinked = useLogIsPermalinked(log);\n\n    useEffect(() => {\n      if (!onOverflow || !logLineRef.current || !virtualization || !height) {\n        return;\n      }\n      const calculatedHeight = typeof height === 'number' ? height : undefined;\n      const actualHeight = hasUnderOrOverflow(virtualization, logLineRef.current, calculatedHeight, log.collapsed);\n      if (actualHeight) {\n        onOverflow(index, log.uid, actualHeight);\n      }\n    });\n\n    useEffect(() => {\n      if (!wrapLogMessage) {\n        setCollapsed(undefined);\n      } else if (collapsed === undefined && log.collapsed !== undefined) {\n        setCollapsed(log.collapsed);\n      } else if (collapsed !== undefined && log.collapsed === undefined) {\n        setCollapsed(log.collapsed);\n      }\n    }, [collapsed, log.collapsed, wrapLogMessage]);\n\n    const handleMouseOver = useCallback(() => onLogLineHover?.(log), [log, onLogLineHover]);\n\n    const handleExpandCollapse = useCallback(() => {\n      const newState = !collapsed;\n      setCollapsed(newState);\n      log.setCollapsedState(newState);\n      onOverflow?.(index, log.uid);\n    }, [collapsed, index, log, onOverflow]);\n\n    const handleClick = useCallback(\n      (e: MouseEvent<HTMLElement>) => {\n        onClick(e, log);\n      },\n      [log, onClick]\n    );\n\n    const detailsShown = detailsDisplayed(log);\n\n    return (\n      <>\n        <div\n          className={`${styles.logLine} ${variant ?? ''} ${pinned ? styles.pinnedLogLine : ''} ${permalinked ? styles.permalinkedLogLine : ''} ${detailsShown ? styles.detailsDisplayed : ''} ${fontSize === 'small' ? styles.fontSizeSmall : ''}`}\n          ref={onOverflow ? logLineRef : undefined}\n          onMouseEnter={handleMouseOver}\n          onFocus={handleMouseOver}\n        >\n          <LogLineMenu styles={styles} log={log} />\n          {dedupStrategy !== LogsDedupStrategy.none && (\n            <div className={`${styles.duplicates}`}>\n              {log.duplicates && log.duplicates > 0 ? `${log.duplicates + 1}x` : null}\n            </div>\n          )}\n          {hasLogsWithErrors && (\n            <div className={`${styles.hasError}`}>\n              {log.hasError && (\n                <Tooltip\n                  content={t('logs.log-line.tooltip-error', 'Error: {{errorMessage}}', {\n                    errorMessage: log.errorMessage,\n                  })}\n                  placement=\"right\"\n                  theme=\"error\"\n                >\n                  <Icon\n                    className={styles.logIconError}\n                    name=\"exclamation-triangle\"\n                    aria-label={t('logs.log-line.has-error', 'Has errors')}\n                    size=\"xs\"\n                  />\n                </Tooltip>\n              )}\n            </div>\n          )}\n          {hasSampledLogs && (\n            <div className={`${styles.isSampled}`}>\n              {log.isSampled && (\n                <Tooltip content={log.sampledMessage ?? ''} placement=\"right\" theme=\"info\">\n                  <Icon\n                    className={styles.logIconInfo}\n                    name=\"info-circle\"\n                    size=\"xs\"\n                    aria-label={t('logs.log-line.is-sampled', 'Is sampled')}\n                  />\n                </Tooltip>\n              )}\n            </div>\n          )}\n          {/* A button element could be used but in Safari it prevents text selection. Fallback available for a11y in LogLineMenu  */}\n          {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */}\n          <div\n            className={`${styles.fieldsWrapper} ${detailsShown ? styles.detailsDisplayed : ''} ${wrapLogMessage ? styles.wrappedLogLine : `${styles.unwrappedLogLine} unwrapped-log-line`} ${collapsed === true ? styles.collapsedLogLine : ''} ${enableLogDetails ? styles.clickable : ''}`}\n            style={\n              collapsed && virtualization\n                ? { maxHeight: `${virtualization.getTruncationLineCount() * virtualization.getLineHeight()}px` }\n                : undefined\n            }\n            onClick={handleClick}\n          >\n            <Log\n              displayedFields={displayedFields}\n              log={log}\n              showTime={showTime}\n              styles={styles}\n              wrapLogMessage={wrapLogMessage}\n            />\n          </div>\n        </div>\n        {collapsed === true && (\n          <div className={styles.expandCollapseControl}>\n            <Button\n              variant=\"primary\"\n              fill=\"text\"\n              size=\"sm\"\n              className={styles.expandCollapseControlButton}\n              onClick={handleExpandCollapse}\n            >\n              {t('logs.log-line.show-more', 'show more')}\n            </Button>\n          </div>\n        )}\n        {collapsed === false && (\n          <div className={styles.expandCollapseControl}>\n            <Button\n              variant=\"primary\"\n              fill=\"text\"\n              size=\"sm\"\n              className={styles.expandCollapseControlButton}\n              onClick={handleExpandCollapse}\n            >\n              {t('logs.log-line.show-less', 'show less')}\n            </Button>\n          </div>\n        )}\n        {detailsMode === 'inline' && detailsShown && <InlineLogLineDetails logs={[]} />}\n      </>\n    );\n  }\n);\nLogLineComponent.displayName = 'LogLineComponent';\n\ninterface LogProps {\n  displayedFields: string[];\n  log: LogListModel;\n  showTime: boolean;\n  styles: LogLineStyles;\n  wrapLogMessage: boolean;\n}\n\nconst Log = memo(({ displayedFields, log, showTime, styles, wrapLogMessage }: LogProps) => {\n  return (\n    <>\n      {showTime && <span className={`${styles.timestamp} level-${log.logLevel} field`}>{log.timestamp}</span>}\n      {\n        // When logs are unwrapped, we want an empty column space to align with other log lines.\n      }\n      {(log.displayLevel || !wrapLogMessage) && (\n        <span className={`${styles.level} level-${log.logLevel} field`}>{log.displayLevel}</span>\n      )}\n      {displayedFields.length > 0 ? (\n        <DisplayedFields displayedFields={displayedFields} log={log} styles={styles} />\n      ) : (\n        <LogLineBody log={log} styles={styles} />\n      )}\n    </>\n  );\n});\nLog.displayName = 'Log';\n\nconst DisplayedFields = ({\n  displayedFields,\n  log,\n  styles,\n}: {\n  displayedFields: string[];\n  log: LogListModel;\n  styles: LogLineStyles;\n}) => {\n  const { matchingUids, search } = useLogListSearchContext();\n\n  const searchWords = useMemo(() => {\n    const searchWords = log.searchWords && log.searchWords[0] ? log.searchWords.slice() : [];\n    if (search && matchingUids?.includes(log.uid)) {\n      searchWords.push(search);\n    }\n    if (!searchWords.length) {\n      return undefined;\n    }\n    return searchWords;\n  }, [log.searchWords, log.uid, matchingUids, search]);\n\n  return displayedFields.map((field) =>\n    field === LOG_LINE_BODY_FIELD_NAME ? (\n      <LogLineBody log={log} key={field} styles={styles} />\n    ) : (\n      <span className=\"field\" title={field} key={field}>\n        {searchWords ? (\n          <Highlighter\n            textToHighlight={log.getDisplayedFieldValue(field)}\n            searchWords={searchWords}\n            findChunks={findHighlightChunksInText}\n            highlightClassName={styles.matchHighLight}\n          />\n        ) : (\n          log.getDisplayedFieldValue(field)\n        )}\n      </span>\n    )\n  );\n};\n\nconst LogLineBody = ({ log, styles }: { log: LogListModel; styles: LogLineStyles }) => {\n  const { syntaxHighlighting } = useLogListContext();\n  const { matchingUids, search } = useLogListSearchContext();\n\n  const highlight = useMemo(() => {\n    const searchWords = log.searchWords && log.searchWords[0] ? log.searchWords.slice() : [];\n    if (search && matchingUids?.includes(log.uid)) {\n      searchWords.push(search);\n    }\n    if (!searchWords.length) {\n      return undefined;\n    }\n    return { searchWords, highlightClassName: styles.matchHighLight };\n  }, [log.searchWords, log.uid, matchingUids, search, styles.matchHighLight]);\n\n  if (log.hasAnsi) {\n    return (\n      <span className=\"field no-highlighting\">\n        <LogMessageAnsi value={log.body} highlight={highlight} />\n      </span>\n    );\n  }\n\n  if (!syntaxHighlighting) {\n    return highlight ? (\n      <Highlighter\n        textToHighlight={log.body}\n        searchWords={highlight.searchWords}\n        findChunks={findHighlightChunksInText}\n        highlightClassName={styles.matchHighLight}\n      />\n    ) : (\n      <span className=\"field no-highlighting\">{log.body}</span>\n    );\n  }\n\n  return <span className=\"field log-syntax-highlight\" dangerouslySetInnerHTML={{ __html: log.highlightedBody }} />;\n};\n\nexport function getGridTemplateColumns(dimensions: LogFieldDimension[], displayedFields: string[]) {\n  const columns = dimensions.map((dimension) => dimension.width).join('px ');\n  const logLineWidth = displayedFields.length > 0 ? '' : ' 1fr';\n  return `${columns}px${logLineWidth}`;\n}\n\nexport type LogLineStyles = ReturnType<typeof getStyles>;\nexport const getStyles = (theme: GrafanaTheme2, virtualization?: LogLineVirtualization) => {\n  const colors = {\n    critical: '#B877D9',\n    error: theme.colors.error.text,\n    warning: '#FBAD37',\n    debug: '#6E9FFF',\n    trace: '#6ed0e0',\n    info: '#6CCF8E',\n    metadata: theme.colors.text.primary,\n    parsedField: theme.colors.text.primary,\n  };\n\n  const hoverColor = tinycolor(theme.colors.background.canvas).darken(4).toRgbString();\n\n  return {\n    logLine: css({\n      color: tinycolor(theme.colors.text.secondary).setAlpha(0.75).toRgbString(),\n      display: 'flex',\n      gap: theme.spacing(0.5),\n      flexDirection: 'row',\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.fontSize,\n      lineHeight: theme.typography.body.lineHeight,\n      wordBreak: 'break-all',\n      '&:hover': {\n        background: hoverColor,\n      },\n      '&.infinite-scroll': {\n        '&::before': {\n          borderTop: `solid 1px ${theme.colors.border.strong}`,\n          content: '\"\"',\n          height: 0,\n          left: 0,\n          position: 'absolute',\n          top: -3,\n          width: '100%',\n        },\n      },\n      '& .log-syntax-highlight': {\n        '.log-token-string': {\n          color: tinycolor(theme.colors.text.secondary).setAlpha(0.75).toRgbString(),\n        },\n        '.log-token-duration': {\n          color: theme.colors.success.text,\n        },\n        '.log-token-size': {\n          color: theme.colors.success.text,\n        },\n        '.log-token-uuid': {\n          color: theme.colors.success.text,\n        },\n        '.log-token-key': {\n          color: colors.parsedField,\n          opacity: 0.9,\n          fontWeight: theme.typography.fontWeightMedium,\n        },\n        '.log-token-json-key': {\n          color: colors.parsedField,\n          opacity: 0.9,\n          fontWeight: theme.typography.fontWeightMedium,\n        },\n        '.log-token-label': {\n          color: colors.metadata,\n          fontWeight: theme.typography.fontWeightBold,\n        },\n        '.log-token-method': {\n          color: theme.colors.info.shade,\n        },\n        '.log-search-match': {\n          color: theme.components.textHighlight.text,\n          backgroundColor: theme.components.textHighlight.background,\n        },\n      },\n      '& .no-highlighting': {\n        color: theme.colors.text.primary,\n      },\n    }),\n    matchHighLight: css({\n      color: theme.components.textHighlight.text,\n      backgroundColor: theme.components.textHighlight.background,\n    }),\n    fontSizeSmall: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      lineHeight: theme.typography.bodySmall.lineHeight,\n    }),\n    detailsDisplayed: css({\n      background: hoverColor,\n    }),\n    pinnedLogLine: css({\n      backgroundColor: tinycolor(theme.colors.info.transparent).setAlpha(0.25).toString(),\n    }),\n    permalinkedLogLine: css({\n      backgroundColor: tinycolor(theme.colors.info.transparent).setAlpha(0.25).toString(),\n    }),\n    menuIcon: css({\n      height: virtualization?.getLineHeight() ?? DEFAULT_LINE_HEIGHT,\n      margin: 0,\n      padding: theme.spacing(0, 0, 0, 0.5),\n    }),\n    logLineMessage: css({\n      fontFamily: theme.typography.fontFamily,\n      justifyContent: 'center',\n    }),\n    timestamp: css({\n      color: theme.colors.text.disabled,\n      display: 'inline-block',\n    }),\n    duplicates: css({\n      flexShrink: 0,\n      textAlign: 'center',\n      width: theme.spacing(4.5),\n    }),\n    hasError: css({\n      flexShrink: 0,\n      width: theme.spacing(2),\n      '& svg': {\n        position: 'relative',\n        top: -1,\n      },\n    }),\n    isSampled: css({\n      flexShrink: 0,\n      width: theme.spacing(2),\n      '& svg': {\n        position: 'relative',\n        top: -1,\n      },\n    }),\n    logIconError: css({\n      color: theme.colors.warning.main,\n    }),\n    logIconInfo: css({\n      color: theme.colors.info.main,\n    }),\n    level: css({\n      color: theme.colors.text.secondary,\n      fontWeight: theme.typography.fontWeightBold,\n      textTransform: 'uppercase',\n      display: 'inline-block',\n      '&.level-critical': {\n        color: colors.critical,\n      },\n      '&.level-error': {\n        color: colors.error,\n      },\n      '&.level-warning': {\n        color: colors.warning,\n      },\n      '&.level-info': {\n        color: colors.info,\n      },\n      '&.level-debug': {\n        color: colors.debug,\n      },\n    }),\n    loadMoreButton: css({\n      background: 'transparent',\n      border: 'none',\n      display: 'inline',\n    }),\n    overflows: css({\n      outline: 'solid 1px red',\n    }),\n    clickable: css({\n      cursor: 'pointer',\n    }),\n    unwrappedLogLine: css({\n      display: 'grid',\n      gridColumnGap: theme.spacing(FIELD_GAP_MULTIPLIER),\n      whiteSpace: 'pre',\n      paddingBottom: theme.spacing(0.75),\n    }),\n    wrappedLogLine: css({\n      alignSelf: 'flex-start',\n      paddingBottom: theme.spacing(0.75),\n      whiteSpace: 'pre-wrap',\n      '& .field': {\n        marginRight: theme.spacing(FIELD_GAP_MULTIPLIER),\n      },\n      '& .field:last-child': {\n        marginRight: 0,\n      },\n    }),\n    fieldsWrapper: css({\n      '&:hover': {\n        background: hoverColor,\n      },\n    }),\n    collapsedLogLine: css({\n      overflow: 'hidden',\n    }),\n    expandCollapseControl: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    expandCollapseControlButton: css({\n      fontWeight: theme.typography.fontWeightLight,\n      height: virtualization?.getLineHeight() ?? DEFAULT_LINE_HEIGHT,\n      margin: 0,\n    }),\n  };\n};\n","import { CSSProperties, ReactNode } from 'react';\n\nimport { LogLineStyles } from './LogLine';\n\ninterface Props {\n  children: ReactNode;\n  onClick?: () => void;\n  style: CSSProperties;\n  styles: LogLineStyles;\n}\n\nexport const LogLineMessage = ({ children, onClick, style, styles }: Props) => {\n  return (\n    <div style={style} className={`${styles.logLine} ${styles.logLineMessage}`}>\n      {onClick ? (\n        <button className={styles.loadMoreButton} onClick={onClick}>\n          {children}\n        </button>\n      ) : (\n        children\n      )}\n    </div>\n  );\n};\n","import { ReactNode, useCallback, useEffect, useRef, useState, MouseEvent } from 'react';\nimport { usePrevious } from 'react-use';\nimport { ListChildComponentProps, ListOnItemsRenderedProps } from 'react-window';\n\nimport { AbsoluteTimeRange, LogsSortOrder, TimeRange } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { Spinner, useStyles2 } from '@grafana/ui';\n\nimport { canScrollBottom, getVisibleRange, ScrollDirection, shouldLoadMore } from '../InfiniteScroll';\n\nimport { getStyles, LogLine } from './LogLine';\nimport { LogLineMessage } from './LogLineMessage';\nimport { LogListModel } from './processing';\nimport { LogLineVirtualization } from './virtualization';\n\ninterface ChildrenProps {\n  itemCount: number;\n  getItemKey: (index: number) => string;\n  onItemsRendered: (props: ListOnItemsRenderedProps) => void;\n  Renderer: (props: ListChildComponentProps) => ReactNode;\n}\n\ninterface Props {\n  children: (props: ChildrenProps) => ReactNode;\n  displayedFields: string[];\n  handleOverflow: (index: number, id: string, height?: number) => void;\n  loadMore?: (range: AbsoluteTimeRange) => void;\n  logs: LogListModel[];\n  onClick: (e: MouseEvent<HTMLElement>, log: LogListModel) => void;\n  scrollElement: HTMLDivElement | null;\n  setInitialScrollPosition: () => void;\n  showTime: boolean;\n  sortOrder: LogsSortOrder;\n  timeRange: TimeRange;\n  timeZone: string;\n  virtualization: LogLineVirtualization;\n  wrapLogMessage: boolean;\n}\n\ntype InfiniteLoaderState = 'idle' | 'out-of-bounds' | 'pre-scroll' | 'loading';\n\nexport const InfiniteScroll = ({\n  children,\n  displayedFields,\n  handleOverflow,\n  loadMore,\n  logs,\n  onClick,\n  scrollElement,\n  setInitialScrollPosition,\n  showTime,\n  sortOrder,\n  timeRange,\n  timeZone,\n  virtualization,\n  wrapLogMessage,\n}: Props) => {\n  const [infiniteLoaderState, setInfiniteLoaderState] = useState<InfiniteLoaderState>('idle');\n  const [autoScroll, setAutoScroll] = useState(false);\n  const prevLogs = usePrevious(logs);\n  const prevSortOrder = usePrevious(sortOrder);\n  const lastScroll = useRef<number>(scrollElement?.scrollTop || 0);\n  const lastEvent = useRef<Event | WheelEvent | null>(null);\n  const countRef = useRef(0);\n  const lastLogOfPage = useRef<string[]>([]);\n  const styles = useStyles2(getStyles, virtualization);\n\n  useEffect(() => {\n    // Logs have not changed, ignore effect\n    if (!prevLogs || prevLogs === logs) {\n      return;\n    }\n    // New logs are from infinite scrolling\n    if (infiniteLoaderState === 'loading') {\n      // out-of-bounds if no new logs returned\n      setInfiniteLoaderState(logs.length === prevLogs.length ? 'out-of-bounds' : 'idle');\n    } else {\n      lastLogOfPage.current = [];\n      setAutoScroll(true);\n    }\n  }, [infiniteLoaderState, logs, prevLogs]);\n\n  useEffect(() => {\n    if (prevSortOrder && prevSortOrder !== sortOrder) {\n      setInfiniteLoaderState('idle');\n    }\n  }, [prevSortOrder, sortOrder]);\n\n  useEffect(() => {\n    if (autoScroll) {\n      setInitialScrollPosition();\n      setAutoScroll(false);\n    }\n  }, [autoScroll, setInitialScrollPosition]);\n\n  const onLoadMore = useCallback(() => {\n    const newRange = canScrollBottom(getVisibleRange(logs), timeRange, timeZone, sortOrder);\n    if (!newRange) {\n      setInfiniteLoaderState('out-of-bounds');\n      return;\n    }\n    lastLogOfPage.current.push(logs[logs.length - 1].uid);\n    setInfiniteLoaderState('loading');\n    loadMore?.(newRange);\n\n    reportInteraction('grafana_logs_infinite_scrolling', {\n      direction: 'bottom',\n      sort_order: sortOrder,\n    });\n  }, [loadMore, logs, sortOrder, timeRange, timeZone]);\n\n  useEffect(() => {\n    if (!scrollElement || !loadMore || !config.featureToggles.logsInfiniteScrolling) {\n      return;\n    }\n\n    function handleScroll(event: Event | WheelEvent) {\n      if (!scrollElement || !loadMore || !logs.length || infiniteLoaderState !== 'pre-scroll') {\n        return;\n      }\n      const scrollDirection = shouldLoadMore(event, lastEvent.current, countRef, scrollElement, lastScroll.current);\n      lastEvent.current = event;\n      lastScroll.current = scrollElement.scrollTop;\n      if (scrollDirection === ScrollDirection.Bottom) {\n        onLoadMore();\n      }\n    }\n\n    scrollElement.addEventListener('scroll', handleScroll);\n    scrollElement.addEventListener('wheel', handleScroll);\n\n    return () => {\n      scrollElement.removeEventListener('scroll', handleScroll);\n      scrollElement.removeEventListener('wheel', handleScroll);\n    };\n  }, [infiniteLoaderState, loadMore, logs.length, onLoadMore, scrollElement]);\n\n  const Renderer = useCallback(\n    ({ index, style }: ListChildComponentProps) => {\n      if (!logs[index] && infiniteLoaderState !== 'idle') {\n        return (\n          <LogLineMessage\n            style={style}\n            styles={styles}\n            onClick={infiniteLoaderState === 'pre-scroll' ? onLoadMore : undefined}\n          >\n            {getMessageFromInfiniteLoaderState(infiniteLoaderState, sortOrder)}\n          </LogLineMessage>\n        );\n      }\n      return (\n        <LogLine\n          displayedFields={displayedFields}\n          index={index}\n          log={logs[index]}\n          onClick={onClick}\n          showTime={showTime}\n          style={style}\n          styles={styles}\n          variant={getLogLineVariant(logs, index, lastLogOfPage.current)}\n          virtualization={virtualization}\n          wrapLogMessage={wrapLogMessage}\n          onOverflow={handleOverflow}\n        />\n      );\n    },\n    [\n      displayedFields,\n      handleOverflow,\n      infiniteLoaderState,\n      logs,\n      onClick,\n      onLoadMore,\n      showTime,\n      sortOrder,\n      styles,\n      virtualization,\n      wrapLogMessage,\n    ]\n  );\n\n  const onItemsRendered = useCallback(\n    (props: ListOnItemsRenderedProps) => {\n      if (!scrollElement || infiniteLoaderState === 'loading' || infiniteLoaderState === 'out-of-bounds') {\n        return;\n      }\n      if (scrollElement.scrollHeight <= scrollElement.clientHeight) {\n        return;\n      }\n      const lastLogIndex = logs.length - 1;\n      const preScrollIndex = logs.length - 2;\n      if (props.visibleStopIndex >= lastLogIndex) {\n        setInfiniteLoaderState('pre-scroll');\n      } else if (props.visibleStartIndex < preScrollIndex) {\n        setInfiniteLoaderState('idle');\n      }\n    },\n    [infiniteLoaderState, logs.length, scrollElement]\n  );\n\n  const getItemKey = useCallback((index: number) => (logs[index] ? logs[index].uid : index.toString()), [logs]);\n\n  const itemCount = logs.length && loadMore && infiniteLoaderState !== 'idle' ? logs.length + 1 : logs.length;\n\n  return <>{children({ getItemKey, itemCount, onItemsRendered, Renderer })}</>;\n};\n\nfunction getMessageFromInfiniteLoaderState(state: InfiniteLoaderState, order: LogsSortOrder) {\n  switch (state) {\n    case 'out-of-bounds':\n      return t('logs.infinite-scroll.end-of-range', 'End of the selected time range.');\n    case 'loading':\n      return (\n        <>\n          {order === LogsSortOrder.Ascending\n            ? t('logs.infinite-scroll.load-newer', 'Loading newer logs...')\n            : t('logs.infinite-scroll.load-older', 'Loading older logs...')}{' '}\n          <Spinner inline />\n        </>\n      );\n    case 'pre-scroll':\n      return t('logs.infinite-scroll.load-more', 'Scroll to load more');\n    default:\n      return null;\n  }\n}\n\nfunction getLogLineVariant(logs: LogListModel[], index: number, lastLogOfPage: string[]) {\n  if (!lastLogOfPage.length || !logs[index - 1]) {\n    return undefined;\n  }\n  const prevLog = logs[index - 1];\n  for (const uid of lastLogOfPage) {\n    if (prevLog.uid === uid) {\n      // First log of an infinite scrolling page\n      return 'infinite-scroll';\n    }\n  }\n  return undefined;\n}\n","import { css } from '@emotion/css';\nimport { ChangeEvent, startTransition, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { VariableSizeList } from 'react-window';\n\nimport { escapeRegex, GrafanaTheme2, shallowCompare } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { IconButton, Input, useStyles2 } from '@grafana/ui';\n\nimport { useLogListContext } from './LogListContext';\nimport { useLogListSearchContext } from './LogListSearchContext';\nimport { LogListModel } from './processing';\n\ninterface Props {\n  listRef: VariableSizeList | null;\n  logs: LogListModel[];\n}\n\nexport const LOG_LIST_SEARCH_HEIGHT = 48;\nexport const LogListSearch = ({ listRef, logs }: Props) => {\n  const {\n    hideSearch,\n    filterLogs,\n    matchingUids,\n    setMatchingUids,\n    setSearch: setContextSearch,\n    searchVisible,\n    toggleFilterLogs,\n  } = useLogListSearchContext();\n  const { displayedFields } = useLogListContext();\n  const [search, setSearch] = useState('');\n  const [currentResult, setCurrentResult] = useState<number | null>(null);\n  const inputRef = useRef('');\n  const styles = useStyles2(getStyles);\n\n  const matches = useMemo(() => {\n    if (!search || !searchVisible) {\n      return [];\n    }\n    return findMatchingLogs(logs, search, displayedFields);\n  }, [displayedFields, logs, search, searchVisible]);\n\n  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    inputRef.current = e.target.value;\n    startTransition(() => {\n      setSearch(inputRef.current);\n    });\n  }, []);\n\n  const prevResult = useCallback(() => {\n    if (currentResult === null) {\n      return;\n    }\n    const prev = currentResult > 0 ? currentResult - 1 : matches.length - 1;\n    setCurrentResult(prev);\n    listRef?.scrollToItem(logs.indexOf(matches[prev]), 'center');\n  }, [currentResult, listRef, logs, matches]);\n\n  const nextResult = useCallback(() => {\n    if (currentResult === null) {\n      return;\n    }\n    const next = currentResult < matches.length - 1 ? currentResult + 1 : 0;\n    setCurrentResult(next);\n    listRef?.scrollToItem(logs.indexOf(matches[next]), 'center');\n  }, [currentResult, listRef, logs, matches]);\n\n  useEffect(() => {\n    if (!matches.length) {\n      setCurrentResult(null);\n      return;\n    }\n    if (!currentResult) {\n      setCurrentResult(0);\n      listRef?.scrollToItem(logs.indexOf(matches[0]), 'center');\n    }\n  }, [currentResult, listRef, logs, matches]);\n\n  useEffect(() => {\n    if (!searchVisible) {\n      setSearch('');\n      setContextSearch(undefined);\n      setMatchingUids(null);\n    }\n  }, [searchVisible, setContextSearch, setMatchingUids]);\n\n  useEffect(() => {\n    const newMatchingUids = matches.map((log) => log.uid);\n    const sameLogs = matchingUids ? shallowCompare(matchingUids, newMatchingUids) : false;\n\n    if (matchingUids && !sameLogs) {\n      // Cleanup previous matches\n      logs\n        .filter((log) => matchingUids.includes(log.uid))\n        .filter((prevMatchingLog) => matches.findIndex((matchingLog) => matchingLog.uid === prevMatchingLog.uid) < 0)\n        .forEach((log) => log.setCurrentSearch(undefined));\n    }\n\n    setContextSearch(search ? search : undefined);\n    if (!sameLogs) {\n      setMatchingUids(newMatchingUids.length ? newMatchingUids : null);\n    } else if (!matches.length) {\n      setMatchingUids(null);\n    }\n  }, [logs, matches, matchingUids, search, setContextSearch, setMatchingUids]);\n\n  if (!searchVisible) {\n    return null;\n  }\n\n  const suffix =\n    search !== '' ? <>{`${currentResult !== null ? currentResult + 1 : 0}/${matches?.length ?? 0}`}</> : undefined;\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.wrapper}>\n        <Input\n          onChange={handleChange}\n          autoFocus\n          placeholder={t('logs.log-list-search.input-placeholder', 'Search in logs')}\n          suffix={suffix}\n        />\n      </div>\n      <IconButton\n        name=\"info-circle\"\n        variant=\"secondary\"\n        tooltip={t(\n          'logs.log-list-search.info',\n          'Client-side search for strings within the displayed logs. Not to be confused with query filters. Use this component to search for specific strings in your log results.'\n        )}\n      />\n      <IconButton\n        onClick={prevResult}\n        disabled={!matches || !matches.length}\n        name=\"angle-up\"\n        aria-label={t('logs.log-list-search.prev', 'Previous result')}\n      />\n      <IconButton\n        onClick={nextResult}\n        disabled={!matches || !matches.length}\n        name=\"angle-down\"\n        aria-label={t('logs.log-list-search.next', 'Next result')}\n      />\n      <IconButton\n        onClick={toggleFilterLogs}\n        disabled={!matches || !matches.length}\n        className={filterLogs ? styles.controlButtonActive : undefined}\n        name=\"filter\"\n        aria-label={t('logs.log-list-search.filter', 'Filter matching logs')}\n      />\n      <IconButton onClick={hideSearch} name=\"times\" aria-label={t('logs.log-list-search.close', 'Close search')} />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    background: theme.colors.background.elevated,\n    display: 'flex',\n    gap: theme.spacing(1),\n    padding: theme.spacing(1),\n    zIndex: theme.zIndex.modal,\n    overflow: 'hidden',\n    width: '100%',\n  }),\n  wrapper: css({\n    width: '50%',\n  }),\n  controlButtonActive: css({\n    '&:after': {\n      display: 'block',\n      content: '\" \"',\n      position: 'absolute',\n      height: 2,\n      borderRadius: theme.shape.radius.default,\n      bottom: 2,\n      backgroundImage: theme.colors.gradients.brandHorizontal,\n      width: '95%',\n      opacity: 1,\n    },\n  }),\n});\n\nfunction findMatchingLogs(logs: LogListModel[], search: string, displayedFields: string[]) {\n  const regex = new RegExp(escapeRegex(search), 'i');\n  const newMatches = logs.filter((log) => {\n    if (log.entry.match(regex)) {\n      return true;\n    }\n\n    return displayedFields.some((field) => log.getDisplayedFieldValue(field).match(regex));\n  });\n  newMatches.forEach((log) => log.setCurrentSearch(search));\n  return newMatches;\n}\n","import { Grammar } from 'prismjs';\n\nimport { escapeRegex, parseFlags } from '@grafana/data';\n\nimport { LogListModel } from './processing';\n\n// The Logs grammar is used for highlight in the logs panel\nexport const logsGrammar: Grammar = {\n  'log-token-uuid': /[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}/g,\n  'log-token-json-key': /\"(\\b|\\B)[\\w-]+\"(?=\\s*:)/gi,\n  'log-token-key': /(\\b|\\B)[\\w_]+(?=\\s*=)/gi,\n  'log-token-size': /(?:\\b|\")\\d+\\.{0,1}\\d*\\s*[kKmMGgtTPp]*[bB]{1}(?:\"|\\b)/g,\n  'log-token-duration': /(?:\\b)\\d+(\\.\\d+)?(ns|s|ms|s|m|h|d)(?:\\b)/g,\n  'log-token-method': /\\b(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|TRACE|CONNECT)\\b/g,\n  'log-token-string': /\"(?!:)([^'\"])*?\"(?!:)/g,\n};\n\nexport const generateLogGrammar = (log: LogListModel) => {\n  const labels = Object.keys(log.labels).concat(log.fields.map((field) => field.keys[0]));\n  const logGrammar: Grammar = {\n    'log-token-label': new RegExp(`\\\\b(${labels.join('|')})(?:[=:]{1})\\\\b`, 'g'),\n  };\n  return {\n    ...logGrammar,\n    ...logsGrammar,\n  };\n};\n\nexport const generateTextMatchGrammar = (\n  highlightWords: string[] | undefined = [],\n  search: string | undefined\n): Grammar => {\n  /**\n   * See:\n   * - https://github.com/grafana/grafana/blob/96f1582c36f94cf4ac7621b7af86bc9e2ad626fb/public/app/features/logs/components/LogRowMessage.tsx#L67\n   * - https://github.com/grafana/grafana/blob/96f1582c36f94cf4ac7621b7af86bc9e2ad626fb/packages/grafana-data/src/text/text.ts#L12\n   */\n  const expressions = highlightWords.map((word) => {\n    const { cleaned, flags } = parseFlags(cleanNeedle(word));\n    return new RegExp(`(?:${cleaned})`, flags);\n  });\n  if (search) {\n    expressions.push(new RegExp(escapeRegex(search), 'gi'));\n  }\n  if (!expressions.length) {\n    return {};\n  }\n  return {\n    'log-search-match': expressions,\n  };\n};\n\nconst cleanNeedle = (needle: string): string => {\n  return needle.replace(/[[{(][\\w,.\\/:;<=>?:*+]+$/, '');\n};\n","import ansicolor from 'ansicolor';\nimport Prism, { Grammar } from 'prismjs';\n\nimport { DataFrame, dateTimeFormat, Labels, LogLevel, LogRowModel, LogsSortOrder } from '@grafana/data';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { checkLogsError, checkLogsSampled, escapeUnescapedString, sortLogRows } from '../../utils';\nimport { LOG_LINE_BODY_FIELD_NAME } from '../LogDetailsBody';\nimport { FieldDef, getAllFields } from '../logParser';\n\nimport { generateLogGrammar, generateTextMatchGrammar } from './grammar';\nimport { LogLineVirtualization } from './virtualization';\n\nconst TRUNCATION_DEFAULT_LENGTH = 50000;\nconst NEWLINES_REGEX = /(\\r\\n|\\n|\\r)/g;\n\nexport class LogListModel implements LogRowModel {\n  collapsed: boolean | undefined = undefined;\n  datasourceType: string | undefined;\n  dataFrame: DataFrame;\n  datasourceUid?: string;\n  displayLevel: string;\n  duplicates: number | undefined;\n  entry: string;\n  entryFieldIndex: number;\n  hasAnsi: boolean;\n  hasError: boolean;\n  hasUnescapedContent: boolean;\n  isSampled: boolean;\n  labels: Labels;\n  logLevel: LogLevel;\n  raw: string;\n  rowIndex: number;\n  rowId?: string | undefined;\n  searchWords: string[] | undefined;\n  timestamp: string;\n  timeFromNow: string;\n  timeEpochMs: number;\n  timeEpochNs: string;\n  timeLocal: string;\n  timeUtc: string;\n  uid: string;\n  uniqueLabels: Labels | undefined;\n\n  private _body: string | undefined = undefined;\n  private _currentSearch: string | undefined = undefined;\n  private _grammar?: Grammar;\n  private _highlightedBody: string | undefined = undefined;\n  private _fields: FieldDef[] | undefined = undefined;\n  private _getFieldLinks: GetFieldLinksFn | undefined = undefined;\n  private _virtualization?: LogLineVirtualization;\n  private _wrapLogMessage: boolean;\n\n  constructor(\n    log: LogRowModel,\n    { escape, getFieldLinks, grammar, timeZone, virtualization, wrapLogMessage }: PreProcessLogOptions\n  ) {\n    // LogRowModel\n    this.datasourceType = log.datasourceType;\n    this.dataFrame = log.dataFrame;\n    this.datasourceUid = log.datasourceUid;\n    this.duplicates = log.duplicates;\n    this.entry = log.entry;\n    this.entryFieldIndex = log.entryFieldIndex;\n    this.hasAnsi = log.hasAnsi;\n    this.hasError = !!checkLogsError(log);\n    this.hasUnescapedContent = log.hasUnescapedContent;\n    this.isSampled = !!checkLogsSampled(log);\n    this.labels = log.labels;\n    this.logLevel = log.logLevel;\n    this.rowIndex = log.rowIndex;\n    this.rowId = log.rowId;\n    this.searchWords = log.searchWords;\n    this.timeFromNow = log.timeFromNow;\n    this.timeEpochMs = log.timeEpochMs;\n    this.timeEpochNs = log.timeEpochNs;\n    this.timeLocal = log.timeLocal;\n    this.timeUtc = log.timeUtc;\n    this.uid = log.uid;\n    this.uniqueLabels = log.uniqueLabels;\n\n    // LogListModel\n    this.displayLevel = logLevelToDisplayLevel(log.logLevel);\n    this._getFieldLinks = getFieldLinks;\n    this._grammar = grammar;\n    this.timestamp = dateTimeFormat(log.timeEpochMs, {\n      timeZone,\n      defaultWithMS: true,\n    });\n    this._virtualization = virtualization;\n    this._wrapLogMessage = wrapLogMessage;\n\n    let raw = log.raw;\n    if (escape && log.hasUnescapedContent) {\n      raw = escapeUnescapedString(raw);\n    }\n    this.raw = raw;\n  }\n\n  get body(): string {\n    if (this._body === undefined) {\n      this._body = this.collapsed\n        ? this.raw.substring(0, this._virtualization?.getTruncationLength(null) ?? TRUNCATION_DEFAULT_LENGTH)\n        : this.raw;\n      if (!this._wrapLogMessage) {\n        this._body = this._body.replace(NEWLINES_REGEX, '');\n      }\n    }\n    return this._body;\n  }\n\n  get errorMessage(): string | undefined {\n    return checkLogsError(this);\n  }\n\n  get fields(): FieldDef[] {\n    if (this._fields === undefined) {\n      this._fields = getAllFields(this, this._getFieldLinks);\n    }\n    return this._fields;\n  }\n\n  get highlightedBody() {\n    if (this._highlightedBody === undefined) {\n      this._grammar = this._grammar ?? generateLogGrammar(this);\n      const extraGrammar = generateTextMatchGrammar(this.searchWords, this._currentSearch);\n      this._highlightedBody = Prism.highlight(this.body, { ...extraGrammar, ...this._grammar }, 'lokiql');\n    }\n    return this._highlightedBody;\n  }\n\n  get sampledMessage(): string | undefined {\n    return checkLogsSampled(this);\n  }\n\n  getDisplayedFieldValue(fieldName: string, stripAnsi = false): string {\n    if (fieldName === LOG_LINE_BODY_FIELD_NAME) {\n      return stripAnsi ? ansicolor.strip(this.body) : this.body;\n    }\n    let fieldValue = '';\n    if (this.labels[fieldName] != null) {\n      fieldValue = this.labels[fieldName];\n    } else {\n      const field = this.fields.find((field) => {\n        return field.keys[0] === fieldName;\n      });\n\n      fieldValue = field ? field.values.toString() : '';\n    }\n    if (!this._wrapLogMessage) {\n      return fieldValue.replace(NEWLINES_REGEX, '');\n    }\n    return fieldValue;\n  }\n\n  updateCollapsedState(displayedFields: string[], container: HTMLDivElement | null) {\n    const lineLength =\n      displayedFields.length > 0\n        ? displayedFields.map((field) => this.getDisplayedFieldValue(field, true)).join('').length\n        : this.entry.length;\n    const collapsed =\n      lineLength >= (this._virtualization?.getTruncationLength(container) ?? TRUNCATION_DEFAULT_LENGTH)\n        ? true\n        : undefined;\n    if (this.collapsed === undefined || collapsed === undefined) {\n      this.collapsed = collapsed;\n    }\n    return this.collapsed;\n  }\n\n  setCollapsedState(collapsed: boolean) {\n    if (this.collapsed !== collapsed) {\n      this._body = undefined;\n      this._highlightedBody = undefined;\n    }\n    this.collapsed = collapsed;\n  }\n\n  setCurrentSearch(search: string | undefined) {\n    this._currentSearch = search;\n    this._highlightedBody = undefined;\n  }\n}\n\nexport interface PreProcessOptions {\n  escape: boolean;\n  getFieldLinks?: GetFieldLinksFn;\n  order: LogsSortOrder;\n  timeZone: string;\n  virtualization?: LogLineVirtualization;\n  wrapLogMessage: boolean;\n}\n\nexport const preProcessLogs = (\n  logs: LogRowModel[],\n  { escape, getFieldLinks, order, timeZone, virtualization, wrapLogMessage }: PreProcessOptions,\n  grammar?: Grammar\n): LogListModel[] => {\n  const orderedLogs = sortLogRows(logs, order);\n  return orderedLogs.map((log) =>\n    preProcessLog(log, { escape, getFieldLinks, grammar, timeZone, virtualization, wrapLogMessage })\n  );\n};\n\ninterface PreProcessLogOptions {\n  escape: boolean;\n  getFieldLinks?: GetFieldLinksFn;\n  grammar?: Grammar;\n  timeZone: string;\n  virtualization?: LogLineVirtualization;\n  wrapLogMessage: boolean;\n}\nconst preProcessLog = (log: LogRowModel, options: PreProcessLogOptions): LogListModel => {\n  return new LogListModel(log, options);\n};\n\nfunction logLevelToDisplayLevel(level = '') {\n  switch (level) {\n    case LogLevel.critical:\n      return 'crit';\n    case LogLevel.warning:\n      return 'warn';\n    case LogLevel.unknown:\n      return '';\n    default:\n      return level;\n  }\n}\n","import { useEffect } from 'react';\n\nimport { useLogListSearchContext } from './LogListSearchContext';\n\n/**\n * Handles toggling of the search box of virtualized Logs Panel.\n * Mousetrap cannot be used because of the following issues:\n * - https://github.com/ccampbell/mousetrap/issues/442\n * - https://github.com/ccampbell/mousetrap/issues/162\n */\n\nexport const useKeyBindings = () => {\n  const { hideSearch, searchVisible, showSearch } = useLogListSearchContext();\n\n  useEffect(() => {\n    function handleToggleSearch(event: KeyboardEvent) {\n      const isMac = navigator.userAgent.includes('Mac');\n      const isFKey = event.key === 'f' || event.key === 'F';\n\n      if ((isMac && event.metaKey && isFKey) || (!isMac && event.ctrlKey && isFKey)) {\n        showSearch();\n        return;\n      }\n      if (event.key === 'Escape' && searchVisible) {\n        hideSearch();\n      }\n    }\n    document.addEventListener('keydown', handleToggleSearch);\n    return () => {\n      document.removeEventListener('keydown', handleToggleSearch);\n    };\n  });\n};\n","import { useCallback, useRef, useState, MouseEvent } from 'react';\n\nimport { config } from '@grafana/runtime';\n\nimport { disablePopoverMenu, enablePopoverMenu, isPopoverMenuDisabled, targetIsElement } from '../../utils';\nimport { PopoverStateType } from '../LogRows';\n\nimport { useLogListContext } from './LogListContext';\nimport { LogListModel } from './processing';\n\nexport const usePopoverMenu = (containerElement: HTMLDivElement | null) => {\n  const [popoverState, setPopoverState] = useState<PopoverStateType>({\n    selection: '',\n    selectedRow: null,\n    popoverMenuCoordinates: { x: 0, y: 0 },\n  });\n  const [showDisablePopoverOptions, setShowDisablePopoverOptions] = useState(false);\n  const handleDeselectionRef = useRef<((e: Event) => void) | null>(null);\n  const { onClickFilterOutString, onClickFilterString } = useLogListContext();\n\n  const popoverMenuSupported = useCallback(() => {\n    if (!config.featureToggles.logRowsPopoverMenu || isPopoverMenuDisabled()) {\n      return false;\n    }\n    return Boolean(onClickFilterOutString || onClickFilterString);\n  }, [onClickFilterOutString, onClickFilterString]);\n\n  const closePopoverMenu = useCallback(() => {\n    if (handleDeselectionRef.current) {\n      document.removeEventListener('click', handleDeselectionRef.current);\n      document.removeEventListener('contextmenu', handleDeselectionRef.current);\n      handleDeselectionRef.current = null;\n    }\n    setPopoverState({\n      selection: '',\n      popoverMenuCoordinates: { x: 0, y: 0 },\n      selectedRow: null,\n    });\n  }, []);\n\n  const handleDeselection = useCallback(\n    (e: Event) => {\n      if (targetIsElement(e.target) && !containerElement?.contains(e.target)) {\n        // The mouseup event comes from outside the log rows, close the menu.\n        closePopoverMenu();\n        return;\n      }\n      if (document.getSelection()?.toString()) {\n        return;\n      }\n      closePopoverMenu();\n    },\n    [closePopoverMenu, containerElement]\n  );\n\n  const handleTextSelection = useCallback(\n    (e: MouseEvent<HTMLElement>, row: LogListModel): boolean => {\n      const selection = document.getSelection()?.toString();\n      if (!selection) {\n        return false;\n      }\n      if (e.altKey) {\n        enablePopoverMenu();\n      }\n      if (popoverMenuSupported() === false) {\n        // This signals onRowClick inside LogRow to skip the event because the user is selecting text\n        return selection ? true : false;\n      }\n\n      if (!containerElement) {\n        return false;\n      }\n\n      const MENU_WIDTH = 270;\n      const MENU_HEIGHT = 105;\n      const x = e.clientX + MENU_WIDTH > window.innerWidth ? window.innerWidth - MENU_WIDTH : e.clientX;\n      const y = e.clientY + MENU_HEIGHT > window.innerHeight ? window.innerHeight - MENU_HEIGHT : e.clientY;\n\n      setPopoverState({\n        selection,\n        popoverMenuCoordinates: { x, y },\n        selectedRow: row,\n      });\n      handleDeselectionRef.current = handleDeselection;\n      document.addEventListener('click', handleDeselection);\n      document.addEventListener('contextmenu', handleDeselection);\n      return true;\n    },\n    [containerElement, handleDeselection, popoverMenuSupported]\n  );\n\n  const onDisablePopoverMenu = useCallback(() => {\n    closePopoverMenu();\n    setShowDisablePopoverOptions(true);\n  }, [closePopoverMenu]);\n\n  const onDisableCancel = useCallback(() => {\n    setShowDisablePopoverOptions(false);\n  }, []);\n\n  const onDisableConfirm = useCallback(() => {\n    disablePopoverMenu();\n    setShowDisablePopoverOptions(false);\n  }, []);\n\n  return {\n    closePopoverMenu,\n    handleTextSelection,\n    onDisableCancel,\n    onDisableConfirm,\n    onDisablePopoverMenu,\n    popoverState,\n    showDisablePopoverOptions,\n  };\n};\n","import { css } from '@emotion/css';\nimport { debounce } from 'lodash';\nimport { Grammar } from 'prismjs';\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState, MouseEvent } from 'react';\nimport { Align, VariableSizeList } from 'react-window';\n\nimport {\n  AbsoluteTimeRange,\n  CoreApp,\n  DataFrame,\n  EventBus,\n  EventBusSrv,\n  GrafanaTheme2,\n  LogLevel,\n  LogRowModel,\n  LogsDedupStrategy,\n  LogsMetaItem,\n  LogsSortOrder,\n  store,\n  TimeRange,\n} from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { ConfirmModal, Icon, PopoverContent, useStyles2, useTheme2 } from '@grafana/ui';\nimport { PopoverMenu } from 'app/features/explore/Logs/PopoverMenu';\nimport { GetFieldLinksFn } from 'app/plugins/panel/logs/types';\n\nimport { InfiniteScroll } from './InfiniteScroll';\nimport { getGridTemplateColumns } from './LogLine';\nimport { LogLineDetails, LogLineDetailsMode } from './LogLineDetails';\nimport { GetRowContextQueryFn, LogLineMenuCustomItem } from './LogLineMenu';\nimport { LogListContextProvider, LogListState, useLogListContext } from './LogListContext';\nimport { LogListControls } from './LogListControls';\nimport { LOG_LIST_SEARCH_HEIGHT, LogListSearch } from './LogListSearch';\nimport { LogListSearchContextProvider, useLogListSearchContext } from './LogListSearchContext';\nimport { preProcessLogs, LogListModel } from './processing';\nimport { useKeyBindings } from './useKeyBindings';\nimport { usePopoverMenu } from './usePopoverMenu';\nimport { LogLineVirtualization, getLogLineSize, LogFieldDimension, ScrollToLogsEvent } from './virtualization';\n\nexport interface Props {\n  app: CoreApp;\n  containerElement: HTMLDivElement;\n  dedupStrategy: LogsDedupStrategy;\n  detailsMode?: LogLineDetailsMode;\n  displayedFields: string[];\n  enableLogDetails: boolean;\n  eventBus?: EventBus;\n  filterLevels?: LogLevel[];\n  fontSize?: LogListFontSize;\n  getFieldLinks?: GetFieldLinksFn;\n  getRowContextQuery?: GetRowContextQueryFn;\n  grammar?: Grammar;\n  initialScrollPosition?: 'top' | 'bottom';\n  isLabelFilterActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n  loading?: boolean;\n  loadMore?: (range: AbsoluteTimeRange) => void;\n  logLineMenuCustomItems?: LogLineMenuCustomItem[];\n  logOptionsStorageKey?: string;\n  logs: LogRowModel[];\n  logsMeta?: LogsMetaItem[];\n  logSupportsContext?: (row: LogRowModel) => boolean;\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterString?: (value: string, refId?: string) => void;\n  onClickFilterOutString?: (value: string, refId?: string) => void;\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  onLogOptionsChange?: (option: keyof LogListControlOptions, value: string | boolean | string[]) => void;\n  onLogLineHover?: (row?: LogRowModel) => void;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  onPinLine?: (row: LogRowModel) => void;\n  onOpenContext?: (row: LogRowModel, onClose: () => void) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  permalinkedLogId?: string;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  pinnedLogs?: string[];\n  setDisplayedFields?: (displayedFields: string[]) => void;\n  showControls: boolean;\n  showTime: boolean;\n  sortOrder: LogsSortOrder;\n  timeRange: TimeRange;\n  timeZone: string;\n  syntaxHighlighting?: boolean;\n  wrapLogMessage: boolean;\n}\n\nexport type LogListFontSize = 'default' | 'small';\n\nexport type LogListControlOptions = LogListState;\n\ntype LogListComponentProps = Omit<\n  Props,\n  | 'app'\n  | 'dedupStrategy'\n  | 'displayedFields'\n  | 'enableLogDetails'\n  | 'logOptionsStorageKey'\n  | 'permalinkedLogId'\n  | 'showTime'\n  | 'sortOrder'\n  | 'syntaxHighlighting'\n  | 'wrapLogMessage'\n>;\n\nexport const LogList = ({\n  app,\n  displayedFields,\n  containerElement,\n  logOptionsStorageKey,\n  detailsMode = logOptionsStorageKey ? (store.get(`${logOptionsStorageKey}.detailsMode`) ?? 'sidebar') : 'sidebar',\n  dedupStrategy,\n  enableLogDetails,\n  eventBus,\n  filterLevels,\n  fontSize = logOptionsStorageKey ? (store.get(`${logOptionsStorageKey}.fontSize`) ?? 'default') : 'default',\n  getFieldLinks,\n  getRowContextQuery,\n  grammar,\n  initialScrollPosition = 'top',\n  isLabelFilterActive,\n  loading,\n  loadMore,\n  logLineMenuCustomItems,\n  logs,\n  logsMeta,\n  logSupportsContext,\n  onClickFilterLabel,\n  onClickFilterOutLabel,\n  onClickFilterString,\n  onClickFilterOutString,\n  onClickShowField,\n  onClickHideField,\n  onLogOptionsChange,\n  onLogLineHover,\n  onPermalinkClick,\n  onPinLine,\n  onOpenContext,\n  onUnpinLine,\n  permalinkedLogId,\n  pinLineButtonTooltipTitle,\n  pinnedLogs,\n  setDisplayedFields,\n  showControls,\n  showTime,\n  sortOrder,\n  syntaxHighlighting = logOptionsStorageKey ? store.getBool(`${logOptionsStorageKey}.syntaxHighlighting`, true) : true,\n  timeRange,\n  timeZone,\n  wrapLogMessage,\n}: Props) => {\n  const hasUnescapedContent = useMemo(() => logs.some((log) => log.hasUnescapedContent), [logs]);\n  return (\n    <LogListContextProvider\n      app={app}\n      containerElement={containerElement}\n      dedupStrategy={dedupStrategy}\n      detailsMode={detailsMode}\n      displayedFields={displayedFields}\n      enableLogDetails={enableLogDetails}\n      filterLevels={filterLevels}\n      fontSize={fontSize}\n      getRowContextQuery={getRowContextQuery}\n      hasUnescapedContent={hasUnescapedContent}\n      isLabelFilterActive={isLabelFilterActive}\n      logs={logs}\n      logsMeta={logsMeta}\n      logLineMenuCustomItems={logLineMenuCustomItems}\n      logOptionsStorageKey={logOptionsStorageKey}\n      logSupportsContext={logSupportsContext}\n      onClickFilterLabel={onClickFilterLabel}\n      onClickFilterOutLabel={onClickFilterOutLabel}\n      onClickFilterString={onClickFilterString}\n      onClickFilterOutString={onClickFilterOutString}\n      onClickShowField={onClickShowField}\n      onClickHideField={onClickHideField}\n      onLogOptionsChange={onLogOptionsChange}\n      onLogLineHover={onLogLineHover}\n      onPermalinkClick={onPermalinkClick}\n      onPinLine={onPinLine}\n      onOpenContext={onOpenContext}\n      onUnpinLine={onUnpinLine}\n      permalinkedLogId={permalinkedLogId}\n      pinLineButtonTooltipTitle={pinLineButtonTooltipTitle}\n      pinnedLogs={pinnedLogs}\n      setDisplayedFields={setDisplayedFields}\n      showControls={showControls}\n      showTime={showTime}\n      sortOrder={sortOrder}\n      syntaxHighlighting={syntaxHighlighting}\n      wrapLogMessage={wrapLogMessage}\n    >\n      <LogListSearchContextProvider>\n        <LogListComponent\n          containerElement={containerElement}\n          eventBus={eventBus}\n          getFieldLinks={getFieldLinks}\n          grammar={grammar}\n          initialScrollPosition={initialScrollPosition}\n          loading={loading}\n          loadMore={loadMore}\n          logs={logs}\n          showControls={showControls}\n          timeRange={timeRange}\n          timeZone={timeZone}\n        />\n      </LogListSearchContextProvider>\n    </LogListContextProvider>\n  );\n};\n\nconst LogListComponent = ({\n  containerElement,\n  eventBus = new EventBusSrv(),\n  getFieldLinks,\n  grammar,\n  initialScrollPosition = 'top',\n  loading,\n  loadMore,\n  logs,\n  showControls,\n  timeRange,\n  timeZone,\n}: LogListComponentProps) => {\n  const {\n    app,\n    displayedFields,\n    dedupStrategy,\n    detailsMode,\n    filterLevels,\n    fontSize,\n    forceEscape,\n    hasLogsWithErrors,\n    hasSampledLogs,\n    onClickFilterString,\n    onClickFilterOutString,\n    permalinkedLogId,\n    showDetails,\n    showTime,\n    sortOrder,\n    toggleDetails,\n    wrapLogMessage,\n  } = useLogListContext();\n  const [processedLogs, setProcessedLogs] = useState<LogListModel[]>([]);\n  const [listHeight, setListHeight] = useState(\n    app === CoreApp.Explore\n      ? Math.max(window.innerHeight * 0.8, containerElement.clientHeight)\n      : containerElement.clientHeight\n  );\n  const theme = useTheme2();\n  const listRef = useRef<VariableSizeList | null>(null);\n  const widthRef = useRef(containerElement.clientWidth);\n  const wrapperRef = useRef<HTMLDivElement | null>(null);\n  const scrollRef = useRef<HTMLDivElement | null>(null);\n  const virtualization = useMemo(() => new LogLineVirtualization(theme, fontSize), [theme, fontSize]);\n  const dimensions = useMemo(\n    () => (wrapLogMessage ? [] : virtualization.calculateFieldDimensions(processedLogs, displayedFields)),\n    [displayedFields, processedLogs, virtualization, wrapLogMessage]\n  );\n  const styles = useStyles2(getStyles, dimensions, displayedFields, { showTime });\n  const widthContainer = wrapperRef.current ?? containerElement;\n  const {\n    closePopoverMenu,\n    handleTextSelection,\n    onDisableCancel,\n    onDisableConfirm,\n    onDisablePopoverMenu,\n    popoverState,\n    showDisablePopoverOptions,\n  } = usePopoverMenu(wrapperRef.current);\n  useKeyBindings();\n  const { filterLogs, matchingUids, searchVisible } = useLogListSearchContext();\n\n  const debouncedResetAfterIndex = useMemo(() => {\n    return debounce((index: number) => {\n      listRef.current?.resetAfterIndex(index);\n      overflowIndexRef.current = Infinity;\n    }, 25);\n  }, []);\n\n  const debouncedScrollToItem = useMemo(() => {\n    return debounce((index: number, align?: Align) => {\n      listRef.current?.scrollToItem(index, align);\n    }, 250);\n  }, []);\n\n  useEffect(() => {\n    const subscription = eventBus.subscribe(ScrollToLogsEvent, (e: ScrollToLogsEvent) =>\n      handleScrollToEvent(e, logs.length, listRef.current)\n    );\n    return () => subscription.unsubscribe();\n  }, [eventBus, logs.length]);\n\n  useEffect(() => {\n    if (loading) {\n      return;\n    }\n    setProcessedLogs(\n      preProcessLogs(\n        logs,\n        { getFieldLinks, escape: forceEscape ?? false, order: sortOrder, timeZone, virtualization, wrapLogMessage },\n        grammar\n      )\n    );\n    virtualization.resetLogLineSizes();\n    listRef.current?.resetAfterIndex(0);\n  }, [forceEscape, getFieldLinks, grammar, loading, logs, sortOrder, timeZone, virtualization, wrapLogMessage]);\n\n  useEffect(() => {\n    listRef.current?.resetAfterIndex(0);\n  }, [wrapLogMessage, showDetails, displayedFields, dedupStrategy]);\n\n  useEffect(() => {\n    const handleResize = debounce(() => {\n      setListHeight(\n        (app === CoreApp.Explore\n          ? Math.max(window.innerHeight * 0.8, containerElement.clientHeight)\n          : containerElement.clientHeight) - (searchVisible ? LOG_LIST_SEARCH_HEIGHT : 0)\n      );\n    }, 50);\n    window.addEventListener('resize', handleResize);\n    handleResize();\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [app, containerElement.clientHeight, searchVisible]);\n\n  useLayoutEffect(() => {\n    if (widthRef.current === widthContainer.clientWidth) {\n      return;\n    }\n    widthRef.current = widthContainer.clientWidth;\n    debouncedResetAfterIndex(0);\n  });\n\n  const overflowIndexRef = useRef(Infinity);\n  const handleOverflow = useCallback(\n    (index: number, id: string, height?: number) => {\n      if (height !== undefined) {\n        virtualization.storeLogLineSize(id, widthContainer, height);\n      }\n      if (index === overflowIndexRef.current) {\n        return;\n      }\n      overflowIndexRef.current = index < overflowIndexRef.current ? index : overflowIndexRef.current;\n      debouncedResetAfterIndex(overflowIndexRef.current);\n    },\n    [debouncedResetAfterIndex, virtualization, widthContainer]\n  );\n\n  const handleScrollPosition = useCallback(() => {\n    if (permalinkedLogId) {\n      const index = processedLogs.findIndex((log) => log.uid === permalinkedLogId);\n      if (index >= 0) {\n        listRef.current?.scrollToItem(index, 'start');\n        return;\n      }\n    }\n    listRef.current?.scrollToItem(initialScrollPosition === 'top' ? 0 : processedLogs.length - 1);\n  }, [initialScrollPosition, permalinkedLogId, processedLogs]);\n\n  if (!containerElement || listHeight == null) {\n    // Wait for container to be rendered\n    return null;\n  }\n\n  const handleLogLineClick = useCallback(\n    (e: MouseEvent<HTMLElement>, log: LogListModel) => {\n      if (handleTextSelection(e, log)) {\n        // Event handled by the parent.\n        return;\n      }\n      toggleDetails(log);\n    },\n    [handleTextSelection, toggleDetails]\n  );\n\n  const handleLogDetailsResize = useCallback(() => {\n    debouncedResetAfterIndex(0);\n  }, [debouncedResetAfterIndex]);\n\n  const levelFilteredLogs = useMemo(\n    () =>\n      filterLevels.length === 0 ? processedLogs : processedLogs.filter((log) => filterLevels.includes(log.logLevel)),\n    [filterLevels, processedLogs]\n  );\n\n  const filteredLogs = useMemo(\n    () =>\n      matchingUids && filterLogs\n        ? levelFilteredLogs.filter((log) => matchingUids.includes(log.uid))\n        : levelFilteredLogs,\n    [filterLogs, levelFilteredLogs, matchingUids]\n  );\n\n  const focusLogLine = useCallback(\n    (log: LogListModel) => {\n      const index = filteredLogs.indexOf(log);\n      if (index >= 0) {\n        debouncedScrollToItem(index, 'start');\n      }\n    },\n    [debouncedScrollToItem, filteredLogs]\n  );\n\n  return (\n    <div className={styles.logListContainer}>\n      <div className={styles.logListWrapper} ref={wrapperRef}>\n        {popoverState.selection && popoverState.selectedRow && (\n          <PopoverMenu\n            close={closePopoverMenu}\n            row={popoverState.selectedRow}\n            selection={popoverState.selection}\n            {...popoverState.popoverMenuCoordinates}\n            onClickFilterString={onClickFilterString}\n            onClickFilterOutString={onClickFilterOutString}\n            onDisable={onDisablePopoverMenu}\n          />\n        )}\n        {showDisablePopoverOptions && (\n          <ConfirmModal\n            isOpen\n            title={t('logs.log-rows.disable-popover.title', 'Disable menu')}\n            body={\n              <>\n                <Trans i18nKey=\"logs.log-rows.disable-popover.message\">\n                  You are about to disable the logs filter menu. To re-enable it, select text in a log line while\n                  holding the alt key.\n                </Trans>\n                <div className={styles.shortcut}>\n                  <Icon name=\"keyboard\" />\n                  <Trans i18nKey=\"logs.log-rows.disable-popover-message.shortcut\">alt+select to enable again</Trans>\n                </div>\n              </>\n            }\n            confirmText={t('logs.log-rows.disable-popover.confirm', 'Confirm')}\n            icon=\"exclamation-triangle\"\n            onConfirm={onDisableConfirm}\n            onDismiss={onDisableCancel}\n          />\n        )}\n        <LogListSearch logs={levelFilteredLogs} listRef={listRef.current} />\n        <InfiniteScroll\n          displayedFields={displayedFields}\n          handleOverflow={handleOverflow}\n          logs={filteredLogs}\n          loadMore={loadMore}\n          onClick={handleLogLineClick}\n          scrollElement={scrollRef.current}\n          showTime={showTime}\n          sortOrder={sortOrder}\n          timeRange={timeRange}\n          timeZone={timeZone}\n          setInitialScrollPosition={handleScrollPosition}\n          virtualization={virtualization}\n          wrapLogMessage={wrapLogMessage}\n        >\n          {({ getItemKey, itemCount, onItemsRendered, Renderer }) => (\n            <VariableSizeList\n              className={styles.logList}\n              height={listHeight}\n              itemCount={itemCount}\n              itemSize={getLogLineSize.bind(null, virtualization, filteredLogs, widthContainer, displayedFields, {\n                detailsMode,\n                hasLogsWithErrors,\n                hasSampledLogs,\n                showDuplicates: dedupStrategy !== LogsDedupStrategy.none,\n                showDetails,\n                showTime,\n                wrap: wrapLogMessage,\n              })}\n              itemKey={getItemKey}\n              layout=\"vertical\"\n              onItemsRendered={onItemsRendered}\n              outerRef={scrollRef}\n              overscanCount={5}\n              ref={listRef}\n              style={{ overflowY: 'scroll' }}\n              width=\"100%\"\n            >\n              {Renderer}\n            </VariableSizeList>\n          )}\n        </InfiniteScroll>\n      </div>\n      {detailsMode === 'sidebar' && showDetails.length > 0 && (\n        <LogLineDetails\n          containerElement={containerElement}\n          focusLogLine={focusLogLine}\n          logs={filteredLogs}\n          onResize={handleLogDetailsResize}\n        />\n      )}\n      {showControls && <LogListControls eventBus={eventBus} />}\n    </div>\n  );\n};\n\nfunction getStyles(\n  theme: GrafanaTheme2,\n  dimensions: LogFieldDimension[],\n  displayedFields: string[],\n  { showTime }: { showTime: boolean }\n) {\n  const columns = showTime ? dimensions : dimensions.filter((_, index) => index > 0);\n  return {\n    logList: css({\n      '& .unwrapped-log-line': {\n        display: 'grid',\n        gridTemplateColumns: getGridTemplateColumns(columns, displayedFields),\n        '& .field': {\n          overflow: 'hidden',\n        },\n      },\n    }),\n    logListContainer: css({\n      display: 'flex',\n      // Minimum width to prevent rendering issues and a sausage-like logs panel.\n      minWidth: theme.spacing(35),\n    }),\n    logListWrapper: css({\n      position: 'relative',\n      width: '100%',\n    }),\n    shortcut: css({\n      display: 'inline-flex',\n      alignItems: 'center',\n      gap: theme.spacing(1),\n      color: theme.colors.text.secondary,\n      opacity: 0.7,\n      fontSize: theme.typography.bodySmall.fontSize,\n      marginTop: theme.spacing(1),\n    }),\n  };\n}\n\nfunction handleScrollToEvent(event: ScrollToLogsEvent, logsCount: number, list: VariableSizeList | null) {\n  if (event.payload.scrollTo === 'top') {\n    list?.scrollTo(0);\n  } else {\n    list?.scrollToItem(logsCount - 1);\n  }\n}\n","import { debounce } from 'lodash';\nimport {\n  createContext,\n  Dispatch,\n  ReactNode,\n  SetStateAction,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\n\nimport {\n  CoreApp,\n  DataFrame,\n  LogLevel,\n  LogRowModel,\n  LogsDedupStrategy,\n  LogsMetaItem,\n  LogsSortOrder,\n  shallowCompare,\n  store,\n} from '@grafana/data';\nimport { PopoverContent } from '@grafana/ui';\n\nimport { DownloadFormat, checkLogsError, checkLogsSampled, downloadLogs as download } from '../../utils';\n\nimport { LogLineDetailsMode } from './LogLineDetails';\nimport { GetRowContextQueryFn, LogLineMenuCustomItem } from './LogLineMenu';\nimport { LogListFontSize } from './LogList';\nimport { LogListModel } from './processing';\nimport { LOG_LIST_MIN_WIDTH } from './virtualization';\n\nexport interface LogListContextData extends Omit<Props, 'containerElement' | 'logs' | 'logsMeta' | 'showControls'> {\n  closeDetails: () => void;\n  detailsDisplayed: (log: LogListModel) => boolean;\n  detailsMode: LogLineDetailsMode;\n  detailsWidth: number;\n  downloadLogs: (format: DownloadFormat) => void;\n  enableLogDetails: boolean;\n  filterLevels: LogLevel[];\n  hasLogsWithErrors?: boolean;\n  hasSampledLogs?: boolean;\n  hasUnescapedContent?: boolean;\n  logLineMenuCustomItems?: LogLineMenuCustomItem[];\n  setDedupStrategy: (dedupStrategy: LogsDedupStrategy) => void;\n  setDetailsMode: (mode: LogLineDetailsMode) => void;\n  setDetailsWidth: (width: number) => void;\n  setFilterLevels: (filterLevels: LogLevel[]) => void;\n  setFontSize: (size: LogListFontSize) => void;\n  setForceEscape: (forceEscape: boolean) => void;\n  setLogListState: Dispatch<SetStateAction<LogListState>>;\n  setPinnedLogs: (pinnedlogs: string[]) => void;\n  setPrettifyJSON: (prettifyJSON: boolean) => void;\n  setSyntaxHighlighting: (syntaxHighlighting: boolean) => void;\n  setShowTime: (showTime: boolean) => void;\n  setShowUniqueLabels: (showUniqueLabels: boolean) => void;\n  setSortOrder: (sortOrder: LogsSortOrder) => void;\n  setWrapLogMessage: (showTime: boolean) => void;\n  showDetails: LogListModel[];\n  toggleDetails: (log: LogListModel) => void;\n}\n\nexport const LogListContext = createContext<LogListContextData>({\n  app: CoreApp.Unknown,\n  closeDetails: () => {},\n  dedupStrategy: LogsDedupStrategy.none,\n  detailsDisplayed: () => false,\n  detailsMode: 'sidebar',\n  detailsWidth: 0,\n  displayedFields: [],\n  downloadLogs: () => {},\n  enableLogDetails: false,\n  filterLevels: [],\n  fontSize: 'default',\n  hasUnescapedContent: false,\n  setDedupStrategy: () => {},\n  setDetailsMode: () => {},\n  setDetailsWidth: () => {},\n  setFilterLevels: () => {},\n  setFontSize: () => {},\n  setForceEscape: () => {},\n  setLogListState: () => {},\n  setPinnedLogs: () => {},\n  setPrettifyJSON: () => {},\n  setShowTime: () => {},\n  setShowUniqueLabels: () => {},\n  setSortOrder: () => {},\n  setSyntaxHighlighting: () => {},\n  setWrapLogMessage: () => {},\n  showDetails: [],\n  showTime: true,\n  sortOrder: LogsSortOrder.Ascending,\n  syntaxHighlighting: true,\n  toggleDetails: () => {},\n  wrapLogMessage: false,\n});\n\nexport const useLogListContextData = (key: keyof LogListContextData) => {\n  const data: LogListContextData = useContext(LogListContext);\n  return data[key];\n};\n\nexport const useLogListContext = (): LogListContextData => {\n  return useContext(LogListContext);\n};\n\nexport const useLogIsPinned = (log: LogListModel) => {\n  const { pinnedLogs } = useContext(LogListContext);\n  return pinnedLogs?.some((logId) => logId === log.rowId);\n};\n\nexport const useLogIsPermalinked = (log: LogListModel) => {\n  const { permalinkedLogId } = useContext(LogListContext);\n  return permalinkedLogId && permalinkedLogId === log.uid;\n};\n\nexport type LogListState = Pick<\n  LogListContextData,\n  | 'dedupStrategy'\n  | 'fontSize'\n  | 'forceEscape'\n  | 'filterLevels'\n  | 'hasUnescapedContent'\n  | 'pinnedLogs'\n  | 'prettifyJSON'\n  | 'showUniqueLabels'\n  | 'showTime'\n  | 'sortOrder'\n  | 'syntaxHighlighting'\n  | 'wrapLogMessage'\n>;\n\nexport interface Props {\n  app: CoreApp;\n  children?: ReactNode;\n  // Only ControlledLogRows can send an undefined containerElement. See LogList.tsx\n  containerElement?: HTMLDivElement;\n  detailsMode?: LogLineDetailsMode;\n  dedupStrategy: LogsDedupStrategy;\n  displayedFields: string[];\n  enableLogDetails: boolean;\n  filterLevels?: LogLevel[];\n  fontSize: LogListFontSize;\n  forceEscape?: boolean;\n  hasUnescapedContent?: boolean;\n  getRowContextQuery?: GetRowContextQueryFn;\n  isLabelFilterActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n  logs: LogRowModel[];\n  logLineMenuCustomItems?: LogLineMenuCustomItem[];\n  logsMeta?: LogsMetaItem[];\n  logOptionsStorageKey?: string;\n  logSupportsContext?: (row: LogRowModel) => boolean;\n  onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n  onClickFilterString?: (value: string, refId?: string) => void;\n  onClickFilterOutString?: (value: string, refId?: string) => void;\n  onClickShowField?: (key: string) => void;\n  onClickHideField?: (key: string) => void;\n  onLogOptionsChange?: (option: keyof LogListState, value: string | boolean | string[]) => void;\n  onLogLineHover?: (row?: LogRowModel) => void;\n  onPermalinkClick?: (row: LogRowModel) => Promise<void>;\n  onPinLine?: (row: LogRowModel) => void;\n  onOpenContext?: (row: LogRowModel, onClose: () => void) => void;\n  onUnpinLine?: (row: LogRowModel) => void;\n  permalinkedLogId?: string;\n  pinLineButtonTooltipTitle?: PopoverContent;\n  pinnedLogs?: string[];\n  prettifyJSON?: boolean;\n  setDisplayedFields?: (displayedFields: string[]) => void;\n  showControls: boolean;\n  showUniqueLabels?: boolean;\n  showTime: boolean;\n  sortOrder: LogsSortOrder;\n  syntaxHighlighting?: boolean;\n  wrapLogMessage: boolean;\n}\n\nexport const LogListContextProvider = ({\n  app,\n  children,\n  containerElement,\n  enableLogDetails,\n  detailsMode: detailsModeProp,\n  dedupStrategy,\n  displayedFields,\n  filterLevels,\n  fontSize,\n  forceEscape = false,\n  hasUnescapedContent,\n  isLabelFilterActive,\n  getRowContextQuery,\n  logs,\n  logLineMenuCustomItems,\n  logsMeta,\n  logOptionsStorageKey,\n  logSupportsContext,\n  onClickFilterLabel,\n  onClickFilterOutLabel,\n  onClickFilterString,\n  onClickFilterOutString,\n  onClickShowField,\n  onClickHideField,\n  onLogOptionsChange,\n  onLogLineHover,\n  onPermalinkClick,\n  onPinLine,\n  onOpenContext,\n  onUnpinLine,\n  permalinkedLogId,\n  pinLineButtonTooltipTitle,\n  pinnedLogs,\n  prettifyJSON,\n  setDisplayedFields,\n  showControls,\n  showTime,\n  showUniqueLabels,\n  sortOrder,\n  syntaxHighlighting,\n  wrapLogMessage,\n}: Props) => {\n  const [logListState, setLogListState] = useState<LogListState>({\n    dedupStrategy,\n    filterLevels:\n      filterLevels ?? (logOptionsStorageKey ? store.getObject(`${logOptionsStorageKey}.filterLevels`, []) : []),\n    fontSize,\n    forceEscape,\n    hasUnescapedContent,\n    pinnedLogs,\n    prettifyJSON,\n    showTime,\n    showUniqueLabels,\n    sortOrder,\n    syntaxHighlighting,\n    wrapLogMessage,\n  });\n  const [showDetails, setShowDetails] = useState<LogListModel[]>([]);\n  const [detailsWidth, setDetailsWidthState] = useState(getDetailsWidth(containerElement, logOptionsStorageKey));\n  const [detailsMode, setDetailsMode] = useState<LogLineDetailsMode>(detailsModeProp ?? 'sidebar');\n\n  useEffect(() => {\n    // Props are updated in the context only of the panel is being externally controlled.\n    if (showControls && app !== CoreApp.PanelEditor) {\n      return;\n    }\n    const newState = {\n      ...logListState,\n      dedupStrategy,\n      showTime,\n      sortOrder,\n      syntaxHighlighting,\n      wrapLogMessage,\n    };\n    if (!shallowCompare(logListState, newState)) {\n      setLogListState(newState);\n    }\n  }, [\n    app,\n    dedupStrategy,\n    logListState,\n    pinnedLogs,\n    showControls,\n    showTime,\n    sortOrder,\n    syntaxHighlighting,\n    wrapLogMessage,\n  ]);\n\n  useEffect(() => {\n    if (filterLevels === undefined) {\n      return;\n    }\n    setLogListState((logListState) => {\n      if (!shallowCompare(logListState.filterLevels, filterLevels)) {\n        return { ...logListState, filterLevels };\n      }\n      return logListState;\n    });\n  }, [filterLevels]);\n\n  useEffect(() => {\n    setLogListState((logListState) => ({ ...logListState, fontSize }));\n  }, [fontSize]);\n\n  useEffect(() => {\n    if (logListState.hasUnescapedContent !== hasUnescapedContent) {\n      setLogListState({ ...logListState, hasUnescapedContent });\n    }\n  }, [hasUnescapedContent, logListState]);\n\n  useEffect(() => {\n    if (!shallowCompare(logListState.pinnedLogs ?? [], pinnedLogs ?? [])) {\n      setLogListState({ ...logListState, pinnedLogs });\n    }\n  }, [logListState, pinnedLogs]);\n\n  useEffect(() => {\n    if (!showDetails.length) {\n      return;\n    }\n    const newShowDetails = showDetails.filter(\n      (expandedLog) => logs.findIndex((log) => log.uid === expandedLog.uid) >= 0\n    );\n    if (newShowDetails.length !== showDetails.length) {\n      setShowDetails(newShowDetails);\n    }\n  }, [logs, showDetails]);\n\n  useEffect(() => {\n    const handleResize = debounce(() => {\n      setDetailsWidthState((detailsWidth) => getDetailsWidth(containerElement, logOptionsStorageKey, detailsWidth));\n    }, 50);\n    handleResize();\n    window.addEventListener('resize', handleResize);\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [containerElement, logOptionsStorageKey]);\n\n  const detailsDisplayed = useCallback(\n    (log: LogListModel) => !!showDetails.find((shownLog) => shownLog.uid === log.uid),\n    [showDetails]\n  );\n\n  const setDedupStrategy = useCallback(\n    (dedupStrategy: LogsDedupStrategy) => {\n      setLogListState({ ...logListState, dedupStrategy });\n      onLogOptionsChange?.('dedupStrategy', dedupStrategy);\n    },\n    [logListState, onLogOptionsChange]\n  );\n\n  const setFontSize = useCallback(\n    (fontSize: LogListFontSize) => {\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.fontSize`, fontSize);\n      }\n      setLogListState((logListState) => ({ ...logListState, fontSize }));\n    },\n    [logOptionsStorageKey]\n  );\n\n  const setForceEscape = useCallback(\n    (forceEscape: boolean) => {\n      setLogListState({ ...logListState, forceEscape });\n    },\n    [logListState]\n  );\n\n  const setFilterLevels = useCallback(\n    (filterLevels: LogLevel[]) => {\n      setLogListState({ ...logListState, filterLevels });\n      onLogOptionsChange?.('filterLevels', filterLevels);\n    },\n    [logListState, onLogOptionsChange]\n  );\n\n  const setPinnedLogs = useCallback(\n    (pinnedLogs: string[]) => {\n      setLogListState({ ...logListState, pinnedLogs });\n      onLogOptionsChange?.('pinnedLogs', pinnedLogs);\n    },\n    [logListState, onLogOptionsChange]\n  );\n\n  const setShowTime = useCallback(\n    (showTime: boolean) => {\n      setLogListState({ ...logListState, showTime });\n      onLogOptionsChange?.('showTime', showTime);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.showTime`, showTime);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const setShowUniqueLabels = useCallback(\n    (showUniqueLabels: boolean) => {\n      setLogListState({ ...logListState, showUniqueLabels });\n      onLogOptionsChange?.('showUniqueLabels', showUniqueLabels);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.showLabels`, showUniqueLabels);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const setPrettifyJSON = useCallback(\n    (prettifyJSON: boolean) => {\n      setLogListState({ ...logListState, prettifyJSON });\n      onLogOptionsChange?.('prettifyJSON', prettifyJSON);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.prettifyLogMessage`, prettifyJSON);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const setSyntaxHighlighting = useCallback(\n    (syntaxHighlighting: boolean) => {\n      setLogListState({ ...logListState, syntaxHighlighting });\n      onLogOptionsChange?.('syntaxHighlighting', syntaxHighlighting);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.syntaxHighlighting`, syntaxHighlighting);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const setSortOrder = useCallback(\n    (sortOrder: LogsSortOrder) => {\n      setLogListState({ ...logListState, sortOrder });\n      onLogOptionsChange?.('sortOrder', sortOrder);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.sortOrder`, sortOrder);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const setWrapLogMessage = useCallback(\n    (wrapLogMessage: boolean) => {\n      setLogListState({ ...logListState, wrapLogMessage });\n      onLogOptionsChange?.('wrapLogMessage', wrapLogMessage);\n      if (logOptionsStorageKey) {\n        store.set(`${logOptionsStorageKey}.wrapLogMessage`, wrapLogMessage);\n      }\n    },\n    [logListState, logOptionsStorageKey, onLogOptionsChange]\n  );\n\n  const downloadLogs = useCallback(\n    (format: DownloadFormat) => {\n      const filteredLogs =\n        logListState.filterLevels.length === 0\n          ? logs\n          : logs.filter((log) => logListState.filterLevels.includes(log.logLevel));\n      download(format, filteredLogs, logsMeta);\n    },\n    [logListState.filterLevels, logs, logsMeta]\n  );\n\n  const closeDetails = useCallback(() => {\n    setShowDetails([]);\n  }, []);\n\n  const toggleDetails = useCallback(\n    (log: LogListModel) => {\n      if (!enableLogDetails) {\n        return;\n      }\n      const found = showDetails.findIndex((stateLog) => stateLog === log || stateLog.uid === log.uid);\n      if (found >= 0) {\n        setShowDetails(showDetails.filter((stateLog) => stateLog !== log && stateLog.uid !== log.uid));\n      } else {\n        // Supporting one displayed details for now\n        setShowDetails([log]);\n      }\n    },\n    [enableLogDetails, showDetails]\n  );\n\n  const setDetailsWidth = useCallback(\n    (width: number) => {\n      if (!logOptionsStorageKey || !containerElement) {\n        return;\n      }\n\n      const maxWidth = containerElement.clientWidth - LOG_LIST_MIN_WIDTH;\n      if (width > maxWidth) {\n        return;\n      }\n\n      store.set(`${logOptionsStorageKey}.detailsWidth`, width);\n      setDetailsWidthState(width);\n    },\n    [containerElement, logOptionsStorageKey]\n  );\n\n  const hasLogsWithErrors = useMemo(() => logs.some((log) => !!checkLogsError(log)), [logs]);\n  const hasSampledLogs = useMemo(() => logs.some((log) => !!checkLogsSampled(log)), [logs]);\n\n  return (\n    <LogListContext.Provider\n      value={{\n        app,\n        closeDetails,\n        detailsDisplayed,\n        dedupStrategy: logListState.dedupStrategy,\n        detailsMode,\n        detailsWidth,\n        displayedFields,\n        downloadLogs,\n        enableLogDetails,\n        filterLevels: logListState.filterLevels,\n        fontSize: logListState.fontSize,\n        forceEscape: logListState.forceEscape,\n        hasLogsWithErrors,\n        hasSampledLogs,\n        hasUnescapedContent: logListState.hasUnescapedContent,\n        isLabelFilterActive,\n        getRowContextQuery,\n        logSupportsContext,\n        logLineMenuCustomItems,\n        logOptionsStorageKey,\n        onClickFilterLabel,\n        onClickFilterOutLabel,\n        onClickFilterString,\n        onClickFilterOutString,\n        onClickShowField,\n        onClickHideField,\n        onLogLineHover,\n        onPermalinkClick,\n        onPinLine,\n        onOpenContext,\n        onUnpinLine,\n        permalinkedLogId,\n        pinLineButtonTooltipTitle,\n        pinnedLogs: logListState.pinnedLogs,\n        prettifyJSON: logListState.prettifyJSON,\n        setDedupStrategy,\n        setDetailsMode,\n        setDetailsWidth,\n        setDisplayedFields,\n        setFilterLevels,\n        setFontSize,\n        setForceEscape,\n        setLogListState,\n        setPinnedLogs,\n        setPrettifyJSON,\n        setShowTime,\n        setShowUniqueLabels,\n        setSortOrder,\n        setSyntaxHighlighting,\n        setWrapLogMessage,\n        showDetails,\n        showTime: logListState.showTime,\n        showUniqueLabels: logListState.showUniqueLabels,\n        sortOrder: logListState.sortOrder,\n        syntaxHighlighting: logListState.syntaxHighlighting,\n        toggleDetails,\n        wrapLogMessage: logListState.wrapLogMessage,\n      }}\n    >\n      {children}\n    </LogListContext.Provider>\n  );\n};\n\nexport function isLogsSortOrder(value: unknown): value is LogsSortOrder {\n  return value === LogsSortOrder.Ascending || value === LogsSortOrder.Descending;\n}\n\nexport function isDedupStrategy(value: unknown): value is LogsDedupStrategy {\n  return (\n    value === LogsDedupStrategy.exact ||\n    value === LogsDedupStrategy.none ||\n    value === LogsDedupStrategy.numbers ||\n    value === LogsDedupStrategy.signature\n  );\n}\n\n// Only ControlledLogRows can send an undefined containerElement. See LogList.tsx\nfunction getDetailsWidth(\n  containerElement: HTMLDivElement | undefined,\n  logOptionsStorageKey?: string,\n  currentWidth?: number\n) {\n  if (!containerElement) {\n    return 0;\n  }\n  const defaultWidth = containerElement.clientWidth * 0.4;\n  const detailsWidth =\n    currentWidth ||\n    (logOptionsStorageKey\n      ? parseInt(store.get(`${logOptionsStorageKey}.detailsWidth`) ?? defaultWidth, 10)\n      : defaultWidth);\n\n  const maxWidth = containerElement.clientWidth - LOG_LIST_MIN_WIDTH;\n\n  // The user might have resized the screen.\n  if (detailsWidth >= containerElement.clientWidth || detailsWidth > maxWidth) {\n    return currentWidth ?? defaultWidth;\n  }\n  return detailsWidth;\n}\n","import { css } from '@emotion/css';\nimport { capitalize } from 'lodash';\nimport { MouseEvent, useCallback, useMemo } from 'react';\n\nimport { CoreApp, EventBus, LogLevel, LogsDedupDescription, LogsDedupStrategy, LogsSortOrder } from '@grafana/data';\nimport { GrafanaTheme2 } from '@grafana/data/';\nimport { t } from '@grafana/i18n';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { Dropdown, IconButton, Menu, useStyles2 } from '@grafana/ui';\n\nimport { LogsVisualisationType } from '../../../explore/Logs/Logs';\nimport { DownloadFormat } from '../../utils';\n\nimport { useLogListContext } from './LogListContext';\nimport { useLogListSearchContext } from './LogListSearchContext';\nimport { ScrollToLogsEvent } from './virtualization';\n\ntype Props = {\n  eventBus: EventBus;\n  visualisationType?: LogsVisualisationType;\n};\n\nconst DEDUP_OPTIONS = [\n  LogsDedupStrategy.none,\n  LogsDedupStrategy.exact,\n  LogsDedupStrategy.numbers,\n  LogsDedupStrategy.signature,\n];\n\nconst FILTER_LEVELS: LogLevel[] = [\n  LogLevel.info,\n  LogLevel.debug,\n  LogLevel.trace,\n  LogLevel.warning,\n  LogLevel.error,\n  LogLevel.critical,\n  LogLevel.unknown,\n];\n\nexport const LogListControls = ({ eventBus, visualisationType = 'logs' }: Props) => {\n  const styles = useStyles2(getStyles);\n  const {\n    app,\n    dedupStrategy,\n    downloadLogs,\n    filterLevels,\n    fontSize,\n    forceEscape,\n    hasUnescapedContent,\n    prettifyJSON,\n    setDedupStrategy,\n    setFilterLevels,\n    setFontSize,\n    setForceEscape,\n    setPrettifyJSON,\n    setShowTime,\n    setShowUniqueLabels,\n    setSortOrder,\n    setSyntaxHighlighting,\n    setWrapLogMessage,\n    showTime,\n    showUniqueLabels,\n    sortOrder,\n    syntaxHighlighting,\n    wrapLogMessage,\n  } = useLogListContext();\n  const { hideSearch, searchVisible, showSearch } = useLogListSearchContext();\n\n  const onScrollToTopClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_scroll_top_clicked');\n    eventBus.publish(\n      new ScrollToLogsEvent({\n        scrollTo: 'top',\n      })\n    );\n  }, [eventBus]);\n\n  const onScrollToBottomClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_scroll_bottom_clicked');\n    eventBus.publish(\n      new ScrollToLogsEvent({\n        scrollTo: 'bottom',\n      })\n    );\n  }, [eventBus]);\n\n  const onForceEscapeClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_force_escape_clicked');\n    setForceEscape(!forceEscape);\n  }, [forceEscape, setForceEscape]);\n\n  const onFilterLevelClick = useCallback(\n    (level?: LogLevel) => {\n      reportInteraction('logs_log_list_controls_level_clicked');\n      if (level === undefined) {\n        setFilterLevels([]);\n      } else if (!filterLevels.includes(level)) {\n        setFilterLevels([...filterLevels, level]);\n      } else {\n        setFilterLevels(filterLevels.filter((filterLevel) => filterLevel !== level));\n      }\n    },\n    [filterLevels, setFilterLevels]\n  );\n\n  const onFontSizeClick = useCallback(() => {\n    const newSize = fontSize === 'default' ? 'small' : 'default';\n    reportInteraction('logs_log_list_controls_font_size_clicked', {\n      size: newSize,\n    });\n    setFontSize(newSize);\n  }, [fontSize, setFontSize]);\n\n  const onShowTimestampsClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_show_time_clicked', {\n      show_time: !showTime,\n    });\n    setShowTime(!showTime);\n  }, [setShowTime, showTime]);\n\n  const onShowUniqueLabelsClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_show_unique_labels_clicked', {\n      show_unique_labels: showUniqueLabels,\n    });\n    setShowUniqueLabels(!showUniqueLabels);\n  }, [setShowUniqueLabels, showUniqueLabels]);\n\n  const onSortOrderClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_sort_order_clicked', {\n      order: sortOrder === LogsSortOrder.Ascending ? LogsSortOrder.Descending : LogsSortOrder.Ascending,\n    });\n    setSortOrder(sortOrder === LogsSortOrder.Ascending ? LogsSortOrder.Descending : LogsSortOrder.Ascending);\n  }, [setSortOrder, sortOrder]);\n\n  const onSetPrettifyJSONClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_prettify_json_clicked', {\n      state: !prettifyJSON,\n    });\n    setPrettifyJSON(!prettifyJSON);\n  }, [prettifyJSON, setPrettifyJSON]);\n\n  const onSyntaxHightlightingClick = useCallback(() => {\n    reportInteraction('logs_log_list_controls_syntax_clicked', {\n      state: !syntaxHighlighting,\n    });\n    setSyntaxHighlighting(!syntaxHighlighting);\n  }, [setSyntaxHighlighting, syntaxHighlighting]);\n\n  const onWrapLogMessageClick = useCallback(\n    (e: MouseEvent) => {\n      e.preventDefault();\n      reportInteraction('logs_log_list_controls_wrap_clicked', {\n        state: !wrapLogMessage,\n      });\n      setWrapLogMessage(!wrapLogMessage);\n    },\n    [setWrapLogMessage, wrapLogMessage]\n  );\n\n  const deduplicationMenu = useMemo(\n    () => (\n      <Menu>\n        {DEDUP_OPTIONS.map((option) => (\n          <Menu.Item\n            key={option}\n            className={dedupStrategy === option ? styles.menuItemActive : undefined}\n            description={LogsDedupDescription[option]}\n            label={capitalize(option)}\n            onClick={() => setDedupStrategy(option)}\n          />\n        ))}\n      </Menu>\n    ),\n    [dedupStrategy, setDedupStrategy, styles.menuItemActive]\n  );\n\n  const filterLevelsMenu = useMemo(\n    () => (\n      <Menu>\n        <Menu.Item\n          key={'all'}\n          className={filterLevels.length === 0 ? styles.menuItemActive : undefined}\n          label={t('logs.logs-controls.display-level-all', 'All levels')}\n          onClick={() => onFilterLevelClick()}\n        />\n        {FILTER_LEVELS.map((level) => (\n          <Menu.Item\n            key={level}\n            className={filterLevels.includes(level) ? styles.menuItemActive : undefined}\n            label={capitalize(level)}\n            onClick={() => onFilterLevelClick(level)}\n          />\n        ))}\n      </Menu>\n    ),\n    [filterLevels, onFilterLevelClick, styles.menuItemActive]\n  );\n\n  const downloadMenu = useMemo(\n    () => (\n      <Menu>\n        <Menu.Item\n          label={t('logs.logs-controls.download-logs.txt', 'txt')}\n          onClick={() => downloadLogs(DownloadFormat.Text)}\n        />\n        <Menu.Item\n          label={t('logs.logs-controls.download-logs.json', 'json')}\n          onClick={() => downloadLogs(DownloadFormat.Json)}\n        />\n        <Menu.Item\n          label={t('logs.logs-controls.download-logs.csv', 'csv')}\n          onClick={() => downloadLogs(DownloadFormat.CSV)}\n        />\n      </Menu>\n    ),\n    [downloadLogs]\n  );\n\n  const inDashboard = app === CoreApp.Dashboard || app === CoreApp.PanelEditor || app === CoreApp.PanelViewer;\n\n  return (\n    <div className={styles.navContainer}>\n      {visualisationType === 'logs' && (\n        <IconButton\n          name=\"arrow-down\"\n          className={styles.controlButton}\n          variant=\"secondary\"\n          onClick={onScrollToBottomClick}\n          tooltip={t('logs.logs-controls.scroll-bottom', 'Scroll to bottom')}\n          size=\"lg\"\n        />\n      )}\n      {!inDashboard ? (\n        <>\n          <IconButton\n            name={sortOrder === LogsSortOrder.Descending ? 'sort-amount-up' : 'sort-amount-down'}\n            className={styles.controlButton}\n            onClick={onSortOrderClick}\n            tooltip={\n              sortOrder === LogsSortOrder.Descending\n                ? t('logs.logs-controls.newest-first', 'Sorted by newest logs first - Click to show oldest first')\n                : t('logs.logs-controls.oldest-first', 'Sorted by oldest logs first - Click to show newest first')\n            }\n            size=\"lg\"\n          />\n          {visualisationType === 'logs' && (\n            <>\n              <div className={styles.divider} />\n              {config.featureToggles.newLogsPanel && (\n                <IconButton\n                  name={'search'}\n                  className={searchVisible ? styles.controlButtonActive : styles.controlButton}\n                  onClick={searchVisible ? hideSearch : showSearch}\n                  tooltip={\n                    searchVisible\n                      ? t('logs.logs-controls.hide-search', 'Close search')\n                      : t('logs.logs-controls.show-search', 'Search in logs result')\n                  }\n                  size=\"lg\"\n                />\n              )}\n              <Dropdown overlay={deduplicationMenu} placement=\"auto-end\">\n                <IconButton\n                  name={'filter'}\n                  className={\n                    dedupStrategy !== LogsDedupStrategy.none ? styles.controlButtonActive : styles.controlButton\n                  }\n                  tooltip={t('logs.logs-controls.deduplication', 'Deduplication')}\n                  size=\"lg\"\n                />\n              </Dropdown>\n              <Dropdown overlay={filterLevelsMenu} placement=\"auto-end\">\n                <IconButton\n                  name={'gf-logs'}\n                  className={\n                    filterLevels && filterLevels.length > 0 ? styles.controlButtonActive : styles.controlButton\n                  }\n                  tooltip={t('logs.logs-controls.display-level', 'Display levels')}\n                  size=\"lg\"\n                />\n              </Dropdown>\n              <div className={styles.divider} />\n              <IconButton\n                name=\"clock-nine\"\n                aria-pressed={showTime}\n                className={showTime ? styles.controlButtonActive : styles.controlButton}\n                onClick={onShowTimestampsClick}\n                tooltip={\n                  showTime\n                    ? t('logs.logs-controls.hide-timestamps', 'Hide timestamps')\n                    : t('logs.logs-controls.show-timestamps', 'Show timestamps')\n                }\n                size=\"lg\"\n              />\n              {/* When this is used in a Plugin context, app is unknown */}\n              {showUniqueLabels !== undefined && app !== CoreApp.Unknown && (\n                <IconButton\n                  name=\"tag-alt\"\n                  aria-pressed={showUniqueLabels}\n                  className={showUniqueLabels ? styles.controlButtonActive : styles.controlButton}\n                  onClick={onShowUniqueLabelsClick}\n                  tooltip={\n                    showUniqueLabels\n                      ? t('logs.logs-controls.hide-unique-labels', 'Hide unique labels')\n                      : t('logs.logs-controls.show-unique-labels', 'Show unique labels')\n                  }\n                  size=\"lg\"\n                />\n              )}\n              <IconButton\n                name=\"wrap-text\"\n                className={wrapLogMessage ? styles.controlButtonActive : styles.controlButton}\n                aria-pressed={wrapLogMessage}\n                onClick={onWrapLogMessageClick}\n                tooltip={\n                  wrapLogMessage\n                    ? t('logs.logs-controls.unwrap-lines', 'Unwrap lines')\n                    : t('logs.logs-controls.wrap-lines', 'Wrap lines')\n                }\n                size=\"lg\"\n              />\n              {prettifyJSON !== undefined && (\n                <IconButton\n                  name=\"brackets-curly\"\n                  aria-pressed={prettifyJSON}\n                  className={prettifyJSON ? styles.controlButtonActive : styles.controlButton}\n                  onClick={onSetPrettifyJSONClick}\n                  tooltip={\n                    prettifyJSON\n                      ? t('logs.logs-controls.disable-prettify-json', 'Collapse JSON logs')\n                      : t('logs.logs-controls.prettify-json', 'Expand JSON logs')\n                  }\n                  size=\"lg\"\n                />\n              )}\n              {syntaxHighlighting !== undefined && (\n                <IconButton\n                  name=\"brackets-curly\"\n                  className={syntaxHighlighting ? styles.controlButtonActive : styles.controlButton}\n                  aria-pressed={syntaxHighlighting}\n                  onClick={onSyntaxHightlightingClick}\n                  tooltip={\n                    syntaxHighlighting\n                      ? t('logs.logs-controls.disable-highlighting', 'Disable highlighting')\n                      : t('logs.logs-controls.enable-highlighting', 'Enable highlighting')\n                  }\n                  size=\"lg\"\n                />\n              )}\n              {config.featureToggles.newLogsPanel && (\n                <IconButton\n                  name=\"text-fields\"\n                  className={fontSize === 'small' ? styles.controlButtonActive : styles.controlButton}\n                  aria-pressed={Boolean(fontSize)}\n                  onClick={onFontSizeClick}\n                  tooltip={\n                    fontSize === 'default'\n                      ? t('logs.logs-controls.font-size-default', 'Use small font size')\n                      : t('logs.logs-controls.font-size-small', 'Use default font size')\n                  }\n                  size=\"lg\"\n                />\n              )}\n              {hasUnescapedContent && (\n                <IconButton\n                  name=\"enter\"\n                  aria-pressed={forceEscape}\n                  className={forceEscape ? styles.controlButtonActive : styles.controlButton}\n                  onClick={onForceEscapeClick}\n                  tooltip={\n                    forceEscape\n                      ? t('logs.logs-controls.remove-escaping', 'Remove escaping')\n                      : t(\n                          'logs.logs-controls.escape-newlines',\n                          'Fix incorrectly escaped newline and tab sequences in log lines'\n                        )\n                  }\n                  size=\"lg\"\n                />\n              )}\n            </>\n          )}\n          {!config.exploreHideLogsDownload && (\n            <>\n              <div className={styles.divider} />\n              <Dropdown overlay={downloadMenu} placement=\"auto-end\">\n                <IconButton\n                  name=\"download-alt\"\n                  className={styles.controlButton}\n                  tooltip={t('logs.logs-controls.download', 'Download logs')}\n                  size=\"lg\"\n                />\n              </Dropdown>\n            </>\n          )}\n        </>\n      ) : (\n        <>\n          {config.featureToggles.newLogsPanel && (\n            <IconButton\n              name={'search'}\n              className={searchVisible ? styles.controlButtonActive : styles.controlButton}\n              onClick={searchVisible ? hideSearch : showSearch}\n              tooltip={\n                searchVisible\n                  ? t('logs.logs-controls.hide-search', 'Close search')\n                  : t('logs.logs-controls.show-search', 'Search in logs result')\n              }\n              size=\"lg\"\n            />\n          )}\n          <Dropdown overlay={filterLevelsMenu} placement=\"auto-end\">\n            <IconButton\n              name={'gf-logs'}\n              className={filterLevels && filterLevels.length > 0 ? styles.controlButtonActive : styles.controlButton}\n              tooltip={t('logs.logs-controls.display-level', 'Display levels')}\n              size=\"lg\"\n            />\n          </Dropdown>\n        </>\n      )}\n      {visualisationType === 'logs' && (\n        <IconButton\n          name=\"arrow-up\"\n          data-testid=\"scrollToTop\"\n          className={styles.scrollToTopButton}\n          variant=\"secondary\"\n          onClick={onScrollToTopClick}\n          tooltip={t('logs.logs-controls.scroll-top', 'Scroll to top')}\n          size=\"lg\"\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    navContainer: css({\n      maxHeight: '100%',\n      display: 'flex',\n      gap: theme.spacing(3),\n      flexDirection: 'column',\n      justifyContent: 'flex-start',\n      width: theme.spacing(4),\n      paddingTop: theme.spacing(0.75),\n      paddingLeft: theme.spacing(1),\n      borderLeft: `solid 1px ${theme.colors.border.medium}`,\n      overflow: 'hidden',\n      minWidth: theme.spacing(4),\n    }),\n    scrollToTopButton: css({\n      margin: 0,\n      marginTop: 'auto',\n      color: theme.colors.text.secondary,\n      height: theme.spacing(2),\n    }),\n    controlButton: css({\n      margin: 0,\n      color: theme.colors.text.secondary,\n      height: theme.spacing(2),\n    }),\n    divider: css({\n      borderTop: `solid 1px ${theme.colors.border.medium}`,\n      height: 1,\n      marginTop: theme.spacing(-0.25),\n      marginBottom: theme.spacing(-1.75),\n    }),\n    controlButtonActive: css({\n      margin: 0,\n      color: theme.colors.text.secondary,\n      height: theme.spacing(2),\n      '&:after': {\n        display: 'block',\n        content: '\" \"',\n        position: 'absolute',\n        height: 2,\n        borderRadius: theme.shape.radius.default,\n        bottom: theme.spacing(-1),\n        backgroundImage: theme.colors.gradients.brandHorizontal,\n        width: '95%',\n        opacity: 1,\n      },\n    }),\n    menuItemActive: css({\n      '&:before': {\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        top: theme.spacing(0.5),\n        height: `calc(100% - ${theme.spacing(1)})`,\n        width: '2px',\n        backgroundColor: theme.colors.warning.main,\n      },\n    }),\n  };\n};\n","import { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\nexport interface LogListSearchContextData {\n  hideSearch: () => void;\n  filterLogs: boolean;\n  matchingUids: string[] | null;\n  search?: string;\n  searchVisible?: boolean;\n  setMatchingUids: (matches: string[] | null) => void;\n  setSearch: (search: string | undefined) => void;\n  showSearch: () => void;\n  toggleFilterLogs: () => void;\n}\n\nexport const LogListSearchContext = createContext<LogListSearchContextData>({\n  hideSearch: () => {},\n  filterLogs: false,\n  matchingUids: null,\n  searchVisible: false,\n  setMatchingUids: () => {},\n  setSearch: () => {},\n  showSearch: () => {},\n  toggleFilterLogs: () => {},\n});\n\nexport const useLogListSearchContextData = (key: keyof LogListSearchContextData) => {\n  const data: LogListSearchContextData = useContext(LogListSearchContext);\n  return data[key];\n};\n\nexport const useLogListSearchContext = (): LogListSearchContextData => {\n  return useContext(LogListSearchContext);\n};\n\nexport const LogListSearchContextProvider = ({ children }: { children: ReactNode }) => {\n  const [search, setSearch] = useState<string | undefined>(undefined);\n  const [searchVisible, setSearchVisible] = useState(false);\n  const [matchingUids, setMatchingUids] = useState<string[] | null>(null);\n  const [filterLogs, setFilterLogs] = useState(false);\n\n  const hideSearch = useCallback(() => {\n    setSearchVisible(false);\n  }, []);\n\n  const showSearch = useCallback(() => {\n    setSearchVisible(true);\n  }, []);\n\n  const toggleFilterLogs = useCallback(() => {\n    setFilterLogs((filterLogs) => !filterLogs);\n  }, []);\n\n  return (\n    <LogListSearchContext.Provider\n      value={{\n        hideSearch,\n        filterLogs,\n        matchingUids,\n        search,\n        searchVisible,\n        setMatchingUids,\n        setSearch,\n        showSearch,\n        toggleFilterLogs,\n      }}\n    >\n      {children}\n    </LogListSearchContext.Provider>\n  );\n};\n","import ansicolor from 'ansicolor';\n\nimport { BusEventWithPayload, GrafanaTheme2 } from '@grafana/data';\n\nimport { LOG_LINE_DETAILS_HEIGHT, LogLineDetailsMode } from './LogLineDetails';\nimport { LogListFontSize } from './LogList';\nimport { LogListModel } from './processing';\n\nexport const LOG_LIST_MIN_WIDTH = 35 * 8;\n// Controls the space between fields in the log line, timestamp, level, displayed fields, and log line body\nexport const FIELD_GAP_MULTIPLIER = 1.5;\n\nexport const DEFAULT_LINE_HEIGHT = 22;\n\nexport class LogLineVirtualization {\n  private ctx: CanvasRenderingContext2D | null = null;\n  private gridSize;\n  private paddingBottom;\n  private lineHeight;\n  private measurementMode: 'canvas' | 'dom' = 'canvas';\n  private textWidthMap: Map<number, number>;\n  private logLineSizesMap: Map<string, number>;\n  private spanElement = document.createElement('span');\n  readonly fontSize: LogListFontSize;\n\n  constructor(theme: GrafanaTheme2, fontSize: LogListFontSize) {\n    this.fontSize = fontSize;\n\n    let fontSizePx;\n    if (fontSize === 'default') {\n      fontSizePx = theme.typography.fontSize;\n      this.lineHeight = theme.typography.fontSize * theme.typography.body.lineHeight;\n    } else {\n      fontSizePx =\n        typeof theme.typography.bodySmall.fontSize === 'string' && theme.typography.bodySmall.fontSize.includes('rem')\n          ? theme.typography.fontSize * parseFloat(theme.typography.bodySmall.fontSize)\n          : parseInt(theme.typography.bodySmall.fontSize, 10);\n      this.lineHeight = fontSizePx * theme.typography.bodySmall.lineHeight;\n    }\n\n    this.gridSize = theme.spacing.gridSize;\n    this.paddingBottom = this.gridSize * 0.75;\n    this.logLineSizesMap = new Map<string, number>();\n    this.textWidthMap = new Map<number, number>();\n\n    const font = `${fontSizePx}px ${theme.typography.fontFamilyMonospace}`;\n    const letterSpacing = theme.typography.body.letterSpacing;\n\n    this.initDOMmeasurement(font, letterSpacing);\n    this.initCanvasMeasurement(font, letterSpacing);\n    this.determineMeasurementMode();\n  }\n\n  getLineHeight = () => this.lineHeight;\n  getGridSize = () => this.gridSize;\n  getPaddingBottom = () => this.paddingBottom;\n\n  // 2/3 of the viewport height\n  getTruncationLineCount = () => Math.round(window.innerHeight / this.getLineHeight() / 1.5);\n\n  getTruncationLength = (container: HTMLDivElement | null) => {\n    const availableWidth = container ? getLogContainerWidth(container) : window.innerWidth;\n    return (availableWidth / this.measureTextWidth('e')) * this.getTruncationLineCount();\n  };\n\n  determineMeasurementMode = () => {\n    if (!this.ctx) {\n      this.measurementMode = 'dom';\n      return;\n    }\n    const canvasCharWidth = this.ctx.measureText('e').width;\n    const domCharWidth = this.measureTextWidthWithDOM('e');\n    const diff = domCharWidth - canvasCharWidth;\n    if (diff >= 0.1) {\n      console.warn('Virtualized log list: falling back to DOM for measurement');\n      this.measurementMode = 'dom';\n    }\n  };\n\n  initCanvasMeasurement = (font: string, letterSpacing: string | undefined) => {\n    const canvas = document.createElement('canvas');\n    this.ctx = canvas.getContext('2d');\n    if (!this.ctx) {\n      return;\n    }\n    this.ctx.font = font;\n    this.ctx.fontKerning = 'normal';\n    this.ctx.fontStretch = 'normal';\n    this.ctx.fontVariantCaps = 'normal';\n    this.ctx.textRendering = 'optimizeLegibility';\n    if (letterSpacing) {\n      this.ctx.letterSpacing = letterSpacing;\n    }\n  };\n\n  initDOMmeasurement = (font: string, letterSpacing: string | undefined) => {\n    this.spanElement.style.font = font;\n    this.spanElement.style.visibility = 'hidden';\n    this.spanElement.style.position = 'absolute';\n    this.spanElement.style.wordBreak = 'break-all';\n    if (letterSpacing) {\n      this.spanElement.style.letterSpacing = letterSpacing;\n    }\n  };\n\n  measureTextWidth = (text: string): number => {\n    if (!this.ctx) {\n      throw new Error(`Measuring context canvas is not initialized. Call init() before.`);\n    }\n    const key = text.length;\n\n    const storedWidth = this.textWidthMap.get(key);\n    if (storedWidth) {\n      return storedWidth;\n    }\n\n    const width =\n      this.measurementMode === 'canvas' ? this.ctx.measureText(text).width : this.measureTextWidthWithDOM(text);\n    this.textWidthMap.set(key, width);\n\n    return width;\n  };\n\n  measureTextWidthWithDOM = (text: string) => {\n    this.spanElement.textContent = text;\n\n    document.body.appendChild(this.spanElement);\n    const width = this.spanElement.getBoundingClientRect().width;\n    document.body.removeChild(this.spanElement);\n\n    return width;\n  };\n\n  measureTextHeight = (text: string, maxWidth: number, beforeWidth = 0) => {\n    let logLines = 0;\n    const charWidth = this.measureTextWidth('e');\n    let logLineCharsLength = Math.round(maxWidth / charWidth);\n    const firstLineCharsLength = Math.floor((maxWidth - beforeWidth) / charWidth) - 2 * charWidth;\n    const textLines = text.split('\\n');\n\n    // Skip unnecessary measurements\n    if (textLines.length === 1 && text.length < firstLineCharsLength) {\n      return {\n        lines: 1,\n        height: this.getLineHeight() + this.paddingBottom,\n      };\n    }\n\n    const availableWidth = maxWidth - beforeWidth;\n    for (const textLine of textLines) {\n      for (let start = 0; start < textLine.length; ) {\n        let testLogLine: string;\n        let width = 0;\n        let delta = 0;\n        do {\n          testLogLine = textLine.substring(start, start + logLineCharsLength - delta);\n          let measuredLine = testLogLine;\n          if (logLines > 0) {\n            measuredLine.trimStart();\n          }\n          width = this.measureTextWidth(measuredLine);\n          delta += 1;\n        } while (width >= availableWidth);\n        if (beforeWidth) {\n          beforeWidth = 0;\n        }\n        logLines += 1;\n        start += testLogLine.length;\n      }\n    }\n\n    const height = logLines * this.getLineHeight() + this.paddingBottom;\n\n    return {\n      lines: logLines,\n      height,\n    };\n  };\n\n  calculateFieldDimensions = (logs: LogListModel[], displayedFields: string[] = []) => {\n    if (!logs.length) {\n      return [];\n    }\n    let timestampWidth = 0;\n    let levelWidth = 0;\n    const fieldWidths: Record<string, number> = {};\n    for (let i = 0; i < logs.length; i++) {\n      let width = this.measureTextWidth(logs[i].timestamp);\n      if (width > timestampWidth) {\n        timestampWidth = Math.round(width);\n      }\n      width = this.measureTextWidth(logs[i].displayLevel);\n      if (width > levelWidth) {\n        levelWidth = Math.round(width);\n      }\n      for (const field of displayedFields) {\n        width = this.measureTextWidth(logs[i].getDisplayedFieldValue(field, true));\n        fieldWidths[field] = !fieldWidths[field] || width > fieldWidths[field] ? Math.round(width) : fieldWidths[field];\n      }\n    }\n    const dimensions: LogFieldDimension[] = [\n      {\n        field: 'timestamp',\n        width: timestampWidth,\n      },\n      {\n        field: 'level',\n        width: levelWidth,\n      },\n    ];\n    for (const field in fieldWidths) {\n      dimensions.push({\n        field,\n        width: fieldWidths[field],\n      });\n    }\n    return dimensions;\n  };\n\n  resetLogLineSizes = () => {\n    this.logLineSizesMap = new Map<string, number>();\n  };\n\n  storeLogLineSize = (id: string, container: HTMLDivElement, height: number) => {\n    const key = `${id}_${getLogContainerWidth(container)}_${this.fontSize}`;\n    this.logLineSizesMap.set(key, height);\n  };\n\n  retrieveLogLineSize = (id: string, container: HTMLDivElement) => {\n    const key = `${id}_${getLogContainerWidth(container)}_${this.fontSize}`;\n    return this.logLineSizesMap.get(key);\n  };\n}\n\nexport interface DisplayOptions {\n  detailsMode: LogLineDetailsMode;\n  hasLogsWithErrors?: boolean;\n  hasSampledLogs?: boolean;\n  showDetails: LogListModel[];\n  showDuplicates: boolean;\n  showTime: boolean;\n  wrap: boolean;\n}\n\nexport function getLogLineSize(\n  virtualization: LogLineVirtualization,\n  logs: LogListModel[],\n  container: HTMLDivElement | null,\n  displayedFields: string[],\n  { detailsMode, hasLogsWithErrors, hasSampledLogs, showDuplicates, showDetails, showTime, wrap }: DisplayOptions,\n  index: number\n) {\n  if (!container) {\n    return 0;\n  }\n  const gap = virtualization.getGridSize() * FIELD_GAP_MULTIPLIER;\n  const detailsHeight =\n    detailsMode === 'inline' && showDetails.findIndex((log) => log.uid === logs[index].uid) >= 0\n      ? window.innerHeight * (LOG_LINE_DETAILS_HEIGHT / 100) + gap / 2\n      : 0;\n  // !logs[index] means the line is not yet loaded by infinite scrolling\n  if (!wrap || !logs[index]) {\n    return virtualization.getLineHeight() + virtualization.getPaddingBottom() + detailsHeight;\n  }\n  // If a long line is collapsed, we show the line count + an extra line for the expand/collapse control\n  logs[index].updateCollapsedState(displayedFields, container);\n  if (logs[index].collapsed) {\n    return (virtualization.getTruncationLineCount() + 1) * virtualization.getLineHeight() + detailsHeight;\n  }\n\n  const storedSize = virtualization.retrieveLogLineSize(logs[index].uid, container);\n  if (storedSize) {\n    return storedSize;\n  }\n\n  let textToMeasure = '';\n  const iconsGap = virtualization.getGridSize() * 0.5;\n  let optionsWidth = 0;\n  if (showDuplicates) {\n    optionsWidth += virtualization.getGridSize() * 4.5 + iconsGap;\n  }\n  if (hasLogsWithErrors) {\n    optionsWidth += virtualization.getGridSize() * 2 + iconsGap;\n  }\n  if (hasSampledLogs) {\n    optionsWidth += virtualization.getGridSize() * 2 + iconsGap;\n  }\n  if (showTime) {\n    optionsWidth += gap;\n    textToMeasure += logs[index].timestamp;\n  }\n  // When logs are unwrapped, we want an empty column space to align with other log lines.\n  if (logs[index].displayLevel || !wrap) {\n    optionsWidth += gap;\n    textToMeasure += logs[index].displayLevel ?? '';\n  }\n  for (const field of displayedFields) {\n    textToMeasure = logs[index].getDisplayedFieldValue(field, true) + textToMeasure;\n  }\n  if (!displayedFields.length) {\n    textToMeasure += ansicolor.strip(logs[index].body);\n  }\n\n  const { height } = virtualization.measureTextHeight(textToMeasure, getLogContainerWidth(container), optionsWidth);\n  // When the log is collapsed, add an extra line for the expand/collapse control\n  return logs[index].collapsed === false\n    ? height + virtualization.getLineHeight() + detailsHeight\n    : height + detailsHeight;\n}\n\nexport interface LogFieldDimension {\n  field: string;\n  width: number;\n}\n\nexport function hasUnderOrOverflow(\n  virtualization: LogLineVirtualization,\n  element: HTMLDivElement,\n  calculatedHeight?: number,\n  collapsed?: boolean\n): number | null {\n  if (collapsed !== undefined && calculatedHeight) {\n    calculatedHeight -= virtualization.getLineHeight();\n  }\n  const inlineDetails = element.parentElement\n    ? Array.from(element.parentElement.children).filter((element) =>\n        element.classList.contains('log-line-inline-details')\n      )\n    : undefined;\n  const detailsHeight = inlineDetails?.length ? inlineDetails[0].clientHeight : 0;\n\n  // Line overflows container\n  let measuredHeight = element.scrollHeight + detailsHeight;\n  const height = calculatedHeight ?? element.clientHeight;\n  if (measuredHeight > height) {\n    return collapsed !== undefined ? measuredHeight + virtualization.getLineHeight() : measuredHeight;\n  }\n\n  // Line is smaller than container\n  const child = element.children[1];\n  measuredHeight = child.clientHeight + detailsHeight;\n  if (child instanceof HTMLDivElement && measuredHeight < height) {\n    return collapsed !== undefined ? measuredHeight + virtualization.getLineHeight() : measuredHeight;\n  }\n\n  // No overflow or undermeasurement\n  return null;\n}\n\nconst logLineMenuIconWidth = 24;\nconst scrollBarWidth = getScrollbarWidth();\n\nexport function getLogContainerWidth(container: HTMLDivElement) {\n  return container.clientWidth - scrollBarWidth - logLineMenuIconWidth;\n}\n\nexport function getScrollbarWidth() {\n  const hiddenDiv = document.createElement('div');\n\n  hiddenDiv.style.width = '100px';\n  hiddenDiv.style.height = '100px';\n  hiddenDiv.style.overflow = 'scroll';\n  hiddenDiv.style.position = 'absolute';\n  hiddenDiv.style.top = '-9999px';\n\n  document.body.appendChild(hiddenDiv);\n  const width = hiddenDiv.offsetWidth - hiddenDiv.clientWidth;\n  document.body.removeChild(hiddenDiv);\n\n  return width;\n}\n\nexport interface ScrollToLogsEventPayload {\n  scrollTo: 'top' | 'bottom';\n}\n\nexport class ScrollToLogsEvent extends BusEventWithPayload<ScrollToLogsEventPayload> {\n  static type = 'logs-panel-scroll-to';\n}\n","import { SyntaxNode } from '@lezer/common';\nimport { LRParser } from '@lezer/lr';\n\nimport { ErrorId } from '../../../querybuilder/parsingUtils';\n\ninterface ParserErrorBoundary {\n  startLineNumber: number;\n  startColumn: number;\n  endLineNumber: number;\n  endColumn: number;\n  error: string;\n}\n\ninterface ParseError {\n  text: string;\n  node: SyntaxNode;\n}\n\n/**\n * Conceived to work in combination with the MonacoQueryField component.\n * Given an original query, and it's interpolated version, it will return an array of ParserErrorBoundary\n * objects containing nodes which are actual errors. The interpolated version (even with placeholder variables)\n * is required because variables look like errors for Lezer.\n * @internal\n */\nexport function validateQuery(\n  query: string,\n  interpolatedQuery: string,\n  queryLines: string[],\n  parser: LRParser\n): ParserErrorBoundary[] | false {\n  if (!query) {\n    return false;\n  }\n\n  /**\n   * To provide support to variable interpolation in query validation, we run the parser in the interpolated\n   * query. If there are errors there, we trace them back to the original unparsed query, so we can more\n   * accurately highlight the error in the query, since it's likely that the variable name and variable value\n   * have different lengths. With this, we also exclude irrelevant parser errors that are produced by\n   * lezer not understanding $variables and $__variables, which usually generate 2 or 3 error SyntaxNode.\n   */\n  const interpolatedErrors: ParseError[] = parseQuery(interpolatedQuery, parser);\n  if (!interpolatedErrors.length) {\n    return false;\n  }\n\n  let parseErrors: ParseError[] = interpolatedErrors;\n  if (query !== interpolatedQuery) {\n    const queryErrors: ParseError[] = parseQuery(query, parser);\n    parseErrors = interpolatedErrors.flatMap(\n      (interpolatedError) =>\n        queryErrors.filter((queryError) => interpolatedError.text === queryError.text) || interpolatedError\n    );\n  }\n\n  return parseErrors.map((parseError) => findErrorBoundary(query, queryLines, parseError)).filter(isErrorBoundary);\n}\n\nfunction parseQuery(query: string, parser: LRParser) {\n  const parseErrors: ParseError[] = [];\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: (nodeRef): false | void => {\n      if (nodeRef.type.id === ErrorId) {\n        const node = nodeRef.node;\n        parseErrors.push({\n          node: node,\n          text: query.substring(node.from, node.to),\n        });\n      }\n    },\n  });\n  return parseErrors;\n}\n\nfunction findErrorBoundary(query: string, queryLines: string[], parseError: ParseError): ParserErrorBoundary | null {\n  if (queryLines.length === 1) {\n    const isEmptyString = parseError.node.from === parseError.node.to;\n    const errorNode = isEmptyString && parseError.node.parent ? parseError.node.parent : parseError.node;\n    const error = isEmptyString ? query.substring(errorNode.from, errorNode.to) : parseError.text;\n    return {\n      startLineNumber: 1,\n      startColumn: errorNode.from + 1,\n      endLineNumber: 1,\n      endColumn: errorNode.to + 1,\n      error,\n    };\n  }\n\n  let startPos = 0,\n    endPos = 0;\n  for (let line = 0; line < queryLines.length; line++) {\n    endPos = startPos + queryLines[line].length;\n\n    if (parseError.node.from > endPos) {\n      startPos += queryLines[line].length + 1;\n      continue;\n    }\n\n    return {\n      startLineNumber: line + 1,\n      startColumn: parseError.node.from - startPos + 1,\n      endLineNumber: line + 1,\n      endColumn: parseError.node.to - startPos + 1,\n      error: parseError.text,\n    };\n  }\n\n  return null;\n}\n\nfunction isErrorBoundary(boundary: ParserErrorBoundary | null): boundary is ParserErrorBoundary {\n  return boundary !== null;\n}\n\nexport const placeHolderScopedVars = {\n  __interval: { text: '1s', value: '1s' },\n  __rate_interval: { text: '1s', value: '1s' },\n  __auto: { text: '1s', value: '1s' },\n  __interval_ms: { text: '1000', value: 1000 },\n  __range_ms: { text: '1000', value: 1000 },\n  __range_s: { text: '1', value: 1 },\n  __range: { text: '1s', value: '1s' },\n};\n","/**\n * @module LRUCache\n */\nconst perf = typeof performance === 'object' &&\n    performance &&\n    typeof performance.now === 'function'\n    ? performance\n    : Date;\nconst warned = new Set();\n/* c8 ignore start */\nconst PROCESS = (typeof process === 'object' && !!process ? process : {});\n/* c8 ignore start */\nconst emitWarning = (msg, type, code, fn) => {\n    typeof PROCESS.emitWarning === 'function'\n        ? PROCESS.emitWarning(msg, type, code, fn)\n        : console.error(`[${code}] ${type}: ${msg}`);\n};\nlet AC = globalThis.AbortController;\nlet AS = globalThis.AbortSignal;\n/* c8 ignore start */\nif (typeof AC === 'undefined') {\n    //@ts-ignore\n    AS = class AbortSignal {\n        onabort;\n        _onabort = [];\n        reason;\n        aborted = false;\n        addEventListener(_, fn) {\n            this._onabort.push(fn);\n        }\n    };\n    //@ts-ignore\n    AC = class AbortController {\n        constructor() {\n            warnACPolyfill();\n        }\n        signal = new AS();\n        abort(reason) {\n            if (this.signal.aborted)\n                return;\n            //@ts-ignore\n            this.signal.reason = reason;\n            //@ts-ignore\n            this.signal.aborted = true;\n            //@ts-ignore\n            for (const fn of this.signal._onabort) {\n                fn(reason);\n            }\n            this.signal.onabort?.(reason);\n        }\n    };\n    let printACPolyfillWarning = PROCESS.env?.LRU_CACHE_IGNORE_AC_WARNING !== '1';\n    const warnACPolyfill = () => {\n        if (!printACPolyfillWarning)\n            return;\n        printACPolyfillWarning = false;\n        emitWarning('AbortController is not defined. If using lru-cache in ' +\n            'node 14, load an AbortController polyfill from the ' +\n            '`node-abort-controller` package. A minimal polyfill is ' +\n            'provided for use by LRUCache.fetch(), but it should not be ' +\n            'relied upon in other contexts (eg, passing it to other APIs that ' +\n            'use AbortController/AbortSignal might have undesirable effects). ' +\n            'You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.', 'NO_ABORT_CONTROLLER', 'ENOTSUP', warnACPolyfill);\n    };\n}\n/* c8 ignore stop */\nconst shouldWarn = (code) => !warned.has(code);\nconst TYPE = Symbol('type');\nconst isPosInt = (n) => n && n === Math.floor(n) && n > 0 && isFinite(n);\n/* c8 ignore start */\n// This is a little bit ridiculous, tbh.\n// The maximum array length is 2^32-1 or thereabouts on most JS impls.\n// And well before that point, you're caching the entire world, I mean,\n// that's ~32GB of just integers for the next/prev links, plus whatever\n// else to hold that many keys and values.  Just filling the memory with\n// zeroes at init time is brutal when you get that big.\n// But why not be complete?\n// Maybe in the future, these limits will have expanded.\nconst getUintArray = (max) => !isPosInt(max)\n    ? null\n    : max <= Math.pow(2, 8)\n        ? Uint8Array\n        : max <= Math.pow(2, 16)\n            ? Uint16Array\n            : max <= Math.pow(2, 32)\n                ? Uint32Array\n                : max <= Number.MAX_SAFE_INTEGER\n                    ? ZeroArray\n                    : null;\n/* c8 ignore stop */\nclass ZeroArray extends Array {\n    constructor(size) {\n        super(size);\n        this.fill(0);\n    }\n}\nclass Stack {\n    heap;\n    length;\n    // private constructor\n    static #constructing = false;\n    static create(max) {\n        const HeapCls = getUintArray(max);\n        if (!HeapCls)\n            return [];\n        Stack.#constructing = true;\n        const s = new Stack(max, HeapCls);\n        Stack.#constructing = false;\n        return s;\n    }\n    constructor(max, HeapCls) {\n        /* c8 ignore start */\n        if (!Stack.#constructing) {\n            throw new TypeError('instantiate Stack using Stack.create(n)');\n        }\n        /* c8 ignore stop */\n        this.heap = new HeapCls(max);\n        this.length = 0;\n    }\n    push(n) {\n        this.heap[this.length++] = n;\n    }\n    pop() {\n        return this.heap[--this.length];\n    }\n}\n/**\n * Default export, the thing you're using this module to get.\n *\n * The `K` and `V` types define the key and value types, respectively. The\n * optional `FC` type defines the type of the `context` object passed to\n * `cache.fetch()` and `cache.memo()`.\n *\n * Keys and values **must not** be `null` or `undefined`.\n *\n * All properties from the options object (with the exception of `max`,\n * `maxSize`, `fetchMethod`, `memoMethod`, `dispose` and `disposeAfter`) are\n * added as normal public members. (The listed options are read-only getters.)\n *\n * Changing any of these will alter the defaults for subsequent method calls.\n */\nexport class LRUCache {\n    // options that cannot be changed without disaster\n    #max;\n    #maxSize;\n    #dispose;\n    #onInsert;\n    #disposeAfter;\n    #fetchMethod;\n    #memoMethod;\n    /**\n     * {@link LRUCache.OptionsBase.ttl}\n     */\n    ttl;\n    /**\n     * {@link LRUCache.OptionsBase.ttlResolution}\n     */\n    ttlResolution;\n    /**\n     * {@link LRUCache.OptionsBase.ttlAutopurge}\n     */\n    ttlAutopurge;\n    /**\n     * {@link LRUCache.OptionsBase.updateAgeOnGet}\n     */\n    updateAgeOnGet;\n    /**\n     * {@link LRUCache.OptionsBase.updateAgeOnHas}\n     */\n    updateAgeOnHas;\n    /**\n     * {@link LRUCache.OptionsBase.allowStale}\n     */\n    allowStale;\n    /**\n     * {@link LRUCache.OptionsBase.noDisposeOnSet}\n     */\n    noDisposeOnSet;\n    /**\n     * {@link LRUCache.OptionsBase.noUpdateTTL}\n     */\n    noUpdateTTL;\n    /**\n     * {@link LRUCache.OptionsBase.maxEntrySize}\n     */\n    maxEntrySize;\n    /**\n     * {@link LRUCache.OptionsBase.sizeCalculation}\n     */\n    sizeCalculation;\n    /**\n     * {@link LRUCache.OptionsBase.noDeleteOnFetchRejection}\n     */\n    noDeleteOnFetchRejection;\n    /**\n     * {@link LRUCache.OptionsBase.noDeleteOnStaleGet}\n     */\n    noDeleteOnStaleGet;\n    /**\n     * {@link LRUCache.OptionsBase.allowStaleOnFetchAbort}\n     */\n    allowStaleOnFetchAbort;\n    /**\n     * {@link LRUCache.OptionsBase.allowStaleOnFetchRejection}\n     */\n    allowStaleOnFetchRejection;\n    /**\n     * {@link LRUCache.OptionsBase.ignoreFetchAbort}\n     */\n    ignoreFetchAbort;\n    // computed properties\n    #size;\n    #calculatedSize;\n    #keyMap;\n    #keyList;\n    #valList;\n    #next;\n    #prev;\n    #head;\n    #tail;\n    #free;\n    #disposed;\n    #sizes;\n    #starts;\n    #ttls;\n    #hasDispose;\n    #hasFetchMethod;\n    #hasDisposeAfter;\n    #hasOnInsert;\n    /**\n     * Do not call this method unless you need to inspect the\n     * inner workings of the cache.  If anything returned by this\n     * object is modified in any way, strange breakage may occur.\n     *\n     * These fields are private for a reason!\n     *\n     * @internal\n     */\n    static unsafeExposeInternals(c) {\n        return {\n            // properties\n            starts: c.#starts,\n            ttls: c.#ttls,\n            sizes: c.#sizes,\n            keyMap: c.#keyMap,\n            keyList: c.#keyList,\n            valList: c.#valList,\n            next: c.#next,\n            prev: c.#prev,\n            get head() {\n                return c.#head;\n            },\n            get tail() {\n                return c.#tail;\n            },\n            free: c.#free,\n            // methods\n            isBackgroundFetch: (p) => c.#isBackgroundFetch(p),\n            backgroundFetch: (k, index, options, context) => c.#backgroundFetch(k, index, options, context),\n            moveToTail: (index) => c.#moveToTail(index),\n            indexes: (options) => c.#indexes(options),\n            rindexes: (options) => c.#rindexes(options),\n            isStale: (index) => c.#isStale(index),\n        };\n    }\n    // Protected read-only members\n    /**\n     * {@link LRUCache.OptionsBase.max} (read-only)\n     */\n    get max() {\n        return this.#max;\n    }\n    /**\n     * {@link LRUCache.OptionsBase.maxSize} (read-only)\n     */\n    get maxSize() {\n        return this.#maxSize;\n    }\n    /**\n     * The total computed size of items in the cache (read-only)\n     */\n    get calculatedSize() {\n        return this.#calculatedSize;\n    }\n    /**\n     * The number of items stored in the cache (read-only)\n     */\n    get size() {\n        return this.#size;\n    }\n    /**\n     * {@link LRUCache.OptionsBase.fetchMethod} (read-only)\n     */\n    get fetchMethod() {\n        return this.#fetchMethod;\n    }\n    get memoMethod() {\n        return this.#memoMethod;\n    }\n    /**\n     * {@link LRUCache.OptionsBase.dispose} (read-only)\n     */\n    get dispose() {\n        return this.#dispose;\n    }\n    /**\n     * {@link LRUCache.OptionsBase.onInsert} (read-only)\n     */\n    get onInsert() {\n        return this.#onInsert;\n    }\n    /**\n     * {@link LRUCache.OptionsBase.disposeAfter} (read-only)\n     */\n    get disposeAfter() {\n        return this.#disposeAfter;\n    }\n    constructor(options) {\n        const { max = 0, ttl, ttlResolution = 1, ttlAutopurge, updateAgeOnGet, updateAgeOnHas, allowStale, dispose, onInsert, disposeAfter, noDisposeOnSet, noUpdateTTL, maxSize = 0, maxEntrySize = 0, sizeCalculation, fetchMethod, memoMethod, noDeleteOnFetchRejection, noDeleteOnStaleGet, allowStaleOnFetchRejection, allowStaleOnFetchAbort, ignoreFetchAbort, } = options;\n        if (max !== 0 && !isPosInt(max)) {\n            throw new TypeError('max option must be a nonnegative integer');\n        }\n        const UintArray = max ? getUintArray(max) : Array;\n        if (!UintArray) {\n            throw new Error('invalid max value: ' + max);\n        }\n        this.#max = max;\n        this.#maxSize = maxSize;\n        this.maxEntrySize = maxEntrySize || this.#maxSize;\n        this.sizeCalculation = sizeCalculation;\n        if (this.sizeCalculation) {\n            if (!this.#maxSize && !this.maxEntrySize) {\n                throw new TypeError('cannot set sizeCalculation without setting maxSize or maxEntrySize');\n            }\n            if (typeof this.sizeCalculation !== 'function') {\n                throw new TypeError('sizeCalculation set to non-function');\n            }\n        }\n        if (memoMethod !== undefined &&\n            typeof memoMethod !== 'function') {\n            throw new TypeError('memoMethod must be a function if defined');\n        }\n        this.#memoMethod = memoMethod;\n        if (fetchMethod !== undefined &&\n            typeof fetchMethod !== 'function') {\n            throw new TypeError('fetchMethod must be a function if specified');\n        }\n        this.#fetchMethod = fetchMethod;\n        this.#hasFetchMethod = !!fetchMethod;\n        this.#keyMap = new Map();\n        this.#keyList = new Array(max).fill(undefined);\n        this.#valList = new Array(max).fill(undefined);\n        this.#next = new UintArray(max);\n        this.#prev = new UintArray(max);\n        this.#head = 0;\n        this.#tail = 0;\n        this.#free = Stack.create(max);\n        this.#size = 0;\n        this.#calculatedSize = 0;\n        if (typeof dispose === 'function') {\n            this.#dispose = dispose;\n        }\n        if (typeof onInsert === 'function') {\n            this.#onInsert = onInsert;\n        }\n        if (typeof disposeAfter === 'function') {\n            this.#disposeAfter = disposeAfter;\n            this.#disposed = [];\n        }\n        else {\n            this.#disposeAfter = undefined;\n            this.#disposed = undefined;\n        }\n        this.#hasDispose = !!this.#dispose;\n        this.#hasOnInsert = !!this.#onInsert;\n        this.#hasDisposeAfter = !!this.#disposeAfter;\n        this.noDisposeOnSet = !!noDisposeOnSet;\n        this.noUpdateTTL = !!noUpdateTTL;\n        this.noDeleteOnFetchRejection = !!noDeleteOnFetchRejection;\n        this.allowStaleOnFetchRejection = !!allowStaleOnFetchRejection;\n        this.allowStaleOnFetchAbort = !!allowStaleOnFetchAbort;\n        this.ignoreFetchAbort = !!ignoreFetchAbort;\n        // NB: maxEntrySize is set to maxSize if it's set\n        if (this.maxEntrySize !== 0) {\n            if (this.#maxSize !== 0) {\n                if (!isPosInt(this.#maxSize)) {\n                    throw new TypeError('maxSize must be a positive integer if specified');\n                }\n            }\n            if (!isPosInt(this.maxEntrySize)) {\n                throw new TypeError('maxEntrySize must be a positive integer if specified');\n            }\n            this.#initializeSizeTracking();\n        }\n        this.allowStale = !!allowStale;\n        this.noDeleteOnStaleGet = !!noDeleteOnStaleGet;\n        this.updateAgeOnGet = !!updateAgeOnGet;\n        this.updateAgeOnHas = !!updateAgeOnHas;\n        this.ttlResolution =\n            isPosInt(ttlResolution) || ttlResolution === 0\n                ? ttlResolution\n                : 1;\n        this.ttlAutopurge = !!ttlAutopurge;\n        this.ttl = ttl || 0;\n        if (this.ttl) {\n            if (!isPosInt(this.ttl)) {\n                throw new TypeError('ttl must be a positive integer if specified');\n            }\n            this.#initializeTTLTracking();\n        }\n        // do not allow completely unbounded caches\n        if (this.#max === 0 && this.ttl === 0 && this.#maxSize === 0) {\n            throw new TypeError('At least one of max, maxSize, or ttl is required');\n        }\n        if (!this.ttlAutopurge && !this.#max && !this.#maxSize) {\n            const code = 'LRU_CACHE_UNBOUNDED';\n            if (shouldWarn(code)) {\n                warned.add(code);\n                const msg = 'TTL caching without ttlAutopurge, max, or maxSize can ' +\n                    'result in unbounded memory consumption.';\n                emitWarning(msg, 'UnboundedCacheWarning', code, LRUCache);\n            }\n        }\n    }\n    /**\n     * Return the number of ms left in the item's TTL. If item is not in cache,\n     * returns `0`. Returns `Infinity` if item is in cache without a defined TTL.\n     */\n    getRemainingTTL(key) {\n        return this.#keyMap.has(key) ? Infinity : 0;\n    }\n    #initializeTTLTracking() {\n        const ttls = new ZeroArray(this.#max);\n        const starts = new ZeroArray(this.#max);\n        this.#ttls = ttls;\n        this.#starts = starts;\n        this.#setItemTTL = (index, ttl, start = perf.now()) => {\n            starts[index] = ttl !== 0 ? start : 0;\n            ttls[index] = ttl;\n            if (ttl !== 0 && this.ttlAutopurge) {\n                const t = setTimeout(() => {\n                    if (this.#isStale(index)) {\n                        this.#delete(this.#keyList[index], 'expire');\n                    }\n                }, ttl + 1);\n                // unref() not supported on all platforms\n                /* c8 ignore start */\n                if (t.unref) {\n                    t.unref();\n                }\n                /* c8 ignore stop */\n            }\n        };\n        this.#updateItemAge = index => {\n            starts[index] = ttls[index] !== 0 ? perf.now() : 0;\n        };\n        this.#statusTTL = (status, index) => {\n            if (ttls[index]) {\n                const ttl = ttls[index];\n                const start = starts[index];\n                /* c8 ignore next */\n                if (!ttl || !start)\n                    return;\n                status.ttl = ttl;\n                status.start = start;\n                status.now = cachedNow || getNow();\n                const age = status.now - start;\n                status.remainingTTL = ttl - age;\n            }\n        };\n        // debounce calls to perf.now() to 1s so we're not hitting\n        // that costly call repeatedly.\n        let cachedNow = 0;\n        const getNow = () => {\n            const n = perf.now();\n            if (this.ttlResolution > 0) {\n                cachedNow = n;\n                const t = setTimeout(() => (cachedNow = 0), this.ttlResolution);\n                // not available on all platforms\n                /* c8 ignore start */\n                if (t.unref) {\n                    t.unref();\n                }\n                /* c8 ignore stop */\n            }\n            return n;\n        };\n        this.getRemainingTTL = key => {\n            const index = this.#keyMap.get(key);\n            if (index === undefined) {\n                return 0;\n            }\n            const ttl = ttls[index];\n            const start = starts[index];\n            if (!ttl || !start) {\n                return Infinity;\n            }\n            const age = (cachedNow || getNow()) - start;\n            return ttl - age;\n        };\n        this.#isStale = index => {\n            const s = starts[index];\n            const t = ttls[index];\n            return !!t && !!s && (cachedNow || getNow()) - s > t;\n        };\n    }\n    // conditionally set private methods related to TTL\n    #updateItemAge = () => { };\n    #statusTTL = () => { };\n    #setItemTTL = () => { };\n    /* c8 ignore stop */\n    #isStale = () => false;\n    #initializeSizeTracking() {\n        const sizes = new ZeroArray(this.#max);\n        this.#calculatedSize = 0;\n        this.#sizes = sizes;\n        this.#removeItemSize = index => {\n            this.#calculatedSize -= sizes[index];\n            sizes[index] = 0;\n        };\n        this.#requireSize = (k, v, size, sizeCalculation) => {\n            // provisionally accept background fetches.\n            // actual value size will be checked when they return.\n            if (this.#isBackgroundFetch(v)) {\n                return 0;\n            }\n            if (!isPosInt(size)) {\n                if (sizeCalculation) {\n                    if (typeof sizeCalculation !== 'function') {\n                        throw new TypeError('sizeCalculation must be a function');\n                    }\n                    size = sizeCalculation(v, k);\n                    if (!isPosInt(size)) {\n                        throw new TypeError('sizeCalculation return invalid (expect positive integer)');\n                    }\n                }\n                else {\n                    throw new TypeError('invalid size value (must be positive integer). ' +\n                        'When maxSize or maxEntrySize is used, sizeCalculation ' +\n                        'or size must be set.');\n                }\n            }\n            return size;\n        };\n        this.#addItemSize = (index, size, status) => {\n            sizes[index] = size;\n            if (this.#maxSize) {\n                const maxSize = this.#maxSize - sizes[index];\n                while (this.#calculatedSize > maxSize) {\n                    this.#evict(true);\n                }\n            }\n            this.#calculatedSize += sizes[index];\n            if (status) {\n                status.entrySize = size;\n                status.totalCalculatedSize = this.#calculatedSize;\n            }\n        };\n    }\n    #removeItemSize = _i => { };\n    #addItemSize = (_i, _s, _st) => { };\n    #requireSize = (_k, _v, size, sizeCalculation) => {\n        if (size || sizeCalculation) {\n            throw new TypeError('cannot set size without setting maxSize or maxEntrySize on cache');\n        }\n        return 0;\n    };\n    *#indexes({ allowStale = this.allowStale } = {}) {\n        if (this.#size) {\n            for (let i = this.#tail; true;) {\n                if (!this.#isValidIndex(i)) {\n                    break;\n                }\n                if (allowStale || !this.#isStale(i)) {\n                    yield i;\n                }\n                if (i === this.#head) {\n                    break;\n                }\n                else {\n                    i = this.#prev[i];\n                }\n            }\n        }\n    }\n    *#rindexes({ allowStale = this.allowStale } = {}) {\n        if (this.#size) {\n            for (let i = this.#head; true;) {\n                if (!this.#isValidIndex(i)) {\n                    break;\n                }\n                if (allowStale || !this.#isStale(i)) {\n                    yield i;\n                }\n                if (i === this.#tail) {\n                    break;\n                }\n                else {\n                    i = this.#next[i];\n                }\n            }\n        }\n    }\n    #isValidIndex(index) {\n        return (index !== undefined &&\n            this.#keyMap.get(this.#keyList[index]) === index);\n    }\n    /**\n     * Return a generator yielding `[key, value]` pairs,\n     * in order from most recently used to least recently used.\n     */\n    *entries() {\n        for (const i of this.#indexes()) {\n            if (this.#valList[i] !== undefined &&\n                this.#keyList[i] !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield [this.#keyList[i], this.#valList[i]];\n            }\n        }\n    }\n    /**\n     * Inverse order version of {@link LRUCache.entries}\n     *\n     * Return a generator yielding `[key, value]` pairs,\n     * in order from least recently used to most recently used.\n     */\n    *rentries() {\n        for (const i of this.#rindexes()) {\n            if (this.#valList[i] !== undefined &&\n                this.#keyList[i] !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield [this.#keyList[i], this.#valList[i]];\n            }\n        }\n    }\n    /**\n     * Return a generator yielding the keys in the cache,\n     * in order from most recently used to least recently used.\n     */\n    *keys() {\n        for (const i of this.#indexes()) {\n            const k = this.#keyList[i];\n            if (k !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield k;\n            }\n        }\n    }\n    /**\n     * Inverse order version of {@link LRUCache.keys}\n     *\n     * Return a generator yielding the keys in the cache,\n     * in order from least recently used to most recently used.\n     */\n    *rkeys() {\n        for (const i of this.#rindexes()) {\n            const k = this.#keyList[i];\n            if (k !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield k;\n            }\n        }\n    }\n    /**\n     * Return a generator yielding the values in the cache,\n     * in order from most recently used to least recently used.\n     */\n    *values() {\n        for (const i of this.#indexes()) {\n            const v = this.#valList[i];\n            if (v !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield this.#valList[i];\n            }\n        }\n    }\n    /**\n     * Inverse order version of {@link LRUCache.values}\n     *\n     * Return a generator yielding the values in the cache,\n     * in order from least recently used to most recently used.\n     */\n    *rvalues() {\n        for (const i of this.#rindexes()) {\n            const v = this.#valList[i];\n            if (v !== undefined &&\n                !this.#isBackgroundFetch(this.#valList[i])) {\n                yield this.#valList[i];\n            }\n        }\n    }\n    /**\n     * Iterating over the cache itself yields the same results as\n     * {@link LRUCache.entries}\n     */\n    [Symbol.iterator]() {\n        return this.entries();\n    }\n    /**\n     * A String value that is used in the creation of the default string\n     * description of an object. Called by the built-in method\n     * `Object.prototype.toString`.\n     */\n    [Symbol.toStringTag] = 'LRUCache';\n    /**\n     * Find a value for which the supplied fn method returns a truthy value,\n     * similar to `Array.find()`. fn is called as `fn(value, key, cache)`.\n     */\n    find(fn, getOptions = {}) {\n        for (const i of this.#indexes()) {\n            const v = this.#valList[i];\n            const value = this.#isBackgroundFetch(v)\n                ? v.__staleWhileFetching\n                : v;\n            if (value === undefined)\n                continue;\n            if (fn(value, this.#keyList[i], this)) {\n                return this.get(this.#keyList[i], getOptions);\n            }\n        }\n    }\n    /**\n     * Call the supplied function on each item in the cache, in order from most\n     * recently used to least recently used.\n     *\n     * `fn` is called as `fn(value, key, cache)`.\n     *\n     * If `thisp` is provided, function will be called in the `this`-context of\n     * the provided object, or the cache if no `thisp` object is provided.\n     *\n     * Does not update age or recenty of use, or iterate over stale values.\n     */\n    forEach(fn, thisp = this) {\n        for (const i of this.#indexes()) {\n            const v = this.#valList[i];\n            const value = this.#isBackgroundFetch(v)\n                ? v.__staleWhileFetching\n                : v;\n            if (value === undefined)\n                continue;\n            fn.call(thisp, value, this.#keyList[i], this);\n        }\n    }\n    /**\n     * The same as {@link LRUCache.forEach} but items are iterated over in\n     * reverse order.  (ie, less recently used items are iterated over first.)\n     */\n    rforEach(fn, thisp = this) {\n        for (const i of this.#rindexes()) {\n            const v = this.#valList[i];\n            const value = this.#isBackgroundFetch(v)\n                ? v.__staleWhileFetching\n                : v;\n            if (value === undefined)\n                continue;\n            fn.call(thisp, value, this.#keyList[i], this);\n        }\n    }\n    /**\n     * Delete any stale entries. Returns true if anything was removed,\n     * false otherwise.\n     */\n    purgeStale() {\n        let deleted = false;\n        for (const i of this.#rindexes({ allowStale: true })) {\n            if (this.#isStale(i)) {\n                this.#delete(this.#keyList[i], 'expire');\n                deleted = true;\n            }\n        }\n        return deleted;\n    }\n    /**\n     * Get the extended info about a given entry, to get its value, size, and\n     * TTL info simultaneously. Returns `undefined` if the key is not present.\n     *\n     * Unlike {@link LRUCache#dump}, which is designed to be portable and survive\n     * serialization, the `start` value is always the current timestamp, and the\n     * `ttl` is a calculated remaining time to live (negative if expired).\n     *\n     * Always returns stale values, if their info is found in the cache, so be\n     * sure to check for expirations (ie, a negative {@link LRUCache.Entry#ttl})\n     * if relevant.\n     */\n    info(key) {\n        const i = this.#keyMap.get(key);\n        if (i === undefined)\n            return undefined;\n        const v = this.#valList[i];\n        const value = this.#isBackgroundFetch(v)\n            ? v.__staleWhileFetching\n            : v;\n        if (value === undefined)\n            return undefined;\n        const entry = { value };\n        if (this.#ttls && this.#starts) {\n            const ttl = this.#ttls[i];\n            const start = this.#starts[i];\n            if (ttl && start) {\n                const remain = ttl - (perf.now() - start);\n                entry.ttl = remain;\n                entry.start = Date.now();\n            }\n        }\n        if (this.#sizes) {\n            entry.size = this.#sizes[i];\n        }\n        return entry;\n    }\n    /**\n     * Return an array of [key, {@link LRUCache.Entry}] tuples which can be\n     * passed to {@link LRUCache#load}.\n     *\n     * The `start` fields are calculated relative to a portable `Date.now()`\n     * timestamp, even if `performance.now()` is available.\n     *\n     * Stale entries are always included in the `dump`, even if\n     * {@link LRUCache.OptionsBase.allowStale} is false.\n     *\n     * Note: this returns an actual array, not a generator, so it can be more\n     * easily passed around.\n     */\n    dump() {\n        const arr = [];\n        for (const i of this.#indexes({ allowStale: true })) {\n            const key = this.#keyList[i];\n            const v = this.#valList[i];\n            const value = this.#isBackgroundFetch(v)\n                ? v.__staleWhileFetching\n                : v;\n            if (value === undefined || key === undefined)\n                continue;\n            const entry = { value };\n            if (this.#ttls && this.#starts) {\n                entry.ttl = this.#ttls[i];\n                // always dump the start relative to a portable timestamp\n                // it's ok for this to be a bit slow, it's a rare operation.\n                const age = perf.now() - this.#starts[i];\n                entry.start = Math.floor(Date.now() - age);\n            }\n            if (this.#sizes) {\n                entry.size = this.#sizes[i];\n            }\n            arr.unshift([key, entry]);\n        }\n        return arr;\n    }\n    /**\n     * Reset the cache and load in the items in entries in the order listed.\n     *\n     * The shape of the resulting cache may be different if the same options are\n     * not used in both caches.\n     *\n     * The `start` fields are assumed to be calculated relative to a portable\n     * `Date.now()` timestamp, even if `performance.now()` is available.\n     */\n    load(arr) {\n        this.clear();\n        for (const [key, entry] of arr) {\n            if (entry.start) {\n                // entry.start is a portable timestamp, but we may be using\n                // node's performance.now(), so calculate the offset, so that\n                // we get the intended remaining TTL, no matter how long it's\n                // been on ice.\n                //\n                // it's ok for this to be a bit slow, it's a rare operation.\n                const age = Date.now() - entry.start;\n                entry.start = perf.now() - age;\n            }\n            this.set(key, entry.value, entry);\n        }\n    }\n    /**\n     * Add a value to the cache.\n     *\n     * Note: if `undefined` is specified as a value, this is an alias for\n     * {@link LRUCache#delete}\n     *\n     * Fields on the {@link LRUCache.SetOptions} options param will override\n     * their corresponding values in the constructor options for the scope\n     * of this single `set()` operation.\n     *\n     * If `start` is provided, then that will set the effective start\n     * time for the TTL calculation. Note that this must be a previous\n     * value of `performance.now()` if supported, or a previous value of\n     * `Date.now()` if not.\n     *\n     * Options object may also include `size`, which will prevent\n     * calling the `sizeCalculation` function and just use the specified\n     * number if it is a positive integer, and `noDisposeOnSet` which\n     * will prevent calling a `dispose` function in the case of\n     * overwrites.\n     *\n     * If the `size` (or return value of `sizeCalculation`) for a given\n     * entry is greater than `maxEntrySize`, then the item will not be\n     * added to the cache.\n     *\n     * Will update the recency of the entry.\n     *\n     * If the value is `undefined`, then this is an alias for\n     * `cache.delete(key)`. `undefined` is never stored in the cache.\n     */\n    set(k, v, setOptions = {}) {\n        if (v === undefined) {\n            this.delete(k);\n            return this;\n        }\n        const { ttl = this.ttl, start, noDisposeOnSet = this.noDisposeOnSet, sizeCalculation = this.sizeCalculation, status, } = setOptions;\n        let { noUpdateTTL = this.noUpdateTTL } = setOptions;\n        const size = this.#requireSize(k, v, setOptions.size || 0, sizeCalculation);\n        // if the item doesn't fit, don't do anything\n        // NB: maxEntrySize set to maxSize by default\n        if (this.maxEntrySize && size > this.maxEntrySize) {\n            if (status) {\n                status.set = 'miss';\n                status.maxEntrySizeExceeded = true;\n            }\n            // have to delete, in case something is there already.\n            this.#delete(k, 'set');\n            return this;\n        }\n        let index = this.#size === 0 ? undefined : this.#keyMap.get(k);\n        if (index === undefined) {\n            // addition\n            index = (this.#size === 0\n                ? this.#tail\n                : this.#free.length !== 0\n                    ? this.#free.pop()\n                    : this.#size === this.#max\n                        ? this.#evict(false)\n                        : this.#size);\n            this.#keyList[index] = k;\n            this.#valList[index] = v;\n            this.#keyMap.set(k, index);\n            this.#next[this.#tail] = index;\n            this.#prev[index] = this.#tail;\n            this.#tail = index;\n            this.#size++;\n            this.#addItemSize(index, size, status);\n            if (status)\n                status.set = 'add';\n            noUpdateTTL = false;\n            if (this.#hasOnInsert) {\n                this.#onInsert?.(v, k, 'add');\n            }\n        }\n        else {\n            // update\n            this.#moveToTail(index);\n            const oldVal = this.#valList[index];\n            if (v !== oldVal) {\n                if (this.#hasFetchMethod && this.#isBackgroundFetch(oldVal)) {\n                    oldVal.__abortController.abort(new Error('replaced'));\n                    const { __staleWhileFetching: s } = oldVal;\n                    if (s !== undefined && !noDisposeOnSet) {\n                        if (this.#hasDispose) {\n                            this.#dispose?.(s, k, 'set');\n                        }\n                        if (this.#hasDisposeAfter) {\n                            this.#disposed?.push([s, k, 'set']);\n                        }\n                    }\n                }\n                else if (!noDisposeOnSet) {\n                    if (this.#hasDispose) {\n                        this.#dispose?.(oldVal, k, 'set');\n                    }\n                    if (this.#hasDisposeAfter) {\n                        this.#disposed?.push([oldVal, k, 'set']);\n                    }\n                }\n                this.#removeItemSize(index);\n                this.#addItemSize(index, size, status);\n                this.#valList[index] = v;\n                if (status) {\n                    status.set = 'replace';\n                    const oldValue = oldVal && this.#isBackgroundFetch(oldVal)\n                        ? oldVal.__staleWhileFetching\n                        : oldVal;\n                    if (oldValue !== undefined)\n                        status.oldValue = oldValue;\n                }\n            }\n            else if (status) {\n                status.set = 'update';\n            }\n            if (this.#hasOnInsert) {\n                this.onInsert?.(v, k, v === oldVal ? 'update' : 'replace');\n            }\n        }\n        if (ttl !== 0 && !this.#ttls) {\n            this.#initializeTTLTracking();\n        }\n        if (this.#ttls) {\n            if (!noUpdateTTL) {\n                this.#setItemTTL(index, ttl, start);\n            }\n            if (status)\n                this.#statusTTL(status, index);\n        }\n        if (!noDisposeOnSet && this.#hasDisposeAfter && this.#disposed) {\n            const dt = this.#disposed;\n            let task;\n            while ((task = dt?.shift())) {\n                this.#disposeAfter?.(...task);\n            }\n        }\n        return this;\n    }\n    /**\n     * Evict the least recently used item, returning its value or\n     * `undefined` if cache is empty.\n     */\n    pop() {\n        try {\n            while (this.#size) {\n                const val = this.#valList[this.#head];\n                this.#evict(true);\n                if (this.#isBackgroundFetch(val)) {\n                    if (val.__staleWhileFetching) {\n                        return val.__staleWhileFetching;\n                    }\n                }\n                else if (val !== undefined) {\n                    return val;\n                }\n            }\n        }\n        finally {\n            if (this.#hasDisposeAfter && this.#disposed) {\n                const dt = this.#disposed;\n                let task;\n                while ((task = dt?.shift())) {\n                    this.#disposeAfter?.(...task);\n                }\n            }\n        }\n    }\n    #evict(free) {\n        const head = this.#head;\n        const k = this.#keyList[head];\n        const v = this.#valList[head];\n        if (this.#hasFetchMethod && this.#isBackgroundFetch(v)) {\n            v.__abortController.abort(new Error('evicted'));\n        }\n        else if (this.#hasDispose || this.#hasDisposeAfter) {\n            if (this.#hasDispose) {\n                this.#dispose?.(v, k, 'evict');\n            }\n            if (this.#hasDisposeAfter) {\n                this.#disposed?.push([v, k, 'evict']);\n            }\n        }\n        this.#removeItemSize(head);\n        // if we aren't about to use the index, then null these out\n        if (free) {\n            this.#keyList[head] = undefined;\n            this.#valList[head] = undefined;\n            this.#free.push(head);\n        }\n        if (this.#size === 1) {\n            this.#head = this.#tail = 0;\n            this.#free.length = 0;\n        }\n        else {\n            this.#head = this.#next[head];\n        }\n        this.#keyMap.delete(k);\n        this.#size--;\n        return head;\n    }\n    /**\n     * Check if a key is in the cache, without updating the recency of use.\n     * Will return false if the item is stale, even though it is technically\n     * in the cache.\n     *\n     * Check if a key is in the cache, without updating the recency of\n     * use. Age is updated if {@link LRUCache.OptionsBase.updateAgeOnHas} is set\n     * to `true` in either the options or the constructor.\n     *\n     * Will return `false` if the item is stale, even though it is technically in\n     * the cache. The difference can be determined (if it matters) by using a\n     * `status` argument, and inspecting the `has` field.\n     *\n     * Will not update item age unless\n     * {@link LRUCache.OptionsBase.updateAgeOnHas} is set.\n     */\n    has(k, hasOptions = {}) {\n        const { updateAgeOnHas = this.updateAgeOnHas, status } = hasOptions;\n        const index = this.#keyMap.get(k);\n        if (index !== undefined) {\n            const v = this.#valList[index];\n            if (this.#isBackgroundFetch(v) &&\n                v.__staleWhileFetching === undefined) {\n                return false;\n            }\n            if (!this.#isStale(index)) {\n                if (updateAgeOnHas) {\n                    this.#updateItemAge(index);\n                }\n                if (status) {\n                    status.has = 'hit';\n                    this.#statusTTL(status, index);\n                }\n                return true;\n            }\n            else if (status) {\n                status.has = 'stale';\n                this.#statusTTL(status, index);\n            }\n        }\n        else if (status) {\n            status.has = 'miss';\n        }\n        return false;\n    }\n    /**\n     * Like {@link LRUCache#get} but doesn't update recency or delete stale\n     * items.\n     *\n     * Returns `undefined` if the item is stale, unless\n     * {@link LRUCache.OptionsBase.allowStale} is set.\n     */\n    peek(k, peekOptions = {}) {\n        const { allowStale = this.allowStale } = peekOptions;\n        const index = this.#keyMap.get(k);\n        if (index === undefined ||\n            (!allowStale && this.#isStale(index))) {\n            return;\n        }\n        const v = this.#valList[index];\n        // either stale and allowed, or forcing a refresh of non-stale value\n        return this.#isBackgroundFetch(v) ? v.__staleWhileFetching : v;\n    }\n    #backgroundFetch(k, index, options, context) {\n        const v = index === undefined ? undefined : this.#valList[index];\n        if (this.#isBackgroundFetch(v)) {\n            return v;\n        }\n        const ac = new AC();\n        const { signal } = options;\n        // when/if our AC signals, then stop listening to theirs.\n        signal?.addEventListener('abort', () => ac.abort(signal.reason), {\n            signal: ac.signal,\n        });\n        const fetchOpts = {\n            signal: ac.signal,\n            options,\n            context,\n        };\n        const cb = (v, updateCache = false) => {\n            const { aborted } = ac.signal;\n            const ignoreAbort = options.ignoreFetchAbort && v !== undefined;\n            if (options.status) {\n                if (aborted && !updateCache) {\n                    options.status.fetchAborted = true;\n                    options.status.fetchError = ac.signal.reason;\n                    if (ignoreAbort)\n                        options.status.fetchAbortIgnored = true;\n                }\n                else {\n                    options.status.fetchResolved = true;\n                }\n            }\n            if (aborted && !ignoreAbort && !updateCache) {\n                return fetchFail(ac.signal.reason);\n            }\n            // either we didn't abort, and are still here, or we did, and ignored\n            const bf = p;\n            if (this.#valList[index] === p) {\n                if (v === undefined) {\n                    if (bf.__staleWhileFetching) {\n                        this.#valList[index] = bf.__staleWhileFetching;\n                    }\n                    else {\n                        this.#delete(k, 'fetch');\n                    }\n                }\n                else {\n                    if (options.status)\n                        options.status.fetchUpdated = true;\n                    this.set(k, v, fetchOpts.options);\n                }\n            }\n            return v;\n        };\n        const eb = (er) => {\n            if (options.status) {\n                options.status.fetchRejected = true;\n                options.status.fetchError = er;\n            }\n            return fetchFail(er);\n        };\n        const fetchFail = (er) => {\n            const { aborted } = ac.signal;\n            const allowStaleAborted = aborted && options.allowStaleOnFetchAbort;\n            const allowStale = allowStaleAborted || options.allowStaleOnFetchRejection;\n            const noDelete = allowStale || options.noDeleteOnFetchRejection;\n            const bf = p;\n            if (this.#valList[index] === p) {\n                // if we allow stale on fetch rejections, then we need to ensure that\n                // the stale value is not removed from the cache when the fetch fails.\n                const del = !noDelete || bf.__staleWhileFetching === undefined;\n                if (del) {\n                    this.#delete(k, 'fetch');\n                }\n                else if (!allowStaleAborted) {\n                    // still replace the *promise* with the stale value,\n                    // since we are done with the promise at this point.\n                    // leave it untouched if we're still waiting for an\n                    // aborted background fetch that hasn't yet returned.\n                    this.#valList[index] = bf.__staleWhileFetching;\n                }\n            }\n            if (allowStale) {\n                if (options.status && bf.__staleWhileFetching !== undefined) {\n                    options.status.returnedStale = true;\n                }\n                return bf.__staleWhileFetching;\n            }\n            else if (bf.__returned === bf) {\n                throw er;\n            }\n        };\n        const pcall = (res, rej) => {\n            const fmp = this.#fetchMethod?.(k, v, fetchOpts);\n            if (fmp && fmp instanceof Promise) {\n                fmp.then(v => res(v === undefined ? undefined : v), rej);\n            }\n            // ignored, we go until we finish, regardless.\n            // defer check until we are actually aborting,\n            // so fetchMethod can override.\n            ac.signal.addEventListener('abort', () => {\n                if (!options.ignoreFetchAbort ||\n                    options.allowStaleOnFetchAbort) {\n                    res(undefined);\n                    // when it eventually resolves, update the cache.\n                    if (options.allowStaleOnFetchAbort) {\n                        res = v => cb(v, true);\n                    }\n                }\n            });\n        };\n        if (options.status)\n            options.status.fetchDispatched = true;\n        const p = new Promise(pcall).then(cb, eb);\n        const bf = Object.assign(p, {\n            __abortController: ac,\n            __staleWhileFetching: v,\n            __returned: undefined,\n        });\n        if (index === undefined) {\n            // internal, don't expose status.\n            this.set(k, bf, { ...fetchOpts.options, status: undefined });\n            index = this.#keyMap.get(k);\n        }\n        else {\n            this.#valList[index] = bf;\n        }\n        return bf;\n    }\n    #isBackgroundFetch(p) {\n        if (!this.#hasFetchMethod)\n            return false;\n        const b = p;\n        return (!!b &&\n            b instanceof Promise &&\n            b.hasOwnProperty('__staleWhileFetching') &&\n            b.__abortController instanceof AC);\n    }\n    async fetch(k, fetchOptions = {}) {\n        const { \n        // get options\n        allowStale = this.allowStale, updateAgeOnGet = this.updateAgeOnGet, noDeleteOnStaleGet = this.noDeleteOnStaleGet, \n        // set options\n        ttl = this.ttl, noDisposeOnSet = this.noDisposeOnSet, size = 0, sizeCalculation = this.sizeCalculation, noUpdateTTL = this.noUpdateTTL, \n        // fetch exclusive options\n        noDeleteOnFetchRejection = this.noDeleteOnFetchRejection, allowStaleOnFetchRejection = this.allowStaleOnFetchRejection, ignoreFetchAbort = this.ignoreFetchAbort, allowStaleOnFetchAbort = this.allowStaleOnFetchAbort, context, forceRefresh = false, status, signal, } = fetchOptions;\n        if (!this.#hasFetchMethod) {\n            if (status)\n                status.fetch = 'get';\n            return this.get(k, {\n                allowStale,\n                updateAgeOnGet,\n                noDeleteOnStaleGet,\n                status,\n            });\n        }\n        const options = {\n            allowStale,\n            updateAgeOnGet,\n            noDeleteOnStaleGet,\n            ttl,\n            noDisposeOnSet,\n            size,\n            sizeCalculation,\n            noUpdateTTL,\n            noDeleteOnFetchRejection,\n            allowStaleOnFetchRejection,\n            allowStaleOnFetchAbort,\n            ignoreFetchAbort,\n            status,\n            signal,\n        };\n        let index = this.#keyMap.get(k);\n        if (index === undefined) {\n            if (status)\n                status.fetch = 'miss';\n            const p = this.#backgroundFetch(k, index, options, context);\n            return (p.__returned = p);\n        }\n        else {\n            // in cache, maybe already fetching\n            const v = this.#valList[index];\n            if (this.#isBackgroundFetch(v)) {\n                const stale = allowStale && v.__staleWhileFetching !== undefined;\n                if (status) {\n                    status.fetch = 'inflight';\n                    if (stale)\n                        status.returnedStale = true;\n                }\n                return stale ? v.__staleWhileFetching : (v.__returned = v);\n            }\n            // if we force a refresh, that means do NOT serve the cached value,\n            // unless we are already in the process of refreshing the cache.\n            const isStale = this.#isStale(index);\n            if (!forceRefresh && !isStale) {\n                if (status)\n                    status.fetch = 'hit';\n                this.#moveToTail(index);\n                if (updateAgeOnGet) {\n                    this.#updateItemAge(index);\n                }\n                if (status)\n                    this.#statusTTL(status, index);\n                return v;\n            }\n            // ok, it is stale or a forced refresh, and not already fetching.\n            // refresh the cache.\n            const p = this.#backgroundFetch(k, index, options, context);\n            const hasStale = p.__staleWhileFetching !== undefined;\n            const staleVal = hasStale && allowStale;\n            if (status) {\n                status.fetch = isStale ? 'stale' : 'refresh';\n                if (staleVal && isStale)\n                    status.returnedStale = true;\n            }\n            return staleVal ? p.__staleWhileFetching : (p.__returned = p);\n        }\n    }\n    async forceFetch(k, fetchOptions = {}) {\n        const v = await this.fetch(k, fetchOptions);\n        if (v === undefined)\n            throw new Error('fetch() returned undefined');\n        return v;\n    }\n    memo(k, memoOptions = {}) {\n        const memoMethod = this.#memoMethod;\n        if (!memoMethod) {\n            throw new Error('no memoMethod provided to constructor');\n        }\n        const { context, forceRefresh, ...options } = memoOptions;\n        const v = this.get(k, options);\n        if (!forceRefresh && v !== undefined)\n            return v;\n        const vv = memoMethod(k, v, {\n            options,\n            context,\n        });\n        this.set(k, vv, options);\n        return vv;\n    }\n    /**\n     * Return a value from the cache. Will update the recency of the cache\n     * entry found.\n     *\n     * If the key is not found, get() will return `undefined`.\n     */\n    get(k, getOptions = {}) {\n        const { allowStale = this.allowStale, updateAgeOnGet = this.updateAgeOnGet, noDeleteOnStaleGet = this.noDeleteOnStaleGet, status, } = getOptions;\n        const index = this.#keyMap.get(k);\n        if (index !== undefined) {\n            const value = this.#valList[index];\n            const fetching = this.#isBackgroundFetch(value);\n            if (status)\n                this.#statusTTL(status, index);\n            if (this.#isStale(index)) {\n                if (status)\n                    status.get = 'stale';\n                // delete only if not an in-flight background fetch\n                if (!fetching) {\n                    if (!noDeleteOnStaleGet) {\n                        this.#delete(k, 'expire');\n                    }\n                    if (status && allowStale)\n                        status.returnedStale = true;\n                    return allowStale ? value : undefined;\n                }\n                else {\n                    if (status &&\n                        allowStale &&\n                        value.__staleWhileFetching !== undefined) {\n                        status.returnedStale = true;\n                    }\n                    return allowStale ? value.__staleWhileFetching : undefined;\n                }\n            }\n            else {\n                if (status)\n                    status.get = 'hit';\n                // if we're currently fetching it, we don't actually have it yet\n                // it's not stale, which means this isn't a staleWhileRefetching.\n                // If it's not stale, and fetching, AND has a __staleWhileFetching\n                // value, then that means the user fetched with {forceRefresh:true},\n                // so it's safe to return that value.\n                if (fetching) {\n                    return value.__staleWhileFetching;\n                }\n                this.#moveToTail(index);\n                if (updateAgeOnGet) {\n                    this.#updateItemAge(index);\n                }\n                return value;\n            }\n        }\n        else if (status) {\n            status.get = 'miss';\n        }\n    }\n    #connect(p, n) {\n        this.#prev[n] = p;\n        this.#next[p] = n;\n    }\n    #moveToTail(index) {\n        // if tail already, nothing to do\n        // if head, move head to next[index]\n        // else\n        //   move next[prev[index]] to next[index] (head has no prev)\n        //   move prev[next[index]] to prev[index]\n        // prev[index] = tail\n        // next[tail] = index\n        // tail = index\n        if (index !== this.#tail) {\n            if (index === this.#head) {\n                this.#head = this.#next[index];\n            }\n            else {\n                this.#connect(this.#prev[index], this.#next[index]);\n            }\n            this.#connect(this.#tail, index);\n            this.#tail = index;\n        }\n    }\n    /**\n     * Deletes a key out of the cache.\n     *\n     * Returns true if the key was deleted, false otherwise.\n     */\n    delete(k) {\n        return this.#delete(k, 'delete');\n    }\n    #delete(k, reason) {\n        let deleted = false;\n        if (this.#size !== 0) {\n            const index = this.#keyMap.get(k);\n            if (index !== undefined) {\n                deleted = true;\n                if (this.#size === 1) {\n                    this.#clear(reason);\n                }\n                else {\n                    this.#removeItemSize(index);\n                    const v = this.#valList[index];\n                    if (this.#isBackgroundFetch(v)) {\n                        v.__abortController.abort(new Error('deleted'));\n                    }\n                    else if (this.#hasDispose || this.#hasDisposeAfter) {\n                        if (this.#hasDispose) {\n                            this.#dispose?.(v, k, reason);\n                        }\n                        if (this.#hasDisposeAfter) {\n                            this.#disposed?.push([v, k, reason]);\n                        }\n                    }\n                    this.#keyMap.delete(k);\n                    this.#keyList[index] = undefined;\n                    this.#valList[index] = undefined;\n                    if (index === this.#tail) {\n                        this.#tail = this.#prev[index];\n                    }\n                    else if (index === this.#head) {\n                        this.#head = this.#next[index];\n                    }\n                    else {\n                        const pi = this.#prev[index];\n                        this.#next[pi] = this.#next[index];\n                        const ni = this.#next[index];\n                        this.#prev[ni] = this.#prev[index];\n                    }\n                    this.#size--;\n                    this.#free.push(index);\n                }\n            }\n        }\n        if (this.#hasDisposeAfter && this.#disposed?.length) {\n            const dt = this.#disposed;\n            let task;\n            while ((task = dt?.shift())) {\n                this.#disposeAfter?.(...task);\n            }\n        }\n        return deleted;\n    }\n    /**\n     * Clear the cache entirely, throwing away all values.\n     */\n    clear() {\n        return this.#clear('delete');\n    }\n    #clear(reason) {\n        for (const index of this.#rindexes({ allowStale: true })) {\n            const v = this.#valList[index];\n            if (this.#isBackgroundFetch(v)) {\n                v.__abortController.abort(new Error('deleted'));\n            }\n            else {\n                const k = this.#keyList[index];\n                if (this.#hasDispose) {\n                    this.#dispose?.(v, k, reason);\n                }\n                if (this.#hasDisposeAfter) {\n                    this.#disposed?.push([v, k, reason]);\n                }\n            }\n        }\n        this.#keyMap.clear();\n        this.#valList.fill(undefined);\n        this.#keyList.fill(undefined);\n        if (this.#ttls && this.#starts) {\n            this.#ttls.fill(0);\n            this.#starts.fill(0);\n        }\n        if (this.#sizes) {\n            this.#sizes.fill(0);\n        }\n        this.#head = 0;\n        this.#tail = 0;\n        this.#free.length = 0;\n        this.#calculatedSize = 0;\n        this.#size = 0;\n        if (this.#hasDisposeAfter && this.#disposed) {\n            const dt = this.#disposed;\n            let task;\n            while ((task = dt?.shift())) {\n                this.#disposeAfter?.(...task);\n            }\n        }\n    }\n}\n//# sourceMappingURL=index.js.map","import { flatten } from 'lodash';\nimport { LRUCache } from 'lru-cache';\n\nimport { AbstractQuery, getDefaultTimeRange, KeyValue, LanguageProvider, ScopedVars, TimeRange } from '@grafana/data';\nimport { BackendSrvRequest, config } from '@grafana/runtime';\n\nimport { DEFAULT_MAX_LINES_SAMPLE, LokiDatasource } from './datasource';\nimport { abstractQueryToExpr, mapAbstractOperatorsToOp, processLabels } from './languageUtils';\nimport { getStreamSelectorsFromQuery } from './queryUtils';\nimport { buildVisualQueryFromString } from './querybuilder/parsing';\nimport {\n  extractLabelKeysFromDataFrame,\n  extractLogParserFromDataFrame,\n  extractUnwrapLabelKeysFromDataFrame,\n} from './responseUtils';\nimport { DetectedFieldsResult, LabelType, LokiQuery, LokiQueryType, ParserAndLabelKeysResult } from './types';\n\nconst NS_IN_MS = 1000000;\nconst EMPTY_SELECTOR = '{}';\nconst HIDDEN_LABELS = ['__aggregated_metric__', '__tenant_id__', '__stream_shard__'];\n\nexport default class LokiLanguageProvider extends LanguageProvider {\n  labelKeys: string[];\n  started = false;\n  startedTimeRange?: TimeRange;\n  datasource: LokiDatasource;\n\n  /**\n   *  Cache for labels of series. This is bit simplistic in the sense that it just counts responses each as a 1 and does\n   *  not account for different size of a response. If that is needed a `length` function can be added in the options.\n   *  10 as a max size is totally arbitrary right now.\n   */\n  private seriesCache = new LRUCache<string, Record<string, string[]>>({ max: 10 });\n  private labelsCache = new LRUCache<string, string[]>({ max: 10 });\n  private detectedFieldValuesCache = new LRUCache<string, string[]>({ max: 10 });\n  private labelsPromisesCache = new LRUCache<string, Promise<string[]>>({ max: 10 });\n  private detectedLabelValuesPromisesCache = new LRUCache<string, Promise<string[]>>({ max: 10 });\n\n  constructor(datasource: LokiDatasource, initialValues?: any) {\n    super();\n\n    this.datasource = datasource;\n    this.labelKeys = [];\n\n    Object.assign(this, initialValues);\n  }\n\n  request = async (\n    url: string,\n    params?: Record<string, string | number>,\n    throwError?: boolean,\n    requestOptions?: Partial<BackendSrvRequest>\n  ) => {\n    try {\n      return await this.datasource.metadataRequest(url, params, requestOptions);\n    } catch (error) {\n      if (throwError) {\n        throw error;\n      } else {\n        console.error(error);\n      }\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Initialize the language provider by fetching set of labels.\n   */\n  start = (timeRange?: TimeRange) => {\n    const range = timeRange ?? this.getDefaultTimeRange();\n    const newRangeParams = this.datasource.getTimeRangeParams(range);\n    const prevRangeParams = this.startedTimeRange ? this.datasource.getTimeRangeParams(this.startedTimeRange) : null;\n    // refetch labels if either there's not already a start task or the time range has changed\n    if (\n      !this.startTask ||\n      !prevRangeParams ||\n      newRangeParams.start !== prevRangeParams.start ||\n      newRangeParams.end !== prevRangeParams.end\n    ) {\n      this.startedTimeRange = range;\n      this.startTask = this.fetchLabels({ timeRange: range }).then(() => {\n        this.started = true;\n        return [];\n      });\n    }\n\n    return this.startTask;\n  };\n\n  /**\n   * Returns the label keys that have been fetched.\n   * If labels have not been fetched yet, it will return an empty array.\n   * For updated labels (which should not happen often), use fetchLabels.\n   * @todo It is quite complicated to know when to use fetchLabels and when to use getLabelKeys.\n   * We should consider simplifying this and use caching in the same way as with seriesCache and labelsCache\n   * and just always use fetchLabels.\n   * Caching should be thought out properly, so we are not fetching this often, as labelKeys should not be changing often.\n   *\n   * @returns {string[]} An array of label keys or an empty array if labels have not been fetched.\n   */\n  getLabelKeys(): string[] {\n    return this.labelKeys;\n  }\n\n  importFromAbstractQuery(labelBasedQuery: AbstractQuery): LokiQuery {\n    return {\n      refId: labelBasedQuery.refId,\n      expr: abstractQueryToExpr(labelBasedQuery),\n      queryType: LokiQueryType.Range,\n    };\n  }\n\n  exportToAbstractQuery(query: LokiQuery): AbstractQuery {\n    if (!query.expr || query.expr.length === 0) {\n      return { refId: query.refId, labelMatchers: [] };\n    }\n    const streamSelectors = getStreamSelectorsFromQuery(query.expr);\n\n    const labelMatchers = streamSelectors.map((streamSelector) => {\n      const visualQuery = buildVisualQueryFromString(streamSelector).query;\n      const matchers = visualQuery.labels.map((label) => {\n        return {\n          name: label.label,\n          value: label.value,\n          operator: mapAbstractOperatorsToOp[label.op],\n        };\n      });\n      return matchers;\n    });\n\n    return {\n      refId: query.refId,\n      labelMatchers: flatten(labelMatchers),\n    };\n  }\n\n  /**\n   * Fetch label keys using the best applicable endpoint.\n   *\n   * This asynchronous function returns all available label keys from the data source.\n   * It returns a promise that resolves to an array of strings containing the label keys.\n   *\n   * @param options - (Optional) An object containing additional options.\n   * @param options.streamSelector - (Optional) The stream selector to filter label keys. If not provided, all label keys are fetched.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label keys. If not provided, the default time range is used.\n   * @returns A promise containing an array of label keys.\n   * @throws An error if the fetch operation fails.\n   */\n  async fetchLabels(options?: { streamSelector?: string; timeRange?: TimeRange }): Promise<string[]> {\n    // We'll default to use `/labels`. If the flag is disabled, and there's a streamSelector, we'll use the series endpoint.\n    if (config.featureToggles.lokiLabelNamesQueryApi || !options?.streamSelector) {\n      return this.fetchLabelsByLabelsEndpoint(options);\n    } else {\n      const data = await this.fetchSeriesLabels(options.streamSelector, { timeRange: options.timeRange });\n      return Object.keys(data ?? {});\n    }\n  }\n\n  /**\n   * Fetch all label keys\n   * This asynchronous function returns all available label keys from the data source.\n   * It returns a promise that resolves to an array of strings containing the label keys.\n   *\n   * @param options - (Optional) An object containing additional options - currently only time range.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label keys. If not provided, the default time range is used.\n   * @returns A promise containing an array of label keys.\n   * @throws An error if the fetch operation fails.\n   */\n  private async fetchLabelsByLabelsEndpoint(options?: {\n    streamSelector?: string;\n    timeRange?: TimeRange;\n  }): Promise<string[]> {\n    const url = 'labels';\n    const range = options?.timeRange ?? this.getDefaultTimeRange();\n    const { start, end } = this.datasource.getTimeRangeParams(range);\n    const params: Record<string, string | number> = { start, end };\n    if (options?.streamSelector && options?.streamSelector !== EMPTY_SELECTOR) {\n      params['query'] = options.streamSelector;\n    }\n    const res = await this.request(url, params);\n    if (Array.isArray(res)) {\n      const labels = Array.from(new Set(res))\n        .slice()\n        .sort()\n        .filter((label: string) => HIDDEN_LABELS.includes(label) === false);\n      this.labelKeys = labels;\n      return this.labelKeys;\n    }\n\n    return [];\n  }\n\n  /**\n   * Fetch series labels for a selector\n   *\n   * This method fetches labels for a given stream selector, such as `{job=\"grafana\"}`.\n   * It returns a promise that resolves to a record mapping label names to their corresponding values.\n   *\n   * @param streamSelector - The stream selector for which you want to retrieve labels.\n   * @param options - (Optional) An object containing additional options - currently only time range.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label keys. If not provided, the default time range is used.\n   * @returns A promise containing a record of label names and their values.\n   * @throws An error if the fetch operation fails.\n   */\n  fetchSeriesLabels = async (\n    streamSelector: string,\n    options?: { timeRange?: TimeRange }\n  ): Promise<Record<string, string[]>> => {\n    const interpolatedMatch = this.datasource.interpolateString(streamSelector);\n    const url = 'series';\n    const range = options?.timeRange ?? this.getDefaultTimeRange();\n    const { start, end } = this.datasource.getTimeRangeParams(range);\n\n    const cacheKey = this.generateCacheKey(url, start, end, interpolatedMatch);\n    let value = this.seriesCache.get(cacheKey);\n    if (!value) {\n      const params = { 'match[]': interpolatedMatch, start, end };\n      const data = await this.request(url, params);\n      if (!Array.isArray(data)) {\n        return {};\n      }\n      const { values } = processLabels(data);\n      value = values;\n      this.seriesCache.set(cacheKey, value);\n    }\n    return value;\n  };\n\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   * @param match\n   * @param streamSelector - The stream selector for which you want to retrieve labels.\n   * @param options - (Optional) An object containing additional options.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label keys. If not provided, the default time range is used.\n   * @returns A promise containing array with records of label names and their value.\n   */\n  fetchSeries = async (match: string, options?: { timeRange?: TimeRange }): Promise<Array<Record<string, string>>> => {\n    const url = 'series';\n    const range = options?.timeRange ?? this.getDefaultTimeRange();\n    const { start, end } = this.datasource.getTimeRangeParams(range);\n    const params = { 'match[]': match, start, end };\n    return await this.request(url, params);\n  };\n\n  // Cache key is a bit different here. We round up to a minute the intervals.\n  // The rounding may seem strange but makes relative intervals like now-1h less prone to need separate request every\n  // millisecond while still actually getting all the keys for the correct interval. This still can create problems\n  // when user does not the newest values for a minute if already cached.\n  private generateCacheKey(url: string, start: number, end: number, param: string): string {\n    return [url, this.roundTime(start), this.roundTime(end), param].join();\n  }\n\n  // Round nanoseconds epoch to nearest 5 minute interval\n  private roundTime(nanoseconds: number): number {\n    return nanoseconds ? Math.floor(nanoseconds / NS_IN_MS / 1000 / 60 / 5) : 0;\n  }\n\n  async fetchDetectedFields(\n    queryOptions: {\n      expr: string;\n      timeRange?: TimeRange;\n      limit?: number;\n      scopedVars?: ScopedVars;\n    },\n    requestOptions?: Partial<BackendSrvRequest>\n  ): Promise<DetectedFieldsResult | Error> {\n    const interpolatedExpr =\n      queryOptions.expr && queryOptions.expr !== EMPTY_SELECTOR\n        ? this.datasource.interpolateString(queryOptions.expr, queryOptions.scopedVars)\n        : undefined;\n\n    if (!interpolatedExpr) {\n      throw new Error('fetchDetectedFields requires query expression');\n    }\n\n    const url = `detected_fields`;\n    const range = queryOptions?.timeRange ?? this.getDefaultTimeRange();\n    const rangeParams = this.datasource.getTimeRangeParams(range);\n    const { start, end } = rangeParams;\n    const params: KeyValue<string | number> = { start, end, limit: queryOptions?.limit ?? 1000 };\n    params.query = interpolatedExpr;\n\n    return new Promise(async (resolve, reject) => {\n      try {\n        const data = await this.request(url, params, true, requestOptions);\n        resolve(data);\n      } catch (error) {\n        console.error('error', error);\n        reject(error);\n      }\n    });\n  }\n\n  async fetchDetectedFieldValues(\n    labelName: string,\n    queryOptions?: {\n      expr?: string;\n      timeRange?: TimeRange;\n      limit?: number;\n      scopedVars?: ScopedVars;\n      throwError?: boolean;\n    },\n    requestOptions?: Partial<BackendSrvRequest>\n  ): Promise<string[] | Error> {\n    // This function was named poorly, it's not detected label values, it's detected field values! :facepalm\n    return this.fetchDetectedLabelValues(labelName, queryOptions, requestOptions);\n  }\n\n  /**\n   * @deprecated: use fetchDetectedFieldValues instead\n   */\n  async fetchDetectedLabelValues(\n    labelName: string,\n    queryOptions?: {\n      expr?: string;\n      timeRange?: TimeRange;\n      limit?: number;\n      scopedVars?: ScopedVars;\n      throwError?: boolean;\n    },\n    requestOptions?: Partial<BackendSrvRequest>\n  ): Promise<string[] | Error> {\n    const label = encodeURIComponent(this.datasource.interpolateString(labelName));\n\n    const interpolatedExpr =\n      queryOptions?.expr && queryOptions.expr !== EMPTY_SELECTOR\n        ? this.datasource.interpolateString(queryOptions.expr, queryOptions.scopedVars)\n        : undefined;\n\n    const url = `detected_field/${label}/values`;\n    const range = queryOptions?.timeRange ?? this.getDefaultTimeRange();\n    const rangeParams = this.datasource.getTimeRangeParams(range);\n    const { start, end } = rangeParams;\n    const params: KeyValue<string | number> = { start, end, limit: queryOptions?.limit ?? 1000 };\n    let paramCacheKey = label;\n\n    if (interpolatedExpr) {\n      params.query = interpolatedExpr;\n      paramCacheKey += interpolatedExpr;\n    }\n\n    const cacheKey = this.generateCacheKey(url, start, end, paramCacheKey);\n\n    // Values in cache, return\n    const labelValues = this.detectedFieldValuesCache.get(cacheKey);\n    if (labelValues) {\n      return labelValues;\n    }\n\n    // Promise in cache, return\n    let labelValuesPromise = this.detectedLabelValuesPromisesCache.get(cacheKey);\n    if (labelValuesPromise) {\n      return labelValuesPromise;\n    }\n\n    labelValuesPromise = new Promise(async (resolve, reject) => {\n      try {\n        const data = await this.request(url, params, queryOptions?.throwError, requestOptions);\n        if (Array.isArray(data)) {\n          const labelValues = data.slice().sort();\n          this.detectedFieldValuesCache.set(cacheKey, labelValues);\n          this.detectedLabelValuesPromisesCache.delete(cacheKey);\n          resolve(labelValues);\n        }\n      } catch (error) {\n        if (queryOptions?.throwError) {\n          reject(error);\n        } else {\n          console.error(error);\n          resolve([]);\n        }\n      }\n    });\n    this.detectedLabelValuesPromisesCache.set(cacheKey, labelValuesPromise);\n\n    return labelValuesPromise;\n  }\n\n  /**\n   * Fetch label values\n   *\n   * This asynchronous function fetches values associated with a specified label name.\n   * It returns a promise that resolves to an array of strings containing the label values.\n   *\n   * @param labelName - The name of the label for which you want to retrieve values.\n   * @param options - (Optional) An object containing additional options.\n   * @param options.streamSelector - (Optional) The stream selector to filter label values. If not provided, all label values are fetched.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label values. If not provided, the default time range is used.\n   * @returns A promise containing an array of label values.\n   * @throws An error if the fetch operation fails.\n   */\n  async fetchLabelValues(\n    labelName: string,\n    options?: { streamSelector?: string; timeRange?: TimeRange }\n  ): Promise<string[]> {\n    const label = encodeURIComponent(this.datasource.interpolateString(labelName));\n    // Loki doesn't allow empty streamSelector {}, so we should not send it.\n    const streamParam =\n      options?.streamSelector && options.streamSelector !== EMPTY_SELECTOR\n        ? this.datasource.interpolateString(options.streamSelector)\n        : undefined;\n\n    const url = `label/${label}/values`;\n    const range = options?.timeRange ?? this.getDefaultTimeRange();\n    const rangeParams = this.datasource.getTimeRangeParams(range);\n    const { start, end } = rangeParams;\n    const params: KeyValue<string | number> = { start, end };\n    let paramCacheKey = label;\n\n    if (streamParam) {\n      params.query = streamParam;\n      paramCacheKey += streamParam;\n    }\n\n    const cacheKey = this.generateCacheKey(url, start, end, paramCacheKey);\n\n    // Values in cache, return\n    const labelValues = this.labelsCache.get(cacheKey);\n    if (labelValues) {\n      return labelValues;\n    }\n\n    // Promise in cache, return\n    let labelValuesPromise = this.labelsPromisesCache.get(cacheKey);\n    if (labelValuesPromise) {\n      return labelValuesPromise;\n    }\n\n    labelValuesPromise = new Promise(async (resolve) => {\n      try {\n        const data = await this.request(url, params);\n        if (Array.isArray(data)) {\n          const labelValues = data.slice().sort();\n          this.labelsCache.set(cacheKey, labelValues);\n          this.labelsPromisesCache.delete(cacheKey);\n          resolve(labelValues);\n        }\n      } catch (error) {\n        console.error(error);\n        resolve([]);\n      }\n    });\n    this.labelsPromisesCache.set(cacheKey, labelValuesPromise);\n    return labelValuesPromise;\n  }\n\n  /**\n   * Get parser and label keys for a selector\n   *\n   * This asynchronous function is used to fetch parsers and label keys for a selected log stream based on sampled lines.\n   * It returns a promise that resolves to an object with the following properties:\n   *\n   * - `extractedLabelKeys`: An array of available label keys associated with the log stream.\n   * - `hasJSON`: A boolean indicating whether JSON parsing is available for the stream.\n   * - `hasLogfmt`: A boolean indicating whether Logfmt parsing is available for the stream.\n   * - `hasPack`: A boolean indicating whether Pack parsing is available for the stream.\n   * - `unwrapLabelKeys`: An array of label keys that can be used for unwrapping log data.\n   *\n   * @param streamSelector - The selector for the log stream you want to analyze.\n   * @param options - (Optional) An object containing additional options.\n   * @param options.maxLines - (Optional) The number of log lines requested when determining parsers and label keys.\n   * @param options.timeRange - (Optional) The time range for which you want to retrieve label keys. If not provided, the default time range is used.\n   * Smaller maxLines is recommended for improved query performance. The default count is 10.\n   * @returns A promise containing an object with parser and label key information.\n   * @throws An error if the fetch operation fails.\n   */\n  async getParserAndLabelKeys(\n    streamSelector: string,\n    options?: { maxLines?: number; timeRange?: TimeRange }\n  ): Promise<ParserAndLabelKeysResult> {\n    const empty = {\n      extractedLabelKeys: [],\n      structuredMetadataKeys: [],\n      unwrapLabelKeys: [],\n      hasJSON: false,\n      hasLogfmt: false,\n      hasPack: false,\n    };\n\n    const series = await this.datasource.getDataSamples(\n      {\n        expr: streamSelector,\n        refId: 'data-samples',\n        maxLines: options?.maxLines || DEFAULT_MAX_LINES_SAMPLE,\n      },\n      options?.timeRange ?? this.getDefaultTimeRange()\n    );\n\n    if (!series.length) {\n      return empty;\n    }\n\n    const { hasLogfmt, hasJSON, hasPack } = extractLogParserFromDataFrame(series[0]);\n\n    return {\n      extractedLabelKeys: [\n        ...extractLabelKeysFromDataFrame(series[0], LabelType.Indexed),\n        ...extractLabelKeysFromDataFrame(series[0], LabelType.Parsed),\n      ],\n      structuredMetadataKeys: extractLabelKeysFromDataFrame(series[0], LabelType.StructuredMetadata),\n      unwrapLabelKeys: extractUnwrapLabelKeysFromDataFrame(series[0]),\n      hasJSON,\n      hasPack,\n      hasLogfmt,\n    };\n  }\n\n  /**\n   * Get the default time range\n   *\n   * @returns {TimeRange} The default time range\n   */\n  private getDefaultTimeRange(): TimeRange {\n    return getDefaultTimeRange();\n  }\n}\n","import { __assign, __extends } from \"tslib\";\nimport { Subject, AnonymousSubject } from '../../Subject';\nimport { Subscriber } from '../../Subscriber';\nimport { Observable } from '../../Observable';\nimport { Subscription } from '../../Subscription';\nimport { ReplaySubject } from '../../ReplaySubject';\nvar DEFAULT_WEBSOCKET_CONFIG = {\n    url: '',\n    deserializer: function (e) { return JSON.parse(e.data); },\n    serializer: function (value) { return JSON.stringify(value); },\n};\nvar WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT = 'WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }';\nvar WebSocketSubject = (function (_super) {\n    __extends(WebSocketSubject, _super);\n    function WebSocketSubject(urlConfigOrSource, destination) {\n        var _this = _super.call(this) || this;\n        _this._socket = null;\n        if (urlConfigOrSource instanceof Observable) {\n            _this.destination = destination;\n            _this.source = urlConfigOrSource;\n        }\n        else {\n            var config = (_this._config = __assign({}, DEFAULT_WEBSOCKET_CONFIG));\n            _this._output = new Subject();\n            if (typeof urlConfigOrSource === 'string') {\n                config.url = urlConfigOrSource;\n            }\n            else {\n                for (var key in urlConfigOrSource) {\n                    if (urlConfigOrSource.hasOwnProperty(key)) {\n                        config[key] = urlConfigOrSource[key];\n                    }\n                }\n            }\n            if (!config.WebSocketCtor && WebSocket) {\n                config.WebSocketCtor = WebSocket;\n            }\n            else if (!config.WebSocketCtor) {\n                throw new Error('no WebSocket constructor can be found');\n            }\n            _this.destination = new ReplaySubject();\n        }\n        return _this;\n    }\n    WebSocketSubject.prototype.lift = function (operator) {\n        var sock = new WebSocketSubject(this._config, this.destination);\n        sock.operator = operator;\n        sock.source = this;\n        return sock;\n    };\n    WebSocketSubject.prototype._resetState = function () {\n        this._socket = null;\n        if (!this.source) {\n            this.destination = new ReplaySubject();\n        }\n        this._output = new Subject();\n    };\n    WebSocketSubject.prototype.multiplex = function (subMsg, unsubMsg, messageFilter) {\n        var self = this;\n        return new Observable(function (observer) {\n            try {\n                self.next(subMsg());\n            }\n            catch (err) {\n                observer.error(err);\n            }\n            var subscription = self.subscribe({\n                next: function (x) {\n                    try {\n                        if (messageFilter(x)) {\n                            observer.next(x);\n                        }\n                    }\n                    catch (err) {\n                        observer.error(err);\n                    }\n                },\n                error: function (err) { return observer.error(err); },\n                complete: function () { return observer.complete(); },\n            });\n            return function () {\n                try {\n                    self.next(unsubMsg());\n                }\n                catch (err) {\n                    observer.error(err);\n                }\n                subscription.unsubscribe();\n            };\n        });\n    };\n    WebSocketSubject.prototype._connectSocket = function () {\n        var _this = this;\n        var _a = this._config, WebSocketCtor = _a.WebSocketCtor, protocol = _a.protocol, url = _a.url, binaryType = _a.binaryType;\n        var observer = this._output;\n        var socket = null;\n        try {\n            socket = protocol ? new WebSocketCtor(url, protocol) : new WebSocketCtor(url);\n            this._socket = socket;\n            if (binaryType) {\n                this._socket.binaryType = binaryType;\n            }\n        }\n        catch (e) {\n            observer.error(e);\n            return;\n        }\n        var subscription = new Subscription(function () {\n            _this._socket = null;\n            if (socket && socket.readyState === 1) {\n                socket.close();\n            }\n        });\n        socket.onopen = function (evt) {\n            var _socket = _this._socket;\n            if (!_socket) {\n                socket.close();\n                _this._resetState();\n                return;\n            }\n            var openObserver = _this._config.openObserver;\n            if (openObserver) {\n                openObserver.next(evt);\n            }\n            var queue = _this.destination;\n            _this.destination = Subscriber.create(function (x) {\n                if (socket.readyState === 1) {\n                    try {\n                        var serializer = _this._config.serializer;\n                        socket.send(serializer(x));\n                    }\n                    catch (e) {\n                        _this.destination.error(e);\n                    }\n                }\n            }, function (err) {\n                var closingObserver = _this._config.closingObserver;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                if (err && err.code) {\n                    socket.close(err.code, err.reason);\n                }\n                else {\n                    observer.error(new TypeError(WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT));\n                }\n                _this._resetState();\n            }, function () {\n                var closingObserver = _this._config.closingObserver;\n                if (closingObserver) {\n                    closingObserver.next(undefined);\n                }\n                socket.close();\n                _this._resetState();\n            });\n            if (queue && queue instanceof ReplaySubject) {\n                subscription.add(queue.subscribe(_this.destination));\n            }\n        };\n        socket.onerror = function (e) {\n            _this._resetState();\n            observer.error(e);\n        };\n        socket.onclose = function (e) {\n            if (socket === _this._socket) {\n                _this._resetState();\n            }\n            var closeObserver = _this._config.closeObserver;\n            if (closeObserver) {\n                closeObserver.next(e);\n            }\n            if (e.wasClean) {\n                observer.complete();\n            }\n            else {\n                observer.error(e);\n            }\n        };\n        socket.onmessage = function (e) {\n            try {\n                var deserializer = _this._config.deserializer;\n                observer.next(deserializer(e));\n            }\n            catch (err) {\n                observer.error(err);\n            }\n        };\n    };\n    WebSocketSubject.prototype._subscribe = function (subscriber) {\n        var _this = this;\n        var source = this.source;\n        if (source) {\n            return source.subscribe(subscriber);\n        }\n        if (!this._socket) {\n            this._connectSocket();\n        }\n        this._output.subscribe(subscriber);\n        subscriber.add(function () {\n            var _socket = _this._socket;\n            if (_this._output.observers.length === 0) {\n                if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n                    _socket.close();\n                }\n                _this._resetState();\n            }\n        });\n        return subscriber;\n    };\n    WebSocketSubject.prototype.unsubscribe = function () {\n        var _socket = this._socket;\n        if (_socket && (_socket.readyState === 1 || _socket.readyState === 0)) {\n            _socket.close();\n        }\n        this._resetState();\n        _super.prototype.unsubscribe.call(this);\n    };\n    return WebSocketSubject;\n}(AnonymousSubject));\nexport { WebSocketSubject };\n//# sourceMappingURL=WebSocketSubject.js.map","import { WebSocketSubject } from './WebSocketSubject';\nexport function webSocket(urlConfigOrSource) {\n    return new WebSocketSubject(urlConfigOrSource);\n}\n//# sourceMappingURL=webSocket.js.map","function f(s, x, y, z) {\n    switch (s) {\n        case 0:\n            return (x & y) ^ (~x & z);\n        case 1:\n            return x ^ y ^ z;\n        case 2:\n            return (x & y) ^ (x & z) ^ (y & z);\n        case 3:\n            return x ^ y ^ z;\n    }\n}\nfunction ROTL(x, n) {\n    return (x << n) | (x >>> (32 - n));\n}\nfunction sha1(bytes) {\n    const K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n    const H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n    const newBytes = new Uint8Array(bytes.length + 1);\n    newBytes.set(bytes);\n    newBytes[bytes.length] = 0x80;\n    bytes = newBytes;\n    const l = bytes.length / 4 + 2;\n    const N = Math.ceil(l / 16);\n    const M = new Array(N);\n    for (let i = 0; i < N; ++i) {\n        const arr = new Uint32Array(16);\n        for (let j = 0; j < 16; ++j) {\n            arr[j] =\n                (bytes[i * 64 + j * 4] << 24) |\n                    (bytes[i * 64 + j * 4 + 1] << 16) |\n                    (bytes[i * 64 + j * 4 + 2] << 8) |\n                    bytes[i * 64 + j * 4 + 3];\n        }\n        M[i] = arr;\n    }\n    M[N - 1][14] = ((bytes.length - 1) * 8) / Math.pow(2, 32);\n    M[N - 1][14] = Math.floor(M[N - 1][14]);\n    M[N - 1][15] = ((bytes.length - 1) * 8) & 0xffffffff;\n    for (let i = 0; i < N; ++i) {\n        const W = new Uint32Array(80);\n        for (let t = 0; t < 16; ++t) {\n            W[t] = M[i][t];\n        }\n        for (let t = 16; t < 80; ++t) {\n            W[t] = ROTL(W[t - 3] ^ W[t - 8] ^ W[t - 14] ^ W[t - 16], 1);\n        }\n        let a = H[0];\n        let b = H[1];\n        let c = H[2];\n        let d = H[3];\n        let e = H[4];\n        for (let t = 0; t < 80; ++t) {\n            const s = Math.floor(t / 20);\n            const T = (ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[t]) >>> 0;\n            e = d;\n            d = c;\n            c = ROTL(b, 30) >>> 0;\n            b = a;\n            a = T;\n        }\n        H[0] = (H[0] + a) >>> 0;\n        H[1] = (H[1] + b) >>> 0;\n        H[2] = (H[2] + c) >>> 0;\n        H[3] = (H[3] + d) >>> 0;\n        H[4] = (H[4] + e) >>> 0;\n    }\n    return Uint8Array.of(H[0] >> 24, H[0] >> 16, H[0] >> 8, H[0], H[1] >> 24, H[1] >> 16, H[1] >> 8, H[1], H[2] >> 24, H[2] >> 16, H[2] >> 8, H[2], H[3] >> 24, H[3] >> 16, H[3] >> 8, H[3], H[4] >> 24, H[4] >> 16, H[4] >> 8, H[4]);\n}\nexport default sha1;\n","import validate from './validate.js';\nfunction parse(uuid) {\n    if (!validate(uuid)) {\n        throw TypeError('Invalid UUID');\n    }\n    let v;\n    return Uint8Array.of((v = parseInt(uuid.slice(0, 8), 16)) >>> 24, (v >>> 16) & 0xff, (v >>> 8) & 0xff, v & 0xff, (v = parseInt(uuid.slice(9, 13), 16)) >>> 8, v & 0xff, (v = parseInt(uuid.slice(14, 18), 16)) >>> 8, v & 0xff, (v = parseInt(uuid.slice(19, 23), 16)) >>> 8, v & 0xff, ((v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000) & 0xff, (v / 0x100000000) & 0xff, (v >>> 24) & 0xff, (v >>> 16) & 0xff, (v >>> 8) & 0xff, v & 0xff);\n}\nexport default parse;\n","import parse from './parse.js';\nimport { unsafeStringify } from './stringify.js';\nexport function stringToBytes(str) {\n    str = unescape(encodeURIComponent(str));\n    const bytes = new Uint8Array(str.length);\n    for (let i = 0; i < str.length; ++i) {\n        bytes[i] = str.charCodeAt(i);\n    }\n    return bytes;\n}\nexport const DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport const URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function v35(version, hash, value, namespace, buf, offset) {\n    const valueBytes = typeof value === 'string' ? stringToBytes(value) : value;\n    const namespaceBytes = typeof namespace === 'string' ? parse(namespace) : namespace;\n    if (typeof namespace === 'string') {\n        namespace = parse(namespace);\n    }\n    if (namespace?.length !== 16) {\n        throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    }\n    let bytes = new Uint8Array(16 + valueBytes.length);\n    bytes.set(namespaceBytes);\n    bytes.set(valueBytes, namespaceBytes.length);\n    bytes = hash(bytes);\n    bytes[6] = (bytes[6] & 0x0f) | version;\n    bytes[8] = (bytes[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = bytes[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(bytes);\n}\n","import sha1 from './sha1.js';\nimport v35, { DNS, URL } from './v35.js';\nexport { DNS, URL } from './v35.js';\nfunction v5(value, namespace, buf, offset) {\n    return v35(0x50, sha1, value, namespace, buf, offset);\n}\nv5.DNS = DNS;\nv5.URL = URL;\nexport default v5;\n","import { v5 as uuidv5 } from 'uuid';\n\nimport { MutableDataFrame } from '@grafana/data';\n\nimport { LokiStreamResult, LokiTailResponse } from './types';\n\nconst UUID_NAMESPACE = '6ec946da-0f49-47a8-983a-1d76d17e7c92';\n\n/**\n * Transform LokiResponse data and appends it to MutableDataFrame. Used for streaming where the dataFrame can be\n * a CircularDataFrame creating a fixed size rolling buffer.\n * TODO: Probably could be unified with the logStreamToDataFrame function.\n * @param response\n * @param data Needs to have ts, line, labels, id as fields\n */\nexport function appendResponseToBufferedData(response: LokiTailResponse, data: MutableDataFrame) {\n  // Should we do anything with: response.dropped_entries?\n\n  const streams: LokiStreamResult[] = response.streams;\n  if (!streams || !streams.length) {\n    return;\n  }\n\n  const tsField = data.fields[0];\n  const lineField = data.fields[1];\n  const idField = data.fields[2];\n\n  // We are comparing used ids only within the received stream. This could be a problem if the same line + labels + nanosecond timestamp came in 2 separate batches.\n  // As this is very unlikely, and the result would only affect live-tailing css animation we have decided to not compare all received uids from data param as this would slow down processing.\n  const usedUids: Record<string, number> = {};\n\n  for (const stream of streams) {\n    // Find unique labels\n    const allLabelsString = Object.entries(stream.stream)\n      .map(([key, val]) => `${key}=\"${val}\"`)\n      .sort()\n      .join('');\n\n    // Add each line\n    for (const [ts, line] of stream.values) {\n      tsField.values.push(new Date(parseInt(ts.slice(0, -6), 10)).toISOString());\n      lineField.values.push(line);\n      idField.values.push(createUid(ts, allLabelsString, line, usedUids, data.refId));\n    }\n  }\n}\n\nfunction createUid(\n  ts: string,\n  labelsString: string,\n  line: string,\n  usedUids: Record<string, number>,\n  refId?: string\n): string {\n  // Generate id as hashed nanosecond timestamp, labels and line (this does not have to be unique)\n  let id = uuidv5(`${ts}_${labelsString}_${line}`, UUID_NAMESPACE);\n\n  // Check if generated id is unique\n  // If not and we've already used it, append its count after it\n  if (id in usedUids) {\n    // Increase the count\n    const newCount = usedUids[id] + 1;\n    usedUids[id] = newCount;\n    // Append count to generated id to make it unique\n    id = `${id}_${newCount}`;\n  } else {\n    // If id is unique and wasn't used, add it to usedUids and start count at 0\n    usedUids[id] = 0;\n  }\n  // Return unique id\n  if (refId) {\n    return `${refId}_${id}`;\n  }\n  return id;\n}\n","import { Observable, throwError, timer } from 'rxjs';\nimport { finalize, map, retryWhen, mergeMap } from 'rxjs/operators';\nimport { webSocket } from 'rxjs/webSocket';\n\nimport { DataFrame, FieldType, KeyValue, CircularDataFrame } from '@grafana/data';\n\nimport { appendResponseToBufferedData } from './liveStreamsResultTransformer';\nimport { LokiTailResponse } from './types';\n\n/**\n * Maps directly to a query in the UI (refId is key)\n */\nexport interface LokiLiveTarget {\n  query: string;\n  url: string;\n  refId: string;\n  size: number;\n}\n\n/**\n * Cache of websocket streams that can be returned as observable. In case there already is a stream for particular\n * target it is returned and on subscription returns the latest dataFrame.\n */\nexport class LiveStreams {\n  private streams: KeyValue<Observable<DataFrame[]>> = {};\n\n  getStream(target: LokiLiveTarget, retryInterval = 5000): Observable<DataFrame[]> {\n    let stream = this.streams[target.url];\n\n    if (stream) {\n      return stream;\n    }\n\n    const data = new CircularDataFrame({ capacity: target.size });\n    data.addField({ name: 'Time', type: FieldType.time, config: {} });\n    data.addField({ name: 'Line', type: FieldType.string });\n    data.addField({ name: 'id', type: FieldType.string });\n    data.meta = { ...data.meta, preferredVisualisationType: 'logs' };\n    data.refId = target.refId;\n\n    stream = webSocket<LokiTailResponse>(target.url).pipe(\n      map((response: LokiTailResponse) => {\n        appendResponseToBufferedData(response, data);\n        return [data];\n      }),\n      retryWhen((attempts) =>\n        attempts.pipe(\n          mergeMap((error, i) => {\n            const retryAttempt = i + 1;\n            // Code 1006 is used to indicate that a connection was closed abnormally.\n            // Added hard limit of 30 on number of retries.\n            // If connection was closed abnormally, and we wish to retry, otherwise throw error.\n            if (error.code === 1006 && retryAttempt < 30) {\n              if (retryAttempt > 10) {\n                // If more than 10 times retried, consol.warn, but keep reconnecting\n                console.warn(\n                  `Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${error.reason}`\n                );\n              }\n              // Retry every 5s\n              return timer(retryInterval);\n            }\n            return throwError(error);\n          })\n        )\n      ),\n      finalize(() => {\n        delete this.streams[target.url];\n      })\n    );\n    this.streams[target.url] = stream;\n\n    return stream;\n  }\n}\n","import { css } from '@emotion/css';\nimport { useRef, useCallback, useEffect, useMemo, useState } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { dateTime, GrafanaTheme2, LogRowModel, renderMarkdown, SelectableValue } from '@grafana/data';\nimport { RawQuery } from '@grafana/plugin-ui';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  Alert,\n  Button,\n  Collapse,\n  Icon,\n  InlineField,\n  InlineFieldRow,\n  InlineSwitch,\n  Label,\n  MultiSelect,\n  RenderUserContentAsHTML,\n  Spinner,\n  Tooltip,\n  useStyles2,\n} from '@grafana/ui';\n\nimport {\n  LogContextProvider,\n  LOKI_LOG_CONTEXT_PRESERVED_LABELS,\n  PreservedLabels,\n  SHOULD_INCLUDE_PIPELINE_OPERATIONS,\n} from '../LogContextProvider';\nimport { escapeLabelValueInSelector } from '../languageUtils';\nimport { lokiGrammar } from '../syntax';\nimport { ContextFilter, LokiQuery } from '../types';\n\nexport interface LokiContextUiProps {\n  logContextProvider: LogContextProvider;\n  row: LogRowModel;\n  updateFilter: (value: ContextFilter[]) => void;\n  onClose: () => void;\n  origQuery?: LokiQuery;\n  runContextQuery?: () => void;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    labels: css({\n      display: 'flex',\n      gap: theme.spacing(0.5),\n    }),\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      flex: 1,\n      gap: theme.spacing(0.5),\n      position: 'relative',\n    }),\n    textWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    hidden: css({\n      visibility: 'hidden',\n    }),\n    label: css({\n      maxWidth: '100%',\n      '&:first-of-type': {\n        marginBottom: theme.spacing(2),\n      },\n      '&:not(:first-of-type)': {\n        margin: theme.spacing(2, 0),\n      },\n    }),\n    rawQueryContainer: css({\n      textAlign: 'start',\n      lineBreak: 'anywhere',\n      marginTop: theme.spacing(-0.25),\n      marginRight: theme.spacing(6),\n      minHeight: theme.spacing(4),\n    }),\n    ui: css({\n      backgroundColor: theme.colors.background.secondary,\n      padding: theme.spacing(2),\n    }),\n    notification: css({\n      position: 'absolute',\n      zIndex: theme.zIndex.portal,\n      top: 0,\n      right: 0,\n    }),\n    rawQuery: css({\n      display: 'inline',\n    }),\n    queryDescription: css({\n      marginLeft: theme.spacing(0.5),\n    }),\n    iconButton: css({\n      position: 'absolute',\n      top: theme.spacing(1),\n      right: theme.spacing(1),\n      zIndex: theme.zIndex.navbarFixed,\n    }),\n    operationsToggle: css({\n      margin: theme.spacing(1, 0, -1, 0),\n      '& > div': {\n        margin: 0,\n        '& > label': {\n          padding: 0,\n        },\n      },\n    }),\n  };\n}\n\nexport const IS_LOKI_LOG_CONTEXT_UI_OPEN = 'isLogContextQueryUiOpen';\n\nexport function LokiContextUi(props: LokiContextUiProps) {\n  const { row, logContextProvider, updateFilter, onClose, origQuery, runContextQuery } = props;\n  const styles = useStyles2(getStyles);\n\n  const [contextFilters, setContextFilters] = useState<ContextFilter[]>([]);\n  const [showPreservedFiltersAppliedNotification, setShowPreservedFiltersAppliedNotification] = useState(false);\n\n  const [initialized, setInitialized] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [isOpen, setIsOpen] = useState(window.localStorage.getItem(IS_LOKI_LOG_CONTEXT_UI_OPEN) === 'true');\n  const [includePipelineOperations, setIncludePipelineOperations] = useState(\n    window.localStorage.getItem(SHOULD_INCLUDE_PIPELINE_OPERATIONS) === 'true'\n  );\n\n  const timerHandle = useRef<number>();\n  const previousInitialized = useRef<boolean>(false);\n  const previousContextFilters = useRef<ContextFilter[]>([]);\n\n  const isInitialState = useMemo(() => {\n    // Initial query has all regular labels enabled and all parsed labels disabled\n    if (initialized && contextFilters.some((filter) => filter.nonIndexed === filter.enabled)) {\n      return false;\n    }\n\n    // if we include pipeline operations, we also want to enable the revert button\n    if (includePipelineOperations && logContextProvider.queryContainsValidPipelineStages(origQuery)) {\n      return false;\n    }\n\n    return true;\n  }, [contextFilters, includePipelineOperations, initialized, logContextProvider, origQuery]);\n\n  useEffect(() => {\n    if (!initialized) {\n      return;\n    }\n\n    // don't trigger if we initialized, this will be the same query anyways.\n    if (!previousInitialized.current) {\n      previousInitialized.current = initialized;\n      return;\n    }\n\n    if (contextFilters.filter(({ enabled, nonIndexed }) => enabled && !nonIndexed).length === 0) {\n      setContextFilters(previousContextFilters.current);\n      return;\n    }\n\n    previousContextFilters.current = structuredClone(contextFilters);\n\n    if (timerHandle.current) {\n      clearTimeout(timerHandle.current);\n    }\n    setLoading(true);\n    timerHandle.current = window.setTimeout(() => {\n      updateFilter(contextFilters.filter(({ enabled }) => enabled));\n      // We are storing the removed labels and selected extracted labels in local storage so we can\n      // preselect the labels in the UI in the next log context view.\n      const preservedLabels: PreservedLabels = {\n        removedLabels: [],\n        selectedExtractedLabels: [],\n      };\n\n      contextFilters.forEach(({ enabled, nonIndexed, label }) => {\n        // We only want to store real labels that were removed from the initial query\n        if (!enabled && !nonIndexed) {\n          preservedLabels.removedLabels.push(label);\n        }\n        // Or extracted labels that were added to the initial query\n        if (enabled && nonIndexed) {\n          preservedLabels.selectedExtractedLabels.push(label);\n        }\n      });\n\n      window.localStorage.setItem(LOKI_LOG_CONTEXT_PRESERVED_LABELS, JSON.stringify(preservedLabels));\n      setLoading(false);\n    }, 1500);\n\n    return () => {\n      clearTimeout(timerHandle.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [contextFilters, initialized]);\n\n  useEffect(() => {\n    return () => {\n      clearTimeout(timerHandle.current);\n      onClose();\n    };\n  }, [onClose]);\n\n  useAsync(async () => {\n    setLoading(true);\n    const initContextFilters = await logContextProvider.getInitContextFilters(row, origQuery, {\n      from: dateTime(row.timeEpochMs),\n      to: dateTime(row.timeEpochMs),\n      raw: { from: dateTime(row.timeEpochMs), to: dateTime(row.timeEpochMs) },\n    });\n    setContextFilters(initContextFilters.contextFilters);\n    setShowPreservedFiltersAppliedNotification(initContextFilters.preservedFiltersApplied);\n    setInitialized(true);\n    setLoading(false);\n  });\n\n  // To hide previousContextFiltersApplied notification after 2 seconds\n  useEffect(() => {\n    if (showPreservedFiltersAppliedNotification) {\n      setTimeout(() => {\n        setShowPreservedFiltersAppliedNotification(false);\n      }, 2000);\n    }\n  }, [showPreservedFiltersAppliedNotification]);\n\n  useEffect(() => {\n    reportInteraction('grafana_explore_logs_loki_log_context_loaded', {\n      logRowUid: row.uid,\n      type: 'load',\n    });\n\n    return () => {\n      reportInteraction('grafana_explore_logs_loki_log_context_loaded', {\n        logRowUid: row.uid,\n        type: 'unload',\n      });\n    };\n  }, [row.uid]);\n\n  const realLabels = contextFilters.filter(({ nonIndexed }) => !nonIndexed);\n  const realLabelsEnabled = realLabels.filter(({ enabled }) => enabled);\n\n  const parsedLabels = contextFilters.filter(({ nonIndexed }) => nonIndexed);\n  const parsedLabelsEnabled = parsedLabels.filter(({ enabled }) => enabled);\n\n  const contextFilterToSelectFilter = useCallback((contextFilter: ContextFilter): SelectableValue<string> => {\n    return {\n      label: `${contextFilter.label}=\"${escapeLabelValueInSelector(contextFilter.value)}\"`,\n      value: contextFilter.label,\n    };\n  }, []);\n\n  // If there's any nonIndexed labels, that includes structured metadata and parsed labels, we show the nonIndexed labels input\n  const showNonIndexedLabels = parsedLabels.length > 0;\n\n  let queryExpr = logContextProvider.prepareExpression(\n    contextFilters.filter(({ enabled }) => enabled),\n    origQuery\n  );\n  return (\n    <div className={styles.wrapper}>\n      {showPreservedFiltersAppliedNotification && (\n        <Alert\n          className={styles.notification}\n          title=\"Previously used filters have been applied.\"\n          severity=\"info\"\n          elevated={true}\n        ></Alert>\n      )}\n      <Tooltip content={'Revert to initial log context query.'}>\n        <div className={styles.iconButton}>\n          <Button\n            data-testid=\"revert-button\"\n            icon=\"history-alt\"\n            variant=\"secondary\"\n            disabled={isInitialState}\n            onClick={(e) => {\n              reportInteraction('grafana_explore_logs_loki_log_context_reverted', {\n                logRowUid: row.uid,\n              });\n              setContextFilters((contextFilters) => {\n                return contextFilters.map((contextFilter) => ({\n                  ...contextFilter,\n                  // For revert to initial query we need to enable all labels and disable all parsed labels\n                  enabled: !contextFilter.nonIndexed,\n                }));\n              });\n              // We are removing the preserved labels from local storage so we can preselect the labels in the UI\n              window.localStorage.removeItem(LOKI_LOG_CONTEXT_PRESERVED_LABELS);\n              window.localStorage.removeItem(SHOULD_INCLUDE_PIPELINE_OPERATIONS);\n              setIncludePipelineOperations(false);\n            }}\n          />\n        </div>\n      </Tooltip>\n\n      <Collapse\n        collapsible={true}\n        isOpen={isOpen}\n        onToggle={() => {\n          window.localStorage.setItem(IS_LOKI_LOG_CONTEXT_UI_OPEN, (!isOpen).toString());\n          setIsOpen((isOpen) => !isOpen);\n          reportInteraction('grafana_explore_logs_loki_log_context_toggled', {\n            logRowUid: row.uid,\n            action: !isOpen ? 'open' : 'close',\n          });\n        }}\n        label={\n          <div className={styles.rawQueryContainer}>\n            {initialized ? (\n              <>\n                <RawQuery\n                  language={{ grammar: lokiGrammar, name: 'loki' }}\n                  query={queryExpr}\n                  className={styles.rawQuery}\n                />\n                <Tooltip content=\"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query.\">\n                  <Icon name=\"info-circle\" size=\"sm\" className={styles.queryDescription} />\n                </Tooltip>\n              </>\n            ) : (\n              <Spinner />\n            )}\n          </div>\n        }\n      >\n        <div className={styles.ui}>\n          <Label\n            className={styles.label}\n            description=\"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters.\"\n          >\n            Widen the search\n          </Label>\n          <MultiSelect\n            isLoading={loading}\n            options={realLabels.map(contextFilterToSelectFilter)}\n            value={realLabelsEnabled.map(contextFilterToSelectFilter)}\n            closeMenuOnSelect={true}\n            maxMenuHeight={200}\n            noOptionsMessage=\"No further labels available\"\n            onChange={(keys, actionMeta) => {\n              if (actionMeta.action === 'select-option') {\n                reportInteraction('grafana_explore_logs_loki_log_context_filtered', {\n                  logRowUid: row.uid,\n                  type: 'label',\n                  action: 'select',\n                });\n              }\n              if (actionMeta.action === 'remove-value') {\n                reportInteraction('grafana_explore_logs_loki_log_context_filtered', {\n                  logRowUid: row.uid,\n                  type: 'label',\n                  action: 'remove',\n                });\n              }\n              return setContextFilters(\n                contextFilters.map((filter) => {\n                  if (filter.nonIndexed) {\n                    return filter;\n                  }\n                  filter.enabled = keys.some((key) => key.value === filter.label);\n                  return filter;\n                })\n              );\n            }}\n          />\n          {showNonIndexedLabels && (\n            <>\n              <Label\n                className={styles.label}\n                description={`By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line.`}\n              >\n                Refine the search\n              </Label>\n              <MultiSelect\n                isLoading={loading}\n                options={parsedLabels.map(contextFilterToSelectFilter)}\n                value={parsedLabelsEnabled.map(contextFilterToSelectFilter)}\n                closeMenuOnSelect={true}\n                maxMenuHeight={200}\n                noOptionsMessage=\"No further labels available\"\n                isClearable={true}\n                onChange={(keys, actionMeta) => {\n                  if (actionMeta.action === 'select-option') {\n                    reportInteraction('grafana_explore_logs_loki_log_context_filtered', {\n                      logRowUid: row.uid,\n                      type: 'parsed_label',\n                      action: 'select',\n                    });\n                  }\n                  if (actionMeta.action === 'remove-value') {\n                    reportInteraction('grafana_explore_logs_loki_log_context_filtered', {\n                      logRowUid: row.uid,\n                      type: 'parsed_label',\n                      action: 'remove',\n                    });\n                  }\n                  setContextFilters(\n                    contextFilters.map((filter) => {\n                      if (!filter.nonIndexed) {\n                        return filter;\n                      }\n                      filter.enabled = keys.some((key) => key.value === filter.label);\n                      return filter;\n                    })\n                  );\n                }}\n              />\n            </>\n          )}\n          {logContextProvider.queryContainsValidPipelineStages(origQuery) && (\n            <InlineFieldRow className={styles.operationsToggle}>\n              <InlineField\n                label=\"Include LogQL pipeline operations\"\n                tooltip={\n                  <RenderUserContentAsHTML\n                    content={renderMarkdown(\n                      \"This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.\"\n                    )}\n                  />\n                }\n              >\n                <InlineSwitch\n                  value={includePipelineOperations}\n                  showLabel={true}\n                  transparent={true}\n                  onChange={(e) => {\n                    reportInteraction('grafana_explore_logs_loki_log_context_pipeline_toggled', {\n                      logRowUid: row.uid,\n                      action: e.currentTarget.checked ? 'enable' : 'disable',\n                    });\n                    window.localStorage.setItem(SHOULD_INCLUDE_PIPELINE_OPERATIONS, e.currentTarget.checked.toString());\n                    setIncludePipelineOperations(e.currentTarget.checked);\n                    if (runContextQuery) {\n                      runContextQuery();\n                    }\n                  }}\n                />\n              </InlineField>\n            </InlineFieldRow>\n          )}\n        </div>\n      </Collapse>\n    </div>\n  );\n}\n","import { DataFrame, Field, FieldType } from '@grafana/data';\n\nexport enum SortDirection {\n  Ascending,\n  Descending,\n}\n\n// creates the `index` for the sorting.\n// this is needed by the `SortedVector`.\n// the index is an array of numbers, and it defines an order.\n// at every slot in the index the values is the position of\n// the sorted item.\n// for example, an index of [3,1,2] means that\n// in the dataframe, that has 3 rows, after sorting:\n// - the third row will become the first\n// - the first row will become the second\n// - the second row will become the third\nfunction makeIndex(field: Field<number>, dir: SortDirection): number[] {\n  const fieldValues: number[] = field.values;\n  const { nanos } = field;\n\n  // we first build an array which is [0,1,2,3....]\n  const index = Array(fieldValues.length);\n  for (let i = 0; i < index.length; i++) {\n    index[i] = i;\n  }\n\n  const isAsc = dir === SortDirection.Ascending;\n\n  index.sort((a: number, b: number): number => {\n    // we need to answer this question:\n    // in the field-used-for-sorting, how would we compare value-at-index-a to value-at-index-b?\n    const valA = fieldValues[a];\n    const valB = fieldValues[b];\n    if (valA < valB) {\n      return isAsc ? -1 : 1;\n    }\n\n    if (valA > valB) {\n      return isAsc ? 1 : -1;\n    }\n\n    // the millisecond timestamps are equal,\n    // compare the nanosecond part, if available\n\n    if (nanos === undefined) {\n      return 0;\n    }\n\n    const nanoA = nanos[a];\n    const nanoB = nanos[b];\n\n    if (nanoA < nanoB) {\n      return isAsc ? -1 : 1;\n    }\n\n    if (nanoA > nanoB) {\n      return isAsc ? 1 : -1;\n    }\n\n    return 0;\n  });\n\n  return index;\n}\n\n// sort a dataframe that is in the Loki dataframe format ascending or desceding based on time,\n// with nanosecond precision.\nexport function sortDataFrameByTime(frame: DataFrame, dir: SortDirection): DataFrame {\n  const { fields, ...rest } = frame;\n\n  // we use the approach used in @grafana/data/sortDataframe.\n  // we cannot use it directly, because it does not take `.nanos` into account\n  // (see https://github.com/grafana/grafana/issues/72351).\n  // we can switch to to @grafana/data/sortDataframe when the issue is fixed.\n\n  const timeField = fields.find((field) => field.type === FieldType.time);\n  if (timeField === undefined) {\n    throw new Error('missing timestamp field. should never happen');\n  }\n\n  const index = makeIndex(timeField, dir);\n\n  return {\n    ...rest,\n    fields: fields.map((field) => ({\n      ...field,\n      values: sorted(field.values, index),\n      nanos: field.nanos === undefined ? undefined : sorted(field.nanos, index),\n    })),\n  };\n}\n\nfunction sorted<T>(vals: T[], index: number[]): T[] {\n  return vals.map((_, idx) => vals[index[idx]]);\n}\n","import { isEmpty } from 'lodash';\nimport { catchError, lastValueFrom, of, switchMap } from 'rxjs';\n\nimport {\n  CoreApp,\n  DataFrame,\n  DataQueryError,\n  DataQueryResponse,\n  FieldCache,\n  FieldType,\n  LogRowModel,\n  TimeRange,\n  toUtc,\n  LogRowContextQueryDirection,\n  LogRowContextOptions,\n  dateTime,\n  ScopedVars,\n} from '@grafana/data';\nimport { LabelParser, LabelFilter, LineFilters, PipelineStage, Logfmt, Json } from '@grafana/lezer-logql';\n\nimport { LokiContextUi } from './components/LokiContextUi';\nimport { LokiDatasource, makeRequest, REF_ID_STARTER_LOG_ROW_CONTEXT } from './datasource';\nimport { escapeLabelValueInExactSelector, getLabelTypeFromFrame } from './languageUtils';\nimport { addLabelToQuery, addParserToQuery } from './modifyQuery';\nimport {\n  getNodePositionsFromQuery,\n  getParserFromQuery,\n  getStreamSelectorsFromQuery,\n  isQueryWithParser,\n} from './queryUtils';\nimport { sortDataFrameByTime, SortDirection } from './sortDataFrame';\nimport { ContextFilter, LabelType, LokiQuery, LokiQueryDirection, LokiQueryType } from './types';\n\nexport const LOKI_LOG_CONTEXT_PRESERVED_LABELS = 'lokiLogContextPreservedLabels';\nexport const SHOULD_INCLUDE_PIPELINE_OPERATIONS = 'lokiLogContextShouldIncludePipelineOperations';\n\nexport type PreservedLabels = {\n  removedLabels: string[];\n  selectedExtractedLabels: string[];\n};\n\nexport class LogContextProvider {\n  datasource: LokiDatasource;\n  cachedContextFilters: ContextFilter[];\n  onContextClose: (() => void) | undefined;\n\n  constructor(datasource: LokiDatasource) {\n    this.datasource = datasource;\n    this.cachedContextFilters = [];\n  }\n\n  private async getQueryAndRange(\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    origQuery?: LokiQuery,\n    cacheFilters = true\n  ) {\n    const direction = (options && options.direction) || LogRowContextQueryDirection.Backward;\n    const limit = (options && options.limit) || this.datasource.maxLines;\n    // If the user doesn't have any filters applied already, or if we don't want\n    // to use the cached filters, we need to reinitialize them.\n    if (this.cachedContextFilters.length === 0 || !cacheFilters) {\n      const filters = (\n        await this.getInitContextFilters(row, origQuery, {\n          from: dateTime(row.timeEpochMs),\n          to: dateTime(row.timeEpochMs),\n          raw: { from: dateTime(row.timeEpochMs), to: dateTime(row.timeEpochMs) },\n        })\n      ).contextFilters.filter((filter) => filter.enabled);\n\n      this.cachedContextFilters = filters;\n    }\n\n    return await this.prepareLogRowContextQueryTarget(row, limit, direction, origQuery);\n  }\n\n  getLogRowContextQuery = async (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    origQuery?: LokiQuery,\n    cacheFilters = true\n  ): Promise<LokiQuery> => {\n    if (origQuery && options?.scopedVars) {\n      origQuery = this.datasource.applyTemplateVariables(origQuery, options?.scopedVars);\n    }\n    const { query } = await this.getQueryAndRange(row, options, origQuery, cacheFilters);\n\n    if (!cacheFilters) {\n      // If the caller doesn't want to cache the filters, we need to reset them.\n      this.cachedContextFilters = [];\n    }\n\n    return query;\n  };\n\n  getLogRowContext = async (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    origQuery?: LokiQuery\n  ): Promise<{ data: DataFrame[] }> => {\n    if (origQuery && options?.scopedVars) {\n      origQuery = this.datasource.applyTemplateVariables(origQuery, options?.scopedVars);\n    }\n    const direction = (options && options.direction) || LogRowContextQueryDirection.Backward;\n    const { query, range } = await this.getQueryAndRange(row, options, origQuery);\n\n    const processResults = (result: DataQueryResponse): DataQueryResponse => {\n      const frames: DataFrame[] = result.data;\n      const processedFrames = frames.map((frame) => sortDataFrameByTime(frame, SortDirection.Descending));\n\n      return {\n        ...result,\n        data: processedFrames,\n      };\n    };\n\n    // this can only be called from explore currently\n    const app = CoreApp.Explore;\n\n    return lastValueFrom(\n      this.datasource.query(makeRequest(query, range, app, `${REF_ID_STARTER_LOG_ROW_CONTEXT}${direction}`)).pipe(\n        catchError((err) => {\n          const error: DataQueryError = {\n            message: 'Error during context query. Please check JS console logs.',\n            status: err.status,\n            statusText: err.statusText,\n          };\n          throw error;\n        }),\n        switchMap((res) => of(processResults(res)))\n      )\n    );\n  };\n\n  async prepareLogRowContextQueryTarget(\n    row: LogRowModel,\n    limit: number,\n    direction: LogRowContextQueryDirection,\n    origQuery?: LokiQuery\n  ): Promise<{ query: LokiQuery; range: TimeRange }> {\n    const expr = this.prepareExpression(this.cachedContextFilters, origQuery);\n\n    const contextTimeBuffer = 2 * 60 * 60 * 1000; // 2h buffer\n\n    const queryDirection =\n      direction === LogRowContextQueryDirection.Forward ? LokiQueryDirection.Forward : LokiQueryDirection.Backward;\n\n    const query: LokiQuery = {\n      expr,\n      queryType: LokiQueryType.Range,\n      // refId has to be:\n      // - always different (temporarily, will be fixed later)\n      // - not increase in size\n      // because it may be called many times from logs-context\n      refId: `${REF_ID_STARTER_LOG_ROW_CONTEXT}_${Math.random().toString()}`,\n      maxLines: limit,\n      direction: queryDirection,\n      datasource: { uid: this.datasource.uid, type: this.datasource.type },\n    };\n\n    const fieldCache = new FieldCache(row.dataFrame);\n    const tsField = fieldCache.getFirstFieldOfType(FieldType.time);\n    if (tsField === undefined) {\n      throw new Error('loki: data frame missing time-field, should never happen');\n    }\n    const tsValue = tsField.values[row.rowIndex];\n    const timestamp = toUtc(tsValue);\n\n    const range =\n      queryDirection === LokiQueryDirection.Forward\n        ? {\n            // start param in Loki API is inclusive so we'll have to filter out the row that this request is based from\n            // and any other that were logged in the same ns but before the row. Right now these rows will be lost\n            // because the are before but came it he response that should return only rows after.\n            from: timestamp,\n            // convert to ns, we lose some precision here but it is not that important at the far points of the context\n            to: toUtc(row.timeEpochMs + contextTimeBuffer),\n          }\n        : {\n            // convert to ns, we lose some precision here but it is not that important at the far points of the context\n            from: toUtc(row.timeEpochMs - contextTimeBuffer),\n            to: timestamp,\n          };\n\n    return {\n      query,\n      range: {\n        from: range.from,\n        to: range.to,\n        raw: range,\n      },\n    };\n  }\n\n  getLogRowContextUi(\n    row: LogRowModel,\n    runContextQuery?: () => void,\n    origQuery?: LokiQuery,\n    scopedVars?: ScopedVars\n  ): React.ReactNode {\n    if (origQuery && scopedVars) {\n      origQuery = this.datasource.applyTemplateVariables(origQuery, scopedVars);\n    }\n    const updateFilter = (contextFilters: ContextFilter[]) => {\n      this.cachedContextFilters = contextFilters;\n\n      if (runContextQuery) {\n        runContextQuery();\n      }\n    };\n\n    // we need to cache this function so that it doesn't get recreated on every render\n    this.onContextClose =\n      this.onContextClose ??\n      (() => {\n        this.cachedContextFilters = [];\n      });\n\n    return LokiContextUi({\n      row,\n      origQuery,\n      updateFilter,\n      onClose: this.onContextClose,\n      logContextProvider: this,\n      runContextQuery,\n    });\n  }\n\n  prepareExpression(contextFilters: ContextFilter[], query: LokiQuery | undefined): string {\n    let preparedExpression = this.processContextFiltersToExpr(contextFilters, query);\n    if (window.localStorage.getItem(SHOULD_INCLUDE_PIPELINE_OPERATIONS) === 'true') {\n      preparedExpression = this.processPipelineStagesToExpr(preparedExpression, query);\n    }\n    return preparedExpression;\n  }\n\n  processContextFiltersToExpr = (contextFilters: ContextFilter[], query: LokiQuery | undefined): string => {\n    const labelFilters = contextFilters\n      .map((filter) => {\n        if (!filter.nonIndexed && filter.enabled) {\n          // escape backslashes in label as users can't escape them by themselves\n          return `${filter.label}=\"${escapeLabelValueInExactSelector(filter.value)}\"`;\n        }\n        return '';\n      })\n      // Filter empty strings\n      .filter((label) => !!label)\n      .join(',');\n\n    let expr = `{${labelFilters}}`;\n\n    // We need to have original query to get parser and include parsed labels\n    // We only add parser and parsed labels if there is only one parser in query\n    if (query) {\n      let hasParser = false;\n      if (isQueryWithParser(query.expr).parserCount === 1) {\n        hasParser = true;\n        const parser = getParserFromQuery(query.expr);\n        if (parser) {\n          expr = addParserToQuery(expr, parser);\n        }\n      }\n\n      const nonIndexedLabels = contextFilters.filter((filter) => filter.nonIndexed && filter.enabled);\n      for (const parsedLabel of nonIndexedLabels) {\n        if (parsedLabel.enabled) {\n          expr = addLabelToQuery(\n            expr,\n            parsedLabel.label,\n            '=',\n            parsedLabel.value,\n            hasParser ? LabelType.Parsed : LabelType.StructuredMetadata\n          );\n        }\n      }\n    }\n\n    return expr;\n  };\n\n  processPipelineStagesToExpr = (currentExpr: string, query: LokiQuery | undefined): string => {\n    let newExpr = currentExpr;\n    const origExpr = query?.expr ?? '';\n\n    if (isQueryWithParser(origExpr).parserCount > 1) {\n      return newExpr;\n    }\n\n    const allNodePositions = getNodePositionsFromQuery(origExpr, [\n      PipelineStage,\n      LabelParser,\n      Logfmt,\n      Json,\n      LineFilters,\n      LabelFilter,\n    ]);\n    const pipelineStagePositions = allNodePositions.filter((position) => position.type?.id === PipelineStage);\n    const otherNodePositions = allNodePositions.filter((position) => position.type?.id !== PipelineStage);\n\n    for (const pipelineStagePosition of pipelineStagePositions) {\n      // we don't process pipeline stages that contain label parsers, line filters or label filters\n      if (otherNodePositions.some((position) => pipelineStagePosition.contains(position))) {\n        continue;\n      }\n\n      newExpr += ` ${pipelineStagePosition.getExpression(origExpr)}`;\n    }\n\n    return newExpr;\n  };\n\n  queryContainsValidPipelineStages = (query: LokiQuery | undefined): boolean => {\n    const origExpr = query?.expr ?? '';\n    const allNodePositions = getNodePositionsFromQuery(origExpr, [\n      PipelineStage,\n      LabelParser,\n      LineFilters,\n      LabelFilter,\n    ]);\n    const pipelineStagePositions = allNodePositions.filter((position) => position.type?.id === PipelineStage);\n    const otherNodePositions = allNodePositions.filter((position) => position.type?.id !== PipelineStage);\n\n    return pipelineStagePositions.some((pipelineStagePosition) =>\n      otherNodePositions.every((position) => pipelineStagePosition.contains(position) === false)\n    );\n  };\n\n  getInitContextFilters = async (\n    row: LogRowModel,\n    query?: LokiQuery,\n    timeRange?: TimeRange\n  ): Promise<{ contextFilters: ContextFilter[]; preservedFiltersApplied: boolean }> => {\n    let preservedFiltersApplied = false;\n    if (!query || isEmpty(row.labels)) {\n      return { contextFilters: [], preservedFiltersApplied };\n    }\n    const rowLabels = row.labels;\n\n    // 1. First we need to get all labels from the log row's label\n    // and correctly set parsed and not parsed labels\n    let allLabels: string[] = [];\n    if (!isQueryWithParser(query.expr).queryWithParser) {\n      // If there is no parser, we use getLabelKeys because it has better caching\n      // and all labels should already be fetched\n      await this.datasource.languageProvider.start(timeRange);\n      allLabels = this.datasource.languageProvider.getLabelKeys();\n    } else {\n      // If we have parser, we use fetchLabels to fetch actual labels for selected stream\n      const stream = getStreamSelectorsFromQuery(query.expr);\n      // We are using stream[0] as log query can always have just 1 stream selector\n      allLabels = await this.datasource.languageProvider.fetchLabels({ streamSelector: stream[0], timeRange });\n    }\n\n    const contextFilters: ContextFilter[] = [];\n    Object.entries(rowLabels).forEach(([label, value]) => {\n      const labelType = getLabelTypeFromFrame(label, row.dataFrame, row.rowIndex);\n      const filter: ContextFilter = {\n        label,\n        value: value,\n        enabled: allLabels.includes(label),\n        nonIndexed: labelType !== null && labelType !== LabelType.Indexed,\n      };\n\n      contextFilters.push(filter);\n    });\n\n    // Secondly we check for preserved labels and update enabled state of filters based on that\n    let preservedLabels: undefined | PreservedLabels = undefined;\n    const preservedLabelsString = window.localStorage.getItem(LOKI_LOG_CONTEXT_PRESERVED_LABELS);\n    if (preservedLabelsString) {\n      try {\n        preservedLabels = JSON.parse(preservedLabelsString);\n        // Do nothing when error occurs\n      } catch (e) {}\n    }\n\n    if (!preservedLabels) {\n      // If we don't have preservedLabels, we return contextFilters as they are\n      return { contextFilters, preservedFiltersApplied };\n    } else {\n      // Otherwise, we need to update filters based on preserved labels\n      let arePreservedLabelsUsed = false;\n      const newContextFilters = contextFilters.map((contextFilter) => {\n        // We checked for undefined above\n        if (preservedLabels!.removedLabels.includes(contextFilter.label)) {\n          arePreservedLabelsUsed = true;\n          return { ...contextFilter, enabled: false };\n        }\n        // We checked for undefined above\n        if (preservedLabels!.selectedExtractedLabels.includes(contextFilter.label)) {\n          arePreservedLabelsUsed = true;\n          return { ...contextFilter, enabled: true };\n        }\n        return { ...contextFilter };\n      });\n\n      const isAtLeastOneRealLabelEnabled = newContextFilters.some(({ enabled, nonIndexed }) => enabled && !nonIndexed);\n      if (!isAtLeastOneRealLabelEnabled) {\n        // If we end up with no real labels enabled, we need to reset the init filters\n        return { contextFilters, preservedFiltersApplied };\n      } else {\n        if (arePreservedLabelsUsed) {\n          preservedFiltersApplied = true;\n        }\n        return { contextFilters: newContextFilters, preservedFiltersApplied };\n      }\n    }\n  };\n}\n","import { LokiVariableQuery, LokiVariableQueryType } from '../types';\n\nexport const labelNamesRegex = /^label_names\\(\\)\\s*$/;\nexport const labelValuesRegex = /^label_values\\((?:(.+),\\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\\)\\s*$/;\n\nexport function migrateVariableQuery(rawQuery: string | LokiVariableQuery): LokiVariableQuery {\n  // If not string, we assume LokiVariableQuery\n  if (typeof rawQuery !== 'string') {\n    return rawQuery;\n  }\n\n  const queryBase = {\n    refId: 'LokiVariableQueryEditor-VariableQuery',\n    type: LokiVariableQueryType.LabelNames,\n  };\n\n  const labelNames = rawQuery.match(labelNamesRegex);\n  if (labelNames) {\n    return {\n      ...queryBase,\n      type: LokiVariableQueryType.LabelNames,\n    };\n  }\n\n  const labelValues = rawQuery.match(labelValuesRegex);\n  if (labelValues) {\n    return {\n      ...queryBase,\n      type: LokiVariableQueryType.LabelValues,\n      label: labelValues[2] ? labelValues[2] : labelValues[1],\n      stream: labelValues[2] ? labelValues[1] : undefined,\n    };\n  }\n\n  return queryBase;\n}\n","import { FormEvent, useState, useEffect } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { QueryEditorProps, SelectableValue } from '@grafana/data';\nimport { InlineField, InlineFieldRow, Input, Select } from '@grafana/ui';\n\nimport { LokiDatasource } from '../datasource';\nimport { migrateVariableQuery } from '../migrations/variableQueryMigrations';\nimport { LokiOptions, LokiQuery, LokiVariableQuery, LokiVariableQueryType as QueryType } from '../types';\n\nconst variableOptions = [\n  { label: 'Label names', value: QueryType.LabelNames },\n  { label: 'Label values', value: QueryType.LabelValues },\n];\n\nexport type Props = QueryEditorProps<LokiDatasource, LokiQuery, LokiOptions, LokiVariableQuery>;\n\nconst refId = 'LokiVariableQueryEditor-VariableQuery';\n\nexport const LokiVariableQueryEditor = ({ onChange, query, datasource, range }: Props) => {\n  const [type, setType] = useState<number | undefined>(undefined);\n  const [label, setLabel] = useState('');\n  const [labelOptions, setLabelOptions] = useState<Array<SelectableValue<string>>>([]);\n  const [stream, setStream] = useState('');\n  const previousType = usePrevious(type);\n\n  useEffect(() => {\n    if (!query) {\n      return;\n    }\n\n    const variableQuery = typeof query === 'string' ? migrateVariableQuery(query) : query;\n    setType(variableQuery.type);\n    setLabel(variableQuery.label || '');\n    setStream(variableQuery.stream || '');\n  }, [query]);\n\n  useEffect(() => {\n    // Fetch label names when the query type is LabelValues, and the previous type was not the same\n    if (type !== QueryType.LabelValues || previousType === type) {\n      return;\n    }\n\n    datasource.languageProvider.fetchLabels({ timeRange: range }).then((labelNames) => {\n      setLabelOptions(labelNames.map((labelName) => ({ label: labelName, value: labelName })));\n    });\n  }, [datasource, type, range, previousType]);\n\n  const onQueryTypeChange = (newType: SelectableValue<QueryType>) => {\n    setType(newType.value);\n    if (newType.value !== undefined) {\n      onChange({\n        type: newType.value,\n        label,\n        stream,\n        refId,\n      });\n    }\n  };\n\n  const onLabelChange = (newLabel: SelectableValue<string>) => {\n    setLabel(newLabel.value || '');\n  };\n\n  const onStreamChange = (e: FormEvent<HTMLInputElement>) => {\n    setStream(e.currentTarget.value);\n  };\n\n  const handleBlur = () => {\n    if (type !== undefined) {\n      onChange({ type, label, stream, refId: 'LokiVariableQueryEditor-VariableQuery' });\n    }\n  };\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField label=\"Query type\" labelWidth={20}>\n          <Select\n            aria-label=\"Query type\"\n            onChange={onQueryTypeChange}\n            onBlur={handleBlur}\n            value={type}\n            options={variableOptions}\n            width={16}\n          />\n        </InlineField>\n        {type === QueryType.LabelValues && (\n          <>\n            <InlineField label=\"Label\" labelWidth={20}>\n              <Select\n                aria-label=\"Label\"\n                onChange={onLabelChange}\n                onBlur={handleBlur}\n                value={{ label: label, value: label }}\n                options={labelOptions}\n                width={16}\n                allowCustomValue\n              />\n            </InlineField>\n          </>\n        )}\n      </InlineFieldRow>\n      {type === QueryType.LabelValues && (\n        <InlineFieldRow>\n          <InlineField\n            label=\"Stream selector\"\n            labelWidth={20}\n            grow={true}\n            tooltip={\n              <div>\n                {\n                  'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label=\"value\"} or {label=\"$variable\"}'\n                }\n              </div>\n            }\n          >\n            <Input\n              type=\"text\"\n              aria-label=\"Stream selector\"\n              placeholder=\"Optional stream selector\"\n              value={stream}\n              onChange={onStreamChange}\n              onBlur={handleBlur}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n    </>\n  );\n};\n","import { from, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { CustomVariableSupport, DataQueryRequest, MetricFindValue, ScopedVars, TimeRange } from '@grafana/data';\n\nimport { LokiVariableQueryEditor } from './components/VariableQueryEditor';\nimport { LokiDatasource } from './datasource';\nimport { LokiVariableQuery } from './types';\n\nexport class LokiVariableSupport extends CustomVariableSupport<LokiDatasource, LokiVariableQuery> {\n  editor = LokiVariableQueryEditor;\n\n  constructor(private datasource: LokiDatasource) {\n    super();\n  }\n\n  async execute(query: LokiVariableQuery, scopedVars: ScopedVars, range: TimeRange) {\n    return this.datasource.metricFindQuery(query, { scopedVars, range });\n  }\n\n  query(request: DataQueryRequest<LokiVariableQuery>): Observable<{ data: MetricFindValue[] }> {\n    const result = this.execute(request.targets[0], request.scopedVars, request.range);\n\n    return from(result).pipe(map((data) => ({ data })));\n  }\n}\n","import { groupBy } from 'lodash';\n\nimport { FieldType, DataFrame, DataLink, Field } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\n\nimport { DerivedFieldConfig } from './types';\n\nexport function getDerivedFields(dataFrame: DataFrame, derivedFieldConfigs: DerivedFieldConfig[]): Field[] {\n  if (!derivedFieldConfigs.length) {\n    return [];\n  }\n  const derivedFieldsGrouped = groupBy(derivedFieldConfigs, 'name');\n\n  const newFields = Object.values(derivedFieldsGrouped).map(fieldFromDerivedFieldConfig);\n\n  // line-field is the first string-field\n  // NOTE: we should create some common log-frame-extra-string-field code somewhere\n  const lineField = dataFrame.fields.find((f) => f.type === FieldType.string);\n\n  if (lineField === undefined) {\n    // if this is happening, something went wrong, let's raise an error\n    throw new Error('invalid logs-dataframe, string-field missing');\n  }\n\n  const labelFields = dataFrame.fields.find((f) => f.type === FieldType.other && f.name === 'labels');\n\n  for (let i = 0; i < lineField.values.length; i++) {\n    for (const field of newFields) {\n      // `matcherRegex` can be either a RegExp that is used to extract the value from the log line, or it can be a label key to derive the field from the labels\n      if (derivedFieldsGrouped[field.name][0].matcherType === 'label' && labelFields) {\n        const label = labelFields.values[i];\n        if (label) {\n          // Find the key that matches the regex pattern in `matcherRegex`\n          const intersectingKey = Object.keys(label).find((key) => {\n            const regex = new RegExp(derivedFieldsGrouped[field.name][0].matcherRegex);\n            return regex.test(key);\n          });\n\n          if (intersectingKey) {\n            field.values.push(label[intersectingKey]);\n            continue;\n          }\n        }\n        field.values.push(null);\n      } else if (\n        derivedFieldsGrouped[field.name][0].matcherType === 'regex' ||\n        derivedFieldsGrouped[field.name][0].matcherType === undefined\n      ) {\n        // `matcherRegex` will actually be used as a RegExp here\n        const line = lineField.values[i];\n        const logMatch = line.match(derivedFieldsGrouped[field.name][0].matcherRegex);\n\n        if (logMatch && logMatch[1]) {\n          field.values.push(logMatch[1]);\n          continue;\n        }\n\n        field.values.push(null);\n      } else {\n        field.values.push(null);\n      }\n    }\n  }\n\n  return newFields;\n}\n\n/**\n * Transform derivedField config into dataframe field with config that contains link.\n */\nfunction fieldFromDerivedFieldConfig(derivedFieldConfigs: DerivedFieldConfig[]): Field {\n  const dataSourceSrv = getDataSourceSrv();\n\n  const dataLinks = derivedFieldConfigs.reduce<DataLink[]>((acc, derivedFieldConfig) => {\n    // Having field.datasourceUid means it is an internal link.\n    if (derivedFieldConfig.datasourceUid) {\n      const dsSettings = dataSourceSrv.getInstanceSettings(derivedFieldConfig.datasourceUid);\n      const queryType = (type: string | undefined): string | undefined => {\n        switch (type) {\n          case 'tempo':\n            return 'traceql';\n          case 'grafana-x-ray-datasource':\n            return 'getTrace';\n          default:\n            return undefined;\n        }\n      };\n\n      acc.push({\n        // Will be filled out later\n        title: derivedFieldConfig.urlDisplayLabel || '',\n        url: '',\n        // This is hardcoded for Jaeger or Zipkin not way right now to specify datasource specific query object\n        internal: {\n          query: { query: derivedFieldConfig.url, queryType: queryType(dsSettings?.type) },\n          datasourceUid: derivedFieldConfig.datasourceUid,\n          datasourceName: dsSettings?.name ?? 'Data source not found',\n        },\n        targetBlank: derivedFieldConfig.targetBlank,\n      });\n    } else if (derivedFieldConfig.url) {\n      acc.push({\n        // We do not know what title to give here so we count on presentation layer to create a title from metadata.\n        title: derivedFieldConfig.urlDisplayLabel || '',\n        // This is hardcoded for Jaeger or Zipkin not way right now to specify datasource specific query object\n        url: derivedFieldConfig.url,\n        targetBlank: derivedFieldConfig.targetBlank,\n      });\n    }\n    return acc;\n  }, []);\n\n  return {\n    name: derivedFieldConfigs[0].name,\n    type: FieldType.string,\n    config: {\n      links: dataLinks,\n    },\n    // We are adding values later on\n    values: [],\n  };\n}\n","import { groupBy } from 'lodash';\n\nimport { DataFrame, Field, FieldType } from '@grafana/data';\n\nexport function makeTableFrames(instantMetricFrames: DataFrame[]): DataFrame[] {\n  // first we remove frames that have no refId\n  // (we will group them by refId, so we need it to be set)\n  const framesWithRefId = instantMetricFrames.filter((f) => f.refId !== undefined);\n\n  const framesByRefId = groupBy(framesWithRefId, (frame) => frame.refId);\n\n  return Object.entries(framesByRefId).map(([refId, frames]) => makeTableFrame(frames, refId));\n}\n\ntype NumberField = Field<number>;\ntype StringField = Field<string>;\n\nfunction makeTableFrame(instantMetricFrames: DataFrame[], refId: string): DataFrame {\n  const tableTimeField: NumberField = { name: 'Time', config: {}, values: [], type: FieldType.time };\n  const tableValueField: NumberField = {\n    name: `Value #${refId}`,\n    config: {},\n    values: [],\n    type: FieldType.number,\n  };\n\n  // Sort metric labels, create columns for them and record their index\n  const allLabelNames = new Set(\n    instantMetricFrames.map((frame) => frame.fields.map((field) => Object.keys(field.labels ?? {})).flat()).flat()\n  );\n\n  const sortedLabelNames = Array.from(allLabelNames).sort();\n\n  const labelFields: StringField[] = sortedLabelNames.map((labelName) => ({\n    name: labelName,\n    config: { filterable: true },\n    values: [],\n    type: FieldType.string,\n  }));\n\n  instantMetricFrames.forEach((frame) => {\n    const timeField = frame.fields.find((field) => field.type === FieldType.time);\n    const valueField = frame.fields.find((field) => field.type === FieldType.number);\n    if (timeField == null || valueField == null) {\n      return;\n    }\n\n    const timeArray = timeField.values;\n    const valueArray = valueField.values;\n\n    for (let x of timeArray) {\n      tableTimeField.values.push(x);\n    }\n\n    for (let x of valueArray) {\n      tableValueField.values.push(x);\n    }\n\n    const labels = valueField.labels ?? {};\n\n    for (let f of labelFields) {\n      const text = labels[f.name] ?? '';\n      // we insert the labels as many times as we have values\n      for (let i = 0; i < valueArray.length; i++) {\n        f.values.push(text);\n      }\n    }\n  });\n\n  return {\n    fields: [tableTimeField, ...labelFields, tableValueField],\n    refId,\n    meta: { preferredVisualisationType: 'table' },\n    length: tableTimeField.values.length,\n  };\n}\n","import { DataQueryResponse, DataFrame, isDataFrame, FieldType, QueryResultMeta, DataQueryError } from '@grafana/data';\n\nimport { getDerivedFields } from './getDerivedFields';\nimport { makeTableFrames } from './makeTableFrames';\nimport { getExpressionFromExecutedQuery, getHighlighterExpressionsFromQuery } from './queryUtils';\nimport { dataFrameHasLokiError } from './responseUtils';\nimport { DerivedFieldConfig, LokiQuery, LokiQueryType } from './types';\n\nfunction isMetricFrame(frame: DataFrame): boolean {\n  return frame.fields.every((field) => field.type === FieldType.time || field.type === FieldType.number);\n}\n\n// returns a new frame, with meta shallow merged with its original meta\nfunction setFrameMeta(frame: DataFrame, meta: QueryResultMeta): DataFrame {\n  const { meta: oldMeta, ...rest } = frame;\n  // meta maybe be undefined, we need to handle that\n  const newMeta = { ...oldMeta, ...meta };\n  return {\n    ...rest,\n    meta: newMeta,\n  };\n}\n\nfunction processStreamFrame(\n  frame: DataFrame,\n  query: LokiQuery | undefined,\n  derivedFieldConfigs: DerivedFieldConfig[]\n): DataFrame {\n  const custom: Record<string, string> = {\n    ...frame.meta?.custom, // keep the original meta.custom\n    // used by logsModel\n    lokiQueryStatKey: 'Summary: total bytes processed',\n  };\n\n  if (dataFrameHasLokiError(frame)) {\n    custom.error = 'Error when parsing some of the logs';\n  }\n\n  const meta: QueryResultMeta = {\n    preferredVisualisationType: 'logs',\n    limit: query?.maxLines,\n    searchWords: query ? getHighlighterExpressionsFromQuery(query.expr) : undefined,\n    custom,\n  };\n\n  const newFrame = setFrameMeta(frame, meta);\n  const derivedFields = getDerivedFields(newFrame, derivedFieldConfigs);\n  return {\n    ...newFrame,\n    fields: [...newFrame.fields, ...derivedFields],\n  };\n}\n\nfunction processStreamsFrames(\n  frames: DataFrame[],\n  queryMap: Map<string, LokiQuery>,\n  derivedFieldConfigs: DerivedFieldConfig[]\n): DataFrame[] {\n  return frames.map((frame) => {\n    const query = frame.refId !== undefined ? queryMap.get(frame.refId) : undefined;\n    return processStreamFrame(frame, query, derivedFieldConfigs);\n  });\n}\n\nfunction processMetricInstantFrames(frames: DataFrame[]): DataFrame[] {\n  return frames.length > 0 ? makeTableFrames(frames) : [];\n}\n\nfunction processMetricRangeFrames(frames: DataFrame[]): DataFrame[] {\n  const meta: QueryResultMeta = { preferredVisualisationType: 'graph' };\n  return frames.map((frame) => setFrameMeta(frame, meta));\n}\n\n// we split the frames into 3 groups, because we will handle\n// each group slightly differently\nfunction groupFrames(\n  frames: DataFrame[],\n  queryMap: Map<string, LokiQuery>\n): {\n  streamsFrames: DataFrame[];\n  metricInstantFrames: DataFrame[];\n  metricRangeFrames: DataFrame[];\n} {\n  const streamsFrames: DataFrame[] = [];\n  const metricInstantFrames: DataFrame[] = [];\n  const metricRangeFrames: DataFrame[] = [];\n\n  frames.forEach((frame) => {\n    if (!isMetricFrame(frame)) {\n      streamsFrames.push(frame);\n    } else {\n      const isInstantFrame = frame.refId != null && queryMap.get(frame.refId)?.queryType === LokiQueryType.Instant;\n      if (isInstantFrame) {\n        metricInstantFrames.push(frame);\n      } else {\n        metricRangeFrames.push(frame);\n      }\n    }\n  });\n\n  return { streamsFrames, metricInstantFrames, metricRangeFrames };\n}\n\nfunction improveError(error: DataQueryError | undefined, queryMap: Map<string, LokiQuery>): DataQueryError | undefined {\n  // many things are optional in an error-object, we need an error-message to exist,\n  // and we need to find the loki-query, based on the refId in the error-object.\n  if (error === undefined) {\n    return error;\n  }\n\n  const { refId, message } = error;\n  if (refId === undefined || message === undefined) {\n    return error;\n  }\n\n  const query = queryMap.get(refId);\n  if (query === undefined) {\n    return error;\n  }\n\n  if (message.includes('escape') && query.expr.includes('\\\\')) {\n    return {\n      ...error,\n      message: `${message}. Make sure that all special characters are escaped with \\\\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`,\n    };\n  }\n\n  return error;\n}\n\nexport function transformBackendResult(\n  response: DataQueryResponse,\n  queries: LokiQuery[],\n  derivedFieldConfigs: DerivedFieldConfig[]\n): DataQueryResponse {\n  const { data, error, ...rest } = response;\n\n  // in the typescript type, data is an array of basically anything.\n  // we do know that they have to be dataframes, so we make a quick check,\n  // this way we can be sure, and also typescript is happy.\n  const dataFrames = data.map((d) => {\n    if (!isDataFrame(d)) {\n      throw new Error('transformation only supports dataframe responses');\n    }\n    return d;\n  });\n\n  const queryMap = new Map(\n    queries.map((query) => {\n      const executedExpr = response.data.find((data) => data.refId === query.refId)?.meta.executedQueryString;\n      const executedQuery = {\n        ...query,\n        expr: executedExpr ? getExpressionFromExecutedQuery(executedExpr) : query.expr,\n      };\n\n      return [query.refId, executedQuery];\n    })\n  );\n\n  const { streamsFrames, metricInstantFrames, metricRangeFrames } = groupFrames(dataFrames, queryMap);\n\n  return {\n    ...rest,\n    error: improveError(error, queryMap),\n    data: [\n      ...processMetricRangeFrames(metricRangeFrames),\n      ...processMetricInstantFrames(metricInstantFrames),\n      ...processStreamsFrames(streamsFrames, queryMap, derivedFieldConfigs),\n    ],\n  };\n}\n","import { memo } from 'react';\nimport * as React from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { InlineField, Input, Stack } from '@grafana/ui';\n\nimport { LokiQuery, LokiQueryDirection, LokiQueryType } from '../types';\n\nexport interface LokiOptionFieldsProps {\n  lineLimitValue: string;\n  query: LokiQuery;\n  onChange: (value: LokiQuery) => void;\n  onRunQuery: () => void;\n  runOnBlur?: boolean;\n}\n\nexport const queryTypeOptions: Array<SelectableValue<LokiQueryType>> = [\n  { value: LokiQueryType.Range, label: 'Range', description: 'Run query over a range of time.' },\n  {\n    value: LokiQueryType.Instant,\n    label: 'Instant',\n    description: 'Run query against a single point in time. For this query, the \"To\" time is used.',\n  },\n];\n\nexport const queryDirections: Array<SelectableValue<LokiQueryDirection>> = [\n  { value: LokiQueryDirection.Backward, label: 'Backward', description: 'Search in backward direction.' },\n  {\n    value: LokiQueryDirection.Forward,\n    label: 'Forward',\n    description: 'Search in forward direction.',\n  },\n];\n\nif (config.featureToggles.lokiShardSplitting) {\n  queryDirections.push({\n    value: LokiQueryDirection.Scan,\n    label: 'Scan',\n    description: 'Experimental. Split the query into smaller units and stop at the requested log line limit.',\n    icon: 'exclamation-triangle',\n  });\n}\n\nif (config.featureToggles.lokiExperimentalStreaming) {\n  queryTypeOptions.push({\n    value: LokiQueryType.Stream,\n    label: 'Stream',\n    description: 'Run a query and keep sending results on an interval',\n  });\n}\n\nexport function getQueryDirectionLabel(direction: LokiQueryDirection) {\n  return queryDirections.find((queryDirection) => queryDirection.value === direction)?.label ?? 'Unknown';\n}\n\nexport function LokiOptionFields(props: LokiOptionFieldsProps) {\n  const { lineLimitValue, onRunQuery, runOnBlur, onChange } = props;\n  const query = props.query ?? {};\n\n  function onChangeQueryLimit(value: string) {\n    const nextQuery = { ...query, maxLines: preprocessMaxLines(value) };\n    onChange(nextQuery);\n  }\n\n  function onMaxLinesChange(e: React.SyntheticEvent<HTMLInputElement>) {\n    if (query.maxLines !== preprocessMaxLines(e.currentTarget.value)) {\n      onChangeQueryLimit(e.currentTarget.value);\n    }\n  }\n\n  function onReturnKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n    if (e.key === 'Enter') {\n      onRunQuery();\n    }\n  }\n\n  return (\n    <Stack alignItems=\"flex-start\" gap={0.5} aria-label=\"Loki extra field\">\n      {/*Line limit field*/}\n      <Stack wrap=\"nowrap\" gap={0} data-testid=\"lineLimitField\" aria-label=\"Line limit field\">\n        <InlineField label=\"Line limit\" tooltip={'Upper limit for number of log lines returned by query.'}>\n          <Input\n            className=\"width-4\"\n            placeholder=\"auto\"\n            type=\"number\"\n            min={0}\n            onChange={onMaxLinesChange}\n            onKeyDown={onReturnKeyDown}\n            value={lineLimitValue}\n            onBlur={() => {\n              if (runOnBlur) {\n                onRunQuery();\n              }\n            }}\n          />\n        </InlineField>\n      </Stack>\n    </Stack>\n  );\n}\n\nexport default memo(LokiOptionFields);\n\nexport function preprocessMaxLines(value: string): number | undefined {\n  const maxLines = parseInt(value, 10);\n  if (isNaN(maxLines) || maxLines < 0) {\n    return undefined;\n  }\n\n  return maxLines;\n}\n","import { lazy, Suspense } from 'react';\n\nimport { Props } from './MonacoQueryFieldProps';\n\nconst Field = lazy(() => import(/* webpackChunkName: \"loki-query-field\" */ './MonacoQueryField'));\n\nexport const MonacoQueryFieldLazy = (props: Props) => {\n  return (\n    <Suspense fallback={null}>\n      <Field {...props} />\n    </Suspense>\n  );\n};\n","import { useRef } from 'react';\n\nimport { MonacoQueryFieldLazy } from './MonacoQueryFieldLazy';\nimport { Props as MonacoProps } from './MonacoQueryFieldProps';\n\nexport type Props = Omit<MonacoProps, 'onRunQuery' | 'onBlur'> & {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n  onQueryType?: (query: string) => void;\n};\n\nexport const MonacoQueryFieldWrapper = (props: Props) => {\n  const lastRunValueRef = useRef<string | null>(null);\n  const { onRunQuery, onChange, ...rest } = props;\n\n  const handleRunQuery = (value: string) => {\n    lastRunValueRef.current = value;\n    onChange(value);\n    onRunQuery();\n  };\n\n  const handleBlur = (value: string) => {\n    onChange(value);\n  };\n\n  return <MonacoQueryFieldLazy onRunQuery={handleRunQuery} onBlur={handleBlur} onChange={onChange} {...rest} />;\n};\n","import { PureComponent, ReactNode } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\n\nimport { LokiDatasource } from '../datasource';\nimport { shouldRefreshLabels } from '../languageUtils';\nimport { LokiQuery, LokiOptions } from '../types';\n\nimport { MonacoQueryFieldWrapper } from './monaco-query-field/MonacoQueryFieldWrapper';\n\nexport interface LokiQueryFieldProps extends QueryEditorProps<LokiDatasource, LokiQuery, LokiOptions> {\n  ExtraFieldElement?: ReactNode;\n  placeholder?: string;\n  'data-testid'?: string;\n}\n\ninterface LokiQueryFieldState {\n  labelsLoaded: boolean;\n}\n\nexport class LokiQueryField extends PureComponent<LokiQueryFieldProps, LokiQueryFieldState> {\n  _isMounted = false;\n\n  constructor(props: LokiQueryFieldProps) {\n    super(props);\n\n    this.state = { labelsLoaded: false };\n  }\n\n  async componentDidMount() {\n    this._isMounted = true;\n    await this.props.datasource.languageProvider.start(this.props.range);\n    if (this._isMounted) {\n      this.setState({ labelsLoaded: true });\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  componentDidUpdate(prevProps: LokiQueryFieldProps) {\n    const {\n      range,\n      datasource: { languageProvider },\n    } = this.props;\n    const refreshLabels = shouldRefreshLabels(range, prevProps.range);\n    // We want to refresh labels when range changes (we round up intervals to a minute)\n    if (refreshLabels) {\n      languageProvider.fetchLabels({ timeRange: range });\n    }\n  }\n\n  onChangeQuery = (value: string, override?: boolean) => {\n    // Send text change to parent\n    const { query, onChange, onRunQuery } = this.props;\n    if (onChange) {\n      const nextQuery = { ...query, expr: value };\n      onChange(nextQuery);\n\n      if (override && onRunQuery) {\n        onRunQuery();\n      }\n    }\n  };\n\n  render() {\n    const { ExtraFieldElement, query, datasource, history, onRunQuery, range } = this.props;\n    const placeholder = this.props.placeholder ?? 'Enter a Loki query (run with Shift+Enter)';\n\n    return (\n      <>\n        <div\n          className=\"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1\"\n          data-testid={this.props['data-testid']}\n        >\n          <div className=\"gf-form--grow flex-shrink-1 min-width-15\">\n            <MonacoQueryFieldWrapper\n              datasource={datasource}\n              history={history ?? []}\n              onChange={this.onChangeQuery}\n              onRunQuery={onRunQuery}\n              initialValue={query.expr ?? ''}\n              placeholder={placeholder}\n              timeRange={range}\n            />\n          </div>\n        </div>\n        {ExtraFieldElement}\n      </>\n    );\n  }\n}\n","import { memo } from 'react';\n\nimport { AnnotationQuery } from '@grafana/data';\nimport { EditorField, EditorRow } from '@grafana/plugin-ui';\nimport { Input, Stack } from '@grafana/ui';\n\nimport { LokiQuery } from '../types';\n\nimport { LokiOptionFields } from './LokiOptionFields';\nimport { LokiQueryField } from './LokiQueryField';\nimport { LokiQueryEditorProps } from './types';\n\ntype Props = LokiQueryEditorProps & {\n  annotation?: AnnotationQuery<LokiQuery>;\n  onAnnotationChange?: (annotation: AnnotationQuery<LokiQuery>) => void;\n};\n\nexport const LokiAnnotationsQueryEditor = memo(function LokiAnnotationQueryEditor(props: Props) {\n  const { annotation, onAnnotationChange, history } = props;\n\n  // this should never happen, but we want to keep typescript happy\n  if (annotation === undefined || onAnnotationChange === undefined) {\n    return null;\n  }\n\n  const onChangeQuery = (query: LokiQuery) => {\n    onAnnotationChange({\n      ...annotation,\n      expr: query.expr,\n      maxLines: query.maxLines,\n      queryType: 'range',\n    });\n  };\n\n  const queryWithRefId: LokiQuery = {\n    refId: '',\n    expr: annotation.expr,\n    maxLines: annotation.maxLines,\n    instant: annotation.instant,\n    queryType: annotation.queryType,\n  };\n  return (\n    <Stack gap={5} direction=\"column\">\n      <Stack gap={0} direction=\"column\">\n        <LokiQueryField\n          datasource={props.datasource}\n          query={queryWithRefId}\n          onChange={onChangeQuery}\n          onRunQuery={() => {}}\n          history={history}\n          ExtraFieldElement={\n            <LokiOptionFields\n              lineLimitValue={queryWithRefId?.maxLines?.toString() || ''}\n              query={queryWithRefId}\n              onRunQuery={() => {}}\n              onChange={onChangeQuery}\n            />\n          }\n        />\n      </Stack>\n      <EditorRow>\n        <EditorField\n          label=\"Title\"\n          tooltip={\n            'Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.'\n          }\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"alertname\"\n            value={annotation.titleFormat}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                titleFormat: event.currentTarget.value,\n              });\n            }}\n          />\n        </EditorField>\n        <EditorField label=\"Tags\">\n          <Input\n            type=\"text\"\n            placeholder=\"label1,label2\"\n            value={annotation.tagKeys}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                tagKeys: event.currentTarget.value,\n              });\n            }}\n          />\n        </EditorField>\n        <EditorField\n          label=\"Text\"\n          tooltip={\n            'Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.'\n          }\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"instance\"\n            value={annotation.textFormat}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                textFormat: event.currentTarget.value,\n              });\n            }}\n          />\n        </EditorField>\n      </EditorRow>\n    </Stack>\n  );\n});\n","import { DataFrame, QueryHint } from '@grafana/data';\n\nimport {\n  isQueryWithLabelFilter,\n  isQueryPipelineErrorFiltering,\n  isQueryWithLabelFormat,\n  isQueryWithParser,\n  isQueryWithLineFilter,\n} from './queryUtils';\nimport {\n  dataFrameHasLevelLabel,\n  extractHasErrorLabelFromDataFrame,\n  extractLevelLikeLabelFromDataFrame,\n  extractLogParserFromDataFrame,\n} from './responseUtils';\n\nexport function getQueryHints(query: string, series: DataFrame[]): QueryHint[] {\n  if (series.length === 0) {\n    return [];\n  }\n\n  const hints: QueryHint[] = [];\n  const { queryWithParser, parserCount } = isQueryWithParser(query);\n\n  if (!queryWithParser) {\n    const { hasLogfmt, hasJSON, hasPack } = extractLogParserFromDataFrame(series[0]);\n    if (hasJSON) {\n      if (hasPack) {\n        hints.push({\n          type: 'ADD_UNPACK_PARSER',\n          label: 'Selected log stream selector has packed logs.',\n          fix: {\n            title: 'add unpack parser',\n            label: 'Consider using unpack parser.',\n            action: {\n              type: 'ADD_UNPACK_PARSER',\n              query,\n            },\n          },\n        });\n      } else {\n        hints.push({\n          type: 'ADD_JSON_PARSER',\n          label: 'Selected log stream selector has JSON formatted logs.',\n          fix: {\n            title: 'add json parser',\n            label: 'Consider using JSON parser.',\n            action: {\n              type: 'ADD_JSON_PARSER',\n              query,\n            },\n          },\n        });\n      }\n    }\n\n    if (hasLogfmt) {\n      hints.push({\n        type: 'ADD_LOGFMT_PARSER',\n        label: 'Selected log stream selector has logfmt formatted logs.',\n        fix: {\n          title: 'add logfmt parser',\n          label: 'Consider using logfmt parser to turn key-value pairs in your log lines to labels.',\n          action: {\n            type: 'ADD_LOGFMT_PARSER',\n            query,\n          },\n        },\n      });\n    }\n  }\n\n  if (queryWithParser) {\n    // To keep this simple, we consider pipeline error filtering hint only is query has up to 1 parser\n    if (parserCount === 1) {\n      const hasPipelineErrorFiltering = isQueryPipelineErrorFiltering(query);\n      const hasError = extractHasErrorLabelFromDataFrame(series[0]);\n      if (hasError && !hasPipelineErrorFiltering) {\n        hints.push({\n          type: 'ADD_NO_PIPELINE_ERROR',\n          label: 'Some logs in your selected log streams have parsing error.',\n          fix: {\n            title: 'remove pipeline errors',\n            label: 'Consider filtering out logs with parsing errors.',\n            action: {\n              type: 'ADD_NO_PIPELINE_ERROR',\n              query,\n            },\n          },\n        });\n      }\n    }\n\n    const hasLabelFilter = isQueryWithLabelFilter(query);\n\n    if (!hasLabelFilter) {\n      hints.push({\n        type: 'ADD_LABEL_FILTER',\n        label: 'Consider filtering logs by their label and value.',\n        fix: {\n          title: 'add label filter',\n          label: '',\n          action: {\n            type: 'ADD_LABEL_FILTER',\n            query,\n          },\n        },\n      });\n    }\n  }\n\n  const queryWithLabelFormat = isQueryWithLabelFormat(query);\n  if (!queryWithLabelFormat) {\n    const hasLevel = dataFrameHasLevelLabel(series[0]);\n    const levelLikeLabel = extractLevelLikeLabelFromDataFrame(series[0]);\n\n    // Add hint only if we don't have \"level\" label and have level-like label\n    if (!hasLevel && levelLikeLabel) {\n      hints.push({\n        type: 'ADD_LEVEL_LABEL_FORMAT',\n        label: `Some logs in your selected log stream have \"${levelLikeLabel}\" label.`,\n        fix: {\n          title: 'add label level format',\n          label: `If ${levelLikeLabel} label has level values, consider using label_format to rename it to \"level\". Level label can be then visualized in log volumes.`,\n          action: {\n            type: 'ADD_LEVEL_LABEL_FORMAT',\n            query,\n            options: {\n              renameTo: 'level',\n              originalLabel: levelLikeLabel,\n            },\n          },\n        },\n      });\n    }\n  }\n\n  const hasLineFilter = isQueryWithLineFilter(query);\n\n  if (!hasLineFilter) {\n    hints.push({\n      type: 'ADD_LINE_FILTER',\n      label: 'Consider filtering logs for specific string.',\n      fix: {\n        title: 'add line filter',\n        label: '',\n        action: {\n          type: 'ADD_LINE_FILTER',\n          query,\n        },\n      },\n    });\n  }\n\n  return hints;\n}\n","import { groupBy, partition } from 'lodash';\nimport { Observable, Subscriber, Subscription } from 'rxjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { DataQueryRequest, LoadingState, DataQueryResponse, QueryResultMetaStat } from '@grafana/data';\n\nimport { LokiDatasource } from './datasource';\nimport { combineResponses, replaceResponses } from './mergeResponses';\nimport { adjustTargetsFromResponseState, runSplitQuery } from './querySplitting';\nimport { getSelectorForShardValues, interpolateShardingSelector, requestSupportsSharding } from './queryUtils';\nimport { isRetriableError } from './responseUtils';\nimport { LokiQuery } from './types';\n\n/**\n * Query splitting by stream shards.\n * Query splitting was introduced in Loki to optimize querying for long intervals and high volume of data,\n * dividing a big request into smaller sub-requests, combining and displaying the results as they arrive.\n *\n * This approach, inspired by the time-based query splitting, takes advantage of the __stream_shard__\n * internal label, representing how data is spread into different sources that can be queried individually.\n *\n * The main entry point of this module is runShardSplitQuery(), which prepares the query for execution and\n * passes it to splitQueriesByStreamShard() to begin the querying loop.\n *\n * splitQueriesByStreamShard() has the following structure:\n * - Creates and returns an Observable to which the UI will subscribe\n * - Requests the __stream_shard__ values of the selected service:\n *   . If there are no shard values, it falls back to the standard querying approach of the data source in runNonSplitRequest()\n *   . If there are shards:\n *     - It sorts them by value, descending. Higher shard numbers correspond with the least volume.\n *     - It defines an initial group size, roughly Math.sqrt(amountOfShards).\n *     - It begins the querying loop with runNextRequest().\n * - runNextRequest() will create a group of groupSize shards from the nth shard (cycle), and has the following internal structure:\n *   . groupShardRequests() returns an array of shards from cycle to cycle + groupSize.\n *   . interpolateShardingSelector() will update the stream selector with the shard numbers in the current group.\n *   . After query execution:\n *     - If the response is successful:\n *       . It will add new data to the response with combineResponses()\n *       . Using the data and meta data of the response, updateGroupSizeFromResponse() will increase or decrease the group size.\n *       . nextRequest() will use the current cycle and group size to determine the next request or complete execution with done().\n *     - If the response is unsuccessful:\n *       . If the response is not a query error, and the group size bigger than 1, it will decrease the group size.\n *       . If the group size is already 1, it will retry the request up to 2 times.\n *       . If there are retry attempts, it will retry the current cycle, or else stop querying.\n * - Once all request groups have been executed, it will be done().\n */\n\nexport function runShardSplitQuery(datasource: LokiDatasource, request: DataQueryRequest<LokiQuery>) {\n  const queries = request.targets\n    .filter((query) => query.expr)\n    .filter((query) => !query.hide)\n    .map((query) => datasource.applyTemplateVariables(query, request.scopedVars, request.filters));\n\n  return splitQueriesByStreamShard(datasource, request, queries);\n}\n\nfunction splitQueriesByStreamShard(\n  datasource: LokiDatasource,\n  request: DataQueryRequest<LokiQuery>,\n  splittingTargets: LokiQuery[]\n) {\n  let shouldStop = false;\n  let mergedResponse: DataQueryResponse = { data: [], state: LoadingState.Streaming, key: uuidv4() };\n  let subquerySubscription: Subscription | null = null;\n  let retriesMap = new Map<string, number>();\n  let retryTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const runNextRequest = (subscriber: Subscriber<DataQueryResponse>, group: number, groups: ShardedQueryGroup[]) => {\n    let nextGroupSize = groups[group].groupSize;\n    const { shards, groupSize, cycle } = groups[group];\n    let retrying = false;\n\n    if (subquerySubscription != null) {\n      subquerySubscription.unsubscribe();\n      subquerySubscription = null;\n    }\n\n    const done = () => {\n      mergedResponse.state = shouldStop ? LoadingState.Error : LoadingState.Done;\n      subscriber.next(mergedResponse);\n      subscriber.complete();\n    };\n\n    if (shouldStop) {\n      done();\n      return;\n    }\n\n    const nextRequest = () => {\n      const nextGroup =\n        groups[group + 1] && groupHasPendingRequests(groups[group + 1])\n          ? groups[group + 1]\n          : groups.find((shardGroup) => groupHasPendingRequests(shardGroup));\n\n      if (nextGroup === undefined) {\n        done();\n        return;\n      }\n      groups[group].groupSize = nextGroupSize;\n      runNextRequest(subscriber, groups.indexOf(nextGroup), groups);\n    };\n\n    const retry = (errorResponse?: DataQueryResponse) => {\n      try {\n        if (errorResponse && !isRetriableError(errorResponse)) {\n          return false;\n        }\n      } catch (e) {\n        console.error(e);\n        shouldStop = true;\n        return false;\n      }\n\n      if (groupSize !== undefined && groupSize > 1) {\n        groups[group].groupSize = Math.floor(Math.sqrt(groupSize));\n        debug(`Possible time out, new group size ${groups[group].groupSize}`);\n        retrying = true;\n        runNextRequest(subscriber, group, groups);\n        return true;\n      }\n\n      const key = `${group}_${cycle}`;\n      const retries = retriesMap.get(key) ?? 0;\n\n      if (retries > 1) {\n        shouldStop = true;\n        return false;\n      }\n\n      retriesMap.set(key, retries + 1);\n\n      retryTimer = setTimeout(\n        () => {\n          console.warn(`Retrying ${group} ${cycle} (${retries + 1})`);\n          runNextRequest(subscriber, group, groups);\n          retryTimer = null;\n        },\n        1500 * Math.pow(2, retries)\n      ); // Exponential backoff\n\n      retrying = true;\n\n      return true;\n    };\n\n    const targets = adjustTargetsFromResponseState(groups[group].targets, mergedResponse);\n    if (!targets.length) {\n      nextRequest();\n      return;\n    }\n\n    const shardsToQuery =\n      shards && cycle !== undefined && groupSize ? groupShardRequests(shards, cycle, groupSize) : [];\n    const subRequest = { ...request, targets: interpolateShardingSelector(targets, shardsToQuery) };\n    // Request may not have a request id\n    if (request.requestId) {\n      subRequest.requestId =\n        shardsToQuery.length > 0 ? `${request.requestId}_shard_${group}_${cycle}_${groupSize}` : request.requestId;\n    }\n\n    debug(shardsToQuery.length ? `Querying ${shardsToQuery.join(', ')}` : 'Running regular query');\n\n    subquerySubscription = runSplitQuery(datasource, subRequest, {\n      skipPartialUpdates: true,\n      disableRetry: true,\n    }).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        if ((partialResponse.errors ?? []).length > 0 || partialResponse.error != null) {\n          if (retry(partialResponse)) {\n            return;\n          }\n        }\n        if (groupSize && cycle !== undefined && shards !== undefined) {\n          nextGroupSize = constrainGroupSize(\n            cycle + groupSize,\n            updateGroupSizeFromResponse(partialResponse, groups[group]),\n            shards.length\n          );\n          if (nextGroupSize !== groupSize) {\n            debug(`New group size ${nextGroupSize}`);\n          }\n        }\n        mergedResponse =\n          shardsToQuery.length > 0\n            ? combineResponses(mergedResponse, partialResponse)\n            : replaceResponses(mergedResponse, partialResponse);\n\n        // When we delegate query running to runSplitQuery(), we will receive partial updates here, and complete\n        // will be called when all the sub-requests were completed, so we need to show partial progress here.\n        if (shardsToQuery.length === 0) {\n          subscriber.next(mergedResponse);\n        }\n      },\n      complete: () => {\n        if (retrying) {\n          return;\n        }\n        subscriber.next(mergedResponse);\n        nextRequest();\n      },\n      error: (error: unknown) => {\n        console.error(error, { msg: 'failed to shard' });\n        subscriber.next(mergedResponse);\n        if (retry()) {\n          return;\n        }\n        nextRequest();\n      },\n    });\n  };\n\n  const response = new Observable<DataQueryResponse>((subscriber) => {\n    groupTargetsByQueryType(splittingTargets, datasource, request).then((groupedRequests) => {\n      runNextRequest(subscriber, 0, groupedRequests);\n    });\n    return () => {\n      shouldStop = true;\n      if (retryTimer) {\n        clearTimeout(retryTimer);\n      }\n      if (subquerySubscription != null) {\n        subquerySubscription.unsubscribe();\n        subquerySubscription = null;\n      }\n    };\n  });\n\n  return response;\n}\n\ninterface ShardedQueryGroup {\n  targets: LokiQuery[];\n  shards?: number[];\n  groupSize?: number;\n  cycle?: number;\n}\n\nasync function groupTargetsByQueryType(\n  targets: LokiQuery[],\n  datasource: LokiDatasource,\n  request: DataQueryRequest<LokiQuery>\n) {\n  const [shardedQueries, otherQueries] = partition(targets, (query) => requestSupportsSharding([query]));\n  const groups: ShardedQueryGroup[] = [];\n\n  if (otherQueries.length) {\n    groups.push({\n      targets: otherQueries,\n    });\n  }\n\n  const selectorPartition = groupBy(shardedQueries, (query) => getSelectorForShardValues(query.expr));\n  for (const selector in selectorPartition) {\n    try {\n      const values = await datasource.languageProvider.fetchLabelValues('__stream_shard__', {\n        timeRange: request.range,\n        streamSelector: selector,\n      });\n      const shards = values.map((value) => parseInt(value, 10));\n      if (shards) {\n        shards.sort((a, b) => b - a);\n        debug(`Querying ${selector} with shards ${shards.join(', ')}`);\n      }\n      groups.push({\n        targets: selectorPartition[selector],\n        shards: shards.length ? shards : undefined,\n        groupSize: shards.length ? getInitialGroupSize(shards) : undefined,\n        cycle: 0,\n      });\n    } catch (error) {\n      console.error(error, { msg: 'failed to fetch label values for __stream_shard__' });\n      groups.push({\n        targets: selectorPartition[selector],\n      });\n    }\n  }\n\n  return groups;\n}\n\nfunction groupHasPendingRequests(group: ShardedQueryGroup) {\n  if (group.cycle === undefined || !group.groupSize || !group.shards) {\n    return false;\n  }\n  const { cycle, groupSize, shards } = group;\n  const nextCycle = Math.min(cycle + groupSize, shards.length);\n  group.cycle = nextCycle;\n  return cycle < shards.length && nextCycle <= shards.length;\n}\n\nfunction updateGroupSizeFromResponse(response: DataQueryResponse, group: ShardedQueryGroup) {\n  const { groupSize: currentSize } = group;\n  if (!currentSize) {\n    return 1;\n  }\n  if (!response.data.length) {\n    // Empty response, increase group size\n    return currentSize + 1;\n  }\n\n  const metaExecutionTime: QueryResultMetaStat | undefined = response.data[0].meta?.stats?.find(\n    (stat: QueryResultMetaStat) => stat.displayName === 'Summary: exec time'\n  );\n\n  if (metaExecutionTime) {\n    const executionTime = Math.round(metaExecutionTime.value);\n    debug(`${metaExecutionTime.value}`);\n    // Positive scenarios\n    if (executionTime <= 1) {\n      return Math.floor(currentSize * 1.5);\n    } else if (executionTime < 6) {\n      return Math.ceil(currentSize * 1.1);\n    }\n\n    // Negative scenarios\n    if (currentSize === 1) {\n      return currentSize;\n    } else if (executionTime < 20) {\n      return Math.ceil(currentSize * 0.9);\n    } else {\n      return Math.floor(currentSize / 2);\n    }\n  }\n\n  return currentSize;\n}\n\n/**\n * Prevents the group size for ever being more than maxFactor% of the pending shards.\n */\nfunction constrainGroupSize(cycle: number, groupSize: number, shards: number) {\n  const maxFactor = 0.7;\n  return Math.min(groupSize, Math.max(Math.floor((shards - cycle) * maxFactor), 1));\n}\n\nfunction groupShardRequests(shards: number[], start: number, groupSize: number) {\n  if (start === shards.length) {\n    return [-1];\n  }\n  return shards.slice(start, start + groupSize);\n}\n\nfunction getInitialGroupSize(shards: number[]) {\n  return Math.floor(Math.sqrt(shards.length));\n}\n\n// Enable to output debugging logs\nconst DEBUG_ENABLED = Boolean(localStorage.getItem(`loki.sharding_debug_enabled`));\nfunction debug(message: string) {\n  if (!DEBUG_ENABLED) {\n    return;\n  }\n  console.log(message);\n}\n","import { map, Observable, defer, mergeMap } from 'rxjs';\n\nimport {\n  DataFrameJSON,\n  DataQueryRequest,\n  DataQueryResponse,\n  LiveChannelEvent,\n  LiveChannelScope,\n  LoadingState,\n  StreamingDataFrame,\n} from '@grafana/data';\nimport { getGrafanaLiveSrv, config } from '@grafana/runtime';\n\nimport { LokiDatasource } from './datasource';\nimport { LokiQuery } from './types';\n\n/**\n * Calculate a unique key for the query.  The key is used to pick a channel and should\n * be unique for each distinct query execution plan.  This key is not secure and is only picked to avoid\n * possible collisions\n */\nexport async function getLiveStreamKey(query: LokiQuery): Promise<string> {\n  const str = JSON.stringify({ expr: query.expr });\n\n  const msgUint8 = new TextEncoder().encode(str); // encode as (utf-8) Uint8Array\n  const hashBuffer = await crypto.subtle.digest('SHA-1', msgUint8); // hash the message\n  const hashArray = Array.from(new Uint8Array(hashBuffer.slice(0, 8))); // first 8 bytes\n  return `${query.datasource?.uid}/${hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')}/${config.bootData.user.orgId}`;\n}\n\n// This will get both v1 and v2 result formats\nexport function doLokiChannelStream(\n  query: LokiQuery,\n  ds: LokiDatasource,\n  options: DataQueryRequest<LokiQuery>\n): Observable<DataQueryResponse> {\n  // maximum time to keep values\n  const range = options.range;\n  const maxDelta = range.to.valueOf() - range.from.valueOf() + 1000;\n  let maxLength = options.maxDataPoints ?? 1000;\n  if (maxLength > 100) {\n    // for small buffers, keep them small\n    maxLength *= 2;\n  }\n\n  let frame: StreamingDataFrame | undefined = undefined;\n  const updateFrame = (msg: LiveChannelEvent<unknown>) => {\n    if ('message' in msg && msg.message) {\n      const p: DataFrameJSON = msg.message;\n      if (!frame) {\n        frame = StreamingDataFrame.fromDataFrameJSON(p, {\n          maxLength,\n          maxDelta,\n          displayNameFormat: query.legendFormat,\n        });\n      } else {\n        frame.push(p);\n      }\n    }\n    return frame;\n  };\n\n  return defer(() => getLiveStreamKey(query)).pipe(\n    mergeMap((key) => {\n      return getGrafanaLiveSrv()\n        .getStream({\n          scope: LiveChannelScope.DataSource,\n          namespace: ds.uid,\n          path: `tail/${key}`,\n          data: {\n            ...query,\n            timeRange: {\n              from: range.from.valueOf().toString(),\n              to: range.to.valueOf().toString(),\n            },\n          },\n        })\n        .pipe(\n          map((evt) => {\n            const frame = updateFrame(evt);\n            return {\n              data: frame ? [frame] : [],\n              state: LoadingState.Streaming,\n            };\n          })\n        );\n    })\n  );\n}\n\nexport const convertToWebSocketUrl = (url: string) => {\n  const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';\n  let backend = `${protocol}${window.location.host}${config.appSubUrl}`;\n  if (backend.endsWith('/')) {\n    backend = backend.slice(0, -1);\n  }\n  return `${backend}${url}`;\n};\n","import { cloneDeep, map as lodashMap } from 'lodash';\nimport { lastValueFrom, merge, Observable, of, throwError } from 'rxjs';\nimport { catchError, map, switchMap, tap } from 'rxjs/operators';\n\nimport {\n  AbstractQuery,\n  AnnotationEvent,\n  AnnotationQueryRequest,\n  CoreApp,\n  DataFrame,\n  DataFrameView,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceInstanceSettings,\n  DataSourceWithLogsContextSupport,\n  DataSourceWithSupplementaryQueriesSupport,\n  SupplementaryQueryType,\n  DataSourceWithQueryExportSupport,\n  DataSourceWithQueryImportSupport,\n  Labels,\n  LoadingState,\n  LogRowModel,\n  QueryFixAction,\n  QueryHint,\n  rangeUtil,\n  ScopedVars,\n  SupplementaryQueryOptions,\n  TimeRange,\n  LogRowContextOptions,\n  DataSourceWithToggleableQueryFiltersSupport,\n  ToggleFilterAction,\n  QueryFilterOptions,\n  renderLegendFormat,\n  LegacyMetricFindQueryOptions,\n  AdHocVariableFilter,\n  urlUtil,\n  MetricFindValue,\n  DataSourceGetTagValuesOptions,\n  DataSourceGetTagKeysOptions,\n  DataSourceWithQueryModificationSupport,\n  LogsVolumeOption,\n  LogsSampleOptions,\n  QueryVariableModel,\n  CustomVariableModel,\n} from '@grafana/data';\nimport { Duration } from '@grafana/lezer-logql';\nimport { BackendSrvRequest, config, DataSourceWithBackend, getTemplateSrv, TemplateSrv } from '@grafana/runtime';\nimport { DataQuery } from '@grafana/schema';\n\nimport LanguageProvider from './LanguageProvider';\nimport { LiveStreams, LokiLiveTarget } from './LiveStreams';\nimport { LogContextProvider } from './LogContextProvider';\nimport { LokiVariableSupport } from './LokiVariableSupport';\nimport { transformBackendResult } from './backendResultTransformer';\nimport { LokiAnnotationsQueryEditor } from './components/AnnotationsQueryEditor';\nimport { placeHolderScopedVars } from './components/monaco-query-field/monaco-completion-provider/validation';\nimport { escapeLabelValueInSelector, isRegexSelector, getLabelTypeFromFrame } from './languageUtils';\nimport { labelNamesRegex, labelValuesRegex } from './migrations/variableQueryMigrations';\nimport {\n  addLabelFormatToQuery,\n  addLabelToQuery,\n  addNoPipelineErrorToQuery,\n  addParserToQuery,\n  removeCommentsFromQuery,\n  addFilterAsLabelFilter,\n  getParserPositions,\n  toLabelFilter,\n  addLineFilter,\n  findLastPosition,\n  getLabelFilterPositions,\n  queryHasFilter,\n  removeLabelFromQuery,\n} from './modifyQuery';\nimport { getQueryHints } from './queryHints';\nimport { runSplitQuery } from './querySplitting';\nimport {\n  getLogQueryFromMetricsQuery,\n  getLokiQueryFromDataQuery,\n  getNodesFromQuery,\n  getNormalizedLokiQuery,\n  getStreamSelectorsFromQuery,\n  isLogsQuery,\n  isQueryWithError,\n  requestSupportsSharding,\n  requestSupportsSplitting,\n} from './queryUtils';\nimport { replaceVariables, returnVariables } from './querybuilder/parsingUtils';\nimport { runShardSplitQuery } from './shardQuerySplitting';\nimport { convertToWebSocketUrl, doLokiChannelStream } from './streaming';\nimport { trackQuery } from './tracking';\nimport {\n  LokiOptions,\n  LokiQuery,\n  LokiQueryType,\n  LokiVariableQuery,\n  LokiVariableQueryType,\n  QueryStats,\n  SupportingQueryType,\n} from './types';\n\nexport type RangeQueryOptions = DataQueryRequest<LokiQuery> | AnnotationQueryRequest<LokiQuery>;\nexport const DEFAULT_MAX_LINES = 1000;\nexport const DEFAULT_MAX_LINES_SAMPLE = 10;\nexport const LOKI_ENDPOINT = '/loki/api/v1';\nexport const REF_ID_DATA_SAMPLES = 'loki-data-samples';\nexport const REF_ID_STARTER_ANNOTATION = 'annotation-';\nexport const REF_ID_STARTER_LOG_ROW_CONTEXT = 'log-row-context-query-';\nexport const REF_ID_STARTER_LOG_VOLUME = 'log-volume-';\nexport const REF_ID_STARTER_LOG_SAMPLE = 'log-sample-';\nexport const REF_ID_STARTER_STATS = 'log-stats-';\n\nconst NS_IN_MS = 1000000;\n\nexport function makeRequest(\n  query: LokiQuery,\n  range: TimeRange,\n  app: CoreApp,\n  requestId: string,\n  hideFromInspector?: boolean\n): DataQueryRequest<LokiQuery> {\n  const intervalInfo = rangeUtil.calculateInterval(range, 1);\n  return {\n    targets: [query],\n    requestId,\n    interval: intervalInfo.interval,\n    intervalMs: intervalInfo.intervalMs,\n    range: range,\n    scopedVars: {},\n    timezone: 'UTC',\n    app,\n    startTime: Date.now(),\n    hideFromInspector,\n  };\n}\n\nexport class LokiDatasource\n  extends DataSourceWithBackend<LokiQuery, LokiOptions>\n  implements\n    DataSourceWithLogsContextSupport,\n    DataSourceWithSupplementaryQueriesSupport<LokiQuery>,\n    DataSourceWithQueryImportSupport<LokiQuery>,\n    DataSourceWithQueryExportSupport<LokiQuery>,\n    DataSourceWithToggleableQueryFiltersSupport<LokiQuery>,\n    DataSourceWithQueryModificationSupport<LokiQuery>\n{\n  private streams = new LiveStreams();\n  private logContextProvider: LogContextProvider;\n  languageProvider: LanguageProvider;\n  maxLines: number;\n\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<LokiOptions>,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n\n    this.languageProvider = new LanguageProvider(this);\n    const settingsData = instanceSettings.jsonData || {};\n    this.maxLines = parseInt(settingsData.maxLines ?? '0', 10) || DEFAULT_MAX_LINES;\n    this.annotations = {\n      QueryEditor: LokiAnnotationsQueryEditor,\n    };\n    this.variables = new LokiVariableSupport(this);\n    this.logContextProvider = new LogContextProvider(this);\n  }\n\n  /**\n   * Implemented for DataSourceWithSupplementaryQueriesSupport.\n   * It generates a DataQueryRequest for a specific supplementary query type.\n   * @returns A DataQueryRequest for the supplementary queries or undefined if not supported.\n   */\n  getSupplementaryRequest(\n    type: SupplementaryQueryType,\n    request: DataQueryRequest<LokiQuery>,\n    options?: SupplementaryQueryOptions\n  ): DataQueryRequest<LokiQuery> | undefined {\n    switch (type) {\n      case SupplementaryQueryType.LogsVolume:\n        const logsVolumeOption: LogsVolumeOption =\n          options?.type === SupplementaryQueryType.LogsVolume ? options : { type };\n        return this.getLogsVolumeDataProvider(request, logsVolumeOption);\n      case SupplementaryQueryType.LogsSample:\n        const logsSampleOption: LogsSampleOptions =\n          options?.type === SupplementaryQueryType.LogsSample ? options : { type };\n        return this.getLogsSampleDataProvider(request, logsSampleOption);\n      default:\n        return undefined;\n    }\n  }\n\n  /**\n   * Implemented for DataSourceWithSupplementaryQueriesSupport.\n   * It returns the supplementary types that the data source supports.\n   * @returns An array of supported supplementary query types.\n   */\n  getSupportedSupplementaryQueryTypes(): SupplementaryQueryType[] {\n    return [SupplementaryQueryType.LogsVolume, SupplementaryQueryType.LogsSample];\n  }\n\n  /**\n   * Implemented for DataSourceWithSupplementaryQueriesSupport.\n   * It retrieves supplementary queries based on the provided options and Loki query.\n   * @returns A supplemented Loki query or undefined if unsupported.\n   */\n  getSupplementaryQuery(options: SupplementaryQueryOptions, query: LokiQuery): LokiQuery | undefined {\n    if (query.hide) {\n      return undefined;\n    }\n\n    const normalizedQuery = getNormalizedLokiQuery(query);\n    let expr = removeCommentsFromQuery(normalizedQuery.expr);\n    let isQuerySuitable = false;\n\n    switch (options.type) {\n      case SupplementaryQueryType.LogsVolume:\n        // it has to be a logs-producing range-query\n        isQuerySuitable = !!(expr && isLogsQuery(expr) && normalizedQuery.queryType === LokiQueryType.Range);\n        if (!isQuerySuitable) {\n          return undefined;\n        }\n\n        const dropErrorExpression = `${expr} | drop __error__`;\n        const field = options.field || 'level, detected_level';\n        if (isQueryWithError(this.interpolateString(dropErrorExpression, placeHolderScopedVars)) === false) {\n          expr = dropErrorExpression;\n        }\n\n        return {\n          ...normalizedQuery,\n          refId: `${REF_ID_STARTER_LOG_VOLUME}${normalizedQuery.refId}`,\n          queryType: LokiQueryType.Range,\n          supportingQueryType: SupportingQueryType.LogsVolume,\n          expr: `sum by (${field}) (count_over_time(${expr}[$__auto]))`,\n        };\n\n      case SupplementaryQueryType.LogsSample:\n        // it has to be a metric query\n        isQuerySuitable = !!(expr && !isLogsQuery(expr));\n        if (!isQuerySuitable) {\n          return undefined;\n        }\n        return {\n          ...normalizedQuery,\n          queryType: LokiQueryType.Range,\n          refId: `${REF_ID_STARTER_LOG_SAMPLE}${normalizedQuery.refId}`,\n          expr: getLogQueryFromMetricsQuery(expr),\n          maxLines: Number.isNaN(Number(options.limit)) ? this.maxLines : Number(options.limit),\n          supportingQueryType: SupportingQueryType.LogsSample,\n        };\n\n      default:\n        return undefined;\n    }\n  }\n\n  /**\n   * Private method used in the `getDataProvider` for DataSourceWithSupplementaryQueriesSupport, specifically for Logs volume queries.\n   * @returns A DataQueryRequest or undefined if no suitable queries are found.\n   */\n  private getLogsVolumeDataProvider(\n    request: DataQueryRequest<LokiQuery>,\n    options: LogsVolumeOption\n  ): DataQueryRequest<LokiQuery> | undefined {\n    const logsVolumeRequest = cloneDeep(request);\n    const targets = logsVolumeRequest.targets\n      .map((query) => this.getSupplementaryQuery(options, query))\n      .filter((query): query is LokiQuery => !!query);\n\n    if (!targets.length) {\n      return undefined;\n    }\n\n    return { ...logsVolumeRequest, targets };\n  }\n\n  /**\n   * Private method used in the `getDataProvider` for DataSourceWithSupplementaryQueriesSupport, specifically for Logs sample queries.\n   * @returns A DataQueryRequest or undefined if no suitable queries are found.\n   */\n  private getLogsSampleDataProvider(\n    request: DataQueryRequest<LokiQuery>,\n    options?: LogsSampleOptions\n  ): DataQueryRequest<LokiQuery> | undefined {\n    const logsSampleRequest = cloneDeep(request);\n    const targets = logsSampleRequest.targets\n      .map((query) => this.getSupplementaryQuery({ type: SupplementaryQueryType.LogsSample, limit: 100 }, query))\n      .filter((query): query is LokiQuery => !!query);\n\n    if (!targets.length) {\n      return undefined;\n    }\n    return { ...logsSampleRequest, targets };\n  }\n\n  /**\n   * Required by DataSourceApi. It executes queries based on the provided DataQueryRequest.\n   * @returns An Observable of DataQueryResponse containing the query results.\n   */\n  query(request: DataQueryRequest<LokiQuery>): Observable<DataQueryResponse> {\n    const queries = request.targets\n      .map(getNormalizedLokiQuery) // used to \"fix\" the deprecated `.queryType` prop\n      .map((q) => ({\n        ...q,\n        maxLines: q.maxLines ?? this.maxLines,\n        scopes:\n          config.featureToggles.scopeFilters && config.featureToggles.logQLScope\n            ? request.scopes?.flatMap((scope) => scope.spec.filters)\n            : undefined,\n      }));\n\n    const fixedRequest: DataQueryRequest<LokiQuery> = {\n      ...request,\n      targets: queries,\n    };\n\n    const streamQueries = fixedRequest.targets.filter((q) => q.queryType === LokiQueryType.Stream);\n    if (\n      config.featureToggles.lokiExperimentalStreaming &&\n      streamQueries.length > 0 &&\n      fixedRequest.rangeRaw?.to === 'now'\n    ) {\n      // this is still an in-development feature,\n      // we do not support mixing stream-queries with normal-queries for now.\n      const streamRequest = {\n        ...fixedRequest,\n        targets: streamQueries,\n      };\n      return merge(\n        ...streamQueries.map((q) =>\n          doLokiChannelStream(\n            this.applyTemplateVariables(q, request.scopedVars, request.filters),\n            this, // the datasource\n            streamRequest\n          )\n        )\n      );\n    }\n\n    if (fixedRequest.liveStreaming) {\n      return this.runLiveQueryThroughBackend(fixedRequest);\n    }\n\n    if (config.featureToggles.lokiShardSplitting && requestSupportsSharding(fixedRequest.targets)) {\n      return runShardSplitQuery(this, fixedRequest);\n    } else if (config.featureToggles.lokiQuerySplitting && requestSupportsSplitting(fixedRequest.targets)) {\n      return runSplitQuery(this, fixedRequest);\n    }\n\n    const startTime = new Date();\n    return this.runQuery(fixedRequest).pipe(tap((response) => trackQuery(response, fixedRequest, startTime)));\n  }\n\n  /**\n   * Executes requests through the backend using the `super.query()`, as part of the `query` method in DataSourceWithBackend.\n   * @returns An Observable of transformed DataQueryResponse results from the backend.\n   */\n  runQuery(fixedRequest: DataQueryRequest<LokiQuery>) {\n    return super\n      .query(fixedRequest)\n      .pipe(\n        map((response) =>\n          transformBackendResult(response, fixedRequest.targets, this.instanceSettings.jsonData.derivedFields ?? [])\n        )\n      );\n  }\n\n  /**\n   * Used within the `query` to execute live queries.\n   * It is intended for logs-queries, not metric queries.\n   * @returns An Observable of DataQueryResponse with live query results or an empty response if no suitable queries are found.\n   * @todo: The name says \"backend\" but it's actually running the query through the frontend. We should fix this.\n   */\n  private runLiveQueryThroughBackend(request: DataQueryRequest<LokiQuery>): Observable<DataQueryResponse> {\n    // and only for logs-queries, not metric queries\n    const logsQueries = request.targets.filter((query) => query.expr !== '' && isLogsQuery(query.expr));\n    if (logsQueries.length === 0) {\n      return of({\n        data: [],\n        state: LoadingState.Done,\n      });\n    }\n\n    const subQueries = logsQueries.map((query) => {\n      const interpolatedQuery = this.applyTemplateVariables(query, request.scopedVars, request.filters);\n      const maxDataPoints = interpolatedQuery.maxLines || this.maxLines;\n      // FIXME: currently we are running it through the frontend still.\n      return this.runLiveQuery(interpolatedQuery, maxDataPoints);\n    });\n\n    return merge(...subQueries);\n  }\n\n  /**\n   * Used within the `runLiveQuery` to create a live target for a Loki query.\n   * @returns A LokiLiveTarget object containing the necessary information for a live query.\n   */\n  private createLiveTarget(target: LokiQuery, maxDataPoints: number): LokiLiveTarget {\n    const query = target.expr;\n    const baseUrl = this.instanceSettings.url;\n    const params = urlUtil.serializeParams({ query });\n\n    return {\n      query,\n      url: convertToWebSocketUrl(`${baseUrl}/loki/api/v1/tail?${params}`),\n      refId: target.refId,\n      size: maxDataPoints,\n    };\n  }\n\n  /**\n   * Runs live queries, which involves creating a WebSocket connection to listen for new logs.\n   * It returns a slightly different DataQueryResponse compared to runQueries. It provides a single DataFrame\n   * even if there are multiple Loki streams. Common labels are set on dataFrame.labels, and unique labels per row are\n   * available in dataFrame.fields.labels.\n   * @returns An Observable of DataQueryResponse with streaming data or an error message if live tailing encounters an issue.\n   */\n  private runLiveQuery = (target: LokiQuery, maxDataPoints: number): Observable<DataQueryResponse> => {\n    const liveTarget = this.createLiveTarget(target, maxDataPoints);\n\n    return this.streams.getStream(liveTarget).pipe(\n      map((data) => ({\n        data: data || [],\n        key: `loki-${liveTarget.refId}`,\n        state: LoadingState.Streaming,\n      })),\n      catchError((err) => {\n        return throwError(() => `Live tailing was stopped due to following error: ${err.reason}`);\n      })\n    );\n  };\n\n  /**\n   * Implemented as a part of DataSourceApi. Interpolates variables and adds ad hoc filters to a list of Loki queries.\n   * @returns An array of expanded Loki queries with interpolated variables and ad hoc filters.\n   */\n  interpolateVariablesInQueries(\n    queries: LokiQuery[],\n    scopedVars: ScopedVars,\n    adhocFilters?: AdHocVariableFilter[]\n  ): LokiQuery[] {\n    let expandedQueries = queries;\n    if (queries && queries.length) {\n      expandedQueries = queries.map((query) => ({\n        ...query,\n        datasource: this.getRef(),\n        expr: this.addAdHocFilters(\n          this.templateSrv.replace(query.expr, scopedVars, this.interpolateQueryExpr),\n          adhocFilters\n        ),\n      }));\n    }\n\n    return expandedQueries;\n  }\n\n  /**\n   * Implemented as part of DataSourceApi. Converts a Loki query to a simple text string.\n   * Used, for example, in Query history.\n   * @returns A text representation of the query.\n   */\n  getQueryDisplayText(query: LokiQuery) {\n    return query.expr;\n  }\n\n  /**\n   * Given a time range, returns it as Loki parameters.\n   * @returns An object containing the start and end times in nanoseconds since the Unix epoch.\n   */\n  getTimeRangeParams(timeRange: TimeRange) {\n    return { start: timeRange.from.valueOf() * NS_IN_MS, end: timeRange.to.valueOf() * NS_IN_MS };\n  }\n\n  /**\n   * Implemented as part of DataSourceWithQueryImportSupport.\n   * Imports queries from AbstractQuery objects when switching between different data source types.\n   * @returns A Promise that resolves to an array of Loki queries.\n   */\n  async importFromAbstractQueries(abstractQueries: AbstractQuery[]): Promise<LokiQuery[]> {\n    await this.languageProvider.start();\n    const existingKeys = this.languageProvider.labelKeys;\n\n    if (existingKeys && existingKeys.length) {\n      abstractQueries = abstractQueries.map((abstractQuery) => {\n        abstractQuery.labelMatchers = abstractQuery.labelMatchers.filter((labelMatcher) => {\n          return existingKeys.includes(labelMatcher.name);\n        });\n        return abstractQuery;\n      });\n    }\n\n    return abstractQueries.map((abstractQuery) => this.languageProvider.importFromAbstractQuery(abstractQuery));\n  }\n\n  /**\n   * Implemented as part of DataSourceWithQueryImportSupport.\n   * Exports Loki queries to AbstractQuery objects when switching between different data source types.\n   * @returns A Promise that resolves to an array of AbstractQuery objects.\n   */\n  async exportToAbstractQueries(queries: LokiQuery[]): Promise<AbstractQuery[]> {\n    return queries.map((query) => this.languageProvider.exportToAbstractQuery(query));\n  }\n\n  /**\n   * A method that wraps `getResource` from DataSourceWithBackend to perform metadata requests, with an additional check for valid URL values.\n   * @returns A Promise that resolves to the data retrieved from the metadata request, or an empty array if no data is available.\n   */\n  async metadataRequest(url: string, params?: Record<string, string | number>, options?: Partial<BackendSrvRequest>) {\n    // url must not start with a `/`, otherwise the AJAX-request\n    // going from the browser will contain `//`, which can cause problems.\n    if (url.startsWith('/')) {\n      throw new Error(`invalid metadata request url: ${url}`);\n    }\n\n    const res = await this.getResource(url, params, options);\n\n    // detected_field/${label}/values has different structure then other metadata responses\n    if (!res.data && res.values) {\n      return res.values ?? [];\n    }\n\n    // detected_fields has a different return structure then other metadata responses\n    if (!res.data && res.fields) {\n      return res.fields ?? [];\n    }\n    return res.data ?? [];\n  }\n\n  /**\n   * Used in `getQueryStats`. It wraps `getResource` from DataSourceWithBackend to perform a stats request\n   * Specifically designed for the stats endpoint, which does not return data but includes stats directly in the response object.\n   * @returns A Promise that resolves to a QueryStats object containing the statistics retrieved from the stats request.\n   */\n  async statsMetadataRequest(\n    url: string,\n    params?: Record<string, string | number>,\n    options?: Partial<BackendSrvRequest>\n  ): Promise<QueryStats> {\n    if (url.startsWith('/')) {\n      throw new Error(`invalid metadata request url: ${url}`);\n    }\n\n    return await this.getResource(url, params, options);\n  }\n\n  /**\n   * Used in `getStats`. Retrieves statistics for a Loki query and processes them into a QueryStats object.\n   * @returns A Promise that resolves to a QueryStats object containing the query statistics or undefined if the query is invalid.\n   */\n  async getQueryStats(query: LokiQuery, timeRange: TimeRange): Promise<QueryStats | undefined> {\n    // if query is invalid, clear stats, and don't request\n    if (isQueryWithError(this.interpolateString(query.expr, placeHolderScopedVars))) {\n      return undefined;\n    }\n\n    const labelMatchers = getStreamSelectorsFromQuery(query.expr);\n    let statsForAll: QueryStats = { streams: 0, chunks: 0, bytes: 0, entries: 0 };\n\n    for (const idx in labelMatchers) {\n      const { start, end } = this.getStatsTimeRange(query, Number(idx), timeRange);\n\n      if (start === undefined || end === undefined) {\n        return { streams: 0, chunks: 0, bytes: 0, entries: 0, message: 'Query size estimate not available.' };\n      }\n\n      try {\n        const data = await this.statsMetadataRequest(\n          'index/stats',\n          {\n            query: labelMatchers[idx],\n            start: start,\n            end: end,\n          },\n          { showErrorAlert: false, requestId: `${REF_ID_STARTER_STATS}${query.refId}` }\n        );\n\n        statsForAll = {\n          streams: statsForAll.streams + data.streams,\n          chunks: statsForAll.chunks + data.chunks,\n          bytes: statsForAll.bytes + data.bytes,\n          entries: statsForAll.entries + data.entries,\n        };\n      } catch (e) {\n        break;\n      }\n    }\n\n    return statsForAll;\n  }\n\n  /**\n   * Used within the `getQueryStats`. Retrieves the time range for a Loki stats query, adjusting it to cover the requested period.\n   * In metric queries, this means extending it over the range interval.\n   * @returns An object containing the start and end time in nanoseconds (NS_IN_MS) or undefined if the time range cannot be estimated.\n   */\n\n  getStatsTimeRange(\n    query: LokiQuery,\n    idx: number,\n    timeRange: TimeRange\n  ): { start: number | undefined; end: number | undefined } {\n    let start: number, end: number;\n    const NS_IN_MS = 1000000;\n    const durationNodes = getNodesFromQuery(query.expr, [Duration]);\n    const durations = durationNodes.map((d) => query.expr.substring(d.from, d.to));\n\n    if (isLogsQuery(query.expr)) {\n      // logs query with instant type can not be estimated\n      if (query.queryType === LokiQueryType.Instant) {\n        return { start: undefined, end: undefined };\n      }\n      // logs query with range type\n      return this.getTimeRangeParams(timeRange);\n    }\n\n    if (query.queryType === LokiQueryType.Instant) {\n      // metric query with instant type\n\n      if (!!durations[idx]) {\n        // if query has a duration e.g. [1m]\n        end = this.getTimeRangeParams(timeRange).end;\n        start = end - rangeUtil.intervalToMs(durations[idx]) * NS_IN_MS;\n        return { start, end };\n      } else {\n        // if query has no duration e.g. [$__interval]\n\n        if (/(\\$__auto|\\$__range)/.test(query.expr)) {\n          // if $__auto or $__range is used, we can estimate the time range using the selected range\n          return this.getTimeRangeParams(timeRange);\n        }\n\n        // otherwise we cant estimate the time range\n        return { start: undefined, end: undefined };\n      }\n    }\n\n    // metric query with range type\n    return this.getTimeRangeParams(timeRange);\n  }\n\n  /**\n   * Retrieves statistics for a Loki query and returns the QueryStats object.\n   * @returns A Promise that resolves to a QueryStats object or null if the query is invalid or has no statistics.\n   */\n  async getStats(query: LokiQuery, timeRange: TimeRange): Promise<QueryStats | null> {\n    if (!query.expr) {\n      return null;\n    }\n\n    const response = await this.getQueryStats(query, timeRange);\n\n    if (!response) {\n      return null;\n    }\n\n    return Object.values(response).every((v) => v === 0) ? null : response;\n  }\n\n  /**\n   * Implemented as part of DataSourceAPI and used for template variable queries.\n   * @returns A Promise that resolves to an array of results from the metric find query.\n   */\n  async metricFindQuery(\n    query: LokiVariableQuery | string,\n    options?: LegacyMetricFindQueryOptions\n  ): Promise<MetricFindValue[]> {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    let interpolatedVariableQuery: LokiVariableQuery | undefined;\n\n    if (typeof query === 'string') {\n      interpolatedVariableQuery = this.parseStringToVariableQuery(this.interpolateString(query, options?.scopedVars));\n    } else {\n      interpolatedVariableQuery = {\n        ...query,\n        label: this.interpolateString(query.label || '', options?.scopedVars),\n        stream: this.interpolateString(query.stream || '', options?.scopedVars),\n      };\n    }\n\n    if (interpolatedVariableQuery) {\n      return await this.processMetricFindQuery(interpolatedVariableQuery, options?.range);\n    }\n\n    return Promise.resolve([]);\n  }\n\n  /**\n   * Used within the `metricFindQuery`. Retrieves the correct variable results based on the provided LokiVariableQuery.\n   * @returns A Promise that resolves to an array of variable results based on the query type and parameters.\n   */\n\n  private async processMetricFindQuery(query: LokiVariableQuery, timeRange?: TimeRange): Promise<MetricFindValue[]> {\n    if (query.type === LokiVariableQueryType.LabelNames) {\n      const result = await this.languageProvider.fetchLabels({ timeRange });\n      return result.map((value: string) => ({ text: value }));\n    }\n\n    if (!query.label) {\n      return [];\n    }\n\n    const result = await this.languageProvider.fetchLabelValues(query.label, {\n      streamSelector: query.stream,\n      timeRange,\n    });\n    return result.map((value: string) => ({ text: value }));\n  }\n\n  /**\n   * Used in `metricFindQuery` to process legacy query strings (label_name() and label_values()) to variable query objects.\n   * @returns LokiVariableQuery object based on the provided query string, or undefined if string can't be parsed.\n   */\n  private parseStringToVariableQuery(query: string): LokiVariableQuery | undefined {\n    const refId = 'LokiVariableQueryEditor-VariableQuery';\n    const labelNames = query.match(labelNamesRegex);\n    if (labelNames) {\n      return {\n        type: LokiVariableQueryType.LabelNames,\n        refId,\n      };\n    }\n\n    const labelValues = query.match(labelValuesRegex);\n    if (labelValues) {\n      return {\n        type: LokiVariableQueryType.LabelValues,\n        label: labelValues[2],\n        stream: labelValues[1],\n        refId,\n      };\n    }\n    return undefined;\n  }\n\n  /**\n   * Used to fetch data samples, typically for autocompletion and query building to recommend parsers, labels, and values based on sampled data.\n   * Currently, it works for logs data only.\n   * @returns A Promise that resolves to an array of DataFrames containing data samples.\n   */\n  async getDataSamples(query: LokiQuery, timeRange: TimeRange): Promise<DataFrame[]> {\n    // Currently works only for logs sample\n    if (!isLogsQuery(query.expr) || isQueryWithError(this.interpolateString(query.expr, placeHolderScopedVars))) {\n      return [];\n    }\n\n    const lokiLogsQuery: LokiQuery = {\n      expr: query.expr,\n      queryType: LokiQueryType.Range,\n      refId: REF_ID_DATA_SAMPLES,\n      maxLines: query.maxLines || DEFAULT_MAX_LINES_SAMPLE,\n      supportingQueryType: SupportingQueryType.DataSample,\n    };\n\n    const request = makeRequest(lokiLogsQuery, timeRange, CoreApp.Unknown, REF_ID_DATA_SAMPLES, true);\n    return await lastValueFrom(this.query(request).pipe(switchMap((res) => of(res.data))));\n  }\n\n  /**\n   * Implemented as part of the DataSourceAPI. Retrieves tag keys that can be used for ad-hoc filtering.\n   * @returns A Promise that resolves to an array of label names represented as MetricFindValue objects.\n   */\n  async getTagKeys(options?: DataSourceGetTagKeysOptions<LokiQuery>): Promise<MetricFindValue[]> {\n    let streamSelector = '{}';\n    for (const filter of options?.filters ?? []) {\n      streamSelector = addLabelToQuery(streamSelector, filter.key, filter.operator, filter.value);\n    }\n    const result = await this.languageProvider.fetchLabels({ timeRange: options?.timeRange, streamSelector });\n    return result.map((value: string) => ({ text: value }));\n  }\n\n  /**\n   * Implemented as part of the DataSourceAPI. Retrieves tag values that can be used for ad-hoc filtering.\n   * @returns A Promise that resolves to an array of label values represented as MetricFindValue objects\n   */\n  async getTagValues(options: DataSourceGetTagValuesOptions<LokiQuery>): Promise<MetricFindValue[]> {\n    let streamSelector = '{}';\n    for (const filter of options?.filters ?? []) {\n      streamSelector = addLabelToQuery(streamSelector, filter.key, filter.operator, filter.value);\n    }\n    const result = await this.languageProvider.fetchLabelValues(options.key, {\n      timeRange: options.timeRange,\n      streamSelector,\n    });\n    return result.map((value: string) => ({ text: value }));\n  }\n\n  /**\n   * Used for interpolation logic in `interpolateVariablesInQueries` and `applyTemplateVariables`.\n   * Handles escaping of special characters based on variable type and value.\n   * @returns The interpolated value with appropriate character escaping.\n   */\n  interpolateQueryExpr(value: any, variable: QueryVariableModel | CustomVariableModel) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return value;\n    }\n\n    if (typeof value === 'string') {\n      return lokiSpecialRegexEscape(value);\n    }\n\n    const escapedValues = lodashMap(value, lokiSpecialRegexEscape);\n    return escapedValues.join('|');\n  }\n\n  /**\n   * Implemented for `DataSourceWithToggleableQueryFiltersSupport`. Toggles a filter on or off based on the provided filter action.\n   * It is used for example in Explore to toggle fields on and off trough log details.\n   * @returns A new LokiQuery with the filter toggled as specified.\n   */\n  toggleQueryFilter(query: LokiQuery, filter: ToggleFilterAction): LokiQuery {\n    let expression = query.expr ?? '';\n    const labelType = getLabelTypeFromFrame(filter.options.key, filter.frame, 0);\n    switch (filter.type) {\n      case 'FILTER_FOR': {\n        if (filter.options?.key && filter.options?.value) {\n          const value = escapeLabelValueInSelector(filter.options.value);\n\n          // This gives the user the ability to toggle a filter on and off.\n          expression = queryHasFilter(expression, filter.options.key, '=', value)\n            ? removeLabelFromQuery(expression, filter.options.key, '=', value)\n            : addLabelToQuery(expression, filter.options.key, '=', value, labelType);\n        }\n        break;\n      }\n      case 'FILTER_OUT': {\n        if (filter.options?.key && filter.options?.value) {\n          const value = escapeLabelValueInSelector(filter.options.value);\n\n          /**\n           * If there is a filter with the same key and value, remove it.\n           * This prevents the user from seeing no changes in the query when they apply\n           * this filter.\n           */\n          if (queryHasFilter(expression, filter.options.key, '=', value)) {\n            expression = removeLabelFromQuery(expression, filter.options.key, '=', value);\n          }\n\n          expression = addLabelToQuery(expression, filter.options.key, '!=', value, labelType);\n        }\n        break;\n      }\n      default:\n        break;\n    }\n    return { ...query, expr: expression };\n  }\n\n  /**\n   * Implemented for `DataSourceWithToggleableQueryFiltersSupport`. Checks if a query expression contains a filter based on the provided filter options.\n   * @returns A boolean value indicating whether the filter exists in the query expression.\n   */\n  queryHasFilter(query: LokiQuery, filter: QueryFilterOptions): boolean {\n    let expression = query.expr ?? '';\n    return queryHasFilter(expression, filter.key, '=', filter.value);\n  }\n\n  /**\n   * Implemented as part of `DataSourceWithQueryModificationSupport`. Used to modify a query based on the provided action.\n   * It is used, for example, in the Query Builder to apply hints such as parsers, operations, etc.\n   * @returns A new LokiQuery with the specified modification applied.\n   */\n  modifyQuery(query: LokiQuery, action: QueryFixAction): LokiQuery {\n    let expression = query.expr ?? '';\n    // NB: Usually the labelKeys should be fetched and cached in the datasource,\n    // but there might be some edge cases where this wouldn't be the case.\n    // However the changed would make this method `async`.\n    switch (action.type) {\n      case 'ADD_FILTER': {\n        if (action.options?.key && action.options?.value) {\n          const labelType = getLabelTypeFromFrame(action.options.key, action.frame, 0);\n          const value = escapeLabelValueInSelector(action.options.value);\n          expression = addLabelToQuery(expression, action.options.key, '=', value, labelType);\n        }\n        break;\n      }\n      case 'ADD_FILTER_OUT': {\n        if (action.options?.key && action.options?.value) {\n          const labelType = getLabelTypeFromFrame(action.options.key, action.frame, 0);\n          const value = escapeLabelValueInSelector(action.options.value);\n          expression = addLabelToQuery(expression, action.options.key, '!=', value, labelType);\n        }\n        break;\n      }\n      case 'ADD_LOGFMT_PARSER': {\n        expression = addParserToQuery(expression, 'logfmt');\n        break;\n      }\n      case 'ADD_JSON_PARSER': {\n        expression = addParserToQuery(expression, 'json');\n        break;\n      }\n      case 'ADD_UNPACK_PARSER': {\n        expression = addParserToQuery(expression, 'unpack');\n        break;\n      }\n      case 'ADD_NO_PIPELINE_ERROR': {\n        expression = addNoPipelineErrorToQuery(expression);\n        break;\n      }\n      case 'ADD_LEVEL_LABEL_FORMAT': {\n        if (action.options?.originalLabel && action.options?.renameTo) {\n          expression = addLabelFormatToQuery(expression, {\n            renameTo: action.options.renameTo,\n            originalLabel: action.options.originalLabel,\n          });\n        }\n        break;\n      }\n      case 'ADD_LABEL_FILTER': {\n        const parserPositions = getParserPositions(query.expr);\n        const labelFilterPositions = getLabelFilterPositions(query.expr);\n        const lastPosition = findLastPosition([...parserPositions, ...labelFilterPositions]);\n        const filter = toLabelFilter('', '', '=');\n        expression = addFilterAsLabelFilter(expression, [lastPosition], filter);\n        break;\n      }\n      case 'ADD_STRING_FILTER':\n      case 'ADD_LINE_FILTER': {\n        expression = addLineFilter(expression, action.options?.value);\n        break;\n      }\n      case 'ADD_STRING_FILTER_OUT':\n      case 'ADD_LINE_FILTER_OUT': {\n        expression = addLineFilter(expression, action.options?.value, '!=');\n        break;\n      }\n      default:\n        break;\n    }\n    return { ...query, expr: expression };\n  }\n\n  /**\n   * Implemented as part of `DataSourceWithQueryModificationSupport`. Returns a list of operation\n   * types that are supported by `modifyQuery()`.\n   */\n  getSupportedQueryModifications() {\n    return [\n      'ADD_FILTER',\n      'ADD_FILTER_OUT',\n      'ADD_LOGFMT_PARSER',\n      'ADD_JSON_PARSER',\n      'ADD_UNPACK_PARSER',\n      'ADD_NO_PIPELINE_ERROR',\n      'ADD_LEVEL_LABEL_FORMAT',\n      'ADD_LABEL_FILTER',\n      'ADD_STRING_FILTER',\n      'ADD_STRING_FILTER_OUT',\n    ];\n  }\n\n  /**\n   * Part of `DataSourceWithLogsContextSupport`, used to retrieve log context for a log row.\n   * @returns A promise that resolves to an object containing the log context data as DataFrames.\n   */\n  getLogRowContext = async (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    origQuery?: DataQuery\n  ): Promise<{ data: DataFrame[] }> => {\n    return await this.logContextProvider.getLogRowContext(row, options, getLokiQueryFromDataQuery(origQuery));\n  };\n  /**\n   * Part of `DataSourceWithLogsContextSupport`, used to retrieve the log context query for the provided log row and original query.\n   * @returns A promise that resolves to a DataQuery representing the log context query.\n   */\n  getLogRowContextQuery = async (\n    row: LogRowModel,\n    options?: LogRowContextOptions,\n    origQuery?: DataQuery,\n    cacheFilters?: boolean\n  ): Promise<DataQuery> => {\n    return await this.logContextProvider.getLogRowContextQuery(\n      row,\n      options,\n      getLokiQueryFromDataQuery(origQuery),\n      cacheFilters\n    );\n  };\n\n  /**\n   * Part of `DataSourceWithLogsContextSupport`, used to retrieve the log context UI for the provided log row and original query.\n   * @returns A React component or element representing the log context UI for the log row.\n   */\n  getLogRowContextUi(\n    row: LogRowModel,\n    runContextQuery: () => void,\n    origQuery: DataQuery,\n    scopedVars?: ScopedVars\n  ): React.ReactNode {\n    return this.logContextProvider.getLogRowContextUi(\n      row,\n      runContextQuery,\n      getLokiQueryFromDataQuery(origQuery),\n      scopedVars\n    );\n  }\n\n  /**\n   * Implemented as part of the DataSourceAPI. It allows the datasource to serve as a source of annotations for a dashboard.\n   * @returns A promise that resolves to an array of AnnotationEvent objects representing the annotations for the dashboard.\n   * @todo This is deprecated and it is recommended to use the `AnnotationSupport` feature for annotations.\n   */\n  async annotationQuery(options: any): Promise<AnnotationEvent[]> {\n    const { expr, maxLines, instant, tagKeys = '', titleFormat = '', textFormat = '' } = options.annotation;\n\n    if (!expr) {\n      return [];\n    }\n\n    const id = `${REF_ID_STARTER_ANNOTATION}${options.annotation.name}`;\n\n    const query: LokiQuery = {\n      refId: id,\n      expr,\n      maxLines,\n      instant,\n      queryType: instant ? LokiQueryType.Instant : LokiQueryType.Range,\n    };\n\n    const request = makeRequest(query, options.range, CoreApp.Dashboard, id);\n\n    const { data } = await lastValueFrom(this.query(request));\n\n    const annotations: AnnotationEvent[] = [];\n    const splitKeys: string[] = tagKeys.split(',').filter((v: string) => v !== '');\n\n    const isDataplaneLog = config.featureToggles.lokiLogsDataplane;\n\n    for (const frame of data) {\n      const view = new DataFrameView<{ timestamp: string; Time: string; body: string; Line: string; labels: Labels }>(\n        frame\n      );\n\n      view.forEach((row) => {\n        const { labels } = row;\n\n        const maybeDuplicatedTags = Object.entries(labels)\n          .map(([key, val]) => [key, val.trim()]) // trim all label-values\n          .filter(([key, val]) => {\n            if (val === '') {\n              // remove empty\n              return false;\n            }\n\n            // if tags are specified, remove label if does not match tags\n            if (splitKeys.length && !splitKeys.includes(key)) {\n              return false;\n            }\n\n            return true;\n          })\n          .map(([_, val]) => val); // keep only the label-value\n\n        // remove duplicates\n        const tags = Array.from(new Set(maybeDuplicatedTags));\n\n        const logLine = isDataplaneLog ? row.body : row.Line;\n\n        annotations.push({\n          time: isDataplaneLog ? new Date(row.timestamp).valueOf() : new Date(row.Time).valueOf(),\n          title: renderLegendFormat(titleFormat, labels),\n          text: renderLegendFormat(textFormat, labels) || logLine,\n          tags,\n        });\n      });\n    }\n\n    return annotations;\n  }\n\n  /**\n   * Adds ad hoc filters to a query expression, handling proper escaping of filter values.\n   * @returns The query expression with ad hoc filters and correctly escaped values.\n   * @todo this.templateSrv.getAdhocFilters() is deprecated\n   */\n  addAdHocFilters(queryExpr: string, adhocFilters?: AdHocVariableFilter[]) {\n    if (!adhocFilters?.length) {\n      return queryExpr;\n    }\n\n    let expr = replaceVariables(queryExpr);\n\n    expr = adhocFilters.reduce((acc: string, filter: { key: string; operator: string; value: string }) => {\n      const { key, operator } = filter;\n      let { value } = filter;\n      if (!isRegexSelector(operator)) {\n        // We want to escape special characters in value for non-regex selectors to match the same char in the log line as the user types in the input\n        value = escapeLabelValueInSelector(value, operator);\n      }\n      return addLabelToQuery(acc, key, operator, value);\n    }, expr);\n\n    return returnVariables(expr);\n  }\n\n  /**\n   * Filters out queries that are empty or hidden. Used when running queries through backend.\n   * It is called from DatasourceWithBackend.\n   * @returns `true` if the query is not hidden and its expression is not empty; `false` otherwise.\n   */\n  filterQuery(query: LokiQuery): boolean {\n    if (query.hide || query.expr === '') {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Applies template variables and add hoc filters to a query. Used when running queries through backend.\n   * It is called from DatasourceWithBackend.\n   * @returns A modified Loki query with template variables and ad hoc filters applied.\n   */\n  applyTemplateVariables(target: LokiQuery, scopedVars: ScopedVars, adhocFilters?: AdHocVariableFilter[]): LokiQuery {\n    // We want to interpolate these variables on backend because we support using them in\n    // alerting/ML queries and we want to have consistent interpolation for all queries\n    const { __auto, __interval, __interval_ms, __range, __range_s, __range_ms, ...rest } = scopedVars || {};\n\n    const variables = {\n      ...rest,\n\n      // pass through for backend interpolation. Need to be in scopedVars for Scenes though\n      __interval: {\n        value: '$__interval',\n      },\n      __interval_ms: {\n        value: '$__interval_ms',\n      },\n    };\n\n    const exprWithAdHoc = this.addAdHocFilters(\n      this.templateSrv.replace(target.expr, variables, this.interpolateQueryExpr),\n      adhocFilters\n    );\n\n    const step = this.templateSrv.replace(target.step, variables);\n    const legendFormat = this.templateSrv.replace(target.legendFormat, variables);\n\n    return {\n      ...target,\n      expr: exprWithAdHoc,\n      step,\n      legendFormat,\n    };\n  }\n\n  /**\n   * Interpolates template variables in a given string. Template variables are passed trough scopedVars.\n   * @returns The string with template variables replaced by their values.\n   */\n  interpolateString(string: string, scopedVars?: ScopedVars) {\n    return this.templateSrv.replace(string, scopedVars, this.interpolateQueryExpr);\n  }\n\n  /**\n   * Retrieves and returns a list of variable names used in the template service.\n   * Used for example in the Query Builder to populate the variable dropdown with template variables.\n   * @returns An array of variable names, each prefixed with '$'.\n   */\n  getVariables(): string[] {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n  /**\n   * Retrieves query hints for query improvements based on a Loki query and its result data.\n   * Used in Query builder to provide hints for query improvements, such as adding a parser, etc.\n   * @returns An array of query hints for potential query improvements.\n   */\n  getQueryHints(query: LokiQuery, result: DataFrame[]): QueryHint[] {\n    return getQueryHints(query.expr, result);\n  }\n\n  /**\n   * Get a default LokiQuery based on the specified app. Currently used in UnifiedAlerting.\n   * @returns A default LokiQuery object with appropriate settings for the given application.\n   */\n  getDefaultQuery(app: CoreApp): LokiQuery {\n    const defaults = { refId: 'A', expr: '' };\n\n    if (app === CoreApp.UnifiedAlerting) {\n      return {\n        ...defaults,\n        queryType: LokiQueryType.Instant,\n      };\n    }\n\n    return {\n      ...defaults,\n      queryType: LokiQueryType.Range,\n    };\n  }\n}\nexport function lokiSpecialRegexEscape<T>(value: T) {\n  if (typeof value === 'string') {\n    return value.replace(/\\\\/g, '\\\\\\\\\\\\\\\\').replace(/[$^*{}\\[\\]+?.()|]/g, '\\\\\\\\$&');\n  }\n  return value;\n}\n","import { invert } from 'lodash';\n\nimport { AbstractLabelMatcher, AbstractLabelOperator, AbstractQuery, DataFrame, TimeRange } from '@grafana/data';\n\nimport { LabelType } from './types';\n\nfunction roundMsToMin(milliseconds: number): number {\n  return roundSecToMin(milliseconds / 1000);\n}\n\nfunction roundSecToMin(seconds: number): number {\n  return Math.floor(seconds / 60);\n}\n\nexport function shouldRefreshLabels(range?: TimeRange, prevRange?: TimeRange): boolean {\n  if (range && prevRange) {\n    const sameMinuteFrom = roundMsToMin(range.from.valueOf()) === roundMsToMin(prevRange.from.valueOf());\n    const sameMinuteTo = roundMsToMin(range.to.valueOf()) === roundMsToMin(prevRange.to.valueOf());\n    // If both are same, don't need to refresh\n    return !(sameMinuteFrom && sameMinuteTo);\n  }\n  return false;\n}\n\n// Loki regular-expressions use the RE2 syntax (https://github.com/google/re2/wiki/Syntax),\n// so every character that matches something in that list has to be escaped.\n// the list of meta characters is: *+?()|\\.[]{}^$\n// we make a javascript regular expression that matches those characters:\nconst RE2_METACHARACTERS = /[*+?()|\\\\.\\[\\]{}^$]/g;\nfunction escapeLokiRegexp(value: string): string {\n  return value.replace(RE2_METACHARACTERS, '\\\\$&');\n}\n\n// based on the openmetrics-documentation, the 3 symbols we have to handle are:\n// - \\n ... the newline character\n// - \\  ... the backslash character\n// - \"  ... the double-quote character\nexport function escapeLabelValueInExactSelector(labelValue: string): string {\n  return labelValue.replace(/\\\\/g, '\\\\\\\\').replace(/\\n/g, '\\\\n').replace(/\"/g, '\\\\\"');\n}\n\nexport function unescapeLabelValue(labelValue: string): string {\n  return labelValue.replace(/\\\\n/g, '\\n').replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\');\n}\n\nexport function escapeLabelValueInRegexSelector(labelValue: string): string {\n  return escapeLabelValueInExactSelector(escapeLokiRegexp(labelValue));\n}\n\nexport function escapeLabelValueInSelector(labelValue: string, selector?: string): string {\n  return isRegexSelector(selector)\n    ? escapeLabelValueInRegexSelector(labelValue)\n    : escapeLabelValueInExactSelector(labelValue);\n}\n\nexport function isRegexSelector(selector?: string) {\n  if (selector && (selector.includes('=~') || selector.includes('!~'))) {\n    return true;\n  }\n  return false;\n}\n\nexport function isBytesString(string: string) {\n  const BYTES_KEYWORDS = [\n    'b',\n    'kib',\n    'Kib',\n    'kb',\n    'KB',\n    'mib',\n    'Mib',\n    'mb',\n    'MB',\n    'gib',\n    'Gib',\n    'gb',\n    'GB',\n    'tib',\n    'Tib',\n    'tb',\n    'TB',\n    'pib',\n    'Pib',\n    'pb',\n    'PB',\n    'eib',\n    'Eib',\n    'eb',\n    'EB',\n  ];\n  const regex = new RegExp(`^(?:-?\\\\d+(?:\\\\.\\\\d+)?)(?:${BYTES_KEYWORDS.join('|')})$`);\n  const match = string.match(regex);\n  return !!match;\n}\n\nexport function getLabelTypeFromFrame(labelKey: string, frame?: DataFrame, index?: number): null | LabelType {\n  if (!frame || index === undefined) {\n    return null;\n  }\n\n  const typeField = frame.fields.find((field) => field.name === 'labelTypes')?.values[index];\n  if (!typeField) {\n    return null;\n  }\n  switch (typeField[labelKey]) {\n    case 'I':\n      return LabelType.Indexed;\n    case 'S':\n      return LabelType.StructuredMetadata;\n    case 'P':\n      return LabelType.Parsed;\n    default:\n      return null;\n  }\n}\n\nexport const mapOpToAbstractOp: Record<AbstractLabelOperator, string> = {\n  [AbstractLabelOperator.Equal]: '=',\n  [AbstractLabelOperator.NotEqual]: '!=',\n  [AbstractLabelOperator.EqualRegEx]: '=~',\n  [AbstractLabelOperator.NotEqualRegEx]: '!~',\n};\n\n// eslint-disable-next-line @typescript-eslint/consistent-type-assertions\nexport const mapAbstractOperatorsToOp = invert(mapOpToAbstractOp) as Record<string, AbstractLabelOperator>;\n\nexport function abstractQueryToExpr(labelBasedQuery: AbstractQuery): string {\n  const expr = labelBasedQuery.labelMatchers\n    .map((selector: AbstractLabelMatcher) => {\n      const operator = mapOpToAbstractOp[selector.operator];\n      if (operator) {\n        return `${selector.name}${operator}\"${selector.value}\"`;\n      } else {\n        return '';\n      }\n    })\n    .filter((e: string) => e !== '')\n    .join(', ');\n\n  return expr ? `{${expr}}` : '';\n}\n\nexport function processLabels(labels: Array<{ [key: string]: string }>) {\n  const valueSet: { [key: string]: Set<string> } = {};\n  labels.forEach((label) => {\n    Object.keys(label).forEach((key) => {\n      if (!valueSet[key]) {\n        valueSet[key] = new Set();\n      }\n      if (!valueSet[key].has(label[key])) {\n        valueSet[key].add(label[key]);\n      }\n    });\n  });\n\n  const valueArray: { [key: string]: string[] } = {};\n  limitSuggestions(Object.keys(valueSet)).forEach((key) => {\n    valueArray[key] = limitSuggestions(Array.from(valueSet[key]));\n  });\n\n  return { values: valueArray, keys: Object.keys(valueArray) };\n}\n\n// Max number of items (metrics, labels, values) that we display as suggestions. Prevents from running out of memory.\nexport const SUGGESTIONS_LIMIT = 10000;\nexport function limitSuggestions(items: string[]) {\n  return items.slice(0, SUGGESTIONS_LIMIT);\n}\n","import {\n  closestIdx,\n  DataFrame,\n  DataFrameType,\n  DataQueryResponse,\n  DataQueryResponseData,\n  Field,\n  FieldType,\n  LoadingState,\n  QueryResultMetaStat,\n  shallowCompare,\n} from '@grafana/data';\n\nimport { LOADING_FRAME_NAME } from './querySplitting';\n\nexport function combineResponses(currentResponse: DataQueryResponse | null, newResponse: DataQueryResponse) {\n  if (!currentResponse) {\n    return cloneQueryResponse(newResponse);\n  }\n\n  newResponse.data.forEach((newFrame) => {\n    const currentFrame = currentResponse.data.find((frame) => shouldCombine(frame, newFrame));\n    if (!currentFrame) {\n      currentResponse.data.push(cloneDataFrame(newFrame));\n      return;\n    }\n    mergeFrames(currentFrame, newFrame);\n  });\n\n  const mergedErrors = [...(currentResponse.errors ?? []), ...(newResponse.errors ?? [])];\n  if (mergedErrors.length > 0) {\n    currentResponse.errors = mergedErrors;\n  }\n\n  // the `.error` attribute is obsolete now,\n  // but we have to maintain it, otherwise\n  // some grafana parts do not behave well.\n  // we just choose the old error, if it exists,\n  // otherwise the new error, if it exists.\n  const mergedError = currentResponse.error ?? newResponse.error;\n  if (mergedError != null) {\n    currentResponse.error = mergedError;\n  }\n\n  const mergedTraceIds = [...(currentResponse.traceIds ?? []), ...(newResponse.traceIds ?? [])];\n  if (mergedTraceIds.length > 0) {\n    currentResponse.traceIds = mergedTraceIds;\n  }\n\n  return currentResponse;\n}\n\n/**\n * Given an existing DataQueryResponse, replace any data frame present in newResponse with those in newResponse\n */\nexport function replaceResponses(currentResponse: DataQueryResponse | null, newResponse: DataQueryResponse) {\n  if (!currentResponse) {\n    return cloneQueryResponse(newResponse);\n  }\n\n  newResponse.data.forEach((newFrame) => {\n    const currentFrameIndex = currentResponse.data.findIndex((frame) => shouldCombine(frame, newFrame));\n    if (currentFrameIndex < 0) {\n      currentResponse.data.push(cloneDataFrame(newFrame));\n      return;\n    }\n    currentResponse.data[currentFrameIndex] = newFrame;\n  });\n\n  // Clean up loading frame when newResponse contains the final response\n  if (newResponse.state === LoadingState.Done) {\n    currentResponse.data = currentResponse.data.filter((frame) => frame.name !== LOADING_FRAME_NAME);\n  }\n\n  const mergedErrors = [...(currentResponse.errors ?? []), ...(newResponse.errors ?? [])];\n  if (mergedErrors.length > 0) {\n    currentResponse.errors = mergedErrors;\n  }\n\n  const mergedError = currentResponse.error ?? newResponse.error;\n  if (mergedError != null) {\n    currentResponse.error = mergedError;\n  }\n\n  const mergedTraceIds = [...(currentResponse.traceIds ?? []), ...(newResponse.traceIds ?? [])];\n  if (mergedTraceIds.length > 0) {\n    currentResponse.traceIds = mergedTraceIds;\n  }\n\n  return currentResponse;\n}\n\n/**\n * Given two data frames, merge their values. Overlapping values will be added together.\n */\nexport function mergeFrames(dest: DataFrame, source: DataFrame) {\n  const destTimeField = dest.fields.find((field) => field.type === FieldType.time);\n  const destIdField = dest.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n  const sourceTimeField = source.fields.find((field) => field.type === FieldType.time);\n  const sourceIdField = source.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n\n  if (!destTimeField || !sourceTimeField) {\n    console.error(new Error(`Time fields not found in the data frames`));\n    return;\n  }\n\n  const sourceTimeValues = sourceTimeField?.values.slice(0) ?? [];\n  const totalFields = Math.max(dest.fields.length, source.fields.length);\n\n  for (let i = 0; i < sourceTimeValues.length; i++) {\n    const destIdx = resolveIdx(destTimeField, sourceTimeField, i);\n\n    const entryExistsInDest = compareEntries(destTimeField, destIdField, destIdx, sourceTimeField, sourceIdField, i);\n\n    for (let f = 0; f < totalFields; f++) {\n      // For now, skip undefined fields that exist in the new frame\n      if (!dest.fields[f]) {\n        continue;\n      }\n      // Index is not reliable when frames have disordered fields, or an extra/missing field, so we find them by name.\n      // If the field has no name, we fallback to the old index version.\n      const sourceField = findSourceField(dest.fields[f], source.fields, f);\n      if (!sourceField) {\n        continue;\n      }\n      // Same value, accumulate\n      if (entryExistsInDest) {\n        if (dest.fields[f].type === FieldType.time) {\n          // Time already exists, skip\n          continue;\n        } else if (dest.fields[f].type === FieldType.number) {\n          // Number, add\n          dest.fields[f].values[destIdx] = (dest.fields[f].values[destIdx] ?? 0) + sourceField.values[i];\n        } else if (dest.fields[f].type === FieldType.other) {\n          // Possibly labels, combine\n          if (typeof sourceField.values[i] === 'object') {\n            dest.fields[f].values[destIdx] = {\n              ...dest.fields[f].values[destIdx],\n              ...sourceField.values[i],\n            };\n          } else if (sourceField.values[i]) {\n            dest.fields[f].values[destIdx] = sourceField.values[i];\n          }\n        } else {\n          // Replace value\n          dest.fields[f].values[destIdx] = sourceField.values[i];\n        }\n      } else if (sourceField.values[i] !== undefined) {\n        // Insert in the `destIdx` position\n        dest.fields[f].values.splice(destIdx, 0, sourceField.values[i]);\n        if (sourceField.nanos) {\n          dest.fields[f].nanos = dest.fields[f].nanos ?? new Array(dest.fields[f].values.length - 1).fill(0);\n          dest.fields[f].nanos?.splice(destIdx, 0, sourceField.nanos[i]);\n        } else if (dest.fields[f].nanos) {\n          dest.fields[f].nanos?.splice(destIdx, 0, 0);\n        }\n      }\n    }\n  }\n\n  dest.length = dest.fields[0].values.length;\n\n  dest.meta = {\n    ...dest.meta,\n    stats: getCombinedMetadataStats(dest.meta?.stats ?? [], source.meta?.stats ?? []),\n  };\n}\n\nfunction resolveIdx(destField: Field, sourceField: Field, index: number) {\n  const idx = closestIdx(sourceField.values[index], destField.values);\n  if (idx < 0) {\n    return 0;\n  }\n  if (sourceField.values[index] === destField.values[idx] && sourceField.nanos && destField.nanos) {\n    return sourceField.nanos[index] > destField.nanos[idx] ? idx + 1 : idx;\n  }\n  if (sourceField.values[index] > destField.values[idx]) {\n    return idx + 1;\n  }\n  return idx;\n}\n\nfunction compareEntries(\n  destTimeField: Field,\n  destIdField: Field | undefined,\n  destIndex: number,\n  sourceTimeField: Field,\n  sourceIdField: Field | undefined,\n  sourceIndex: number\n) {\n  const sameTimestamp = compareNsTimestamps(destTimeField, destIndex, sourceTimeField, sourceIndex);\n  if (!sameTimestamp) {\n    return false;\n  }\n  if (!destIdField || !sourceIdField) {\n    return true;\n  }\n  // Log frames, check indexes\n  return (\n    destIdField.values[destIndex] !== undefined && destIdField.values[destIndex] === sourceIdField.values[sourceIndex]\n  );\n}\n\nfunction compareNsTimestamps(destField: Field, destIndex: number, sourceField: Field, sourceIndex: number) {\n  if (destField.nanos && sourceField.nanos) {\n    return (\n      destField.values[destIndex] !== undefined &&\n      destField.values[destIndex] === sourceField.values[sourceIndex] &&\n      destField.nanos[destIndex] !== undefined &&\n      destField.nanos[destIndex] === sourceField.nanos[sourceIndex]\n    );\n  }\n  return destField.values[destIndex] !== undefined && destField.values[destIndex] === sourceField.values[sourceIndex];\n}\n\nfunction findSourceField(referenceField: Field, sourceFields: Field[], index: number) {\n  const candidates = sourceFields.filter((f) => f.name === referenceField.name);\n\n  if (candidates.length === 1) {\n    return candidates[0];\n  }\n\n  if (referenceField.labels) {\n    return candidates.find((candidate) => shallowCompare(referenceField.labels ?? {}, candidate.labels ?? {}));\n  }\n\n  return sourceFields[index];\n}\n\nconst TOTAL_BYTES_STAT = 'Summary: total bytes processed';\nconst EXEC_TIME_STAT = 'Summary: exec time';\n// This is specific for Loki\nfunction getCombinedMetadataStats(\n  destStats: QueryResultMetaStat[],\n  sourceStats: QueryResultMetaStat[]\n): QueryResultMetaStat[] {\n  // in the current approach, we only handle a single stat\n  const stats: QueryResultMetaStat[] = [];\n  for (const stat of [TOTAL_BYTES_STAT, EXEC_TIME_STAT]) {\n    const destStat = destStats.find((s) => s.displayName === stat);\n    const sourceStat = sourceStats.find((s) => s.displayName === stat);\n\n    if (sourceStat != null && destStat != null) {\n      stats.push({ value: sourceStat.value + destStat.value, displayName: stat, unit: destStat.unit });\n      continue;\n    }\n\n    // maybe one of them exist\n    const eitherStat = sourceStat ?? destStat;\n    if (eitherStat != null) {\n      stats.push(eitherStat);\n    }\n  }\n  return stats;\n}\n\n/**\n * Deep clones a DataQueryResponse\n */\nexport function cloneQueryResponse(response: DataQueryResponse): DataQueryResponse {\n  const newResponse = {\n    ...response,\n    data: response.data.map(cloneDataFrame),\n  };\n  return newResponse;\n}\n\nfunction cloneDataFrame(frame: DataQueryResponseData): DataQueryResponseData {\n  return {\n    ...frame,\n    fields: frame.fields.map((field: Field) => ({\n      ...field,\n      values: field.values,\n    })),\n  };\n}\n\nfunction shouldCombine(frame1: DataFrame, frame2: DataFrame): boolean {\n  if (frame1.refId !== frame2.refId || frame1.name !== frame2.name) {\n    return false;\n  }\n\n  const frameType1 = frame1.meta?.type;\n  const frameType2 = frame2.meta?.type;\n\n  if (frameType1 !== frameType2) {\n    // we do not join things that have a different type\n    return false;\n  }\n\n  // metric range query data\n  if (frameType1 === DataFrameType.TimeSeriesMulti) {\n    const field1 = frame1.fields.find((f) => f.type === FieldType.number);\n    const field2 = frame2.fields.find((f) => f.type === FieldType.number);\n    if (field1 === undefined || field2 === undefined) {\n      // should never happen\n      return false;\n    }\n\n    return shallowCompare(field1.labels ?? {}, field2.labels ?? {});\n  }\n\n  // logs query data\n  // logs use a special attribute in the dataframe's \"custom\" section\n  // because we do not have a good \"frametype\" value for them yet.\n  const customType1 = frame1.meta?.custom?.frameType;\n  const customType2 = frame2.meta?.custom?.frameType;\n  // Legacy frames have this custom type\n  if (customType1 === 'LabeledTimeValues' && customType2 === 'LabeledTimeValues') {\n    return true;\n  } else if (customType1 === customType2) {\n    // Data plane frames don't\n    return true;\n  }\n\n  // should never reach here\n  return false;\n}\n","import { Registry } from '@grafana/data';\nimport { BINARY_OPERATIONS_KEY } from './types.js';\n\nvar __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\nclass QueryModellerBase {\n  constructor(operationDefinitions, innerQueryPlaceholder) {\n    __publicField(this, \"operationsRegistry\");\n    __publicField(this, \"categories\", []);\n    __publicField(this, \"innerQueryPlaceholder\");\n    this.operationsRegistry = new Registry(() => operationDefinitions);\n    this.innerQueryPlaceholder = innerQueryPlaceholder || \"<query>\";\n  }\n  setOperationCategories(categories) {\n    this.categories = categories;\n  }\n  getOperationsForCategory(category) {\n    return this.operationsRegistry.list().filter((op) => op.category === category && !op.hideFromList);\n  }\n  getAlternativeOperations(key) {\n    return this.operationsRegistry.list().filter((op) => op.alternativesKey && op.alternativesKey === key);\n  }\n  getCategories() {\n    return this.categories;\n  }\n  getOperationDefinition(id) {\n    return this.operationsRegistry.getIfExists(id);\n  }\n  hasBinaryOp(query) {\n    return query.operations.find((op) => {\n      const def = this.getOperationDefinition(op.id);\n      return (def == null ? undefined : def.category) === BINARY_OPERATIONS_KEY;\n    }) !== undefined;\n  }\n}\n\nexport { QueryModellerBase };\n//# sourceMappingURL=QueryModellerBase.js.map\n","import {\n  QueryModellerBase,\n  QueryBuilderLabelFilter,\n  VisualQuery,\n  QueryBuilderOperation,\n  VisualQueryBinary,\n} from '@grafana/plugin-ui';\n\nimport { operationDefinitions } from './operations';\nimport { LokiOperationId, LokiQueryPattern, LokiQueryPatternType, LokiVisualQueryOperationCategory } from './types';\n\nexport class LokiQueryModeller extends QueryModellerBase {\n  constructor() {\n    super(operationDefinitions, '<expr>');\n\n    this.setOperationCategories([\n      LokiVisualQueryOperationCategory.Aggregations,\n      LokiVisualQueryOperationCategory.RangeFunctions,\n      LokiVisualQueryOperationCategory.Formats,\n      LokiVisualQueryOperationCategory.BinaryOps,\n      LokiVisualQueryOperationCategory.LabelFilters,\n      LokiVisualQueryOperationCategory.LineFilters,\n    ]);\n  }\n\n  renderOperations(queryString: string, operations: QueryBuilderOperation[]): string {\n    for (const operation of operations) {\n      if (operation.disabled) {\n        continue;\n      }\n      const def = this.operationsRegistry.getIfExists(operation.id);\n      if (!def) {\n        console.error(`Could not find operation ${operation.id} in the registry`);\n        continue;\n      }\n      queryString = def.renderer(operation, def, queryString);\n    }\n    return queryString;\n  }\n\n  renderBinaryQueries(queryString: string, binaryQueries?: Array<VisualQueryBinary<VisualQuery>>) {\n    if (binaryQueries) {\n      for (const binQuery of binaryQueries) {\n        queryString = `${this.renderBinaryQuery(queryString, binQuery)}`;\n      }\n    }\n    return queryString;\n  }\n\n  private renderBinaryQuery(leftOperand: string, binaryQuery: VisualQueryBinary<VisualQuery>) {\n    let result = leftOperand + ` ${binaryQuery.operator} `;\n\n    if (binaryQuery.vectorMatches) {\n      result += `${binaryQuery.vectorMatchesType}(${binaryQuery.vectorMatches}) `;\n    }\n\n    return result + this.renderQuery(binaryQuery.query, true);\n  }\n\n  renderLabels(labels: QueryBuilderLabelFilter[]): string {\n    if (labels.length === 0) {\n      return '{}';\n    }\n\n    let expr = '{';\n    for (const filter of labels) {\n      if (expr !== '{') {\n        expr += ', ';\n      }\n\n      expr += `${filter.label}${filter.op}\"${filter.value}\"`;\n    }\n\n    return expr + `}`;\n  }\n\n  renderQuery(query: VisualQuery, nested?: boolean): string {\n    let queryString = this.renderLabels(query.labels);\n    queryString = this.renderOperations(queryString, query.operations);\n\n    if (!nested && this.hasBinaryOp(query) && Boolean(query.binaryQueries?.length)) {\n      queryString = `(${queryString})`;\n    }\n\n    queryString = this.renderBinaryQueries(queryString, query.binaryQueries);\n\n    return queryString;\n  }\n\n  getQueryPatterns(): LokiQueryPattern[] {\n    return [\n      {\n        name: 'Parse log lines with logfmt parser',\n        type: LokiQueryPatternType.Log,\n        // {} | logfmt | __error__=``\n        operations: [\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n        ],\n      },\n      {\n        name: 'Parse log lines with JSON parser',\n        type: LokiQueryPatternType.Log,\n        // {} | json | __error__=``\n        operations: [\n          { id: LokiOperationId.Json, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n        ],\n      },\n      {\n        name: 'Filter log line and parse with logfmt parser',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | logfmt | __error__=``\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n        ],\n      },\n      {\n        name: 'Filter log lines and parse with json parser',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | json | __error__=``\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Json, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n        ],\n      },\n      {\n        name: 'Parse log line with logfmt parser and use label filter',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | logfmt | __error__=`` | label=`value`\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.LabelFilter, params: ['label', '=', 'value'] },\n        ],\n      },\n      {\n        name: 'Parse log lines with nested json',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | json | line_format `{{ .message}}` | json\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Json, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.LineFormat, params: ['{{.message}}'] },\n          { id: LokiOperationId.Json, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n        ],\n      },\n      {\n        name: 'Reformat log lines',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | logfmt | line_format `{{.message}}`\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.LineFormat, params: ['{{.message}}'] },\n        ],\n      },\n      {\n        name: 'Rename lvl label to level',\n        type: LokiQueryPatternType.Log,\n        // {} |= `` | logfmt | label_format level=lvl\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.LabelFormat, params: ['lvl', 'level'] },\n        ],\n      },\n      {\n        name: 'Query on value inside a log line',\n        type: LokiQueryPatternType.Metric,\n        // sum(sum_over_time({ | logfmt | __error__=`` | unwrap | __error__=`` [$__auto]))\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.Unwrap, params: [''] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.SumOverTime, params: ['$__auto'] },\n          { id: LokiOperationId.Sum, params: [] },\n        ],\n      },\n      {\n        name: 'Total requests per label of streams',\n        type: LokiQueryPatternType.Metric,\n        // sum by() (count_over_time({}[$__auto)\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.CountOverTime, params: ['$__auto'] },\n          { id: LokiOperationId.Sum, params: [] },\n        ],\n      },\n      {\n        name: 'Total requests per parsed label or label of streams',\n        type: LokiQueryPatternType.Metric,\n        // sum by() (count_over_time({}| logfmt | __error__=`` [$__auto))\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.CountOverTime, params: ['$__auto'] },\n          { id: LokiOperationId.Sum, params: [] },\n        ],\n      },\n      {\n        name: 'Bytes used by a log stream',\n        type: LokiQueryPatternType.Metric,\n        // bytes_over_time({}[$__auto])\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.BytesOverTime, params: ['$__auto'] },\n        ],\n      },\n      {\n        name: 'Count of log lines per stream',\n        type: LokiQueryPatternType.Metric,\n        // count_over_time({}[$__auto])\n        operations: [\n          { id: LokiOperationId.LineContains, params: [''] },\n          { id: LokiOperationId.CountOverTime, params: ['$__auto'] },\n        ],\n      },\n      {\n        name: 'Top N results by label or parsed label',\n        type: LokiQueryPatternType.Metric,\n        // topk(10, sum by () (count_over_time({} | logfmt | __error__=`` [$__auto])))\n        operations: [\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.CountOverTime, params: ['$__auto'] },\n          { id: LokiOperationId.Sum, params: [] },\n          { id: LokiOperationId.TopK, params: [10] },\n        ],\n      },\n      {\n        name: 'Extracted quantile',\n        type: LokiQueryPatternType.Metric,\n        // quantile_over_time(0.5,{} | logfmt | unwrap latency[$__auto]) by ()\n        operations: [\n          { id: LokiOperationId.Logfmt, params: [] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.Unwrap, params: ['latency'] },\n          { id: LokiOperationId.LabelFilterNoErrors, params: [] },\n          { id: LokiOperationId.QuantileOverTime, params: ['$__auto', 0.5] },\n          { id: LokiOperationId.Sum, params: [] },\n        ],\n      },\n    ];\n  }\n}\n\nexport const lokiQueryModeller = new LokiQueryModeller();\n","import { NodeType, SyntaxNode } from '@lezer/common';\nimport { sortBy } from 'lodash';\n\nimport {\n  Identifier,\n  LabelFilter,\n  LabelParser,\n  LineComment,\n  LineFilters,\n  LogExpr,\n  LogRangeExpr,\n  Matcher,\n  parser,\n  PipelineExpr,\n  Selector,\n  UnwrapExpr,\n  String,\n  PipelineStage,\n  LogfmtParser,\n  JsonExpressionParser,\n  LogfmtExpressionParser,\n  Expr,\n  LabelFormatExpr,\n} from '@grafana/lezer-logql';\nimport { QueryBuilderLabelFilter } from '@grafana/plugin-ui';\n\nimport { unescapeLabelValue } from './languageUtils';\nimport { getNodePositionsFromQuery } from './queryUtils';\nimport { lokiQueryModeller as modeller } from './querybuilder/LokiQueryModeller';\nimport { buildVisualQueryFromString, handleQuotes } from './querybuilder/parsing';\nimport { LabelType } from './types';\n\nexport class NodePosition {\n  from: number;\n  to: number;\n  type?: NodeType;\n\n  constructor(from: number, to: number, type?: NodeType) {\n    this.from = from;\n    this.to = to;\n    this.type = type;\n  }\n\n  static fromNode(node: SyntaxNode): NodePosition {\n    return new NodePosition(node.from, node.to, node.type);\n  }\n\n  contains(position: NodePosition): boolean {\n    return this.from <= position.from && this.to >= position.to;\n  }\n\n  getExpression(query: string): string {\n    return query.substring(this.from, this.to);\n  }\n}\n\n/**\n * Checks for the presence of a given label=value filter in any Matcher expression in the query.\n */\nexport function queryHasFilter(query: string, key: string, operator: string, value: string): boolean {\n  const matchers = getMatchersWithFilter(query, key, operator, value);\n  return matchers.length > 0;\n}\n\n/**\n * Removes a label=value Matcher expression from the query.\n */\nexport function removeLabelFromQuery(query: string, key: string, operator: string, value: string): string {\n  const matchers = getMatchersWithFilter(query, key, operator, value);\n  for (const matcher of matchers) {\n    query =\n      matcher.parent?.type.id === LabelFilter ? removeLabelFilter(query, matcher) : removeSelector(query, matcher);\n  }\n  return query;\n}\n\nfunction removeLabelFilter(query: string, matcher: SyntaxNode): string {\n  const pipelineStage = matcher.parent?.parent;\n  if (!pipelineStage || pipelineStage.type.id !== PipelineStage) {\n    return query;\n  }\n  return (query.substring(0, pipelineStage.from) + query.substring(pipelineStage.to)).trim();\n}\n\nfunction removeSelector(query: string, matcher: SyntaxNode): string {\n  let selector: SyntaxNode | null = matcher;\n  do {\n    selector = selector.parent;\n  } while (selector && selector.type.id !== Selector);\n  const label = matcher.getChild(Identifier);\n  if (!selector || !label) {\n    return query;\n  }\n  const labelName = query.substring(label.from, label.to);\n\n  const prefix = query.substring(0, selector.from);\n  const suffix = query.substring(selector.to);\n\n  const matchVisQuery = buildVisualQueryFromString(query.substring(selector.from, selector.to));\n  matchVisQuery.query.labels = matchVisQuery.query.labels.filter((label) => label.label !== labelName);\n\n  return prefix + modeller.renderQuery(matchVisQuery.query) + suffix;\n}\n\nfunction getMatchersWithFilter(query: string, label: string, operator: string, value: string): SyntaxNode[] {\n  const tree = parser.parse(query);\n  const matchers: SyntaxNode[] = [];\n  tree.iterate({\n    enter: ({ type, node }): void => {\n      if (type.id === Matcher) {\n        matchers.push(node);\n      }\n    },\n  });\n  return matchers.filter((matcher) => {\n    const labelNode = matcher.getChild(Identifier);\n    const opNode = labelNode?.nextSibling;\n    const valueNode = matcher.getChild(String);\n    if (!labelNode || !opNode || !valueNode) {\n      return false;\n    }\n    const labelName = query.substring(labelNode.from, labelNode.to);\n    if (labelName !== label) {\n      return false;\n    }\n    const labelValue = query.substring(valueNode.from, valueNode.to);\n    if (handleQuotes(labelValue) !== unescapeLabelValue(value)) {\n      return false;\n    }\n    const labelOperator = query.substring(opNode.from, opNode.to);\n    if (labelOperator !== operator) {\n      return false;\n    }\n    return true;\n  });\n}\n\n/**\n * Adds label filter to existing query. Useful for query modification for example for ad hoc filters.\n *\n * It uses LogQL parser to find instances of labels, alters them and then splices them back into the query.\n * In a case when we have parser, instead of adding new instance of label it adds label filter after the parser.\n *\n * This operates on substrings of the query with labels and operates just on those. This makes this\n * more robust and can alter even invalid queries, and preserves in general the query structure and whitespace.\n */\nexport function addLabelToQuery(\n  query: string,\n  key: string,\n  operator: string,\n  value: string,\n  labelType?: LabelType | null\n): string {\n  if (!key) {\n    throw new Error('Need label to add to query.');\n  }\n\n  const streamSelectorPositions = getStreamSelectorPositions(query);\n  if (!streamSelectorPositions.length) {\n    return query;\n  }\n\n  const parserPositions = getParserPositions(query);\n  const labelFilterPositions = getLabelFilterPositions(query);\n  const hasStreamSelectorMatchers = getMatcherInStreamPositions(query);\n  // For non-indexed labels we want to add them after label_format to, for example, allow ad-hoc filters to use formatted labels\n  const labelFormatPositions = getNodePositionsFromQuery(query, [LabelFormatExpr]);\n\n  // If the label type wasn't passed in from the calling function, we can use lezer to figure out if this label is already in the stream selectors\n  if (!labelType) {\n    const identifierSelectorMatchers = getIdentifierInStreamPositions(query);\n    const indexedKeys = identifierSelectorMatchers.map((match) => match.getExpression(query));\n    if (indexedKeys.includes(key)) {\n      labelType = LabelType.Indexed;\n    }\n  }\n\n  const everyStreamSelectorHasMatcher = streamSelectorPositions.every((streamSelectorPosition) =>\n    hasStreamSelectorMatchers.some(\n      (matcherPosition) =>\n        matcherPosition.from >= streamSelectorPosition.from && matcherPosition.to <= streamSelectorPosition.to\n    )\n  );\n\n  const filter = toLabelFilter(key, value, operator);\n  if (labelType === LabelType.Parsed || labelType === LabelType.StructuredMetadata) {\n    const lastPositionsPerExpression = getLastPositionPerExpression(query, [\n      ...streamSelectorPositions,\n      ...labelFilterPositions,\n      ...parserPositions,\n      ...labelFormatPositions,\n    ]);\n\n    return addFilterAsLabelFilter(query, lastPositionsPerExpression, filter);\n  } else if (labelType === LabelType.Indexed) {\n    return addFilterToStreamSelector(query, streamSelectorPositions, filter);\n  } else {\n    // labelType is not set, so we need to figure out where to add the label\n    // if we don't have a parser, or have empty stream selectors, we will just add it to the stream selector\n    if (parserPositions.length === 0 || everyStreamSelectorHasMatcher === false) {\n      return addFilterToStreamSelector(query, streamSelectorPositions, filter);\n    } else {\n      // If `labelType` is not set, it indicates a potential metric query (`labelType` is present only in log queries that came from a Loki instance supporting the `categorize-labels` API). In case we are not adding the label to stream selectors we need to find the last position to add in each expression.\n      // E.g. in `sum(rate({foo=\"bar\"} | logfmt [$__auto])) / sum(rate({foo=\"baz\"} | logfmt [$__auto]))` we need to add the label at two places.\n      const lastPositionsPerExpression = getLastPositionPerExpression(query, [\n        ...parserPositions,\n        ...labelFilterPositions,\n        ...labelFormatPositions,\n      ]);\n\n      return addFilterAsLabelFilter(query, lastPositionsPerExpression, filter);\n    }\n  }\n}\n\nfunction getLastPositionPerExpression(query: string, positions: NodePosition[]): NodePosition[] {\n  const subExpressions = findLeaves(getNodePositionsFromQuery(query, [Expr]));\n  const subPositions = [...positions];\n\n  // find last position for each subexpression\n  const lastPositionsPerExpression = subExpressions.map((subExpression) => {\n    return findLastPosition(\n      subPositions.filter((p) => {\n        return subExpression.contains(p);\n      })\n    );\n  });\n  return lastPositionsPerExpression;\n}\n\n/**\n * Adds parser to existing query. Useful for query modification for hints.\n * It uses LogQL parser to find instances of stream selectors or line filters and adds parser after them.\n *\n * @param query\n * @param parser\n */\nexport function addParserToQuery(query: string, parser: string): string {\n  const lineFilterPositions = getLineFiltersPositions(query);\n\n  if (lineFilterPositions.length) {\n    return appendToLogsQuery(query, lineFilterPositions, parser);\n  } else {\n    const streamSelectorPositions = getStreamSelectorPositions(query);\n    if (!streamSelectorPositions.length) {\n      return query;\n    }\n    return appendToLogsQuery(query, streamSelectorPositions, parser);\n  }\n}\n\n/**\n * Adds a drop statement to the query.\n * It uses LogQL parser to find instances of stream selectors or line filters and adds parser after them.\n *\n * @param query\n * @param parser\n */\nexport function addDropToQuery(query: string, labelsToDrop: string[]): string {\n  const lineFilterPositions = getLineFiltersPositions(query);\n\n  if (lineFilterPositions.length) {\n    return appendToLogsQuery(query, lineFilterPositions, `drop ${labelsToDrop.join(', ')}`);\n  } else {\n    const streamSelectorPositions = getStreamSelectorPositions(query);\n    if (!streamSelectorPositions.length) {\n      return query;\n    }\n    return appendToLogsQuery(query, streamSelectorPositions, `drop ${labelsToDrop.join(', ')}`);\n  }\n}\n\n/**\n * Adds a statement after line filters or stream selectors\n * @param query\n * @param queryPartPositions\n * @param parser\n */\nfunction appendToLogsQuery(query: string, queryPartPositions: NodePosition[], statement: string): string {\n  let newQuery = '';\n  let prev = 0;\n\n  for (let i = 0; i < queryPartPositions.length; i++) {\n    // Splice on a string for each matched vector selector\n    const match = queryPartPositions[i];\n    const isLast = i === queryPartPositions.length - 1;\n\n    const start = query.substring(prev, match.to);\n    const end = isLast ? query.substring(match.to) : '';\n\n    // Add parser\n    newQuery += start + ` | ${statement}` + end;\n    prev = match.to;\n  }\n  return newQuery;\n}\n\n/**\n * Adds filtering for pipeline errors to existing query. Useful for query modification for hints.\n * It uses LogQL parser to find parsers and adds pipeline errors filtering after them.\n *\n * @param query\n */\nexport function addNoPipelineErrorToQuery(query: string): string {\n  const parserPositions = getParserPositions(query);\n  if (!parserPositions.length) {\n    return query;\n  }\n\n  const filter = toLabelFilter('__error__', '', '=');\n  return addFilterAsLabelFilter(query, parserPositions, filter);\n}\n\n/**\n * Adds label format to existing query. Useful for query modification for hints.\n * It uses LogQL parser to find log query and add label format at the end.\n *\n * @param query\n * @param labelFormat\n */\nexport function addLabelFormatToQuery(query: string, labelFormat: { originalLabel: string; renameTo: string }): string {\n  const logQueryPositions = getLogQueryPositions(query);\n  return addLabelFormat(query, logQueryPositions, labelFormat);\n}\n\n/**\n * Removes all comments from query.\n * It uses  LogQL parser to find all LineComments and removes them.\n */\nexport function removeCommentsFromQuery(query: string): string {\n  const lineCommentPositions = getLineCommentPositions(query);\n\n  if (!lineCommentPositions.length) {\n    return query;\n  }\n\n  let newQuery = '';\n  let prev = 0;\n\n  for (let lineCommentPosition of lineCommentPositions) {\n    newQuery = newQuery + query.substring(prev, lineCommentPosition.from);\n    prev = lineCommentPosition.to;\n  }\n  newQuery = newQuery + query.substring(prev);\n  return newQuery;\n}\n\n/**\n * Parse the string and get all Selector positions in the query together with parsed representation of the\n * selector.\n * @param query\n */\nexport function getStreamSelectorPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ type, node }): false | void => {\n      if (type.id === Selector) {\n        positions.push(NodePosition.fromNode(node));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\n/**\n * Parse the string and get all LabelParser positions in the query.\n * @param query\n */\nexport function getParserPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  const parserNodeTypes = [LabelParser, JsonExpressionParser, LogfmtParser, LogfmtExpressionParser];\n  tree.iterate({\n    enter: ({ type, node }): false | void => {\n      if (parserNodeTypes.includes(type.id)) {\n        positions.push(NodePosition.fromNode(node));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\n/**\n * Parse the string and get all LabelFilter positions in the query.\n * @param query\n */\nexport function getLabelFilterPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ type, node }): false | void => {\n      if (type.id === LabelFilter) {\n        positions.push(NodePosition.fromNode(node));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\n/**\n * Parse the string and get all Line filter positions in the query.\n * @param query\n */\nfunction getLineFiltersPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ type, node }): false | void => {\n      if (type.id === LineFilters) {\n        positions.push(NodePosition.fromNode(node));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\n/**\n * Parse the string and get all Log query positions in the query.\n * @param query\n */\nfunction getLogQueryPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ type, node }): false | void => {\n      if (type.id === LogExpr) {\n        positions.push(NodePosition.fromNode(node));\n        return false;\n      }\n\n      // This is a case in metrics query\n      if (type.id === LogRangeExpr) {\n        // Unfortunately, LogRangeExpr includes both log and non-log (e.g. Duration/Range/...) parts of query.\n        // We get position of all log-parts within LogRangeExpr: Selector, PipelineExpr and UnwrapExpr.\n        const logPartsPositions: NodePosition[] = [];\n        const selector = node.getChild(Selector);\n        if (selector) {\n          logPartsPositions.push(NodePosition.fromNode(selector));\n        }\n\n        const pipeline = node.getChild(PipelineExpr);\n        if (pipeline) {\n          logPartsPositions.push(NodePosition.fromNode(pipeline));\n        }\n\n        const unwrap = node.getChild(UnwrapExpr);\n        if (unwrap) {\n          logPartsPositions.push(NodePosition.fromNode(unwrap));\n        }\n\n        // We sort them and then pick \"from\" from first position and \"to\" from last position.\n        const sorted = sortBy(logPartsPositions, (position) => position.to);\n        positions.push(new NodePosition(sorted[0].from, sorted[sorted.length - 1].to));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\nexport function toLabelFilter(key: string, value: string, operator: string): QueryBuilderLabelFilter {\n  // We need to make sure that we convert the value back to string because it may be a number\n  return { label: key, op: operator, value };\n}\n\n/**\n * Add filter as to stream selectors\n * @param query\n * @param vectorSelectorPositions\n * @param filter\n */\nfunction addFilterToStreamSelector(\n  query: string,\n  vectorSelectorPositions: NodePosition[],\n  filter: QueryBuilderLabelFilter\n): string {\n  let newQuery = '';\n  let prev = 0;\n\n  for (let i = 0; i < vectorSelectorPositions.length; i++) {\n    // This is basically just doing splice on a string for each matched vector selector.\n    const match = vectorSelectorPositions[i];\n    const isLast = i === vectorSelectorPositions.length - 1;\n\n    const start = query.substring(prev, match.from);\n    const end = isLast ? query.substring(match.to) : '';\n    const matchVisQuery = buildVisualQueryFromString(query.substring(match.from, match.to));\n\n    if (!labelExists(matchVisQuery.query.labels, filter)) {\n      // We don't want to add duplicate labels.\n      matchVisQuery.query.labels.push(filter);\n    }\n    const newLabels = modeller.renderQuery(matchVisQuery.query);\n    newQuery += start + newLabels + end;\n    prev = match.to;\n  }\n  return newQuery;\n}\n\n/**\n * Add filter as label filter after the parsers\n * @param query\n * @param positionsToAddAfter\n * @param filter\n */\nexport function addFilterAsLabelFilter(\n  query: string,\n  positionsToAddAfter: NodePosition[],\n  filter: QueryBuilderLabelFilter\n): string {\n  let newQuery = '';\n  let prev = 0;\n\n  for (let i = 0; i < positionsToAddAfter.length; i++) {\n    // This is basically just doing splice on a string for each matched vector selector.\n    const match = positionsToAddAfter[i];\n    const isLast = i === positionsToAddAfter.length - 1;\n\n    const start = query.substring(prev, match.to);\n    const end = isLast ? query.substring(match.to) : '';\n\n    let labelFilter = '';\n    // For < and >, if the value is number, we don't add quotes around it and use it as number\n    if (!Number.isNaN(Number(filter.value)) && (filter.op === '<' || filter.op === '>')) {\n      labelFilter = ` | ${filter.label}${filter.op}${Number(filter.value)}`;\n    } else {\n      // we now unescape all escaped values again, because we are using backticks which can handle those cases.\n      // we also don't care about the operator here, because we need to unescape for both, regex and equal.\n      labelFilter = ` | ${filter.label}${filter.op}\\`${unescapeLabelValue(filter.value)}\\``;\n    }\n\n    newQuery += start + labelFilter + end;\n    prev = match.to;\n  }\n  return newQuery;\n}\n\n/**\n * Add filter as label filter after the parsers\n * @param query\n * @param logQueryPositions\n * @param labelFormat\n */\nfunction addLabelFormat(\n  query: string,\n  logQueryPositions: NodePosition[],\n  labelFormat: { originalLabel: string; renameTo: string }\n): string {\n  let newQuery = '';\n  let prev = 0;\n\n  for (let i = 0; i < logQueryPositions.length; i++) {\n    // This is basically just doing splice on a string for each matched vector selector.\n    const match = logQueryPositions[i];\n    const isLast = i === logQueryPositions.length - 1;\n\n    const start = query.substring(prev, match.to);\n    const end = isLast ? query.substring(match.to) : '';\n\n    const labelFilter = ` | label_format ${labelFormat.renameTo}=${labelFormat.originalLabel}`;\n    newQuery += start + labelFilter + end;\n    prev = match.to;\n  }\n  return newQuery;\n}\n\nexport function addLineFilter(query: string, value = '', operator = '|='): string {\n  const streamSelectorPositions = getStreamSelectorPositions(query);\n  if (!streamSelectorPositions.length) {\n    return query;\n  }\n  const streamSelectorEnd = streamSelectorPositions[0].to;\n\n  const newQueryExpr = query.slice(0, streamSelectorEnd) + ` ${operator} \\`${value}\\`` + query.slice(streamSelectorEnd);\n  return newQueryExpr;\n}\n\nfunction getLineCommentPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ type, from, to }): false | void => {\n      if (type.id === LineComment) {\n        positions.push(new NodePosition(from, to, type));\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\n/**\n * Check if label exists in the list of labels but ignore the operator.\n * @param labels\n * @param filter\n */\nfunction labelExists(labels: QueryBuilderLabelFilter[], filter: QueryBuilderLabelFilter) {\n  return labels.find((label) => label.label === filter.label && label.value === filter.value);\n}\n\n/**\n * Return the last position based on \"to\" property\n * @param positions\n */\nexport function findLastPosition(positions: NodePosition[]): NodePosition {\n  if (!positions.length) {\n    return new NodePosition(0, 0);\n  }\n  return positions.reduce((prev, current) => (prev.to > current.to ? prev : current));\n}\n\n/**\n * Gets all leaves of the nodes given. Leaves are nodes that don't contain any other nodes.\n *\n * @param {NodePosition[]} nodes\n * @return\n */\nfunction findLeaves(nodes: NodePosition[]): NodePosition[] {\n  return nodes.filter((node) => nodes.every((n) => node.contains(n) === false || node === n));\n}\n\nfunction getAllPositionsInNodeByType(node: SyntaxNode, type: number): NodePosition[] {\n  if (node.type.id === type) {\n    return [NodePosition.fromNode(node)];\n  }\n\n  const positions: NodePosition[] = [];\n  let pos = 0;\n  let child = node.childAfter(pos);\n  while (child) {\n    positions.push(...getAllPositionsInNodeByType(child, type));\n    pos = child.to;\n    child = node.childAfter(pos);\n  }\n  return positions;\n}\n\nfunction getMatcherInStreamPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ node }): false | void => {\n      if (node.type.id === Selector) {\n        positions.push(...getAllPositionsInNodeByType(node, Matcher));\n      }\n    },\n  });\n  return positions;\n}\n\nexport function getIdentifierInStreamPositions(query: string): NodePosition[] {\n  const tree = parser.parse(query);\n  const positions: NodePosition[] = [];\n  tree.iterate({\n    enter: ({ node }): false | void => {\n      if (node.type.id === Selector) {\n        positions.push(...getAllPositionsInNodeByType(node, Identifier));\n      }\n    },\n  });\n  return positions;\n}\n","// every timestamp in this file is a number which contains an unix-timestamp-in-millisecond format,\n// like returned by `new Date().getTime()`. this is needed because the \"math\"\n// has to be done on integer numbers.\n\n// the way loki handles logs-range-queries is that if you specify start & end,\n// one of those will be included, but the other will not. this allows us to\n// make it easy to split ranges.\n// for example, if the time-range is 100<>150,\n// we can split it into:\n// - 100<>120\n// - 120<>140\n// - 140<>150\n// and no log-line will be skipped or duplicated\n// (NOTE: we do these calculations in milliseconds. at the end, Loki receives\n// nanoseconds, but it will be OK, because it's simply a matter to adding `000000`,\n// to the end, so if we do it right in milliseconds, it should be OK in\n// nanoseconds too\n\nexport function splitTimeRange(\n  startTime: number,\n  endTime: number,\n  idealRangeDuration: number\n): Array<[number, number]> {\n  if (endTime - startTime <= idealRangeDuration) {\n    return [[startTime, endTime]];\n  }\n\n  const result: Array<[number, number]> = [];\n\n  // we walk backward, because we need want the potentially smaller \"last\" chunk\n  // to be at the oldest timestamp.\n  for (let chunkEndTime = endTime; chunkEndTime > startTime; chunkEndTime -= idealRangeDuration) {\n    // when we get close to the start of the time range, we need to be sure not\n    // to cross over the startTime\n    const chunkStartTime = Math.max(chunkEndTime - idealRangeDuration, startTime);\n    result.push([chunkStartTime, chunkEndTime]);\n  }\n\n  // because we walked backwards, we need to reverse the array\n  result.reverse();\n\n  return result;\n}\n","// every timestamp in this file is a number which contains an unix-timestamp-in-millisecond format,\n// like returned by `new Date().getTime()`. this is needed because the \"math\"\n// has to be done on integer numbers.\n\n// we are trying to be compatible with\n// https://github.com/grafana/loki/blob/089ec1b05f5ec15a8851d0e8230153e0eeb4dcec/pkg/querier/queryrange/split_by_interval.go#L327-L336\n\nexport function splitTimeRange(\n  startTime: number,\n  endTime: number,\n  step: number,\n  idealRangeDuration: number\n): Array<[number, number]> {\n  if (idealRangeDuration < step) {\n    // we cannot create chunks smaller than `step`\n    return [[startTime, endTime]];\n  }\n\n  // we make the duration a multiple of `step`, lowering it if necessary\n  const alignedDuration = Math.trunc(idealRangeDuration / step) * step;\n\n  const alignedStartTime = startTime - (startTime % step);\n\n  const result: Array<[number, number]> = [];\n\n  // in a previous version we started iterating from the end, to the start.\n  // However this is not easily possible as end timestamps are always inclusive\n  // for Loki. So a `2022-02-08T00:00:00Z` end time with a 1day step would mean\n  // to include the 08.02.2022, which we don't want. So we have to start from\n  // the start, always ending at the last step before the actual end, or the total end.\n  for (let chunkStartTime = alignedStartTime; chunkStartTime < endTime; chunkStartTime += alignedDuration) {\n    const chunkEndTime = Math.min(chunkStartTime + alignedDuration - step, endTime);\n    result.push([chunkStartTime, chunkEndTime]);\n  }\n\n  return result;\n}\n","import { groupBy, partition } from 'lodash';\nimport { Observable, Subscriber, Subscription, tap } from 'rxjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport {\n  arrayToDataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataTopic,\n  dateTime,\n  rangeUtil,\n  TimeRange,\n  LoadingState,\n} from '@grafana/data';\n\nimport { LokiDatasource } from './datasource';\nimport { splitTimeRange as splitLogsTimeRange } from './logsTimeSplitting';\nimport { combineResponses } from './mergeResponses';\nimport { splitTimeRange as splitMetricTimeRange } from './metricTimeSplitting';\nimport { isLogsQuery, isQueryWithRangeVariable } from './queryUtils';\nimport { isRetriableError } from './responseUtils';\nimport { trackGroupedQueries } from './tracking';\nimport { LokiGroupedRequest, LokiQuery, LokiQueryDirection, LokiQueryType } from './types';\n\nexport function partitionTimeRange(\n  isLogsQuery: boolean,\n  originalTimeRange: TimeRange,\n  stepMs: number,\n  duration: number\n): TimeRange[] {\n  const start = originalTimeRange.from.toDate().getTime();\n  const end = originalTimeRange.to.toDate().getTime();\n\n  const ranges = isLogsQuery\n    ? splitLogsTimeRange(start, end, duration)\n    : splitMetricTimeRange(start, end, stepMs, duration);\n\n  return ranges.map(([start, end]) => {\n    const from = dateTime(start);\n    const to = dateTime(end);\n    return {\n      from,\n      to,\n      raw: { from, to },\n    };\n  });\n}\n\ninterface QuerySplittingOptions {\n  /**\n   * Tells the query splitting code to not emit partial updates. Only emit on error or when it finishes querying.\n   */\n  skipPartialUpdates?: boolean;\n  /**\n   * Do not retry failed queries.\n   */\n  disableRetry?: boolean;\n}\n\n/**\n * Based in the state of the current response, if any, adjust target parameters such as `maxLines`.\n * For `maxLines`, we will update it as `maxLines - current amount of lines`.\n * At the end, we will filter the targets that don't need to be executed in the next request batch,\n * becasue, for example, the `maxLines` have been reached.\n */\nexport function adjustTargetsFromResponseState(targets: LokiQuery[], response: DataQueryResponse | null): LokiQuery[] {\n  if (!response) {\n    return targets;\n  }\n\n  return targets\n    .map((target) => {\n      if (!target.maxLines || !isLogsQuery(target.expr)) {\n        return target;\n      }\n      const targetFrame = response.data.find((frame) => frame.refId === target.refId);\n      if (!targetFrame) {\n        return target;\n      }\n      const updatedMaxLines = target.maxLines - targetFrame.length;\n      return {\n        ...target,\n        maxLines: updatedMaxLines < 0 ? 0 : updatedMaxLines,\n      };\n    })\n    .filter((target) => target.maxLines === undefined || target.maxLines > 0);\n}\nexport function runSplitGroupedQueries(\n  datasource: LokiDatasource,\n  requests: LokiGroupedRequest[],\n  options: QuerySplittingOptions = {}\n) {\n  const responseKey = requests.length ? requests[0].request.queryGroupId : uuidv4();\n  let mergedResponse: DataQueryResponse = { data: [], state: LoadingState.Streaming, key: responseKey };\n  const totalRequests = Math.max(...requests.map(({ partition }) => partition.length));\n  const longestPartition = requests.filter(({ partition }) => partition.length === totalRequests)[0].partition;\n\n  let shouldStop = false;\n  let subquerySubscription: Subscription | null = null;\n  let retriesMap = new Map<string, number>();\n  let retryTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const runNextRequest = (subscriber: Subscriber<DataQueryResponse>, requestN: number, requestGroup: number) => {\n    let retrying = false;\n\n    if (subquerySubscription != null) {\n      subquerySubscription.unsubscribe();\n      subquerySubscription = null;\n    }\n\n    if (shouldStop) {\n      subscriber.complete();\n      return;\n    }\n\n    const done = () => {\n      mergedResponse.state = LoadingState.Done;\n      subscriber.next(mergedResponse);\n      subscriber.complete();\n    };\n\n    const nextRequest = () => {\n      const { nextRequestN, nextRequestGroup } = getNextRequestPointers(requests, requestGroup, requestN);\n      if (nextRequestN > 0 && nextRequestGroup >= 0) {\n        runNextRequest(subscriber, nextRequestN, nextRequestGroup);\n        return;\n      }\n      done();\n    };\n\n    const retry = (errorResponse?: DataQueryResponse) => {\n      if (options.disableRetry) {\n        return false;\n      }\n      try {\n        if (errorResponse && !isRetriableError(errorResponse)) {\n          return false;\n        }\n      } catch (e) {\n        console.error(e);\n        shouldStop = true;\n        return false;\n      }\n\n      const key = `${requestN}-${requestGroup}`;\n      const retries = retriesMap.get(key) ?? 0;\n      if (retries > 0) {\n        return false;\n      }\n\n      retriesMap.set(key, retries + 1);\n\n      retryTimer = setTimeout(\n        () => {\n          runNextRequest(subscriber, requestN, requestGroup);\n        },\n        1500 * Math.pow(2, retries)\n      ); // Exponential backoff\n\n      retrying = true;\n\n      return true;\n    };\n\n    const group = requests[requestGroup];\n    const range = group.partition[requestN - 1];\n    const targets = adjustTargetsFromResponseState(group.request.targets, mergedResponse);\n\n    if (!targets.length) {\n      nextRequest();\n      return;\n    }\n\n    const subRequest = { ...requests[requestGroup].request, range, targets };\n    // request may not have a request id\n    if (group.request.requestId) {\n      subRequest.requestId = `${group.request.requestId}_${requestN}`;\n    }\n\n    subquerySubscription = datasource.runQuery(subRequest).subscribe({\n      next: (partialResponse) => {\n        if ((partialResponse.errors ?? []).length > 0 || partialResponse.error != null) {\n          if (retry(partialResponse)) {\n            return;\n          }\n          shouldStop = true;\n        }\n        mergedResponse = combineResponses(mergedResponse, partialResponse);\n        if (!options.skipPartialUpdates) {\n          mergedResponse = updateLoadingFrame(mergedResponse, subRequest, longestPartition, requestN);\n        }\n      },\n      complete: () => {\n        if (retrying) {\n          return;\n        }\n        if (!options.skipPartialUpdates) {\n          subscriber.next(mergedResponse);\n        }\n        nextRequest();\n      },\n      error: (error) => {\n        subscriber.error(error);\n        if (retry()) {\n          return;\n        }\n      },\n    });\n  };\n\n  const response = new Observable<DataQueryResponse>((subscriber) => {\n    runNextRequest(subscriber, totalRequests, 0);\n    return () => {\n      shouldStop = true;\n      if (retryTimer) {\n        clearTimeout(retryTimer);\n        retryTimer = null;\n      }\n      if (subquerySubscription != null) {\n        subquerySubscription.unsubscribe();\n        subquerySubscription = null;\n      }\n    };\n  });\n\n  return response;\n}\n\nexport const LOADING_FRAME_NAME = 'loki-splitting-progress';\n\nfunction updateLoadingFrame(\n  response: DataQueryResponse,\n  request: DataQueryRequest<LokiQuery>,\n  partition: TimeRange[],\n  requestN: number\n): DataQueryResponse {\n  if (isLogsQuery(request.targets[0].expr)) {\n    return response;\n  }\n  response.data = response.data.filter((frame) => frame.name !== LOADING_FRAME_NAME);\n\n  if (requestN <= 1) {\n    return response;\n  }\n\n  const loadingFrame = arrayToDataFrame([\n    {\n      time: partition[0].from.valueOf(),\n      timeEnd: partition[requestN - 2].to.valueOf(),\n      isRegion: true,\n      color: 'rgba(120, 120, 120, 0.1)',\n    },\n  ]);\n  loadingFrame.name = LOADING_FRAME_NAME;\n  loadingFrame.meta = {\n    dataTopic: DataTopic.Annotations,\n  };\n\n  response.data.push(loadingFrame);\n\n  return response;\n}\n\nfunction getNextRequestPointers(requests: LokiGroupedRequest[], requestGroup: number, requestN: number) {\n  // There's a pending request from the next group:\n  for (let i = requestGroup + 1; i < requests.length; i++) {\n    const group = requests[i];\n    if (group.partition[requestN - 1]) {\n      return {\n        nextRequestGroup: i,\n        nextRequestN: requestN,\n      };\n    }\n  }\n  return {\n    // Find the first group where `[requestN - 1]` is defined\n    nextRequestGroup: requests.findIndex((group) => group?.partition[requestN - 1] !== undefined),\n    nextRequestN: requestN - 1,\n  };\n}\n\nfunction querySupportsSplitting(query: LokiQuery) {\n  return (\n    query.queryType !== LokiQueryType.Instant &&\n    // Queries with $__range variable should not be split because then the interpolated $__range variable is incorrect\n    // because it is interpolated on the backend with the split timeRange\n    !isQueryWithRangeVariable(query.expr)\n  );\n}\n\nexport function runSplitQuery(\n  datasource: LokiDatasource,\n  request: DataQueryRequest<LokiQuery>,\n  options: QuerySplittingOptions = {}\n) {\n  const queries = request.targets\n    .filter((query) => !query.hide)\n    .filter((query) => query.expr)\n    .map((query) => datasource.applyTemplateVariables(query, request.scopedVars, request.filters));\n  const [nonSplittingQueries, normalQueries] = partition(queries, (query) => !querySupportsSplitting(query));\n  const [logQueries, metricQueries] = partition(normalQueries, (query) => isLogsQuery(query.expr));\n\n  request.queryGroupId = uuidv4();\n  const oneDayMs = 24 * 60 * 60 * 1000;\n  const directionPartitionedLogQueries = groupBy(logQueries, (query) =>\n    query.direction === LokiQueryDirection.Forward ? LokiQueryDirection.Forward : LokiQueryDirection.Backward\n  );\n  const requests: LokiGroupedRequest[] = [];\n\n  for (const direction in directionPartitionedLogQueries) {\n    const queries = directionPartitionedLogQueries[direction];\n    const resolutionPartition = groupBy(queries, (query) => query.resolution || 1);\n    for (const resolution in resolutionPartition) {\n      const groupedRequest = {\n        request: { ...request, targets: resolutionPartition[resolution] },\n        partition: partitionTimeRange(true, request.range, request.intervalMs, oneDayMs),\n      };\n\n      if (direction === LokiQueryDirection.Forward) {\n        groupedRequest.partition.reverse();\n      }\n\n      requests.push(groupedRequest);\n    }\n  }\n\n  const stepMsPartition = groupBy(metricQueries, (query) =>\n    calculateStep(request.intervalMs, request.range, query.resolution || 1, query.step)\n  );\n\n  for (const stepMs in stepMsPartition) {\n    const targets = stepMsPartition[stepMs].map((q) => {\n      const { maxLines, ...query } = q;\n      return query;\n    });\n    requests.push({\n      request: { ...request, targets },\n      partition: partitionTimeRange(false, request.range, Number(stepMs), oneDayMs),\n    });\n  }\n\n  if (nonSplittingQueries.length) {\n    requests.push({\n      request: { ...request, targets: nonSplittingQueries },\n      partition: [request.range],\n    });\n  }\n\n  const startTime = new Date();\n  return runSplitGroupedQueries(datasource, requests, options).pipe(\n    tap((response) => {\n      if (response.state === LoadingState.Done) {\n        trackGroupedQueries(response, requests, request, startTime);\n      }\n    })\n  );\n}\n\n// Replicate from backend for split queries for now, until we can move query splitting to the backend\n// https://github.com/grafana/grafana/blob/main/pkg/tsdb/loki/step.go#L23\nfunction calculateStep(intervalMs: number, range: TimeRange, resolution: number, step: string | undefined) {\n  // If we can parse step,the we use it\n  // Otherwise we will calculate step based on interval\n  const interval_regex = /(-?\\d+(?:\\.\\d+)?)(ms|[Mwdhmsy])/;\n  if (step?.match(interval_regex)) {\n    return rangeUtil.intervalToMs(step) * resolution;\n  }\n\n  const newStep = intervalMs * resolution;\n  const safeStep = Math.round((range.to.valueOf() - range.from.valueOf()) / 11000);\n  return Math.max(newStep, safeStep);\n}\n","import { SyntaxNode } from '@lezer/common';\nimport { escapeRegExp } from 'lodash';\n\nimport {\n  parser,\n  LineFilter,\n  PipeExact,\n  PipeMatch,\n  Filter,\n  String,\n  LabelFormatExpr,\n  Selector,\n  PipelineExpr,\n  LabelParser,\n  JsonExpressionParser,\n  LabelFilter,\n  MetricExpr,\n  Matcher,\n  Identifier,\n  Range,\n  Logfmt,\n  Json,\n  OrFilter,\n  FilterOp,\n  RangeOp,\n  VectorOp,\n  BinOpExpr,\n} from '@grafana/lezer-logql';\nimport { DataQuery } from '@grafana/schema';\n\nimport { addDropToQuery, addLabelToQuery, getStreamSelectorPositions, NodePosition } from './modifyQuery';\nimport { ErrorId } from './querybuilder/parsingUtils';\nimport { LabelType, LokiQuery, LokiQueryDirection, LokiQueryType } from './types';\n\n/**\n * Returns search terms from a LogQL query.\n * E.g., `{} |= \"foo\" |= \"bar\" != \"baz\"` returns `['foo', 'bar']`.\n */\nexport function getHighlighterExpressionsFromQuery(input = ''): string[] {\n  const results: string[] = [];\n\n  const filters = getNodesFromQuery(input, [LineFilter]);\n\n  for (const filter of filters) {\n    const pipeExact = filter.getChild(Filter)?.getChild(PipeExact);\n    const pipeMatch = filter.getChild(Filter)?.getChild(PipeMatch);\n    const strings = getStringsFromLineFilter(filter);\n\n    if ((!pipeExact && !pipeMatch) || !strings.length) {\n      continue;\n    }\n\n    for (const string of strings) {\n      const filterTerm = input.substring(string.from, string.to).trim();\n      const backtickedTerm = filterTerm[0] === '`';\n      const unwrappedFilterTerm = filterTerm.substring(1, filterTerm.length - 1);\n\n      if (!unwrappedFilterTerm) {\n        continue;\n      }\n\n      let resultTerm = '';\n\n      // Only filter expressions with |~ operator are treated as regular expressions\n      if (pipeMatch) {\n        // When using backticks, Loki doesn't require to escape special characters and we can just push regular expression to highlights array\n        // When using quotes, we have extra backslash escaping and we need to replace \\\\ with \\\n        resultTerm = backtickedTerm ? unwrappedFilterTerm : unwrappedFilterTerm.replace(/\\\\\\\\/g, '\\\\');\n      } else {\n        // We need to escape this string so it is not matched as regular expression\n        resultTerm = escapeRegExp(unwrappedFilterTerm);\n      }\n\n      if (resultTerm) {\n        results.push(resultTerm);\n      }\n    }\n  }\n  return results;\n}\n\nexport function getExpressionFromExecutedQuery(executedQueryString: string) {\n  return executedQueryString.replace('Expr: ', '');\n}\n\nexport function getStringsFromLineFilter(filter: SyntaxNode): SyntaxNode[] {\n  const nodes: SyntaxNode[] = [];\n  let node: SyntaxNode | null = filter;\n  do {\n    const string = node.getChild(String);\n    if (string && !node.getChild(FilterOp)) {\n      nodes.push(string);\n    }\n    node = node.getChild(OrFilter);\n  } while (node != null);\n\n  return nodes;\n}\n\nexport function getNormalizedLokiQuery(query: LokiQuery): LokiQuery {\n  let queryType = getLokiQueryType(query);\n  // instant and range are deprecated, we want to remove them\n  const { instant, range, ...rest } = query;\n\n  // if `query.expr` is not parsable this might throw an error\n  try {\n    if (isLogsQuery(query.expr) && queryType === LokiQueryType.Instant) {\n      queryType = LokiQueryType.Range;\n    }\n  } catch (e) {}\n  return { ...rest, queryType };\n}\n\nexport function getLokiQueryType(query: LokiQuery): LokiQueryType {\n  // we are migrating from `.instant` and `.range` to `.queryType`\n  // this function returns the correct query type\n  const { queryType } = query;\n  const hasValidQueryType =\n    queryType === LokiQueryType.Range || queryType === LokiQueryType.Instant || queryType === LokiQueryType.Stream;\n\n  // if queryType exists, it is respected\n  if (hasValidQueryType) {\n    return queryType;\n  }\n\n  // if no queryType, and instant===true, it's instant\n  if (query.instant === true) {\n    return LokiQueryType.Instant;\n  }\n\n  // otherwise it is range\n  return LokiQueryType.Range;\n}\n\nconst tagsToObscure = ['String', 'Identifier', 'LineComment', 'Number'];\nconst partsToKeep = ['__error__', '__interval', '__interval_ms', '__auto'];\nexport function obfuscate(query: string): string {\n  let obfuscatedQuery: string = query;\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ name, from, to }): false | void => {\n      const queryPart = query.substring(from, to);\n      if (tagsToObscure.includes(name) && !partsToKeep.includes(queryPart)) {\n        obfuscatedQuery = obfuscatedQuery.replace(queryPart, name);\n      }\n    },\n  });\n  return obfuscatedQuery;\n}\n\nexport function parseToNodeNamesArray(query: string): string[] {\n  const queryParts: string[] = [];\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ name }): false | void => {\n      queryParts.push(name);\n    },\n  });\n  return queryParts;\n}\n\nexport function isQueryWithNode(query: string, nodeType: number): boolean {\n  let isQueryWithNode = false;\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === nodeType) {\n        isQueryWithNode = true;\n        return false;\n      }\n    },\n  });\n  return isQueryWithNode;\n}\n\nexport function getNodesFromQuery(query: string, nodeTypes?: number[]): SyntaxNode[] {\n  const nodes: SyntaxNode[] = [];\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: (node): false | void => {\n      if (nodeTypes === undefined || nodeTypes.includes(node.type.id)) {\n        nodes.push(node.node);\n      }\n    },\n  });\n  return nodes;\n}\n\nexport function getNodePositionsFromQuery(query: string, nodeTypes?: number[]): NodePosition[] {\n  const positions: NodePosition[] = [];\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: (node): false | void => {\n      if (nodeTypes === undefined || nodeTypes.includes(node.type.id)) {\n        positions.push(NodePosition.fromNode(node.node));\n      }\n    },\n  });\n  return positions;\n}\n\nexport function getNodeFromQuery(query: string, nodeType: number): SyntaxNode | undefined {\n  const nodes = getNodesFromQuery(query, [nodeType]);\n  return nodes.length > 0 ? nodes[0] : undefined;\n}\n\n/**\n * Parses the query and looks for error nodes. If there is at least one, it returns true.\n * Grafana variables are considered errors, so if you need to validate a query\n * with variables you should interpolate it first.\n */\nexport function isQueryWithError(query: string): boolean {\n  return isQueryWithNode(query, ErrorId);\n}\n\nexport function isLogsQuery(query: string): boolean {\n  // As a safeguard we are checking for a length of 2, because at least the query should be `{}`\n  return query.trim().length > 2 && !isQueryWithNode(query, MetricExpr);\n}\n\nexport function isQueryWithParser(query: string): { queryWithParser: boolean; parserCount: number } {\n  const nodes = getNodesFromQuery(query, [LabelParser, JsonExpressionParser, Logfmt]);\n  const parserCount = nodes.length;\n  return { queryWithParser: parserCount > 0, parserCount };\n}\n\nexport function getParserFromQuery(query: string): string | undefined {\n  const parsers = getNodesFromQuery(query, [LabelParser, Json, Logfmt]);\n  return parsers.length > 0 ? query.substring(parsers[0].from, parsers[0].to).trim() : undefined;\n}\n\nexport function isQueryPipelineErrorFiltering(query: string): boolean {\n  const labels = getNodesFromQuery(query, [LabelFilter]);\n  for (const node of labels) {\n    const label = node.getChild(Matcher)?.getChild(Identifier);\n    if (label) {\n      const labelName = query.substring(label.from, label.to);\n      if (labelName === '__error__') {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function isQueryWithLabelFormat(query: string): boolean {\n  return isQueryWithNode(query, LabelFormatExpr);\n}\n\nexport function getLogQueryFromMetricsQuery(query: string): string {\n  if (isLogsQuery(query)) {\n    return query;\n  }\n\n  // Log query in metrics query composes of Selector & PipelineExpr\n  const selectorNode = getNodeFromQuery(query, Selector);\n  if (!selectorNode) {\n    return '';\n  }\n  const selector = query.substring(selectorNode.from, selectorNode.to);\n\n  const pipelineExprNode = getNodeFromQuery(query, PipelineExpr);\n  const pipelineExpr = pipelineExprNode ? query.substring(pipelineExprNode.from, pipelineExprNode.to) : '';\n\n  return `${selector} ${pipelineExpr}`.trim();\n}\n\nexport function getLogQueryFromMetricsQueryAtPosition(query: string, position: number): string {\n  if (isLogsQuery(query)) {\n    return query;\n  }\n\n  const metricQuery = getNodesFromQuery(query, [MetricExpr])\n    .reverse() // So we don't get the root metric node\n    .find((node) => node.from <= position && node.to >= position);\n  if (!metricQuery) {\n    return '';\n  }\n  return getLogQueryFromMetricsQuery(query.substring(metricQuery.from, metricQuery.to));\n}\n\nexport function isQueryWithLabelFilter(query: string): boolean {\n  return isQueryWithNode(query, LabelFilter);\n}\n\nexport function isQueryWithLineFilter(query: string): boolean {\n  return isQueryWithNode(query, LineFilter);\n}\n\nexport function isQueryWithRangeVariable(query: string): boolean {\n  const rangeNodes = getNodesFromQuery(query, [Range]);\n  for (const node of rangeNodes) {\n    if (query.substring(node.from, node.to).match(/\\[\\$__range(_s|_ms)?/)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function getStreamSelectorsFromQuery(query: string): string[] {\n  const labelMatcherPositions = getStreamSelectorPositions(query);\n\n  const labelMatchers = labelMatcherPositions.map((labelMatcher) => {\n    return query.slice(labelMatcher.from, labelMatcher.to);\n  });\n\n  return labelMatchers;\n}\n\nexport function requestSupportsSplitting(allQueries: LokiQuery[]) {\n  const queries = allQueries\n    .filter((query) => !query.hide)\n    .filter((query) => !query.refId.includes('do-not-chunk'))\n    .filter((query) => query.expr);\n\n  return queries.length > 0;\n}\n\nexport function requestSupportsSharding(allQueries: LokiQuery[]) {\n  const queries = allQueries\n    .filter((query) => !query.hide)\n    .filter((query) => query.queryType !== LokiQueryType.Instant)\n    .filter((query) => !query.refId.includes('do-not-shard'))\n    .filter((query) => query.expr)\n    .filter(\n      (query) =>\n        (query.direction === LokiQueryDirection.Scan && isLogsQuery(query.expr)) || metricSupportsSharding(query.expr)\n    );\n\n  return queries.length > 0;\n}\n\nfunction metricSupportsSharding(query: string) {\n  if (isLogsQuery(query)) {\n    return false;\n  }\n  query = query.trim().toLowerCase();\n\n  const disallowed = getNodesFromQuery(query, [BinOpExpr]);\n  if (disallowed.length > 0) {\n    return false;\n  }\n\n  /**\n   * If there are VectorAggregationExpr, we want to make sure that the leftmost VectorOp is sum, meaning that\n   * it's wrapped in a sum. E.g.\n   * Disallowed: avg(sum by (level) (avg_over_time({place=\"luna\"}[1m])))\n   * Allowed: sum(sum by (level) (avg_over_time({place=\"luna\"}[1m])))\n   */\n  const vectorOps = getNodesFromQuery(query, [VectorOp]);\n  const supportedVectorOps = vectorOps.filter((node) => getNodeString(query, node) === 'sum');\n  const unsupportedVectorOps = vectorOps.filter((node) => getNodeString(query, node) !== 'sum');\n  const supportedWrappingVectorOpps = supportedVectorOps.filter((supportedOp) =>\n    unsupportedVectorOps.every((unsupportedOp) => supportedOp.from < unsupportedOp.from)\n  );\n  if (unsupportedVectorOps.length > 0) {\n    return supportedWrappingVectorOpps.length > 0;\n  }\n\n  const rangeOps = getNodesFromQuery(query, [RangeOp]);\n  const supportedRangeOps = ['count_over_time', 'sum_over_time', 'bytes_over_time'];\n  for (const node of rangeOps) {\n    if (!supportedRangeOps.includes(getNodeString(query, node))) {\n      return supportedWrappingVectorOpps.length > 0;\n    }\n  }\n\n  return true;\n}\n\nfunction getNodeString(query: string, node: SyntaxNode) {\n  return query.substring(node.from, node.to);\n}\n\nexport const isLokiQuery = (query: DataQuery): query is LokiQuery => {\n  if (!query) {\n    return false;\n  }\n\n  return 'expr' in query && query.expr !== undefined;\n};\n\nexport const getLokiQueryFromDataQuery = (query?: DataQuery): LokiQuery | undefined => {\n  if (!query || !isLokiQuery(query)) {\n    return undefined;\n  }\n\n  return query;\n};\n\nexport const interpolateShardingSelector = (queries: LokiQuery[], shards: number[]) => {\n  if (shards.length === 0) {\n    return queries;\n  }\n\n  let shardValue = shards.join('|');\n\n  // -1 means empty shard value\n  if (shardValue === '-1' || shards.length === 1) {\n    shardValue = shardValue === '-1' ? '' : shardValue;\n    return queries.map((query) => ({\n      ...query,\n      expr: addStreamShardLabelsToQuery(query.expr, '=', shardValue),\n    }));\n  }\n\n  return queries.map((query) => ({\n    ...query,\n    expr: addStreamShardLabelsToQuery(query.expr, '=~', shardValue),\n  }));\n};\n\nfunction addStreamShardLabelsToQuery(query: string, operator: string, shardValue: string) {\n  const shardedQuery = addLabelToQuery(query, '__stream_shard__', operator, shardValue, LabelType.Indexed);\n  if (!isLogsQuery(query)) {\n    return addDropToQuery(shardedQuery, ['__stream_shard__']);\n  }\n  return shardedQuery;\n}\n\nexport const getSelectorForShardValues = (query: string) => {\n  const selector = getNodesFromQuery(query, [Selector]);\n  if (selector.length > 0) {\n    return query.substring(selector[0].from, selector[0].to);\n  }\n  return '';\n};\n","import {\n  QueryBuilderOperation,\n  QueryBuilderOperationDefinition,\n  QueryBuilderOperationParamDef,\n} from '@grafana/plugin-ui';\n\nimport { defaultAddOperationHandler } from './operationUtils';\nimport { LokiOperationId, LokiVisualQueryOperationCategory } from './types';\n\nexport const binaryScalarDefs = [\n  {\n    id: LokiOperationId.Addition,\n    name: 'Add scalar',\n    sign: '+',\n  },\n  {\n    id: LokiOperationId.Subtraction,\n    name: 'Subtract scalar',\n    sign: '-',\n  },\n  {\n    id: LokiOperationId.MultiplyBy,\n    name: 'Multiply by scalar',\n    sign: '*',\n  },\n  {\n    id: LokiOperationId.DivideBy,\n    name: 'Divide by scalar',\n    sign: '/',\n  },\n  {\n    id: LokiOperationId.Modulo,\n    name: 'Modulo by scalar',\n    sign: '%',\n  },\n  {\n    id: LokiOperationId.Exponent,\n    name: 'Exponent',\n    sign: '^',\n  },\n  {\n    id: LokiOperationId.EqualTo,\n    name: 'Equal to',\n    sign: '==',\n    comparison: true,\n  },\n  {\n    id: LokiOperationId.NotEqualTo,\n    name: 'Not equal to',\n    sign: '!=',\n    comparison: true,\n  },\n  {\n    id: LokiOperationId.GreaterThan,\n    name: 'Greater than',\n    sign: '>',\n    comparison: true,\n  },\n  {\n    id: LokiOperationId.LessThan,\n    name: 'Less than',\n    sign: '<',\n    comparison: true,\n  },\n  {\n    id: LokiOperationId.GreaterOrEqual,\n    name: 'Greater or equal to',\n    sign: '>=',\n    comparison: true,\n  },\n  {\n    id: LokiOperationId.LessOrEqual,\n    name: 'Less or equal to',\n    sign: '<=',\n    comparison: true,\n  },\n];\n\n// Not sure about this one. It could also be a more generic 'Simple math operation' where user specifies\n// both the operator and the operand in a single input\nexport const binaryScalarOperations: QueryBuilderOperationDefinition[] = binaryScalarDefs.map((opDef) => {\n  const params: QueryBuilderOperationParamDef[] = [{ name: 'Value', type: 'number' }];\n  let defaultParams: [number] | [number, boolean] = [2];\n  if (opDef.comparison) {\n    params.push({\n      name: 'Bool',\n      type: 'boolean',\n      description: 'If checked comparison will return 0 or 1 for the value rather than filtering.',\n    });\n    defaultParams = [2, false];\n  }\n\n  return {\n    id: opDef.id,\n    name: opDef.name,\n    params,\n    defaultParams,\n    toggleable: true,\n    alternativesKey: 'binary scalar operations',\n    category: LokiVisualQueryOperationCategory.BinaryOps,\n    renderer: getSimpleBinaryRenderer(opDef.sign),\n    addOperationHandler: defaultAddOperationHandler,\n  };\n});\n\nfunction getSimpleBinaryRenderer(operator: string) {\n  return function binaryRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    let param = model.params[0];\n    let bool = '';\n    if (model.params.length === 2) {\n      bool = model.params[1] ? ' bool' : '';\n    }\n\n    return `${innerExpr} ${operator}${bool} ${param}`;\n  };\n}\n","import { useState } from 'react';\n\nimport { DataSourceApi, SelectableValue } from '@grafana/data';\nimport {\n  QueryBuilderLabelFilter,\n  QueryBuilderOperationParamEditorProps,\n  QueryBuilderOperationParamValue,\n  VisualQuery,\n  VisualQueryModeller,\n} from '@grafana/plugin-ui';\nimport { Select } from '@grafana/ui';\n\nimport { getOperationParamId } from '../operationUtils';\n\nexport const LabelParamEditor = ({\n  onChange,\n  index,\n  operationId,\n  value,\n  query,\n  datasource,\n  queryModeller,\n}: QueryBuilderOperationParamEditorProps) => {\n  const [state, setState] = useState<{\n    options?: SelectableValue[];\n    isLoading?: boolean;\n  }>({});\n\n  return (\n    <Select<QueryBuilderOperationParamValue | undefined>\n      inputId={getOperationParamId(operationId, index)}\n      autoFocus={value === ''}\n      openMenuOnFocus\n      onOpenMenu={async () => {\n        setState({ isLoading: true });\n        const options = await loadGroupByLabels(query, datasource, queryModeller);\n        setState({ options, isLoading: undefined });\n      }}\n      isLoading={state.isLoading}\n      allowCustomValue\n      noOptionsMessage=\"No labels found\"\n      loadingMessage=\"Loading labels\"\n      options={state.options}\n      value={toOption(value)}\n      onChange={(value) => onChange(index, value.value!)}\n    />\n  );\n};\n\nasync function loadGroupByLabels(\n  query: VisualQuery,\n  datasource: DataSourceApi,\n  queryModeller: VisualQueryModeller\n): Promise<SelectableValue[]> {\n  let labels: QueryBuilderLabelFilter[] = query.labels;\n\n  const queryString = queryModeller.renderLabels(labels);\n  const result: string[] = await datasource.languageProvider.fetchLabels({ streamSelector: queryString });\n\n  return result.map((x) => ({\n    label: x,\n    value: x,\n  }));\n}\n\nconst toOption = (\n  value: QueryBuilderOperationParamValue | undefined\n): SelectableValue<QueryBuilderOperationParamValue | undefined> => ({ label: value?.toString(), value });\n","import { capitalize } from 'lodash';\nimport pluralize from 'pluralize';\n\nimport {\n  QueryBuilderOperation,\n  QueryBuilderOperationDefinition,\n  QueryBuilderOperationParamDef,\n  QueryBuilderOperationParamValue,\n  VisualQuery,\n  VisualQueryModeller,\n} from '@grafana/plugin-ui';\n\nimport { escapeLabelValueInExactSelector } from '../languageUtils';\nimport { FUNCTIONS } from '../syntax';\n\nimport { LabelParamEditor } from './components/LabelParamEditor';\nimport { LokiOperationId, LokiOperationOrder, LokiVisualQuery, LokiVisualQueryOperationCategory } from './types';\n\nexport function createRangeOperation(\n  name: string,\n  isRangeOperationWithGrouping?: boolean\n): QueryBuilderOperationDefinition {\n  const params = [getRangeVectorParamDef()];\n  const defaultParams = ['$__auto'];\n  let paramChangedHandler = undefined;\n\n  if (name === LokiOperationId.QuantileOverTime) {\n    defaultParams.push('0.95');\n    params.push({\n      name: 'Quantile',\n      type: 'number',\n    });\n  }\n\n  if (isRangeOperationWithGrouping) {\n    params.push({\n      name: 'By label',\n      type: 'string',\n      restParam: true,\n      optional: true,\n    });\n\n    paramChangedHandler = getOnLabelAddedHandler(`__${name}_by`);\n  }\n\n  return {\n    id: name,\n    name: getLokiOperationDisplayName(name),\n    params: params,\n    defaultParams,\n    toggleable: true,\n    alternativesKey: 'range function',\n    category: LokiVisualQueryOperationCategory.RangeFunctions,\n    orderRank: LokiOperationOrder.RangeVectorFunction,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addLokiOperation,\n    paramChangedHandler,\n    explainHandler: (op, def) => {\n      let opDocs = FUNCTIONS.find((x) => x.insertText === op.id)?.documentation ?? '';\n\n      if (op.params[0] === '$__auto') {\n        return `${opDocs} \\`$__auto\\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`;\n      } else {\n        return `${opDocs} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \\`${op.params[0]}\\`.`;\n      }\n    },\n  };\n}\n\nexport function createRangeOperationWithGrouping(name: string): QueryBuilderOperationDefinition[] {\n  const rangeOperation = createRangeOperation(name, true);\n  // Copy range operation params without the last param\n  const params = rangeOperation.params.slice(0, -1);\n  const operations: QueryBuilderOperationDefinition[] = [\n    rangeOperation,\n    {\n      id: `__${name}_by`,\n      name: `${getLokiOperationDisplayName(name)} by`,\n      params: [\n        ...params,\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: LabelParamEditor,\n        },\n      ],\n      defaultParams: [...rangeOperation.defaultParams, ''],\n      toggleable: true,\n      alternativesKey: 'range function with grouping',\n      category: LokiVisualQueryOperationCategory.RangeFunctions,\n      renderer: getRangeAggregationWithGroupingRenderer(name, 'by'),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'by'),\n      addOperationHandler: addLokiOperation,\n      hideFromList: true,\n    },\n    {\n      id: `__${name}_without`,\n      name: `${getLokiOperationDisplayName(name)} without`,\n      params: [\n        ...params,\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: LabelParamEditor,\n        },\n      ],\n      defaultParams: [...rangeOperation.defaultParams, ''],\n      alternativesKey: 'range function with grouping',\n      category: LokiVisualQueryOperationCategory.RangeFunctions,\n      renderer: getRangeAggregationWithGroupingRenderer(name, 'without'),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'without'),\n      addOperationHandler: addLokiOperation,\n      hideFromList: true,\n    },\n  ];\n\n  return operations;\n}\n\nexport function getRangeAggregationWithGroupingRenderer(aggregation: string, grouping: 'by' | 'without') {\n  return function aggregationRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    const restParamIndex = def.params.findIndex((param) => param.restParam);\n    const params = model.params.slice(0, restParamIndex);\n    const restParams = model.params.slice(restParamIndex);\n\n    if (params.length === 2 && aggregation === LokiOperationId.QuantileOverTime) {\n      return `${aggregation}(${params[1]}, ${innerExpr} [${params[0]}]) ${grouping} (${restParams.join(', ')})`;\n    }\n\n    return `${aggregation}(${innerExpr} [${params[0]}]) ${grouping} (${restParams.join(', ')})`;\n  };\n}\n\nfunction operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDefinition,\n  innerExpr: string\n) {\n  const params = model.params ?? [];\n  const rangeVector = params[0] ?? '$__auto';\n  // QuantileOverTime is only range vector with more than one param\n  if (params.length === 2 && model.id === LokiOperationId.QuantileOverTime) {\n    const quantile = params[1];\n    return `${model.id}(${quantile}, ${innerExpr} [${rangeVector}])`;\n  }\n\n  return `${model.id}(${innerExpr} [${params[0] ?? '$__auto'}])`;\n}\n\nexport function labelFilterRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDefinition,\n  innerExpr: string\n) {\n  const integerOperators = ['<', '<=', '>', '>='];\n\n  if (integerOperators.includes(String(model.params[1]))) {\n    return `${innerExpr} | ${model.params[0]} ${model.params[1]} ${model.params[2]}`;\n  }\n\n  return `${innerExpr} | ${model.params[0]} ${model.params[1]} \\`${model.params[2]}\\``;\n}\n\nexport function isConflictingFilter(\n  operation: QueryBuilderOperation,\n  queryOperations: QueryBuilderOperation[]\n): boolean {\n  if (!operation) {\n    return false;\n  }\n  const operationIsNegative = operation.params[1].toString().startsWith('!');\n\n  const candidates = queryOperations.filter(\n    (queryOperation) =>\n      queryOperation.id === LokiOperationId.LabelFilter &&\n      queryOperation.params[0] === operation.params[0] &&\n      queryOperation.params[2] === operation.params[2]\n  );\n\n  const conflict = candidates.some((candidate) => {\n    if (operationIsNegative && candidate.params[1].toString().startsWith('!') === false) {\n      return true;\n    }\n    if (operationIsNegative === false && candidate.params[1].toString().startsWith('!')) {\n      return true;\n    }\n    return false;\n  });\n\n  return conflict;\n}\n\nexport function pipelineRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDefinition,\n  innerExpr: string\n) {\n  switch (model.id) {\n    case LokiOperationId.Logfmt:\n      const [strict = false, keepEmpty = false, ...labels] = model.params;\n      return `${innerExpr} | logfmt${strict ? ' --strict' : ''}${keepEmpty ? ' --keep-empty' : ''} ${labels\n        .filter((label) => label)\n        .join(', ')}`.trim();\n    case LokiOperationId.Json:\n      return `${innerExpr} | json ${model.params.filter((param) => param).join(', ')}`.trim();\n    case LokiOperationId.Drop:\n      return `${innerExpr} | drop ${model.params.filter((param) => param).join(', ')}`.trim();\n    case LokiOperationId.Keep:\n      return `${innerExpr} | keep ${model.params.filter((param) => param).join(', ')}`.trim();\n    default:\n      return `${innerExpr} | ${model.id}`;\n  }\n}\n\nfunction isRangeVectorFunction(def: QueryBuilderOperationDefinition) {\n  return def.category === LokiVisualQueryOperationCategory.RangeFunctions;\n}\n\nfunction getIndexOfOrLast(\n  operations: QueryBuilderOperation[],\n  queryModeller: VisualQueryModeller,\n  condition: (def: QueryBuilderOperationDefinition) => boolean\n) {\n  const index = operations.findIndex((x) => {\n    const opDef = queryModeller.getOperationDefinition(x.id);\n    if (!opDef) {\n      return false;\n    }\n    return condition(opDef);\n  });\n\n  return index === -1 ? operations.length : index;\n}\n\nexport function addLokiOperation(\n  def: QueryBuilderOperationDefinition,\n  query: LokiVisualQuery,\n  modeller: VisualQueryModeller\n): LokiVisualQuery {\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  const operations = [...query.operations];\n\n  const existingRangeVectorFunction = operations.find((x) => {\n    const opDef = modeller.getOperationDefinition(x.id);\n    if (!opDef) {\n      return false;\n    }\n    return isRangeVectorFunction(opDef);\n  });\n\n  switch (def.category) {\n    case LokiVisualQueryOperationCategory.Aggregations:\n    case LokiVisualQueryOperationCategory.Functions:\n      // If we are adding a function but we have not range vector function yet add one\n      if (!existingRangeVectorFunction) {\n        const placeToInsert = getIndexOfOrLast(\n          operations,\n          modeller,\n          (def) => def.category === LokiVisualQueryOperationCategory.Functions\n        );\n        operations.splice(placeToInsert, 0, { id: LokiOperationId.Rate, params: ['$__auto'] });\n      }\n      operations.push(newOperation);\n      break;\n    case LokiVisualQueryOperationCategory.RangeFunctions:\n      // If adding a range function and range function is already added replace it\n      if (existingRangeVectorFunction) {\n        const index = operations.indexOf(existingRangeVectorFunction);\n        operations[index] = newOperation;\n        break;\n      }\n\n    // Add range functions after any formats, line filters and label filters\n    default:\n      const placeToInsert = getIndexOfOrLast(\n        operations,\n        modeller,\n        (x) => (def.orderRank ?? 100) < (x.orderRank ?? 100)\n      );\n      operations.splice(placeToInsert, 0, newOperation);\n      break;\n  }\n\n  return {\n    ...query,\n    operations,\n  };\n}\n\nexport function addNestedQueryHandler(def: QueryBuilderOperationDefinition, query: LokiVisualQuery): LokiVisualQuery {\n  return {\n    ...query,\n    binaryQueries: [\n      ...(query.binaryQueries ?? []),\n      {\n        operator: '/',\n        query,\n      },\n    ],\n  };\n}\n\nexport function getLineFilterRenderer(operation: string, caseInsensitive?: boolean) {\n  return function lineFilterRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    const hasBackticks = model.params.some((param) => typeof param === 'string' && param.includes('`'));\n    const delimiter = hasBackticks ? '\"' : '`';\n    let params;\n    if (hasBackticks) {\n      params = model.params.map((param) =>\n        typeof param === 'string' ? escapeLabelValueInExactSelector(param) : param\n      );\n    } else {\n      params = model.params;\n    }\n    if (caseInsensitive) {\n      return `${innerExpr} ${operation} ${delimiter}(?i)${params.join(`${delimiter} or ${delimiter}(?i)`)}${delimiter}`;\n    }\n    return `${innerExpr} ${operation} ${delimiter}${params.join(`${delimiter} or ${delimiter}`)}${delimiter}`;\n  };\n}\n\nfunction getRangeVectorParamDef(): QueryBuilderOperationParamDef {\n  return {\n    name: 'Range',\n    type: 'string',\n    options: ['$__auto'],\n    description:\n      'Use the default value \"$__auto\". Change the \"step\" value in the query options to change the bucket size.',\n  };\n}\n\nexport function getOperationParamId(operationId: string, paramIndex: number) {\n  return `operations.${operationId}.param.${paramIndex}`;\n}\n\nexport function getOnLabelAddedHandler(changeToOperationId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation, def: QueryBuilderOperationDefinition) {\n    // Check if we actually have the label param. As it's optional the aggregation can have one less, which is the\n    // case of just simple aggregation without label. When user adds the label it now has the same number of params\n    // as its definition, and now we can change it to its `_by` variant.\n    if (op.params.length === def.params.length) {\n      return {\n        ...op,\n        id: changeToOperationId,\n      };\n    }\n    return op;\n  };\n}\n\n/**\n * Very simple poc implementation, needs to be modified to support all aggregation operators\n */\nexport function getAggregationExplainer(aggregationName: string, mode: 'by' | 'without' | '') {\n  return function aggregationExplainer(model: QueryBuilderOperation) {\n    const labels = model.params.map((label) => `\\`${label}\\``).join(' and ');\n    const labelWord = pluralize('label', model.params.length);\n\n    switch (mode) {\n      case 'by':\n        return `Calculates ${aggregationName} over dimensions while preserving ${labelWord} ${labels}.`;\n      case 'without':\n        return `Calculates ${aggregationName} over the dimensions ${labels}. All other labels are preserved.`;\n      default:\n        return `Calculates ${aggregationName} over the dimensions.`;\n    }\n  };\n}\n\n/**\n * This function will transform operations without labels to their plan aggregation operation\n */\nexport function getLastLabelRemovedHandler(changeToOperationId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation, def: QueryBuilderOperationDefinition) {\n    // If definition has more params then is defined there are no optional rest params anymore.\n    // We then transform this operation into a different one\n    if (op.params.length < def.params.length) {\n      return {\n        ...op,\n        id: changeToOperationId,\n      };\n    }\n\n    return op;\n  };\n}\n\nexport function getLokiOperationDisplayName(funcName: string) {\n  return capitalize(funcName.replace(/_/g, ' '));\n}\n\nexport function defaultAddOperationHandler<T extends VisualQuery>(def: QueryBuilderOperationDefinition, query: T) {\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  return {\n    ...query,\n    operations: [...query.operations, newOperation],\n  };\n}\n\nexport function createAggregationOperation(\n  name: string,\n  overrides: Partial<QueryBuilderOperationDefinition> = {}\n): QueryBuilderOperationDefinition[] {\n  const operations: QueryBuilderOperationDefinition[] = [\n    {\n      id: name,\n      name: getLokiOperationDisplayName(name),\n      params: [\n        {\n          name: 'By label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n        },\n      ],\n      defaultParams: [],\n      toggleable: true,\n      alternativesKey: 'plain aggregations',\n      category: LokiVisualQueryOperationCategory.Aggregations,\n      renderer: functionRendererLeft,\n      paramChangedHandler: getOnLabelAddedHandler(`__${name}_by`),\n      explainHandler: getAggregationExplainer(name, ''),\n      addOperationHandler: defaultAddOperationHandler,\n      ...overrides,\n    },\n    {\n      id: `__${name}_by`,\n      name: `${getLokiOperationDisplayName(name)} by`,\n      params: [\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: LabelParamEditor,\n        },\n      ],\n      defaultParams: [''],\n      alternativesKey: 'aggregations by',\n      category: LokiVisualQueryOperationCategory.Aggregations,\n      renderer: getAggregationByRenderer(name),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'by'),\n      addOperationHandler: defaultAddOperationHandler,\n      hideFromList: true,\n      ...overrides,\n    },\n    {\n      id: `__${name}_without`,\n      name: `${getLokiOperationDisplayName(name)} without`,\n      params: [\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: LabelParamEditor,\n        },\n      ],\n      defaultParams: [''],\n      alternativesKey: 'aggregations by',\n      category: LokiVisualQueryOperationCategory.Aggregations,\n      renderer: getAggregationWithoutRenderer(name),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'without'),\n      addOperationHandler: defaultAddOperationHandler,\n      hideFromList: true,\n      ...overrides,\n    },\n  ];\n\n  return operations;\n}\n\nfunction getAggregationWithoutRenderer(aggregation: string) {\n  return function aggregationRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    return `${aggregation} without(${model.params.join(', ')}) (${innerExpr})`;\n  };\n}\n\nexport function functionRendererLeft(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDefinition,\n  innerExpr: string\n) {\n  const params = renderParams(model, def, innerExpr);\n  const str = model.id + '(';\n\n  if (innerExpr) {\n    params.push(innerExpr);\n  }\n\n  return str + params.join(', ') + ')';\n}\n\nfunction renderParams(model: QueryBuilderOperation, def: QueryBuilderOperationDefinition, innerExpr: string) {\n  return (model.params ?? []).map((value, index) => {\n    const paramDef = def.params[index];\n    if (paramDef.type === 'string') {\n      return '\"' + value + '\"';\n    }\n\n    return value;\n  });\n}\n\nfunction getAggregationByRenderer(aggregation: string) {\n  return function aggregationRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    return `${aggregation} by(${model.params.join(', ')}) (${innerExpr})`;\n  };\n}\n\nexport function createAggregationOperationWithParam(\n  name: string,\n  paramsDef: { params: QueryBuilderOperationParamDef[]; defaultParams: QueryBuilderOperationParamValue[] },\n  overrides: Partial<QueryBuilderOperationDefinition> = {}\n): QueryBuilderOperationDefinition[] {\n  const operations = createAggregationOperation(name, overrides);\n  operations[0].params.unshift(...paramsDef.params);\n  operations[1].params.unshift(...paramsDef.params);\n  operations[2].params.unshift(...paramsDef.params);\n  operations[0].defaultParams = paramsDef.defaultParams;\n  operations[1].defaultParams = [...paramsDef.defaultParams, ''];\n  operations[2].defaultParams = [...paramsDef.defaultParams, ''];\n  operations[1].renderer = getAggregationByRendererWithParameter(name);\n  operations[2].renderer = getAggregationByRendererWithParameter(name);\n  return operations;\n}\n\nfunction getAggregationByRendererWithParameter(aggregation: string) {\n  return function aggregationRenderer(\n    model: QueryBuilderOperation,\n    def: QueryBuilderOperationDefinition,\n    innerExpr: string\n  ) {\n    const restParamIndex = def.params.findIndex((param) => param.restParam);\n    const params = model.params.slice(0, restParamIndex);\n    const restParams = model.params.slice(restParamIndex);\n\n    return `${aggregation} by(${restParams.join(', ')}) (${params\n      .map((param, idx) => (def.params[idx].type === 'string' ? `\\\"${param}\\\"` : param))\n      .join(', ')}, ${innerExpr})`;\n  };\n}\n","import { useState } from 'react';\n\nimport { SelectableValue, getDefaultTimeRange, toOption } from '@grafana/data';\nimport { QueryBuilderOperationParamEditorProps, VisualQueryModeller } from '@grafana/plugin-ui';\nimport { Select } from '@grafana/ui';\n\nimport { placeHolderScopedVars } from '../../components/monaco-query-field/monaco-completion-provider/validation';\nimport { LokiDatasource } from '../../datasource';\nimport { getLogQueryFromMetricsQuery, isQueryWithError } from '../../queryUtils';\nimport { extractUnwrapLabelKeysFromDataFrame } from '../../responseUtils';\nimport { getOperationParamId } from '../operationUtils';\nimport { LokiVisualQuery } from '../types';\n\nexport function UnwrapParamEditor({\n  onChange,\n  index,\n  operationId,\n  value,\n  query,\n  datasource,\n  timeRange,\n  queryModeller,\n}: QueryBuilderOperationParamEditorProps) {\n  const [state, setState] = useState<{\n    options?: Array<SelectableValue<string>>;\n    isLoading?: boolean;\n  }>({});\n\n  return (\n    <Select\n      inputId={getOperationParamId(operationId, index)}\n      onOpenMenu={async () => {\n        // This check is always true, we do it to make typescript happy\n        if (datasource instanceof LokiDatasource) {\n          setState({ isLoading: true });\n          const options = await loadUnwrapOptions(query, datasource, queryModeller, timeRange);\n          setState({ options, isLoading: undefined });\n        }\n      }}\n      isLoading={state.isLoading}\n      allowCustomValue\n      noOptionsMessage=\"No labels found\"\n      loadingMessage=\"Loading labels\"\n      options={state.options}\n      value={value ? toOption(value.toString()) : null}\n      onChange={(value) => {\n        if (value.value) {\n          onChange(index, value.value);\n        }\n      }}\n    />\n  );\n}\n\nasync function loadUnwrapOptions(\n  query: LokiVisualQuery,\n  datasource: LokiDatasource,\n  queryModeller: VisualQueryModeller,\n  timeRange = getDefaultTimeRange()\n): Promise<Array<SelectableValue<string>>> {\n  const queryExpr = queryModeller.renderQuery(query);\n  const logExpr = getLogQueryFromMetricsQuery(queryExpr);\n  if (isQueryWithError(datasource.interpolateString(logExpr, placeHolderScopedVars))) {\n    return [];\n  }\n\n  const samples = await datasource.getDataSamples({ expr: logExpr, refId: 'unwrap_samples' }, timeRange);\n  const unwrapLabels = extractUnwrapLabelKeysFromDataFrame(samples[0]);\n\n  const labelOptions = unwrapLabels.map((label) => ({\n    label,\n    value: label,\n  }));\n\n  return labelOptions;\n}\n","import { QueryBuilderOperationDefinition, QueryBuilderOperationParamValue } from '@grafana/plugin-ui';\n\nimport { binaryScalarOperations } from './binaryScalarOperations';\nimport { UnwrapParamEditor } from './components/UnwrapParamEditor';\nimport {\n  addLokiOperation,\n  addNestedQueryHandler,\n  createAggregationOperation,\n  createAggregationOperationWithParam,\n  createRangeOperation,\n  createRangeOperationWithGrouping,\n  getLineFilterRenderer,\n  labelFilterRenderer,\n  pipelineRenderer,\n} from './operationUtils';\nimport { LokiOperationId, LokiOperationOrder, lokiOperators, LokiVisualQueryOperationCategory } from './types';\n\nfunction getOperationDefinitions(): QueryBuilderOperationDefinition[] {\n  const aggregations = [\n    LokiOperationId.Sum,\n    LokiOperationId.Min,\n    LokiOperationId.Max,\n    LokiOperationId.Avg,\n    LokiOperationId.Stddev,\n    LokiOperationId.Stdvar,\n    LokiOperationId.Count,\n  ].flatMap((opId) =>\n    createAggregationOperation(opId, {\n      addOperationHandler: addLokiOperation,\n      orderRank: LokiOperationOrder.Last,\n    })\n  );\n\n  const aggregationsWithParam = [LokiOperationId.TopK, LokiOperationId.BottomK].flatMap((opId) => {\n    return createAggregationOperationWithParam(\n      opId,\n      {\n        params: [{ name: 'K-value', type: 'number' }],\n        defaultParams: [5],\n      },\n      {\n        addOperationHandler: addLokiOperation,\n        orderRank: LokiOperationOrder.Last,\n      }\n    );\n  });\n\n  const rangeOperations = [\n    createRangeOperation(LokiOperationId.Rate),\n    createRangeOperation(LokiOperationId.RateCounter),\n    createRangeOperation(LokiOperationId.CountOverTime),\n    createRangeOperation(LokiOperationId.SumOverTime),\n    createRangeOperation(LokiOperationId.BytesRate),\n    createRangeOperation(LokiOperationId.BytesOverTime),\n    createRangeOperation(LokiOperationId.AbsentOverTime),\n  ];\n\n  const rangeOperationsWithGrouping = [\n    ...createRangeOperationWithGrouping(LokiOperationId.AvgOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.MaxOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.MinOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.FirstOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.LastOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.StdvarOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.StddevOverTime),\n    ...createRangeOperationWithGrouping(LokiOperationId.QuantileOverTime),\n  ];\n\n  const list: QueryBuilderOperationDefinition[] = [\n    ...aggregations,\n    ...aggregationsWithParam,\n    ...rangeOperations,\n    ...rangeOperationsWithGrouping,\n    {\n      id: LokiOperationId.Json,\n      name: 'Json',\n      params: [\n        {\n          name: 'Expression',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          minWidth: 18,\n          placeholder: 'server=\"servers[0]\"',\n          description:\n            'Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted.',\n        },\n      ],\n      defaultParams: [],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Parsers,\n      renderer: pipelineRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.`,\n    },\n    {\n      id: LokiOperationId.Logfmt,\n      name: 'Logfmt',\n      params: [\n        {\n          name: 'Strict',\n          type: 'boolean',\n          optional: true,\n          description:\n            'With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair.',\n        },\n        {\n          name: 'Keep empty',\n          type: 'boolean',\n          optional: true,\n          description:\n            'The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. ',\n        },\n        {\n          name: 'Expression',\n          type: 'string',\n          optional: true,\n          restParam: true,\n          minWidth: 18,\n          placeholder: 'field_name',\n          description:\n            'Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way.',\n        },\n      ],\n      defaultParams: [false, false],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Parsers,\n      renderer: pipelineRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.`,\n    },\n    {\n      id: LokiOperationId.Regexp,\n      name: 'Regexp',\n      params: [\n        {\n          name: 'String',\n          type: 'string',\n          hideName: true,\n          placeholder: '<re>',\n          description: 'The regexp expression that matches the structure of a log line.',\n          minWidth: 20,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Parsers,\n      renderer: (model, def, innerExpr) => `${innerExpr} | regexp \\`${model.params[0]}\\``,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp \"<re>\" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.`,\n    },\n    {\n      id: LokiOperationId.Pattern,\n      name: 'Pattern',\n      params: [\n        {\n          name: 'String',\n          type: 'string',\n          hideName: true,\n          placeholder: '<pattern-expression>',\n          description: 'The expression that matches the structure of a log line.',\n          minWidth: 20,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Parsers,\n      renderer: (model, def, innerExpr) => `${innerExpr} | pattern \\`${model.params[0]}\\``,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern \\`<pattern-expression>\\`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.`,\n    },\n    {\n      id: LokiOperationId.Unpack,\n      name: 'Unpack',\n      params: [],\n      defaultParams: [],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Parsers,\n      renderer: pipelineRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.`,\n    },\n    {\n      id: LokiOperationId.LineFormat,\n      name: 'Line format',\n      params: [\n        {\n          name: 'String',\n          type: 'string',\n          hideName: true,\n          placeholder: '{{.status_code}}',\n          description: 'A line template that can refer to stream labels and extracted labels.',\n          minWidth: 20,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: (model, def, innerExpr) => `${innerExpr} | line_format \\`${model.params[0]}\\``,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `This will replace log line using a specified template. The template can refer to stream labels and extracted labels.\n\nExample: \\`{{.status_code}} - {{.message}}\\`\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.\n        `,\n    },\n    {\n      id: LokiOperationId.LabelFormat,\n      name: 'Label format',\n      params: [\n        { name: 'Label', type: 'string' },\n        { name: 'Rename to', type: 'string' },\n      ],\n      defaultParams: ['', ''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: (model, def, innerExpr) => `${innerExpr} | label_format ${model.params[1]}=${model.params[0]}`,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        `This will change name of label to desired new label. In the example below, label \"error_level\" will be renamed to \"level\".\n\nExample: \\`\\`error_level=\\`level\\` \\`\\`\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        `,\n    },\n\n    {\n      id: LokiOperationId.LineContains,\n      name: 'Line contains',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Text to find',\n          description: 'Find log lines that contains this text',\n          minWidth: 20,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('|='),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines that contain string \\`${op.params?.join('`, or `')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineContainsNot,\n      name: 'Line does not contain',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Text to exclude',\n          description: 'Find log lines that does not contain this text',\n          minWidth: 26,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('!='),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines that does not contain string \\`${op.params?.join('`, or `')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineContainsCaseInsensitive,\n      name: 'Line contains case insensitive',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Text to find',\n          description: 'Find log lines that contains this text',\n          minWidth: 33,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('|~', true),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines that match regex \\`(?i)${op.params?.join('`, or `(?i)')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineContainsNotCaseInsensitive,\n      name: 'Line does not contain case insensitive',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Text to exclude',\n          description: 'Find log lines that does not contain this text',\n          minWidth: 40,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('!~', true),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines that does not match regex \\`(?i)${op.params?.join('`, or `(?i)')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineMatchesRegex,\n      name: 'Line contains regex match',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Pattern to match',\n          description: 'Find log lines that match this regex pattern',\n          minWidth: 30,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('|~'),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines that match a \\`RE2\\` regex pattern. \\`${op.params?.join('`, or `')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineMatchesRegexNot,\n      name: 'Line does not match regex',\n      params: [\n        {\n          name: '',\n          type: 'string',\n          hideName: true,\n          restParam: true,\n          placeholder: 'Pattern to exclude',\n          description: 'Find log lines that does not match this regex pattern',\n          minWidth: 30,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: getLineFilterRenderer('!~'),\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) =>\n        `Return log lines that doesn't match a \\`RE2\\` regex pattern. \\`${op.params?.join('`, or `')}\\`.`,\n    },\n    {\n      id: LokiOperationId.LineFilterIpMatches,\n      name: 'IP line filter expression',\n      params: [\n        {\n          name: 'Operator',\n          type: 'string',\n          minWidth: 16,\n          options: [lokiOperators.contains, lokiOperators.doesNotContain],\n        },\n        {\n          name: 'Pattern',\n          type: 'string',\n          placeholder: '<pattern>',\n          minWidth: 16,\n          runQueryOnEnter: true,\n        },\n      ],\n      defaultParams: ['|=', ''],\n      toggleable: true,\n      alternativesKey: 'line filter',\n      category: LokiVisualQueryOperationCategory.LineFilters,\n      orderRank: LokiOperationOrder.LineFilters,\n      renderer: (op, def, innerExpr) => `${innerExpr} ${op.params[0]} ip(\\`${op.params[1]}\\`)`,\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines using IP matching of \\`${op.params[1]}\\``,\n    },\n    {\n      id: LokiOperationId.LabelFilter,\n      name: 'Label filter expression',\n      params: [\n        { name: 'Label', type: 'string', minWidth: 14 },\n        {\n          name: 'Operator',\n          type: 'string',\n          minWidth: 14,\n          options: [\n            lokiOperators.equals,\n            lokiOperators.doesNotEqual,\n            lokiOperators.matchesRegex,\n            lokiOperators.doesNotMatchRegex,\n            lokiOperators.greaterThan,\n            lokiOperators.lessThan,\n            lokiOperators.greaterThanOrEqual,\n            lokiOperators.lessThanOrEqual,\n          ],\n        },\n        { name: 'Value', type: 'string', minWidth: 14 },\n      ],\n      defaultParams: ['', '=', ''],\n      toggleable: true,\n      alternativesKey: 'label filter',\n      category: LokiVisualQueryOperationCategory.LabelFilters,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: labelFilterRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () => `Label expression filter allows filtering using original and extracted labels.`,\n    },\n    {\n      id: LokiOperationId.LabelFilterIpMatches,\n      name: 'IP label filter expression',\n      params: [\n        { name: 'Label', type: 'string', minWidth: 14 },\n        {\n          name: 'Operator',\n          type: 'string',\n          minWidth: 14,\n          options: [lokiOperators.equals, lokiOperators.doesNotEqual],\n        },\n        { name: 'Value', type: 'string', minWidth: 14 },\n      ],\n      defaultParams: ['', '=', ''],\n      toggleable: true,\n      alternativesKey: 'label filter',\n      category: LokiVisualQueryOperationCategory.LabelFilters,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: (model, def, innerExpr) =>\n        `${innerExpr} | ${model.params[0]} ${model.params[1]} ip(\\`${model.params[2]}\\`)`,\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => `Return log lines using IP matching of \\`${op.params[2]}\\` for \\`${op.params[0]}\\` label`,\n    },\n    {\n      id: LokiOperationId.LabelFilterNoErrors,\n      name: 'No pipeline errors',\n      params: [],\n      defaultParams: [],\n      toggleable: true,\n      alternativesKey: 'label filter',\n      category: LokiVisualQueryOperationCategory.LabelFilters,\n      orderRank: LokiOperationOrder.NoErrors,\n      renderer: (model, def, innerExpr) => `${innerExpr} | __error__=\\`\\``,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () => `Filter out all formatting and parsing errors.`,\n    },\n    {\n      id: LokiOperationId.Unwrap,\n      name: 'Unwrap',\n      params: [\n        {\n          name: 'Identifier',\n          type: 'string',\n          hideName: true,\n          minWidth: 16,\n          placeholder: 'Label key',\n          editor: UnwrapParamEditor,\n        },\n        {\n          name: 'Conversion function',\n          hideName: true,\n          type: 'string',\n          options: ['duration', 'duration_seconds', 'bytes'],\n          optional: true,\n        },\n      ],\n      defaultParams: ['', ''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.Unwrap,\n      renderer: (op, def, innerExpr) =>\n        `${innerExpr} | unwrap ${op.params[1] ? `${op.params[1]}(${op.params[0]})` : op.params[0]}`,\n      addOperationHandler: addLokiOperation,\n      explainHandler: (op) => {\n        let label = String(op.params[0]).length > 0 ? op.params[0] : '<label>';\n        return `Use the extracted label \\`${label}\\` as sample values instead of log lines for the subsequent range aggregation.${\n          op.params[1]\n            ? ` Conversion function \\`${op.params[1]}\\` wrapping \\`${label}\\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`\n            : ''\n        }`;\n      },\n    },\n    {\n      id: LokiOperationId.Decolorize,\n      name: 'Decolorize',\n      params: [],\n      defaultParams: [],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: (op, def, innerExpr) => `${innerExpr} | decolorize`,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () => `This will remove ANSI color codes from log lines.`,\n    },\n    {\n      id: LokiOperationId.Drop,\n      name: 'Drop',\n      params: [\n        // As drop can support both labels (e.g. job) and expressions (e.g. job=\"grafana\"), we\n        // use input and not LabelParamEditor.\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          minWidth: 18,\n          placeholder: 'job=\"grafana\"',\n          description: 'Specify labels or expressions to drop.',\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: pipelineRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () => 'The drop expression will drop the given labels in the pipeline.',\n    },\n    {\n      id: LokiOperationId.Keep,\n      name: 'Keep',\n      params: [\n        // As keep can support both labels (e.g. job) and expressions (e.g. job=\"grafana\"), we\n        // use input and not LabelParamEditor.\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          minWidth: 18,\n          placeholder: 'job=\"grafana\"',\n          description: 'Specify labels or expressions to keep.',\n        },\n      ],\n      defaultParams: [''],\n      toggleable: true,\n      alternativesKey: 'format',\n      category: LokiVisualQueryOperationCategory.Formats,\n      orderRank: LokiOperationOrder.PipeOperations,\n      renderer: pipelineRenderer,\n      addOperationHandler: addLokiOperation,\n      explainHandler: () =>\n        'The keep expression will keep only the specified labels in the pipeline and drop all the other labels.',\n    },\n    ...binaryScalarOperations,\n    {\n      id: LokiOperationId.NestedQuery,\n      name: 'Binary operation with query',\n      params: [],\n      defaultParams: [],\n      toggleable: true,\n      category: LokiVisualQueryOperationCategory.BinaryOps,\n      renderer: (model, def, innerExpr) => innerExpr,\n      addOperationHandler: addNestedQueryHandler,\n    },\n  ];\n\n  return list;\n}\n\n// Keeping a local copy as an optimization measure.\nexport const operationDefinitions = getOperationDefinitions();\n\n/**\n * Given an operator, return the corresponding explain.\n * For usage within the Query Editor.\n */\nexport function explainOperator(id: LokiOperationId | string): string {\n  const definition = operationDefinitions.find((operation) => operation.id === id);\n\n  const explain = definition?.explainHandler?.({ id: '', params: ['<value>'] }) || '';\n\n  // Strip markdown links\n  return explain.replace(/\\[(.*)\\]\\(.*\\)/g, '$1');\n}\n\nexport function getDefinitionById(id: string): QueryBuilderOperationDefinition | undefined {\n  return operationDefinitions.find((x) => x.id === id);\n}\n\nexport function checkParamsAreValid(\n  def: QueryBuilderOperationDefinition,\n  params: QueryBuilderOperationParamValue[]\n): boolean {\n  // For now we only check if the operation has all the required params.\n  if (params.length < def.params.filter((param) => !param.optional).length) {\n    return false;\n  }\n\n  return true;\n}\n","import { SyntaxNode } from '@lezer/common';\n\nimport {\n  And,\n  BinOpExpr,\n  Bool,\n  By,\n  ConvOp,\n  Decolorize,\n  DropLabel,\n  DropLabels,\n  DropLabelsExpr,\n  Filter,\n  FilterOp,\n  Grouping,\n  GroupingLabelList,\n  GroupingLabels,\n  Identifier,\n  Ip,\n  IpLabelFilter,\n  Json,\n  JsonExpressionParser,\n  KeepLabel,\n  KeepLabels,\n  KeepLabelsExpr,\n  LabelExtractionExpression,\n  LabelFilter,\n  LabelFormatMatcher,\n  LabelParser,\n  LineFilter,\n  LineFormatExpr,\n  LogfmtExpressionParser,\n  LogfmtParser,\n  LogRangeExpr,\n  Matcher,\n  MetricExpr,\n  Number as NumberLezer,\n  On,\n  Or,\n  parser,\n  ParserFlag,\n  Range,\n  RangeAggregationExpr,\n  RangeOp,\n  String,\n  UnitFilter,\n  Unwrap,\n  UnwrapExpr,\n  VectorAggregationExpr,\n  VectorOp,\n  Without,\n  BinOpModifier,\n  OnOrIgnoringModifier,\n  OrFilter,\n} from '@grafana/lezer-logql';\nimport { QueryBuilderLabelFilter, QueryBuilderOperation, QueryBuilderOperationParamValue } from '@grafana/plugin-ui';\n\nimport { binaryScalarDefs } from './binaryScalarOperations';\nimport { checkParamsAreValid, getDefinitionById } from './operations';\nimport {\n  ErrorId,\n  getAllByType,\n  getLeftMostChild,\n  getString,\n  makeBinOp,\n  makeError,\n  replaceVariables,\n} from './parsingUtils';\nimport { LokiOperationId, LokiVisualQuery, LokiVisualQueryBinary } from './types';\n\ninterface Context {\n  query: LokiVisualQuery;\n  errors: ParsingError[];\n}\n\ninterface ParsingError {\n  text: string;\n  from?: number;\n  to?: number;\n  parentType?: string;\n}\n\ninterface GetOperationResult {\n  operation?: QueryBuilderOperation;\n  error?: string;\n}\n\nexport function buildVisualQueryFromString(expr: string): Context {\n  const replacedExpr = replaceVariables(expr);\n  const tree = parser.parse(replacedExpr);\n  const node = tree.topNode;\n\n  // This will be modified in the handleExpression\n  const visQuery: LokiVisualQuery = {\n    labels: [],\n    operations: [],\n  };\n\n  const context: Context = {\n    query: visQuery,\n    errors: [],\n  };\n\n  try {\n    handleExpression(replacedExpr, node, context);\n  } catch (err) {\n    // Not ideal to log it here, but otherwise we would lose the stack trace.\n    console.error(err);\n    if (err instanceof Error) {\n      context.errors.push({\n        text: err.message,\n      });\n    }\n  }\n\n  // If we have empty query, we want to reset errors\n  if (isEmptyQuery(context.query)) {\n    context.errors = [];\n  }\n  return context;\n}\n\nexport function handleExpression(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n  switch (node.type.id) {\n    case Matcher: {\n      visQuery.labels.push(getLabel(expr, node));\n      const err = node.getChild(ErrorId);\n      if (err) {\n        context.errors.push(makeError(expr, err));\n      }\n      break;\n    }\n\n    case LineFilter: {\n      const { operation, error } = getLineFilter(expr, node);\n      if (operation) {\n        visQuery.operations.push(operation);\n      }\n      // Show error for query patterns not supported in visual query builder\n      if (error) {\n        context.errors.push(createNotSupportedError(expr, node, error));\n      }\n      break;\n    }\n\n    case LabelParser: {\n      visQuery.operations.push(getLabelParser(expr, node));\n      break;\n    }\n\n    case LabelFilter: {\n      const { operation, error } = getLabelFilter(expr, node);\n      if (operation) {\n        visQuery.operations.push(operation);\n      }\n      // Show error for query patterns not supported in visual query builder\n      if (error) {\n        context.errors.push(createNotSupportedError(expr, node, error));\n      }\n      break;\n    }\n    case JsonExpressionParser: {\n      visQuery.operations.push(getJsonExpressionParser(expr, node));\n      break;\n    }\n\n    case LogfmtParser:\n    case LogfmtExpressionParser: {\n      const { operation, error } = getLogfmtParser(expr, node);\n      if (operation) {\n        visQuery.operations.push(operation);\n      }\n      if (error) {\n        context.errors.push(createNotSupportedError(expr, node, error));\n      }\n      break;\n    }\n\n    case LineFormatExpr: {\n      visQuery.operations.push(getLineFormat(expr, node));\n      break;\n    }\n\n    case LabelFormatMatcher: {\n      visQuery.operations.push(getLabelFormat(expr, node));\n      break;\n    }\n\n    case UnwrapExpr: {\n      const { operation, error } = handleUnwrapExpr(expr, node, context);\n      if (operation) {\n        visQuery.operations.push(operation);\n      }\n      // Show error for query patterns not supported in visual query builder\n      if (error) {\n        context.errors.push(createNotSupportedError(expr, node, error));\n      }\n\n      break;\n    }\n\n    case Decolorize: {\n      visQuery.operations.push(getDecolorize());\n      break;\n    }\n\n    case RangeAggregationExpr: {\n      visQuery.operations.push(handleRangeAggregation(expr, node, context));\n      break;\n    }\n\n    case VectorAggregationExpr: {\n      visQuery.operations.push(handleVectorAggregation(expr, node, context));\n      break;\n    }\n\n    case BinOpExpr: {\n      handleBinary(expr, node, context);\n      break;\n    }\n\n    case ErrorId: {\n      if (isIntervalVariableError(node)) {\n        break;\n      }\n      context.errors.push(makeError(expr, node));\n      break;\n    }\n\n    case DropLabelsExpr: {\n      visQuery.operations.push(handleDropFilter(expr, node, context));\n      break;\n    }\n\n    case KeepLabelsExpr: {\n      visQuery.operations.push(handleKeepFilter(expr, node, context));\n      break;\n    }\n\n    default: {\n      // Any other nodes we just ignore and go to its children. This should be fine as there are lots of wrapper\n      // nodes that can be skipped.\n      // TODO: there are probably cases where we will just skip nodes we don't support and we should be able to\n      //  detect those and report back.\n      let child = node.firstChild;\n      while (child) {\n        handleExpression(expr, child, context);\n        child = child.nextSibling;\n      }\n    }\n  }\n}\n\nfunction getLabel(expr: string, node: SyntaxNode): QueryBuilderLabelFilter {\n  const labelNode = node.getChild(Identifier);\n  const label = getString(expr, labelNode);\n  const op = getString(expr, labelNode?.nextSibling);\n  let value = getString(expr, node.getChild(String));\n  // `value` is wrapped in double quotes, so we need to remove them. As a value can contain double quotes, we can't use RegEx here.\n  value = value.substring(1, value.length - 1);\n\n  return {\n    label,\n    op,\n    value,\n  };\n}\n\nfunction getLineFilter(expr: string, node: SyntaxNode): GetOperationResult {\n  const filter = getString(expr, node.getChild(Filter));\n  const filterExpr = handleQuotes(getString(expr, node.getChild(String)));\n  const ipLineFilter = node.getChild(FilterOp)?.getChild(Ip);\n  if (ipLineFilter) {\n    return {\n      operation: {\n        id: LokiOperationId.LineFilterIpMatches,\n        params: [filter, filterExpr],\n      },\n    };\n  }\n\n  const params = [filterExpr];\n  let orFilter = node.getChild(OrFilter);\n  while (orFilter) {\n    params.push(handleQuotes(getString(expr, orFilter.getChild(String))));\n    orFilter = orFilter.getChild(OrFilter);\n  }\n\n  const mapFilter: Record<string, LokiOperationId> = {\n    '|=': LokiOperationId.LineContains,\n    '!=': LokiOperationId.LineContainsNot,\n    '|~': LokiOperationId.LineMatchesRegex,\n    '!~': LokiOperationId.LineMatchesRegexNot,\n  };\n\n  return {\n    operation: {\n      id: mapFilter[filter],\n      params,\n    },\n  };\n}\n\nfunction getLabelParser(expr: string, node: SyntaxNode): QueryBuilderOperation {\n  const parserNode = node.firstChild;\n  const parser = getString(expr, parserNode);\n\n  const string = handleQuotes(getString(expr, node.getChild(String)));\n  let params: QueryBuilderOperationParamValue[] = !!string ? [string] : [];\n  const opDef = getDefinitionById(parser);\n  if (opDef && !checkParamsAreValid(opDef, params)) {\n    params = opDef?.defaultParams || [];\n  }\n\n  return {\n    id: parser,\n    params,\n  };\n}\n\nfunction getJsonExpressionParser(expr: string, node: SyntaxNode): QueryBuilderOperation {\n  const parserNode = node.getChild(Json);\n  const parser = getString(expr, parserNode);\n\n  const params = [...getAllByType(expr, node, LabelExtractionExpression)];\n  return {\n    id: parser,\n    params,\n  };\n}\n\nfunction getLogfmtParser(expr: string, node: SyntaxNode): GetOperationResult {\n  const flags: string[] = [];\n  const labels: string[] = [];\n  let error: string | undefined = undefined;\n\n  const offset = node.from;\n  node.toTree().iterate({\n    enter: (subNode) => {\n      if (subNode.type.id === ParserFlag) {\n        flags.push(expr.substring(subNode.from + offset, subNode.to + offset));\n      } else if (subNode.type.id === LabelExtractionExpression) {\n        labels.push(expr.substring(subNode.from + offset, subNode.to + offset));\n      } else if (subNode.type.id === ErrorId) {\n        error = `Unexpected string \"${expr.substring(subNode.from + offset, subNode.to + offset)}\"`;\n      }\n    },\n  });\n\n  const operation = {\n    id: LokiOperationId.Logfmt,\n    params: [flags.includes('--strict'), flags.includes('--keep-empty'), ...labels],\n  };\n\n  return {\n    operation,\n    error,\n  };\n}\n\nfunction getLabelFilter(expr: string, node: SyntaxNode): GetOperationResult {\n  // Check for nodes not supported in visual builder and return error\n  if (node.getChild(Or) || node.getChild(And) || node.getChild('Comma')) {\n    return {\n      error: 'Label filter with comma, \"and\", \"or\" not supported in query builder',\n    };\n  }\n  if (node.firstChild!.type.id === IpLabelFilter) {\n    const ipLabelFilter = node.firstChild;\n    const label = ipLabelFilter?.getChild(Identifier);\n    const op = label?.nextSibling;\n    const value = ipLabelFilter?.getChild(String);\n    const valueString = handleQuotes(getString(expr, value));\n\n    return {\n      operation: {\n        id: LokiOperationId.LabelFilterIpMatches,\n        params: [getString(expr, label), getString(expr, op), valueString],\n      },\n    };\n  }\n\n  const id = LokiOperationId.LabelFilter;\n  if (node.firstChild!.type.id === UnitFilter) {\n    const filter = node.firstChild!.firstChild;\n    const label = filter!.firstChild;\n    const op = label!.nextSibling;\n    const value = op!.nextSibling;\n    const valueString = handleQuotes(getString(expr, value));\n\n    return {\n      operation: {\n        id,\n        params: [getString(expr, label), getString(expr, op), valueString],\n      },\n    };\n  }\n  // In this case it is Matcher or NumberFilter\n  const filter = node.firstChild;\n  const label = filter!.firstChild;\n  const op = label!.nextSibling;\n  const value = op!.nextSibling;\n  const params = [getString(expr, label), getString(expr, op), handleQuotes(getString(expr, value))];\n\n  // Special case of pipe filtering - no errors\n  if (params.join('') === `__error__=`) {\n    return {\n      operation: {\n        id: LokiOperationId.LabelFilterNoErrors,\n        params: [],\n      },\n    };\n  }\n\n  return {\n    operation: {\n      id,\n      params,\n    },\n  };\n}\n\nfunction getLineFormat(expr: string, node: SyntaxNode): QueryBuilderOperation {\n  const id = LokiOperationId.LineFormat;\n  const string = handleQuotes(getString(expr, node.getChild(String)));\n\n  return {\n    id,\n    params: [string],\n  };\n}\n\nfunction getLabelFormat(expr: string, node: SyntaxNode): QueryBuilderOperation {\n  const id = LokiOperationId.LabelFormat;\n  const renameTo = node.getChild(Identifier);\n  const op = renameTo!.nextSibling;\n  const originalLabel = op!.nextSibling;\n\n  return {\n    id,\n    params: [getString(expr, originalLabel), handleQuotes(getString(expr, renameTo))],\n  };\n}\n\nfunction getDecolorize(): QueryBuilderOperation {\n  const id = LokiOperationId.Decolorize;\n\n  return {\n    id,\n    params: [],\n  };\n}\n\nfunction handleUnwrapExpr(expr: string, node: SyntaxNode, context: Context): GetOperationResult {\n  const unwrapExprChild = node.getChild(UnwrapExpr);\n  const labelFilterChild = node.getChild(LabelFilter);\n  const unwrapChild = node.getChild(Unwrap);\n\n  if (unwrapExprChild) {\n    handleExpression(expr, unwrapExprChild, context);\n  }\n\n  if (labelFilterChild) {\n    handleExpression(expr, labelFilterChild, context);\n  }\n\n  if (unwrapChild) {\n    if (unwrapChild.nextSibling?.type.id === ConvOp) {\n      const convOp = unwrapChild.nextSibling;\n      const identifier = convOp.nextSibling;\n      return {\n        operation: {\n          id: LokiOperationId.Unwrap,\n          params: [getString(expr, identifier), getString(expr, convOp)],\n        },\n      };\n    }\n\n    return {\n      operation: {\n        id: LokiOperationId.Unwrap,\n        params: [getString(expr, unwrapChild?.nextSibling), ''],\n      },\n    };\n  }\n\n  return {};\n}\n\nfunction handleRangeAggregation(expr: string, node: SyntaxNode, context: Context) {\n  const nameNode = node.getChild(RangeOp);\n  const funcName = getString(expr, nameNode);\n  const number = node.getChild(NumberLezer);\n  const logExpr = node.getChild(LogRangeExpr);\n  const params = number !== null && number !== undefined ? [getString(expr, number)] : [];\n  const range = logExpr?.getChild(Range);\n  const rangeValue = range ? getString(expr, range) : null;\n  const grouping = node.getChild(Grouping);\n\n  if (rangeValue) {\n    params.unshift(rangeValue.substring(1, rangeValue.length - 1));\n  }\n\n  if (grouping) {\n    params.push(...getAllByType(expr, grouping, Identifier));\n  }\n\n  const op = {\n    id: funcName,\n    params,\n  };\n\n  if (logExpr) {\n    handleExpression(expr, logExpr, context);\n  }\n\n  return op;\n}\n\nfunction handleVectorAggregation(expr: string, node: SyntaxNode, context: Context) {\n  const nameNode = node.getChild(VectorOp);\n  let funcName = getString(expr, nameNode);\n\n  const grouping = node.getChild(Grouping);\n  const params = [];\n\n  const numberNode = node.getChild(NumberLezer);\n  const errorNode = node.getChild(ErrorId)?.getChild(Identifier);\n\n  if (numberNode) {\n    params.push(Number(getString(expr, numberNode)));\n  } else if (errorNode) {\n    // Variables get parsed as errors, so the value us an identifier within an error node.\n    params.push(getString(expr, errorNode));\n  }\n\n  if (grouping) {\n    const byModifier = grouping.getChild(By);\n    if (byModifier && funcName) {\n      funcName = `__${funcName}_by`;\n    }\n\n    const withoutModifier = grouping.getChild(Without);\n    if (withoutModifier) {\n      funcName = `__${funcName}_without`;\n    }\n\n    params.push(...getAllByType(expr, grouping, Identifier));\n  }\n\n  const metricExpr = node.getChild(MetricExpr);\n  const op: QueryBuilderOperation = { id: funcName, params };\n\n  if (metricExpr) {\n    // A vector aggregation expression with a child of metric expression with a child of binary expression is ambiguous after being parsed into a visual query\n    if (metricExpr.firstChild?.type.id === BinOpExpr) {\n      context.errors.push({\n        text: 'Query parsing is ambiguous.',\n        from: metricExpr.firstChild.from,\n        to: metricExpr.firstChild?.to,\n      });\n    }\n\n    handleExpression(expr, metricExpr, context);\n  }\n\n  return op;\n}\n\nconst operatorToOpName = binaryScalarDefs.reduce<Record<string, { id: string; comparison?: boolean }>>((acc, def) => {\n  acc[def.sign] = {\n    id: def.id,\n    comparison: def.comparison,\n  };\n  return acc;\n}, {});\n\n/**\n * Right now binary expressions can be represented in 2 way in visual query. As additional operation in case it is\n * just operation with scalar or it creates a binaryQuery when it's 2 queries.\n * @param expr\n * @param node\n * @param context\n */\nfunction handleBinary(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n  const left = node.firstChild!;\n  const op = getString(expr, left.nextSibling);\n  const binModifier = getBinaryModifier(expr, node.getChild(BinOpModifier));\n\n  const right = node.lastChild!;\n\n  const opDef = operatorToOpName[op];\n\n  const leftNumber = getLastChildWithSelector(left, 'MetricExpr.LiteralExpr.Number');\n  const rightNumber = getLastChildWithSelector(right, 'MetricExpr.LiteralExpr.Number');\n\n  const rightBinary = right.getChild(BinOpExpr);\n\n  if (leftNumber) {\n    // TODO: this should be already handled in case parent is binary expression as it has to be added to parent\n    //  if query starts with a number that isn't handled now.\n  } else {\n    // If this is binary we don't really know if there is a query or just chained scalars. So\n    // we have to traverse a bit deeper to know\n    handleExpression(expr, left, context);\n  }\n\n  if (rightNumber) {\n    visQuery.operations.push(makeBinOp(opDef, expr, right, !!binModifier?.isBool));\n  } else if (rightBinary) {\n    // Due to the way binary ops are parsed we can get a binary operation on the right that starts with a number which\n    // is a factor for a current binary operation. So we have to add it as an operation now.\n    const leftMostChild = getLeftMostChild(right);\n    if (leftMostChild?.type.id === NumberLezer) {\n      visQuery.operations.push(makeBinOp(opDef, expr, leftMostChild, !!binModifier?.isBool));\n    }\n\n    // If we added the first number literal as operation here we still can continue and handle the rest as the first\n    // number will be just skipped.\n    handleExpression(expr, right, context);\n  } else {\n    visQuery.binaryQueries = visQuery.binaryQueries || [];\n    const binQuery: LokiVisualQueryBinary = {\n      operator: op,\n      query: {\n        labels: [],\n        operations: [],\n      },\n    };\n    if (binModifier?.isMatcher) {\n      binQuery.vectorMatchesType = binModifier.matchType;\n      binQuery.vectorMatches = binModifier.matches;\n    }\n    visQuery.binaryQueries.push(binQuery);\n    handleExpression(expr, right, {\n      query: binQuery.query,\n      errors: context.errors,\n    });\n  }\n}\n\nfunction getBinaryModifier(\n  expr: string,\n  node: SyntaxNode | null\n):\n  | { isBool: true; isMatcher: false }\n  | { isBool: boolean; isMatcher: true; matches: string; matchType: 'ignoring' | 'on' }\n  | undefined {\n  if (!node) {\n    return undefined;\n  }\n  const matcher = node.getChild(OnOrIgnoringModifier);\n  const boolMatcher = node.getChild(Bool);\n\n  if (!matcher && boolMatcher) {\n    return { isBool: true, isMatcher: false };\n  } else {\n    if (!matcher) {\n      // Not sure what this could be, maybe should be an error.\n      return undefined;\n    }\n    const labels = getString(expr, matcher.getChild(GroupingLabels)?.getChild(GroupingLabelList));\n    return {\n      isMatcher: true,\n      isBool: !!boolMatcher,\n      matches: labels,\n      matchType: matcher.getChild(On) ? 'on' : 'ignoring',\n    };\n  }\n}\n\nfunction isIntervalVariableError(node: SyntaxNode) {\n  return node?.parent?.type.id === Range;\n}\n\nexport function handleQuotes(string: string) {\n  if (string[0] === `\"` && string[string.length - 1] === `\"`) {\n    return string\n      .substring(1, string.length - 1)\n      .replace(/\\\\\"/g, '\"')\n      .replace(/\\\\\\\\/g, '\\\\');\n  }\n  return string.replace(/`/g, '');\n}\n\n/**\n * Simple helper to traverse the syntax tree. Instead of node.getChild('foo')?.getChild('bar')?.getChild('baz') you\n * can write getChildWithSelector(node, 'foo.bar.baz')\n * @param node\n * @param selector\n */\nfunction getLastChildWithSelector(node: SyntaxNode, selector: string) {\n  let child: SyntaxNode | null = node;\n  const children = selector.split('.');\n  for (const s of children) {\n    child = child.getChild(s);\n    if (!child) {\n      return null;\n    }\n  }\n  return child;\n}\n\n/**\n * Helper function to enrich error text with information that visual query builder doesn't support that logQL\n * @param expr\n * @param node\n * @param error\n */\nfunction createNotSupportedError(expr: string, node: SyntaxNode, error: string) {\n  const err = makeError(expr, node);\n  err.text = `${error}: ${err.text}`;\n  return err;\n}\n\nfunction isEmptyQuery(query: LokiVisualQuery) {\n  if (query.labels.length === 0 && query.operations.length === 0) {\n    return true;\n  }\n  return false;\n}\n\nfunction handleDropFilter(expr: string, node: SyntaxNode, context: Context): QueryBuilderOperation {\n  const labels: string[] = [];\n  let exploringNode = node.getChild(DropLabels);\n  while (exploringNode) {\n    const label = getString(expr, exploringNode.getChild(DropLabel));\n    if (label) {\n      labels.push(label);\n    }\n    exploringNode = exploringNode?.getChild(DropLabels);\n  }\n  labels.reverse();\n  return {\n    id: LokiOperationId.Drop,\n    params: labels,\n  };\n}\n\nfunction handleKeepFilter(expr: string, node: SyntaxNode, context: Context): QueryBuilderOperation {\n  const labels: string[] = [];\n  let exploringNode = node.getChild(KeepLabels);\n  while (exploringNode) {\n    const label = getString(expr, exploringNode.getChild(KeepLabel));\n    if (label) {\n      labels.push(label);\n    }\n    exploringNode = exploringNode?.getChild(KeepLabels);\n  }\n  labels.reverse();\n  return {\n    id: LokiOperationId.Keep,\n    params: labels,\n  };\n}\n","import { SyntaxNode, TreeCursor } from '@lezer/common';\n\nimport { QueryBuilderOperation, QueryBuilderOperationParamValue } from '@grafana/plugin-ui';\n\n// Although 0 isn't explicitly provided in the @grafana/lezer-logql library as the error node ID, it does appear to be the ID of error nodes within lezer.\nexport const ErrorId = 0;\n\nexport function getLeftMostChild(cur: SyntaxNode): SyntaxNode {\n  return cur.firstChild ? getLeftMostChild(cur.firstChild) : cur;\n}\n\nexport function makeError(expr: string, node: SyntaxNode) {\n  return {\n    text: getString(expr, node),\n    // TODO: this are positions in the string with the replaced variables. Means it cannot be used to show exact\n    //  placement of the error for the user. We need some translation table to positions before the variable\n    //  replace.\n    from: node.from,\n    to: node.to,\n    parentType: node.parent?.name,\n  };\n}\n\n// Taken from template_srv, but copied so to not mess with the regex.index which is manipulated in the service\n/*\n * This regex matches 3 types of variable reference with an optional format specifier\n * \\$(\\w+)                          $var1\n * \\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]    [[var2]] or [[var2:fmt2]]\n * \\${(\\w+)(?::(\\w+))?}             ${var3} or ${var3:fmt3}\n */\nexport const variableRegex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]|\\${(\\w+)(?:\\.([^:^\\}]+))?(?::([^\\}]+))?}/g;\n\n/**\n * As variables with $ are creating parsing errors, we first replace them with magic string that is parsable and at\n * the same time we can get the variable and its format back from it.\n * @param expr\n */\nexport function replaceVariables(expr: string) {\n  return expr.replace(variableRegex, (match, var1, var2, fmt2, var3, fieldPath, fmt3) => {\n    const fmt = fmt2 || fmt3;\n    let variable = var1;\n    let varType = '0';\n\n    if (var2) {\n      variable = var2;\n      varType = '1';\n    }\n\n    if (var3) {\n      variable = var3;\n      varType = '2';\n    }\n\n    return `__V_${varType}__` + variable + '__V__' + (fmt ? '__F__' + fmt + '__F__' : '');\n  });\n}\n\nconst varTypeFunc = [\n  (v: string, f?: string) => `\\$${v}`,\n  (v: string, f?: string) => `[[${v}${f ? `:${f}` : ''}]]`,\n  (v: string, f?: string) => `\\$\\{${v}${f ? `:${f}` : ''}\\}`,\n];\n\n/**\n * Get back the text with variables in their original format.\n * @param expr\n */\nexport function returnVariables(expr: string) {\n  return expr.replace(/__V_(\\d)__(.+?)__V__(?:__F__(\\w+)__F__)?/g, (match, type, v, f) => {\n    return varTypeFunc[parseInt(type, 10)](v, f);\n  });\n}\n\n/**\n * Get the actual string of the expression. That is not stored in the tree so we have to get the indexes from the node\n * and then based on that get it from the expression.\n * @param expr\n * @param node\n */\nexport function getString(expr: string, node: SyntaxNode | TreeCursor | null | undefined) {\n  if (!node) {\n    return '';\n  }\n  return returnVariables(expr.substring(node.from, node.to));\n}\n\n/**\n * Create simple scalar binary op object.\n * @param opDef - definition of the op to be created\n * @param expr\n * @param numberNode - the node for the scalar\n * @param hasBool - whether operation has a bool modifier. Is used only for ops for which it makes sense.\n */\nexport function makeBinOp(\n  opDef: { id: string; comparison?: boolean },\n  expr: string,\n  numberNode: SyntaxNode,\n  hasBool: boolean\n): QueryBuilderOperation {\n  const params: QueryBuilderOperationParamValue[] = [parseFloat(getString(expr, numberNode))];\n  if (opDef.comparison) {\n    params.push(hasBool);\n  }\n  return {\n    id: opDef.id,\n    params,\n  };\n}\n\n/**\n * Get all nodes with type in the tree. This traverses the tree so it is safe only when you know there shouldn't be\n * too much nesting but you just want to skip some of the wrappers. For example getting function args this way would\n * not be safe is it would also find arguments of nested functions.\n * @param expr\n * @param cur\n * @param type - can be string or number, some data-sources (loki) haven't migrated over to using numeric constants defined in the lezer parsing library (e.g. lezer-promql).\n * @todo Remove string type definition when all data-sources have migrated to numeric constants\n */\nexport function getAllByType(expr: string, cur: SyntaxNode, type: number | string): string[] {\n  if (cur.type.id === type || cur.name === type) {\n    return [getString(expr, cur)];\n  }\n  const values: string[] = [];\n  let pos = 0;\n  let child = cur.childAfter(pos);\n  while (child) {\n    values.push(...getAllByType(expr, child, type));\n    pos = child.to;\n    child = cur.childAfter(pos);\n  }\n  return values;\n}\n\n/**\n * There aren't any spaces in the metric names, so let's introduce a wildcard into the regex for each space to better facilitate a fuzzy search\n */\nexport const regexifyLabelValuesQueryString = (query: string) => {\n  const queryArray = query.split(' ');\n  return queryArray.map((query) => `${query}.*`).join('');\n};\n","import {\n  VisualQueryBinary,\n  QueryBuilderLabelFilter,\n  QueryBuilderOperation,\n  BINARY_OPERATIONS_KEY,\n} from '@grafana/plugin-ui';\n\n/**\n * Visual query model\n */\nexport interface LokiVisualQuery {\n  labels: QueryBuilderLabelFilter[];\n  operations: QueryBuilderOperation[];\n  binaryQueries?: LokiVisualQueryBinary[];\n}\n\nexport type LokiVisualQueryBinary = VisualQueryBinary<LokiVisualQuery>;\nexport enum LokiQueryPatternType {\n  Log = 'log',\n  Metric = 'metric',\n}\n\nexport interface LokiQueryPattern {\n  name: string;\n  operations: QueryBuilderOperation[];\n  type: LokiQueryPatternType;\n}\n\nexport enum LokiVisualQueryOperationCategory {\n  Aggregations = 'Aggregations',\n  RangeFunctions = 'Range functions',\n  Functions = 'Functions',\n  Formats = 'Formats',\n  LineFilters = 'Line filters',\n  LabelFilters = 'Label filters',\n  BinaryOps = `${BINARY_OPERATIONS_KEY}`,\n}\n\nexport enum LokiOperationId {\n  Json = 'json',\n  Logfmt = 'logfmt',\n  Regexp = 'regexp',\n  Pattern = 'pattern',\n  Unpack = 'unpack',\n  LineFormat = 'line_format',\n  LabelFormat = 'label_format',\n  Decolorize = 'decolorize',\n  Drop = 'drop',\n  Keep = 'keep',\n  Rate = 'rate',\n  RateCounter = 'rate_counter',\n  CountOverTime = 'count_over_time',\n  SumOverTime = 'sum_over_time',\n  AvgOverTime = 'avg_over_time',\n  MaxOverTime = 'max_over_time',\n  MinOverTime = 'min_over_time',\n  FirstOverTime = 'first_over_time',\n  LastOverTime = 'last_over_time',\n  StdvarOverTime = 'stdvar_over_time',\n  StddevOverTime = 'stddev_over_time',\n  QuantileOverTime = 'quantile_over_time',\n  BytesRate = 'bytes_rate',\n  BytesOverTime = 'bytes_over_time',\n  AbsentOverTime = 'absent_over_time',\n  Sum = 'sum',\n  Avg = 'avg',\n  Min = 'min',\n  Max = 'max',\n  Stddev = 'stddev',\n  Stdvar = 'stdvar',\n  Count = 'count',\n  TopK = 'topk',\n  BottomK = 'bottomk',\n  LineContains = '__line_contains',\n  LineContainsNot = '__line_contains_not',\n  LineContainsCaseInsensitive = '__line_contains_case_insensitive',\n  LineContainsNotCaseInsensitive = '__line_contains_not_case_insensitive',\n  LineMatchesRegex = '__line_matches_regex',\n  LineMatchesRegexNot = '__line_matches_regex_not',\n  LineFilterIpMatches = '__line_filter_ip_matches',\n  LabelFilter = '__label_filter',\n  LabelFilterNoErrors = '__label_filter_no_errors',\n  LabelFilterIpMatches = '__label_filter_ip_marches',\n  Unwrap = 'unwrap',\n  SumBy = '__sum_by',\n  SumWithout = '__sum_without',\n  // Binary ops\n  Addition = '__addition',\n  Subtraction = '__subtraction',\n  MultiplyBy = '__multiply_by',\n  DivideBy = '__divide_by',\n  Modulo = '__modulo',\n  Exponent = '__exponent',\n  NestedQuery = '__nested_query',\n  EqualTo = '__equal_to',\n  NotEqualTo = '__not_equal_to',\n  GreaterThan = '__greater_than',\n  LessThan = '__less_than',\n  GreaterOrEqual = '__greater_or_equal',\n  LessOrEqual = '__less_or_equal',\n}\n\nexport enum LokiOperationOrder {\n  LineFilters = 1,\n  Parsers = 2,\n  PipeOperations = 3,\n  // Unwrap is a special case, as it is usually the last operation, so the order is after pipeOperations\n  Unwrap = 4,\n  NoErrors = 5,\n  RangeVectorFunction = 5,\n  Last = 6,\n}\n\nexport const lokiOperators = {\n  equals: { label: '=', value: '=', description: 'Equals', isMultiValue: false },\n  doesNotEqual: { label: '!=', value: '!=', description: 'Does not equal', isMultiValue: false },\n  matchesRegex: { label: '=~', value: '=~', description: 'Matches regex', isMultiValue: true },\n  doesNotMatchRegex: { label: '!~', value: '!~', description: 'Does not match regex', isMultiValue: true },\n  greaterThan: { label: '>', value: '>', description: 'Greater than', isMultiValue: false },\n  greaterThanOrEqual: { label: '>=', value: '>=', description: 'Greater than or equal to', isMultiValue: false },\n  lessThan: { label: '<', value: '<', description: 'Less than', isMultiValue: false },\n  lessThanOrEqual: { label: '<=', value: '<=', description: 'Less than or equal to', isMultiValue: false },\n  contains: { label: '|=', value: '|=', description: 'Contains', isMultiValue: false },\n  doesNotContain: { label: '!=', value: '!=', description: 'Does not contain', isMultiValue: false },\n};\n","export function isLogLineJSON(line: string): boolean {\n  let parsed;\n  try {\n    parsed = JSON.parse(line);\n  } catch (error) {}\n  // The JSON parser should only be used for log lines that are valid serialized JSON objects.\n  return typeof parsed === 'object';\n}\n\n// This matches:\n// first a label from start of the string or first white space, then any word chars until \"=\"\n// second either an empty quotes, or anything that starts with quote and ends with unescaped quote,\n// or any non whitespace chars that do not start with quote\nconst LOGFMT_REGEXP = /(?:^|\\s)([\\w\\(\\)\\[\\]\\{\\}]+)=(\"\"|(?:\".*?[^\\\\]\"|[^\"\\s]\\S*))/;\n\nexport function isLogLineLogfmt(line: string): boolean {\n  return LOGFMT_REGEXP.test(line);\n}\n\nexport function isLogLinePacked(line: string): boolean {\n  let parsed;\n  try {\n    parsed = JSON.parse(line);\n    return parsed.hasOwnProperty('_entry');\n  } catch (error) {\n    return false;\n  }\n}\n","import { DataFrame, DataQueryResponse, FieldType, isValidGoDuration, Labels } from '@grafana/data';\n\nimport { isBytesString, processLabels } from './languageUtils';\nimport { isLogLineJSON, isLogLineLogfmt, isLogLinePacked } from './lineParser';\nimport { LabelType } from './types';\n\nexport function dataFrameHasLokiError(frame: DataFrame): boolean {\n  const labelSets: Labels[] = frame.fields.find((f) => f.name === 'labels')?.values ?? [];\n  return labelSets.some((labels) => labels.__error__ !== undefined);\n}\n\nexport function dataFrameHasLevelLabel(frame: DataFrame): boolean {\n  const labelSets: Labels[] = frame.fields.find((f) => f.name === 'labels')?.values ?? [];\n  return labelSets.some((labels) => labels.level !== undefined);\n}\n\nexport function extractLogParserFromDataFrame(frame: DataFrame): {\n  hasLogfmt: boolean;\n  hasJSON: boolean;\n  hasPack: boolean;\n} {\n  const lineField = frame.fields.find((field) => field.type === FieldType.string);\n  if (lineField == null) {\n    return { hasJSON: false, hasLogfmt: false, hasPack: false };\n  }\n\n  const logLines: string[] = lineField.values;\n\n  let hasJSON = false;\n  let hasLogfmt = false;\n  let hasPack = false;\n\n  logLines.forEach((line) => {\n    if (isLogLineJSON(line)) {\n      hasJSON = true;\n\n      hasPack = isLogLinePacked(line);\n    }\n    if (isLogLineLogfmt(line)) {\n      hasLogfmt = true;\n    }\n  });\n\n  return { hasLogfmt, hasJSON, hasPack };\n}\n\nexport function extractLabelKeysFromDataFrame(frame: DataFrame, type: LabelType = LabelType.Indexed): string[] {\n  const labelsArray: Array<{ [key: string]: string }> | undefined =\n    frame?.fields?.find((field) => field.name === 'labels')?.values ?? [];\n  const labelTypeArray: Array<{ [key: string]: string }> | undefined =\n    frame?.fields?.find((field) => field.name === 'labelTypes')?.values ?? [];\n\n  if (!labelsArray?.length) {\n    return [];\n  }\n\n  // if there are no label types and type is LabelType.Indexed return all label keys\n  if (!labelTypeArray?.length) {\n    if (type === LabelType.Indexed) {\n      const { keys: labelKeys } = processLabels(labelsArray);\n      return labelKeys;\n    }\n    return [];\n  }\n\n  // If we have label types, we can return only label keys that match type\n  let labelsSet = new Set<string>();\n  for (let i = 0; i < labelsArray.length; i++) {\n    const labels = labelsArray[i];\n    const labelsType = labelTypeArray[i];\n\n    const allLabelKeys = Object.keys(labels).filter((key) => labelsType[key] === type);\n    labelsSet = new Set([...labelsSet, ...allLabelKeys]);\n  }\n\n  return Array.from(labelsSet);\n}\n\nexport function extractUnwrapLabelKeysFromDataFrame(frame: DataFrame): string[] {\n  const labelsArray: Array<{ [key: string]: string }> | undefined =\n    frame?.fields?.find((field) => field.name === 'labels')?.values ?? [];\n\n  if (!labelsArray?.length) {\n    return [];\n  }\n\n  // We do this only for first label object, because we want to consider only labels that are present in all log lines\n  // possibleUnwrapLabels are labels with 1. number value OR 2. value that is valid go duration OR 3. bytes string value\n  const possibleUnwrapLabels = Object.keys(labelsArray[0]).filter((key) => {\n    const value = labelsArray[0][key];\n    if (!value) {\n      return false;\n    }\n    return !isNaN(Number(value)) || isValidGoDuration(value) || isBytesString(value);\n  });\n\n  // Add only labels that are present in every line to unwrapLabels\n  return possibleUnwrapLabels.filter((label) => labelsArray.every((obj) => obj[label]));\n}\n\nexport function extractHasErrorLabelFromDataFrame(frame: DataFrame): boolean {\n  const labelField = frame.fields.find((field) => field.name === 'labels' && field.type === FieldType.other);\n  if (labelField == null) {\n    return false;\n  }\n\n  const labels: Array<{ [key: string]: string }> = labelField.values;\n  return labels.some((label) => label['__error__']);\n}\n\nexport function extractLevelLikeLabelFromDataFrame(frame: DataFrame): string | null {\n  const labelField = frame.fields.find((field) => field.name === 'labels' && field.type === FieldType.other);\n  if (labelField == null) {\n    return null;\n  }\n\n  // Depending on number of labels, this can be pretty heavy operation.\n  // Let's just look at first 2 lines If needed, we can introduce more later.\n  const labelsArray: Array<{ [key: string]: string }> = labelField.values.slice(0, 2);\n  let levelLikeLabel: string | null = null;\n\n  // Find first level-like label\n  for (let labels of labelsArray) {\n    const label = Object.keys(labels).find(\n      (label) => label === 'level' || label === 'detected_level' || label === 'lvl' || label.includes('level')\n    );\n    if (label) {\n      levelLikeLabel = label;\n      break;\n    }\n  }\n  return levelLikeLabel;\n}\n\nexport function isRetriableError(errorResponse: DataQueryResponse) {\n  const message = errorResponse.errors\n    ? (errorResponse.errors[0].message ?? '').toLowerCase()\n    : (errorResponse.error?.message ?? '');\n  if (message.includes('timeout')) {\n    return true;\n  } else if (errorResponse.data.length > 0 && errorResponse.data[0].fields.length > 0) {\n    // Error response but we're receiving data, continue querying.\n    return false;\n  }\n  throw new Error(message);\n}\n","import { CoreApp, DashboardLoadedEvent, DataQueryRequest, DataQueryResponse } from '@grafana/data';\nimport { QueryEditorMode } from '@grafana/plugin-ui';\nimport { reportInteraction, config } from '@grafana/runtime';\n\nimport {\n  REF_ID_STARTER_ANNOTATION,\n  REF_ID_DATA_SAMPLES,\n  REF_ID_STARTER_LOG_ROW_CONTEXT,\n  REF_ID_STARTER_LOG_VOLUME,\n  REF_ID_STARTER_LOG_SAMPLE,\n} from './datasource';\nimport pluginJson from './plugin.json';\nimport { getNormalizedLokiQuery, isLogsQuery, obfuscate } from './queryUtils';\nimport { variableRegex } from './querybuilder/parsingUtils';\nimport { LokiGroupedRequest, LokiQuery, LokiQueryType } from './types';\n\ntype LokiOnDashboardLoadedTrackingEvent = {\n  grafana_version?: string;\n  dashboard_id?: string;\n  org_id?: number;\n\n  /* The number of Loki queries present in the dashboard*/\n  queries_count: number;\n\n  /* The number of Loki logs queries present in the dashboard*/\n  logs_queries_count: number;\n\n  /* The number of Loki metric queries present in the dashboard*/\n  metric_queries_count: number;\n\n  /* The number of Loki instant queries present in the dashboard*/\n  instant_queries_count: number;\n\n  /* The number of Loki range queries present in the dashboard*/\n  range_queries_count: number;\n\n  /* The number of Loki queries created in builder mode present in the dashboard*/\n  builder_mode_queries_count: number;\n\n  /* The number of Loki queries created in code mode present in the dashboard*/\n  code_mode_queries_count: number;\n\n  /* The number of Loki queries with used template variables present in the dashboard*/\n  queries_with_template_variables_count: number;\n\n  /* The number of Loki queries with changed resolution present in the dashboard*/\n  queries_with_changed_resolution_count: number;\n\n  /* The number of Loki queries with changed line limit present in the dashboard*/\n  queries_with_changed_line_limit_count: number;\n\n  /* The number of Loki queries with changed legend present in the dashboard*/\n  queries_with_changed_legend_count: number;\n};\n\nexport const onDashboardLoadedHandler = ({\n  payload: { dashboardId, orgId, grafanaVersion, queries },\n}: DashboardLoadedEvent<LokiQuery>) => {\n  try {\n    // We only want to track visible Loki queries\n    const lokiQueries = queries[pluginJson.id]\n      ?.filter((query) => !query.hide)\n      ?.map((query) => getNormalizedLokiQuery(query));\n\n    if (!lokiQueries?.length) {\n      return;\n    }\n\n    const logsQueries = lokiQueries.filter((query) => isLogsQuery(query.expr));\n    const metricQueries = lokiQueries.filter((query) => !isLogsQuery(query.expr));\n    const instantQueries = lokiQueries.filter((query) => query.queryType === LokiQueryType.Instant);\n    const rangeQueries = lokiQueries.filter((query) => query.queryType === LokiQueryType.Range);\n    const builderModeQueries = lokiQueries.filter((query) => query.editorMode === QueryEditorMode.Builder);\n    const codeModeQueries = lokiQueries.filter((query) => query.editorMode === QueryEditorMode.Code);\n    const queriesWithTemplateVariables = lokiQueries.filter(isQueryWithTemplateVariables);\n    const queriesWithChangedResolution = lokiQueries.filter(isQueryWithChangedResolution);\n    const queriesWithChangedLineLimit = lokiQueries.filter(isQueryWithChangedLineLimit);\n    const queriesWithChangedLegend = lokiQueries.filter(isQueryWithChangedLegend);\n\n    const event: LokiOnDashboardLoadedTrackingEvent = {\n      grafana_version: grafanaVersion,\n      dashboard_id: dashboardId,\n      org_id: orgId,\n      queries_count: lokiQueries.length,\n      logs_queries_count: logsQueries.length,\n      metric_queries_count: metricQueries.length,\n      instant_queries_count: instantQueries.length,\n      range_queries_count: rangeQueries.length,\n      builder_mode_queries_count: builderModeQueries.length,\n      code_mode_queries_count: codeModeQueries.length,\n      queries_with_template_variables_count: queriesWithTemplateVariables.length,\n      queries_with_changed_resolution_count: queriesWithChangedResolution.length,\n      queries_with_changed_line_limit_count: queriesWithChangedLineLimit.length,\n      queries_with_changed_legend_count: queriesWithChangedLegend.length,\n    };\n\n    reportInteraction('grafana_loki_dashboard_loaded', event);\n  } catch (error) {\n    console.error('error in loki tracking handler', error);\n  }\n};\n\nconst isQueryWithTemplateVariables = (query: LokiQuery): boolean => {\n  return variableRegex.test(query.expr);\n};\n\nconst isQueryWithChangedResolution = (query: LokiQuery): boolean => {\n  if (!query.resolution) {\n    return false;\n  }\n  // 1 is the default resolution\n  return query.resolution !== 1;\n};\n\nconst isQueryWithChangedLineLimit = (query: LokiQuery): boolean => {\n  return query.maxLines !== null && query.maxLines !== undefined;\n};\n\nconst isQueryWithChangedLegend = (query: LokiQuery): boolean => {\n  if (!query.legendFormat) {\n    return false;\n  }\n  return query.legendFormat !== '';\n};\n\nconst shouldNotReportBasedOnRefId = (refId: string): boolean => {\n  const starters = [\n    REF_ID_STARTER_ANNOTATION,\n    REF_ID_STARTER_LOG_ROW_CONTEXT,\n    REF_ID_STARTER_LOG_VOLUME,\n    REF_ID_STARTER_LOG_SAMPLE,\n    REF_ID_DATA_SAMPLES,\n  ];\n\n  if (starters.some((starter) => refId.startsWith(starter))) {\n    return true;\n  }\n  return false;\n};\n\nconst calculateTotalBytes = (response: DataQueryResponse): number => {\n  let totalBytes = 0;\n  for (const frame of response.data) {\n    const byteKey = frame.meta?.custom?.lokiQueryStatKey;\n    if (byteKey) {\n      totalBytes +=\n        frame.meta?.stats?.find((stat: { displayName: string }) => stat.displayName === byteKey)?.value ?? 0;\n    }\n  }\n  return totalBytes;\n};\n\nexport function trackQuery(\n  response: DataQueryResponse,\n  request: DataQueryRequest<LokiQuery>,\n  startTime: Date,\n  extraPayload: Record<string, unknown> = {}\n): void {\n  // We only want to track usage for these specific apps\n  const { app, targets: queries } = request;\n\n  if (app !== CoreApp.Explore) {\n    return;\n  }\n\n  let totalBytes = calculateTotalBytes(response);\n\n  for (const query of queries) {\n    if (shouldNotReportBasedOnRefId(query.refId)) {\n      return;\n    }\n\n    reportInteraction('grafana_explore_loki_query_executed', {\n      grafana_version: config.buildInfo.version,\n      editor_mode: query.editorMode,\n      has_data: response.data.some((frame) => frame.length > 0),\n      has_error: response.error !== undefined,\n      legend: query.legendFormat,\n      line_limit: query.maxLines,\n      obfuscated_query: obfuscate(query.expr),\n      query_type: isLogsQuery(query.expr) ? 'logs' : 'metric',\n      query_vector_type: query.queryType,\n      resolution: query.resolution,\n      simultaneously_executed_query_count: queries.filter((query) => !query.hide).length,\n      simultaneously_hidden_query_count: queries.filter((query) => query.hide).length,\n      time_range_from: request?.range?.from?.toISOString(),\n      time_range_to: request?.range?.to?.toISOString(),\n      time_taken: Date.now() - startTime.getTime(),\n      bytes_processed: totalBytes,\n      is_split: false,\n      ...extraPayload,\n    });\n  }\n}\n\nexport function trackGroupedQueries(\n  response: DataQueryResponse,\n  groupedRequests: LokiGroupedRequest[],\n  originalRequest: DataQueryRequest<LokiQuery>,\n  startTime: Date\n): void {\n  const splittingPayload = {\n    split_query_group_count: groupedRequests.length,\n    split_query_largest_partition_size: Math.max(...groupedRequests.map(({ partition }) => partition.length)),\n    split_query_total_request_count: groupedRequests.reduce((total, { partition }) => total + partition.length, 0),\n    is_split: true,\n    simultaneously_executed_query_count: originalRequest.targets.filter((query) => !query.hide).length,\n    simultaneously_hidden_query_count: originalRequest.targets.filter((query) => query.hide).length,\n  };\n\n  for (const group of groupedRequests) {\n    const split_query_partition_size = group.partition.length;\n    trackQuery(response, group.request, startTime, {\n      ...splittingPayload,\n      split_query_partition_size,\n    });\n  }\n}\n","import { Observable } from '../Observable';\nimport { innerFrom } from './innerFrom';\nexport function defer(observableFactory) {\n    return new Observable(function (subscriber) {\n        innerFrom(observableFactory()).subscribe(subscriber);\n    });\n}\n//# sourceMappingURL=defer.js.map","import { LRParser } from '@lezer/lr';\n\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst Json$1 = 1,\n  Logfmt$1 = 2,\n  Unpack$1 = 3,\n  Pattern$1 = 4,\n  Regexp$1 = 5,\n  Unwrap$1 = 6,\n  LabelFormat$1 = 7,\n  LineFormat$1 = 8,\n  LabelReplace$1 = 9,\n  Vector$1 = 10,\n  Offset$1 = 11,\n  Bool$1 = 12,\n  On$1 = 13,\n  Ignoring$1 = 14,\n  GroupLeft$1 = 15,\n  GroupRight$1 = 16,\n  Decolorize$1 = 17,\n  Drop$1 = 18,\n  Keep$1 = 19,\n  By$1 = 20,\n  Without$1 = 21,\n  And$1 = 22,\n  Or$1 = 23,\n  Unless$1 = 24,\n  Sum$1 = 25,\n  Avg$1 = 26,\n  Count$1 = 27,\n  Max$1 = 28,\n  Min$1 = 29,\n  Stddev$1 = 30,\n  Stdvar$1 = 31,\n  Bottomk$1 = 32,\n  Topk$1 = 33,\n  Sort$1 = 34,\n  Sort_Desc$1 = 35;\n\nconst keywordTokens = {\n  json: Json$1,\n  logfmt: Logfmt$1,\n  unpack: Unpack$1,\n  pattern: Pattern$1,\n  regexp: Regexp$1,\n  label_format: LabelFormat$1,\n  line_format: LineFormat$1,\n  label_replace: LabelReplace$1,\n  vector: Vector$1,\n  offset: Offset$1,\n  bool: Bool$1,\n  on: On$1,\n  ignoring: Ignoring$1,\n  group_left: GroupLeft$1,\n  group_right: GroupRight$1,\n  unwrap: Unwrap$1,\n  decolorize: Decolorize$1,\n  drop: Drop$1,\n  keep: Keep$1,\n};\n\nconst specializeIdentifier = (value) => {\n  return keywordTokens[value.toLowerCase()] || -1;\n};\n\nconst contextualKeywordTokens = {\n  by: By$1,\n  without: Without$1,\n  and: And$1,\n  or: Or$1,\n  unless: Unless$1,\n  sum: Sum$1,\n  avg: Avg$1,\n  count: Count$1,\n  max: Max$1,\n  min: Min$1,\n  stddev: Stddev$1,\n  stdvar: Stdvar$1,\n  bottomk: Bottomk$1,\n  topk: Topk$1,\n  sort: Sort$1,\n  sort_desc: Sort_Desc$1,\n};\n\nconst extendIdentifier = (value) => {\n  return contextualKeywordTokens[value.toLowerCase()] || -1;\n};\n\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst spec_Identifier = {__proto__:null,ip:295, count_over_time:301, rate:303, rate_counter:305, bytes_over_time:307, bytes_rate:309, avg_over_time:311, sum_over_time:313, min_over_time:315, max_over_time:317, stddev_over_time:319, stdvar_over_time:321, quantile_over_time:323, first_over_time:325, last_over_time:327, absent_over_time:329, bytes:335, duration:337, duration_seconds:339};\nconst parser = LRParser.deserialize({\n  version: 14,\n  states: \"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ\",\n  stateData: \"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO\",\n  goto: \"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R\",\n  nodeNames: \" Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr\",\n  maxTerm: 169,\n  skippedNodes: [0,36],\n  repeatNodeCount: 0,\n  tokenData: \"<n~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P2v!P!Q3v!Q!R3{!R![7^![!]9]!^!_9q!_!`:O!`!a:e!c!}:r!}#O;Y#P#Q;_#Q#R;d#R#S:r#S#T;i#T#o:r#o#p;u#p#q;z#q#r<i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kQ!x~}!O&q!Q![(w~&tQ#_#`&z#g#h(X~&}P#X#Y'Q~'TP#X#Y'W~'ZP#d#e'^~'aP}!O'd~'gP#X#Y'j~'mP#a#b'p~'sP#d#e'v~'yP#h#i'|~(PP#m#n(S~(XO!b~~([P#h#i(_~(bP#f#g(e~(hP#]#^(k~(nP#V#W(q~(tP#h#i(S~(zZ!O!P)m!Q![(w#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~)pP!Q![)s~)vV!Q![)s#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~*bP!m~!Q![*e~*hV!O!P*}!Q![*e#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+QP!Q![+T~+WU!Q![+T#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+oQ!m~!Q![+u#g#h-Q~+xV!O!P,_!Q![+u#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,bP!Q![,e~,hU!Q![,e#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,}P#g#h-Q~-VP!m~!Q![-Y~-]T!O!P-l!Q![-Y#b#c.R#i#j.^${$|.^~-oP!Q![-r~-uS!Q![-r#b#c.R#i#j.^${$|.^~.UP#g#h.X~.^O!m~~.aP#g#h.d~.iP!m~!Q![.l~.oR!O!P.x!Q![.l#b#c.R~.{P!Q![/O~/RQ!Q![/O#b#c.R~/^P!m~!Q![/a~/dU!O!P/v!Q![/a#a#b,z#b#c.R#i#j.^${$|.^~/yP!Q![/|~0PT!Q![/|#a#b,z#b#c.R#i#j.^${$|.^~0eP!m~!Q![0h~0kW!O!P)m!Q![0h#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~1YP!m~!Q![1]~1`X!O!P)m!Q![1]#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~2QP!m~!Q![2T~2WY!O!P)m!Q![2T#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T${$|.^~2yP!Q![2|~3RR!v~!Q![2|!g!h3[#X#Y3[~3_R{|3h}!O3h!Q![3n~3kP!Q![3n~3sP!v~!Q![3n~3{O#|~~4Qe!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#l#m8q#m#n1{${$|.^~5hR!v~!Q![5q!g!h3[#X#Y3[~5v`!v~!Q![5q!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~6}O!s~~7QQ!d!e6x#]#^7W~7ZP!d!e6x~7cd!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~8tR!Q![8}!c!i8}#T#Z8}~9SR!v~!Q![8}!c!i8}#T#Z8}P9bT{P!Q![9]![!]9]!c!}9]#R#S9]#T#o9]~9vP!o~!_!`9y~:OO!p~~:TQ|~!_!`:Z#r#s:`~:`O!q~~:eO!P~~:jP!l~!_!`:m~:rO!n~R:yT{P#zQ!Q![:r![!]9]!c!}:r#R#S:r#T#o:r~;_O$k~~;dO$l~~;iO$O~~;lRO#S;i#S#T%`#T~;i~;zO$U~~<PR!_~!_!`<Y!`!a<_#r#s<d~<_O!W~~<dO!Y~~<iO!X~~<nO$W~\",\n  tokenizers: [0, 1],\n  topRules: {\"LogQL\":[0,37]},\n  specialized: [{term: 43, get: (value, stack) => (specializeIdentifier(value) << 1)},{term: 43, get: (value, stack) => (extendIdentifier(value) << 1) | 1},{term: 43, get: value => spec_Identifier[value] || -1}],\n  tokenPrec: 0\n});\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst Json = 1,\n  Logfmt = 2,\n  Unpack = 3,\n  Pattern = 4,\n  Regexp = 5,\n  Unwrap = 6,\n  LabelFormat = 7,\n  LineFormat = 8,\n  LabelReplace = 9,\n  Vector = 10,\n  Offset = 11,\n  Bool = 12,\n  On = 13,\n  Ignoring = 14,\n  GroupLeft = 15,\n  GroupRight = 16,\n  Decolorize = 17,\n  Drop = 18,\n  Keep = 19,\n  By = 20,\n  Without = 21,\n  And = 22,\n  Or = 23,\n  Unless = 24,\n  Sum = 25,\n  Avg = 26,\n  Count = 27,\n  Max = 28,\n  Min = 29,\n  Stddev = 30,\n  Stdvar = 31,\n  Bottomk = 32,\n  Topk = 33,\n  Sort = 34,\n  Sort_Desc = 35,\n  LineComment = 36,\n  LogQL = 37,\n  Expr = 38,\n  LogExpr = 39,\n  Selector = 40,\n  Matchers = 41,\n  Matcher = 42,\n  Identifier = 43,\n  Eq = 44,\n  String = 45,\n  Neq = 46,\n  Re = 47,\n  Nre = 48,\n  PipelineExpr = 49,\n  PipelineStage = 50,\n  LineFilters = 51,\n  LineFilter = 52,\n  Filter = 53,\n  PipeExact = 54,\n  PipeMatch = 55,\n  PipePattern = 56,\n  Npa = 57,\n  FilterOp = 58,\n  Ip = 59,\n  OrFilter = 60,\n  Pipe = 61,\n  LogfmtParser = 62,\n  LogfmtParserFlags = 63,\n  ParserFlag = 64,\n  LabelParser = 65,\n  JsonExpressionParser = 66,\n  LabelExtractionExpressionList = 67,\n  LabelExtractionExpression = 68,\n  LogfmtExpressionParser = 69,\n  LabelFilter = 70,\n  IpLabelFilter = 71,\n  UnitFilter = 72,\n  DurationFilter = 73,\n  Gtr = 74,\n  Duration = 75,\n  Gte = 76,\n  Lss = 77,\n  Lte = 78,\n  Eql = 79,\n  BytesFilter = 80,\n  Bytes = 81,\n  NumberFilter = 82,\n  LiteralExpr = 83,\n  Number = 84,\n  Add = 85,\n  Sub = 86,\n  LineFormatExpr = 87,\n  LabelFormatExpr = 88,\n  LabelsFormat = 89,\n  LabelFormatMatcher = 90,\n  DecolorizeExpr = 91,\n  DropLabelsExpr = 92,\n  DropLabels = 93,\n  DropLabel = 94,\n  KeepLabelsExpr = 95,\n  KeepLabels = 96,\n  KeepLabel = 97,\n  MetricExpr = 98,\n  RangeAggregationExpr = 99,\n  RangeOp = 100,\n  CountOverTime = 101,\n  Rate = 102,\n  RateCounter = 103,\n  BytesOverTime = 104,\n  BytesRate = 105,\n  AvgOverTime = 106,\n  SumOverTime = 107,\n  MinOverTime = 108,\n  MaxOverTime = 109,\n  StddevOverTime = 110,\n  StdvarOverTime = 111,\n  QuantileOverTime = 112,\n  FirstOverTime = 113,\n  LastOverTime = 114,\n  AbsentOverTime = 115,\n  LogRangeExpr = 116,\n  Range = 117,\n  OffsetExpr = 118,\n  UnwrapExpr = 119,\n  ConvOp = 120,\n  BytesConv = 121,\n  DurationConv = 122,\n  DurationSecondsConv = 123,\n  Grouping = 124,\n  Labels = 125,\n  VectorAggregationExpr = 126,\n  VectorOp = 127,\n  BinOpExpr = 128,\n  BinOpModifier = 129,\n  OnOrIgnoringModifier = 130,\n  GroupingLabels = 131,\n  GroupingLabelList = 132,\n  GroupingLabel = 133,\n  LabelName = 134,\n  Mul = 135,\n  Div = 136,\n  Mod = 137,\n  Pow = 138,\n  LabelReplaceExpr = 139,\n  VectorExpr = 140;\n\nexport { AbsentOverTime, Add, And, Avg, AvgOverTime, BinOpExpr, BinOpModifier, Bool, Bottomk, By, Bytes, BytesConv, BytesFilter, BytesOverTime, BytesRate, ConvOp, Count, CountOverTime, Decolorize, DecolorizeExpr, Div, Drop, DropLabel, DropLabels, DropLabelsExpr, Duration, DurationConv, DurationFilter, DurationSecondsConv, Eq, Eql, Expr, Filter, FilterOp, FirstOverTime, GroupLeft, GroupRight, Grouping, GroupingLabel, GroupingLabelList, GroupingLabels, Gte, Gtr, Identifier, Ignoring, Ip, IpLabelFilter, Json, JsonExpressionParser, Keep, KeepLabel, KeepLabels, KeepLabelsExpr, LabelExtractionExpression, LabelExtractionExpressionList, LabelFilter, LabelFormat, LabelFormatExpr, LabelFormatMatcher, LabelName, LabelParser, LabelReplace, LabelReplaceExpr, Labels, LabelsFormat, LastOverTime, LineComment, LineFilter, LineFilters, LineFormat, LineFormatExpr, LiteralExpr, LogExpr, LogQL, LogRangeExpr, Logfmt, LogfmtExpressionParser, LogfmtParser, LogfmtParserFlags, Lss, Lte, Matcher, Matchers, Max, MaxOverTime, MetricExpr, Min, MinOverTime, Mod, Mul, Neq, Npa, Nre, Number, NumberFilter, Offset, OffsetExpr, On, OnOrIgnoringModifier, Or, OrFilter, ParserFlag, Pattern, Pipe, PipeExact, PipeMatch, PipePattern, PipelineExpr, PipelineStage, Pow, QuantileOverTime, Range, RangeAggregationExpr, RangeOp, Rate, RateCounter, Re, Regexp, Selector, Sort, Sort_Desc, Stddev, StddevOverTime, Stdvar, StdvarOverTime, String, Sub, Sum, SumOverTime, Topk, UnitFilter, Unless, Unpack, Unwrap, UnwrapExpr, Vector, VectorAggregationExpr, VectorExpr, VectorOp, Without, parser };\n","import { css } from '@emotion/css';\nimport React__default from 'react';\nimport '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport { EditorStack } from './EditorStack.js';\n\nconst EditorRow = ({ children }) => {\n  const styles = useStyles2(getStyles);\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.root }, /* @__PURE__ */ React__default.createElement(EditorStack, { gap: 2 }, children));\n};\nconst getStyles = (theme) => {\n  return {\n    root: css({\n      padding: theme.spacing(1),\n      backgroundColor: theme.colors.background.secondary,\n      borderRadius: theme.shape.radius.default\n    })\n  };\n};\n\nexport { EditorRow };\n//# sourceMappingURL=EditorRow.js.map\n","import React__default from 'react';\nimport { Stack } from '@grafana/ui';\nimport '@grafana/data';\n\nconst EditorStack = ({ children, wrap: wrapItems = true, ...props }) => {\n  var _a, _b;\n  return /* @__PURE__ */ React__default.createElement(Stack, { wrap: wrapItems ? \"wrap\" : undefined, direction: (_a = props.direction) != null ? _a : \"row\", gap: (_b = props.gap) != null ? _b : 2, ...props }, children);\n};\n\nexport { EditorStack };\n//# sourceMappingURL=EditorStack.js.map\n","import { cx, css } from '@emotion/css';\nimport Prism from 'prismjs';\nimport React__default from 'react';\nimport { textUtil } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction RawQuery({ query, language, className }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const highlighted = Prism.highlight(query, language.grammar, language.name);\n  return /* @__PURE__ */ React__default.createElement(\n    \"div\",\n    {\n      className: cx(styles.editorField, \"prism-syntax-highlight\", className),\n      \"aria-label\": \"selector\",\n      dangerouslySetInnerHTML: { __html: textUtil.sanitize(highlighted) }\n    }\n  );\n}\nconst getStyles = (theme) => {\n  return {\n    editorField: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize\n    })\n  };\n};\n\nexport { RawQuery };\n//# sourceMappingURL=RawQuery.js.map\n","import 'react';\nimport '@grafana/data';\n\nvar QueryEditorMode = /* @__PURE__ */ ((QueryEditorMode2) => {\n  QueryEditorMode2[\"Code\"] = \"code\";\n  QueryEditorMode2[\"Builder\"] = \"builder\";\n  return QueryEditorMode2;\n})(QueryEditorMode || {});\nconst BINARY_OPERATIONS_KEY = \"Binary operations\";\n\nexport { BINARY_OPERATIONS_KEY, QueryEditorMode };\n//# sourceMappingURL=types.js.map\n","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;\n","import REGEX from './regex.js';\nfunction validate(uuid) {\n    return typeof uuid === 'string' && REGEX.test(uuid);\n}\nexport default validate;\n"],"names":["getStyles","theme","LogsColumnSearch","props","styles","Field","Input","LogsTableEmptyFields","LogsTableNavField","Checkbox","Icon","getLogsFieldsStyles","sortLabels","labels","a","b","la","lb","LogsTableActiveFields","reorderColumn","valueFilter","toggleColumn","labelKeys","labelName","onDragEnd","result","renderTitle","label","provided","index","snapshot","collator","LogsTableAvailableFields","LogsTableMultiSelect","value","uf","uFuzzy","fuzzySearch","haystack","query","dispatcher","idxs","info","order","haystackOrder","matchesSet","mark","part","matched","i","infoIdx","debouncedFuzzySearch","LogsTableWrap","logsFrames","updatePanelState","panelState","propsColumns","columnsWithMeta","setColumnsWithMeta","filteredColumnsWithMeta","setFilteredColumnsWithMeta","searchValue","setSearchValue","height","getLogsTableHeight","panelStateRefId","currentDataFrame","setCurrentDataFrame","f","getColumnsFromProps","fieldNames","previouslySelected","key","logsFrame","defaultColumns","newFrame","newFiltered","flag","numberOfLogLines","otherFields","field","labelCardinality","pendingLabelState","normalize","isActive","sidebarWidth","setSidebarWidth","tableWidth","columnFilterEvent","columnName","newState","priorActiveCount","column","event","searchFilterEvent","searchResultCount","clearSelection","isDefaultField","sourceIndex","destinationIndex","keys","source","updateExploreState","newColumnsArray","pa","pb","newColumns","newPanelState","length","c","active","pendingFilteredLabelState","data","matches","newColumnsWithMeta","numberOfResults","match","search","needle","onSearchInputChange","e","onFrameSelectorChange","frame","getOnResize","direction","ref","newSidebarWidth","InlineField","Select","LogsTable","total","width","PopoverMenu","x","y","onClickFilterString","onClickFilterOutString","selection","row","close","containerRef","handleEscape","onDisable","track","action","selectionLength","dataSourceType","SETTINGS_KEYS","SETTING_KEY_ROOT","visualisationTypeKey","ControlledLogsTable","loading","loadMoreLogs","deduplicatedRows","range","splitOpen","onClickFilterLabel","onClickFilterOutLabel","datasourceType","logsTableFrames","visualisationType","rest","sortOrder","eventBus","EventBus","LogListControls","ControlledLogRows","dedupStrategy","filterLevels","hasUnescapedContent","showLabels","showTime","logsMeta","logOptionsStorageKey","logsSortOrder","prettifyLogMessage","onLogOptionsChange","wrapLogMessage","LogListContext","LogRowsComponent","scrollIntoViewProp","app","forceEscape","prettifyJSON","showUniqueLabels","scrollElementRef","subscription","handleScrollToEvent","filteredLogs","log","scrollElementClassName","config","scrollIntoView","element","InfiniteScroll","LogRows","scrollElement","children","rows","timeZone","topScrollEnabled","upperOutOfRange","setUpperOutOfRange","lowerOutOfRange","setLowerOutOfRange","upperLoading","setUpperLoading","lowerLoading","setLowerLoading","rowsRef","lastScroll","lastEvent","countRef","handleScroll","scrollDirection","shouldLoadMore","scrollTop","scrollBottom","newRange","canScrollTop","getVisibleRange","canScrollBottom","hideTopMessage","hideBottomMessage","loadOlderLogs","outOfRangeMessage","ScrollDirection","delta","shouldIgnoreChainOfEvents","deltaTime","firstTimeStamp","lastTimeStamp","getPrevRange","visibleRange","currentRange","getNextRange","updateCurrentRange","SCROLLING_THRESHOLD","timeRange","LoadingIndicator","adjective","text","loadingIndicatorStyles","UnThemedLogDetailsRow","onClickShowDetectedField","parsedKeys","onClickHideDetectedField","isFilterLabelActive","parsedValues","getStats","fieldStats","fieldCount","sum","stat","isLabel","showFieldsStats","state","val","ClipboardButton","showCopy","links","displayedFields","disableActions","onPinLine","pinLineButtonTooltipTitle","rowStyles","getLogRowStyles","singleKey","singleVal","hasFilteringFunctionality","refIdTooltip","labelType","isMultiParsedValueWithNoContent","toggleFieldButton","IconButton","AsyncIconButton","LabelTypeBadge","link","originalOnClick","origin","DataLinkButton","LogLabelStats","type","Tooltip","tooltipSuffix","setActive","tooltip","LogDetailsRow","useAttributesExtensionLinks","context","usePluginLinks","acc","linkModel","withAttributesExtensionLinks","Component","ComponentWithLinks","labelLinks","UnThemedLogDetails","hasError","getRows","showDuplicates","className","onClickShowField","onClickHideField","getFieldLinks","levelStyles","labelsAvailable","fieldsAndLinks","fieldsWithLinks","displayedFieldsWithLinks","hiddenFieldsWithLinks","fieldsWithLinksFromVariableMap","fieldsWithLinksAvailable","fields","fieldsAvailable","levelClassName","LogDetailsBody","values","fieldIndex","LogDetails","LOG_LINE_BODY_FIELD_NAME","showField","hideField","LogLabelStatsRow","count","proportion","style","percent","barStyle","STATS_ROW_LIMIT","rowCount","stats","topRows","activeRow","otherRows","insertActiveRow","otherCount","otherProportion","HIDDEN_LABELS","LogLabels","emptyMessage","addTooltip","displayMax","onDisplayMaxToggle","initialDisplayAll","displayAll","setDisplayAll","allLabels","displayLabels","labelValue","LogLabel","LogLabelsList","convertCSSToStyle","css","accumulated","line","_","character","UnThemedLogMessageAnsi","span","chunks","chunk","chunkText","LogMessageAnsi","UniqueKeyMaker","proposedKey","maybeKey","LogRowMenuCell","logText","onOpenContext","onPermalinkClick","onUnpinLine","pinned","showContextToggle","mouseIsOver","onBlur","getRowContextQuery","addonBefore","addonAfter","shouldShowContextToggle","onLogRowClick","onShowContextClick","handleBlur","getLogText","beforeContent","addClickListenersToNode","afterContent","nodes","node","onClick","MAX_CHARACTERS","LogMessage","hasAnsi","entry","highlights","excessCharacters","needsHighlighter","searchWords","showFull","setShowFull","truncatedEntry","highlight","Ellipsis","toggle","diff","getEllipsisStyles","handleClick","restructureLog","expanded","LogRowMessage","logRowMenuIconsBefore","logRowMenuIconsAfter","restructuredEntry","shouldShowMenu","LogRowMessageDisplayedFields","detectedFields","preview","wrapClassName","displayedFieldsStyles","parsedKey","LogRow","enableLogDetails","permalinkedRowId","handleTextSelection","onLogRowHover","showingContext","setShowingContext","showDetails","setShowDetails","setMouseIsOver","permalinked","setPermalinked","logLineRef","timestamp","processedRow","errorMessage","sampleMessage","isSampled","debouncedContextClose","onRowClick","onMouseEnter","onMouseMove","onMouseLeave","emptyFn","PreviewLogRow","logRows","previewLimit","pinnedLogs","renderPreview","previewSize","setPreviewSize","popoverState","setPopoverState","showDisablePopoverOptions","setShowDisablePopoverOptions","logRowsRef","dedupedRows","dedupCount","orderedRows","handleDeselectionRef","keyMaker","renderAll","openContext","onClose","popoverMenuSupported","closePopoverMenu","handleDeselection","handleSelection","MENU_WIDTH","MENU_HEIGHT","onDisablePopoverMenu","onDisableCancel","onDisableConfirm","ConfirmModal","logId","getLogLevelStyles","logLevel","logColor","hoverBgColor","contextOutlineColor","LogContextButtons","wrapLines","onChangeWrapLines","onScrollCenterClick","internalOnChangeWrapLines","Button","makeEmptyContext","getLoadMoreDirection","place","normalizeLogRowRefId","counter","containsRow","r","PAGE_SIZE","LogRowContextModal","open","getLogRowContextUi","getRowContext","entryElement","preEntryElement","prevScrollHeightRef","prevClientHeightRef","aboveLoadingElement","belowLoadingElement","loadCountRef","dispatch","sticky","setSticky","setContext","setSection","fun","newContext","generationRef","contextQuery","setContextQuery","setWrapLines","store","getFullTimeRange","below","above","allRows","fromMs","toMs","from","to","updateContextQuery","updateResults","loadMore","refRow","newRows","setDisplayedFields","maybeLoadMore","section","currentGen","older","newer","newRow","newAbove","newBelow","sortedNewAbove","sortedNewBelow","onScrollHit","entries","observer","targetElement","scroll","aboveElem","belowElem","scrollToCenter","scrollE","prevClientHeight","currentClientHeight","prevScrollHeight","currentHeight","newScrollTop","useAsync","loadingStateAbove","loadingStateBelow","Modal","rowId","LogLineDetailsDisplayedFields","newDisplayedFields","DraggableDisplayedField","Card","LogLineDetailsFields","logs","getFieldsStyles","getLogs","filteredFields","filterFields","LogLineDetailsField","LogLineDetailsLabelFields","filterLabels","setShowFieldStats","setFieldCount","setFieldStats","closeDetails","isLabelFilterActive","getFieldStyles","updateStats","newStats","newCount","filterLabel","filterOutLabel","labelFilterActive","showStats","showFieldStats","singleValue","MultipleValue","ClipboardButtonWrapper","getClipboardButtonStyles","keysIdx","valuesIdx","results","LogLineDetailsHeader","onSearch","detailsMode","logSupportsContext","setDetailsMode","inputRef","copyLogLine","copyLinkToLogLine","togglePinning","shouldlogSupportsContext","showContext","showLogLineToggle","logLineDisplayed","toggleDetailsMode","newMode","toggleLogLine","clearSearch","handleSearch","mode","colorManipulator","LogLineDetailsComponent","setSearch","extensionLinks","fieldsWithoutLinks","labelsWithLinks","groupedLabels","labelGroups","logLineOpen","linksOpen","fieldsOpen","displayedFieldsOpen","handleToggle","option","isOpen","newSearch","noDetails","group","groupOptionName","LogLineDetails","containerElement","focusLogLine","onResize","detailsWidth","setDetailsWidth","dragStyles","handleResize","maxWidth","InlineLogLineDetails","LOG_LINE_DETAILS_HEIGHT","LogLineMenu","detailsDisplayed","logLineMenuCustomItems","toggleDetails","menuRef","toggleLogDetails","menu","Menu","item","isDivider","isItem","Dropdown","LogLine","onOverflow","variant","virtualization","LogLineComponent","fontSize","hasLogsWithErrors","hasSampledLogs","onLogLineHover","collapsed","setCollapsed","calculatedHeight","actualHeight","handleMouseOver","handleExpandCollapse","detailsShown","Log","DisplayedFields","LogLineBody","matchingUids","syntaxHighlighting","getGridTemplateColumns","dimensions","columns","dimension","logLineWidth","colors","hoverColor","tinycolor","LogLineMessage","handleOverflow","setInitialScrollPosition","infiniteLoaderState","setInfiniteLoaderState","autoScroll","setAutoScroll","prevLogs","usePrevious","prevSortOrder","lastLogOfPage","onLoadMore","Renderer","getMessageFromInfiniteLoaderState","getLogLineVariant","onItemsRendered","lastLogIndex","preScrollIndex","getItemKey","itemCount","Spinner","prevLog","uid","LOG_LIST_SEARCH_HEIGHT","LogListSearch","listRef","hideSearch","filterLogs","setMatchingUids","setContextSearch","searchVisible","toggleFilterLogs","currentResult","setCurrentResult","findMatchingLogs","handleChange","prevResult","prev","nextResult","next","newMatchingUids","sameLogs","prevMatchingLog","matchingLog","suffix","regex","newMatches","logsGrammar","generateLogGrammar","generateTextMatchGrammar","highlightWords","expressions","word","cleaned","flags","cleanNeedle","TRUNCATION_DEFAULT_LENGTH","NEWLINES_REGEX","LogListModel","escape","grammar","logLevelToDisplayLevel","raw","extraGrammar","fieldName","stripAnsi","ansicolor","fieldValue","container","preProcessLogs","preProcessLog","options","level","useKeyBindings","showSearch","handleToggleSearch","isMac","isFKey","usePopoverMenu","LogList","initialScrollPosition","permalinkedLogId","showControls","LogListSearchContext","LogListComponent","processedLogs","setProcessedLogs","listHeight","setListHeight","widthRef","wrapperRef","scrollRef","widthContainer","debouncedResetAfterIndex","overflowIndexRef","debouncedScrollToItem","align","id","handleScrollPosition","handleLogLineClick","handleLogDetailsResize","levelFilteredLogs","logsCount","list","useLogListContextData","useLogListContext","useLogIsPinned","useLogIsPermalinked","LogListContextProvider","detailsModeProp","logListState","setLogListState","setDetailsWidthState","getDetailsWidth","newShowDetails","expandedLog","shownLog","setDedupStrategy","setFontSize","setForceEscape","setFilterLevels","setPinnedLogs","setShowTime","setShowUniqueLabels","setPrettifyJSON","setSyntaxHighlighting","setSortOrder","setWrapLogMessage","downloadLogs","format","stateLog","isLogsSortOrder","isDedupStrategy","currentWidth","defaultWidth","DEDUP_OPTIONS","FILTER_LEVELS","onScrollToTopClick","onScrollToBottomClick","onForceEscapeClick","onFilterLevelClick","filterLevel","onFontSizeClick","newSize","onShowTimestampsClick","onShowUniqueLabelsClick","onSortOrderClick","onSetPrettifyJSONClick","onSyntaxHightlightingClick","onWrapLogMessageClick","deduplicationMenu","filterLevelsMenu","downloadMenu","inDashboard","useLogListSearchContextData","useLogListSearchContext","LogListSearchContextProvider","setSearchVisible","setFilterLogs","LOG_LIST_MIN_WIDTH","FIELD_GAP_MULTIPLIER","DEFAULT_LINE_HEIGHT","LogLineVirtualization","getLogContainerWidth","canvasCharWidth","font","letterSpacing","canvas","storedWidth","beforeWidth","logLines","charWidth","logLineCharsLength","firstLineCharsLength","textLines","availableWidth","textLine","start","testLogLine","measuredLine","timestampWidth","levelWidth","fieldWidths","fontSizePx","getLogLineSize","wrap","gap","detailsHeight","storedSize","textToMeasure","iconsGap","optionsWidth","hasUnderOrOverflow","inlineDetails","measuredHeight","child","logLineMenuIconWidth","scrollBarWidth","getScrollbarWidth","hiddenDiv","ScrollToLogsEvent","validateQuery","interpolatedQuery","queryLines","parser","interpolatedErrors","parseQuery","parseErrors","queryErrors","interpolatedError","queryError","parseError","findErrorBoundary","isErrorBoundary","nodeRef","isEmptyString","errorNode","error","startPos","endPos","boundary","placeHolderScopedVars","perf","warned","PROCESS","emitWarning","msg","code","fn","AC","AS","warnACPolyfill","reason","printACPolyfillWarning","shouldWarn","TYPE","isPosInt","n","getUintArray","max","ZeroArray","size","Stack","#constructing","HeapCls","s","LRUCache","#max","#maxSize","#dispose","#onInsert","#disposeAfter","#fetchMethod","#memoMethod","#size","#calculatedSize","#keyMap","#keyList","#valList","#next","#prev","#head","#tail","#free","#disposed","#sizes","#starts","#ttls","#hasDispose","#hasFetchMethod","#hasDisposeAfter","#hasOnInsert","p","#isBackgroundFetch","k","#backgroundFetch","#moveToTail","#indexes","#rindexes","#isStale","ttl","ttlResolution","ttlAutopurge","updateAgeOnGet","updateAgeOnHas","allowStale","dispose","onInsert","disposeAfter","noDisposeOnSet","noUpdateTTL","maxSize","maxEntrySize","sizeCalculation","fetchMethod","memoMethod","noDeleteOnFetchRejection","noDeleteOnStaleGet","allowStaleOnFetchRejection","allowStaleOnFetchAbort","ignoreFetchAbort","UintArray","#initializeSizeTracking","#initializeTTLTracking","ttls","starts","#setItemTTL","t","#delete","#updateItemAge","#statusTTL","status","cachedNow","getNow","age","sizes","#removeItemSize","#requireSize","v","#addItemSize","#evict","_i","_s","_st","_k","_v","#isValidIndex","getOptions","thisp","deleted","remain","arr","setOptions","oldVal","oldValue","dt","task","free","head","hasOptions","peekOptions","ac","signal","fetchOpts","cb","updateCache","aborted","ignoreAbort","fetchFail","bf","eb","er","allowStaleAborted","noDelete","pcall","res","rej","fmp","fetchOptions","forceRefresh","stale","isStale","staleVal","memoOptions","vv","fetching","#connect","#clear","pi","ni","NS_IN_MS","EMPTY_SELECTOR","LokiLanguageProvider","datasource","initialValues","url","params","throwError","requestOptions","newRangeParams","prevRangeParams","streamSelector","interpolatedMatch","end","cacheKey","labelBasedQuery","labelMatchers","param","nanoseconds","queryOptions","interpolatedExpr","rangeParams","resolve","reject","paramCacheKey","labelValues","labelValuesPromise","streamParam","empty","series","DEFAULT_MAX_LINES_SAMPLE","hasLogfmt","hasJSON","hasPack","DEFAULT_WEBSOCKET_CONFIG","WEBSOCKETSUBJECT_INVALID_ERROR_OBJECT","WebSocketSubject","_super","urlConfigOrSource","destination","_this","Observable","Subject","ReplaySubject","operator","sock","subMsg","unsubMsg","messageFilter","self","err","_a","WebSocketCtor","protocol","binaryType","socket","Subscription","evt","_socket","openObserver","queue","Subscriber","serializer","closingObserver","closeObserver","deserializer","subscriber","webSocket","z","ROTL","sha1","bytes","K","H","newBytes","l","N","M","j","W","d","T","parse","uuid","validate","stringToBytes","str","DNS","URL","v35","version","hash","namespace","buf","offset","valueBytes","namespaceBytes","v5","UUID_NAMESPACE","appendResponseToBufferedData","response","streams","tsField","lineField","idField","usedUids","stream","allLabelsString","ts","createUid","labelsString","refId","LiveStreams","target","retryInterval","CircularDataFrame","map","retryWhen","attempts","mergeMap","retryAttempt","timer","finalize","IS_LOKI_LOG_CONTEXT_UI_OPEN","LokiContextUi","logContextProvider","updateFilter","origQuery","runContextQuery","contextFilters","setContextFilters","showPreservedFiltersAppliedNotification","setShowPreservedFiltersAppliedNotification","initialized","setInitialized","setLoading","setIsOpen","includePipelineOperations","setIncludePipelineOperations","SHOULD_INCLUDE_PIPELINE_OPERATIONS","timerHandle","previousInitialized","previousContextFilters","isInitialState","filter","enabled","nonIndexed","preservedLabels","LOKI_LOG_CONTEXT_PRESERVED_LABELS","initContextFilters","realLabels","realLabelsEnabled","parsedLabels","parsedLabelsEnabled","contextFilterToSelectFilter","contextFilter","showNonIndexedLabels","queryExpr","Alert","Collapse","RawQuery","Label","actionMeta","InlineFieldRow","RenderUserContentAsHTML","SortDirection","makeIndex","dir","fieldValues","nanos","isAsc","valA","valB","nanoA","nanoB","sortDataFrameByTime","timeField","sorted","vals","idx","LogContextProvider","cacheFilters","processResults","processedFrames","lastValueFrom","makeRequest","REF_ID_STARTER_LOG_ROW_CONTEXT","catchError","switchMap","of","expr","hasParser","nonIndexedLabels","parsedLabel","currentExpr","newExpr","origExpr","allNodePositions","pipelineStagePositions","position","otherNodePositions","pipelineStagePosition","preservedFiltersApplied","rowLabels","preservedLabelsString","arePreservedLabelsUsed","newContextFilters","limit","filters","contextTimeBuffer","queryDirection","FieldCache","tsValue","scopedVars","preparedExpression","labelNamesRegex","labelValuesRegex","migrateVariableQuery","rawQuery","queryBase","variableOptions","LokiVariableQueryEditor","onChange","setType","setLabel","labelOptions","setLabelOptions","setStream","previousType","variableQuery","labelNames","onQueryTypeChange","newType","onLabelChange","newLabel","onStreamChange","LokiVariableSupport","request","getDerivedFields","dataFrame","derivedFieldConfigs","derivedFieldsGrouped","newFields","fieldFromDerivedFieldConfig","labelFields","intersectingKey","logMatch","dataSourceSrv","dataLinks","derivedFieldConfig","dsSettings","queryType","makeTableFrames","instantMetricFrames","framesWithRefId","framesByRefId","frames","makeTableFrame","tableTimeField","tableValueField","allLabelNames","valueField","timeArray","valueArray","isMetricFrame","setFrameMeta","meta","oldMeta","newMeta","processStreamFrame","custom","derivedFields","processStreamsFrames","queryMap","processMetricInstantFrames","processMetricRangeFrames","groupFrames","streamsFrames","metricInstantFrames","metricRangeFrames","improveError","message","transformBackendResult","queries","dataFrames","executedExpr","executedQuery","queryTypeOptions","queryDirections","getQueryDirectionLabel","LokiOptionFields","lineLimitValue","onRunQuery","runOnBlur","onChangeQueryLimit","nextQuery","preprocessMaxLines","onMaxLinesChange","onReturnKeyDown","maxLines","MonacoQueryFieldLazy","MonacoQueryFieldWrapper","lastRunValueRef","handleRunQuery","LokiQueryField","override","prevProps","languageProvider","ExtraFieldElement","history","placeholder","LokiAnnotationsQueryEditor","annotation","onAnnotationChange","onChangeQuery","queryWithRefId","EditorRow","EditorField","getQueryHints","hints","queryWithParser","parserCount","hasPipelineErrorFiltering","hasLevel","levelLikeLabel","runShardSplitQuery","splitQueriesByStreamShard","splittingTargets","shouldStop","mergedResponse","subquerySubscription","retriesMap","retryTimer","runNextRequest","groups","nextGroupSize","shards","groupSize","cycle","retrying","done","nextRequest","nextGroup","groupHasPendingRequests","shardGroup","retry","errorResponse","debug","retries","targets","shardsToQuery","groupShardRequests","subRequest","partialResponse","constrainGroupSize","updateGroupSizeFromResponse","groupTargetsByQueryType","groupedRequests","shardedQueries","otherQueries","selectorPartition","selector","getInitialGroupSize","nextCycle","currentSize","metaExecutionTime","executionTime","DEBUG_ENABLED","getLiveStreamKey","msgUint8","hashBuffer","hashArray","doLokiChannelStream","ds","maxDelta","maxLength","updateFrame","StreamingDataFrame","defer","convertToWebSocketUrl","backend","DEFAULT_MAX_LINES","LOKI_ENDPOINT","REF_ID_DATA_SAMPLES","REF_ID_STARTER_ANNOTATION","REF_ID_STARTER_LOG_VOLUME","REF_ID_STARTER_LOG_SAMPLE","REF_ID_STARTER_STATS","requestId","hideFromInspector","intervalInfo","LokiDatasource","DataSourceWithBackend","instanceSettings","templateSrv","maxDataPoints","liveTarget","settingsData","logsVolumeOption","logsSampleOption","normalizedQuery","isQuerySuitable","dropErrorExpression","logsVolumeRequest","logsSampleRequest","q","scope","fixedRequest","streamQueries","streamRequest","merge","startTime","tap","logsQueries","subQueries","baseUrl","adhocFilters","expandedQueries","abstractQueries","existingKeys","abstractQuery","labelMatcher","statsForAll","durations","interpolatedVariableQuery","lokiLogsQuery","variable","lokiSpecialRegexEscape","lodash","expression","parserPositions","labelFilterPositions","lastPosition","instant","tagKeys","titleFormat","textFormat","annotations","splitKeys","isDataplaneLog","DataFrameView","maybeDuplicatedTags","tags","logLine","__auto","__interval","__interval_ms","__range","__range_s","__range_ms","variables","exprWithAdHoc","step","legendFormat","string","defaults","roundMsToMin","milliseconds","roundSecToMin","seconds","shouldRefreshLabels","prevRange","sameMinuteFrom","sameMinuteTo","RE2_METACHARACTERS","escapeLokiRegexp","escapeLabelValueInExactSelector","unescapeLabelValue","escapeLabelValueInRegexSelector","escapeLabelValueInSelector","isRegexSelector","isBytesString","BYTES_KEYWORDS","getLabelTypeFromFrame","labelKey","typeField","mapOpToAbstractOp","mapAbstractOperatorsToOp","abstractQueryToExpr","processLabels","valueSet","limitSuggestions","SUGGESTIONS_LIMIT","items","combineResponses","currentResponse","newResponse","cloneQueryResponse","currentFrame","shouldCombine","cloneDataFrame","mergeFrames","mergedErrors","mergedError","mergedTraceIds","replaceResponses","currentFrameIndex","dest","destTimeField","destIdField","sourceTimeField","sourceIdField","sourceTimeValues","totalFields","destIdx","resolveIdx","entryExistsInDest","compareEntries","sourceField","findSourceField","getCombinedMetadataStats","destField","destIndex","compareNsTimestamps","referenceField","sourceFields","candidates","candidate","TOTAL_BYTES_STAT","EXEC_TIME_STAT","destStats","sourceStats","destStat","sourceStat","eitherStat","frame1","frame2","frameType1","frameType2","field1","field2","customType1","customType2","__defProp","__defNormalProp","obj","__publicField","QueryModellerBase","operationDefinitions","innerQueryPlaceholder","Registry","categories","category","op","def","LokiQueryModeller","queryString","operations","operation","binaryQueries","binQuery","leftOperand","binaryQuery","nested","lokiQueryModeller","NodePosition","queryHasFilter","getMatchersWithFilter","removeLabelFromQuery","matchers","matcher","removeLabelFilter","removeSelector","pipelineStage","prefix","matchVisQuery","tree","labelNode","opNode","valueNode","addLabelToQuery","streamSelectorPositions","getStreamSelectorPositions","getParserPositions","getLabelFilterPositions","hasStreamSelectorMatchers","getMatcherInStreamPositions","labelFormatPositions","getIdentifierInStreamPositions","everyStreamSelectorHasMatcher","streamSelectorPosition","matcherPosition","toLabelFilter","lastPositionsPerExpression","getLastPositionPerExpression","addFilterAsLabelFilter","addFilterToStreamSelector","positions","subExpressions","findLeaves","subPositions","subExpression","findLastPosition","addParserToQuery","lineFilterPositions","getLineFiltersPositions","appendToLogsQuery","addDropToQuery","labelsToDrop","queryPartPositions","statement","newQuery","isLast","addNoPipelineErrorToQuery","addLabelFormatToQuery","labelFormat","logQueryPositions","getLogQueryPositions","addLabelFormat","removeCommentsFromQuery","lineCommentPositions","getLineCommentPositions","lineCommentPosition","parserNodeTypes","logPartsPositions","pipeline","unwrap","vectorSelectorPositions","labelExists","newLabels","positionsToAddAfter","labelFilter","addLineFilter","streamSelectorEnd","current","getAllPositionsInNodeByType","pos","splitTimeRange","endTime","idealRangeDuration","chunkEndTime","chunkStartTime","alignedDuration","alignedStartTime","partitionTimeRange","isLogsQuery","originalTimeRange","stepMs","duration","adjustTargetsFromResponseState","targetFrame","updatedMaxLines","runSplitGroupedQueries","requests","responseKey","totalRequests","partition","longestPartition","requestN","requestGroup","nextRequestN","nextRequestGroup","getNextRequestPointers","updateLoadingFrame","LOADING_FRAME_NAME","loadingFrame","querySupportsSplitting","runSplitQuery","nonSplittingQueries","normalQueries","logQueries","metricQueries","oneDayMs","directionPartitionedLogQueries","resolutionPartition","resolution","groupedRequest","stepMsPartition","calculateStep","intervalMs","interval_regex","newStep","safeStep","getHighlighterExpressionsFromQuery","input","getNodesFromQuery","pipeExact","pipeMatch","strings","getStringsFromLineFilter","filterTerm","backtickedTerm","unwrappedFilterTerm","resultTerm","getExpressionFromExecutedQuery","executedQueryString","getNormalizedLokiQuery","getLokiQueryType","tagsToObscure","partsToKeep","obfuscate","obfuscatedQuery","name","queryPart","parseToNodeNamesArray","queryParts","isQueryWithNode","nodeType","nodeTypes","getNodePositionsFromQuery","getNodeFromQuery","isQueryWithError","isQueryWithParser","getParserFromQuery","parsers","isQueryPipelineErrorFiltering","isQueryWithLabelFormat","getLogQueryFromMetricsQuery","selectorNode","pipelineExprNode","pipelineExpr","getLogQueryFromMetricsQueryAtPosition","metricQuery","isQueryWithLabelFilter","isQueryWithLineFilter","isQueryWithRangeVariable","rangeNodes","getStreamSelectorsFromQuery","requestSupportsSplitting","allQueries","requestSupportsSharding","metricSupportsSharding","vectorOps","supportedVectorOps","getNodeString","unsupportedVectorOps","supportedWrappingVectorOpps","supportedOp","unsupportedOp","rangeOps","supportedRangeOps","isLokiQuery","getLokiQueryFromDataQuery","interpolateShardingSelector","shardValue","addStreamShardLabelsToQuery","shardedQuery","getSelectorForShardValues","binaryScalarDefs","binaryScalarOperations","opDef","defaultParams","getSimpleBinaryRenderer","model","innerExpr","bool","LabelParamEditor","operationId","queryModeller","setState","getOperationParamId","loadGroupByLabels","toOption","createRangeOperation","isRangeOperationWithGrouping","getRangeVectorParamDef","paramChangedHandler","getOnLabelAddedHandler","getLokiOperationDisplayName","operationWithRangeVectorRenderer","addLokiOperation","opDocs","createRangeOperationWithGrouping","rangeOperation","getRangeAggregationWithGroupingRenderer","getLastLabelRemovedHandler","getAggregationExplainer","aggregation","grouping","restParamIndex","restParams","rangeVector","quantile","labelFilterRenderer","isConflictingFilter","queryOperations","operationIsNegative","queryOperation","pipelineRenderer","strict","keepEmpty","isRangeVectorFunction","getIndexOfOrLast","condition","modeller","newOperation","existingRangeVectorFunction","placeToInsert","addNestedQueryHandler","getLineFilterRenderer","caseInsensitive","hasBackticks","delimiter","paramIndex","changeToOperationId","aggregationName","labelWord","funcName","defaultAddOperationHandler","createAggregationOperation","overrides","functionRendererLeft","getAggregationByRenderer","getAggregationWithoutRenderer","renderParams","createAggregationOperationWithParam","paramsDef","getAggregationByRendererWithParameter","UnwrapParamEditor","loadUnwrapOptions","logExpr","samples","getOperationDefinitions","aggregations","opId","aggregationsWithParam","rangeOperations","rangeOperationsWithGrouping","explainOperator","getDefinitionById","checkParamsAreValid","buildVisualQueryFromString","replacedExpr","handleExpression","isEmptyQuery","visQuery","getLabel","getLineFilter","createNotSupportedError","getLabelParser","getLabelFilter","getJsonExpressionParser","getLogfmtParser","getLineFormat","getLabelFormat","handleUnwrapExpr","getDecolorize","handleRangeAggregation","handleVectorAggregation","handleBinary","isIntervalVariableError","handleDropFilter","handleKeepFilter","filterExpr","handleQuotes","orFilter","parserNode","subNode","ipLabelFilter","valueString","renameTo","originalLabel","unwrapExprChild","labelFilterChild","unwrapChild","convOp","identifier","nameNode","number","rangeValue","numberNode","metricExpr","operatorToOpName","left","binModifier","getBinaryModifier","right","leftNumber","getLastChildWithSelector","rightNumber","rightBinary","leftMostChild","boolMatcher","exploringNode","ErrorId","getLeftMostChild","cur","makeError","getString","variableRegex","replaceVariables","var1","var2","fmt2","var3","fieldPath","fmt3","fmt","varType","varTypeFunc","returnVariables","makeBinOp","hasBool","getAllByType","regexifyLabelValuesQueryString","LokiQueryPatternType","LokiVisualQueryOperationCategory","LokiOperationId","LokiOperationOrder","lokiOperators","isLogLineJSON","parsed","LOGFMT_REGEXP","isLogLineLogfmt","isLogLinePacked","dataFrameHasLokiError","dataFrameHasLevelLabel","extractLogParserFromDataFrame","extractLabelKeysFromDataFrame","labelsArray","labelTypeArray","labelsSet","labelsType","allLabelKeys","extractUnwrapLabelKeysFromDataFrame","extractHasErrorLabelFromDataFrame","labelField","extractLevelLikeLabelFromDataFrame","isRetriableError","onDashboardLoadedHandler","dashboardId","orgId","grafanaVersion","lokiQueries","instantQueries","rangeQueries","builderModeQueries","codeModeQueries","queriesWithTemplateVariables","isQueryWithTemplateVariables","queriesWithChangedResolution","isQueryWithChangedResolution","queriesWithChangedLineLimit","isQueryWithChangedLineLimit","queriesWithChangedLegend","isQueryWithChangedLegend","shouldNotReportBasedOnRefId","starter","calculateTotalBytes","totalBytes","byteKey","trackQuery","extraPayload","trackGroupedQueries","originalRequest","splittingPayload","split_query_partition_size","observableFactory","Json$1","Logfmt$1","Unpack$1","Pattern$1","Regexp$1","Unwrap$1","LabelFormat$1","LineFormat$1","LabelReplace$1","Vector$1","Offset$1","Bool$1","On$1","Ignoring$1","GroupLeft$1","GroupRight$1","Decolorize$1","Drop$1","Keep$1","By$1","Without$1","And$1","Or$1","Unless$1","Sum$1","Avg$1","Count$1","Max$1","Min$1","Stddev$1","Stdvar$1","Bottomk$1","Topk$1","Sort$1","Sort_Desc$1","keywordTokens","specializeIdentifier","contextualKeywordTokens","extendIdentifier","spec_Identifier","stack","Json","Logfmt","Unpack","Pattern","Regexp","Unwrap","LabelFormat","LineFormat","LabelReplace","Vector","Offset","Bool","On","Ignoring","GroupLeft","GroupRight","Decolorize","Drop","Keep","By","Without","And","Or","Unless","Sum","Avg","Count","Max","Min","Stddev","Stdvar","Bottomk","Topk","Sort","Sort_Desc","LineComment","LogQL","Expr","LogExpr","Selector","Matchers","Matcher","Identifier","Eq","String","Neq","Re","Nre","PipelineExpr","PipelineStage","LineFilters","LineFilter","Filter","PipeExact","PipeMatch","PipePattern","Npa","FilterOp","Ip","OrFilter","Pipe","LogfmtParser","LogfmtParserFlags","ParserFlag","LabelParser","JsonExpressionParser","LabelExtractionExpressionList","LabelExtractionExpression","LogfmtExpressionParser","LabelFilter","IpLabelFilter","UnitFilter","DurationFilter","Gtr","Duration","Gte","Lss","Lte","Eql","BytesFilter","Bytes","NumberFilter","LiteralExpr","Number","Add","Sub","LineFormatExpr","LabelFormatExpr","LabelsFormat","LabelFormatMatcher","DecolorizeExpr","DropLabelsExpr","DropLabels","DropLabel","KeepLabelsExpr","KeepLabels","KeepLabel","MetricExpr","RangeAggregationExpr","RangeOp","CountOverTime","Rate","RateCounter","BytesOverTime","BytesRate","AvgOverTime","SumOverTime","MinOverTime","MaxOverTime","StddevOverTime","StdvarOverTime","QuantileOverTime","FirstOverTime","LastOverTime","AbsentOverTime","LogRangeExpr","Range","OffsetExpr","UnwrapExpr","ConvOp","BytesConv","DurationConv","DurationSecondsConv","Grouping","Labels","VectorAggregationExpr","VectorOp","BinOpExpr","BinOpModifier","OnOrIgnoringModifier","GroupingLabels","GroupingLabelList","GroupingLabel","LabelName","Mul","Div","Mod","Pow","LabelReplaceExpr","VectorExpr","EditorStack","wrapItems","_b","language","highlighted","QueryEditorMode","QueryEditorMode2","BINARY_OPERATIONS_KEY"],"sourceRoot":""}