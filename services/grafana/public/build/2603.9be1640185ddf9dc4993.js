"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2603,8638],{21819:(ye,W,o)=>{o.r(W),o.d(W,{DashboardScenePage:()=>pe,default:()=>qe});var e=o(74848),w=o(96540),A=o(54148),M=o(84596),G=o(75683),U=o(36490),k=o(36674),H=o(31286),p=o(13791),m=o(11098),R=o(99362),Q=o(6262),X=o(22803),b=o(92745),y=o(8515),j=o(63142),ie=o(22787),E=o(45861),J=o(83560),oe=o(15130),ve=o(17732),Le=o(8285);const je=(0,w.memo)(({dashboard:D})=>{const z=(0,w.useMemo)(()=>U.Ny.getLocation().pathname,[D]),{showModal:se,hideModal:r}=(0,w.useContext)(y.wE);(0,w.useEffect)(()=>{const V=I=>{L(D)||D.state.isDirty&&(I.preventDefault(),I.returnValue="")};return window.addEventListener("beforeunload",V),()=>window.removeEventListener("beforeunload",V)},[D]);const F=V=>{const I=D.state.editPanel,x=I?.getPanel(),Se=new URLSearchParams(V.search);if(I&&x&&(0,Le.ME)(x)&&I.state.isDirty&&!Se.has("editPanel")){const re=(0,Le.iL)(x);return se(ve.Z,{dashboard:D,isUnsavedPrompt:!0,libraryPanel:re,onConfirm:()=>{I.onConfirmSaveLibraryPanel(),r(),le(V)},onDiscard:()=>{I.onDiscard(),r(),le(V)},onDismiss:r}),!1}return z===V.pathname||L(D)||!D.state.isDirty?!0:(se(te,{dashboard:D,onSaveDashboardClick:()=>{r(),D.openSaveDrawer({onSaveSuccess:()=>{le(V)}})},onDiscard:()=>{D.exitEditMode({skipConfirm:!0}),r(),le(V)},onDismiss:r}),!1)};return(0,e.jsx)(J.X,{when:!0,message:F})});je.displayName="DashboardPrompt";function le(D){D&&setTimeout(()=>U.Ny.push(D),10)}const te=({onDiscard:D,onDismiss:z,onSaveDashboardClick:se})=>{const r=(0,j.of)(Te);return(0,e.jsxs)(ie.a,{isOpen:!0,title:(0,b.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:z,icon:"exclamation-triangle",className:r.modal,children:[(0,e.jsx)("h5",{children:(0,e.jsx)(b.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(ie.a.ButtonRow,{children:[(0,e.jsx)(E.$n,{variant:"secondary",onClick:z,fill:"outline",children:(0,e.jsx)(b.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(E.$n,{variant:"destructive",onClick:D,children:(0,e.jsx)(b.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(E.$n,{onClick:se,children:(0,e.jsx)(b.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},Te=()=>({modal:(0,X.css)({width:"500px"})});function L(D){if(!D?.getInitialSaveModel()||D?.state.meta.version===0||!oe.TP.isSignedIn||!D)return!0;const{canSave:se,fromScript:r,fromFile:F}=D.state.meta;return!oe.TP.isEditor&&!se?!0:!se||r||F}var Ze=o(94786),Xe=o(17788),ue=o(41644);function pe({route:D,queryParams:z,location:se}){const r=(0,A.g)(),{type:F,slug:V,uid:I}=r,x=r["*"],Se=(0,M.A)({params:r}),re=(0,ue.sP)(),{dashboard:ge,isLoading:Ae,loadError:q}=re.useState(),Ve=se.state?.routeReloadCounter,be=(0,w.useRef)(r);if((0,w.useEffect)(()=>(D.routeName===Q.Z4.Normal&&F==="snapshot"?re.loadSnapshot(V):re.loadDashboard({uid:(D.routeName===Q.Z4.Provisioning?x:I)??"",type:F,slug:V,route:D.routeName,urlFolderUid:z.folderUid}),()=>{(0,Xe.zf)(U.Ny.getSearch(),I),re.clearState(),re.resetActiveManager()}),[re,I,D.routeName,z.folderUid,Ve,F]),(0,w.useEffect)(()=>{if(D.routeName===Q.Z4.Normal&&I===be.current.uid&&be.current.slug&&!V){const fe=`/d/${I}/${be.current.slug}`;U.Ny.replace({...U.Ny.getLocation(),pathname:fe})}return()=>{be.current={uid:I,slug:V||be.current.slug}}},[D,V,F,I]),!ge){let fe;return q&&(fe=(0,e.jsx)(R.i,{error:q,type:F})),fe||(0,e.jsx)(p.Y,{navId:"dashboards/browse",layout:G.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,e.jsx)(H.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:Ae&&(0,e.jsx)(m.A,{})})})}return F!=="snapshot"&&(!Se||I!==Se?.params.uid)?(console.log("skipping rendering"),null):(0,e.jsxs)(k.$L,{scene:ge,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,e.jsx)(Ze.h,{queryParams:z,route:D.routeName,slug:V,path:x}),(0,e.jsx)(ge.Component,{model:ge},ge.state.key),(0,e.jsx)(je,{dashboard:ge})]})}const qe=pe},94786:(ye,W,o)=>{o.d(W,{h:()=>R,s:()=>p});var e=o(74848),w=o(92745),A=o(43173),M=o(34999),G=o(33680),U=o(96727),k=o(6262),H=o(55001);const p={severity:"info",style:{flex:0}};function m({queryParams:Q,slug:X,path:b}){const{prURL:y}=(0,U.H)(),j=(0,G.Kw)({name:X,path:b,ref:Q.ref});if(j.data?.errors)return(0,e.jsx)(M.F,{title:(0,w.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:j.data.errors.map((E,J)=>(0,e.jsx)("div",{children:E},J))});if(y?.length)return(0,e.jsx)(H.G,{prParam:y});const ie=j.data?.urls?.newPullRequestURL??j.data?.urls?.compareURL;return ie?(0,e.jsx)(H.G,{prParam:ie,isNewPr:!0}):(0,e.jsx)(M.F,{...p,title:(0,w.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(w.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function R({queryParams:Q,route:X,slug:b,path:y}){return!A.$.featureToggles.provisioning||"kiosk"in Q||!y||X!==k.Z4.Provisioning||!b?null:(0,e.jsx)(m,{queryParams:Q,slug:b,path:y})}},55001:(ye,W,o)=>{o.d(W,{G:()=>H});var e=o(74848),w=o(63704),A=o(92745),M=o(34999),G=o(41654),U=o(30703),k=o(94786);function H({prParam:p,isNewPr:m}){const R=m?(0,A.t)("provisioned-resource-preview-banner.title-created-branch-git-hub","A new resource has been created in a branch in GitHub."):(0,A.t)("provisioned-resource-preview-banner.title-loaded-pull-request-git-hub","This resource is loaded from a pull request in GitHub.");return(0,e.jsx)(M.F,{...k.s,title:R,buttonContent:(0,e.jsxs)(G.B,{alignItems:"center",children:[m?(0,A.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-git-hub","Open pull request in GitHub"):(0,A.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-git-hub","View pull request in GitHub"),(0,e.jsx)(U.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(w.sQ.sanitizeUrl(p),"_blank"),children:(0,e.jsx)(A.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The value is not yet saved in the Grafana database"})})}},99362:(ye,W,o)=>{o.d(W,{i:()=>p});var e=o(74848),w=o(75683),A=o(92745),M=o(31286),G=o(34999),U=o(13791),k=o(1506),H=o(47797);function p({error:m,type:R}){const Q=(0,H.do)(m),X=(0,H.q6)(m),b=R==="snapshot"?"Snapshot":"Dashboard";return(0,e.jsx)(U.Y,{navId:"dashboards/browse",layout:w.k.Canvas,pageNav:{text:(0,A.t)("dashboard.dashboard-page-error.text.not-found","Not found")},children:(0,e.jsx)(M.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:Q===404?(0,e.jsx)(k.L,{entity:b}):(0,e.jsx)(G.F,{title:(0,A.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:X})})})}},92603:(ye,W,o)=>{o.r(W),o.d(W,{default:()=>Eo});var e=o(74848),w=o(54148),A=o(16817),M=o(43173),G=o(21819),U=o(41644),k=o(6262),H=o(60171),p=o(22803),m=o(96540),R=o(71468),Q=o(75683),X=o(92138),b=o(51898),y=o(36490),j=o(63142),ie=o(6890),E=o(13791),J=o(27963),oe=o(64762);function ve(t){switch(t.kiosk){case"1":case!0:return k.d9.Full;default:return null}}var Le=o(38206),je=o(84057),le=o(79718),te=o(87745),Te=o(39167),L=o(99305),Ze=o(25157),Xe=o(46505),ue=o(2543),pe=o(8515),qe=o(45229),D=o(83560),z=o(15130),se=o(40996),r=o(92745),F=o(22787),V=o(63527),I=o(30703),x=o(45861),Se=o(30124),re=o(37666),ge=o(12048);const Ae=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:s,onConfirm:i,onDiscard:l})=>{const[d,c]=(0,m.useState)(""),h=(0,A.A)(async()=>{const S=await(0,Se.xV)(t.libraryPanel.uid);return S.length>0?S.map(Z=>Z.title):[]},[t.libraryPanel.uid]),[u,g]=(0,m.useState)([]);(0,se.A)(()=>h.value?g(h.value.filter(S=>S.toLowerCase().includes(d.toLowerCase()))):g([]),300,[h.value,d]);const{saveLibraryPanel:v}=(0,ge.b)(),f=(0,j.of)(re.o),N=(0,m.useCallback)(()=>{l()},[l]),C=a?"Unsaved library panel changes":"Save library panel";return(0,e.jsx)(F.a,{title:C,icon:"save",onDismiss:s,isOpen:!0,children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{className:f.textInfo,children:[(0,e.jsxs)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.num-affected",count:t.libraryPanel.meta?.connectedDashboards,children:["This update will affect ",(0,e.jsxs)("strong",{children:["{{count}}"," dashboards."]})]}),(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.affected-dashboards",children:"The following dashboards using the panel will be affected:"})]}),(0,e.jsx)(V.p,{className:f.dashboardSearch,prefix:(0,e.jsx)(I.I,{name:"search"}),placeholder:(0,r.t)("library-panels.save-library-panel-modal.placeholder-search-affected-dashboards","Search affected dashboards"),value:d,onChange:S=>c(S.currentTarget.value)}),h.loading?(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.loading-connected-dashboards",children:"Loading connected dashboards..."})}):(0,e.jsxs)("table",{className:f.myTable,children:[(0,e.jsx)("thead",{children:(0,e.jsx)("tr",{children:(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.dashboard-name",children:"Dashboard name"})})})}),(0,e.jsx)("tbody",{children:u.map((S,Z)=>(0,e.jsx)("tr",{children:(0,e.jsx)("td",{children:S})},`dashrow-${Z}`))})]}),(0,e.jsxs)(F.a.ButtonRow,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.cancel",children:"Cancel"})}),a&&(0,e.jsx)(x.$n,{variant:"destructive",onClick:N,children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.discard",children:"Discard"})}),(0,e.jsx)(x.$n,{onClick:()=>{v(t,n).then(()=>{i()})},children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.save-library-panel-modal.update-all",children:"Update all"})})]})]})})};var q=o(52763),Ve=o(7817),be=o(29043),fe=o(17097),_e=o(87390),Dt=o(89224),de=o(42795);function Cn(t,n){return async a=>{const s=n.initEditPanel(t);a((0,de.GU)({panel:s,sourcePanel:t}))}}function Tt(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,de.MJ)(!0))}}function Dn(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const s=t.getSaveModel();for(const i of n.panels){if(Tn(t,i))continue;i.restoreModel({...s,...(0,ue.pick)(i,"gridPos","id")});const l=i.plugin?.meta.id!==t.plugin?.meta.id;i.plugin=t.plugin,i.configRev++,l&&(i.generateNewKey(),a((0,Dt.XM)({key:i.key,plugin:i.plugin}))),setTimeout(()=>{i.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function Tn(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function En(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:s,getSourcePanel:i,shouldDiscardChanges:l}=n().panelEditor,d=s();a&&a.exitPanelEditor();const c=i();if(Nn(d)&&!l){const h=d.getSaveModel(),u=c.type!==d.type;t(Dn(d,a)),c.restoreModel(h),c.configRev++,u&&(c.plugin=d.plugin,c.generateNewKey(),await t((0,Dt.XM)({key:c.key,plugin:d.plugin}))),setTimeout(()=>{c.getQueryRunner().useLastResultFrom(d.getQueryRunner()),c.render(),d.hasSavedPanelEditChange&&!d.hasChanged&&(c.configRev=0)},20)}c.isNew&&(l?a&&(0,fe.FC)(a,c,!0):delete c.isNew),t((0,_e.O6)(d.key)),t((0,de.Ox)())}}function Nn(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function et(t){return(n,a)=>{const s={...a().panelEditor.ui,...t};n((0,de.fR)(s));try{be.A.setObject(de.wi,s)}catch(i){console.error(i)}}}var tt=o(78159);const Mn=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:s})=>(0,e.jsxs)(F.a,{isOpen:!0,title:(0,r.t)("dashboard.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:s,icon:"exclamation-triangle",className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(F.a.ButtonRow,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(x.$n,{variant:"destructive",onClick:a,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(tt.C,{dashboard:t,onSaveSuccess:n})]})]}),Et=(0,m.memo)(({dashboard:t})=>{const[n,a]=(0,m.useState)({original:null}),s=(0,q.wA)(),{original:i,originalPath:l}=n,{showModal:d,hideModal:c}=(0,m.useContext)(pe.wE);(0,m.useEffect)(()=>{const u=setTimeout(()=>{const v=y.Ny.getLocation().pathname,f=t.getSaveModelCloneOld();a({originalPath:v,original:f})},1e3),g=qe.l.subscribe(te.Eu,()=>{const v=t.getSaveModelCloneOld();a({originalPath:l,original:v})});return()=>{clearTimeout(u),g.unsubscribe()}},[t,l]),(0,m.useEffect)(()=>{const u=g=>{Nt(t,i)||It(t,i)&&(g.preventDefault(),g.returnValue="")};return window.addEventListener("beforeunload",u),()=>window.removeEventListener("beforeunload",u)},[t,i]);const h=u=>{const g=t.panelInEdit,v=new URLSearchParams(u.search);return g&&g.libraryPanel&&g.hasChanged&&!v.has("editPanel")?(d(Ae,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{c(),Oe(u)},onDiscard:()=>{s(Tt()),Oe(u),c()},onDismiss:c}),!1):l===u.pathname||!i?(g&&!v.has("editPanel")&&s(En()),!0):Nt(t,i)||!It(t,i)?!0:(d(Mn,{dashboard:t,onSaveSuccess:()=>{c(),Oe(u)},onDiscard:()=>{a({...n,original:null}),c(),Oe(u)},onDismiss:c}),!1)};return(0,e.jsx)(D.X,{when:!0,message:h})});Et.displayName="DashboardPrompt";function Oe(t){t&&setTimeout(()=>y.Ny.push(t),10)}function Nt(t,n){if(!n||n.version===0||!z.TP.isSignedIn||!t)return!0;const{canSave:a,fromScript:s,fromFile:i}=t.meta;return!z.TP.isEditor&&!a?!0:!a||s||i}function Mt(t){const n=new Ve.G(t);n.expandRows();const a=n.getSaveModelClone();if(delete a.time,delete a.refresh,a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function It(t,n){if(t.hasUnsavedChanges())return!0;const a=Mt(t.getSaveModelCloneOld()),s=Mt(n),i=(0,ue.find)(a.nav,{type:"timepicker"}),l=(0,ue.find)(s.nav,{type:"timepicker"});i&&l&&(i.now=l.now);const d=JSON.stringify(a,null),c=JSON.stringify(s,null);return d!==c}var wt=o(36219),K=o(41654),Re=o(66404),Lt=o(43707),nt=o(11257),At=o(14644),ce=o(27489),at=o(74475),me=o(32881),st=o(68079),Be=o(45967),Pe=o(76319),it=o(27690);const In=({id:t,usages:n})=>{const a=(0,m.useMemo)(()=>n.find(i=>i.variable.id===t),[t,n]);if(!a)return null;const s=a.nodes.map(i=>i.label.includes(`$${t}`)?{...i,color:"#FB7E81"}:i);return(0,e.jsx)(it.i,{show:!1,title:(0,r.t)("variables.variables-unknown-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:s,edges:a.edges,children:({showModal:i})=>(0,e.jsx)(Pe.K,{onClick:()=>i(),name:"code-branch",tooltip:(0,r.t)("variables.variables-unknown-button.VariablesUnknownButton-tooltip-show-usages","Show usages"),"data-testid":"VariablesUnknownButton"})})};var xe=o(47969);const wn=1e3;function Ln({variables:t,dashboard:n}){const[a,s]=(0,m.useState)(!1),[i,l]=(0,m.useState)(0),[d,c]=(0,m.useState)([]),h=(0,j.of)(ot);(0,m.useEffect)(()=>l(v=>v+1),[t,n]);const{loading:u}=(0,A.A)(async()=>{if(a&&i>0){const v=Date.now(),f=await(0,xe.g0)(t,n),C=Date.now()-v;return C>=wn&&(0,ce.rR)("Slow unknown variables expansion",{elapsed:C}),l(0),c(f),f}return[]},[t,n,a,i]),g=v=>{v&&(0,ce.rR)("Unknown variables section expanded"),s(v)};return(0,e.jsx)("div",{className:h.container,children:(0,e.jsxs)(at.M,{label:(0,e.jsx)(An,{}),isOpen:a,onToggle:g,children:[u&&(0,e.jsx)(me.gW,{justify:"center",children:(0,e.jsxs)(me.Gy,{justify:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variables-unknown-table.loading",children:"Loading..."})}),(0,e.jsx)(st.y,{})]})}),!u&&d&&(0,e.jsxs)(e.Fragment,{children:[d.length===0&&(0,e.jsx)(Vn,{}),d.length>0&&(0,e.jsx)(On,{usages:d})]})]})})}function An(){const t=(0,j.of)(ot);return(0,e.jsxs)("h5",{children:[(0,e.jsx)(r.x6,{i18nKey:"variables.variables-unknown-table.collapse-label",children:"Renamed or missing variables"}),(0,e.jsx)(Be.m,{content:(0,r.t)("variables.variables-unknown-table.collapse-tooltip","Click to expand a list with all variable references that have been renamed or are missing from the dashboard."),children:(0,e.jsx)(I.I,{name:"info-circle",className:t.infoIcon})})]})}function Vn(){return(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.no-unknowns.no-renamed-or-missing-variables-found",children:"No renamed or missing variables found."})})}function On({usages:t}){const n=(0,j.of)(ot);return(0,e.jsxs)("table",{className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.unknown-table.variable",children:"Variable"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)("tbody",{children:t.map(a=>{const{variable:s}=a,{id:i,name:l}=s;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:n.firstColumn,children:(0,e.jsx)("span",{children:l})}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.lastColumn,children:(0,e.jsx)(In,{id:s.id,usages:t})})]},i)})})]})}const ot=t=>({container:(0,p.css)({marginTop:t.spacing(4),paddingTop:t.spacing(4)}),infoIcon:(0,p.css)({marginLeft:t.spacing(1)}),defaultColumn:(0,p.css)({width:"1%"}),firstColumn:(0,p.css)({width:"1%",verticalAlign:"top",color:t.colors.text.maxContrast}),lastColumn:(0,p.css)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",textAlign:"right"})});var Y=o(74887),ee=o(93612),he=o(88681),rt=o(71599);function Vt({varName:t,isOpen:n=!1,onConfirm:a,onDismiss:s}){return(0,e.jsx)(rt.u,{title:(0,r.t)("variables.confirm-delete-modal.title-delete-variable","Delete variable"),isOpen:n,onConfirm:a,onDismiss:s,body:(0,r.t)("variables.confirm-delete-modal.body-delete-variable",'Are you sure you want to delete variable "{{variableToDelete}}"?',{variableToDelete:t}),modalClass:Rn.modal,confirmText:(0,r.t)("variables.confirm-delete-modal.confirmText-delete","Delete")})}const Rn={modal:(0,p.css)({width:"max-content",maxWidth:"80vw"})};var Ue=o(28105),Bn=o(29),Un=o(32442),Kn=o(25379),Ot=o(49602),zn=o(18387),lt=o(54742),dt=o(67933),Fn=o(68577);function $n({onChange:t,type:n}){const a=(0,m.useMemo)(()=>(0,L.AX)(),[]),s=(0,m.useMemo)(()=>a.find(i=>i.value===n)??a[0],[a,n]);return(0,e.jsx)(Fn.v,{name:(0,r.t)("variables.variable-type-select.name-select-variable-type","Select variable type"),value:s,options:a,onChange:t,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalTypeSelectV2})}var Wn=o(99703),Ee=o(17752);const Gn=t=>async n=>{const{rootStateKey:a}=t;n((0,Y.kb)(a,(0,Ee.sJ)({name:(0,ee.dn)(t).name,id:t.id})))},kn=t=>async(n,a)=>{const{rootStateKey:s}=t;n((0,Y.kb)(s,(0,Ee.T7)((0,L.qD)(t))))},Hn=(t,n)=>(a,s)=>{const{id:i,rootStateKey:l}=t;let d=null;if(n.match(/^(?!__).*$/)||(d="Template names cannot begin with '__', that's reserved for Grafana's global variables"),n.match(/^\w+$/)||(d="Only word characters are allowed in variable names"),(0,ee.SS)(l,s()).filter(u=>u.name===n&&u.id!==i).length&&(d="Variable with the same name already exists"),d){a((0,Y.kb)(l,(0,Ee.DW)({newName:n,errorText:d})));return}a(Qn(t,n))},Qn=(t,n)=>(a,s)=>{const{rootStateKey:i}=t,l=(0,ee.dn)(t,s());if(l.name===n){a((0,Y.kb)(i,(0,Ee.FN)((0,L.qD)(t,{newName:n}))));return}const d={...(0,ue.cloneDeep)(l),name:n,id:n},c=l.global,h=l.index,u=(0,L.jX)(d);a((0,Y.kb)(i,(0,he.QV)((0,L.qD)(u,{global:c,index:h,model:d})))),a((0,Y.kb)(i,(0,Ee.FN)((0,L.qD)(u,{newName:n})))),a((0,Y.kb)(i,(0,he.Hr)((0,L.qD)(t,{reIndex:!1}))))},Jn=(t,n="query")=>(a,s)=>{const i=(0,L.q4)(t),l=(0,ee.SS)(i,s()),d=Zn(n,l),c={type:n,id:d},h=!1,u=(0,ee.hk)(i,s()),g=(0,ue.cloneDeep)(lt.B.get(n).initialState);g.id=d,g.name=d,g.rootStateKey=i,a((0,Y.kb)(i,(0,he.QV)((0,L.qD)(c,{global:h,model:g,index:u})))),y.Ny.partial({editIndex:l.length})},Yn=t=>(n,a)=>{const s=(0,L.q4)(t),i=a(),l=(0,ee.nS)(s,i),d=i.dashboard.getModel(),{usages:c}=(0,xe.hM)(l,d),h=(0,xe.Ow)(c);n((0,Y.kb)(s,(0,Wn.bX)({usages:c,usagesNetwork:h})))};function Zn(t,n){let a=0,s=`${t}${a}`;for(;n.find(i=>i.id===s);)s=`${t}${++a}`;return s}var Xn=o(73829);const qn=(t,n)=>({editor:(0,ee.nx)(n.identifier.rootStateKey,t).editor,variable:(0,ee.dn)(n.identifier,t)}),_n=t=>({...(0,At.bindActionCreators)({variableEditorMount:Gn,variableEditorUnMount:kn,changeVariableName:Hn,updateOptions:Te.mZ},t),changeVariableProp:(n,a,s)=>t((0,Y.kb)(n.rootStateKey,(0,he.QP)((0,L.qD)(n,{propName:a,propValue:s})))),changeVariableType:(n,a)=>t((0,Y.kb)(n.rootStateKey,(0,he.l_)((0,L.qD)(n,{newType:a})))),removeVariable:n=>{t((0,Y.kb)(n.rootStateKey,(0,he.Hr)((0,L.qD)(n,{reIndex:!0}))))}}),ea=(0,R.connect)(qn,_n);class ta extends m.PureComponent{constructor(){super(...arguments),this.state={showDeleteModal:!1},this.onNameChange=n=>{n.preventDefault(),this.props.changeVariableName(this.props.identifier,n.currentTarget.value)},this.onTypeChange=n=>{n.value&&this.props.changeVariableType(this.props.identifier,n.value)},this.onLabelChange=n=>{n.preventDefault(),this.props.changeVariableProp(this.props.identifier,"label",n.currentTarget.value)},this.onDescriptionChange=n=>{this.props.changeVariableProp(this.props.identifier,"description",n.currentTarget.value)},this.onHideChange=n=>{this.props.changeVariableProp(this.props.identifier,"hide",n)},this.onPropChanged=({propName:n,propValue:a,updateOptions:s=!1})=>{this.props.changeVariableProp(this.props.identifier,n,a),s&&this.props.updateOptions((0,L.jX)(this.props.variable))},this.onHandleSubmit=async n=>{n.preventDefault(),this.props.editor.isValid&&this.props.updateOptions((0,L.jX)(this.props.variable))},this.onModalOpen=()=>{this.setState({showDeleteModal:!0})},this.onModalClose=()=>{this.setState({showDeleteModal:!1})},this.onDelete=()=>{this.props.removeVariable(this.props.identifier),this.onModalClose(),y.Ny.partial({editIndex:null})},this.onApply=()=>{y.Ny.partial({editIndex:null})},this.getVariableOptions=()=>{const{variable:n}=this.props;return(0,dt.SP)(n)?n.options.map(a=>({label:String(a.text),value:String(a.value)})):[]}}componentDidMount(){this.props.variableEditorMount(this.props.identifier)}componentWillUnmount(){this.props.variableEditorUnMount(this.props.identifier)}render(){const{theme:n,variable:a}=this.props,s=lt.B.get(this.props.variable.type).editor;if(!s)return null;const i=a.state===Ue.Gu.Loading,l=window.matchMedia("(prefers-reduced-motion: reduce)").matches,d=sa(n);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("form",{"aria-label":(0,r.t)("variables.variable-editor-editor-un-connected.aria-label-variable-editor-form","Variable editor Form"),onSubmit:this.onHandleSubmit,children:[(0,e.jsx)($n,{onChange:this.onTypeChange,type:this.props.variable.type}),(0,e.jsx)(Un.Y,{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.general",children:"General"})}),(0,e.jsx)(Ot._,{value:this.props.editor.name,onChange:this.onNameChange,name:(0,r.t)("variables.variable-editor-editor-un-connected.name-name","Name"),placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-variable-name","Variable name"),description:(0,r.t)("variables.variable-editor-editor-un-connected.description-template-variable-characters","The name of the template variable. (Max. 50 characters)"),invalid:!!this.props.editor.errors.name,error:this.props.editor.errors.name,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalNameInputV2,maxLength:Xn.M.MaxSize,required:!0}),(0,e.jsx)(Ot._,{name:(0,r.t)("variables.variable-editor-editor-un-connected.name-label","Label"),description:(0,r.t)("variables.variable-editor-editor-un-connected.description-optional-display-name","Optional display name"),value:this.props.variable.label??"",placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-label-name","Label name"),onChange:this.onLabelChange,testId:b.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalLabelInputV2}),(0,e.jsx)(Kn.Z,{name:(0,r.t)("variables.variable-editor-un-connected.name-description","Description"),value:a.description??"",placeholder:(0,r.t)("variables.variable-editor-editor-un-connected.placeholder-descriptive-text","Descriptive text"),onChange:this.onDescriptionChange,width:52}),(0,e.jsx)(Bn.D,{onChange:this.onHideChange,hide:this.props.variable.hide,type:this.props.variable.type}),s&&(0,e.jsx)(s,{variable:this.props.variable,onPropChange:this.onPropChanged}),(0,dt.SP)(this.props.variable)?(0,e.jsx)(zn.j,{options:this.getVariableOptions()}):null,(0,e.jsx)("div",{style:{marginTop:"16px"},children:(0,e.jsxs)(me.Gy,{spacing:"md",height:"inherit",children:[(0,e.jsx)(x.$n,{variant:"destructive",fill:"outline",onClick:this.onModalOpen,children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.delete",children:"Delete"})}),(0,e.jsxs)(x.$n,{type:"submit","data-testid":b.Tp.pages.Dashboard.Settings.Variables.Edit.General.submitButton,disabled:i,variant:"secondary",children:[(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.run-query",children:"Run query"}),i&&(0,e.jsx)(I.I,{className:d.spin,name:l?"hourglass":"sync",size:"sm",style:{marginLeft:"2px"}})]}),(0,e.jsx)(x.$n,{variant:"primary",onClick:this.onApply,"data-testid":b.Tp.pages.Dashboard.Settings.Variables.Edit.General.applyButton,children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-editor-un-connected.apply",children:"Apply"})})]})})]}),(0,e.jsx)(Vt,{isOpen:this.state.showDeleteModal,varName:this.props.editor.name,onConfirm:this.onDelete,onDismiss:this.onModalClose})]})}}const na=(0,j.cV)(ea(ta)),aa=(0,p.keyframes)({"0%":{transform:"rotate(0deg) scaleX(-1)"},"100%":{transform:"rotate(359deg) scaleX(-1)"}}),sa=t=>({spin:(0,p.css)({[t.transitions.handleMotion("no-preference")]:{animation:`${aa} 3s linear infinite`}})});var ct=o(89332),Rt=o(50201),Ke=o(89640);const ia=({variables:t})=>{const n=(0,m.useMemo)(()=>(0,xe.hI)(t),[t]),a=(0,m.useMemo)(()=>(0,xe.qJ)(t),[t]);return a.length?(0,e.jsx)(it.i,{show:!1,title:(0,r.t)("variables.variables-dependencies-button.title-dependencies","Dependencies"),nodes:(0,xe.H7)(n,a),edges:a,children:({showModal:s})=>(0,e.jsx)(x.$n,{onClick:()=>{(0,ce.rR)("Show variable dependencies"),s()},icon:"channel-add",variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"variables.variables-dependencies-button.show-dependencies",children:"Show dependencies"})})}):null},oa=({id:t,usages:n,isAdhoc:a})=>{const s=(0,m.useMemo)(()=>n.find(l=>l.variable.id===t),[n,t]);if(n.length===0||a||!s)return null;const i=s.nodes.map(l=>l.label.includes(`$${t}`)?{...l,color:"#FB7E81"}:l);return(0,e.jsx)(it.i,{show:!1,title:(0,r.t)("variabels.variable-usages-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:i,edges:s.edges,children:({showModal:l})=>(0,e.jsx)(Pe.K,{onClick:()=>{(0,ce.rR)("Show variable usages"),l()},name:"code-branch",tooltip:(0,r.t)("variables.variable-usages-button.tooltip-show-usages","Show usages")})})};function ra({index:t,variable:n,usageTree:a,usagesNetwork:s,onEdit:i,onDuplicate:l,onDelete:d}){const c=(0,j.$j)(),h=(0,j.of)(Bt),u=la(n),v=(0,xe.PK)(n.id,a)>0||n.type==="adhoc",f=(0,L.jX)(n);return(0,e.jsx)(ct.sx,{draggableId:JSON.stringify(f),index:t,children:(N,C)=>(0,e.jsxs)("tr",{ref:N.innerRef,...N.draggableProps,style:{userSelect:C.isDragging?"none":"auto",background:C.isDragging?c.colors.background.secondary:void 0,...N.draggableProps.style},children:[(0,e.jsx)("td",{role:"gridcell",className:h.column,children:(0,e.jsx)(x.$n,{size:"xs",fill:"text",onClick:S=>{S.preventDefault(),i(f)},className:h.nameLink,"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowNameFields(n.name),children:n.name})}),(0,e.jsx)("td",{role:"gridcell",className:h.definitionColumn,onClick:S=>{S.preventDefault(),i(f)},"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowDefinitionFields(n.name),children:u}),(0,e.jsx)("td",{role:"gridcell",className:h.column,children:(0,e.jsxs)("div",{className:h.icons,children:[(0,e.jsx)(da,{passed:v}),(0,e.jsx)(oa,{id:n.id,isAdhoc:n.type==="adhoc",usages:s}),(0,e.jsx)(Pe.K,{onClick:S=>{S.preventDefault(),(0,ce.rR)("Duplicate variable"),l(f)},name:"copy",tooltip:(0,r.t)("variables.variable-editor-list-row.tooltip-duplicate-variable","Duplicate variable"),"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowDuplicateButtons(n.name)}),(0,e.jsx)(Pe.K,{onClick:S=>{S.preventDefault(),(0,ce.rR)("Delete variable"),d(f)},name:"trash-alt",tooltip:(0,r.t)("variables.variable-editor-list-row.tooltip-remove-variable","Remove variable"),"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.tableRowRemoveButtons(n.name)}),(0,e.jsx)("div",{...N.dragHandleProps,className:h.dragHandle,children:(0,e.jsx)(I.I,{name:"draggabledots",size:"lg"})})]})})]})})}function la(t){let n="";return t.type==="query"?t.definition?n=t.definition:typeof t.query=="string"&&(n=t.query):(0,dt.SP)(t)&&(n=t.query),n}function da({passed:t}){const n=(0,j.of)(Bt);return t?(0,e.jsx)(I.I,{name:"check",className:n.iconPassed,title:(0,r.t)("variables.variable-check-indicator.title-variable-referenced-other-variables-dashboard","This variable is referenced by other variables or dashboard.")}):(0,e.jsx)(I.I,{name:"exclamation-triangle",className:n.iconFailed,title:(0,r.t)("variables.variable-check-indicator.title-variable-referenced-dashboard","This variable is not referenced by any variable or dashboard.")})}function Bt(t){return{dragHandle:(0,p.css)({cursor:"grab",marginLeft:t.spacing(1)}),column:(0,p.css)({width:"1%"}),nameLink:(0,p.css)({cursor:"pointer",color:t.colors.primary.text}),definitionColumn:(0,p.css)({width:"100%",maxWidth:"200px",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",OTextOverflow:"ellipsis",whiteSpace:"nowrap"}),iconPassed:(0,p.css)({color:t.v1.palette.greenBase,marginRight:t.spacing(2)}),iconFailed:(0,p.css)({color:t.v1.palette.orange,marginRight:t.spacing(2)}),icons:(0,p.css)({display:"flex",gap:t.spacing(2),alignItems:"center"})}}function ca({variables:t,usages:n,usagesNetwork:a,onChangeOrder:s,onAdd:i,onEdit:l,onDelete:d,onDuplicate:c}){const h=(0,j.of)(ua),u=g=>{if(!g.destination||!g.source)return;(0,ce.rR)("Variable drag and drop");const v=JSON.parse(g.draggableId);s(v,t[g.source.index].index,t[g.destination.index].index)};return(0,e.jsx)("div",{children:(0,e.jsxs)("div",{children:[t.length===0&&(0,e.jsx)(ha,{onAdd:i}),t.length>0&&(0,e.jsxs)(K.B,{direction:"column",gap:4,children:[(0,e.jsx)("div",{className:h.tableContainer,children:(0,e.jsxs)("table",{className:"filter-table filter-table--hover","aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.table,role:"grid",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.variable",children:"Variable"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.definition",children:"Definition"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)(ct.JY,{onDragEnd:u,children:(0,e.jsx)(ct.gL,{droppableId:"variables-list",direction:"vertical",children:g=>(0,e.jsxs)("tbody",{ref:g.innerRef,...g.droppableProps,children:[t.map((v,f)=>(0,e.jsx)(ra,{index:f,variable:v,usageTree:n,usagesNetwork:a,onDelete:d,onDuplicate:c,onEdit:l},`${v.name}-${f}`)),g.placeholder]})})})]})}),(0,e.jsxs)(K.B,{children:[(0,e.jsx)(ia,{variables:t}),(0,e.jsx)(x.$n,{"aria-label":b.Tp.pages.Dashboard.Settings.Variables.List.newButton,onClick:i,icon:"plus",children:(0,e.jsx)(r.x6,{i18nKey:"variables.variable-editor-list.new-variable",children:"New variable"})})]})]})]})})}function ha({onAdd:t}){return(0,e.jsx)(K.B,{direction:"column",children:(0,e.jsxs)(Rt.p,{variant:"call-to-action",button:(0,e.jsx)(x.$n,{"data-testid":b.Tp.components.CallToActionCard.buttonV2("Add variable"),icon:"calculator-alt",onClick:t,size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"variables.empty-state.button-title",children:"Add variable"})}),message:(0,r.t)("variables.empty-state.title","There are no variables added yet"),children:[(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.empty-state.info-box-content",children:"Variables enable more interactive and dynamic dashboards. Instead of hard-coding things like server or sensor names in your metric queries you can use variables in their place. Variables are shown as list boxes at the top of the dashboard. These drop-down lists make it easy to change the data being displayed in your dashboard."})}),(0,e.jsxs)(r.x6,{i18nKey:"variables.empty-state.info-box-content-2",children:["Check out the"," ",(0,e.jsx)(Ke.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/variables/",children:"Templates and variables documentation"})," ","for more information."]})]})})}const ua=()=>({tableContainer:(0,p.css)({overflow:"scroll",width:"100%"})}),pa=(t,n)=>{const{uid:a}=n.dashboard,s=(0,ee.nx)(a,t);return{variables:(0,ee.nS)(a,t),idInEditor:s.editor.id,usagesNetwork:s.inspect.usagesNetwork,usages:s.inspect.usages}},ga=t=>({...(0,At.bindActionCreators)({createNewVariable:Jn,initListMode:Yn},t),changeVariableOrder:(n,a,s)=>t((0,Y.kb)(n.rootStateKey,(0,he.hj)((0,L.qD)(n,{fromIndex:a,toIndex:s})))),duplicateVariable:n=>t((0,Y.kb)(n.rootStateKey,(0,he.ut)((0,L.qD)(n,{newId:void 0})))),removeVariable:n=>{t((0,Y.kb)(n.rootStateKey,(0,he.Hr)((0,L.qD)(n,{reIndex:!0}))))}}),ma=(0,R.connect)(pa,ga);class va extends m.PureComponent{constructor(){super(...arguments),this.state={variableId:void 0},this.onEditVariable=n=>{const a=this.props.variables.findIndex(s=>s.id===n.id);y.Ny.partial({editIndex:a})},this.onNewVariable=()=>{this.props.createNewVariable(this.props.dashboard.uid)},this.onChangeVariableOrder=(n,a,s)=>{this.props.changeVariableOrder(n,a,s)},this.onDuplicateVariable=n=>{this.props.duplicateVariable(n)},this.onModalOpen=n=>{this.setState({variableId:n})},this.onModalClose=()=>{this.setState({variableId:void 0})},this.onRemoveVariable=()=>{this.props.removeVariable(this.state.variableId),this.onModalClose()}}componentDidMount(){this.props.initListMode(this.props.dashboard.uid)}render(){const{editIndex:n,variables:a,sectionNav:s}=this.props,i=n!=null?a[n]:void 0,d=s.node.parentItem,c=i?{text:i.name,parentItem:d}:d;return(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:c,children:[!i&&(0,e.jsx)(ca,{variables:this.props.variables,onAdd:this.onNewVariable,onEdit:this.onEditVariable,onChangeOrder:this.onChangeVariableOrder,onDuplicate:this.onDuplicateVariable,onDelete:this.onModalOpen,usages:this.props.usages,usagesNetwork:this.props.usagesNetwork}),!i&&this.props.variables.length>0&&(0,e.jsx)(Ln,{variables:this.props.variables,dashboard:this.props.dashboard}),i&&(0,e.jsx)(na,{identifier:(0,L.jX)(i)}),(0,e.jsx)(Vt,{isOpen:this.state.variableId!==void 0,varName:this.state.variableId?.id??"",onConfirm:this.onRemoveVariable,onDismiss:this.onModalClose})]})}}const ba=ma(va);var fa=o(17159),Ut=o(73427);const xa=({dashboard:t,sectionNav:n})=>{const a=Ut.TP.hasPermission(nt.w.DashboardsPermissionsWrite),s=n.node.parentItem;return(0,e.jsx)(E.Y,{navModel:n,pageNav:s,children:(0,e.jsx)(fa.x,{resource:"dashboards",resourceId:t.uid,canSetPermissions:a})})};var ze=o(48480),Fe=o(78282),Kt=o(16780),$=o(37386),Ne=o(34999),ht=o(32635),ut=o(18857),ya=o(38669),pt=o(65642),ja=o(76478),Sa=o(76792);const zt="New annotation",Pa=({editIdx:t,dashboard:n})=>{const a=(0,j.of)(Ca),[s,i]=(0,m.useState)(n.annotations.list[t]),l=(0,m.useMemo)(()=>s.filter?s.filter.exclude?2:1:0,[s.filter]),{value:d}=(0,A.A)(()=>(0,Fe.l)().get(s.datasource),[s.datasource]),c=(0,Fe.l)().getInstanceSettings(s.datasource),h=P=>{const O=[...n.annotations.list];O.splice(t,1,P),i(P),n.annotations.list=O},u=P=>{h({...s,name:P.currentTarget.value})},g=P=>{const O=(0,ze.p$)(P);s.datasource?.type!==O.type?h({datasource:O,builtIn:s.builtIn,enable:s.enable,iconColor:s.iconColor,name:s.name,hide:s.hide,filter:s.filter,mappings:s.mappings,type:s.type}):h({...s,datasource:O})},v=P=>{const O=P.currentTarget;h({...s,[O.name]:O.type==="checkbox"?O.checked:O.value})},f=P=>{h({...s,iconColor:P})},N=P=>{let O=P.value===0?void 0:{exclude:P.value===2,ids:s.filter?.ids??[]};h({...s,filter:O})},C=P=>{if(!Array.isArray(P))return;const O={exclude:l===2,ids:[]};P.forEach(Ye=>Ye.value&&O.ids.push(Ye.value)),h({...s,filter:O})},S=Ft,Z=()=>{y.Ny.partial({editview:null,editIndex:null})},ae=()=>{const P=n.annotations.list;n.annotations.list=[...P.slice(0,t),...P.slice(t+1)],Ft()},_=s.name===zt,we=(P,O)=>P.label&&O.label?P.label.toLowerCase().localeCompare(O.label.toLowerCase()):-1,Je=(0,m.useMemo)(()=>n?.panels.filter(P=>pt.Ay.panels[P.type]).map(P=>({value:P.id,label:P.title??`Panel ${P.id}`,description:P.description,imgUrl:pt.Ay.panels[P.type].info.logos.small})).sort(we)??[],[n]);return(0,e.jsxs)("div",{children:[(0,e.jsxs)(Kt.n,{className:a.settingsForm,children:[(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-name","Name"),children:(0,e.jsx)(V.p,{"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.Settings.name,name:"name",id:"name",autoFocus:_,value:s.name,onChange:u})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-data-source","Data source"),htmlFor:"data-source-picker",children:(0,e.jsx)(Sa.s,{annotations:!0,variables:!0,current:s.datasource,onChange:g})}),!d?.meta.annotations&&(0,e.jsx)(Ne.F,{title:(0,r.t)("dashboard.annotation-settings-edit.title-annotation-support-source","No annotation support for this data source"),severity:"error",children:(0,e.jsx)(r.x6,{i18nKey:"errors.dashboard-settings.annotations.datasource",children:"The selected data source does not support annotations. Please select a different data source."})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-enabled","Enabled"),description:(0,r.t)("dashboard.annotation-settings-edit.description-enabled-annotation-query-issued-every-dashboard","When enabled the annotation query is issued every dashboard refresh"),children:(0,e.jsx)(ht.S,{name:"enable",id:"enable",value:s.enable,onChange:v})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-hidden","Hidden"),description:(0,r.t)("dashboard.annotation-settings-edit.description-hidden","Annotation queries can be toggled on or off at the top of the dashboard. With this option checked this toggle will be hidden."),children:(0,e.jsx)(ht.S,{name:"hide",id:"hide",value:s.hide,onChange:v})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-color","Color"),description:(0,r.t)("dashboard.annotation-settings-edit.description-color-annotation-event-markers","Color to use for the annotation event markers"),children:(0,e.jsx)(me.Gy,{children:(0,e.jsx)(ya.a,{value:s?.iconColor,onChange:f})})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.annotation-settings-edit.label-show-in","Show in"),"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.showInLabel,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ut.l6,{options:Ta,value:l,onChange:N,"data-testid":b.Tp.components.Annotations.annotationsTypeInput}),l!==0&&(0,e.jsx)(ut.KF,{options:Je,value:Je.filter(P=>s.filter?.ids.includes(P.value)),onChange:C,isClearable:!0,placeholder:(0,r.t)("dashboard.annotation-settings-edit.placeholder-choose-panels","Choose panels"),width:100,closeMenuOnSelect:!1,className:a.select,"data-testid":b.Tp.components.Annotations.annotationsChoosePanelInput})]})})]}),(0,e.jsxs)(Kt.n,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.query",children:"Query"})}),d?.annotations&&c&&(0,e.jsx)(ja.A,{datasource:d,datasourceInstanceSettings:c,annotation:s,onChange:h})]}),(0,e.jsxs)(K.B,{children:[!s.builtIn&&(0,e.jsx)(x.$n,{variant:"destructive",onClick:ae,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.delete",children:"Delete"})}),(0,e.jsx)(x.$n,{variant:"secondary",onClick:Z,"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.previewInDashboard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.preview-in-dashboard",children:"Preview in dashboard"})}),(0,e.jsx)(x.$n,{variant:"primary",onClick:S,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-edit.apply",children:"Apply"})})]})]})},Ca=t=>({settingsForm:(0,p.css)({maxWidth:t.spacing(60),marginBottom:t.spacing(2)}),select:(0,p.css)({marginTop:"8px"})});function Ft(){y.Ny.partial({editIndex:null})}var Da=(t=>(t[t.AllPanels=0]="AllPanels",t[t.IncludePanels=1]="IncludePanels",t[t.ExcludePanels=2]="ExcludePanels",t))(Da||{});const Ta=[{label:"All panels",value:0,description:"Send the annotation data to all panels that support annotations"},{label:"Selected panels",value:1,description:"Send the annotations to the explicitly listed panels"},{label:"All panels except",value:2,description:"Do not send annotation data to the following panels"}];var $t=o(46635),Ea=o(44458),Na=o(39302);const Ma=({dashboard:t,onNew:n,onEdit:a})=>{const s=(0,j.of)(Ia),[i,l]=(0,m.useState)(t.annotations.list),d=(v,f)=>{t.annotations.list=$t.moveItemImmutably(i,v,v+f),l(t.annotations.list)},c=v=>{t.annotations.list=[...i.slice(0,v),...i.slice(v+1)],l(t.annotations.list)},h=i.length===0||i.length===1&&i[0].builtIn,u=v=>v.enable===!1?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("em",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.annotation-settings-list.disabled",values:{name:v.name},children:["(Disabled) ","{{name}}"]})})}):v.builtIn?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("em",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.annotation-settings-list.built-in",values:{name:v.name},children:["{{name}}"," (Built-in)"]})})}):(0,e.jsx)(e.Fragment,{children:v.name}),g=(0,Fe.l)();return(0,e.jsxs)(K.B,{direction:"column",children:[i.length>0&&(0,e.jsx)("div",{className:s.table,children:(0,e.jsxs)("table",{role:"grid",className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.query-name",children:"Query name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.data-source",children:"Data source"})}),(0,e.jsx)("th",{colSpan:3})]})}),(0,e.jsx)("tbody",{children:t.annotations.list.map((v,f)=>(0,e.jsxs)("tr",{children:[v.builtIn?(0,e.jsx)("td",{role:"gridcell",style:{width:"90%"},className:"pointer",onClick:()=>a(f),children:(0,e.jsx)(x.$n,{size:"sm",fill:"text",variant:"secondary",children:u(v)})}):(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(f),children:(0,e.jsx)(x.$n,{size:"sm",fill:"text",variant:"secondary",children:u(v)})}),(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(f),children:g.getInstanceSettings(v.datasource)?.name||v.datasource?.uid}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:f!==0&&(0,e.jsx)(Pe.K,{name:"arrow-up",onClick:()=>d(f,-1),tooltip:(0,r.t)("dashboard.annotation-settings-list.tooltip-move-up","Move up")})}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:t.annotations.list.length>1&&f!==t.annotations.list.length-1?(0,e.jsx)(Pe.K,{name:"arrow-down",onClick:()=>d(f,1),tooltip:(0,r.t)("dashboard.annotation-settings-list.tooltip-move-down","Move down")}):null}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:!v.builtIn&&(0,e.jsx)(Ea.e,{size:"sm",onConfirm:()=>c(f),"aria-label":(0,r.t)("dashboard.annotation-settings-list.aria-label-delete",'Delete query with title "{{title}}"',{title:v.name})})})]},`${v.name}-${f}`))})]})}),h&&(0,e.jsx)(K.B,{direction:"column",children:(0,e.jsxs)(Rt.p,{variant:"call-to-action",button:(0,e.jsx)(x.$n,{"data-testid":b.Tp.components.CallToActionCard.buttonV2("Add annotation query"),icon:"comment-alt",onClick:n,size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"annotations.empty-state.button-title",children:"Add annotation query"})}),message:(0,r.t)("annotations.empty-state.title","There are no custom annotation queries added yet"),children:[(0,e.jsx)(r.x6,{i18nKey:"annotations.empty-state.info-box-content",children:(0,e.jsx)("p",{children:"Annotations provide a way to integrate event data into your graphs. They are visualized as vertical lines and icons on all graph panels. When you hover over an annotation icon you can get event text & tags for the event. You can add annotation events directly from grafana by holding CTRL or CMD + click on graph (or drag region). These will be stored in Grafana's annotation database."})}),(0,e.jsxs)(r.x6,{i18nKey:"annotations.empty-state.info-box-content-2",children:["Checkout the"," ",(0,e.jsx)(Ke.Y,{external:!0,href:"http://docs.grafana.org/reference/annotations/",children:"Annotations documentation"})," ","for more information."]})]})}),!h&&(0,e.jsx)(Na.d,{"data-testid":b.Tp.pages.Dashboard.Settings.Annotations.List.addAnnotationCTAV2,onClick:n,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.annotation-settings-list.new-query",children:"New query"})})]})},Ia=()=>({table:(0,p.css)({width:"100%",overflowX:"scroll"})});function wa({dashboard:t,editIndex:n,sectionNav:a}){const s=()=>{const d={name:zt,enable:!0,datasource:(0,ze.p$)((0,Fe.l)().getInstanceSettings(null)),iconColor:"red"};t.annotations.list=[...t.annotations.list,{...d}],y.Ny.partial({editIndex:t.annotations.list.length-1})},i=d=>{y.Ny.partial({editIndex:d})},l=n!=null&&n<t.annotations.list.length;return(0,e.jsxs)(E.Y,{navModel:a,pageNav:La(t,n,a.node),children:[!l&&(0,e.jsx)(Ma,{dashboard:t,onNew:s,onEdit:i}),l&&(0,e.jsx)(Pa,{dashboard:t,editIdx:n})]})}function La(t,n,a){const s=a.parentItem;if(n==null)return s;const i=t.annotations.list[n];if(i)return{text:i.name,parentItem:s}}var gt=o(31286),Wt=o(72636),Aa=o(87105),Va=o(10928),$e=o(77824),Oa=o(91156),We=o(85680),Ge=o(22429),Ra=o(5805),Gt=o(35137),Ba=o(18346),Ua=o(13542);const Ka={cleanUpDashboardAndVariables:We.Bz},za=(0,R.connect)(null,Ka),Fa=({hideModal:t,cleanUpDashboardAndVariables:n,dashboard:a})=>{const s=a.meta.provisioned,[i]=(0,Ba.uz)(),[,l]=(0,Ra.default)(async()=>{(0,ce.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:1},source:"dashboard_settings",restore_enabled:!!M.$.featureToggles.restoreDashboards}),await i({selectedItems:{dashboard:{[a.uid]:!0},folder:{}}}),n(),t(),y.Ny.replace("/")},[t]);return s?(0,e.jsx)($a,{hideModal:t,provisionedId:a.meta.provisionedExternalId}):(0,e.jsx)(Ua.h,{onConfirm:l,onClose:t,dashboardTitle:a.title})},$a=({hideModal:t,provisionedId:n})=>(0,e.jsxs)(F.a,{isOpen:!0,title:(0,r.t)("dashboard-settings.provisioned-delete-modal.title","Cannot delete provisioned dashboard"),icon:"trash-alt",onDismiss:t,className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)(Re.E,{element:"p",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-1",children:"This dashboard is managed by Grafana provisioning and cannot be deleted. Remove the dashboard from the config file to delete it."})}),(0,e.jsx)(Gt.$,{v:1}),(0,e.jsxs)(Re.E,{element:"p",children:[(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-2",children:"See grafana documentation for more information about provisioning.\xA0"}),(0,e.jsx)(Ke.Y,{href:"https://grafana.com/docs/grafana/latest/administration/provisioning/#dashboards",external:!0,children:(0,r.t)("dashboard-settings.provisioned-delete-modal.text-link","Go to docs page")})]}),(0,e.jsx)(Gt.$,{v:2}),(0,e.jsx)(Re.E,{element:"p",children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-3",children:["File path: ",{provisionedId:n}]})}),(0,e.jsx)(F.a.ButtonRow,{children:(0,e.jsx)(x.$n,{variant:"primary",onClick:t,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.confirm-button",children:"OK"})})})]}),Wa=za(Fa),Ga=()=>{const t=(0,Ge.UA)().getCurrent();return(0,e.jsx)(pe.$s,{children:({showModal:n,hideModal:a})=>(0,e.jsx)(x.$n,{variant:"destructive",onClick:()=>{n(Wa,{dashboard:t,hideModal:a})},"data-testid":b.Tp.pages.Dashboard.Settings.General.deleteDashBoard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.dashboard-delete-button",children:"Delete dashboard"})})})};var ka=o(42357),Ha=o(70969),Qa=o(56291);function Ja({dashboard:t,updateTimeZone:n,updateWeekStart:a,sectionNav:s}){const[i,l]=(0,m.useState)(0),[d,c]=(0,m.useState)(t.title),[h,u]=(0,m.useState)(t.description),g=[{value:0,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.default","Default")},{value:1,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.shared-crosshair","Shared crosshair")},{value:2,label:(0,r.t)("dashboard.general-settings-unconnected.graph_tooltip_options.label.shared-tooltip","Shared tooltip")}],v=s.node.parentItem,f=(T,Ct)=>{t.meta.folderUid=T,t.meta.folderTitle=Ct,t.meta.hasUnsavedFolderChange=!0,l(i+1)},N=(0,m.useCallback)(T=>{t.title=T,c(T)},[c,t]),C=(0,m.useCallback)(T=>{t.description=T,u(T)},[u,t]),S=T=>{t.graphTooltip=T,l(i+1)},Z=T=>{t.timepicker.refresh_intervals=T.filter(Ct=>Ct.trim()!=="")},ae=T=>{t.timepicker.nowDelay=T},_=T=>{t.timepicker.hidden=T,l(i+1)},we=T=>{t.liveNow=T,l(i+1)},Je=T=>{t.timezone=T,l(i+1),n(T)},P=T=>{t.weekStart=T,l(i+1),a(T)},O=T=>{t.tags=T,l(i+1)},Ye=T=>{t.editable=T,l(i+1)},No=[{label:(0,r.t)("dashboard.general-settings-unconnected.editable-options.label.editable","Editable"),value:!0},{label:(0,r.t)("dashboard.general-settings-unconnected.editable-options.label.readonly","Read-only"),value:!1}];return(0,e.jsx)(E.Y,{navModel:s,pageNav:v,children:(0,e.jsxs)("div",{style:{maxWidth:"600px"},children:[(0,e.jsxs)(gt.a,{marginBottom:5,children:[(0,e.jsx)($.D,{label:(0,e.jsxs)(K.B,{justifyContent:"space-between",children:[(0,e.jsx)(Wt.J,{htmlFor:"title-input",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.general.title-label",children:"Title"})}),M.$.featureToggles.dashgpt&&(0,e.jsx)(Ha.Z,{onGenerate:N})]}),children:(0,e.jsx)(V.p,{id:"title-input",name:"title",value:d,onChange:T=>N(T.target.value)})}),(0,e.jsx)($.D,{label:(0,e.jsxs)(K.B,{justifyContent:"space-between",children:[(0,e.jsx)(Wt.J,{htmlFor:"description-input",children:(0,r.t)("dashboard-settings.general.description-label","Description")}),M.$.featureToggles.dashgpt&&(0,e.jsx)(ka.V,{onGenerate:C})]}),children:(0,e.jsx)(Aa.f,{id:"description-input",name:"description",value:h,onChange:T=>C(T.target.value)})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard-settings.general.tags-label","Tags"),children:(0,e.jsx)(Va.u,{id:"tags-input",tags:t.tags,onChange:O,width:40})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard-settings.general.folder-label","Folder"),children:(0,e.jsx)(Oa.d,{value:t.meta.folderUid,onChange:f})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard-settings.general.editable-label","Editable"),description:(0,r.t)("dashboard-settings.general.editable-description","Set to read-only to disable all editing. Reload the dashboard for changes to take effect"),children:(0,e.jsx)($e.z,{value:t.editable,options:No,onChange:Ye})})]}),(0,e.jsx)(Qa.p,{onTimeZoneChange:Je,onWeekStartChange:P,onRefreshIntervalChange:Z,onNowDelayChange:ae,onHideTimePickerChange:_,onLiveNowChange:we,refreshIntervals:t.timepicker.refresh_intervals,timePickerHidden:t.timepicker.hidden,nowDelay:t.timepicker.nowDelay,timezone:t.timezone,weekStart:t.weekStart,liveNow:t.liveNow}),(0,e.jsx)(at.M,{label:(0,r.t)("dashboard-settings.general.panel-options-label","Panel options"),isOpen:!0,children:(0,e.jsx)($.D,{label:(0,r.t)("dashboard-settings.general.panel-options-graph-tooltip-label","Graph tooltip"),description:(0,r.t)("dashboard-settings.general.panel-options-graph-tooltip-description","Controls tooltip and hover highlight behavior across different panels. Reload the dashboard for changes to take effect"),children:(0,e.jsx)($e.z,{onChange:S,options:g,value:t.graphTooltip})})}),(0,e.jsx)(gt.a,{marginTop:3,children:t.meta.canDelete&&(0,e.jsx)(Ga,{})})]})})}const Ya={updateTimeZone:We.lC,updateWeekStart:We.Ss},Za=(0,R.connect)(null,Ya)(Ja);var kt=o(50992);function Xa({dashboard:t,sectionNav:n}){const a=t.getSaveModelClone(),[s,i]=(0,m.useState)(JSON.stringify(a,null,2)),l=n.node.parentItem,d=async()=>{await(0,Ge.UA)().saveJSONDashboard(s),le.t.reloadPage()},c=(0,j.of)(qa);return(0,e.jsx)(E.Y,{navModel:n,pageNav:l,children:(0,e.jsxs)("div",{className:c.wrapper,children:[(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.json-editor.subtitle",children:"The JSON model below is the data structure that defines the dashboard. This includes dashboard settings, panel settings, layout, queries, and so on."}),(0,e.jsx)(kt.B,{value:s,language:"json",showMiniMap:!0,showLineNumbers:!0,onBlur:i,containerStyles:c.codeEditor}),t.meta.canSave&&(0,e.jsx)("div",{children:(0,e.jsx)(x.$n,{type:"submit",onClick:d,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-settings.json-editor.save-button",children:"Save changes"})})})]})})}const qa=t=>({wrapper:(0,p.css)({display:"flex",height:"100%",flexDirection:"column",gap:t.spacing(2)}),codeEditor:(0,p.css)({flexGrow:1})});var mt=o(86871),_a=o(39468);const es=({editLinkIdx:t,dashboard:n,onGoBack:a})=>{const[s,i]=(0,m.useState)(t!==null?n.links[t]:mt.q),l=d=>{const c=[...n.links];c.splice(t,1,d),n.links=c,i(d)};return(0,e.jsx)(_a.d,{link:s,onUpdate:l,onGoBack:a})};var ts=o(88898);const ns=({dashboard:t,onNew:n,onEdit:a})=>{const[s,i]=(0,m.useState)(t.links),l=(h,u)=>{t.links=$t.moveItemImmutably(s,h,h+u),i(t.links)},d=h=>{t.links=[...s,{...h}],i(t.links)},c=h=>{t.links=[...s.slice(0,h),...s.slice(h+1)],i(t.links)};return(0,e.jsx)(ts.X,{links:s,onNew:n,onEdit:a,onDuplicate:d,onDelete:c,onOrderChange:l})};function as({dashboard:t,sectionNav:n,editIndex:a}){const[s,i]=(0,m.useState)(!1),l=()=>{i(!1),y.Ny.partial({editIndex:void 0})},d=()=>{t.links=[...t.links,{...mt.q}],i(!0),y.Ny.partial({editIndex:t.links.length-1})},c=g=>{i(!1),y.Ny.partial({editIndex:g})},h=a!==void 0;let u=n.node.parentItem;return h&&(u={text:s?"New link":"Edit link",subTitle:s?"Create a new link on your dashboard":"Edit a specific link of your dashboard",parentItem:n.node.parentItem}),(0,e.jsxs)(E.Y,{navModel:n,pageNav:u,children:[!h&&(0,e.jsx)(ns,{dashboard:t,onNew:d,onEdit:c}),h&&(0,e.jsx)(es,{dashboard:t,editLinkIdx:a,onGoBack:l})]})}var Ce=o(19161),ss=o(10685),is=o(7923),os=o(34753),rs=o(1199),ls=o(61371),ds=o(41053);const cs=async(t,n)=>(le.t.ignoreNextSave(),await Ce.w.restoreDashboard(n.uid,t)),hs=(t,n)=>{const a=(0,q.d4)(d=>d.dashboard.getModel()),[s,i]=(0,ds.A)(async()=>await cs(M.$.featureToggles.kubernetesClientDashboardsFolders?t:n,a),[]),l=(0,oe._2)();return(0,m.useEffect)(()=>{if(s.value){const d=y.Ny.getLocation(),c=X.I.stripBaseFromUrl(s.value.url),h=d.state?.routeReloadCounter;y.Ny.replace({...d,pathname:c,state:{routeReloadCounter:h?h+1:1}}),l.success("Dashboard restored",`Restored from version ${n}`)}},[s,n,l]),{state:s,onRestoreDashboard:i}},Ht=({hideModal:t,id:n,version:a})=>{const{state:s,onRestoreDashboard:i}=hs(n,a);return(0,m.useEffect)(()=>{!s.loading&&s.value&&t()},[s,t]),(0,e.jsx)(rt.u,{isOpen:!0,title:(0,r.t)("dashboard.revert-dashboard-modal.title-restore-version","Restore version"),icon:"history",onDismiss:t,onConfirm:i,body:(0,e.jsx)("p",{children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.revert-dashboard-modal.body-restore-version",children:["Are you sure you want to restore the dashboard to version ",{version:a},"? All unsaved changes will be lost."]})}),confirmText:(0,r.t)("dashboard.revert-dashboard-modal.confirmText-restore-version","Yes, restore to version {{version}}",{version:a})})},us=({baseInfo:t,newInfo:n,diffData:a,isNewLatest:s})=>{const i=(0,ls.G4)(a.lhs,a.rhs),l=(0,j.of)(ps);return(0,e.jsxs)(K.B,{direction:"column",gap:1,children:[(0,e.jsxs)(K.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(K.B,{alignItems:"center",children:[(0,e.jsxs)("span",{className:(0,p.cx)(l.versionInfo,l.noMarginBottom),children:[(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.old-updated-by",values:{version:t.version,editor:t.createdBy,timeAgo:t.ageString},children:[(0,e.jsxs)("strong",{children:["Version ","{{version}}"]})," updated by ","{{editor}}"," ","{{timeAgo}}"]}),t.message]}),(0,e.jsx)(I.I,{name:"arrow-right",size:"sm"}),(0,e.jsxs)("span",{className:l.versionInfo,children:[(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.new-updated-by",values:{version:n.version,editor:n.createdBy,timeAgo:n.ageString},children:[(0,e.jsxs)("strong",{children:["Version ","{{version}}"]})," updated by ","{{editor}}"," ","{{timeAgo}}"]}),n.message]})]}),s&&(0,e.jsx)(pe.$s,{children:({showModal:d,hideModal:c})=>(0,e.jsx)(x.$n,{variant:"destructive",icon:"history",onClick:()=>{d(Ht,{id:t.id,version:t.version,hideModal:c})},children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.version-history-comparison.button-restore",values:{version:t.version},children:["Restore to version ","{{version}}"]})})})]}),Object.entries(i).map(([d,c])=>(0,e.jsx)(os.D,{diffs:c,title:d},d)),(0,e.jsx)(gt.a,{paddingTop:2,children:(0,e.jsx)(at.M,{isOpen:!1,label:(0,r.t)("dashboard.version-history-comparison.label-view-json-diff","View JSON diff"),children:(0,e.jsx)(rs.M,{oldValue:JSON.stringify(a.lhs,null,2),newValue:JSON.stringify(a.rhs,null,2)})})})]})},ps=t=>({versionInfo:(0,p.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize}),noMarginBottom:(0,p.css)({marginBottom:0})});var gs=o(94018);const ms=({versions:t,canCompare:n,onCheck:a})=>{const s=(0,j.of)(vs);return(0,e.jsx)("div",{className:s.margin,children:(0,e.jsxs)("table",{className:"filter-table",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"width-4"}),(0,e.jsx)("th",{className:"width-4",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.version",children:"Version"})}),(0,e.jsx)("th",{className:"width-14",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.date",children:"Date"})}),(0,e.jsx)("th",{className:"width-10",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.updated-by",children:"Updated by"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.notes",children:"Notes"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:t.map((i,l)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(ht.S,{"aria-label":(0,r.t)("dashboard.version-history-table.aria-label-toggle-selection","Toggle selection of version {{version}}",{version:i.version}),className:(0,p.css)({display:"inline"}),checked:i.checked,onChange:d=>a(d,i.id),disabled:!i.checked&&n})}),(0,e.jsx)("td",{children:i.version}),(0,e.jsx)("td",{children:i.createdDateString}),(0,e.jsx)("td",{children:i.createdBy}),(0,e.jsx)("td",{children:i.message}),(0,e.jsx)("td",{className:"text-right",children:l===0?(0,e.jsx)(gs.v,{name:(0,r.t)("dashboard.version-history-table.name-latest","Latest"),colorIndex:17}):(0,e.jsx)(pe.$s,{children:({showModal:d,hideModal:c})=>(0,e.jsx)(x.$n,{variant:"secondary",size:"sm",icon:"history",onClick:()=>{d(Ht,{id:i.id,version:i.version,hideModal:c})},children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.version-history-table.restore",children:"Restore"})})})})]},i.id))})]})})};function vs(t){return{margin:(0,p.css)({marginBottom:t.spacing(4)})}}const bs=10;class fs extends m.PureComponent{constructor(n){super(n),this.getVersions=(a=!1)=>{this.setState({isAppending:a});const s=this.continueToken?{limit:this.limit,start:this.start,continueToken:this.continueToken}:{limit:this.limit,start:this.start};Ce.w.getHistoryList(this.props.dashboard.uid,s).then(i=>{this.setState({isLoading:!1,versions:[...this.state.versions??[],...this.decorateVersions(i.versions)]}),this.start+=this.limit,this.continueToken=i.continueToken??""}).catch(i=>console.log(i)).finally(()=>this.setState({isAppending:!1}))},this.getDiff=async()=>{const a=this.state.versions.filter(h=>h.checked),[s,i]=a,l=s.version===this.props.dashboard.version;this.setState({isLoading:!0});let d,c;M.$.featureToggles.kubernetesClientDashboardsFolders?(d=await Ce.w.getDashboardVersion(this.props.dashboard.uid,i.id),c=await Ce.w.getDashboardVersion(this.props.dashboard.uid,s.id)):(d=await Ce.w.getDashboardVersion(this.props.dashboard.uid,i.version),c=await Ce.w.getDashboardVersion(this.props.dashboard.uid,s.version)),this.setState({baseInfo:i,isLoading:!1,isNewLatest:l,newInfo:s,viewMode:"compare",diffData:{lhs:d.data,rhs:c.data}})},this.decorateVersions=a=>a.map(s=>({...s,createdDateString:this.props.dashboard.formatDate(s.created),ageString:this.props.dashboard.getRelativeTime(s.created),checked:!1})),this.onCheck=(a,s)=>{this.setState({versions:this.state.versions.map(i=>i.id===s?{...i,checked:a.currentTarget.checked}:i)})},this.reset=()=>{this.continueToken="",this.setState({baseInfo:void 0,diffData:{lhs:"",rhs:""},isNewLatest:!1,newInfo:void 0,versions:this.state.versions.map(a=>({...a,checked:!1})),viewMode:"list"})},this.limit=bs,this.start=0,this.continueToken="",this.state={isAppending:!0,isLoading:!0,versions:[],viewMode:"list",isNewLatest:!1,diffData:{lhs:"",rhs:""}}}componentDidMount(){this.getVersions()}isLastPage(){return M.$.featureToggles.kubernetesClientDashboardsFolders?this.state.versions.find(n=>n.version===1)||this.state.versions.length%this.limit!==0||this.continueToken==="":this.state.versions.find(n=>n.version===1)||this.state.versions.length%this.limit!==0}render(){const{versions:n,viewMode:a,baseInfo:s,newInfo:i,isNewLatest:l,isLoading:d,diffData:c}=this.state,h=n.filter(f=>f.checked).length===2,u=n.length>1,g=n.length>=this.limit,v=this.props.sectionNav.node.parentItem;return a==="compare"?(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:v,children:[(0,e.jsx)(is.m,{onClick:this.reset,baseVersion:s?.version,newVersion:i?.version,isNewLatest:l}),d?(0,e.jsx)(vt,{msg:"Fetching changes\u2026"}):(0,e.jsx)(us,{newInfo:i,baseInfo:s,isNewLatest:l,diffData:c})]}):(0,e.jsxs)(E.Y,{navModel:this.props.sectionNav,pageNav:v,children:[d?(0,e.jsx)(vt,{msg:"Fetching history list\u2026"}):(0,e.jsx)(ms,{versions:n,onCheck:this.onCheck,canCompare:h}),this.state.isAppending&&(0,e.jsx)(vt,{msg:"Fetching more entries\u2026"}),u&&(0,e.jsx)(ss.r,{hasMore:g,canCompare:h,getVersions:this.getVersions,getDiff:this.getDiff,isLastPage:!!this.isLastPage()})]})}}const vt=({msg:t})=>(0,e.jsxs)(me.Gy,{children:[(0,e.jsx)(st.y,{}),(0,e.jsx)("em",{children:t})]}),xs=()=>y.Ny.partial({editview:null,editIndex:null});function ys({dashboard:t,editview:n,pageNav:a,sectionNav:s}){const[i,l]=(0,m.useState)(0);(0,m.useEffect)(()=>{t.events.subscribe(te.Cf,()=>l(Z=>Z+1))},[t]);const d=(0,m.useMemo)(()=>js(t),[t,i]),c=()=>{t.meta.hasUnsavedFolderChange=!1},h=d.find(Z=>Z.id===n)??d[0],u=z.TP.hasEditPermissionInFolders,g=t.meta.canSave,v=(0,w.zy)(),f=Cs(v),N=Ss(a,s,d,h,v,t.uid),C="sm",S=[(0,e.jsx)(x.$n,{"data-testid":b.Tp.pages.Dashboard.Settings.Actions.close,variant:"secondary",fill:"outline",size:C,onClick:xs,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.dashboard-settings.actions.close",children:"Close"})},"close"),u&&(0,e.jsx)(tt.m,{dashboard:t,onSaveSuccess:c,variant:"secondary",size:C},"save as"),g&&(0,e.jsx)(tt.C,{dashboard:t,onSaveSuccess:c,size:C},"Save")];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Lt.H,{actions:(0,e.jsx)(wt.U,{alignment:"right",children:S})}),(0,e.jsx)(h.component,{sectionNav:N,dashboard:t,editIndex:f})]})}function js(t){const n=[],a=(0,r.t)("dashboard-settings.general.title","General");t.meta.canEdit&&(n.push({title:a,id:"settings",icon:"sliders-v-alt",component:Za}),n.push({title:(0,r.t)("dashboard-settings.annotations.title","Annotations"),id:"annotations",icon:"comment-alt",component:wa,subTitle:"Annotation queries return events that can be visualized as event markers in graphs across the dashboard."}),n.push({title:(0,r.t)("dashboard-settings.variables.title","Variables"),id:"templating",icon:"calculator-alt",component:ba,subTitle:"Variables can make your dashboard more dynamic and act as global filters."}),n.push({title:(0,r.t)("dashboard-settings.links.title","Links"),id:"links",icon:"link",component:as})),t.meta.canMakeEditable&&n.push({title:a,icon:"sliders-v-alt",id:"settings",component:Ps}),t.uid&&t.meta.canSave&&n.push({title:(0,r.t)("dashboard-settings.versions.title","Versions"),id:"versions",icon:"history",component:fs});const s=(0,r.t)("dashboard-settings.permissions.title","Permissions");return t.uid&&t.meta.canAdmin&&z.TP.hasPermission(nt.w.DashboardsPermissionsRead)&&n.push({title:s,id:"permissions",icon:"lock",component:xa}),n.push({title:(0,r.t)("dashboard-settings.json-editor.title","JSON Model"),id:"dashboard_json",icon:"arrow",component:Xa}),n}function Qt(t,n){return{...t,parentItem:t.parentItem?Qt(t.parentItem,n):n}}function Ss(t,n,a,s,i,l){const d={text:(0,r.t)("dashboard-settings.settings.title","Settings"),children:[],icon:"apps",hideFromBreadcrumbs:!1,url:X.I.getUrlForPartial(i,{editview:"settings",editIndex:null})};d.children=a.map(h=>({text:h.title,icon:h.icon,id:`${l}/${h.id}`,url:X.I.getUrlForPartial(i,{editview:h.id,editIndex:null}),active:h===s,parentItem:d,subTitle:h.subTitle}));const c=Qt(t,n.main);return d.parentItem=c,{main:d,node:d.children.find(h=>h.active)}}function Ps({dashboard:t,sectionNav:n}){return(0,e.jsx)(E.Y,{navModel:n,children:(0,e.jsxs)(K.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,e.jsx)(Re.E,{variant:"h3",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.make-editable.dashboard-not-editable",children:"Dashboard not editable"})}),(0,e.jsx)(x.$n,{type:"submit",onClick:()=>t.makeEditable(),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.make-editable.make-editable",children:"Make editable"})})]})})}function Cs(t){const n=new URLSearchParams(t.search).get("editIndex");if(n!=null)return parseInt(n,10)}var ne=o(26689);function Jt(t,n){return t.panels[n.key]}var bt=o(70713),Yt=o(8207),ft=o(54314),ke=o(60208),Zt=o(47931),Me=o(21285),Ds=o(4213),Ts=o.n(Ds),Es=o(80011),He=o(55386),Ns=o(5114),Ms=o(9683),De=o(75421),Xt=o(98314),Ie=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(Ie||{}),Qe=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(Qe||{});class Is extends Ns.Q{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:(0,r.t)("dashboard.support-snapshot-service.label.git-hub-comment","GitHub comment"),description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:(0,r.t)("dashboard.support-snapshot-service.label.panel-support-snapshot","Panel support snapshot"),description:(0,r.t)("dashboard.support-snapshot-service.description.dashboard-troubleshoot-visualization-issues","Dashboard JSON used to help troubleshoot visualization issues"),value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:(0,r.t)("dashboard.support-snapshot-service.title.copy-to-clipboard-failed","Copy to clipboard failed"),message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,i=new Blob([a],{type:"text/plain"}),l=`debug-${s}-${(0,Es.LE)(new Date)}.json.txt`;Ts()(i,l)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:s}=this.state,i=await(0,Xt.E_)(n,a,(0,De.jG)().timeRange()),l=JSON.stringify(i,null,2),d=(0,Xt.jD)(n,l),c=(0,He.cN)((0,He.j_)("bytes")(l?.length??0));let h;if(!n.isAngularPlugin())try{const u=new Ve.G(i,{isEmbedded:!0});h=(0,Ms.EH)(u,i).state.body}catch(u){console.log("Error creating scene:",u)}this.setState({snapshot:i,snapshotText:l,markdownText:d,snapshotSize:c,snapshotUpdate:s+1,scene:h})}}function ws({panel:t,plugin:n,onClose:a}){const s=(0,j.of)(Ls),i=(0,m.useMemo)(()=>new Is(t),[t]),{currentTab:l,loading:d,error:c,options:h,showMessage:u,snapshotSize:g,markdownText:v,snapshotText:f,randomize:N,panelTitle:C,scene:S}=i.useState();if((0,m.useEffect)(()=>{i.buildDebugDashboard()},[i,n,N]),!n)return null;const Z=[{label:(0,r.t)("dashboard.help-wizard.tabs.label.snapshot","Snapshot"),value:Ie.Support},{label:(0,r.t)("dashboard.help-wizard.tabs.label.data","Data"),value:Ie.Data}],ae=M.$.supportBundlesEnabled&&z.TP.hasPermission(nt.w.ActionSupportBundlesCreate);return(0,e.jsxs)(Yt._,{title:(0,r.t)("dashboard.help-wizard.title-get-help-with-this-panel","Get help with this panel"),size:"lg",onClose:a,subtitle:(0,e.jsxs)(K.B,{direction:"column",gap:1,children:[(0,e.jsx)(K.B,{direction:"row",gap:1,children:(0,e.jsx)(Ke.Y,{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",external:!0,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.help-wizard.troubleshooting-docs",children:"Troubleshooting docs"})})}),(0,e.jsx)("span",{className:"muted",children:(0,e.jsx)(r.x6,{i18nKey:"help-wizard.troubleshooting-help",children:"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."})}),ae&&(0,e.jsx)("span",{className:"muted",children:(0,e.jsxs)(r.x6,{i18nKey:"help-wizard.support-bundle",children:["You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",(0,e.jsx)("a",{href:"/support-bundles",children:"support bundles section"}),"."]})})]}),tabs:(0,e.jsx)(ft.U,{children:Z.map((_,we)=>(0,e.jsx)(ke.o,{label:_.label,active:_.value===l,onChangeTab:()=>i.onCurrentTabChange(_.value)},`${_.value}-${we}`))}),children:[d&&(0,e.jsx)(st.y,{}),c&&(0,e.jsx)(Ne.F,{title:c.title,children:c.message}),l===Ie.Data&&(0,e.jsxs)("div",{className:s.code,children:[(0,e.jsxs)("div",{className:s.opts,children:[(0,e.jsx)($.D,{label:(0,r.t)("dashboard.help-wizard.label-template","Template"),className:s.field,children:(0,e.jsx)(ut.l6,{options:h,value:u,onChange:i.onShowMessageChange})}),u===Qe.GithubComment?(0,e.jsx)(Zt.b,{icon:"copy",getText:i.onGetMarkdownForClipboard,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.help-wizard.copy-to-clipboard",children:"Copy to clipboard"})}):(0,e.jsx)(x.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:(0,e.jsxs)(r.x6,{i18nKey:"dashboard.help-wizard.download-snapshot",children:["Download (",{snapshotSize:g},")"]})})]}),(0,e.jsx)(bt.Ay,{disableWidth:!0,children:({height:_})=>(0,e.jsx)(kt.B,{width:"100%",height:_,language:u===Qe.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===Qe.GithubComment?v:f,readOnly:!1,onBlur:i.onSetSnapshotText})})]}),l===Ie.Support&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.D,{label:(0,r.t)("dashboard.help-wizard.label-obfuscate-data","Obfuscate data"),description:(0,r.t)("dashboard.help-wizard.description-obfuscate-data","Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."),children:(0,e.jsxs)(K.B,{direction:"row",gap:1,children:[(0,e.jsx)(Me.K,{label:(0,r.t)("dashboard.help-wizard.randomize-labels-label-labels","Labels"),id:"randomize-labels",showLabel:!0,value:!!N.labels,onChange:()=>i.onToggleRandomize("labels")}),(0,e.jsx)(Me.K,{label:(0,r.t)("dashboard.help-wizard.randomize-field-names-label-field-names","Field names"),id:"randomize-field-names",showLabel:!0,value:!!N.names,onChange:()=>i.onToggleRandomize("names")}),(0,e.jsx)(Me.K,{label:(0,r.t)("dashboard.help-wizard.randomize-string-values-label-string-values","String values"),id:"randomize-string-values",showLabel:!0,value:!!N.values,onChange:()=>i.onToggleRandomize("values")})]})}),(0,e.jsx)($.D,{label:(0,r.t)("dashboard.help-wizard.label-support-snapshot","Support snapshot"),description:(0,r.t)("dashboard.help-wizard.description-support-snapshot","Panel: {{panelTitle}}",{panelTitle:C}),children:(0,e.jsxs)(K.B,{children:[(0,e.jsx)(x.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:(0,e.jsxs)(r.x6,{i18nKey:"help-wizard.download-snapshot",children:["Download snapshot (",{snapshotSize:g},")"]})}),(0,e.jsx)(Zt.b,{icon:"github",getText:i.onGetMarkdownForClipboard,title:(0,r.t)("dashboard.help-wizard.title-complete-git-hub-comment-clipboard","Copy a complete GitHub comment to the clipboard"),children:(0,e.jsx)(r.x6,{i18nKey:"help-wizard.github-comment",children:"Copy Github comment"})})]})}),(0,e.jsx)(bt.Ay,{disableWidth:!0,children:({height:_})=>(0,e.jsx)("div",{style:{height:_,overflow:"auto"},children:S&&(0,e.jsx)(S.Component,{model:S})})})]})]})}const Ls=t=>({code:(0,p.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,p.css)({width:"100%"}),opts:(0,p.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})}),xt=(t,n,a)=>{const s=(0,m.useRef)(),[i,l]=(0,m.useState)();return(0,m.useEffect)(()=>{let d=-1,c=0;return s.current=t.getQueryRunner().getData({withTransforms:n.withTransforms,withFieldConfig:!1}).subscribe({next:h=>{if(a){if(d===h.structureRev){const u=Date.now();if(u-c<1e4)return;c=u}d=h.structureRev??-1}l(h)}}),()=>{s.current&&s.current.unsubscribe()}},[t,n.withTransforms]),{data:i,isLoading:i?.state===Ue.Gu.Loading,hasSeries:i?!!i.series:!1,hasError:!!(i&&(i.error||i?.errors?.length||i.state===Ue.Gu.Error))}};var As=o(1906),qt=o(2863),Vs=o(42836),Os=o(80307),Rs=o(82049);const Bs=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?(0,e.jsx)(r.x6,{i18nKey:"dashboard.inspect-meta.no-inspector",children:"No Metadata Inspector"}):(0,e.jsx)(n.components.MetadataInspector,{datasource:n,data:t.series});var Us=o(55072),Ks=o(96065);const zs=({panel:t,plugin:n,dashboard:a,tabs:s,data:i,isDataLoading:l,dataOptions:d,metadataDatasource:c,defaultTab:h,onDataOptionsChange:u,onClose:g})=>{const[v,f]=(0,m.useState)(h??ne.q.Data);if(!n)return null;let N=Fs(i),C=v;s.find(ae=>ae.value===v)||(C=ne.q.JSON);const S=(0,qt.w)().replace(t.title,t.scopedVars,"text")||"Panel",Z=(0,r.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:S});return(0,e.jsxs)(Yt._,{title:Z,subtitle:i&&$s(i),onClose:g,tabs:(0,e.jsx)(ft.U,{children:s.map((ae,_)=>(0,e.jsx)(ke.o,{label:ae.label,active:ae.value===C,onChangeTab:()=>f(ae.value||ne.q.Data)},`${ae.value}-${_}`))}),children:[C===ne.q.Data&&(0,e.jsx)(Vs.q,{dataName:S,panelPluginId:t.type,fieldConfig:t.fieldConfig,hasTransformations:!!t.transformations?.length,data:i&&i.series,isLoading:l,options:d,onOptionsChange:u,timeZone:a.timezone,app:As.Jk.Dashboard}),i&&C===ne.q.Meta&&(0,e.jsx)(Bs,{data:i,metadataDatasource:c}),C===ne.q.JSON&&(0,e.jsx)(Rs.w,{panel:t,dashboard:a,data:i,onClose:g}),C===ne.q.Error&&(0,e.jsx)(Os.y,{errors:N}),i&&C===ne.q.Stats&&(0,e.jsx)(Us.N,{data:i,timeZone:a.getTimezone()}),i&&C===ne.q.Query&&(0,e.jsx)(Ks.e,{data:i,onRefreshQuery:()=>t.refresh()})]})};function Fs(t){let n=t?.errors??[];return t?.error&&!n.includes(t.error)&&(n=[t.error,...n]),!n.length&&t?.state===Ue.Gu.Error?[{message:(0,r.t)("dashboard.get-errors.message.error-loading-data","Error loading data")}]:n}function $s(t){const{request:n}=t;if(!n||(0,ue.isEmpty)(n))return"";const a=n.targets.length,s=n.endTime?n.endTime-n.startTime:0,i=(0,He.cN)((0,He.j_)("ms")(s));return(0,e.jsxs)(r.x6,{i18nKey:"dashboard.inspect.subtitle",children:[{queryCount:a}," queries with total query time of ",{formatted:i}]})}var _t=o(14252);const Ws=({panel:t,dashboard:n,plugin:a})=>{const s=(0,w.zy)(),i=new URLSearchParams(s.search).get("inspectTab"),[l,d]=(0,m.useState)({withTransforms:i===ne.q.Error,withFieldConfig:!0}),{data:c,isLoading:h,hasError:u}=xt(t,l,!1),g=(0,_t.sd)(c),v=(0,_t.kx)(t,n,a,u,g),f=()=>{y.Ny.partial({inspect:null,inspectTab:null})};return a?i===ne.q.Help?(0,e.jsx)(ws,{panel:t,plugin:a,onClose:f}):(0,e.jsx)(zs,{dashboard:n,panel:t,plugin:a,defaultTab:i,tabs:v,data:c,isDataLoading:h,dataOptions:l,onDataOptionsChange:d,metadataDatasource:g,onClose:f}):null},Gs=(t,n)=>{const a=Jt(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},ks=(0,R.connect)(Gs)(Ws);var en=o(64423),yt=o(7895),tn=o(65240),nn=o(77808),jt=o(7389),Hs=o(8921);const Qs=t=>{const n=(0,m.useMemo)(()=>lt.B.get(t.variable.type).picker,[t.variable]);return t.variable?(0,e.jsxs)(K.B,{gap:0,children:[(0,e.jsx)(Js,{variable:t.variable}),t.variable.hide!==jt.zL.hideVariable&&n&&(0,e.jsx)(n,{variable:t.variable,readOnly:t.readOnly??!1})]}):(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"variables.picker-renderer.couldnt-load-variable",children:"Couldn't load variable"})})};function Js({variable:t}){const n=(0,m.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==jt.zL.dontHide)return null;const a=Hs.qz+t.id;return t.description?(0,e.jsx)(Be.m,{content:t.description,placement:"bottom",children:(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}):(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}const an=({variables:t,readOnly:n})=>{const[a,s]=(0,m.useState)([]),i=(0,j.of)(Ys);return(0,m.useEffect)(()=>{s(t.filter(l=>l.hide!==jt.zL.hideVariable))},[t]),a.length===0?null:(0,e.jsx)(e.Fragment,{children:a.map(l=>(0,e.jsx)("div",{className:i.submenuItem,"data-testid":b.Tp.pages.Dashboard.SubMenu.submenuItem,children:(0,e.jsx)(Qs,{variable:l,readOnly:n})},l.id))})},Ys=t=>({submenuItem:(0,p.css)({display:"inline-block",".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form":{marginBottom:0}})});var Zs=o(69289),Xs=o(12161),sn=o(75515),qs=o(97976),_s=o(74618),ei=o(37010),ti=o(68373),ni=o(93256),ai=o(41097);const on=t=>n=>n.plugins.panels[t]||(0,ai.$)(`Panel plugin not found (${t})`,!0),St=({panel:t})=>{const n=(0,q.wA)(),a=(0,q.d4)(on(t.type)),s=(0,q.d4)(c=>c.panelEditor.ui.isPanelOptionsVisible),i=(0,q.d4)(c=>c.panelEditor.isVizPickerOpen),l=()=>{n((0,de.eK)(!i))},d=()=>{n(et({isPanelOptionsVisible:!s}))};return a?(0,e.jsx)("div",{className:rn.wrapper,children:(0,e.jsxs)(ni.e,{children:[(0,e.jsx)(yt.I,{className:rn.vizButton,tooltip:(0,r.t)("dashboard.visualization-button.tooltip-click-to-change-visualization","Click to change visualization"),imgSrc:a.meta.info.logos.small,isOpen:i,onClick:l,"data-testid":b.Tp.components.PanelEditor.toggleVizPicker,"aria-label":(0,r.t)("dashboard.visualization-button.aria-label-change-visualization","Change visualization"),variant:"canvas",fullWidth:!0,children:a.meta.name}),(0,e.jsx)(yt.I,{tooltip:s?(0,r.t)("dashboard.visualization-button.tooltip-close","Close options pane"):(0,r.t)("dashboard.visualization-button.tooltip-show","Show options pane"),icon:s?"angle-right":"angle-left",onClick:d,variant:"canvas","data-testid":b.Tp.components.PanelEditor.toggleVizOptions,"aria-label":s?(0,r.t)("dashboard.visualization-button.aria-label-close","Close options pane"):(0,r.t)("dashboard.visualization-button.aria-label-show","Show options pane")})]})}):null};St.displayName="VisualizationTab";const rn={wrapper:(0,p.css)({display:"flex",flexDirection:"column"}),vizButton:(0,p.css)({textAlign:"left"})};var si=o(78685),ii=o(12737),ln=o(92807),oi=o(95943),ri=o(92100),li=o(43652);const di=({onConfirm:t,onDismiss:n,panel:a})=>{const s=(0,sn.X)(a),i=`${s?"Changing":"Replace with"} library panel`,l=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return(0,e.jsx)(rt.u,{onConfirm:t,onDismiss:n,confirmText:s?(0,r.t)("library-panels.change-library-panel-modal.confirmText-change","Change"):(0,r.t)("library-panels.change-library-panel-modal.confirmText-replace","Replace"),title:i,body:l,dismissText:"Cancel",isOpen:!0})};var ci=o(90232);const hi=({panel:t,searchQuery:n})=>{const[a,s]=(0,m.useState)(!1),[i,l]=(0,m.useState)(void 0),[d,c]=(0,m.useState)([]),h=(0,m.useCallback)(C=>{c(C.map(S=>S.id))},[c]),u=(0,Ge.UA)().getCurrent(),g=(0,q.wA)(),v=async()=>{i&&(l(void 0),g((0,_e.Xk)(t,i)))},f=()=>s(!0),N=()=>l(void 0);return(0,e.jsxs)(me.gW,{spacing:"md",children:[!t.libraryPanel&&(0,e.jsx)(me.gW,{align:"center",children:(0,e.jsx)(x.$n,{icon:"plus",onClick:f,variant:"secondary",fullWidth:!0,children:(0,e.jsx)(r.x6,{i18nKey:"library-panels.panel-library-options-group.create-new-library-panel",children:"Create new library panel"})})}),(0,e.jsx)(ri.$,{onChange:h}),(0,e.jsx)("div",{className:ui.libraryPanelsView,children:(0,e.jsx)(ci.y,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:d,onClickCard:l,showSecondaryActions:!0})}),a&&(0,e.jsx)(li.o,{panel:t,onDismiss:()=>s(!1),initialFolderUid:u?.meta.folderUid,isOpen:a}),i&&(0,e.jsx)(di,{panel:t,onDismiss:N,onConfirm:v})]})},ui={libraryPanelsView:(0,p.css)({width:"100%"})};var pi=o(82472),gi=o(72165),B=o(62667);const dn=({panel:t,data:n})=>{const a=(0,q.d4)(on(t.type)),[s,i]=(0,m.useState)(""),l=oi.wV,d=B.__.Visualizations,[c,h]=(0,si.A)(l,d),u=(0,q.wA)(),g=(0,j.of)(mi),v=(0,m.useRef)(null),f=(0,m.useCallback)(S=>{u((0,_e.gW)({panel:t,...S})),S.withModKey||u((0,de.eK)(!1))},[u,t]),N=()=>{u((0,de.eK)(!1))};if(!a)return null;const C=[{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.visualizations","Visualizations"),value:B.__.Visualizations},{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.suggestions","Suggestions"),value:B.__.Suggestions},{label:(0,r.t)("dashboard.visualization-select-pane.radio-options.label.library-panels","Library panels"),value:B.__.LibraryPanels,description:(0,r.t)("dashboard.visualization-select-pane.radio-options.description.reusable-panels-share-between-multiple-dashboards","Reusable panels you can share between multiple dashboards.")}];return(0,e.jsxs)("div",{className:g.openWrapper,children:[(0,e.jsxs)("div",{className:g.formBox,children:[(0,e.jsxs)("div",{className:g.searchRow,children:[(0,e.jsx)(ii.Z,{value:s,onChange:i,ref:v,autoFocus:!0,placeholder:(0,r.t)("dashboard.visualization-select-pane.placeholder-search-for","Search for...")}),(0,e.jsx)(x.$n,{title:(0,r.t)("dashboard.visualization-select-pane.title-close","Close"),variant:"secondary",icon:"angle-up",className:g.closeButton,"aria-label":b.Tp.components.PanelEditor.toggleVizPicker,onClick:N})]}),(0,e.jsx)($.D,{className:g.customFieldMargin,children:(0,e.jsx)($e.z,{options:C,value:c,onChange:h,fullWidth:!0})})]}),(0,e.jsx)("div",{className:g.scrollWrapper,children:(0,e.jsx)(ln.P,{children:(0,e.jsxs)("div",{className:g.scrollContent,children:[c===B.__.Visualizations&&(0,e.jsx)(gi.G,{pluginId:a.meta.id,onChange:f,searchQuery:s}),c===B.__.Suggestions&&(0,e.jsx)(pi.a,{onChange:f,searchQuery:s,panel:t,data:n}),c===B.__.LibraryPanels&&(0,e.jsx)(hi,{searchQuery:s,panel:t},"Panel Library")]})})})]})};dn.displayName="VisualizationSelectPane";const mi=t=>({icon:(0,p.css)({color:t.v1.palette.gray33}),wrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,p.css)({textAlign:"left"}),scrollWrapper:(0,p.css)({flexGrow:1,minHeight:0}),scrollContent:(0,p.css)({padding:t.spacing(1)}),openWrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:t.colors.background.primary,border:`1px solid ${t.colors.border.weak}`}),searchRow:(0,p.css)({display:"flex",marginBottom:t.spacing(1)}),closeButton:(0,p.css)({marginLeft:t.spacing(1)}),customFieldMargin:(0,p.css)({marginBottom:t.spacing(1)}),formBox:(0,p.css)({padding:t.spacing(1),paddingBottom:0})}),vi=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i,dashboard:l,instanceState:d})=>{const c=(0,j.of)(bi),h=(0,q.d4)(g=>g.panelEditor.isVizPickerOpen),{data:u}=xt(n,{withTransforms:!0,withFieldConfig:!1},!0);return(0,e.jsxs)("div",{className:c.wrapper,"data-testid":b.Tp.components.PanelEditor.OptionsPane.content,children:[!h&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.vizButtonWrapper,children:(0,e.jsx)(St,{panel:n})}),(0,e.jsx)("div",{className:c.optionsWrapper,children:(0,e.jsx)(ti.Ff,{panel:n,dashboard:l,plugin:t,instanceState:d,data:u,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i})})]}),h&&(0,e.jsx)(dn,{panel:n,data:u})]})},bi=t=>({wrapper:(0,p.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,p.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,p.css)({padding:`0 ${t.spacing(2,2)} 0`}),legacyOptions:(0,p.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${t.spacing(2)} 0`},".section":{display:"block",margin:`${t.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var cn=o(75234),fi=o(67522),xi=o(35307),yi=o(67458),ji=(t=>(t.Error="Error",t.Info="Info",t.Links="Links",t))(ji||{});class Si extends m.Component{constructor(){super(...arguments),this.timeSrv=(0,De.jG)(),this.getInfoMode=()=>{const{panel:n,error:a}=this.props;if(a)return"Error";if(n.description)return"Info";if(n.links&&n.links.length)return"Links"},this.getInfoContent=()=>{const{panel:n,theme:a}=this.props,s=n.description||"",i=(0,qt.w)().replace(s,n.scopedVars),l=(0,yi.G)(i),d=this.props.links&&this.props.links.getLinks(n.replaceVariables),c=Di(a);return(0,e.jsxs)("div",{className:c.content,children:[(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:l}}),d&&d.length>0&&(0,e.jsx)("ul",{className:c.cornerLinks,children:d.map((h,u)=>(0,e.jsx)("li",{children:(0,e.jsx)("a",{href:h.href,target:h.target,children:h.title})},u))})]})},this.onClickError=()=>{y.Ny.partial({inspect:this.props.panel.id,inspectTab:ne.q.Error})}}render(){const{error:n}=this.props,a=this.getInfoMode();return a?a==="Error"&&n?(0,e.jsx)(hn,{infoMode:a,content:n,onClick:this.onClickError}):a==="Info"||a==="Links"?(0,e.jsx)(hn,{infoMode:a,content:this.getInfoContent}):null:null}}const Pi=(0,j.cV)(Si);function hn({infoMode:t,content:n,onClick:a}){const s=t==="Error"?"error":"info",i=b.Tp.components.Panels.Panel.headerCornerInfo(t.toLowerCase()),l=(0,j.of)(Ti);return(0,e.jsx)(Be.m,{content:n,placement:"top-start",theme:s,interactive:!0,children:(0,e.jsxs)("button",{type:"button",className:l.infoCorner,onClick:a,"aria-label":i,children:[(0,e.jsx)(I.I,{name:Ci[t],size:t==="Links"?"sm":"lg",className:(0,p.cx)(l.icon,{[l.iconLinks]:t==="Links"})}),(0,e.jsx)("span",{className:(0,p.cx)(l.inner,{[l.error]:t==="Error"})})]})})}const Ci={Error:"exclamation",Info:"info",Links:"external-link-alt"},Di=t=>({content:(0,p.css)({overflow:"auto",code:{whiteSpace:"normal",wordWrap:"break-word"},"pre > code":{display:"block"}}),cornerLinks:(0,p.css)({listStyle:"none",paddingLeft:0})}),Ti=t=>({icon:(0,p.css)({position:"absolute",top:0,left:0,zIndex:2,fill:t.colors.text.maxContrast}),iconLinks:(0,p.css)({left:t.spacing(.5),top:t.spacing(.25)}),inner:(0,p.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${t.spacing(4)} solid transparent`,borderLeft:`${t.spacing(4)} solid ${t.colors.background.secondary}`}),error:(0,p.css)({borderLeftColor:t.colors.error.main}),infoCorner:(0,p.css)({background:"none",border:"none",color:t.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:t.spacing(4),height:t.spacing(4),zIndex:3})});function Ei({width:t,height:n,panel:a,dashboard:s}){const{data:i}=xt(a,{withTransforms:!0,withFieldConfig:!1},!1),[l,d]=(0,m.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,m.useEffect)(()=>{const h=(0,De.jG)(),u=a.events.subscribe(cn._,()=>{const g=(0,fe.nk)(a,h.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),dashboardTitle:s.title,timeData:g,width:t})});return()=>{u.unsubscribe()}},[a,s,t]),!i)return null;const c=i?.errors?i.errors.length>1?"Multiple errors found. Click for more details":i.errors[0].message:i?.error?.message;return(0,e.jsx)(fi.NR,{width:t,height:n,padding:"none",children:(h,u)=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Pi,{panel:a,error:c}),(0,e.jsx)(xi.m,{title:(0,r.t)("dashboard.panel-editor-table-view.title-raw-data","Raw data"),pluginId:"table",width:h,height:u,data:i,options:l,onOptionsChange:d})]})})}var un=o(79104),pn=o(30360),Ni=o(13941),gn=o(21764);const Mi=({panel:t,dashboard:n,...a})=>{const{rules:s,loading:i}=(0,gn.S)({panelId:t.id,dashboardUID:n.uid});return(0,e.jsx)(ke.o,{...a,counter:i?null:s.length})};var Ii=o(6975),wi=o(83175),mn=o(74268),Li=o(20437);const vn=({dashboard:t,panel:n,className:a})=>{const s=(0,q.d4)(h=>h.templating),i=(0,w.zy)(),{loading:l,value:d}=(0,A.A)(()=>(0,Li.mp)(n,t),[n,t,s]);if(l)return(0,e.jsx)(x.$n,{disabled:!0,children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})});if(!d)return(0,e.jsx)(Ne.F,{severity:"info",title:(0,r.t)("alerting.new-rule-from-panel-button.title-no-alerting-capable-query-found","No alerting capable query found"),children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.body-no-alerting-capable-query-found",children:"Cannot create alerts from this panel because no query to an alerting capable datasource is found."})});const c=wi.kM.renderUrl("alerting/new",{defaults:JSON.stringify(d),returnTo:i.pathname+i.search});return(0,e.jsx)(x.z9,{icon:"bell",onClick:()=>(0,mn.fH)(mn.le.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})})};var Ai=o(22971),bn=o(54),Vi=o(77256);const Oi=({dashboard:t,panel:n})=>{const a=(0,j.of)(Ri),{errors:s,loading:i,rules:l}=(0,gn.S)({dashboardUID:t.uid,panelId:n.id,poll:!0}),d=(0,bn.Wd)("grafana"),c=M.$.unifiedAlertingEnabled&&z.TP.hasPermission(d.create),h=s.length?(0,e.jsx)(Ne.F,{title:(0,r.t)("alerting.panel-alert-tab-content.alert.title-errors-loading-rules","Errors loading rules"),severity:"error",children:s.map((g,v)=>(0,e.jsx)("div",{children:(0,e.jsxs)(r.x6,{i18nKey:"alerting.panel-alert-tab-content.failed-to-load-error",values:{error:(0,Vi.JZ)(g)},children:["Failed to load Grafana rules state: ","{{error}}"]})},v))}):null;if(i&&!l.length)return(0,e.jsxs)("div",{className:a.innerWrapper,children:[h,(0,e.jsx)(Ii._,{text:(0,r.t)("alerting.panel-alert-tab-content.text-loading-rules","Loading rules...")})]});if(l.length)return(0,e.jsx)(ln.P,{minHeight:"100%",children:(0,e.jsxs)("div",{className:a.innerWrapper,children:[h,(0,e.jsx)(Ai.sF,{rules:l}),!!t.meta.canSave&&c&&(0,e.jsx)(vn,{className:a.newButton,panel:n,dashboard:t})]})});const u=!t.uid;return(0,e.jsxs)("div",{"data-testid":b.Tp.components.PanelAlertTabContent.content,className:a.noRulesWrapper,children:[h,!u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.no-rules",children:"There are no alert rules linked to this panel."})}),!!t.meta.canSave&&c&&(0,e.jsx)(vn,{panel:n,dashboard:t})]}),u&&!!t.meta.canSave&&(0,e.jsx)(Ne.F,{severity:"info",title:(0,r.t)("alerting.panel-alert-tab-content.title-dashboard-not-saved","Dashboard not saved"),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.dashboard-not-saved",children:"Dashboard must be saved before alerts can be added."})})]})},Ri=t=>({newButton:(0,p.css)({marginTop:t.spacing(3)}),innerWrapper:(0,p.css)({padding:t.spacing(2)}),noRulesWrapper:(0,p.css)({margin:t.spacing(2),backgroundColor:t.colors.background.secondary,padding:t.spacing(3)})});var Bi=o(34176),Ui=o(7078),Pt=o(28998),Ki=o(32154),zi=o(77731);class Fi extends m.PureComponent{constructor(n){super(n),this.updateLastUsedDatasource=a=>{(0,Ui.tw)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{y.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},s=(0,Pt.tR)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:s?.isDefault,...s?(0,ze.p$)(s):{type:void 0,uid:void 0}},queryCachingTTL:s?.cachingConfig?.enabled?n.queryCachingTTL:void 0,queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){let a;const s=(0,Ge.UA)().getCurrent()?.uid??"",i=(0,zi.CW)(s);i?.datasourceUid!==null&&(a=(0,Pt.tR)().getInstanceSettings(i?.datasourceUid)),a||(a=(0,Pt.tR)().getInstanceSettings(null)),n.datasource=(0,ze.p$)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return(0,e.jsx)(Ki.g,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const fn=(0,m.memo)(({panel:t,dashboard:n,tabs:a,onChangeTab:s})=>{const i=(0,un.C)(),l=(0,j.of)(Wi),d=(0,m.useCallback)(u=>{let g="panel_editor_tabs_changed";M.$.featureToggles.transformationsRedesign&&(g="transformations_redesign_"+g),u.active||(0,ce.rR)(g,{tab_id:u.id}),s(u)},[s]);(0,m.useEffect)(()=>{const u=new en.yU;return u.add(t.events.subscribe(te.zq,i)),u.add(t.events.subscribe(te.JI,i)),()=>u.unsubscribe()},[t,n,i]);const c=a.find(u=>u.active);if(a.length===0)return null;const h=M.$.unifiedAlertingEnabled;return(0,e.jsxs)("div",{className:l.wrapper,children:[(0,e.jsx)(ft.U,{className:l.tabBar,hideBorder:!0,children:a.map(u=>u.id===B.M8.Alert&&h?(0,e.jsx)(Mi,{label:u.text,active:u.active,onChangeTab:()=>s(u),icon:(0,pn.Uo)(u.icon),panel:t,dashboard:n},u.id):(0,e.jsx)(ke.o,{label:u.text,active:u.active,onChangeTab:()=>d(u),icon:(0,pn.Uo)(u.icon),counter:$i(t,u)},u.id))}),(0,e.jsxs)(Ni.J,{className:l.tabContent,children:[c.id===B.M8.Query&&(0,e.jsx)(Fi,{panel:t,queries:t.targets}),c.id===B.M8.Alert&&(0,e.jsx)(Oi,{panel:t,dashboard:n}),c.id===B.M8.Transform&&(0,e.jsx)(Bi.o,{panel:t})]})]})});fn.displayName="PanelEditorTabs";function $i(t,n){switch(n.id){case B.M8.Query:return t.targets.length;case B.M8.Alert:return t.alert?1:0;case B.M8.Transform:return(t.getTransformations()??[]).length}return null}const Wi=t=>({wrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,p.css)({paddingLeft:t.spacing(2)}),tabContent:(0,p.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:t.colors.background.primary,border:`1px solid ${t.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:t.shape.borderRadius(1.5)})});var Gi=o(41811),ki=o(52161);const Hi=(0,Gi.default)((t,n)=>{const a=[];if(!n)return a;let s=B.M8.Visualize;if(n.meta.skipDataQuery)return[];n.meta.skipDataQuery||(s=B.M8.Query,a.push({id:B.M8.Query,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.query","Query"),icon:"database",active:!1}),a.push({id:B.M8.Transform,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.transform-data","Transform data"),icon:"process",active:!1})),Qi(n)&&a.push({id:B.M8.Alert,text:(0,r.t)("dashboard.get-panel-editor-tabs.text.alert","Alert"),icon:"bell",active:!1});const i=a.find(l=>l.id===(t||s))??a[0];return i.active=!0,a});function Qi(t){const{unifiedAlertingEnabled:n=!1}=(0,pt.zj)(),a=z.TP.hasPermission((0,bn.Wd)(ki.hY).read);if(!(n&&a))return!1;const i=t.meta.id==="graph",l=t.meta.id==="timeseries";return i||l}var Ji=o(61215);const Yi=(t,n)=>{const a=t.panelEditor.getPanel(),s=Jt(t,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,ee.SS)(n.dashboard.uid,t)}},Zi={initPanelEditor:Cn,discardPanelChanges:Tt,updatePanelEditorUIState:et,updateTimeZoneForSession:Zs.Cj,toggleTableView:de.kw,notifyApp:ie.dx},Xi=(0,R.connect)(Yi,Zi);class qi extends m.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{y.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Ut.lE.publish(new te.S8({component:ei.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,sn.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{y.Ny.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{y.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new en.yU,this.eventSubs.add(n.events.subscribe(te.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:s,panel:i,uiState:l,tableViewEnabled:d,theme:c}=this.props;return(0,e.jsxs)("div",{className:n.mainPaneWrapper,children:[this.renderPanelToolbar(n),(0,e.jsx)("div",{className:n.panelWrapper,children:(0,e.jsx)(bt.Ay,{children:({width:h,height:u})=>{if(h<3||u<3)return null;if(a&&(u-=c.spacing.gridSize*2),d)return(0,e.jsx)(Ei,{width:h,height:u,panel:i,dashboard:s});const g=(0,Ji.A)(l.mode,h,u,i);return(0,e.jsx)("div",{className:n.centeringContainer,style:{width:h,height:u},children:(0,e.jsx)("div",{style:g,"data-panelid":i.id,children:(0,e.jsx)(qs.L,{stateKey:i.key,dashboard:s,panel:i,isEditing:!0,isViewing:!1,lazy:!1,width:g.width,height:g.height},i.key)})})}})})]},"panel")}renderPanelAndEditor(n,a){const{panel:s,dashboard:i,plugin:l,tab:d}=this.props,c=Hi(d,l),h=c.length===0,u=this.renderPanel(a,h);return c.length===0?(0,e.jsx)("div",{className:a.onlyPanel,children:u}):(0,e.jsxs)(nn.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:g=>{g&&et({topPaneSize:g/window.innerHeight})},children:[u,(0,e.jsx)("div",{className:a.tabsWrapper,"data-testid":b.Tp.components.PanelEditor.DataPane.content,children:(0,e.jsx)(fn,{panel:s,dashboard:i,tabs:c,onChangeTab:this.onChangeTab},s.key)},"panel-editor-tabs")]})}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?(0,e.jsx)("div",{className:n.variablesWrapper,children:(0,e.jsx)(an,{variables:a})}):null}renderPanelToolbar(n){const{dashboard:a,uiState:s,variables:i,updateTimeZoneForSession:l,panel:d,tableViewEnabled:c}=this.props;return(0,e.jsx)("div",{className:n.panelToolbar,children:(0,e.jsxs)(me.Gy,{justify:i.length>0?"space-between":"flex-end",align:"flex-start",children:[this.renderTemplateVariables(n),(0,e.jsxs)(K.B,{gap:1,children:[(0,e.jsx)(Me.K,{label:(0,r.t)("dashboard.panel-editor-unconnected.table-view-label-table-view","Table view"),showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"data-testid":b.Tp.components.PanelEditor.toggleTableView}),(0,e.jsx)($e.z,{value:s.mode,options:B.Nt,onChange:this.onDisplayModeChange}),(0,e.jsx)(_s.$,{dashboard:a,onChangeTimeZone:l,isOnCanvas:!0}),!s.isPanelOptionsVisible&&(0,e.jsx)(St,{panel:d})]})]})})}renderEditorActions(){const n="sm";let a=[(0,e.jsx)(x.$n,{onClick:this.onDiscard,title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-undo-all-changes","Undo all changes"),size:n,variant:"destructive",fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.discard",children:"Discard"})},"discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?(0,e.jsx)(x.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:n,title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-library-panel","Apply changes and save library panel"),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save-library-panel",children:"Save library panel"})},"save-panel"):(0,e.jsx)(x.$n,{onClick:this.onSaveDashboard,title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-dashboard","Apply changes and save dashboard"),size:n,variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save",children:"Save"})},"save")),(0,e.jsx)(x.$n,{onClick:this.onBack,variant:"primary",title:(0,r.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-dashboard","Apply changes and go back to dashboard"),"data-testid":b.Tp.components.PanelEditor.applyButton,size:n,children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.apply",children:"Apply"})},"apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,(0,e.jsx)(pe.$s,{children:({showModal:s,hideModal:i})=>(0,e.jsx)(yt.I,{onClick:()=>{s(Xs.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:i,isOpen:!0})},title:(0,r.t)("dashboard.panel-editor-unconnected.title-unlink","Disconnects this panel from the library panel so that you can edit it regularly."),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard.panel-editor-unconnected.unlink",children:"Unlink"})},"unlink")},"unlink-controller")),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:s,instanceState:i}=this.props;return n?(0,e.jsx)(vi,{plugin:n,dashboard:a,panel:s,instanceState:i,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):(0,e.jsx)("div",{})}render(){const{initDone:n,uiState:a,theme:s,sectionNav:i,pageNav:l,className:d,updatePanelEditorUIState:c}=this.props,h=eo(s,this.props);return n?(0,e.jsxs)(E.Y,{navModel:i,pageNav:l,"data-testid":b.Tp.components.PanelEditor.General.content,layout:Q.k.Custom,className:d,children:[(0,e.jsx)(Lt.H,{actions:(0,e.jsx)(wt.U,{alignment:"right",children:this.renderEditorActions()})}),(0,e.jsxs)("div",{className:h.wrapper,children:[(0,e.jsx)("div",{className:h.verticalSplitPanesWrapper,children:a.isPanelOptionsVisible?(0,e.jsxs)(nn.g,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:u=>{u&&c({rightPaneSize:u/window.innerWidth})},children:[this.renderPanelAndEditor(a,h),this.renderOptionsPane()]}):this.renderPanelAndEditor(a,h)}),this.state.showSaveLibraryPanelModal&&(0,e.jsx)(Ae,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel})]})]}):null}}const _i=(0,j.cV)(Xi(qi)),eo=(0,tn.N)((t,n)=>{const{uiState:a}=n,s=t.spacing(2);return{wrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:t.spacing(2)}),verticalSplitPanesWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${a.isPanelOptionsVisible?0:s}`}),variablesWrapper:(0,p.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:t.spacing(1,2)}),panelWrapper:(0,p.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:s}),tabsWrapper:(0,p.css)({height:"100%",width:"100%"}),panelToolbar:(0,p.css)({display:"flex",padding:`0 0 ${s} ${s}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,p.css)({display:"flex",height:t.spacing(4),alignItems:"center"}),toolbarLeft:(0,p.css)({paddingLeft:t.spacing(1)}),centeringContainer:(0,p.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,p.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var to=o(23753),no=o(97095),ao=o(18027),so=o(39884),io=o(32380);const oo=({annotation:t,events:n,onEnabledChanged:a})=>{const[s,i]=(0,m.useState)(!1),l=(0,j.of)(ro),d=()=>(0,io.Dh)().cancel(t);return(0,m.useEffect)(()=>{const c=n.getStream(te.xc).subscribe({next:u=>{u.payload===t&&i(!0)}}),h=n.getStream(te.yj).subscribe({next:u=>{u.payload===t&&i(!1)}});return()=>{c.unsubscribe(),h.unsubscribe()}}),(0,e.jsx)("div",{className:l.annotation,children:(0,e.jsxs)(no.C,{children:[(0,e.jsx)(ao.I,{label:t.name,disabled:s,"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(t.name),children:(0,e.jsx)(Me.K,{label:t.name,value:t.enable,onChange:()=>a(t),disabled:s,"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(t.name)})}),(0,e.jsx)("div",{className:l.indicator,children:(0,e.jsx)(so.I,{loading:s,onCancel:d})})]})},t.name)};function ro(t){return{annotation:(0,p.css)({display:"inline-block",marginRight:t.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,p.css)({alignSelf:"center",padding:`0 ${t.spacing(.5)}`})}}const lo=({annotations:t,onAnnotationChanged:n,events:a})=>{const[s,i]=(0,m.useState)([]);return(0,m.useEffect)(()=>{i(t.filter(l=>l.hide!==!0))},[t]),s.length===0?null:(0,e.jsx)("div",{"data-testid":b.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper,children:s.map(l=>(0,e.jsx)(oo,{events:a,annotation:l,onEnabledChanged:n},l.name))})};var co=o(94701),ho=o(63704),uo=o(82345),xn=o(4137);const po=({dashboard:t,links:n})=>{const a=(0,un.C)();return(0,co.A)(()=>{const s=t.events.subscribe(cn.sR,a);return()=>s.unsubscribe()}),n.length?(0,e.jsx)(e.Fragment,{children:n.map((s,i)=>{const l=(0,uo.mQ)().getAnchorInfo(s),d=`${s.title}-$${i}`;if(s.type==="dashboards")return(0,e.jsx)(xn.aK,{link:s,linkInfo:l,dashboardUID:t.uid},d);const c=mt.G[s.icon],h=(0,e.jsx)(xn.Zx,{href:(0,ho.Jf)(l.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":b.Tp.components.DashboardLinks.link,icon:c,children:l.title});return(0,e.jsx)("div",{"data-testid":b.Tp.components.DashboardLinks.container,children:s.tooltip?(0,e.jsx)(Be.m,{content:l.tooltip,children:h}):h},d)})}):null};class go extends m.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===n.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=n=>{n.preventDefault()}}render(){const{dashboard:n,variables:a,links:s,annotations:i,theme:l}=this.props,d=vo(l),c=n.meta.isSnapshot??!1;return(0,e.jsxs)("div",{className:d.submenu,children:[(0,e.jsx)("form",{"aria-label":(0,r.t)("dashboard.sub-menu-un-connected.aria-label-template-variables","Template variables"),className:d.formStyles,onSubmit:this.disableSubmitOnEnter,children:(0,e.jsx)(an,{variables:a,readOnly:c})}),(0,e.jsx)(lo,{annotations:i,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),(0,e.jsx)("div",{className:d.spacer}),n&&(0,e.jsx)(po,{dashboard:n,links:s})]})}}const mo=(t,n)=>{const{uid:a}=n.dashboard,s=(0,ee.nx)(a,t);return{variables:(0,ee.pi)(a,s.variables)}},vo=(0,tn.N)(t=>({formStyles:(0,p.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,p.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${t.spacing(1)} ${t.spacing(2)}`,padding:`0 0 ${t.spacing(1)} 0`}),spacer:(0,p.css)({flexGrow:1})})),yn=(0,j.cV)((0,R.connect)(mo)(go));yn.displayName="SubMenu";var bo=o(77598),fo=o(4405),xo=o(27081),jn=o(99362);const yo=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),jo={initDashboard:xo.v,cleanUpDashboardAndVariables:We.Bz,notifyApp:ie.dx,cancelVariables:Te.Y7,templateVarsChangedInUrl:Te.Hn},So=(0,R.connect)(yo,jo),Po=t=>({fullScreenPanel:(0,p.css)({".react-grid-layout":{height:"auto !important",transitionProperty:"none"},".react-grid-item":{display:"none !important",transitionProperty:"none !important","&--fullscreen":{display:"block !important",position:"unset !important",transform:"translate(0px, 0px) !important"}},".panel-header:hover":{backgroundColor:"inherit"},".panel-title-container":{cursor:"pointer"},".react-resizable-handle":{display:"none"}})});class Co extends m.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,De.jG)().timeRange()),fo.a.setLiveTimeRange(n)},this.setScrollRef=n=>{this.setState({scrollElement:n})},this.onCloseShareModal=()=>{y.Ny.partial({shareView:null})}}static{this.contextType=J.YE}getCleanState(){return{editView:null,editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,params:a,queryParams:s}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.slug,urlUid:a.uid,urlType:a.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:s,params:i,templateVarsChangedInUrl:l}=this.props,d=this.props.location.state?.routeReloadCounter;if(s){if(n.params.uid!==i.uid||d!==void 0&&this.forceRouteReloadCounter!==d){this.initDashboard(),this.forceRouteReloadCounter=d;return}if(n.location.search!==this.props.location.search){const c=n.queryParams,h=this.props.queryParams;(h?.from!==c?.from||h?.to!==c?.to)&&((0,De.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&h?.refresh&&(0,De.jG)().setAutoRefresh(h.refresh);const u=(0,L.Wz)(this.props.queryParams,n.queryParams);u&&l(s.uid,u)}this.state.editPanel&&!a.editPanel&&(le.t.setEditingState(!0),this.props.dashboard?.events.publish(new te.sL(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(le.t.setEditingState(!1),this.props.dashboard?.events.publish(new te.i0(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,oe.gi)("Permission to edit panel denied")),y.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,oe.gi)("Panel not found")),y.Ny.partial({editPanel:null,viewPanel:null})),this.state.updateScrollTop!==void 0&&this.state.updateScrollTop!==a.updateScrollTop&&this.state.scrollElement?.scrollTo(0,this.state.updateScrollTop)}}static getDerivedStateFromProps(n,a){const{dashboard:s,queryParams:i}=n,l=i.editPanel,d=i.viewPanel,c=i.editview;if(!s)return a;const h={...a};if(!a.editView&&c?(h.editView=c,h.rememberScrollTop=a.scrollElement?.scrollTop,h.updateScrollTop=0):a.editView&&!c&&(h.updateScrollTop=a.rememberScrollTop,h.editView=null),!a.editPanel&&l){const u=s.getPanelByUrlId(l);u?s.canEditPanel(u)?(h.editPanel=u,h.rememberScrollTop=a.scrollElement?.scrollTop):h.editPanelAccessDenied=!0:h.panelNotFound=!0}else a.editPanel&&!l&&(h.editPanel=null,h.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&d){const u=s.getPanelByUrlId(d);u?(s.initViewPanel(u),h.viewPanel=u,h.rememberScrollTop=a.scrollElement?.scrollTop,h.updateScrollTop=0):h.panelNotFound=!0}else a.viewPanel&&!d&&(s.exitViewPanel(a.viewPanel),h.viewPanel=null,h.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!l)&&(h.panelNotFound=!1,h.editPanelAccessDenied=!1),Do(n,h)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,s=a.inspect;if(!n||!s)return null;const i=n.getPanelById(parseInt(s,10));return i||null}render(){const{dashboard:n,initError:a,queryParams:s,theme:i,params:l}=this.props,{editPanel:d,viewPanel:c,pageNav:h,sectionNav:u}=this.state,g=ve(this.props.queryParams),v=Po(i);if(!n||!h||!u)return(0,e.jsx)(Xe.P,{initPhase:this.props.initPhase});const f=this.getInspectPanel(),N=!d&&!g&&!this.props.queryParams.editview&&n.isSubMenuVisible(),C=g!==k.d9.Full&&!s.editview&&!a,S=(0,p.cx)({[v.fullScreenPanel]:!!c,"page-hidden":!!(s.editview||d)});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(E.Y,{navModel:u,pageNav:h,layout:Q.k.Canvas,className:S,onSetScrollRef:this.setScrollRef,children:[C&&(0,e.jsx)("header",{"data-testid":b.Tp.pages.Dashboard.DashNav.navV2,children:(0,e.jsx)(Ze.Ay,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!c,kioskMode:g,hideTimePicker:n.timepicker.hidden})}),(0,e.jsx)(Et,{dashboard:n}),a&&(0,e.jsx)(jn.i,{error:a.error,type:l.type}),N&&(0,e.jsx)("section",{"aria-label":b.Tp.pages.Dashboard.SubMenu.submenu,children:(0,e.jsx)(yn,{dashboard:n,annotations:n.annotations.list,links:n.links})}),!a&&(0,e.jsx)(bo.N,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:c,editPanel:d}),f&&(0,e.jsx)(ks,{dashboard:n,panel:f}),s.shareView&&(0,e.jsx)(to.Zy,{dashboard:n,onDismiss:this.onCloseShareModal,activeTab:s.shareView})]}),d&&(0,e.jsx)(_i,{dashboard:n,sourcePanel:d,tab:this.props.queryParams.tab,sectionNav:u,pageNav:h}),s.editview&&(0,e.jsx)(ys,{dashboard:n,editview:s.editview,pageNav:h,sectionNav:u})]})}}function Do(t,n){const{dashboard:a,navIndex:s}=t;if(!a)return n;let i=n.pageNav,l=n.sectionNav;(!i||a.title!==i.text||a.meta.folderUrl!==i.parentItem?.url)&&(i={text:a.title,url:X.I.getUrlForPartial(t.location,{editview:null,editPanel:null,viewPanel:null})}),l=(0,je.tc)(t.navIndex,Le.L1+a.uid,(0,je.tc)(t.navIndex,"dashboards/browse"));const{folderUid:d}=a.meta;if(d&&i&&l.main.id!=="starred"){const c=(0,je.tc)(s,`folder-dashboards-${d}`).main;c.id!=="not-found"&&(i={...i,parentItem:c})}return(n.editPanel||n.viewPanel)&&(i={...i,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:i,url:void 0}),n.pageNav===i&&n.sectionNav===l?n:{...n,pageNav:i,sectionNav:l}}const Sn=(0,j.cV)(Co);Sn.displayName="DashboardPage";const Pn=So(Sn);function To(t){const n=t.queryParams.scenes===!0,a=t.queryParams.scenes===!1,s=(0,w.g)(),i=(0,w.zy)(),l=(0,U.sP)();if(n||M.$.featureToggles.dashboardScene&&!a)return(0,e.jsx)(G.default,{...t});const d=!!(t.route.routeName===k.Z4.Home||t.route.routeName===k.Z4.Normal&&s.uid),c=(0,A.A)(async()=>s.type==="snapshot"?null:l.fetchDashboard({route:t.route.routeName,uid:s.uid??"",type:s.type,slug:s.slug}),[s.uid,t.route.routeName]);if(c.error)return(0,e.jsx)(jn.i,{error:c.error});if(c.loading)return null;const h=c.value&&(0,H.HG)(c.value)?c.value.metadata.name:c.value?.meta.uid,u=c.value&&(0,H.HG)(c.value)?c.value?.access.canEdit:c.value?.meta?.canEdit||c.value?.meta?.canMakeEditable,g=!h;return h!==s.uid&&!g?null:M.$.featureToggles.dashboardSceneForViewers?!u&&d&&!a?(0,e.jsx)(G.default,{...t}):(0,e.jsx)(Pn,{...t,params:s,location:i}):(0,e.jsx)(Pn,{...t,params:s,location:i})}const Eo=To},85680:(ye,W,o)=>{o.d(W,{Bz:()=>y,Q9:()=>X,Ss:()=>ie,TA:()=>b,lC:()=>j});var e=o(68143),w=o(6890),A=o(64762),M=o(13956),G=o(79718),U=o(89224),k=o(69289),H=o(37256),p=o(39167),m=o(22429),R=o(75421),Q=o(37918);function X(E,J){return async oe=>{await(0,e.AI)().post("/api/dashboards/import",E),oe((0,w.dx)((0,A.tZ)("Dashboard Imported",J))),oe((0,H.h9)())}}function b(E){return async J=>{await(0,M.n)().deleteDashboard(E,!1),J((0,H.h9)())}}const y=()=>(E,J)=>{const ve=J().dashboard.getModel();ve&&(ve.destroy(),E((0,p.Y7)(ve.uid))),(0,R.jG)().stopAutoRefresh(),E((0,Q.p0)()),E((0,U.rG)()),G.t.leave(),(0,m.UA)().setCurrent(void 0)},j=E=>J=>{J((0,k.Cj)(E)),(0,R.jG)().refreshTimeModel()},ie=E=>J=>{J((0,k.xu)(E)),(0,R.jG)().refreshTimeModel()}},96727:(ye,W,o)=>{o.d(W,{H:()=>A});var e=o(63704),w=o(74101);const A=()=>{const[M]=(0,w.z)(),G=M.get("pull_request_url"),U=M.get("new_pull_request_url");return{prURL:G?e.sQ.sanitizeUrl(G):void 0,newPrURL:U?e.sQ.sanitizeUrl(U):void 0}}}}]);

//# sourceMappingURL=2603.9be1640185ddf9dc4993.js.map