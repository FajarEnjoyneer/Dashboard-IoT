"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4656],{12266:(q,b,a)=>{a.d(b,{e:()=>B});var e=a(74848),l=a(45861);const B=({isCollapsed:v,onToggle:u,idControlled:j,className:t,text:m,size:s="xl",...g})=>(0,e.jsx)(l.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!v,"aria-controls":j,className:t,icon:v?"angle-right":"angle-down",onClick:()=>u(!v),...g,children:m})},44351:(q,b,a)=>{a.d(b,{gv:()=>R});var e=a(74848),l=a(2543),B=a.n(l),v=a(43173),u=a(41654),j=a(45861),t=a(15629);const m=v.$.unifiedAlerting.minInterval??"10s",g=((E=m)=>{const x=[(0,t.M9)("10s"),(0,t.M9)("30s"),(0,t.M9)("1m"),(0,t.M9)("5m"),(0,t.M9)("10m"),(0,t.M9)("15m"),(0,t.M9)("30m"),(0,t.M9)("1h")],O=(0,t.P8)(E),K=x.filter(V=>O<=V),_=(0,l.times)(8-K.length,V=>{const F=(0,l.last)(K)??O,k=K.length===0?1:2;return F*k*(V+1)});return[...K,..._].map(t.an)})(m),R=({currentInterval:E,onSelect:I})=>(0,e.jsx)(u.B,{direction:"row",gap:.5,role:"listbox",children:g.map(x=>{const O=E===x;return(0,e.jsx)(j.$n,{role:"option","aria-selected":O,variant:O?"primary":"secondary",size:"sm",onClick:()=>I(x),children:x},x)})})},10321:(q,b,a)=>{a.d(b,{H$:()=>Ie,Ix:()=>xe});var e=a(74848),l=a(22803),B=a(2543),v=a(96540),u=a(49785),j=a(51898),t=a(92745),m=a(63142),s=a(41654),g=a(37386),R=a(18857),E=a(31286),I=a(66404),x=a(45861),O=a(3271),K=a(21285),_=a(45967),V=a(30703),F=a(63527),k=a(22787),H=a(72636),se=a(76944),ue=a(70327),de=a(55143);const ce=n=>ue.hK.endpoints.rulerNamespace.useQuery({namespace:n,rulerConfig:de.b},{refetchOnMountOrArgChange:!0,skip:!n});var z=a(84523),G=a(29609),J=a(15629),ge=a(12266),ve=a(1972);function me(n){const r=(0,J.P8)(n);return[0,r*1,r*2,r*3,r*4,r*5].map(J.an)}function ie({selectedDuration:n,groupEvaluationInterval:r,onSelect:i}){const o=c=>n===c,d=me(r);return(0,e.jsx)(s.B,{direction:"row",gap:.5,role:"listbox",children:d.map(c=>(0,e.jsx)(x.$n,{role:"option","aria-selected":o(c),variant:o(c)?"primary":"secondary",size:"sm",onClick:()=>{i(c)},children:pe(c)},c))})}function pe(n){return n==="0s"?(0,t.t)("alerting.duration-quick-pick.none","None"):n}var he=a(44351),C=a(24619);const ee=[{value:C.Q8.Alerting,label:"Alerting"},{value:C.Q8.NoData,label:"No Data"},{value:C.Q8.OK,label:"Normal"},{value:C.Q8.Error,label:"Error"},{value:C.Q8.KeepLast,label:"Keep Last State"}],le=({includeNoData:n,includeError:r,...i})=>{const o=(0,v.useMemo)(()=>n?r?ee:ee.filter(d=>d.value!==C.Q8.Error):ee.filter(d=>d.value!==C.Q8.NoData),[n,r]);return(0,e.jsx)(R.l6,{options:o,...i})};var te=a(25521),fe=a(58872);const xe=10,Ne=1e3,je=(n,r)=>Object.values(n).flat().map(o=>{const d=(0,G.oI)(o);return{label:o.name,value:o.name,description:o.interval??z.T6,isDisabled:r?!1:d,isProvisioned:d}}).sort(Ee),Ee=(n,r)=>n.label?.localeCompare(r.label??"")||0,ye=n=>({required:{value:!0,message:(0,t.t)("alerting.for-validation-options.message.required","Required.")},validate:r=>{if(r==="0")return!0;try{const i=(0,J.M9)(r);if(i===0)return!0;try{const o=(0,J.M9)(n);return i>=o?!0:(0,t.t)("alerting.rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(i){return i instanceof Error?i.message:(0,t.t)("alerting.rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}});function Ie({existing:n,enableProvisionedGroups:r}){const i=(0,m.of)(X),[o,d]=(0,v.useState)(!1),{watch:c,setValue:p,getValues:P,formState:{errors:y},control:M,register:ae}=(0,u.xW)(),[T,S,ne,h,L]=c(["group","type","isPaused","folder","evaluateEvery","keepFiringFor"]),W=(0,G.Mu)(S),Y=(0,G.pq)(S),{currentData:A,isLoading:Z}=ce(h?.uid??""),re=(0,v.useMemo)(()=>A?je(A,r):[],[r,A]),N=Object.values(A??{}).flat().find(f=>f.name===T);(0,v.useEffect)(()=>{N&&p("evaluateEvery",N.interval??z.T6)},[N,p]);const[oe,Q]=(0,v.useState)(!1),w=(f,U)=>{p("group",f),p("evaluateEvery",U),Q(!1)},Oe=T?{value:T,label:T}:void 0,Fe=Y?(0,t.t)("alerting.rule-form.evaluation.pause.recording","Turn on to pause evaluation for this recording rule."):(0,t.t)("alerting.rule-form.evaluation.pause.alerting","Turn on to pause evaluation for this alert rule."),Ce=()=>Q(!0),Se=(0,G.H2)(S)?4:3,Ae=(0,G.H2)(S)&&!h?.uid?(0,t.t)("alerting.rule-form.evaluation.select-folder-before","Select a folder before setting evaluation group and interval"):(0,t.t)("alerting.rule-form.evaluation.evaluation-group-and-interval","Evaluation group and interval");return(0,e.jsxs)(fe.P,{stepNo:Se,title:(0,t.t)("alerting.grafana-evaluation-behavior-step.title-set-evaluation-behavior","Set evaluation behavior"),description:be(Y),children:[(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsxs)(s.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(g.D,{label:Ae,"data-testid":"group-picker",className:i.formInput,error:y.group?.message,invalid:!!y.group?.message,htmlFor:"group",children:(0,e.jsx)(u.xI,{render:({field:{ref:f,...U},fieldState:$})=>(0,e.jsx)(R.l6,{disabled:!h?.uid||Z,inputId:"group",...U,onChange:D=>{U.onChange(D.label??"")},isLoading:Z,invalid:!!h?.uid&&!T&&!!$.error,cacheOptions:!0,loadingMessage:(0,t.t)("alerting.grafana-evaluation-behavior-step.loadingMessage-loading-groups","Loading groups..."),defaultValue:Oe,options:re,getOptionLabel:D=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:D.label}),D.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(ve.rS,{})]})]}),placeholder:(0,t.t)("alerting.grafana-evaluation-behavior-step.placeholder-select-an-evaluation-group","Select an evaluation group...")},(0,B.uniqueId)()),name:"group",control:M,rules:{required:{value:!0,message:(0,t.t)("alerting.grafana-evaluation-behavior-step.message.must-enter-a-group-name","Must enter a group name")}}})})}),(0,e.jsxs)(E.a,{gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)(I.E,{color:"secondary",children:(0,e.jsx)(t.x6,{i18nKey:"alerting.grafana-evaluation-behavior-step.or",children:"or"})}),(0,e.jsx)(x.$n,{onClick:Ce,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!h?.uid,"data-testid":j.Tp.components.AlertRules.newEvaluationGroupButton,children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation.new-group",children:"New evaluation group"})})]}),oe&&(0,e.jsx)(Pe,{onCreate:w,onClose:()=>Q(!1),groupfoldersForGrafana:A})]}),h?.title&&T&&(0,e.jsx)("div",{className:i.evaluationContainer,children:(0,e.jsx)(s.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:i.marginTop,children:(0,e.jsx)(s.B,{direction:"column",gap:1,children:P("group")&&P("evaluateEvery")&&(0,e.jsxs)(t.x6,{i18nKey:"alerting.rule-form.evaluation.group-text",values:{evaluateEvery:L},children:["All rules in the selected group are evaluated every ",{evaluateEvery:L},"."]})})})})}),W&&(0,e.jsx)(Te,{evaluateEvery:L}),(0,e.jsx)(O.c,{}),W&&(0,e.jsx)(Me,{evaluateEvery:L}),n&&(0,e.jsx)(g.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(u.xI,{render:()=>(0,e.jsxs)(s.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(K.d,{id:"pause-alert",onChange:f=>{p("isPaused",f.currentTarget.checked)},value:!!ne}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:i.switchLabel,children:[(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.pause.label",children:"Pause evaluation"}),(0,e.jsx)(_.m,{placement:"top",content:Fe,theme:"info",children:(0,e.jsx)(V.I,{tabIndex:0,name:"info-circle",size:"sm",className:i.infoIcon})})]})]}),name:"isPaused"})})]}),W&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ge.e,{isCollapsed:!o,onToggle:f=>d(!f),text:(0,t.t)("alerting.grafana-evaluation-behavior-step.text-configure-no-data-and-error-handling","Configure no data and error handling")}),o&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(De,{}),(0,e.jsx)(g.D,{htmlFor:"no-data-state-input",label:(0,t.t)("alerting.alert.state-no-data","Alert state if no data or all values are null"),children:(0,e.jsx)(u.xI,{render:({field:{onChange:f,ref:U,...$}})=>(0,e.jsx)(le,{...$,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:D=>f(D?.value)}),name:"noDataState"})}),(0,e.jsx)(g.D,{htmlFor:"exec-err-state-input",label:(0,t.t)("alerting.alert.state-error-timeout","Alert state if execution error or timeout"),children:(0,e.jsx)(u.xI,{render:({field:{onChange:f,ref:U,...$}})=>(0,e.jsx)(le,{...$,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:D=>f(D?.value)}),name:"execErrState"})}),(0,e.jsx)(g.D,{label:(0,t.t)("alerting.alert.missing-series-resolve","Missing series evaluations to resolve"),description:(0,t.t)("alerting.alert.description-missing-series-evaluations","The number of consecutive evaluation intervals a dimension must be missing before the alert instance becomes stale, and is then automatically resolved and evicted. Defaults to 2 if empty."),invalid:!!y.missingSeriesEvalsToResolve?.message,error:y.missingSeriesEvalsToResolve?.message,className:i.inlineField,htmlFor:"missing-series-resolve",children:(0,e.jsxs)(s.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(F.p,{placeholder:(0,t.t)("alerting.grafana-evaluation-behavior-step.missing-series-resolve-placeholder","Default: 2"),id:"missing-series-resolve",...ae("missingSeriesEvalsToResolve",{pattern:{value:/^\d+$/,message:(0,t.t)("alerting.grafana-evaluation-behavior-step.message.must-be-a-positive-integer","Must be a positive integer.")}}),width:21}),(0,e.jsx)(te.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,t.t)("alerting.alert-missing-evaluations-to-stale.help-info.text1","An alert instance is considered stale if the alert rule query returns data, but the specific dimension (or series) for that alert instance is missing for several consecutive evaluation intervals.")}),(0,e.jsx)("p",{children:(0,t.t)("alerting.alert-missing-evaluations-to-stale.help-info.text2","A stale alert instance is resolved and then evicted.")}),(0,t.t)("alerting.alert-missing-evaluations-to-stale.help-info.text3","This setting defines how many consecutive evaluation intervals must pass without data before an alert instance is considered stale. Defaults to 2 if empty.")]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rule-evaluation/stale-alert-instances/",linkText:(0,t.t)("alerting.alert-missing-evaluations-to-stale.help-info.link-text","Read more about stale alert instances"),title:(0,t.t)("alerting.alert-missing-evaluations-to-stale.help-info.title","Stale alert instances")})]})})]})]})]})}function Pe({onClose:n,onCreate:r,groupfoldersForGrafana:i}){const o=(0,m.of)(X),{watch:d}=(0,u.xW)(),c="eval-every-input",p="new-eval-group-name",[P,y,M]=d(["group","folder.title","type"]),ae=M?(0,G.pq)(M):!1,T=(0,u.mN)({defaultValues:{group:"",evaluateEvery:z.T6},mode:"onChange",shouldFocusError:!0}),{register:S,handleSubmit:ne,formState:h,setValue:L,getValues:W,watch:Y}=T,A=Y("evaluateEvery"),Z=(i&&i[y]?.find(w=>w.name===P)?.rules)??[],re=()=>{r(W("group"),W("evaluateEvery"))},N=()=>{n()},oe=w=>{L("evaluateEvery",w,{shouldValidate:!0})},Q=ae?(0,t.t)("alerting.folderAndGroup.evaluation.modal.text.recording","Create a new evaluation group to use for this recording rule."):(0,t.t)("alerting.folderAndGroup.evaluation.modal.text.alerting","Create a new evaluation group to use for this alert rule.");return(0,e.jsxs)(k.a,{className:o.modal,isOpen:!0,title:(0,t.t)("alerting.evaluation-group-creation-modal.title-new-evaluation-group","New evaluation group"),onDismiss:N,onClickBackdrop:N,children:[(0,e.jsx)("div",{className:o.modalTitle,children:Q}),(0,e.jsx)(u.Op,{...T,children:(0,e.jsxs)("form",{onSubmit:ne(()=>re()),children:[(0,e.jsx)(g.D,{label:(0,e.jsx)(H.J,{htmlFor:p,description:(0,t.t)("alerting.evaluation-group-creation-modal.description-group-name","A group evaluates all its rules over the same evaluation interval."),children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation.group-name",children:"Evaluation group name"})}),error:h.errors.group?.message,invalid:!!h.errors.group,children:(0,e.jsx)(F.p,{"data-testid":j.Tp.components.AlertRules.newEvaluationGroupName,className:o.formInput,autoFocus:!0,id:p,placeholder:(0,t.t)("alerting.evaluation-group-creation-modal.placeholder-enter-a-name","Enter a name"),...S("group",{required:{value:!0,message:(0,t.t)("alerting.evaluation-group-creation-modal.message.required","Required.")}})})}),(0,e.jsx)(g.D,{error:h.errors.evaluateEvery?.message,label:(0,e.jsx)(H.J,{htmlFor:c,description:(0,t.t)("alerting.evaluation-group-creation-modal.description-often-rules-group-evaluated","How often all rules in the group are evaluated."),children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation.group.interval",children:"Evaluation interval"})}),invalid:!!h.errors.evaluateEvery,children:(0,e.jsx)(F.p,{"data-testid":j.Tp.components.AlertRules.newEvaluationGroupInterval,className:o.formInput,id:c,placeholder:z.T6,...S("evaluateEvery",(0,se.i)(Z))})}),(0,e.jsx)(he.gv,{currentInterval:A,onSelect:oe}),(0,e.jsxs)(k.a.ButtonRow,{children:[(0,e.jsx)(x.$n,{variant:"secondary",type:"button",onClick:N,children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation.group.cancel",children:"Cancel"})}),(0,e.jsx)(x.$n,{type:"submit",disabled:!h.isValid,"data-testid":j.Tp.components.AlertRules.newEvaluationGroupCreate,children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation.group.create",children:"Create"})})]})]})})]})}function Te({evaluateEvery:n}){const r=(0,m.of)(X),{register:i,formState:{errors:o},setValue:d,watch:c}=(0,u.xW)(),p="eval-for-input",P=c("evaluateFor"),y=M=>{d("evaluateFor",M)};return(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(g.D,{label:(0,e.jsx)(H.J,{htmlFor:p,description:(0,t.t)("alerting.for-input.description-pending",'Period during which the threshold condition must be met to trigger an alert. Selecting "None" triggers the alert immediately once the condition is met.'),children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:r.inlineField,error:o.evaluateFor?.message,invalid:o.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(F.p,{id:p,width:8,...i("evaluateFor",ye(n))})}),(0,e.jsx)(ie,{selectedDuration:P,groupEvaluationInterval:n,onSelect:y})]})}function Me({evaluateEvery:n}){const r=(0,m.of)(X),{register:i,formState:{errors:o},setValue:d,watch:c}=(0,u.xW)(),p=c("keepFiringFor"),P="keep-firing-for-input",y=M=>{d("keepFiringFor",M)};return(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(g.D,{label:(0,e.jsx)(H.J,{htmlFor:P,description:(0,t.t)("alerting.rule-form.evaluation-behaviour.keep-firing-for.label-description",'Period during which the alert will continue to show up as firing even though the threshold condition is no longer breached. Selecting "None" means the alert will be back to normal immediately.'),children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.keep-firing-for.label-text",children:"Keep firing for"})}),className:r.inlineField,error:o.keepFiringFor?.message,invalid:o.keepFiringFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(F.p,{id:P,width:8,...i("keepFiringFor")})}),(0,e.jsx)(ie,{selectedDuration:p,groupEvaluationInterval:n,onSelect:y})]})}function De(){return(0,e.jsxs)(s.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(I.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(te.G,{contentText:(0,t.t)("alerting.rule-form.evaluation-behaviour.info-help.content","These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts."),externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:(0,t.t)("alerting.rule-form.evaluation-behaviour.info-help.link-text","Read more about this option"),title:(0,t.t)("alerting.rule-form.evaluation-behaviour.info-help.link-title","Configure no data and error handling")})]})}function be(n){return(0,e.jsxs)(s.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(I.E,{variant:"bodySmall",color:"secondary",children:n?(0,e.jsx)(t.x6,{i18nKey:"alerting.alert-recording-rule-form.evaluation-behaviour.description.text",children:"Define how the recording rule is evaluated."}):(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(te.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:(0,t.t)("alerting.rule-form.evaluation-behaviour.info-help2.link-text","Read about evaluation and alert states"),title:(0,t.t)("alerting.rule-form.evaluation-behaviour.info-help2.link-title","Alert rule evaluation")})]})}const X=n=>({inlineField:(0,l.css)({marginBottom:0}),evaluationContainer:(0,l.css)({color:n.colors.text.secondary,maxWidth:`${n.breakpoints.values.sm}px`,fontSize:n.typography.size.sm}),infoIcon:(0,l.css)({marginLeft:"10px"}),marginTop:(0,l.css)({marginTop:n.spacing(1)}),switchLabel:(0,l.css)({color:n.colors.text.primary,cursor:"pointer",fontSize:n.typography.bodySmall.fontSize}),formInput:(0,l.css)({flexGrow:1}),modal:(0,l.css)({width:`${n.breakpoints.values.sm}px`}),modalTitle:(0,l.css)({color:n.colors.text.secondary,marginBottom:n.spacing(2)})})},76944:(q,b,a)=>{a.d(b,{i:()=>j});var e=a(92745),l=a(10321),B=a(11018),v=a(29609),u=a(15629);const j=t=>({required:{value:!0,message:(0,e.t)("alerting.evaluate-every-validation-options.message.required","Required.")},validate:m=>{try{const s=(0,u.M9)(m);if(s<l.Ix*1e3)return`Cannot be less than ${l.Ix} seconds.`;if(s%(l.Ix*1e3)!==0)return`Must be a multiple of ${l.Ix} seconds.`;if((0,B.uQ)(t,m).length===0)return!0;{const g=t.map(E=>{const{forDuration:I}=(0,v.jg)(E,m);return I?(0,u.P8)(I):null}),R=Math.min(...g.filter(E=>E!==null&&E!==0));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,u.an)(R)}".`}}catch(s){return s instanceof Error?s.message:"Failed to parse duration"}}})}}]);

//# sourceMappingURL=4656.b0766e6468bbaa54c18a.js.map