"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4666],{30130:(he,Z,t)=>{t.d(Z,{D:()=>T});var e=t(74848),a=t(22803),U=t(63142),V=t(72636),O=t(41654);function T({label:j,actions:ae,id:z}){const _=(0,U.of)(G);return(0,e.jsxs)("div",{className:_.container,children:[(0,e.jsx)(V.J,{className:_.label,id:z,children:j}),(0,e.jsx)(O.B,{direction:"row",gap:1,children:ae})]})}const G=j=>({container:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:j.spacing(1,2),backgroundColor:j.colors.background.secondary,borderBottom:`1px solid ${j.colors.border.medium}`}),label:(0,a.css)({margin:0})})},34666:(he,Z,t)=>{t.d(Z,{By:()=>xt,R_:()=>Se});var e=t(74848),a=t(22803),U=t(16172);function V(n,i,o){return(0,U.f)(n,-i,o)}const O=null;var T=t(61501),G=t(29407);function j(n,i,o){const s=(0,G.a)(n,o?.in);return s.setTime(s.getTime()+i*T.Cg),s}const ae=null;var z=t(79197);function _(n,i,o){return(0,z.A)(n,i*T.s0,o)}const Ae=null;function ce(n,i,o){return _(n,-i,o)}const Ce=null;var b=t(96540),ee=t(49785),xe=t(42941),te=t(70713),l=t(92745),ye=t(36490),m=t(68143),d=t(63142),P=t(93008),w=t(34999),S=t(31286),F=t(16780),v=t(41654),se=t(18027),Y=t(63527),h=t(45861),me=t(88559),W=t(87063),ve=t(8207),le=t(66404),Ie=t(64762),Le=t(46787),Re=t(52161),je=t(77256),Ne=t(1972),Ke=t(49779),De=t(30130),ue=t(40403),Fe=t(59243),We=t(50992),Ee=t(97222),Me=t(30703),Ue=t(45967),Ve=t(94018),pe=t(22787),Ge=t(12737),Oe=t(6975),ze=t(91984),oe=t(39659),Te=t(41542);function $e({onSelect:n,isOpen:i,onClose:o}){const s=(0,d.of)(Je),[u,B]=(0,b.useState)(),[f,N]=(0,b.useState)(null),{useGetAlertmanagerAlertsQuery:$}=ze.m,{currentData:I=[],isFetching:A,isError:K}=$({amSourceName:Re.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[R,J]=(0,b.useState)(""),D=(0,b.useMemo)(()=>{const c={};return!A&&I&&I.forEach(r=>{c[r.labels.alertname]||(c[r.labels.alertname]=[]);const g=Object.fromEntries(Object.entries(r.annotations).filter(([M])=>!M.startsWith("__"))),L=Object.fromEntries(Object.entries(r.labels).filter(([M])=>!M.startsWith("__")));r={...r,annotations:g,labels:L},c[r.labels.alertname].push(r)}),c},[A,I]),C=(0,b.useCallback)(c=>{B(c),N(null)},[]),y=(0,b.useMemo)(()=>{const c=Object.keys(D).filter(g=>g.toLowerCase().includes(R.toLowerCase())),r={};return c.forEach(g=>{r[g]=D[g]}),r},[D,R]);if(K)return null;const p=Object.keys(y||[]),x=({index:c,style:r})=>{if(!y)return null;const g=p[c],L=g===u;return(0,e.jsxs)("button",{type:"button",title:g,style:r,className:(0,a.cx)(s.rowButton,{[s.rowOdd]:c%2===1,[s.rowSelected]:L}),onClick:()=>C(g),children:[(0,e.jsx)("div",{className:(0,a.cx)(s.ruleTitle,s.rowButtonTitle),children:g}),(0,e.jsxs)("div",{className:s.alertFolder,children:[(0,e.jsx)(Me.I,{name:"folder"})," ",y[g][0].labels.grafana_folder??""]})]})},H=(c,r)=>{const L=c.map(q=>q.labels).map(oe.Dd),M=(0,Te.Q)(L),X=(0,Te.$)((0,oe.Dd)(r.labels),M);return X.length?(0,oe.M4)((0,oe.zm)(X)):(0,oe.M4)(r.labels)},re=({index:c,style:r})=>{const g=(0,b.useMemo)(()=>u?D[u]:[],[]),L=g[c],M=f?.includes(L),X=(0,b.useMemo)(()=>H(g,L),[g,L]),ge=()=>{if(M&&f){N(f.filter(q=>q!==L));return}N([...f||[],L])};return(0,e.jsx)("button",{type:"button",style:r,className:(0,a.cx)(s.rowButton,s.instanceButton,{[s.rowOdd]:c%2===1,[s.rowSelected]:M}),onClick:ge,children:(0,e.jsx)("div",{className:s.rowButtonTitle,title:L.labels.alertname,children:(0,e.jsx)(Ue.m,{placement:"bottom",content:(0,e.jsx)("pre",{children:JSON.stringify(L,null,2)}),theme:"info",children:(0,e.jsx)("div",{children:X.map((q,E)=>(0,e.jsx)(Ve.v,{name:q,className:s.tag},E))})})})})},ne=()=>{const c=f?.map(r=>({status:"firing",annotations:r.annotations,labels:r.labels,startsAt:r.startsAt,endsAt:r.endsAt,generatorURL:r.generatorURL,fingerprint:r.fingerprint}))||[];n(c),Q()},Q=()=>{B(void 0),N(null),J(""),fe("")},ie=()=>{Q(),o()},fe=c=>{J(c)};return(0,e.jsx)("div",{children:(0,e.jsxs)(pe.a,{title:(0,l.t)("alerting.alert-instance-modal-selector.title-select-alert-instances","Select alert instances"),className:s.modal,closeOnEscape:!0,isOpen:i,onDismiss:ie,contentClassName:s.modalContent,children:[(0,e.jsxs)("div",{className:s.container,children:[(0,e.jsx)(Ge.Z,{value:R,onChange:fe,title:(0,l.t)("alerting.alert-instance-modal-selector.title-search-alert-rule","Search alert rule"),placeholder:(0,l.t)("alerting.alert-instance-modal-selector.placeholder-search-alert-rule","Search alert rule"),autoFocus:!0}),(0,e.jsx)("div",{children:u&&"Select one or more instances from the list below"||""}),(0,e.jsxs)("div",{className:s.column,children:[A&&(0,e.jsx)(Oe._,{text:(0,l.t)("alerting.alert-instance-modal-selector.text-loading-rules","Loading rules..."),className:s.loadingPlaceholder}),!A&&(0,e.jsx)(te.Ay,{children:({height:c,width:r})=>(0,e.jsx)(Ee.Y1,{itemSize:50,height:c,width:r,itemCount:p.length,children:x})})]}),(0,e.jsxs)("div",{className:s.column,children:[!u&&!A&&(0,e.jsx)("div",{className:s.selectedRulePlaceholder,children:(0,e.jsx)("div",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-instance-modal-selector.select-alert-rule",children:"Select an alert rule to get a list of available firing instances"})})}),A&&(0,e.jsx)(Oe._,{text:(0,l.t)("alerting.alert-instance-modal-selector.text-loading-rule","Loading rule..."),className:s.loadingPlaceholder}),u&&D[u].length&&!A&&(0,e.jsx)(te.Ay,{children:({width:c,height:r})=>(0,e.jsx)(Ee.Y1,{itemSize:32,height:r,width:c,itemCount:D[u].length||0,children:re})})]})]}),(0,e.jsxs)(pe.a.ButtonRow,{children:[(0,e.jsx)(h.$n,{type:"button",variant:"secondary",onClick:ie,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(h.$n,{type:"button",variant:"primary",disabled:!(u&&f),onClick:()=>{u&&f&&ne()},children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-instance-modal-selector.add-alert-data-to-payload",children:"Add alert data to payload"})})]})]})})}const Je=n=>{const i=(0,h.my)(n);return{container:(0,a.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:n.spacing(2),flex:1}),tag:(0,a.css)({margin:"5px"}),column:(0,a.css)({flex:"1 1 auto"}),alertLabels:(0,a.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,a.css)({height:"22px",fontWeight:n.typography.fontWeightBold}),rowButton:(0,a.css)(i,{padding:n.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:n.colors.text.disabled}}),rowButtonTitle:(0,a.css)({overflowX:"auto"}),rowSelected:(0,a.css)({borderColor:n.colors.primary.border}),rowOdd:(0,a.css)({backgroundColor:n.colors.background.secondary}),instanceButton:(0,a.css)({display:"flex",gap:n.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,a.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,a.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:n.typography.fontWeightBold}),modal:(0,a.css)({height:"100%"}),modalContent:(0,a.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,a.css)({flexGrow:0}),warnIcon:(0,a.css)({fill:n.colors.warning.main}),labels:(0,a.css)({justifyContent:"flex-start"}),alertFolder:(0,a.css)({height:"20px",fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:n.spacing(1),alignItems:"center"})}},He=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],ke=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],Ze=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],Ye=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],Qe=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Pe=t(38055);function Xe(){const n=(0,d.of)(qe),i=(0,e.jsx)(be,{caption:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.E,{variant:"h4",element:"h4",color:"primary",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-docs.alert-template-data-table.alert-template-data",children:"Alert template data"})}),(0,e.jsx)(le.E,{variant:"bodySmall",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-docs.alert-template-data-table.only-in-alert",children:"Available only when in the context of an Alert (e.g. inside .Alerts loop)"})})]}),dataItems:Ze});return(0,e.jsx)(v.B,{gap:2,children:(0,e.jsx)(be,{caption:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.E,{variant:"h4",element:"h4",color:"primary",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-docs.notification-template-data",children:"Notification template data"})}),(0,e.jsx)(le.E,{variant:"bodySmall",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-docs.available-context-notification",children:"Available in the context of a notification."})})]}),dataItems:He,typeRenderer:o=>o==="[]Alert"?(0,e.jsx)(Pe.B,{content:i,children:(0,e.jsx)("div",{className:n.interactiveType,children:o})}):o==="KeyValue"?(0,e.jsx)(Pe.B,{content:(0,e.jsx)(_e,{}),children:(0,e.jsx)("div",{className:n.interactiveType,children:o})}):o})})}const qe=n=>({interactiveType:(0,a.css)({color:n.colors.text.link})});function be({dataItems:n,caption:i,typeRenderer:o}){const s=(0,d.of)(we);return(0,e.jsxs)("table",{className:s.table,children:[i&&(0,e.jsx)("caption",{children:i}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.type",children:"Type"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.notes",children:"Notes"})})]})}),(0,e.jsx)("tbody",{children:n.map(({name:u,type:B,notes:f},N)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:u}),(0,e.jsx)("td",{children:o?o(B):B}),(0,e.jsx)("td",{children:f})]},N))})]})}function _e(){const n=(0,d.of)(we);return(0,e.jsxs)("div",{children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.description",children:"KeyValue is a set of key/value string pairs that represent labels and annotations."}),(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:Qe})}),(0,e.jsxs)("table",{className:n.table,children:[(0,e.jsx)("caption",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.keyvalue-methods",children:"Key-value methods"})}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.arguments",children:"Arguments"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.returns",children:"Returns"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.notes",children:"Notes"})})]})}),(0,e.jsx)("tbody",{children:Ye.map(({name:i,args:o,returns:s,notes:u})=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:i}),(0,e.jsx)("td",{children:o}),(0,e.jsx)("td",{children:s}),(0,e.jsx)("td",{children:u})]},i))})]})]})}const we=n=>({table:(0,a.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:n.spacing(1,1)},thead:{fontWeight:n.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:n.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:n.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var et=t(2543),tt=t(8073),nt=t(77824),at=t(25471),st=t(8402);const lt={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},ot=({isOpen:n,onDismiss:i,onAccept:o})=>{const s=(0,d.of)(rt),[u,B]=(0,b.useState)([]),f=(0,ee.mN)({defaultValues:lt,mode:"onBlur"}),N=f.watch("annotations"),$=f.watch("labels"),[I,A]=(0,b.useState)("firing"),K=()=>{const C={annotations:N.filter(({key:y,value:p})=>!!y&&!!p).reduce((y,{key:p,value:x})=>({...y,[p]:x}),{}),labels:$.filter(({key:y,value:p})=>!!y&&!!p).reduce((y,{key:p,value:x})=>({...y,[p]:x}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:I==="firing"?(0,U.f)(new Date,1).toISOString():V(new Date,1).toISOString(),status:I,fingerprint:(0,et.uniqueId)("fingerprint_")};B(y=>[...y,C]),f.reset()},R=()=>{o(u),B([]),f.reset(),A("firing")},J=()=>{const C=$.some(p=>p.key!==""&&p.value!==""),y=N.some(p=>p.key!==""&&p.value!=="");return C||y},D=[{label:(0,l.t)("alerting.generate-alert-data-modal.alert-options.label.firing","Firing"),value:"firing"},{label:(0,l.t)("alerting.generate-alert-data-modal.alert-options.label.resolved","Resolved"),value:"resolved"}];return(0,e.jsx)(pe.a,{onDismiss:i,isOpen:n,title:(0,l.t)("alerting.generate-alert-data-modal.title-add-custom-alerts","Add custom alerts"),children:(0,e.jsx)(ee.Op,{...f,children:(0,e.jsxs)("form",{onSubmit:C=>{C.preventDefault(),C.stopPropagation(),f.reset(),A("firing")},children:[(0,e.jsx)(tt.Z,{children:(0,e.jsxs)(v.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(at.A,{})}),(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(st.Ay,{})}),(0,e.jsxs)("div",{className:s.flexWrapper,children:[(0,e.jsx)(nt.z,{value:I,options:D,onChange:C=>A(C)}),(0,e.jsx)(h.$n,{onClick:K,className:s.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!J(),children:(0,e.jsx)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.add-alert-data",children:"Add alert data"})})]})]})}),(0,e.jsx)("div",{className:s.onSubmitWrapper}),u.length>0&&(0,e.jsxs)(v.B,{direction:"column",gap:1,children:[(0,e.jsx)("h5",{children:(0,e.jsxs)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.review-alert-payload",children:[" ","Review alert data to add to the payload:"]})}),(0,e.jsx)("pre",{className:s.result,"data-testid":"payloadJSON",children:JSON.stringify(u,null,2)})]}),(0,e.jsx)("div",{className:s.onSubmitWrapper,children:(0,e.jsx)(pe.a.ButtonRow,{children:(0,e.jsx)(h.$n,{onClick:R,disabled:u.length===0,className:s.onSubmitButton,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.add-alert-data-to-payload",children:"Add alert data to payload"})})})})]})})})},rt=n=>({section:(0,a.css)({marginBottom:n.spacing(2)}),onAddButton:(0,a.css)({flex:"none",width:"fit-content",paddingRight:n.spacing(1),marginLeft:"auto"}),flexWrapper:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,a.css)({marginLeft:n.spacing(2)}),result:(0,a.css)({width:"570px",height:"363px"})}),it="Reset to defaults";function dt({payload:n,setPayload:i,defaultPayload:o,setPayloadFormatError:s,payloadFormatError:u,className:B}){const f=(0,d.of)(mt),N=()=>{i(o)},[$,I]=(0,b.useState)(!1),A=()=>{I(!1)},K=u!==null,R=()=>{try{const x=JSON.parse(n);JSON.stringify([...x]),s(null)}catch(x){throw s(x instanceof Error?x.message:"Invalid JSON."),x}},J=()=>{try{R(),I(!0)}catch{}},D=()=>{try{R(),p(!0)}catch{}},C=x=>{A(),p(!1),i(H=>{const re=JSON.parse(H);return JSON.stringify([...re,...x],void 0,2)})},[y,p]=(0,b.useState)(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,a.cx)(f.wrapper,B),children:[(0,e.jsx)(De.D,{label:(0,l.t)("alerting.payload-editor.label-payload","Payload"),actions:(0,e.jsxs)(v.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(me.m,{overlay:(0,e.jsxs)(W.W,{children:[(0,e.jsx)(W.W.Item,{label:(0,l.t)("alerting.payload-editor.label-use-existing-alert-instances","Use existing alert instances"),disabled:K,onClick:D}),(0,e.jsx)(W.W.Item,{label:(0,l.t)("alerting.payload-editor.label-add-custom-alert-instance","Add custom alert instance"),disabled:K,onClick:J}),(0,e.jsx)(W.W.Divider,{}),(0,e.jsx)(W.W.Item,{label:it,onClick:N,destructive:!0})]}),children:(0,e.jsx)(h.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.payload-editor.edit-payload",children:"Edit payload"})})}),(0,e.jsx)(Fe.G,{content:(0,e.jsx)(ct,{}),placement:"top",fitContent:!0,children:(0,e.jsx)(h.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.payload-editor.reference",children:"Reference"})})})]})}),(0,e.jsx)("div",{className:f.editorWrapper,children:(0,e.jsx)(te.Ay,{children:({width:x,height:H})=>(0,e.jsx)(We.B,{containerStyles:f.editorContainer,width:x,height:H,language:"json",showLineNumbers:!0,showMiniMap:!1,value:n,readOnly:!1,onBlur:i,monacoOptions:{scrollBeyondLastLine:!1}})})})]}),(0,e.jsx)(ot,{isOpen:$,onDismiss:A,onAccept:C}),(0,e.jsx)($e,{onSelect:C,isOpen:y,onClose:()=>p(!1)})]})}const ct=()=>(0,e.jsx)(be,{dataItems:ke}),mt=n=>({wrapper:(0,a.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,a.css)({paddingLeft:n.spacing(1)}),label:(0,a.css)({margin:0}),editorWrapper:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,a.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}})}),ut=[{description:"Default templates for notification titles",example:`{{- /* This is a copy of the "default.title" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.title.copy" }}
  [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}`},{description:"Default templates for notification messages",example:`{{- /* This is a copy of the "default.message" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.message.copy" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list.copy" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list.copy" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__text_alert_list.copy" }}{{ range . }}
Value: {{ template "__text_values_list.copy" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "__text_values_list.copy" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}`},{description:"Print alerts with summary and description",example:`{{- /* Example displaying the summary and description annotations of each alert in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alerts" -}}
{{ len .Alerts }} alert(s)
{{ range .Alerts -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print firing and resolved alerts",example:`{{- /* Example displaying firing and resolved alerts separately in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.firing_and_resolved_alerts" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.summary_and_description" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print common labels and annotations",example:`{{- /* Example displaying labels and annotations that are common to all alerts in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.common_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ len .Alerts.Firing }} firing alert(s)

Common labels: {{ len .CommonLabels.SortedPairs }}
{{ range .CommonLabels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end }}

Common annotations: {{ len .CommonAnnotations.SortedPairs }}
{{ range .CommonAnnotations.SortedPairs }}
- {{ .Name }} = {{ .Value }}
{{ end }}

{{ end -}}`},{description:"Print individual labels and annotations",example:`{{- /* Example displaying all labels and annotations for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.labels_and_annotations" }}
Alert labels: {{ len .Labels.SortedPairs }}
{{ range .Labels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
Alert annotations: {{ len .Annotations.SortedPairs }}
{{ range .Annotations.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
{{ end -}}`},{description:"Print URLs for runbook and alert data in Grafana",example:`{{- /* Example displaying additional information, such as runbook link, DashboardURL and SilenceURL, for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_additional_details" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.additional_details" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.additional_details" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.additional_details" }}
- Dashboard: {{ .DashboardURL }}
- Panel: {{ .PanelURL }}
- AlertGenerator: {{ .GeneratorURL }}
- Silence: {{ .SilenceURL }}
- RunbookURL: {{ .Annotations.runbook_url}}
{{ end -}}`},{description:"Create JSON payload for webhook contact point",example:`{{- /* Example displaying a custom JSON payload for a webhook contact point.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{- /* Variables defined in the webhook contact point can be accessed in .Vars but will not be previewable. */ -}}
{{ define "webhook.custom.payload" -}}
  {{ coll.Dict
  "receiver" .Receiver
  "status" .Status
  "alerts" (tmpl.Exec "webhook.custom.simple_alerts" .Alerts | data.JSON)
  "groupLabels" .GroupLabels
  "commonLabels" .CommonLabels
  "commonAnnotations" .CommonAnnotations
  "externalURL" .ExternalURL
  "version" "1"
  "orgId"  (index .Alerts 0).OrgID
  "truncatedAlerts"  .TruncatedAlerts
  "groupKey" .GroupKey
  "state"  (tmpl.Inline "{{ if eq .Status \\"resolved\\" }}ok{{ else }}alerting{{ end }}" . )
  "allVariables"  .Vars
  "title" (tmpl.Exec "default.title" . )
  "message" (tmpl.Exec "default.message" . )
  | data.ToJSONPretty " "}}
{{- end }}

{{- /* Example showcasing embedding json templates in other json templates. */ -}}
{{ define "webhook.custom.simple_alerts" -}}
  {{- $alerts := coll.Slice -}}
  {{- range . -}}
    {{ $alerts = coll.Append (coll.Dict
    "status" .Status
    "labels" .Labels
    "startsAt" .StartsAt
    "endsAt" .EndsAt
    ) $alerts}}
  {{- end -}}
  {{- $alerts | data.ToJSON -}}
{{- end }}`}];var pt=t(1332),ft=t(64179),gt=t(32443);const ht=Object.freeze({title:"",content:""}),bt=n=>n.pathname.endsWith("/duplicate"),xt=({originalTemplate:n,prefill:i,alertmanager:o})=>{const s=(0,d.of)(Be),u=(0,Ie._2)(),[B,{error:f}]=(0,ue.xW)({alertmanager:o}),[N,{error:$}]=(0,ue.A1)({alertmanager:o}),{titleIsUnique:I}=(0,ue.lx)({alertmanager:o,originalTemplate:n}),A=(0,b.useRef)(null),K=o===Re.hY,R=$??f,[J,D]=(0,xe.A)(!1),[C,y]=(0,b.useState)(Se),[p,x]=(0,b.useState)(null),{isProvisioned:H}=(0,ue.OA)(n),re=n?{title:n.title,content:n.content}:void 0,ne=(0,P.h)({direction:"column",initialSize:K?.5:1,dragPosition:"middle"}),Q=(0,P.h)({direction:"row",initialSize:K?.6:1,dragPosition:"middle"}),ie=(0,ee.mN)({mode:"onSubmit",defaultValues:i??re??ht}),{handleSubmit:fe,register:c,formState:{errors:r,isSubmitting:g},getValues:L,setValue:M,watch:X}=ie,ge=async E=>{const k=(0,je.nL)("/alerting/notifications",o,{tab:Le.ActiveTab.NotificationTemplates});try{n?await N.execute({template:n,patch:E}):await B.execute({templateValues:E}),u.success("Template saved",`Template ${E.title} has been saved`),ye.Ny.push(k)}catch(de){u.error("Error saving template",(0,je.JZ)(de))}},q=E=>{const k=L("content"),de=k?`${k}
${E}`:E;M("content",de)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ee.Op,{...ie,children:(0,e.jsxs)("form",{onSubmit:fe(ge),ref:A,className:s.form,"aria-label":(0,l.t)("alerting.template-form.aria-label-template-form","Template form"),children:[R&&(0,e.jsx)(w.F,{severity:"error",title:(0,l.t)("alerting.template-form.title-error-saving-template","Error saving template"),children:R.message||(0,m.NF)(R)&&R.data?.message||String(R)}),H&&(0,e.jsx)(S.a,{grow:0,children:(0,e.jsx)(Ne.Yi,{resource:Ne.hk.Template})}),(0,e.jsx)(F.n,{disabled:H,className:s.fieldset,children:(0,e.jsxs)(v.B,{direction:"column",gap:1,alignItems:"stretch",minHeight:"100%",children:[(0,e.jsxs)(v.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(se.I,{label:(0,l.t)("alerting.template-form.label-template-group-name","Template group name"),error:r?.title?.message,invalid:!!r.title?.message,required:!0,children:(0,e.jsx)(Y.p,{...c("title",{required:{value:!0,message:(0,l.t)("alerting.template-form.message.required","Required.")},validate:{titleIsUnique:I}}),placeholder:(0,l.t)("alerting.template-form.new-template-name-placeholder-give-your-template-group-a-name","Give your template group a name"),width:42,autoFocus:!0,id:"new-template-name"})}),(0,e.jsx)(Ke.h,{}),(0,e.jsxs)(v.B,{children:[(0,e.jsx)(h.$n,{onClick:()=>A.current?.requestSubmit(),variant:"primary",disabled:g,children:(0,e.jsx)(l.x6,{i18nKey:"common.save",children:"Save"})}),(0,e.jsx)(h.z9,{disabled:g,href:(0,je.nL)("alerting/notifications",o,{tab:Le.ActiveTab.NotificationTemplates}),variant:"secondary",children:(0,e.jsx)(l.x6,{i18nKey:"common.cancel",children:"Cancel"})})]})]}),(0,e.jsxs)("div",{...Q.containerProps,className:s.contentContainer,children:[(0,e.jsx)("div",{...Q.primaryProps,children:(0,e.jsxs)("div",{...ne.containerProps,className:s.contentField,children:[(0,e.jsx)("div",{...ne.primaryProps,children:(0,e.jsxs)("div",{className:(0,a.cx)(s.flexColumn,s.containerWithBorderAndRadius,s.minEditorSize),children:[(0,e.jsx)("div",{children:(0,e.jsx)(De.D,{label:(0,l.t)("alerting.template-form.label-template-group","Template group"),actions:(0,e.jsxs)(e.Fragment,{children:[K&&(0,e.jsx)(me.m,{overlay:(0,e.jsxs)(W.W,{children:[ut.map((E,k)=>(0,e.jsx)(W.W.Item,{label:E.description,onClick:()=>q(E.example)},k)),(0,e.jsx)(W.W.Divider,{}),(0,e.jsx)(W.W.Item,{label:(0,l.t)("alerting.template-form.label-examples-documentation","Examples documentation"),url:"https://grafana.com/docs/grafana/latest/alerting/configure-notifications/template-notifications/examples/",target:"_blank",icon:"external-link-alt"})]}),children:(0,e.jsx)(h.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.add-example",children:"Add example"})})}),(0,e.jsx)(h.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:D,children:(0,e.jsx)(l.x6,{i18nKey:"common.help",children:"Help"})})]})})}),(0,e.jsx)(S.a,{flex:1,children:(0,e.jsx)(te.Ay,{children:({width:E,height:k})=>(0,e.jsx)(pt.K,{value:L("content"),onBlur:de=>M("content",de),containerStyles:s.editorContainer,width:E,height:k})})})]})}),K&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{...ne.splitterProps}),(0,e.jsx)("div",{...ne.secondaryProps,children:(0,e.jsx)("div",{className:(0,a.cx)(s.containerWithBorderAndRadius,s.minEditorSize,s.payloadEditor,s.flexFull),children:(0,e.jsx)(dt,{payload:C,defaultPayload:Se,setPayload:y,setPayloadFormatError:x,payloadFormatError:p})})})]})]})}),K&&(0,e.jsxs)("div",{...Q.secondaryProps,children:[(0,e.jsx)("div",{...Q.splitterProps}),(0,e.jsx)(ft.p,{payload:C,templateName:X("title"),templateContent:X("content"),setPayloadFormatError:x,payloadFormatError:p,className:(0,a.cx)(s.templatePreview,s.minEditorSize)})]})]})]})})]})}),J&&(0,e.jsx)(ve._,{title:(0,l.t)("alerting.template-form.title-templating-cheat-sheet","Templating cheat sheet"),onClose:D,size:"lg",children:(0,e.jsx)(vt,{})})]})};function yt(){const n=(0,d.of)(Be),i=(0,l.t)("alerting.templates.help.intro",`Notification templates use Go templating language to create notification messages.

In Grafana, a template group can define multiple notification templates using {{ define "<NAME>" }}.
These templates can then be used in contact points and within other notification templates by calling {{ template "<NAME>" }}.
For detailed information about notification templates, refer to our documentation.`);return(0,e.jsx)(w.F,{title:"",severity:"info",children:(0,e.jsxs)(v.B,{direction:"column",gap:2,children:[(0,e.jsxs)(v.B,{direction:"row",children:[(0,e.jsx)("div",{style:{whiteSpace:"pre"},children:i}),(0,e.jsx)("div",{children:(0,e.jsx)(h.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.goto-docs",children:"Notification templates documentation"})})})]}),(0,e.jsxs)(le.E,{variant:"bodySmall",children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.auto-complete",children:"For auto-completion of common templating code, type the following keywords in the content editor:"}),(0,e.jsx)("div",{className:n.code,children:Object.values(gt.L).map(o=>o.label).join(", ")})]})]})})}function vt(){return(0,e.jsxs)(v.B,{direction:"column",gap:1,children:[(0,e.jsx)(yt,{}),(0,e.jsx)(Xe,{})]})}const Be=n=>{const i=n.breakpoints.down("md");return{flexFull:(0,a.css)({flex:1}),minEditorSize:(0,a.css)({minHeight:300,minWidth:300}),payloadEditor:(0,a.css)({minHeight:0}),containerWithBorderAndRadius:(0,a.css)({borderRadius:n.shape.radius.default,border:`1px solid ${n.colors.border.medium}`}),flexColumn:(0,a.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,a.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,a.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,a.css)({margin:0}),contentContainer:(0,a.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,a.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,a.css)({flex:1,display:"flex"}),templatePayload:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,a.css)({backgroundColor:n.colors.info.transparent,margin:0,[i]:{display:"none"}}),code:(0,a.css)({color:n.colors.text.secondary,fontWeight:n.typography.fontWeightBold})}},jt=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:V(new Date,1).toISOString(),endsAt:j(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:ce(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],Se=JSON.stringify(jt,null,2)},64179:(he,Z,t)=>{t.d(Z,{p:()=>ee});var e=t(74848),a=t(22803),U=t(2543),V=t(70713),O=t(92745),T=t(63142),G=t(45861),j=t(31286),ae=t(50992),z=t(34999),_=t(77256),Ae=t(30130),ce=t(96540),Ce=t(43730);function b(m,d,P,w){const[S,{data:F,error:v,isLoading:se}]=(0,Ce.vj)(),Y=(0,ce.useCallback)(()=>{try{const h=JSON.parse(P);JSON.stringify([...h]),S({template:m,alerts:h,name:d}),w(null)}catch(h){w(h instanceof Error?h.message:"Invalid JSON.")}},[m,d,P,w,S]);return(0,ce.useEffect)(()=>Y(),[Y]),{data:F,error:v,isLoading:se,onPreview:Y}}function ee({payload:m,templateName:d,templateContent:P,payloadFormatError:w,setPayloadFormatError:S,className:F}){const v=(0,T.of)(l),{data:se,isLoading:Y,onPreview:h,error:me}=b(P,d,m,S),W=ye(me,w,se);return(0,e.jsxs)("div",{className:(0,a.cx)(v.container,F),children:[(0,e.jsx)(Ae.D,{label:(0,O.t)("alerting.template-preview.label-preview","Preview"),actions:(0,e.jsx)(G.$n,{disabled:Y,icon:"sync","aria-label":(0,O.t)("alerting.template-preview.aria-label-refresh-preview","Refresh preview"),onClick:h,size:"sm",variant:"secondary",children:(0,e.jsx)(O.x6,{i18nKey:"alerting.template-preview.refresh",children:"Refresh"})})}),(0,e.jsx)(j.a,{flex:1,children:(0,e.jsx)(V.Ay,{disableWidth:!0,children:({height:ve})=>(0,e.jsx)("div",{className:v.viewerContainer({height:ve}),children:W})})})]})}function xe({previews:m}){const d=(0,T.of)(l),P=m.length===1,w=S=>{try{return JSON.parse(S),!0}catch{return!1}};return(0,e.jsx)("ul",{className:d.viewer.container,"data-testid":"template-preview",children:m.map(S=>{const F=w(S.text)?"json":"plaintext";return(0,e.jsxs)("li",{className:d.viewer.box,children:[P?null:(0,e.jsxs)("header",{className:d.viewer.header,children:[S.name,(0,e.jsx)("div",{className:d.viewer.language,children:F})]}),(0,e.jsx)(ae.B,{containerStyles:d.editorContainer,language:F,showLineNumbers:!1,showMiniMap:!1,value:S.text,readOnly:!0,monacoOptions:{scrollBeyondLastLine:!1}})]},S.name)})})}function te({errors:m}){return m.map(d=>(0,e.jsx)(z.F,{title:(0,U.compact)([d.name,d.kind]).join(" \u2013 "),children:d.message},(0,U.uniqueId)("errors-list")))}const l=m=>({container:(0,a.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:m.shape.radius.default,border:`1px solid ${m.colors.border.medium}`}),editorContainer:(0,a.css)({width:"100%",height:"100%",border:"none"}),viewerContainer:({height:d})=>(0,a.css)({height:d,overflow:"auto",backgroundColor:m.colors.background.primary}),viewer:{container:(0,a.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,a.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${m.colors.border.medium}`,height:"inherit"}),header:(0,a.css)({display:"flex",justifyContent:"space-between",fontSize:m.typography.bodySmall.fontSize,padding:m.spacing(1,2),borderBottom:`1px solid ${m.colors.border.medium}`,backgroundColor:m.colors.background.secondary}),language:(0,a.css)({marginLeft:"auto",fontStyle:"italic"}),errorText:(0,a.css)({color:m.colors.error.text})}});function ye(m,d,P){const w=m?(0,_.JZ)(m):void 0,S=d||w,F=P?.results??[],v=P?.errors;return(0,e.jsxs)(e.Fragment,{children:[S&&(0,e.jsx)(z.F,{severity:"error",title:(0,O.t)("alerting.get-preview-results.title-error","Error"),children:S}),v&&(0,e.jsx)(te,{errors:v}),F&&(0,e.jsx)(xe,{previews:F})]})}},41542:(he,Z,t)=>{t.d(Z,{$:()=>U,Q:()=>V});var e=t(2543),a=t.n(e);function U(O,T){return O.filter(G=>!T.find(j=>JSON.stringify(j)===JSON.stringify(G)))}function V(O){const T=O.flatMap(j=>j);return(0,e.uniqBy)(T.filter(j=>T.filter(z=>(0,e.isEqual)(j,z)).length===Object.keys(O).length),j=>JSON.stringify(j))}}}]);

//# sourceMappingURL=4666.d76b0f48d38d49a6eb5c.js.map