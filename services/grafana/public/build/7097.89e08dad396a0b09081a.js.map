{"version":3,"file":"7097.89e08dad396a0b09081a.js","mappings":"qfAOO,MAAMA,GAAqB,sBAE3B,SAASC,GAAeC,EAAyD,CACtF,IAAIC,EAA6B,CAAC,MAAM,EACxC,OAAIC,GAAA,GAAO,eAAe,sBACxBD,EAA2B,KAAK,YAAY,EAE1CC,GAAA,GAAO,eAAe,sBACxBD,EAA2B,KAAK,OAAO,EAElC,CAAC,CAACD,EAAG,WAAaC,EAA2B,SAASD,EAAG,IAAI,CACtE,CAEO,SAASG,GAAaC,EAAc,CAEzC,MAAMC,EADU,eACI,KAAKD,CAAI,EAC7B,OAAIC,GAAOA,EAAI,OAAS,EACfA,EAAI,CAAC,EAAE,KAAK,EAEd,EACT,CAEO,SAASC,GAAeC,EAAuB,CAEpD,MAAMF,EADU,2BACI,KAAKE,CAAa,EACtC,OAAIF,GAAOA,EAAI,OAAS,EACf,KAAKA,EAAI,CAAC,EAAE,KAAK,CAAC,KAEpB,EACT,CAEO,SAASG,GAAgBJ,EAAc,CAE5C,MAAMC,EADU,gCACI,KAAKD,CAAI,EAC7B,OAAIC,GAAOA,EAAI,OAAS,EACfA,EAAI,CAAC,EAAE,KAAK,EAEd,EACT,CAEO,MAAMI,GAAoBC,GAAyB,CACxD,GAAI,CAACA,EACH,MAAO,GAET,MAAMC,EAAaD,EAAI,KAAK,EAAE,QAAQ,SAAU,EAAE,EAElD,MADgB,yDACD,KAAKC,CAAU,CAChC,EAEaC,GAA0BC,GAAgC,CACrE,MAAMC,EAAkB,CAAC,EACzB,OAAID,EAAM,QACRA,EAAM,QAAST,GAAS,CAClBA,EAAK,SACPU,EAAM,KAAKV,EAAK,OAAO,CAE3B,CAAC,EAEIU,CACT,EAEaC,GAAsB,CAACD,EAAiBE,IAAgC,CACnF,MAAMC,KAAc,KAClB,+CACA,mEACF,EACA,OAAOD,EAAM,IAAKE,GAAS,CACzB,GAAIA,EAAK,aAAeA,EAAK,aAAe,QAAS,CACnD,MAAMC,KAAmB,KACvB,qDACA,YAAYD,EAAK,WAAW,0DAC9B,EACAA,EAAK,QAAUC,CACjB,MAAWD,EAAK,SAAW,CAACJ,EAAM,SAASI,EAAK,OAAO,IACrDA,EAAK,QAAUD,GAEjB,MAAO,CAAE,GAAGC,CAAK,CACnB,CAAC,CACH,EAEaE,GAAgC,CAACN,EAAiBE,IAAsB,CACnF,MAAMC,EAAc,EAClB,+CACA,2EACF,EACA,OAAOD,EAAM,IAAKE,IACZA,EAAK,SAAW,CAACJ,EAAM,SAASI,EAAK,OAAO,IAC9CA,EAAK,QAAUD,GAEV,CAAE,GAAGC,CAAK,EAClB,CACH,EC/EaG,GAAe,CAAC,CAAE,UAAAC,EAAW,MAAAC,EAAO,SAAAC,EAAU,MAAAC,EAAO,SAAAC,CAAS,IAAa,CACtF,KAAM,CAACC,EAAWC,CAAY,KAAI,YAASzB,GAAaoB,CAAK,CAAC,EACxDM,KAAQ,MAAU,EAClBC,KAAS,MAAWC,EAAS,EAEnC,sBAAU,IAAM,CACTT,GACHM,EAAazB,GAAaoB,CAAK,CAAC,CAEpC,EAAG,CAACD,EAAWC,CAAK,CAAC,KAGnB,OAAC,OAAI,UAAWO,EAAO,QACpB,SAAAR,KACC,mBACE,mBAACU,EAAA,GACC,UAAWF,EAAO,MAClB,MAAOH,EACP,SAAWM,GAAU,CACnB,MAAMV,EAAQU,EAAM,cAAc,MAClCL,EAAaL,CAAK,EACdG,GACFA,EAAS,KAAKH,CAAK,IAAI,CAE3B,EACA,QAAS,CAAC,CAACE,EACX,OACEA,MACE,OAACS,EAAA,EAAO,CAAC,QAAST,EAChB,mBAACU,EAAA,EAAI,CAAC,KAAK,sBAAuB,GACpC,EAGN,EACF,KAEA,OAAC,QAAK,MAAO,CAAE,MAAOX,EAAWK,EAAM,OAAO,KAAK,SAAW,OAAQ,EACnE,SAAAN,GAASA,EAAM,KAAK,KACnB,OAACa,GAAA,EAAQ,CAAC,MAAOb,EAAO,SAAU,CAAE,QAAS,MAAa,KAAM,OAAQ,EAAG,KAE3E,OAAC,QAAK,UAAWO,EAAO,WACtB,mBAAC,KAAK,CAAC,QAAQ,qCAAqC,sBAAU,EAChE,EAEJ,EAEJ,CAEJ,EAEMC,GAAaF,IACV,CACL,WAAS,OAAI,CACX,QAASA,EAAM,QAAQ,EAAG,CAAC,CAC7B,CAAC,EACD,SAAO,OAAI,CACT,UAAW,CACT,WAAYA,EAAM,WAAW,mBAC/B,CACF,CAAC,EACD,cAAY,OAAI,CACd,UAAW,SACX,MAAOA,EAAM,OAAO,KAAK,SAC3B,CAAC,CACH,GC/DWQ,GAAsC,CAAC,CAAE,SAAAC,CAAS,IAAM,CACnE,MAAMR,KAAS,MAAW,EAAS,EAC7B,CACJ,aAAAS,EACA,SAAAC,EACA,QAAAC,EACA,MAAAC,EACA,UAAW,CAAE,OAAAC,CAAO,CACtB,KAAI,MAAsB,CACxB,KAAM,UACR,CAAC,EAEKC,EAAUF,EAAM,SAAS,EACzBtC,EAAOsC,EAAM,MAAM,EAEnBG,EAAU,IACPD,GAAS,OAAS,GAAKnC,GAAiBL,CAAI,EAGrD,SACE,QAAC,OAAI,UAAW0B,EAAO,UACrB,oBAAC,MAAG,UAAWA,EAAO,QACpB,mBAAC,KAAK,CAAC,QAAQ,+CAA+C,yBAAa,EAC7E,KACA,QAAC,OAAI,UAAWA,EAAO,QACrB,oBAAC,KAAK,CAAC,QAAS,uDAAwD,oBAAQ,KAChF,OAACT,GAAY,CAAC,MAAM,iDAAiD,SAAU,GAAM,GACvF,KAEA,OAAC,QAAK,GAAG,WAAW,SAAUkB,EAAaD,CAAQ,EAAG,UAAWR,EAAO,KACtE,oBAACgB,EAAA,EAAK,CAAC,IAAK,EAAG,UAAU,SACvB,oBAACC,EAAA,EAAK,CAAC,SAAO,KAAE,4CAA6C,MAAM,EACjE,mBAAC,MACC,OAAQ,CAAC,CAAE,MAAO,CAAE,SAAArB,EAAU,IAAAsB,EAAK,GAAGC,CAAM,CAAE,OAC5C,OAACC,GAAA,EAAU,CAAE,GAAGD,EAAO,WAAaE,GAAMzB,EAASyB,EAAE,OAAO,GAAG,EAAG,UAAWrB,EAAO,WAAY,EAElG,QAAAW,EACA,KAAK,UACL,MAAO,CACL,SAAU,CAAE,MAAO,GAAM,WAAS,KAAE,iDAAkD,UAAU,CAAE,CACpG,EACF,EACF,KACA,OAACM,EAAA,GACC,SAAO,KAAE,4CAA6C,MAAM,EAC5D,QAAS,CAAC,CAACJ,EAAO,KAClB,MAAOA,GAAQ,MAAM,QAErB,mBAACX,EAAA,GACC,UAAWF,EAAO,MAClB,KAAK,OACJ,GAAGU,EAAS,OAAQ,CACnB,SAAU,mBACV,SAAWY,GAAQ3C,GAAiB2C,CAAG,GAAK,0BAC9C,CAAC,EAED,YAAY,iDACZ,QAAS,CAAC,CAACT,EAAO,KACpB,EACF,KACA,OAAC,OAAI,UAAWb,EAAO,gBACrB,mBAACuB,EAAA,GAAM,CAAC,KAAK,SAAS,SAAU,CAACR,EAAQ,EACvC,mBAAC,KAAK,CAAC,QAAQ,sCAAsC,gBAAI,EAC3D,EACF,GACF,EACF,GACF,CAEJ,EAEM,GAAahB,IACV,CACL,aAAW,OAAI,CACb,QAASA,EAAM,QAAQ,CAAC,CAC1B,CAAC,EACD,WAAS,OAAI,CACX,MAAOA,EAAM,OAAO,KAAK,QACzB,OAAQ,OAAOA,EAAM,QAAQ,CAAC,CAAC,KAC/B,SAAUA,EAAM,WAAW,GAAG,QAChC,CAAC,EACD,WAAS,OAAI,CACX,aAAcA,EAAM,QAAQ,CAAC,EAC7B,MAAOA,EAAM,OAAO,KAAK,UACzB,SAAUA,EAAM,WAAW,KAAK,EAClC,CAAC,EACD,QAAM,OAAI,CACR,QAAS,OACT,cAAe,SACf,IAAKA,EAAM,QAAQ,CAAC,EACpB,MAAO,OACP,SAAU,OACZ,CAAC,EACD,SAAO,OAAI,CACT,MAAO,OACP,UAAW,CACT,WAAYA,EAAM,WAAW,oBAC7B,MAAO,MACT,CACF,CAAC,EACD,cAAY,OAAI,CACd,MAAO,MACT,CAAC,EACD,mBAAiB,OAAI,CACnB,QAAS,OACT,eAAgB,WAChB,UAAWA,EAAM,QAAQ,CAAC,CAC5B,CAAC,CACH,G,wCCnHK,MAAMyB,GAAY,CAAC,CAAE,KAAAC,EAAM,SAAA/B,EAAU,QAAAgC,CAAQ,IAAa,CAC/D,MAAM1B,KAAS,MAAW,EAAS,EACnC,GAAI,CAACyB,EACH,SAAO,oBAAE,EAIX,GAAI,CAACA,EAAK,MAAQ,CAACA,EAAK,UAAW,CACjC,MAAME,EAASF,EAAK,GACpB,SACE,OAAC,QAAK,UAAWzB,EAAO,SACtB,oBAAC,KAAK,CAAC,QAAQ,mCAAmC,0BAAc,CAAE,OAAA2B,CAAO,EAAE,cAAU,EACvF,CAEJ,CAEA,SACE,QAAC,OAAI,UAAW3B,EAAO,QACpB,UAAAyB,EAAK,cAAa,OAACG,GAAA,EAAM,CAAC,IAAKH,EAAK,UAAW,IAAI,EAAG,MACvD,OAAC,QAAK,aAAW,MAAGzB,EAAO,MAAO,CAAE,CAACA,EAAO,QAAQ,EAAGN,CAAS,CAAC,EAAI,SAAA+B,EAAK,KAAK,EAC9EC,MACC,OAACtB,EAAA,EAAO,CAAC,WAAS,OAACyB,EAAA,EAAG,CAAE,SAAAH,CAAA,CAAQ,EAC9B,mBAACrB,EAAA,EAAI,CAAC,KAAK,uBAAuB,UAAWL,EAAO,QAAS,EAC/D,GAEJ,CAEJ,EAEM,GAAaD,IACV,CACL,WAAS,OAAI,CACX,QAAS,OACT,WAAY,QACd,CAAC,EACD,SAAO,OAAI,CACT,SAAU,SACV,WAAYA,EAAM,QAAQ,CAAC,EAC3B,YAAaA,EAAM,QAAQ,CAAC,CAC9B,CAAC,EACD,UAAQ,OAAI,CACV,MAAO,OACP,OAAQ,MACV,CAAC,EACD,YAAU,OAAI,CACZ,MAAOA,EAAM,OAAO,KAAK,SAC3B,CAAC,EACD,YAAU,OAAI,CACZ,MAAOA,EAAM,OAAO,KAAK,QAC3B,CAAC,EACD,WAAS,OAAI,CACX,MAAOA,EAAM,OAAO,QAAQ,IAC9B,CAAC,CACH,GC9CW+B,GAAe,CAAC,CAAE,UAAAC,EAAW,KAAAN,EAAM,SAAA/B,EAAU,SAAAE,EAAU,QAAA8B,CAAQ,IAAyB,CACnG,KAAM,CAACM,EAAcC,CAAe,KAAI,YAAkC,CAAC,CAAC,EACtE,CAACC,EAAaC,CAAc,KAAI,YAA6C,CAAC,CAAC,EAC/E,CAACpD,EAAOqD,CAAQ,KAAI,YAASL,CAAS,EACtC,CAAClB,EAAQwB,CAAS,KAAI,YAA6C,CAAC,CAAC,EACrErC,KAAS,MAAW,EAAS,EAMnC,MAJA,aAAU,IAAM,CACdoC,EAASL,CAAS,CACpB,EAAG,CAACA,CAAS,CAAC,EAEV,CAACA,GAAW,OACd,OAAO,KAGT,MAAMO,EAAa,CAACC,EAAa9C,IAAmB,CAClD0C,EAAe,CAAE,GAAGD,EAAa,CAACK,CAAG,EAAK9C,EAAQV,EAAMwD,CAAG,EAAI,MAAU,CAAC,EAC1EN,EAAgB,CAAE,GAAGD,EAAc,CAACO,CAAG,EAAG9C,CAAM,CAAC,CACnD,EAEM+C,EAAe,CAACD,EAAa9C,IAAkB,CACnD0C,EAAe,CAAE,GAAGD,EAAa,CAACK,CAAG,EAAG9C,CAAM,CAAC,CACjD,EAEMgD,GAAUF,GAAgB,CAC9B,MAAMG,EAAUR,EAAYK,CAAG,EAC/B,GAAIG,EAAS,CACX,GAAI,CAAC/D,GAAiB+D,CAAO,EAAG,CAC9BL,EAAU,CAAE,GAAGxB,EAAQ,CAAC0B,CAAG,EAAG,0BAA2B,CAAC,EAC1D,MACF,CACA,MAAMI,GAAW5D,EAAM,IAAI,CAACT,GAAMsE,KACzBA,KAAML,GAAOG,EAAUA,EAAWpE,EAC1C,EACDsB,EAAS+C,EAAQ,EACjBV,EAAgB,CAAE,GAAGD,EAAc,CAACO,CAAG,EAAG,EAAM,CAAC,CACnD,CACF,EAEMM,EAAYN,GAAgB,CAChC,MAAMI,EAAW5D,EAAM,MAAM,EAAGwD,CAAG,EAAE,OAAOxD,EAAM,MAAMwD,EAAM,CAAC,CAAC,EAChE3C,EAAS+C,CAAQ,CACnB,EAEMG,EAAY,IAAM,CACtBb,EAAgB,CAAE,GAAGD,EAAc,CAACjD,EAAM,MAAM,EAAG,EAAK,CAAC,EACzDqD,EAASrD,EAAM,OAAO,EAAE,CAAC,CAC3B,EAEMgE,GAAYR,GAAgB,CAChCD,EAAWC,EAAK,EAAK,EACjBA,IAAQxD,EAAM,OAAS,GAAK,CAACA,EAAMwD,CAAG,GAExCH,EAASrD,EAAM,MAAM,EAAG,EAAE,CAAC,CAE/B,EAEA,SACE,oBACE,qBAAC,MAA4B,KAAK,MAChC,oBAAC,MACC,mBAACyC,GAAS,CAAC,KAAAC,EAAY,QAAAC,CAAA,CAAkB,EAC3C,KACA,OAAC,OAAG,KACJ,OAAC,MACC,mBAACnC,GAAA,CACC,MAAOR,EAAM,CAAC,EACd,UAAWiD,EAAa,CAAC,EACzB,MAAOnB,EAAO,CAAC,EACf,SAAWpB,GAAU+C,EAAa,EAAG/C,CAAK,EAC5C,EACF,KACA,OAAC,MACE,SAACC,KA2CA,OAAC,OAAI,UAAWM,EAAO,YACrB,mBAACuB,EAAA,IACC,WAAS,KAAE,oDAAqD,kBAAkB,EAClF,KAAK,KACL,KAAK,OACP,EACF,KAhDA,QAAC,OAAI,UAAWvB,EAAO,YACpB,UAAAjB,GAAO,SAAW,GAAK,CAACiD,EAAa,CAAC,MACrC,OAAC,OAAI,UAAWhC,EAAO,YACrB,mBAACgD,GAAA,GACC,KAAK,cACL,WAAS,KAAE,gDAAiD,cAAc,EAC1E,gBAAY,KAAE,oDAAqD,eAAe,EAClF,QAAS,IAAMF,EAAU,EAC3B,EACF,EAEAd,EAAa,CAAC,KASd,oBACE,oBAAC,OAAI,UAAWhC,EAAO,WACrB,mBAACuB,EAAA,GAAM,CAAC,KAAK,KAAK,QAAQ,UAAU,QAAS,IAAMkB,GAAO,CAAC,EACzD,mBAAC,KAAK,CAAC,QAAQ,gCAAgC,gBAAI,EACrD,EACF,KACA,OAAC,OAAI,UAAWzC,EAAO,WACrB,mBAACuB,EAAA,GAAM,CAAC,KAAK,KAAK,QAAQ,YAAY,QAAS,IAAMwB,GAAS,CAAC,EAC7D,mBAAC,KAAK,CAAC,QAAQ,kCAAkC,kBAAM,EACzD,EACF,GACF,KAnBA,OAAC,OAAI,UAAW/C,EAAO,WACrB,mBAACgD,GAAA,GACC,KAAK,MACL,gBAAY,KAAE,qDAAsD,gBAAgB,EACpF,QAAS,IAAMV,EAAW,EAAG,EAAI,EACnC,EACF,KAeF,OAAC,OAAI,UAAWtC,EAAO,YACrB,mBAACiD,GAAA,GACC,gBAAY,KAAE,kDAAmD,aAAa,EAC9E,KAAK,KACL,UAAW,IAAMJ,EAAS,CAAC,EAC7B,EACF,GACF,CAQA,CAEJ,IAjEO,GAAGpB,EAAK,GAAG,IAkEpB,EACC1C,EAAM,OAAS,GACdA,EAAM,MAAM,CAAC,EAAE,IAAI,CAACmE,EAAUX,OAC5B,QAAC,MAAkC,KAAK,MACtC,oBAAC,OAAG,KACJ,OAAC,MAAG,UAAWvC,EAAO,OACpB,mBAAC,KAAK,CAAC,QAAQ,8BAA8B,cAAE,EACjD,KACA,OAAC,MACC,mBAACT,GAAA,CACC,MAAO2D,EACP,UAAWlB,EAAaO,EAAM,CAAC,EAC/B,MAAO1B,EAAO0B,EAAM,CAAC,EACrB,SAAW9C,IAAU+C,EAAaD,EAAM,EAAG9C,EAAK,EAClD,EACF,KACA,OAAC,MACE,SAACC,KA2CA,OAAC,OAAI,UAAWM,EAAO,YACrB,mBAACuB,EAAA,IACC,WAAS,KAAE,oDAAqD,kBAAkB,EAClF,KAAK,KACL,KAAK,OACP,EACF,KAhDA,QAAC,OAAI,UAAWvB,EAAO,YACpB,UAAAuC,IAAQxD,GAAO,OAAS,GAAK,CAACiD,EAAaO,EAAM,CAAC,MACjD,OAAC,OAAI,UAAWvC,EAAO,YACrB,mBAACgD,GAAA,GACC,KAAK,cACL,WAAS,KAAE,gDAAiD,cAAc,EAC1E,gBAAY,KAAE,oDAAqD,eAAe,EAClF,QAAS,IAAMF,EAAU,EAC3B,EACF,EAEAd,EAAaO,EAAM,CAAC,KASpB,oBACE,oBAAC,OAAI,UAAWvC,EAAO,WACrB,mBAACuB,EAAA,GAAM,CAAC,KAAK,KAAK,QAAQ,UAAU,QAAS,IAAMkB,GAAOF,EAAM,CAAC,EAC/D,mBAAC,KAAK,CAAC,QAAQ,gCAAgC,gBAAI,EACrD,EACF,KACA,OAAC,OAAI,UAAWvC,EAAO,WACrB,mBAACuB,EAAA,GAAM,CAAC,KAAK,KAAK,QAAQ,YAAY,QAAS,IAAMwB,GAASR,EAAM,CAAC,EACnE,mBAAC,KAAK,CAAC,QAAQ,kCAAkC,kBAAM,EACzD,EACF,GACF,KAnBA,OAAC,OAAI,UAAWvC,EAAO,WACrB,mBAACgD,GAAA,GACC,KAAK,MACL,gBAAY,KAAE,qDAAsD,gBAAgB,EACpF,QAAS,IAAMV,EAAWC,EAAM,EAAG,EAAI,EACzC,EACF,KAeF,OAAC,OAAI,UAAWvC,EAAO,YACrB,mBAACiD,GAAA,GACC,gBAAY,KAAE,kDAAmD,aAAa,EAC9E,KAAK,KACL,UAAW,IAAMJ,EAASN,EAAM,CAAC,EACnC,EACF,GACF,CAQA,CAEJ,IAjEO,GAAGd,EAAK,GAAG,IAAIc,EAAM,CAAC,EAkE/B,CACD,GACL,CAEJ,EAEM,GAAaxC,IACV,CACL,cAAY,OAAI,CACd,QAAS,OACT,WAAY,SACZ,WAAYA,EAAM,QAAQ,CAAC,CAC7B,CAAC,EACD,eAAa,OAAI,CACf,QAAS,OACT,WAAY,SACZ,WAAYA,EAAM,QAAQ,CAAC,EAC3B,YAAaA,EAAM,QAAQ,EAAG,CAChC,CAAC,EACD,eAAa,OAAI,CACf,QAAS,OACT,eAAgB,MAChB,WAAY,QACd,CAAC,EACD,UAAQ,OAAI,CACV,MAAOA,EAAM,OAAO,KAAK,SAC3B,CAAC,CACH,GC3NK,SAASoD,GAAiB,CAAE,cAAAC,EAAe,MAAApE,CAAM,EAAmD,CACzG,KAAM,CAACqE,EAAaC,CAAc,KAAI,YAAS,EAAE,EAC3C,CAACC,EAAWC,CAAY,KAAI,YAAyB,KAAK,EAG1DC,KAAmB,WAAQ,IACxB,IAAI,IAAoBzE,EAAM,IAAKyC,GAAS,CAACA,EAAK,IAAKA,EAAK,MAAQ,EAAE,CAAC,CAAC,EAC9E,CAACzC,CAAK,CAAC,EAEJ0E,KAAkB,WAAQ,IACvBH,IAAc,SACjB,KAAE,6DAA8D,gBAAgB,KAChF,KAAE,8DAA+D,gBAAgB,EACpF,CAACA,CAAS,CAAC,EAGRI,KAAyB,WAAQ,IAAM,CAC3C,MAAMC,EAAc,CAAC,GAAGR,CAAa,EAAE,KAAK,CAACS,EAAGC,IAAM,CACpD,MAAMC,EAAQN,EAAiB,IAAII,EAAE,OAAO,GAAK,GAC3CG,EAAQP,EAAiB,IAAIK,EAAE,OAAO,GAAK,GACjD,OAAOP,IAAc,MAAQQ,EAAM,cAAcC,CAAK,EAAIA,EAAM,cAAcD,CAAK,CACrF,CAAC,EAED,OAAKV,EAIEO,EAAY,OAAQtF,IACRmF,EAAiB,IAAInF,EAAK,OAAO,GAAK,IACvC,YAAY,EAAE,SAAS+E,EAAY,YAAY,CAAC,CACjE,EANQO,CAOX,EAAG,CAACR,EAAeK,EAAkBJ,EAAaE,CAAS,CAAC,EAGtDU,KAAkB,eAAY,IAAM,CACxCT,EAAaD,IAAc,MAAQ,OAAS,KAAK,CACnD,EAAG,CAACA,CAAS,CAAC,EAGRW,KAAc,eAAY,IAAM,CACpCZ,EAAe,EAAE,CACnB,EAAG,CAAC,CAAC,EAEL,MAAO,CACL,YAAAD,EACA,eAAAC,EACA,UAAAC,EACA,gBAAAU,EACA,gBAAAP,EACA,uBAAAC,EACA,YAAAO,CACF,CACF,C,gBCnEO,SAASC,GAAYC,EAAgC,CAC1D,MAAO,OAAOC,GAAa,CACzB,MAAMC,EAAiB,QAAM,MAAc,EAAE,IAAI,uBAAuBF,CAAG,aAAa,EACxFC,KAAS,OAAeC,CAAc,CAAC,CACzC,CACF,CAEO,SAASC,GAAoBH,EAAaI,EAAyC,CACxF,MAAO,OAAOH,GAAa,CACzB,QAAM,MAAc,EAAE,IAAI,uBAAuBD,CAAG,cAAe,CAAE,GAAGI,CAAK,CAAC,EAC9EH,EAASF,GAAYC,CAAG,CAAC,CAC3B,CACF,CCyBA,SAASK,GAAgBC,EAA6B,CACpD,MAAO,CACL,eAAgBA,EAAM,UAAU,cAClC,CACF,CAEA,MAAMC,GAAqB,CACzB,YAAW,GACX,oBAAmB,EACrB,EAEaC,MAAY,WAAQH,GAAiBE,EAAkB,EAGvDE,GAA4B,CAAC,CACxC,eAAAP,EACA,iBAAAQ,EACA,SAAAC,EACA,iBAAAC,EACA,YAAAb,EACA,oBAAAI,EACA,MAAArF,CACF,IAAa,CACX,KAAM,CAACF,EAAOiG,CAAQ,KAAI,YAAiE,CAAC,CAAC,EACvF,CAACC,EAAcC,CAAe,KAAI,YAAS,EAAK,EAChD,CAACC,EAAkBC,CAAmB,KAAI,YAAsB,IAAI,GAAa,EACjF,CAACC,EAAkBC,CAAmB,KAAI,YAAsB,IAAI,GAAa,EACjF,CAACC,EAAiCC,EAAiC,KAAI,YAAsB,IAAI,GAAa,EAC9GrC,KAAgB,WAAQ,IAAMkB,GAAgB,OAAS,CAAC,EAAG,CAACA,GAAgB,KAAK,CAAC,EAClFtE,KAAS,MAAW,EAAS,EAC7B,CAAC0F,GAAsBC,CAAuB,KAAI,YAAS,EAAK,EAGhE,CACJ,YAAAtC,EACA,eAAAC,GACA,UAAAC,GACA,gBAAAU,GACA,gBAAAP,GACA,uBAAAC,GACA,YAAAO,EACF,EAAIf,GAAiB,CAAE,cAAAC,EAAe,MAAApE,CAAM,CAAC,KAE7C,aAAU,IAAM,CACdmF,EAAYW,EAAiB,GAAG,CAClC,EAAG,CAACA,EAAiB,IAAKX,CAAW,CAAC,KAEtC,aAAU,IAAM,EACK,SAAY,CAC7B,MAAMyB,EAAWxC,EAAc,IAAKyC,IAAMA,GAAE,OAAO,EAAE,OAAO,OAAO,EAGnE,GAAI,CAFsB,CAAC,GAAG,IAAI,IAAID,CAAQ,CAAC,GAEvB,OACtB,OAOF,MAAM5G,IAJS,QAAM,MAAc,EAAE,IAAI,oBAAqB,CAC5D,QAAS4G,CACX,CAAC,IACkC,OACV,IAAKnE,KAAU,CACtC,GAAIA,GAAK,GACT,IAAKA,GAAK,IACV,MAAOA,GAAK,GACZ,KAAMA,GAAK,KACX,UAAWA,GAAK,SAClB,EAAE,EACFwD,EAASjG,CAAK,CAChB,GACW,CACb,EAAG,CAACoE,CAAa,CAAC,KAElB,aAAU,IAAM,CACd,GAAI,CAAClE,GAAO,OACV,OAEF,MAAM4G,EAAY,IAAI,IAAI1C,EAAc,IAAKyC,GAAMA,EAAE,OAAO,CAAC,EACvDE,EAAgB,IAAI,IAAI7G,EAAM,IAAK2G,GAAMA,EAAE,OAAO,CAAC,EACnDG,EAA6B,IAAI,IACrC9G,EACG,OAAQ2G,GAAM,OAAOA,EAAE,aAAgB,UAAYA,EAAE,YAAY,KAAK,IAAM,IAAMA,EAAE,aAAe,OAAO,EAC1G,IAAKA,GAAMA,EAAE,WAAqB,CACvC,EAEMI,EAAgC,IAAI,IACxC,MAAM,KAAKF,CAAa,EACrB,OAAQG,GAAMA,IAAM,QAAa,CAACJ,EAAU,IAAII,EAAE,SAAS,CAAC,CAAC,EAC7D,IAAKA,GAAMA,GAAG,SAAS,GAAK,EAAE,CACnC,EACMV,EAAkC,IAAI,IAC1C,MAAM,KAAKM,CAAS,EAAE,OAAQI,GAAMA,GAAK,CAACH,EAAc,IAAIG,EAAE,SAAS,CAAC,CAAC,CAC3E,EAEIV,GACFC,GAAkCD,CAA+B,EAE/DS,GACFV,EAAoBU,CAAgB,EAElCD,GACFX,EAAoBW,CAAa,CAErC,EAAG,CAAC9G,EAAOkE,CAAa,CAAC,EAEzB,MAAM+C,MAA2B,eAC/B,MAAOpH,GAAsB,CAC3B,MAAMwF,EAAoBO,EAAiB,IAAK,CAAE,MAAA/F,CAAM,CAAC,EACzD,MAAMiG,EAAiB,CACzB,EACA,CAACF,EAAiB,IAAKE,EAAkBT,CAAmB,CAC9D,EAEM6B,GAAe,MAAO,CAAE,QAAAtF,EAAS,KAAAxC,CAAK,IAAoB,CAC9D,IAAI+H,EAA2B,CAAC,EACNjD,EAAc,KAAMrB,GAAcA,EAAU,UAAYjB,EAAQ,SAAS,CAAC,EAGlGuF,EAAejD,EAAc,IAAKrB,GAC5BA,EAAU,UAAYjB,EAAQ,SAAS,EAClC,CAAE,GAAGiB,EAAW,MAAO,CAAC,GAAGA,EAAU,MAAOvD,GAAeF,CAAI,CAAC,CAAE,EAEpE,CAAE,GAAGyD,CAAU,CACvB,EAEDsE,EAAejD,EAAc,OAAO,CAClC,QAAStC,EAAQ,SAAS,EAC1B,MAAO,CAACtC,GAAeF,CAAI,CAAC,CAC9B,CAAC,EAEH,MAAM6H,GAAyBE,CAAY,EAC3ClB,EAAgB,EAAK,CACvB,EAEMmB,GAAgB,MAAOC,EAAwBF,IAA2B,CAC9E,MAAMG,EAAmBpD,EAAc,IAAKyC,GACtCA,EAAE,UAAYU,EACT,CAAE,GAAGV,EAAG,MAAOQ,CAAa,EAE9BR,CACR,EACD,MAAMM,GAAyBK,CAAgB,CACjD,EAEMC,GAAU,KAAW,cAAc,sBAAkB,2BAA2B,GAAK,CAAC1B,EACtF2B,GAAkBtH,GAA6B,CACnD,GAAIA,EAAK,OACP,OAAOA,EAAK,UACP,GAAIA,EAAK,OACd,OAAOA,EAAK,KACP,GAAIA,EAAK,YACd,OAAOA,EAAK,WAGhB,EAEA,SACE,QAACyC,EAAA,EAAG,CAAC,cAAe,EACjB,UAAAkD,MAAY,OAAC4B,GAAA,EAAyB,EAAC,KACxC,QAAC3F,EAAA,EAAK,CAAC,UAAU,SAAS,IAAK,EAC7B,qBAAC4F,GAAA,GACC,SAAO,KAAE,0DAA2D,aAAa,EACjF,eAAa,KACX,gEACA,mGACF,EAEE,WAAApB,EAAgC,KAAO,GAAKF,EAAiB,KAAO,GAAKF,EAAiB,KAAO,IACjGhC,EAAc,OAAS,MACrB,QAACvB,EAAA,EAAG,CAAC,aAAc,EACjB,oBAACgF,GAAA,GACC,MACEnB,MACE,KACE,4EACA,qCACF,KAEA,QAAC1E,EAAA,EAAK,CAAC,UAAU,MAAM,WAAW,SAAS,IAAK,EAC9C,oBAACZ,EAAA,GACC,WAAS,KACP,qEACA,uBACF,EAEA,mBAACC,EAAA,EAAI,CAAC,KAAK,uBAAuB,UAAWL,EAAO,QAAS,EAC/D,KACA,OAAC,KAAK,CAAC,QAAQ,4EAA4E,+CAE3F,GACF,EAGJ,OAAQ0F,GACR,SAAU,IAAMC,EAAwB,CAACD,EAAoB,EAC/D,EACCA,OACC,QAACoB,EAAA,GACC,SAAO,KACL,6EACA,gCACF,EACA,SAAS,UAET,oBAAC,KACC,mBAAC,KAAK,CAAC,QAAQ,mFAAmF,iFAElG,EACF,KACA,QAAC,MAAG,UAAW9G,EAAO,YACnB,UAAAwF,EAAgC,KAAO,MACtC,QAAC,MACC,qBAAC,KAAK,CAAC,QAAQ,8DACb,oBAAC,UAAO,kCAAsB,EAAS,oJAGzC,KACA,OAAC,MACE,eAAM,KAAKA,CAA+B,EAAE,IAAK/D,GAAS,CACzD,MAAMsF,EAAW/H,GAAO,KAAMqC,GAAMA,EAAE,KAAK,SAAS,IAAMI,CAAI,GAAG,KACjE,SACE,OAAC,MAAG,UAAWzB,EAAO,YACnB,SAAA+G,CAAA,EADqCtF,CAExC,CAEJ,CAAC,EACH,GACF,EAED6D,EAAiB,KAAO,MACvB,QAAC,MACC,qBAAC,KAAK,CAAC,QAAQ,4DACb,oBAAC,UAAO,gCAAoB,EAAS,iFAEvC,KACA,OAAC,MACE,eAAM,KAAKA,CAAgB,EAAE,IAAK7D,GAAS,CAC1C,MAAMmB,EAAI1D,GAAO,KAAMmC,GAAMA,EAAE,SAAS,SAAS,IAAMI,CAAI,EAC3D,OAAKmB,KAIH,OAAC,MAAG,UAAW5C,EAAO,YACnB,SAAA0G,GAAe9D,CAAC,GADqBnB,CAExC,EALO,IAOX,CAAC,EACH,GACF,EAED2D,EAAiB,KAAO,MACvB,QAAC,MACC,qBAAC,KAAK,CAAC,QAAQ,mEACb,oBAAC,UAAO,uCAA2B,EAAS,oEAE9C,KACA,OAAC,MACE,eAAM,KAAKA,CAAgB,EAAE,IAAK4B,MAE/B,OAAC,MAAG,UAAWhH,EAAO,YACnB,iBAAE,0DAA2D,iBAAkB,CAC9E,KAAAgH,CACF,CAAC,GAHqCA,CAIxC,CAEH,EACH,GACF,GAEJ,GACF,GAEJ,KAEJ,QAAChG,EAAA,EAAK,CAAC,UAAW,SAAU,IAAK,EAC/B,qBAACA,EAAA,EAAK,CAAC,UAAW,SAChB,oBAACiG,EAAA,EAAI,CAAC,QAAS,KACb,mBAAC,KAAK,CAAC,QAAQ,uEAAuE,6CAEtF,EACF,KACA,QAACjG,EAAA,EAAK,CAAC,WAAY,CAAE,GAAI,aAAc,GAAI,QAAS,EAAG,UAAW,CAAE,GAAI,SAAU,GAAI,KAAM,EAC1F,oBAACiG,EAAA,EAAI,CAAC,QAAS,YAAa,MAAO,YACjC,mBAAC,KAAK,CAAC,QAAQ,yDAAyD,8EAExE,EACF,KACA,OAACC,GAAA,GACC,QAAS,YACT,SAAQ,GACR,KAAK,0HAEL,mBAAC,KAAK,CAAC,QAAQ,oEAAoE,uCAEnF,EACF,GACF,GACF,EACCT,OACC,QAACzF,EAAA,EAAK,CAAC,UAAW,CAAE,GAAI,iBAAkB,GAAI,KAAM,EAAG,WAAY,aAAc,IAAK,EACpF,oBAAC,MACC,QAAS,IAAMmE,EAAgB,CAACD,CAAY,EAC5C,KAAMA,EAAe,aAAe,OACpC,gBAAeA,EAEd,SAAAA,KACG,KAAE,uDAAwD,gBAAgB,KAC1E,KAAE,wDAAyD,iBAAiB,EAClF,EACC,IAAC,WAAQ9B,CAAa,MACrB,OAAC+D,GAAA,GACC,eAAa,KAAE,iEAAkE,cAAc,EAC/F,MAAO9D,EACP,SAAUC,GACV,MAAO,GACP,YAAa,GACb,gBAAY,KACV,gEACA,gCACF,EACF,EAED4B,MACC,OAACrD,EAAA,EAAG,CAAC,UAAW,EACd,mBAACtB,GAAkB,CAAC,SAAU6F,EAAA,CAAc,EAC9C,GAEJ,GAEJ,GACF,EACC,IAAC,WAAQzC,EAAsB,MAC9B,QAAC,OAAI,UAAW3D,EAAO,eACpB,cAAC,WAAQqD,CAAW,MACnB,OAACxB,EAAA,EAAG,CAAC,aAAc,EACjB,oBAACoF,EAAA,EAAI,CAAC,QAAQ,YACX,UAAAtD,GAAuB,SAAW,KAC/B,KAAE,8DAA+D,kBAAkB,KACnF,KAAE,gEAAiE,4BAA6B,CAC9F,MAAOA,GAAuB,MAChC,CAAC,KACL,OAACpC,EAAA,IACC,QAAS2C,GACT,KAAK,OACL,KAAK,KACL,KAAK,QACL,QAAQ,YACR,gBAAY,KAAE,gEAAiE,cAAc,EAE5F,iBAAE,qDAAsD,OAAO,EAClE,GACF,EACF,KAEF,QAAC,SAAM,UAAWlE,EAAO,MAAO,KAAK,OAAO,kBAAgB,kBAC1D,oBAAC,SACC,oBAAC,MACC,oBAAC,MACC,MAAO,CAAE,MAAO,KAAM,EACtB,UAAWA,EAAO,eAClB,QAASiE,GACT,YAAWV,KAAc,MAAQ,YAAc,aAE/C,oBAACvC,EAAA,EAAK,CAAC,UAAU,MAAM,WAAW,SAAS,IAAK,EAC9C,oBAAC,KAAK,CAAC,QAAQ,6CAA6C,gBAAI,KAChE,OAACZ,EAAA,EAAO,CAAC,QAASsD,GAChB,mBAACrD,EAAA,EAAI,CAAC,KAAMkD,KAAc,MAAQ,WAAa,aAAc,cAAY,MAAO,GAClF,GACF,EACF,KACA,OAAC,MAAG,MAAO,CAAE,MAAO,IAAK,EAAG,KAC5B,OAAC,MACC,mBAAC,KAAK,CAAC,QAAQ,uDAAuD,0BAAc,EACtF,KACA,OAAC,MAAG,MAAO,CAAE,MAAO,IAAK,EAAG,GAC9B,EACF,KACA,OAAC,SACE,SAAAI,GAAuB,IAAI,CAAC5B,EAAqBQ,IAAgB,CAChE,MAAMxD,EAAQgD,EAAU,MAClBwE,EAAiBxE,EAAU,QACjC,IAAIL,EAAU,GACd,OAAI8D,EAAgC,IAAIe,CAAc,IACpD7E,EAAU,0EAGV,OAACI,GAAA,CAEC,UAAW/C,EACX,SAAU,CAAC0H,GACX,KACEzH,EAAM,KAAMqC,GAAMA,EAAE,MAAQU,EAAU,OAAO,GAAK,CAChD,KAAM,GACN,UAAW,GACX,IAAK,EACP,EAEF,SAAWsE,GAAiBC,GAAcC,EAAgBF,CAAY,EACtE,QAAA3E,CAAA,EAXKa,CAYP,CAEJ,CAAC,EACH,GACF,KACA,OAACV,EAAA,EAAG,CAAC,UAAW,EACd,mBAACoF,EAAA,EAAI,CAAC,QAAQ,YAAY,MAAM,YAC9B,oBAAC,KAAK,CAAC,QAAQ,wDAAwD,qBAErE,OAAC,OAAG,EAAE,kJAGN,OAAC,OAAG,EAAE,+FACR,EACF,EACF,GACF,GAEJ,GACF,CAEJ,EAEM,GAAalH,IACV,CACL,WAAS,OAAI,CACX,GAAGA,EAAM,WAAW,UACpB,MAAOA,EAAM,OAAO,QAAQ,IAC9B,CAAC,EACD,eAAa,OAAI,CACf,GAAGA,EAAM,WAAW,UACpB,kBAAmB,SACnB,WAAYA,EAAM,QAAQ,CAAC,CAC7B,CAAC,EACD,SAAO,OAAI,CACT,GAAGA,EAAM,WAAW,UACpB,MAAO,OACP,eAAgB,WAChB,aAAc,CACZ,QAASA,EAAM,QAAQ,CAAC,EACxB,aAAc,aAAaA,EAAM,OAAO,OAAO,IAAI,EACrD,EACA,OAAQ,CACN,UAAW,OACX,WAAYA,EAAM,WAAW,gBAC/B,CACF,CAAC,EACD,kBAAgB,OAAI,CAClB,OAAQ,UACR,UAAW,CACT,MAAOA,EAAM,OAAO,KAAK,IAC3B,CACF,CAAC,EACD,kBAAgB,OAAI,CAClB,UAAW,MACb,CAAC,CACH,GAGWqH,GAAiBxC,GAAUC,EAAyB,EClejE,SAAS,GAAgBH,EAA6B2C,EAAsB,CAC1E,KAAM,CAAE,IAAAjD,CAAI,EAAIiD,EAChB,MAAO,CACL,WAAYjD,EACZ,iBAAkBM,EAAM,YAAY,WACpC,eAAgBA,EAAM,UAAU,cAClC,CACF,CAEA,MAAM,GAAqB,CACzB,eAAc,KACd,mBAAkB,KAClB,iBAAgB,IAClB,EAiFA,MA/EyB,WAAQ,GAAiB,EAAkB,EAItC,CAAC,CAC7B,WAAA4C,EACA,iBAAAxC,EACA,eAAAR,EACA,eAAAiD,EACA,mBAAAC,EACA,iBAAAC,CACF,IAAa,IACX,aAAU,IAAM,CACdF,EAAeD,CAAU,CAC3B,EAAG,CAACA,EAAYC,CAAc,CAAC,EAE/B,MAAMG,EAAoB,KAAW,wBACnC,sBAAkB,4BAClB5C,CACF,KAEA,aAAU,IAAM,CAEdyC,EAAeD,CAAiB,EAAE,KAAKE,CAAkB,CAC3D,EAAG,CAACD,EAAgBC,EAAoBF,CAAU,CAAC,EAEnD,MAAMtC,EAAmB,IAAM,CAC7BuC,EAAeD,CAAU,CAC3B,EAEMK,EAAkB,IACdzI,GAAgC,CACtC,GAAI,CAAC0I,GAAgB,CAACtD,GAAgB,OAAO,OAC3C,OAAOpF,EAET,MAAM2I,EAAsB/I,GAAuBwF,GAAgB,KAAK,EACxE,OAAOrF,GAAoB4I,EAAqB3I,CAAK,CACvD,EAGI,CAAE,SAAA6F,EAAU,eAAA+C,CAAe,KAAI,MAAoBhD,EAAiB,GAAG,EACvE8C,EAAe3J,GAAe6G,CAAgB,EAC9CiD,EAAehD,GAAY,CAAC2C,GAAqB,CAACI,EAExD,SACE,QAAC9G,EAAA,EAAK,CAAC,UAAW,SAAU,IAAK,EAC9B,mBAAe,MACd,OAACgH,EAAA,IACC,UAAW,0BACX,aAAc,QACd,YAAa,0BACb,QAAM,KACJ,0FACA,2EACF,EACF,KAEF,OAAC,KACC,SAAS,cACT,WAAAV,EACA,kBAAAI,EACA,YAAaE,EAAeD,EAAgB,EAAI,OAChD,SACEC,EACK1I,MACC,OAACkI,GAAA,CACC,iBAAAtC,EACA,SAAUiD,EACV,iBAAA/C,EACA,MAAA9F,CAAA,CACF,EAEF,OAER,GACF,CAEJ,CAE8C,C,oFC7GvC,MAAM+I,EACX,yIAEK,SAAStB,GAA4B,CAC1C,SACE,OAAC,KACC,cAAa,KAAa,MAAM,WAAW,SAC3C,SAAS,OACT,SAAO,KAAE,0EAA2E,yBAAyB,EAE5G,SAAAsB,CAAA,CACH,CAEJ,C,+RCWO,MAAMC,GAA6B9D,GAAgB,CACxD,MAAMC,KAAW,MAAY,KAE7B,aAAU,KACRA,KAAS,MAAuBD,CAAG,CAAC,EAE7B,UAAmB,CACxBC,KACE,KAAc,CACZ,cAAgBK,GAAWA,EAAM,mBAAqB,IACxD,CAAC,CACH,CACF,GACC,CAACN,EAAKC,CAAQ,CAAC,CACpB,EAEa8D,EAAqB/D,GAAgB,CAChD,MAAMC,KAAW,MAAY,EAE7B,MAAO,IAAMA,KAAS,MAAeD,EAAK,IAAO,eAAe,CAAC,CACnE,EAEagE,EAAqB,IAAM,CACtC,MAAM/D,KAAW,MAAY,EACvBgE,KAAY,MAAa3D,GAAUA,EAAM,YAAY,oBAAoB,EACzE4D,KAAc,MAAa5D,GAAUA,EAAM,YAAY,WAAW,EAExE,sBAAU,IAAM,CACdL,KAAS,MAAgB,CAAC,CAC5B,EAAG,CAACA,CAAQ,CAAC,EAEN,CAAE,UAAAgE,EAAW,YAAAC,CAAY,CAClC,EAEaC,EAAqBnE,GAAgB,CAChD,MAAMC,EAAW,YAAY,EAE7B,UAAU,IAAM,CACdA,EAAS,eAAeD,CAAG,CAAC,CAC9B,EAAG,CAACC,EAAUD,CAAG,CAAC,CACpB,EAEaoE,GAA2B,IAAM,CAC5C,MAAMnE,KAAW,MAAY,KAE7B,aAAU,IAAM,CACdA,KAAS,MAAsB,CAAC,CAClC,EAAG,CAACA,CAAQ,CAAC,CACf,EAEaoE,EAAmB,IAAM,CACpC,MAAMpE,KAAW,MAAY,EAE7B,OAAQqE,GAAiC,CACvCrE,KAAS,MAAcqE,EAAQ,IAAO,eAAe,CAAC,CACxD,CACF,EAEaC,EAAsB,IAAM,CACvC,MAAMtE,KAAW,MAAY,EAE7B,MAAO,OAAOuE,GAAmCvE,KAAS,MAAiBuE,CAAU,CAAC,CACxF,EAEaC,EAA4B,IAAM,CAC7C,MAAMxE,KAAW,MAAY,EACvB,CAAE,KAAAyE,CAAK,KAAI,MAAapE,GAAUA,EAAM,YAAY,UAAU,EAEpE,MAAO,IAAM,CACX,IAAU,QACR,IAAI,KAAsB,CACxB,SAAO,KAAE,yDAA0D,QAAQ,EAC3E,KAAM,wCAAwCoE,CAAI,iBAClD,QAAS,SACT,KAAM,YACN,UAAW,IAAMzE,KAAS,MAAuB,CAAC,CACpD,CAAC,CACH,CACF,CACF,EAEa0E,EAAiB3E,MACrB,MAAaM,MAAU,MAAcA,EAAM,YAAaN,CAAG,CAAC,EAGxD4E,GAA2B5E,GAAgB,CACtD,MAAMwE,EAAaG,EAAc3E,CAAG,EACpC,SAAO,KAA8BwE,CAAU,CACjD,EAEaK,EAAqBC,MACzB,MAAaxE,MAAU,MAAkBA,EAAM,YAAawE,CAAU,CAAC,EAGnEC,GAAwB,OAC5B,MAAazE,GAAUA,EAAM,kBAAkB,EAG3C0E,GAAuBhF,GAAkC,CACpE,MAAMwE,EAAaG,EAAc3E,CAAG,EAC9BW,EAAW6D,EAAW,WAAa,GACnCd,EAAiB,KAAW,wBAAwB,IAAoB,iBAAkBc,CAAU,EACpGS,GAAkB,KAAW,wBAAwB,IAAoB,kBAAmBT,CAAU,EAE5G,MAAO,CACL,SAAA7D,EACA,eAAA+C,EACA,gBAAAuB,EACF,CACF,C,8DCvIO,MAAMC,EAAiCV,GAA2D,CACvG,MAAMW,EAAe,KAAK,UAAU,CAAE,WAAYX,EAAW,KAAM,QAAS,SAAU,CAAC,EAGvF,OAFmB,KAAQ,UAAU,IAAa,cAAc,UAAU,EAAG,CAAE,KAAMW,CAAa,CAAC,CAGrG,C,6DCJA,MAAM3C,EAAgB,CAAC,CAAE,SAAA4C,EAAU,GAAGnC,CAAM,IACnB,gBAA6B,IAAsB,CAAE,GAAGA,EAAO,KAAM,SAAU,EAAGmC,CAAQ,C,oFCAnH,MAAMC,EAAuB,CAAC,CAC5B,SAAAD,EACA,MAAAE,EACA,YAAAC,EACA,cAAAC,EAAgB,GAChB,gBAAAC,EAAkB,GAClB,KAAAC,EAAO,UACP,UAAAC,CACF,IAAM,CACJ,KAAM,CAAE,OAAAC,EAAQ,WAAAC,GAAY,QAAAC,CAAQ,KAAI,MAAU,EAC5C,CAACC,EAAQC,CAAS,KAAI,YAASR,EAAgBC,EAAkB,EAAI,EACrEQ,GAAWF,EAAS,WAAa,aACjCG,EAAeR,IAAS,cACxBS,EAA6B,GAAGJ,EAAS,WAAa,QAAQ,YAAYT,CAAK,GAC/E1J,EAAS,CACb,UAAQ,OAAI,CACV,QAAS,OACT,eAAgB,gBAChB,WAAY,QACd,CAAC,EACD,SAAO,OAAI,CACT,OAAQ,CACV,CAAC,EACD,YAAU,OAAI,CACZ,OAAQ,EACR,WAAYiK,GAAW,iBACzB,CAAC,EACD,mBAAiB,OAAI,CACnB,UAAWC,EAAQI,EAAe,IAAO,EAAG,EAC5C,aAAc,EACd,GAAGL,GAAW,UACd,MAAOD,EAAO,KAAK,SACrB,CAAC,EACD,WAAS,OAAI,CACX,UAAWE,EAAQ,CAAC,CACtB,CAAC,CACH,EACA,OAAuB,gBAA6B,MAAO,CAAE,UAAAH,CAAU,EAAmB,gBAA6B,MAAO,CAAE,UAAW/J,EAAO,MAAO,EAAG8J,IAAS,UAA4B,gBAA6B,KAAM,CAAE,UAAW9J,EAAO,KAAM,EAAG0J,CAAK,EAAoB,gBAA6B,KAAM,CAAE,UAAW1J,EAAO,QAAS,EAAG0J,CAAK,EAAGE,GAAiC,gBACpY,IACA,CACE,KAAMS,GACN,QAAS,IAAMD,EAAU,CAACD,CAAM,EAChC,KAAM,SACN,KAAM,KACN,aAAcI,CAChB,CACF,CAAC,EAAGZ,GAA+B,gBAA6B,IAAK,CAAE,UAAW3J,EAAO,eAAgB,EAAG2J,CAAW,EAAGQ,GAA0B,gBAA6B,MAAO,CAAE,UAAWnK,EAAO,OAAQ,EAAGwJ,CAAQ,CAAC,CAClO,C,+FC7CA,SAASlJ,EAAS,CAAE,MAAAkK,EAAO,SAAAC,EAAU,UAAAV,CAAU,EAAG,CAChD,MAAMhK,KAAQ,MAAU,EAClBC,EAASC,EAAUF,CAAK,EACxB2K,EAAc,YAAgBF,EAAOC,EAAS,QAASA,EAAS,IAAI,EAC1E,OAAuB,gBACrB,MACA,CACE,aAAW,MAAGzK,EAAO,YAAa,yBAA0B+J,CAAS,EACrE,aAAc,WACd,wBAAyB,CAAE,OAAQ,KAAS,SAASW,CAAW,CAAE,CACpE,CACF,CACF,CACA,MAAMzK,EAAaF,IACV,CACL,eAAa,OAAI,CACf,WAAYA,EAAM,WAAW,oBAC7B,SAAUA,EAAM,WAAW,UAAU,QACvC,CAAC,CACH,E","sources":["webpack://grafana/./public/app/extensions/teamLBAC/utils.ts","webpack://grafana/./public/app/extensions/teamLBAC/EditableCell.tsx","webpack://grafana/./public/app/extensions/teamLBAC/AddTeamLBACForm.tsx","webpack://grafana/./public/app/extensions/teamLBAC/TeamLabel.tsx","webpack://grafana/./public/app/extensions/teamLBAC/TeamRulesRow.tsx","webpack://grafana/./public/app/extensions/teamLBAC/hooks/useFilterAndSort.ts","webpack://grafana/./public/app/extensions/teamLBAC/state/actions.ts","webpack://grafana/./public/app/extensions/teamLBAC/TeamLBACEditor.tsx","webpack://grafana/./public/app/extensions/permissions/DataSourcePermissions.tsx","webpack://grafana/./public/app/features/datasources/components/DataSourceReadOnlyMessage.tsx","webpack://grafana/./public/app/features/datasources/state/hooks.ts","webpack://grafana/./public/app/features/datasources/utils.ts","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/ConfigEditor/ConfigSection/ConfigSection.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/ConfigEditor/ConfigSection/GenericConfigSection.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/VisualQueryBuilder/components/RawQuery.js"],"sourcesContent":["import { DataSourceJsonData, DataSourceSettings } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { ResourcePermission } from 'app/core/components/AccessControl/types';\nimport { config } from 'app/core/config';\n\nimport { TeamRule } from '../types';\n\nexport const LBACHTTPHeaderName = 'X-Prom-Label-Policy';\n\nexport function hasLBACSupport(ds: DataSourceSettings<DataSourceJsonData, {}>): boolean {\n  let DataSourcesWithLBACSupport = ['loki'];\n  if (config.featureToggles.teamHttpHeadersMimir) {\n    DataSourcesWithLBACSupport.push('prometheus');\n  }\n  if (config.featureToggles.teamHttpHeadersTempo) {\n    DataSourcesWithLBACSupport.push('tempo');\n  }\n  return !!ds.basicAuth && DataSourcesWithLBACSupport.includes(ds.type);\n}\n\nexport function trimLBACRule(rule: string) {\n  const pattern = /\\{([^{}]*)\\}/;\n  const res = pattern.exec(rule);\n  if (res && res.length > 1) {\n    return res[1].trim();\n  }\n  return '';\n}\n\nexport function formatLBACRule(labelSelector: string) {\n  const pattern = /\\{{0,1}([^\\{\\}]*)\\}{0,1}/;\n  const res = pattern.exec(labelSelector);\n  if (res && res.length > 1) {\n    return `{ ${res[1].trim()} }`;\n  }\n  return '';\n}\n\nexport function extractLBACRule(rule: string) {\n  const pattern = /\\w+\\:\\{{0,1}([^\\{\\}]*)\\}{0,1}/;\n  const res = pattern.exec(rule);\n  if (res && res.length > 1) {\n    return res[1].trim();\n  }\n  return '';\n}\n\nexport const validateLBACRule = (str: string): boolean => {\n  if (!str) {\n    return false;\n  }\n  const trimmedStr = str.trim().replace(/^{|}$/g, '');\n  const pattern = /^\\s*(?:\\s*\\w+\\s*(?:=|!=|=~|!~)\\s*\\\"[^\\\"]+\\\"\\s*,*)+\\s*$/;\n  return pattern.test(trimmedStr);\n};\n\nexport const getLBACTeamsConfigured = (rules: TeamRule[]): string[] => {\n  const teams: string[] = [];\n  if (rules.length) {\n    rules.forEach((rule) => {\n      if (rule.teamUid) {\n        teams.push(rule.teamUid);\n      }\n    });\n  }\n  return teams;\n};\n\nexport const addTeamLBACWarnings = (teams: string[], items: ResourcePermission[]) => {\n  const warningTeam = t(\n    'access-control.permissions.lbac-warning-team',\n    'Warning: This team has full data access if no LBAC rules are set.'\n  );\n  return items.map((item) => {\n    if (item.builtInRole && item.permission !== 'Admin') {\n      const warningBasicRole = t(\n        'access-control.permissions.lbac-warning-basic-role',\n        `Warning: ${item.builtInRole} may have full data access if permission is not removed.`\n      );\n      item.warning = warningBasicRole;\n    } else if (item.teamUid && !teams.includes(item.teamUid)) {\n      item.warning = warningTeam;\n    }\n    return { ...item };\n  });\n};\n\nexport const addTeamLBACWarningsToLBACRule = (teams: string[], items: TeamRule[]) => {\n  const warningTeam = t(\n    'access-control.permissions.lbac-warning-rule',\n    'Warning: This team might not have permission to the query the datasource.'\n  );\n  return items.map((item) => {\n    if (item.teamUid && !teams.includes(item.teamUid)) {\n      item.warning = warningTeam;\n    }\n    return { ...item };\n  });\n};\n","import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { RawQuery } from '@grafana/plugin-ui';\nimport { Icon, Input, Tooltip, useStyles2, useTheme2 } from '@grafana/ui';\nimport lokiGrammar from 'app/plugins/datasource/loki/syntax';\n\nimport { trimLBACRule } from './utils';\n\ninterface Props {\n  value: string;\n  isEditing?: boolean;\n  disabled?: boolean;\n  onChange?: (value: string) => void;\n  error?: string;\n}\n\nexport const EditableCell = ({ isEditing, value, disabled, error, onChange }: Props) => {\n  const [cellValue, setCellValue] = useState(trimLBACRule(value));\n  const theme = useTheme2();\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    if (!isEditing) {\n      setCellValue(trimLBACRule(value));\n    }\n  }, [isEditing, value]);\n\n  return (\n    <div className={styles.wrapper}>\n      {isEditing ? (\n        <>\n          <Input\n            className={styles.input}\n            value={cellValue}\n            onChange={(event) => {\n              const value = event.currentTarget.value;\n              setCellValue(value);\n              if (onChange) {\n                onChange(`{ ${value} }`);\n              }\n            }}\n            invalid={!!error}\n            suffix={\n              error && (\n                <Tooltip content={error}>\n                  <Icon name=\"exclamation-triangle\" />\n                </Tooltip>\n              )\n            }\n          />\n        </>\n      ) : (\n        <span style={{ color: disabled ? theme.colors.text.disabled : 'unset' }}>\n          {value && value.trim() ? (\n            <RawQuery query={value} language={{ grammar: lokiGrammar, name: 'logql' }} />\n          ) : (\n            <span className={styles.emptyValue}>\n              <Trans i18nKey=\"team-lbac.editable-cell.empty-rule\">Empty rule</Trans>\n            </span>\n          )}\n        </span>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      padding: theme.spacing(0, 1),\n    }),\n    input: css({\n      '& input': {\n        fontFamily: theme.typography.fontFamilyMonospace,\n      },\n    }),\n    emptyValue: css({\n      fontStyle: 'italic',\n      color: theme.colors.text.secondary,\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { Controller, useForm } from 'react-hook-form';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Field, Input, Stack, useStyles2 } from '@grafana/ui';\nimport { TeamPicker } from 'app/core/components/Select/TeamPicker';\n\nimport { EditableCell } from './EditableCell';\nimport { validateLBACRule } from './utils';\n\nexport interface LBACFormData {\n  teamUid: string;\n  rule: string;\n}\n\ninterface Props {\n  onSubmit: (data: LBACFormData) => void;\n}\n\nexport const CreateTeamLBACForm: React.FC<Props> = ({ onSubmit }) => {\n  const styles = useStyles2(getStyles);\n  const {\n    handleSubmit,\n    register,\n    control,\n    watch,\n    formState: { errors },\n  } = useForm<LBACFormData>({\n    mode: 'onChange',\n  });\n\n  const teamUid = watch('teamUid');\n  const rule = watch('rule');\n\n  const isValid = () => {\n    return teamUid?.length > 0 && validateLBACRule(rule);\n  };\n\n  return (\n    <div className={styles.container}>\n      <h5 className={styles.heading}>\n        <Trans i18nKey=\"team-lbac.create-team-lbacform.new-lbac-rule\">New LBAC Rule</Trans>\n      </h5>\n      <div className={styles.example}>\n        <Trans i18nKey={'team-lbac.create-team-lbacform.new-lbac-rule-example'}>Example:</Trans>\n        <EditableCell value='{ cluster=\"us-west-0\", namespace=~\"dev|prod\" }' disabled={true} />\n      </div>\n\n      <form id=\"lbacForm\" onSubmit={handleSubmit(onSubmit)} className={styles.form}>\n        <Stack gap={2} direction=\"column\">\n          <Field label={t('team-lbac.create-team-lbacform.label-team', 'Team')}>\n            <Controller\n              render={({ field: { onChange, ref, ...field } }) => (\n                <TeamPicker {...field} onSelected={(t) => onChange(t.value?.uid)} className={styles.teamPicker} />\n              )}\n              control={control}\n              name=\"teamUid\"\n              rules={{\n                required: { value: true, message: t('teamLBAC.create-team-lbacform.message.required', 'Required') },\n              }}\n            />\n          </Field>\n          <Field\n            label={t('team-lbac.create-team-lbacform.label-rule', 'Rule')}\n            invalid={!!errors.rule}\n            error={errors?.rule?.message}\n          >\n            <Input\n              className={styles.input}\n              type=\"text\"\n              {...register('rule', {\n                required: 'Rule is required',\n                validate: (val) => validateLBACRule(val) || 'Invalid LBAC rule syntax',\n              })}\n              // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n              placeholder='{ cluster=\"us-west-0\", namespace=~\"dev|prod\" }'\n              invalid={!!errors.rule}\n            />\n          </Field>\n          <div className={styles.buttonContainer}>\n            <Button type=\"submit\" disabled={!isValid()}>\n              <Trans i18nKey=\"team-lbac.create-team-lbacform.save\">Save</Trans>\n            </Button>\n          </div>\n        </Stack>\n      </form>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css({\n      padding: theme.spacing(2),\n    }),\n    heading: css({\n      color: theme.colors.text.primary,\n      margin: `0 0 ${theme.spacing(2)} 0`,\n      fontSize: theme.typography.h5.fontSize,\n    }),\n    example: css({\n      marginBottom: theme.spacing(2),\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.size.sm,\n    }),\n    form: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(2),\n      width: '100%',\n      maxWidth: '500px',\n    }),\n    input: css({\n      width: '100%',\n      '& input': {\n        fontFamily: theme.typography.fontFamilyMonospace,\n        width: '100%',\n      },\n    }),\n    teamPicker: css({\n      width: '100%',\n    }),\n    buttonContainer: css({\n      display: 'flex',\n      justifyContent: 'flex-end',\n      marginTop: theme.spacing(2),\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Avatar, Box, Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { Team } from 'app/types/teams';\n\ninterface Props {\n  team?: Partial<Pick<Team, 'name' | 'avatarUrl' | 'id'>>;\n  disabled?: boolean;\n  warning?: string;\n}\n\nexport const TeamLabel = ({ team, disabled, warning }: Props) => {\n  const styles = useStyles2(getStyles);\n  if (!team) {\n    return <></>;\n  }\n\n  // Show placeholder if team not found\n  if (!team.name && !team.avatarUrl) {\n    const teamId = team.id;\n    return (\n      <span className={styles.notFound}>\n        <Trans i18nKey=\"team-lbac.team-label.placeholder\">Team with id {{ teamId }} not found</Trans>\n      </span>\n    );\n  }\n\n  return (\n    <div className={styles.wrapper}>\n      {team.avatarUrl && <Avatar src={team.avatarUrl} alt=\"\" />}\n      <span className={cx(styles.label, { [styles.disabled]: disabled })}>{team.name}</span>\n      {warning && (\n        <Tooltip content={<Box>{warning}</Box>}>\n          <Icon name=\"exclamation-triangle\" className={styles.warning} />\n        </Tooltip>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    label: css({\n      overflow: 'hidden',\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(2),\n    }),\n    avatar: css({\n      width: '24px',\n      height: '24px',\n    }),\n    notFound: css({\n      color: theme.colors.text.secondary,\n    }),\n    disabled: css({\n      color: theme.colors.text.disabled,\n    }),\n    warning: css({\n      color: theme.colors.warning.main,\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, DeleteButton, IconButton, useStyles2 } from '@grafana/ui';\nimport { Team } from 'app/types/teams';\n\nimport { EditableCell } from './EditableCell';\nimport { TeamLabel } from './TeamLabel';\nimport { validateLBACRule } from './utils';\n\ninterface TeamRulesRowProps {\n  teamRules: string[];\n  team: Pick<Team, 'name' | 'avatarUrl' | 'uid'>;\n  disabled?: boolean;\n  onChange: (teamRules: string[]) => void;\n  warning?: string;\n}\n\nexport const TeamRulesRow = ({ teamRules, team, disabled, onChange, warning }: TeamRulesRowProps) => {\n  const [rulesEditing, setRulesEditing] = useState<Record<number, boolean>>({});\n  const [rulesValues, setRulesValues] = useState<Record<number, string | undefined>>({});\n  const [rules, setRules] = useState(teamRules);\n  const [errors, setErrors] = useState<Record<number, string | undefined>>({});\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    setRules(teamRules);\n  }, [teamRules]);\n\n  if (!teamRules?.length) {\n    return null;\n  }\n\n  const onRuleEdit = (idx: number, value: boolean) => {\n    setRulesValues({ ...rulesValues, [idx]: !!value ? rules[idx] : undefined });\n    setRulesEditing({ ...rulesEditing, [idx]: value });\n  };\n\n  const onRuleChange = (idx: number, value: string) => {\n    setRulesValues({ ...rulesValues, [idx]: value });\n  };\n\n  const onSave = (idx: number) => {\n    const newRule = rulesValues[idx];\n    if (newRule) {\n      if (!validateLBACRule(newRule)) {\n        setErrors({ ...errors, [idx]: 'Invalid LBAC rule syntax' });\n        return;\n      }\n      const newRules = rules.map((rule, i) => {\n        return i === idx && newRule ? newRule! : rule;\n      });\n      onChange(newRules);\n      setRulesEditing({ ...rulesEditing, [idx]: false });\n    }\n  };\n\n  const onDelete = (idx: number) => {\n    const newRules = rules.slice(0, idx).concat(rules.slice(idx + 1));\n    onChange(newRules);\n  };\n\n  const onAddRule = () => {\n    setRulesEditing({ ...rulesEditing, [rules.length]: true });\n    setRules(rules.concat(''));\n  };\n\n  const onCancel = (idx: number) => {\n    onRuleEdit(idx, false);\n    if (idx === rules.length - 1 && !rules[idx]) {\n      // Handle cancel when adding new rule\n      setRules(rules.slice(0, -1));\n    }\n  };\n\n  return (\n    <>\n      <tr key={`${team.uid}-${0}`} role=\"row\">\n        <td>\n          <TeamLabel team={team} warning={warning} />\n        </td>\n        <td></td>\n        <td>\n          <EditableCell\n            value={rules[0]}\n            isEditing={rulesEditing[0]}\n            error={errors[0]}\n            onChange={(value) => onRuleChange(0, value)}\n          />\n        </td>\n        <td>\n          {!disabled ? (\n            <div className={styles.buttonsCell}>\n              {rules?.length === 1 && !rulesEditing[0] && (\n                <div className={styles.buttonRight}>\n                  <IconButton\n                    name=\"plus-circle\"\n                    tooltip={t('team-lbac.team-rules-row.tooltip-add-new-rule', 'Add new rule')}\n                    aria-label={t('team-lbac.team-rules-row.aria-label-add-team-rule', 'add team rule')}\n                    onClick={() => onAddRule()}\n                  />\n                </div>\n              )}\n              {!rulesEditing[0] ? (\n                <div className={styles.editButton}>\n                  <IconButton\n                    name=\"pen\"\n                    aria-label={t('team-lbac.team-rules-row.aria-label-edit-team-rule', 'edit team rule')}\n                    onClick={() => onRuleEdit(0, true)}\n                  />\n                </div>\n              ) : (\n                <>\n                  <div className={styles.editButton}>\n                    <Button size=\"sm\" variant=\"primary\" onClick={() => onSave(0)}>\n                      <Trans i18nKey=\"team-lbac.team-rules-row.save\">Save</Trans>\n                    </Button>\n                  </div>\n                  <div className={styles.editButton}>\n                    <Button size=\"sm\" variant=\"secondary\" onClick={() => onCancel(0)}>\n                      <Trans i18nKey=\"team-lbac.team-rules-row.cancel\">Cancel</Trans>\n                    </Button>\n                  </div>\n                </>\n              )}\n              <div className={styles.buttonRight}>\n                <DeleteButton\n                  aria-label={t('team-lbac.team-rules-row.aria-label-delete-rule', 'Delete rule')}\n                  size=\"sm\"\n                  onConfirm={() => onDelete(0)}\n                />\n              </div>\n            </div>\n          ) : (\n            <div className={styles.buttonsCell}>\n              <Button\n                tooltip={t('team-lbac.team-rules-row.tooltip-provisioned-rule', 'Provisioned rule')}\n                size=\"sm\"\n                icon=\"lock\"\n              />\n            </div>\n          )}\n        </td>\n      </tr>\n      {rules.length > 1 &&\n        rules.slice(1).map((teamRule, idx) => (\n          <tr key={`${team.uid}-${idx + 1}`} role=\"row\">\n            <td></td>\n            <td className={styles.ruleOr}>\n              <Trans i18nKey=\"team-lbac.team-rules-row.or\">OR</Trans>\n            </td>\n            <td>\n              <EditableCell\n                value={teamRule}\n                isEditing={rulesEditing[idx + 1]}\n                error={errors[idx + 1]}\n                onChange={(value) => onRuleChange(idx + 1, value)}\n              />\n            </td>\n            <td>\n              {!disabled ? (\n                <div className={styles.buttonsCell}>\n                  {idx === rules?.length - 2 && !rulesEditing[idx + 1] && (\n                    <div className={styles.buttonRight}>\n                      <IconButton\n                        name=\"plus-circle\"\n                        tooltip={t('team-lbac.team-rules-row.tooltip-add-new-rule', 'Add new rule')}\n                        aria-label={t('team-lbac.team-rules-row.aria-label-add-team-rule', 'add team rule')}\n                        onClick={() => onAddRule()}\n                      />\n                    </div>\n                  )}\n                  {!rulesEditing[idx + 1] ? (\n                    <div className={styles.editButton}>\n                      <IconButton\n                        name=\"pen\"\n                        aria-label={t('team-lbac.team-rules-row.aria-label-edit-team-rule', 'edit team rule')}\n                        onClick={() => onRuleEdit(idx + 1, true)}\n                      />\n                    </div>\n                  ) : (\n                    <>\n                      <div className={styles.editButton}>\n                        <Button size=\"sm\" variant=\"primary\" onClick={() => onSave(idx + 1)}>\n                          <Trans i18nKey=\"team-lbac.team-rules-row.save\">Save</Trans>\n                        </Button>\n                      </div>\n                      <div className={styles.editButton}>\n                        <Button size=\"sm\" variant=\"secondary\" onClick={() => onCancel(idx + 1)}>\n                          <Trans i18nKey=\"team-lbac.team-rules-row.cancel\">Cancel</Trans>\n                        </Button>\n                      </div>\n                    </>\n                  )}\n                  <div className={styles.buttonRight}>\n                    <DeleteButton\n                      aria-label={t('team-lbac.team-rules-row.aria-label-delete-rule', 'Delete rule')}\n                      size=\"sm\"\n                      onConfirm={() => onDelete(idx + 1)}\n                    />\n                  </div>\n                </div>\n              ) : (\n                <div className={styles.buttonsCell}>\n                  <Button\n                    tooltip={t('team-lbac.team-rules-row.tooltip-provisioned-rule', 'Provisioned rule')}\n                    size=\"sm\"\n                    icon=\"lock\"\n                  />\n                </div>\n              )}\n            </td>\n          </tr>\n        ))}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    editButton: css({\n      display: 'flex',\n      alignItems: 'center',\n      marginLeft: theme.spacing(2),\n    }),\n    buttonRight: css({\n      display: 'flex',\n      alignItems: 'center',\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(0.5),\n    }),\n    buttonsCell: css({\n      display: 'flex',\n      justifyContent: 'end',\n      alignItems: 'center',\n    }),\n    ruleOr: css({\n      color: theme.colors.text.secondary,\n    }),\n  };\n};\n","import { useCallback, useMemo, useState } from 'react';\n\nimport { t } from '@grafana/i18n';\nimport { Team } from 'app/types/teams';\n\nimport { TeamRule } from '../../types';\n\nexport interface UseFilterAndSortParams {\n  teamLBACRules: TeamRule[];\n  teams: Array<Pick<Team, 'name' | 'avatarUrl' | 'id' | 'uid'>>;\n}\n\nexport interface UseFilterAndSortResult {\n  filterQuery: string;\n  setFilterQuery: (query: string) => void;\n  sortOrder: 'asc' | 'desc';\n  toggleSortOrder: () => void;\n  sortIconTooltip: string;\n  sortedAndFilteredRules: TeamRule[];\n  clearFilter: () => void;\n}\n\nexport function useFilterAndSort({ teamLBACRules, teams }: UseFilterAndSortParams): UseFilterAndSortResult {\n  const [filterQuery, setFilterQuery] = useState('');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n\n  // Create a mapping from team UIDs to team names for efficient lookups\n  const teamUidToNameMap = useMemo(() => {\n    return new Map<string, string>(teams.map((team) => [team.uid, team.name ?? '']));\n  }, [teams]);\n\n  const sortIconTooltip = useMemo(() => {\n    return sortOrder === 'asc'\n      ? t('team-lbac.team-lbaceditor-unconnected.sort-teams-ascending', 'Sort teams A-Z')\n      : t('team-lbac.team-lbaceditor-unconnected.sort-teams-descending', 'Sort teams Z-A');\n  }, [sortOrder]);\n\n  // Sort and filter rules based on team name\n  const sortedAndFilteredRules = useMemo(() => {\n    const sortedRules = [...teamLBACRules].sort((a, b) => {\n      const teamA = teamUidToNameMap.get(a.teamUid) || '';\n      const teamB = teamUidToNameMap.get(b.teamUid) || '';\n      return sortOrder === 'asc' ? teamA.localeCompare(teamB) : teamB.localeCompare(teamA);\n    });\n\n    if (!filterQuery) {\n      return sortedRules;\n    }\n\n    return sortedRules.filter((rule) => {\n      const teamName = teamUidToNameMap.get(rule.teamUid) || '';\n      return teamName.toLowerCase().includes(filterQuery.toLowerCase());\n    });\n  }, [teamLBACRules, teamUidToNameMap, filterQuery, sortOrder]);\n\n  // Toggle sort order\n  const toggleSortOrder = useCallback(() => {\n    setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n  }, [sortOrder]);\n\n  // Clear filter\n  const clearFilter = useCallback(() => {\n    setFilterQuery('');\n  }, []);\n\n  return {\n    filterQuery,\n    setFilterQuery,\n    sortOrder,\n    toggleSortOrder,\n    sortIconTooltip,\n    sortedAndFilteredRules,\n    clearFilter,\n  };\n}\n","import { getBackendSrv } from '@grafana/runtime';\nimport { ThunkResult } from 'app/types/store';\n\nimport { TeamLBACConfig } from '../../types';\n\nimport { teamLBACLoaded } from './reducers';\n\nexport function getTeamLBAC(uid: string): ThunkResult<void> {\n  return async (dispatch) => {\n    const teamLBACConfig = await getBackendSrv().get(`api/datasources/uid/${uid}/lbac/teams`);\n    dispatch(teamLBACLoaded(teamLBACConfig));\n  };\n}\n\nexport function updateTeamLBACRules(uid: string, data: TeamLBACConfig): ThunkResult<void> {\n  return async (dispatch) => {\n    await getBackendSrv().put(`api/datasources/uid/${uid}/lbac/teams`, { ...data });\n    dispatch(getTeamLBAC(uid));\n  };\n}\n","import { css } from '@emotion/css';\nimport { isEmpty } from 'lodash';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { ConnectedProps, connect } from 'react-redux';\n\nimport { DataSourceJsonData, DataSourceSettings, GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { ConfigSection } from '@grafana/plugin-ui';\nimport { getBackendSrv } from '@grafana/runtime';\nimport {\n  Alert,\n  Box,\n  Button,\n  Collapse,\n  FilterInput,\n  Icon,\n  LinkButton,\n  Stack,\n  Text,\n  TextLink,\n  Tooltip,\n  useStyles2,\n} from '@grafana/ui';\nimport { ResourcePermission } from 'app/core/components/AccessControl/types';\nimport { contextSrv } from 'app/core/core';\nimport { DataSourceReadOnlyMessage } from 'app/features/datasources/components/DataSourceReadOnlyMessage';\nimport { Team } from 'app/types/teams';\n\nimport { AccessControlAction as EnterpriseActions, EnterpriseStoreState, TeamRule } from '../types';\n\nimport { CreateTeamLBACForm, LBACFormData } from './AddTeamLBACForm';\nimport { TeamRulesRow } from './TeamRulesRow';\nimport { useFilterAndSort } from './hooks/useFilterAndSort';\nimport { getTeamLBAC, updateTeamLBACRules } from './state/actions';\nimport { formatLBACRule } from './utils';\n\nexport interface OwnProps {\n  dataSourceConfig: DataSourceSettings<DataSourceJsonData, {}>;\n  readOnly?: boolean;\n  onTeamLBACUpdate: () => Promise<DataSourceSettings> | void;\n  getWarnings?: (items: TeamRule[]) => TeamRule[];\n  items?: ResourcePermission[];\n}\n\nfunction mapStateToProps(state: EnterpriseStoreState) {\n  return {\n    teamLBACConfig: state.teamLBAC?.teamLBACConfig,\n  };\n}\n\nconst mapDispatchToProps = {\n  getTeamLBAC,\n  updateTeamLBACRules,\n};\n\nexport const connector = connect(mapStateToProps, mapDispatchToProps);\ntype Props = OwnProps & ConnectedProps<typeof connector>;\n\nexport const TeamLBACEditorUnconnected = ({\n  teamLBACConfig,\n  dataSourceConfig,\n  readOnly,\n  onTeamLBACUpdate,\n  getTeamLBAC,\n  updateTeamLBACRules,\n  items,\n}: Props) => {\n  const [teams, setTeams] = useState<Array<Pick<Team, 'name' | 'avatarUrl' | 'id' | 'uid'>>>([]);\n  const [showLBACForm, setShowLBACForm] = useState(false);\n  const [rolesWithoutLBAC, setRolesWithoutLBAC] = useState<Set<string>>(new Set<string>());\n  const [teamsWithoutLBAC, setTeamsWithoutLBAC] = useState<Set<string>>(new Set<string>());\n  const [lbacTeamsWithoutTeamPermissions, setLBACTeamsWithoutTeamPermission] = useState<Set<string>>(new Set<string>());\n  const teamLBACRules = useMemo(() => teamLBACConfig?.rules || [], [teamLBACConfig?.rules]);\n  const styles = useStyles2(getStyles);\n  const [recommendationIsOpen, setRecommendationIsOpen] = useState(false);\n\n  // Use the custom hook for filtering and sorting\n  const {\n    filterQuery,\n    setFilterQuery,\n    sortOrder,\n    toggleSortOrder,\n    sortIconTooltip,\n    sortedAndFilteredRules,\n    clearFilter,\n  } = useFilterAndSort({ teamLBACRules, teams });\n\n  useEffect(() => {\n    getTeamLBAC(dataSourceConfig.uid);\n  }, [dataSourceConfig.uid, getTeamLBAC]);\n\n  useEffect(() => {\n    const fetchTeams = async () => {\n      const teamUIDs = teamLBACRules.map((r) => r.teamUid).filter(Boolean);\n      const uniqueIdentifiers = [...new Set(teamUIDs)];\n\n      if (!uniqueIdentifiers?.length) {\n        return;\n      }\n\n      const result = await getBackendSrv().get('/api/teams/search', {\n        teamUid: teamUIDs,\n      });\n      const teamsArray: Team[] = result?.teams;\n      const teams = teamsArray.map((team) => ({\n        id: team.id,\n        uid: team.uid,\n        value: team.id,\n        name: team.name,\n        avatarUrl: team.avatarUrl,\n      }));\n      setTeams(teams);\n    };\n    fetchTeams();\n  }, [teamLBACRules]);\n\n  useEffect(() => {\n    if (!items?.length) {\n      return;\n    }\n    const lbacTeams = new Set(teamLBACRules.map((r) => r.teamUid));\n    const resourceTeams = new Set(items.map((r) => r.teamUid));\n    const resourceRoles: Set<string> = new Set(\n      items\n        .filter((r) => typeof r.builtInRole === 'string' && r.builtInRole.trim() !== '' && r.permission !== 'Admin')\n        .map((r) => r.builtInRole as string) // Assert that r.builtInRole is a string\n    );\n\n    const teamsWithoutLbac: Set<string> = new Set(\n      Array.from(resourceTeams)\n        .filter((x) => x !== undefined && !lbacTeams.has(x.toString()))\n        .map((x) => x?.toString() || '')\n    );\n    const lbacTeamsWithoutTeamPermissions = new Set(\n      Array.from(lbacTeams).filter((x) => x && !resourceTeams.has(x.toString()))\n    );\n\n    if (lbacTeamsWithoutTeamPermissions) {\n      setLBACTeamsWithoutTeamPermission(lbacTeamsWithoutTeamPermissions);\n    }\n    if (teamsWithoutLbac) {\n      setTeamsWithoutLBAC(teamsWithoutLbac);\n    }\n    if (resourceRoles) {\n      setRolesWithoutLBAC(resourceRoles);\n    }\n  }, [items, teamLBACRules]);\n\n  const onTeamLBACUpdateInternal = useCallback(\n    async (rules: TeamRule[]) => {\n      await updateTeamLBACRules(dataSourceConfig.uid, { rules });\n      await onTeamLBACUpdate();\n    },\n    [dataSourceConfig.uid, onTeamLBACUpdate, updateTeamLBACRules]\n  );\n\n  const onSubmitLBAC = async ({ teamUid, rule }: LBACFormData) => {\n    let updatedRules: TeamRule[] = [];\n    const existingTeamRules = teamLBACRules.find((teamRules) => teamRules.teamUid === teamUid.toString());\n\n    if (existingTeamRules) {\n      updatedRules = teamLBACRules.map((teamRules) => {\n        if (teamRules.teamUid === teamUid.toString()) {\n          return { ...teamRules, rules: [...teamRules.rules, formatLBACRule(rule)] };\n        }\n        return { ...teamRules };\n      });\n    } else {\n      updatedRules = teamLBACRules.concat({\n        teamUid: teamUid.toString(),\n        rules: [formatLBACRule(rule)],\n      });\n    }\n    await onTeamLBACUpdateInternal(updatedRules);\n    setShowLBACForm(false);\n  };\n\n  const onRulesUpdate = async (teamIdentifier: string, updatedRules: string[]) => {\n    const updatedTeamRules = teamLBACRules.map((r) => {\n      if (r.teamUid === teamIdentifier) {\n        return { ...r, rules: updatedRules };\n      }\n      return r;\n    });\n    await onTeamLBACUpdateInternal(updatedTeamRules);\n  };\n\n  const canEdit = contextSrv.hasPermission(EnterpriseActions.DataSourcesPermissionsWrite) && !readOnly;\n  const getDescription = (item: ResourcePermission) => {\n    if (item.userId) {\n      return item.userLogin;\n    } else if (item.teamId) {\n      return item.team;\n    } else if (item.builtInRole) {\n      return item.builtInRole;\n    }\n    return;\n  };\n\n  return (\n    <Box paddingBottom={2}>\n      {readOnly && <DataSourceReadOnlyMessage />}\n      <Stack direction=\"column\" gap={3}>\n        <ConfigSection\n          title={t('team-lbac.team-lbaceditor-unconnected.title-data-access', 'Data access')}\n          description={t(\n            'team-lbac.team-lbaceditor-unconnected.description-data-access',\n            'Here you can configure access to specific data within the datasource using LogQL label selectors.'\n          )}\n        >\n          {(lbacTeamsWithoutTeamPermissions.size > 0 || teamsWithoutLBAC.size > 0 || rolesWithoutLBAC.size > 0) &&\n            teamLBACRules.length > 0 && (\n              <Box marginBottom={3}>\n                <Collapse\n                  label={\n                    recommendationIsOpen ? (\n                      t(\n                        'team-lbac.team-lbaceditor-unconnected.hide-access-control-recommendations',\n                        'Hide Access Control Recommendations'\n                      )\n                    ) : (\n                      <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                        <Tooltip\n                          content={t(\n                            'team-lbac.team-lbaceditor-unconnected.content-found-recommendation',\n                            'Found recommendations'\n                          )}\n                        >\n                          <Icon name=\"exclamation-triangle\" className={styles.warning} />\n                        </Tooltip>\n                        <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.show-access-control-recommendations\">\n                          Show Access Control Recommendations\n                        </Trans>\n                      </Stack>\n                    )\n                  }\n                  isOpen={recommendationIsOpen}\n                  onToggle={() => setRecommendationIsOpen(!recommendationIsOpen)}\n                />\n                {recommendationIsOpen && (\n                  <Alert\n                    title={t(\n                      'team-lbac.team-lbaceditor-unconnected.title-access-control-recommendations',\n                      'Access Control Recommendations'\n                    )}\n                    severity=\"warning\"\n                  >\n                    <p>\n                      <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.ensure-proper-access-control-please-follow\">\n                        To ensure proper access control, please follow these recommendations:\n                      </Trans>\n                    </p>\n                    <ul className={styles.warningList}>\n                      {lbacTeamsWithoutTeamPermissions.size > 0 && (\n                        <li>\n                          <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.add-query-permissions\">\n                            <strong>Add Query Permissions:</strong> The following teams do not have query permissions\n                            for the data source, and are therefore not able to query logs with the configured LBAC\n                            rules.\n                          </Trans>\n                          <ul>\n                            {Array.from(lbacTeamsWithoutTeamPermissions).map((team) => {\n                              const teamName = teams?.find((t) => t.uid?.toString() === team)?.name;\n                              return (\n                                <li className={styles.warningList} key={team}>\n                                  {teamName}\n                                </li>\n                              );\n                            })}\n                          </ul>\n                        </li>\n                      )}\n                      {teamsWithoutLBAC.size > 0 && (\n                        <li>\n                          <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.add-team-lbac-rules\">\n                            <strong>Add Team LBAC Rules:</strong> The following teams can query all logs. Please add\n                            Team LBAC rules for them:\n                          </Trans>\n                          <ul>\n                            {Array.from(teamsWithoutLBAC).map((team) => {\n                              const i = items?.find((t) => t.teamUid?.toString() === team);\n                              if (!i) {\n                                return null;\n                              }\n                              return (\n                                <li className={styles.warningList} key={team}>\n                                  {getDescription(i)}\n                                </li>\n                              );\n                            })}\n                          </ul>\n                        </li>\n                      )}\n                      {rolesWithoutLBAC.size > 0 && (\n                        <li>\n                          <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.remove-unrestricted-access\">\n                            <strong>Remove Unrestricted Access:</strong> The following roles currently have unrestricted\n                            access to logs.\n                          </Trans>\n                          <ul>\n                            {Array.from(rolesWithoutLBAC).map((role) => {\n                              return (\n                                <li className={styles.warningList} key={role}>\n                                  {t('team-lbac.team-lbaceditor-unconnected.role-warning-list', 'Role: {{role}}', {\n                                    role,\n                                  })}\n                                </li>\n                              );\n                            })}\n                          </ul>\n                        </li>\n                      )}\n                    </ul>\n                  </Alert>\n                )}\n              </Box>\n            )}\n          <Stack direction={'column'} gap={2}>\n            <Stack direction={'column'}>\n              <Text variant={'h4'}>\n                <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.lbac-labelbased-access-control\">\n                  LBAC (Label-based access control)\n                </Trans>\n              </Text>\n              <Stack alignItems={{ xs: 'flex-start', md: 'center' }} direction={{ xs: 'column', md: 'row' }}>\n                <Text variant={'bodySmall'} color={'secondary'}>\n                  <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.lbac-description\">\n                    Configure LBAC rules to restrict access for specific metrics/logs.\n                  </Trans>\n                </Text>\n                <TextLink\n                  variant={'bodySmall'}\n                  external\n                  href=\"https://grafana.com/docs/grafana/latest/administration/data-source-management/teamlbac/create-teamlbac-rules/#lbac-rule\"\n                >\n                  <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.learn-more-about-lbac-rules\">\n                    Learn more about LBAC rules\n                  </Trans>\n                </TextLink>\n              </Stack>\n            </Stack>\n            {canEdit && (\n              <Stack direction={{ xs: 'column-reverse', md: 'row' }} alignItems={'flex-start'} gap={2}>\n                <LinkButton\n                  onClick={() => setShowLBACForm(!showLBACForm)}\n                  icon={showLBACForm ? 'angle-down' : 'plus'}\n                  aria-expanded={showLBACForm}\n                >\n                  {showLBACForm\n                    ? t('team-lbac.team-lbaceditor-unconnected.hide-lbac-rule', 'Hide LBAC rule')\n                    : t('team-lbac.team-lbaceditor-unconnected.add-a-lbac-rule', 'Add a LBAC rule')}\n                </LinkButton>\n                {!isEmpty(teamLBACRules) && (\n                  <FilterInput\n                    placeholder={t('team-lbac.team-lbaceditor-unconnected.filter-teams-placeholder', 'Filter teams')}\n                    value={filterQuery}\n                    onChange={setFilterQuery}\n                    width={30}\n                    escapeRegex={false}\n                    aria-label={t(\n                      'team-lbac.team-lbaceditor-unconnected.filter-teams-aria-label',\n                      'Filter LBAC rules by team name'\n                    )}\n                  />\n                )}\n                {showLBACForm && (\n                  <Box marginTop={2}>\n                    <CreateTeamLBACForm onSubmit={onSubmitLBAC} />\n                  </Box>\n                )}\n              </Stack>\n            )}\n          </Stack>\n        </ConfigSection>\n        {!isEmpty(sortedAndFilteredRules) && (\n          <div className={styles.tableContainer}>\n            {!isEmpty(filterQuery) && (\n              <Box marginBottom={2}>\n                <Text variant=\"bodySmall\">\n                  {sortedAndFilteredRules.length === 1\n                    ? t('team-lbac.team-lbaceditor-unconnected.filter-results-single', 'Showing 1 result')\n                    : t('team-lbac.team-lbaceditor-unconnected.filter-results-multiple', 'Showing {{count}} results', {\n                        count: sortedAndFilteredRules.length,\n                      })}\n                  <Button\n                    onClick={clearFilter}\n                    fill=\"text\"\n                    size=\"sm\"\n                    icon=\"times\"\n                    variant=\"secondary\"\n                    aria-label={t('team-lbac.team-lbaceditor-unconnected.clear-filter-aria-label', 'Clear filter')}\n                  >\n                    {t('team-lbac.team-lbaceditor-unconnected.clear-filter', 'Clear')}\n                  </Button>\n                </Text>\n              </Box>\n            )}\n            <table className={styles.table} role=\"grid\" aria-labelledby=\"team_lbac_rules\">\n              <thead>\n                <tr>\n                  <th\n                    style={{ width: '30%' }}\n                    className={styles.sortableHeader}\n                    onClick={toggleSortOrder}\n                    aria-sort={sortOrder === 'asc' ? 'ascending' : 'descending'}\n                  >\n                    <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                      <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.team\">Team</Trans>\n                      <Tooltip content={sortIconTooltip}>\n                        <Icon name={sortOrder === 'asc' ? 'angle-up' : 'angle-down'} aria-hidden=\"true\" />\n                      </Tooltip>\n                    </Stack>\n                  </th>\n                  <th style={{ width: '1%' }} />\n                  <th>\n                    <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.label-selector\">Label selector</Trans>\n                  </th>\n                  <th style={{ width: '1%' }} />\n                </tr>\n              </thead>\n              <tbody>\n                {sortedAndFilteredRules.map((teamRules: TeamRule, idx: number) => {\n                  const rules = teamRules.rules;\n                  const teamIdentifier = teamRules.teamUid;\n                  let warning = '';\n                  if (lbacTeamsWithoutTeamPermissions.has(teamIdentifier)) {\n                    warning = 'Warning: This team may not have permission to query the datasource.';\n                  }\n                  return (\n                    <TeamRulesRow\n                      key={idx}\n                      teamRules={rules}\n                      disabled={!canEdit}\n                      team={\n                        teams.find((t) => t.uid === teamRules.teamUid) || {\n                          name: '',\n                          avatarUrl: '',\n                          uid: '',\n                        }\n                      }\n                      onChange={(updatedRules) => onRulesUpdate(teamIdentifier, updatedRules)}\n                      warning={warning}\n                    />\n                  );\n                })}\n              </tbody>\n            </table>\n            <Box marginTop={2}>\n              <Text variant=\"bodySmall\" color=\"secondary\">\n                <Trans i18nKey=\"team-lbac.team-lbaceditor-unconnected.lbac-rules-note\">\n                  Note:\n                  <br />\n                  - LBAC rules will NOT apply to the query if the authenticated Cloud Access Policy token has any label\n                  selectors configured in Grafana Cloud.\n                  <br />- Changes to LBAC rules may take up to 5 minutes to be reflected due to query path caching.\n                </Trans>\n              </Text>\n            </Box>\n          </div>\n        )}\n      </Stack>\n    </Box>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    warning: css({\n      ...theme.typography.bodySmall,\n      color: theme.colors.warning.text,\n    }),\n    warningList: css({\n      ...theme.typography.bodySmall,\n      listStylePosition: 'inside',\n      marginLeft: theme.spacing(2),\n    }),\n    table: css({\n      ...theme.typography.bodySmall,\n      width: '100%',\n      borderCollapse: 'collapse',\n      '& th, & td': {\n        padding: theme.spacing(2),\n        borderBottom: `1px solid ${theme.colors.border.weak}`,\n      },\n      '& th': {\n        textAlign: 'left',\n        fontWeight: theme.typography.fontWeightMedium,\n      },\n    }),\n    sortableHeader: css({\n      cursor: 'pointer',\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n    tableContainer: css({\n      overflowX: 'auto',\n    }),\n  };\n};\n\nexport const TeamLBACEditor = connector(TeamLBACEditorUnconnected);\n","import { useEffect } from 'react';\nimport { ConnectedProps, connect } from 'react-redux';\n\nimport { t } from '@grafana/i18n';\nimport { Stack } from '@grafana/ui';\nimport { Permissions } from 'app/core/components/AccessControl';\nimport { ResourcePermission } from 'app/core/components/AccessControl/types';\nimport { UpgradeBox } from 'app/core/components/Upgrade/UpgradeBox';\nimport { contextSrv } from 'app/core/core';\nimport { highlightTrial } from 'app/features/admin/utils';\nimport { loadDataSource, loadDataSourceMeta, updateDataSource } from 'app/features/datasources/state/actions';\nimport { useDataSourceRights } from 'app/features/datasources/state/hooks';\n\nimport { TeamLBACEditor } from '../teamLBAC/TeamLBACEditor';\nimport { addTeamLBACWarnings, getLBACTeamsConfigured, hasLBACSupport } from '../teamLBAC/utils';\nimport { AccessControlAction as EnterpriseActions, EnterpriseStoreState } from '../types';\n\ntype ExternalProps = { uid: string };\n\nfunction mapStateToProps(state: EnterpriseStoreState, props: ExternalProps) {\n  const { uid } = props;\n  return {\n    resourceId: uid,\n    dataSourceConfig: state.dataSources.dataSource,\n    teamLBACConfig: state.teamLBAC?.teamLBACConfig,\n  };\n}\n\nconst mapDispatchToProps = {\n  loadDataSource,\n  loadDataSourceMeta,\n  updateDataSource,\n};\n\nexport const connector = connect(mapStateToProps, mapDispatchToProps);\nexport type Props = ConnectedProps<typeof connector>;\n\n// The RBAC version for data source permissions\nconst DataSourcePermissions = ({\n  resourceId,\n  dataSourceConfig,\n  teamLBACConfig,\n  loadDataSource,\n  loadDataSourceMeta,\n  updateDataSource,\n}: Props) => {\n  useEffect(() => {\n    loadDataSource(resourceId);\n  }, [resourceId, loadDataSource]);\n\n  const canSetPermissions = contextSrv.hasPermissionInMetadata(\n    EnterpriseActions.DataSourcesPermissionsWrite,\n    dataSourceConfig\n  );\n\n  useEffect(() => {\n    // Initialize DS metadata on page load to populate tab navigation\n    loadDataSource(resourceId as any).then(loadDataSourceMeta);\n  }, [loadDataSource, loadDataSourceMeta, resourceId]);\n\n  const onTeamLBACUpdate = () => {\n    loadDataSource(resourceId);\n  };\n\n  const getLBACWarnings = () => {\n    return (items: ResourcePermission[]) => {\n      if (!showTeamLBAC || !teamLBACConfig?.rules?.length) {\n        return items;\n      }\n      const lbacTeamsConfigured = getLBACTeamsConfigured(teamLBACConfig?.rules);\n      return addTeamLBACWarnings(lbacTeamsConfigured, items);\n    };\n  };\n\n  const { readOnly, hasWriteRights } = useDataSourceRights(dataSourceConfig.uid);\n  const showTeamLBAC = hasLBACSupport(dataSourceConfig);\n  const readOnlyLBAC = readOnly || !canSetPermissions || !hasWriteRights;\n\n  return (\n    <Stack direction={'column'} gap={2}>\n      {highlightTrial() && (\n        <UpgradeBox\n          featureId={'data-source-permissions'}\n          eventVariant={'trial'}\n          featureName={'data source permissions'}\n          text={t(\n            'permissions.data-source-permissions.text-enable-source-permissions-during-trial-grafana',\n            'Enable data source permissions for free during your trial of Grafana Pro.'\n          )}\n        />\n      )}\n      <Permissions\n        resource=\"datasources\"\n        resourceId={resourceId}\n        canSetPermissions={canSetPermissions}\n        getWarnings={showTeamLBAC ? getLBACWarnings() : undefined}\n        epilogue={\n          showTeamLBAC\n            ? (items) => (\n                <TeamLBACEditor\n                  dataSourceConfig={dataSourceConfig}\n                  readOnly={readOnlyLBAC}\n                  onTeamLBACUpdate={onTeamLBACUpdate}\n                  items={items}\n                />\n              )\n            : undefined\n        }\n      />\n    </Stack>\n  );\n};\n\nexport default connector(DataSourcePermissions);\n","import { selectors as e2eSelectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { Alert } from '@grafana/ui';\n\nexport const readOnlyMessage =\n  'This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source.';\n\nexport function DataSourceReadOnlyMessage() {\n  return (\n    <Alert\n      data-testid={e2eSelectors.pages.DataSource.readOnly}\n      severity=\"info\"\n      title={t('datasources.data-source-read-only-message.title-provisioned-data-source', 'Provisioned data source')}\n    >\n      {readOnlyMessage}\n    </Alert>\n  );\n}\n","import { useEffect } from 'react';\n\nimport { DataSourcePluginMeta, DataSourceSettings } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { cleanUpAction } from 'app/core/actions/cleanUp';\nimport appEvents from 'app/core/app_events';\nimport { contextSrv } from 'app/core/core';\nimport { AccessControlAction } from 'app/types/accessControl';\nimport { ShowConfirmModalEvent } from 'app/types/events';\nimport { useDispatch, useSelector } from 'app/types/store';\n\nimport { ROUTES } from '../../connections/constants';\nimport { DataSourceRights } from '../types';\nimport { constructDataSourceExploreUrl } from '../utils';\n\nimport {\n  initDataSourceSettings,\n  testDataSource,\n  loadDataSource,\n  loadDataSources,\n  loadDataSourcePlugins,\n  addDataSource,\n  updateDataSource,\n  deleteLoadedDataSource,\n} from './actions';\nimport { initialDataSourceSettingsState } from './reducers';\nimport { getDataSource, getDataSourceMeta } from './selectors';\n\nexport const useInitDataSourceSettings = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(initDataSourceSettings(uid));\n\n    return function cleanUp() {\n      dispatch(\n        cleanUpAction({\n          cleanupAction: (state) => (state.dataSourceSettings = initialDataSourceSettingsState),\n        })\n      );\n    };\n  }, [uid, dispatch]);\n};\n\nexport const useTestDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  return () => dispatch(testDataSource(uid, ROUTES.DataSourcesEdit));\n};\n\nexport const useLoadDataSources = () => {\n  const dispatch = useDispatch();\n  const isLoading = useSelector((state) => state.dataSources.isLoadingDataSources);\n  const dataSources = useSelector((state) => state.dataSources.dataSources);\n\n  useEffect(() => {\n    dispatch(loadDataSources());\n  }, [dispatch]);\n\n  return { isLoading, dataSources };\n};\n\nexport const useLoadDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSource(uid));\n  }, [dispatch, uid]);\n};\n\nexport const useLoadDataSourcePlugins = () => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSourcePlugins());\n  }, [dispatch]);\n};\n\nexport const useAddDatasource = () => {\n  const dispatch = useDispatch();\n\n  return (plugin: DataSourcePluginMeta) => {\n    dispatch(addDataSource(plugin, ROUTES.DataSourcesEdit));\n  };\n};\n\nexport const useUpdateDatasource = () => {\n  const dispatch = useDispatch();\n\n  return async (dataSource: DataSourceSettings) => dispatch(updateDataSource(dataSource));\n};\n\nexport const useDeleteLoadedDataSource = () => {\n  const dispatch = useDispatch();\n  const { name } = useSelector((state) => state.dataSources.dataSource);\n\n  return () => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: t('datasources.use-delete-loaded-data-source.title.delete', 'Delete'),\n        text: `Are you sure you want to delete the \"${name}\" data source?`,\n        yesText: 'Delete',\n        icon: 'trash-alt',\n        onConfirm: () => dispatch(deleteLoadedDataSource()),\n      })\n    );\n  };\n};\n\nexport const useDataSource = (uid: string) => {\n  return useSelector((state) => getDataSource(state.dataSources, uid));\n};\n\nexport const useDataSourceExploreUrl = (uid: string) => {\n  const dataSource = useDataSource(uid);\n  return constructDataSourceExploreUrl(dataSource);\n};\n\nexport const useDataSourceMeta = (pluginType: string): DataSourcePluginMeta => {\n  return useSelector((state) => getDataSourceMeta(state.dataSources, pluginType));\n};\n\nexport const useDataSourceSettings = () => {\n  return useSelector((state) => state.dataSourceSettings);\n};\n\nexport const useDataSourceRights = (uid: string): DataSourceRights => {\n  const dataSource = useDataSource(uid);\n  const readOnly = dataSource.readOnly === true;\n  const hasWriteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesWrite, dataSource);\n  const hasDeleteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesDelete, dataSource);\n\n  return {\n    readOnly,\n    hasWriteRights,\n    hasDeleteRights,\n  };\n};\n","import { DataSourceJsonData, DataSourceSettings, urlUtil, locationUtil } from '@grafana/data';\n\nexport const constructDataSourceExploreUrl = (dataSource: DataSourceSettings<DataSourceJsonData, {}>) => {\n  const exploreState = JSON.stringify({ datasource: dataSource.name, context: 'explore' });\n  const exploreUrl = urlUtil.renderUrl(locationUtil.assureBaseUrl('/explore'), { left: exploreState });\n\n  return exploreUrl;\n};\n","import React__default from 'react';\nimport { GenericConfigSection } from './GenericConfigSection.js';\n\nconst ConfigSection = ({ children, ...props }) => {\n  return /* @__PURE__ */ React__default.createElement(GenericConfigSection, { ...props, kind: \"section\" }, children);\n};\n\nexport { ConfigSection };\n//# sourceMappingURL=ConfigSection.js.map\n","import React__default, { useState } from 'react';\nimport { css } from '@emotion/css';\nimport { useTheme2, IconButton } from '@grafana/ui';\n\nconst GenericConfigSection = ({\n  children,\n  title,\n  description,\n  isCollapsible = false,\n  isInitiallyOpen = true,\n  kind = \"section\",\n  className\n}) => {\n  const { colors, typography, spacing } = useTheme2();\n  const [isOpen, setIsOpen] = useState(isCollapsible ? isInitiallyOpen : true);\n  const iconName = isOpen ? \"angle-up\" : \"angle-down\";\n  const isSubSection = kind === \"sub-section\";\n  const collapsibleButtonAriaLabel = `${isOpen ? \"Collapse\" : \"Expand\"} section ${title}`;\n  const styles = {\n    header: css({\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\"\n    }),\n    title: css({\n      margin: 0\n    }),\n    subtitle: css({\n      margin: 0,\n      fontWeight: typography.fontWeightRegular\n    }),\n    descriptionText: css({\n      marginTop: spacing(isSubSection ? 0.25 : 0.5),\n      marginBottom: 0,\n      ...typography.bodySmall,\n      color: colors.text.secondary\n    }),\n    content: css({\n      marginTop: spacing(2)\n    })\n  };\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className }, /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.header }, kind === \"section\" ? /* @__PURE__ */ React__default.createElement(\"h3\", { className: styles.title }, title) : /* @__PURE__ */ React__default.createElement(\"h6\", { className: styles.subtitle }, title), isCollapsible && /* @__PURE__ */ React__default.createElement(\n    IconButton,\n    {\n      name: iconName,\n      onClick: () => setIsOpen(!isOpen),\n      type: \"button\",\n      size: \"xl\",\n      \"aria-label\": collapsibleButtonAriaLabel\n    }\n  )), description && /* @__PURE__ */ React__default.createElement(\"p\", { className: styles.descriptionText }, description), isOpen && /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.content }, children));\n};\n\nexport { GenericConfigSection };\n//# sourceMappingURL=GenericConfigSection.js.map\n","import { cx, css } from '@emotion/css';\nimport Prism from 'prismjs';\nimport React__default from 'react';\nimport { textUtil } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction RawQuery({ query, language, className }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const highlighted = Prism.highlight(query, language.grammar, language.name);\n  return /* @__PURE__ */ React__default.createElement(\n    \"div\",\n    {\n      className: cx(styles.editorField, \"prism-syntax-highlight\", className),\n      \"aria-label\": \"selector\",\n      dangerouslySetInnerHTML: { __html: textUtil.sanitize(highlighted) }\n    }\n  );\n}\nconst getStyles = (theme) => {\n  return {\n    editorField: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize\n    })\n  };\n};\n\nexport { RawQuery };\n//# sourceMappingURL=RawQuery.js.map\n"],"names":["LBACHTTPHeaderName","hasLBACSupport","ds","DataSourcesWithLBACSupport","config","trimLBACRule","rule","res","formatLBACRule","labelSelector","extractLBACRule","validateLBACRule","str","trimmedStr","getLBACTeamsConfigured","rules","teams","addTeamLBACWarnings","items","warningTeam","item","warningBasicRole","addTeamLBACWarningsToLBACRule","EditableCell","isEditing","value","disabled","error","onChange","cellValue","setCellValue","theme","styles","getStyles","Input","event","Tooltip","Icon","RawQuery","CreateTeamLBACForm","onSubmit","handleSubmit","register","control","watch","errors","teamUid","isValid","Stack","Field","ref","field","TeamPicker","t","val","Button","TeamLabel","team","warning","teamId","Avatar","Box","TeamRulesRow","teamRules","rulesEditing","setRulesEditing","rulesValues","setRulesValues","setRules","setErrors","onRuleEdit","idx","onRuleChange","onSave","newRule","newRules","i","onDelete","onAddRule","onCancel","IconButton","DeleteButton","teamRule","useFilterAndSort","teamLBACRules","filterQuery","setFilterQuery","sortOrder","setSortOrder","teamUidToNameMap","sortIconTooltip","sortedAndFilteredRules","sortedRules","a","b","teamA","teamB","toggleSortOrder","clearFilter","getTeamLBAC","uid","dispatch","teamLBACConfig","updateTeamLBACRules","data","mapStateToProps","state","mapDispatchToProps","connector","TeamLBACEditorUnconnected","dataSourceConfig","readOnly","onTeamLBACUpdate","setTeams","showLBACForm","setShowLBACForm","rolesWithoutLBAC","setRolesWithoutLBAC","teamsWithoutLBAC","setTeamsWithoutLBAC","lbacTeamsWithoutTeamPermissions","setLBACTeamsWithoutTeamPermission","recommendationIsOpen","setRecommendationIsOpen","teamUIDs","r","lbacTeams","resourceTeams","resourceRoles","teamsWithoutLbac","x","onTeamLBACUpdateInternal","onSubmitLBAC","updatedRules","onRulesUpdate","teamIdentifier","updatedTeamRules","canEdit","getDescription","DataSourceReadOnlyMessage","ConfigSection","Collapse","Alert","teamName","role","Text","TextLink","FilterInput","TeamLBACEditor","props","resourceId","loadDataSource","loadDataSourceMeta","updateDataSource","canSetPermissions","getLBACWarnings","showTeamLBAC","lbacTeamsConfigured","hasWriteRights","readOnlyLBAC","UpgradeBox","readOnlyMessage","useInitDataSourceSettings","useTestDataSource","useLoadDataSources","isLoading","dataSources","useLoadDataSource","useLoadDataSourcePlugins","useAddDatasource","plugin","useUpdateDatasource","dataSource","useDeleteLoadedDataSource","name","useDataSource","useDataSourceExploreUrl","useDataSourceMeta","pluginType","useDataSourceSettings","useDataSourceRights","hasDeleteRights","constructDataSourceExploreUrl","exploreState","children","GenericConfigSection","title","description","isCollapsible","isInitiallyOpen","kind","className","colors","typography","spacing","isOpen","setIsOpen","iconName","isSubSection","collapsibleButtonAriaLabel","query","language","highlighted"],"sourceRoot":""}