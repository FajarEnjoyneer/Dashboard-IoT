{"version":3,"file":"8368.7f16bbfa1b92b44bb5c6.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/panel/logs/types.ts","webpack://grafana/./public/app/plugins/panel/logs/LogsPanel.tsx","webpack://grafana/./public/app/plugins/panel/logs/useDatasourcesFromTargets.ts"],"sourcesContent":["import React, { ReactNode } from 'react';\n\nimport { CoreApp, DataFrame, Field, LinkModel, ScopedVars } from '@grafana/data';\nimport { LogLineMenuCustomItem } from 'app/features/logs/components/panel/LogLineMenu';\nimport { LogListControlOptions } from 'app/features/logs/components/panel/LogList';\n\nexport type { Options } from './panelcfg.gen';\n\ntype onClickFilterLabelType = (key: string, value: string, frame?: DataFrame) => void;\ntype onClickFilterOutLabelType = (key: string, value: string, frame?: DataFrame) => void;\ntype onClickFilterValueType = (value: string, refId?: string) => void;\ntype onClickFilterOutStringType = (value: string, refId?: string) => void;\ntype isFilterLabelActiveType = (key: string, value: string, refId?: string) => Promise<boolean>;\ntype isOnClickShowFieldType = (value: string) => void;\ntype isOnClickHideFieldType = (value: string) => void;\nexport type onNewLogsReceivedType = (allLogs: DataFrame[], newLogs: DataFrame[]) => void;\ntype onLogOptionsChangeType = (option: keyof LogListControlOptions, value: string | boolean | string[]) => void;\n\nexport type GetFieldLinksFn = (\n  field: Field,\n  rowIndex: number,\n  dataFrame: DataFrame,\n  vars: ScopedVars\n) => Array<LinkModel<Field>>;\n\nexport function isOnClickFilterLabel(callback: unknown): callback is onClickFilterLabelType {\n  return typeof callback === 'function';\n}\n\nexport function isOnClickFilterOutLabel(callback: unknown): callback is onClickFilterOutLabelType {\n  return typeof callback === 'function';\n}\n\nexport function isOnClickFilterString(callback: unknown): callback is onClickFilterValueType {\n  return typeof callback === 'function';\n}\n\nexport function isOnClickFilterOutString(callback: unknown): callback is onClickFilterOutStringType {\n  return typeof callback === 'function';\n}\n\nexport function isIsFilterLabelActive(callback: unknown): callback is isFilterLabelActiveType {\n  return typeof callback === 'function';\n}\n\nexport function isOnClickShowField(callback: unknown): callback is isOnClickShowFieldType {\n  return typeof callback === 'function';\n}\n\nexport function isOnClickHideField(callback: unknown): callback is isOnClickHideFieldType {\n  return typeof callback === 'function';\n}\n\nexport function isOnNewLogsReceivedType(callback: unknown): callback is onNewLogsReceivedType {\n  return typeof callback === 'function';\n}\n\nexport function isOnLogOptionsChange(callback: unknown): callback is onLogOptionsChangeType {\n  return typeof callback === 'function';\n}\n\nexport function isReactNodeArray(node: unknown): node is ReactNode[] {\n  return Array.isArray(node) && node.every(React.isValidElement);\n}\n\nexport function isCoreApp(app: unknown): app is CoreApp {\n  const apps = Object.values(CoreApp).map((coreApp) => coreApp.toString());\n  return typeof app === 'string' && apps.includes(app);\n}\n\nexport function isLogLineMenuCustomItems(items: unknown): items is LogLineMenuCustomItem[] {\n  return Array.isArray(items) && items.every((item) => 'divider' in item || ('onClick' in item && 'label' in item));\n}\n","import { css, cx } from '@emotion/css';\nimport { groupBy } from 'lodash';\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport * as React from 'react';\nimport { isObservable, lastValueFrom } from 'rxjs';\n\nimport {\n  AbsoluteTimeRange,\n  CoreApp,\n  DataFrame,\n  DataHoverClearEvent,\n  DataHoverEvent,\n  DataQueryResponse,\n  DataSourceApi,\n  dateTimeForTimeZone,\n  GrafanaTheme2,\n  hasLogsContextSupport,\n  hasLogsContextUiSupport,\n  Labels,\n  LogRowContextOptions,\n  LogRowModel,\n  LogsSortOrder,\n  PanelData,\n  PanelProps,\n  TimeRange,\n  TimeZone,\n  toUtc,\n  urlUtil,\n  LogSortOrderChangeEvent,\n  LoadingState,\n  rangeUtil,\n} from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { config, getAppEvents } from '@grafana/runtime';\nimport { ScrollContainer, usePanelContext, useStyles2 } from '@grafana/ui';\nimport { getFieldLinksForExplore } from 'app/features/explore/utils/links';\nimport { ControlledLogRows } from 'app/features/logs/components/ControlledLogRows';\nimport { InfiniteScroll } from 'app/features/logs/components/InfiniteScroll';\nimport { LogRowContextModal } from 'app/features/logs/components/log-context/LogRowContextModal';\nimport { LogList } from 'app/features/logs/components/panel/LogList';\nimport { PanelDataErrorView } from 'app/features/panel/components/PanelDataErrorView';\nimport { combineResponses } from 'app/plugins/datasource/loki/mergeResponses';\n\nimport { createAndCopyShortLink, getLogsPermalinkRange } from '../../../core/utils/shortLinks';\nimport { LogLabels } from '../../../features/logs/components/LogLabels';\nimport { LogRows } from '../../../features/logs/components/LogRows';\nimport { COMMON_LABELS, dataFrameToLogsModel, dedupLogRows } from '../../../features/logs/logsModel';\n\nimport {\n  GetFieldLinksFn,\n  isCoreApp,\n  isIsFilterLabelActive,\n  isLogLineMenuCustomItems,\n  isOnClickFilterLabel,\n  isOnClickFilterOutLabel,\n  isOnClickFilterOutString,\n  isOnClickFilterString,\n  isOnClickHideField,\n  isOnClickShowField,\n  isOnLogOptionsChange,\n  isOnNewLogsReceivedType,\n  isReactNodeArray,\n  onNewLogsReceivedType,\n  Options,\n} from './types';\nimport { useDatasourcesFromTargets } from './useDatasourcesFromTargets';\n\ninterface LogsPanelProps extends PanelProps<Options> {\n  /**\n   * Adds a key => value filter to the query referenced by the provided DataFrame refId. Used by Log details and Logs table.\n   * onClickFilterLabel?: (key: string, value: string, frame?: DataFrame) => void;\n   *\n   * Adds a negative key => value filter to the query referenced by the provided DataFrame refId. Used by Log details and Logs table.\n   * onClickFilterOutLabel?: (key: string, value: string, frame?: DataFrame) => void;\n   *\n   * Adds a string filter to the query referenced by the provided DataFrame refId. Used by the Logs popover menu.\n   * onClickFilterOutString?: (value: string, refId?: string) => void;\n   *\n   * Removes a string filter to the query referenced by the provided DataFrame refId. Used by the Logs popover menu.\n   * onClickFilterString?: (value: string, refId?: string) => void;\n   *\n   * Determines if a given key => value filter is active in a given query. Used by Log details.\n   * isFilterLabelActive?: (key: string, value: string, refId?: string) => Promise<boolean>;\n   *\n   * Array of field names to display instead of the log line. Pass a list of fields or an empty array to enable hide/show fields in Log Details.\n   * displayedFields?: string[]\n   *\n   * Called from the \"eye\" icon in Log Details to request showing the displayed field. If ommited, a default implementation is used.\n   * onClickShowField?: (key: string) => void;\n   *\n   * Called from the \"eye\" icon in Log Details to request hiding the displayed field. If ommited, a default implementation is used.\n   * onClickHideField?: (key: string) => void;\n   *\n   * Passed to the LogRowMenuCell component to be rendered before the default actions in the menu.\n   * logRowMenuIconsBefore?: ReactNode[];\n   *\n   * Passed to the LogRowMenuCell component to be rendered after the default actions in the menu.\n   * logRowMenuIconsAfter?: ReactNode[];\n   *\n   * Callback to be invoked when enableInfiniteScrolling and new logs have been received after an scroll event.\n   * onNewLogsReceived?: (allLogs: DataFrame[], newLogs: DataFrame[]) => void;\n   *\n   * Log Controls props:\n   *\n   * Enables a sidebar with controls for scrolling, sort order, deduplication, filtering, timestamps, wrapping, etc.\n   * showControls?: boolean\n   *\n   * If controls are enabled, the component will use this key to store changes to the aforementioned options.\n   * controlsStorageKey?: string\n   *\n   * If controls are enabled, this function is called when a change is made in one of the options from the controls.\n   * onLogOptionsChange?: (option: keyof LogListControlOptions, value: string | boolean | string[]) => void;\n   *\n   * When the feature toggle newLogsPanel is enabled, you can pass extra options to the LogLineMenu component.\n   * These options are an array of items with { label, onClick } or { divider: true } for dividers.\n   * logLineMenuCustomItems?: LogLineMenuCustomItem[];\n   *\n   * Use the default, bigger, font size, or a smaller one. Defaults to \"default\".\n   * fontSize?: 'default' | 'small'\n   *\n   * Set the mode used by the Log Details panel. Displayed as a sidebar, or inline below the log line. Defaults to \"inline\".\n   * detailsMode?: 'inline' | 'sidebar'\n   */\n}\ninterface LogsPermalinkUrlState {\n  logs?: {\n    id?: string;\n  };\n}\n\nconst noCommonLabels: Labels = {};\n\nexport const LogsPanel = ({\n  data,\n  timeZone,\n  fieldConfig,\n  options: {\n    showControls,\n    controlsStorageKey,\n    showLabels,\n    showTime,\n    wrapLogMessage,\n    showCommonLabels,\n    prettifyLogMessage,\n    sortOrder,\n    dedupStrategy,\n    enableLogDetails,\n    showLogContextToggle,\n    onClickFilterLabel,\n    onClickFilterOutLabel,\n    onClickFilterOutString,\n    onClickFilterString,\n    onLogOptionsChange,\n    isFilterLabelActive,\n    logRowMenuIconsBefore,\n    logRowMenuIconsAfter,\n    logLineMenuCustomItems,\n    enableInfiniteScrolling,\n    onNewLogsReceived,\n    fontSize,\n    syntaxHighlighting,\n    detailsMode,\n    ...options\n  },\n  id,\n}: LogsPanelProps) => {\n  const isAscending = sortOrder === LogsSortOrder.Ascending;\n  const style = useStyles2(getStyles);\n  const logsContainerRef = useRef<HTMLDivElement>(null);\n  const [contextRow, setContextRow] = useState<LogRowModel | null>(null);\n  const [scrollElement, setScrollElement] = useState<HTMLDivElement | null>(null);\n  const [displayedFields, setDisplayedFields] = useState<string[]>(options.displayedFields ?? []);\n  // Loading state to be passed as a prop to the <InfiniteScroll> component\n  const [infiniteScrolling, setInfiniteScrolling] = useState(false);\n  // Loading ref to prevent firing multiple requests\n  const loadingRef = useRef(false);\n  const [panelData, setPanelData] = useState(data);\n  const dataSourcesMap = useDatasourcesFromTargets(panelData.request?.targets);\n  // Prevents the scroll position to change when new data from infinite scrolling is received\n  const keepScrollPositionRef = useRef<null | 'infinite-scroll' | 'user'>(null);\n  let closeCallback = useRef<() => void>();\n  const { app, eventBus, onAddAdHocFilter } = usePanelContext();\n\n  useEffect(() => {\n    getAppEvents().publish(\n      new LogSortOrderChangeEvent({\n        order: sortOrder,\n      })\n    );\n  }, [sortOrder]);\n\n  const onLogRowHover = useCallback(\n    (row?: LogRowModel) => {\n      if (row) {\n        eventBus.publish(\n          new DataHoverEvent({\n            point: {\n              time: row.timeEpochMs,\n            },\n          })\n        );\n      }\n    },\n    [eventBus]\n  );\n\n  const onLogContainerMouseLeave = useCallback(() => {\n    eventBus.publish(new DataHoverClearEvent());\n  }, [eventBus]);\n\n  const onCloseContext = useCallback(() => {\n    setContextRow(null);\n    if (closeCallback.current) {\n      closeCallback.current();\n    }\n  }, [closeCallback]);\n\n  const onOpenContext = useCallback(\n    (row: LogRowModel, onClose: () => void) => {\n      setContextRow(row);\n      closeCallback.current = onClose;\n    },\n    [closeCallback]\n  );\n\n  const showContextToggle = useCallback(\n    (row: LogRowModel): boolean => {\n      if (\n        !row.dataFrame.refId ||\n        !dataSourcesMap ||\n        (!showLogContextToggle &&\n          panelData.request?.app !== CoreApp.Dashboard &&\n          panelData.request?.app !== CoreApp.PanelEditor &&\n          panelData.request?.app !== CoreApp.PanelViewer)\n      ) {\n        return false;\n      }\n\n      const dataSource = dataSourcesMap.get(row.dataFrame.refId);\n      return hasLogsContextSupport(dataSource);\n    },\n    [dataSourcesMap, showLogContextToggle, panelData.request?.app]\n  );\n\n  const showPermaLink = useCallback(() => {\n    return !(\n      panelData.request?.app !== CoreApp.Dashboard &&\n      panelData.request?.app !== CoreApp.PanelEditor &&\n      panelData.request?.app !== CoreApp.PanelViewer\n    );\n  }, [panelData.request?.app]);\n\n  const getLogRowContext = useCallback(\n    async (row: LogRowModel, origRow: LogRowModel, options: LogRowContextOptions): Promise<DataQueryResponse> => {\n      if (!origRow.dataFrame.refId || !dataSourcesMap) {\n        return Promise.resolve({ data: [] });\n      }\n\n      const query = panelData.request?.targets[0];\n      if (!query) {\n        return Promise.resolve({ data: [] });\n      }\n\n      const dataSource = dataSourcesMap.get(origRow.dataFrame.refId);\n      if (!hasLogsContextSupport(dataSource)) {\n        return Promise.resolve({ data: [] });\n      }\n\n      options.scopedVars = panelData.request?.scopedVars;\n\n      return dataSource.getLogRowContext(row, options, query);\n    },\n    [panelData.request?.targets, panelData.request?.scopedVars, dataSourcesMap]\n  );\n\n  const getLogRowContextUi = useCallback(\n    (origRow: LogRowModel, runContextQuery?: () => void): React.ReactNode => {\n      if (!origRow.dataFrame.refId || !dataSourcesMap) {\n        return <></>;\n      }\n\n      const query = panelData.request?.targets[0];\n      if (!query) {\n        return <></>;\n      }\n\n      const dataSource = dataSourcesMap.get(origRow.dataFrame.refId);\n      if (!hasLogsContextUiSupport(dataSource)) {\n        return <></>;\n      }\n\n      if (!dataSource.getLogRowContextUi) {\n        return <></>;\n      }\n\n      return dataSource.getLogRowContextUi(origRow, runContextQuery, query, panelData.request?.scopedVars);\n    },\n    [panelData.request?.targets, panelData.request?.scopedVars, dataSourcesMap]\n  );\n\n  // Important to memoize stuff here, as panel rerenders a lot for example when resizing.\n  const [logRows, deduplicatedRows, commonLabels] = useMemo(() => {\n    const logs = panelData\n      ? dataFrameToLogsModel(\n          panelData.series,\n          panelData.request?.intervalMs,\n          undefined,\n          panelData.request?.targets,\n          Boolean(enableInfiniteScrolling)\n        )\n      : null;\n    const logRows = logs?.rows || [];\n    const commonLabels = logs?.meta?.find((m) => m.label === COMMON_LABELS);\n    const deduplicatedRows = dedupLogRows(logRows, dedupStrategy);\n    return [logRows, deduplicatedRows, commonLabels];\n  }, [dedupStrategy, enableInfiniteScrolling, panelData]);\n\n  const onPermalinkClick = useCallback(\n    async (row: LogRowModel) => {\n      return await copyDashboardUrl(row, logRows, panelData.timeRange);\n    },\n    [panelData.timeRange, logRows]\n  );\n\n  useEffect(() => {\n    if (data.state !== LoadingState.Loading) {\n      setPanelData(data);\n    }\n  }, [data]);\n\n  useLayoutEffect(() => {\n    if (config.featureToggles.newLogsPanel) {\n      return;\n    }\n    if (!logsContainerRef.current || !scrollElement || keepScrollPositionRef.current) {\n      keepScrollPositionRef.current =\n        keepScrollPositionRef.current === 'infinite-scroll' ? null : keepScrollPositionRef.current;\n      return;\n    }\n    /**\n     * In dashboards, users with newest logs at the bottom have the expectation of keeping the scroll at the bottom\n     * when new data is received. See https://github.com/grafana/grafana/pull/37634\n     */\n    if (panelData.request?.app === CoreApp.Dashboard || panelData.request?.app === CoreApp.PanelEditor) {\n      scrollElement.scrollTo(0, isAscending ? logsContainerRef.current.scrollHeight : 0);\n    }\n  }, [panelData.request?.app, isAscending, scrollElement, logRows]);\n\n  const getFieldLinks: GetFieldLinksFn = useCallback(\n    (field, rowIndex, dataFrame, vars) => {\n      return getFieldLinksForExplore({\n        field,\n        rowIndex,\n        range: panelData.timeRange,\n        dataFrame: dataFrame,\n        vars,\n      });\n    },\n    [panelData]\n  );\n\n  /**\n   * Scrolls the given row into view.\n   */\n  const scrollIntoView = useCallback(\n    (row: HTMLElement) => {\n      scrollElement?.scrollTo({\n        top: row.offsetTop,\n        behavior: 'smooth',\n      });\n    },\n    [scrollElement]\n  );\n\n  const handleOnClickFilterLabel = useCallback(\n    (key: string, value: string) => {\n      onAddAdHocFilter?.({\n        key,\n        value,\n        operator: '=',\n      });\n    },\n    [onAddAdHocFilter]\n  );\n\n  const handleOnClickFilterOutLabel = useCallback(\n    (key: string, value: string) => {\n      onAddAdHocFilter?.({\n        key,\n        value,\n        operator: '!=',\n      });\n    },\n    [onAddAdHocFilter]\n  );\n\n  const showField = useCallback(\n    (key: string) => {\n      const index = displayedFields?.indexOf(key);\n      if (index === -1) {\n        setDisplayedFields(displayedFields?.concat(key));\n      }\n    },\n    [displayedFields]\n  );\n\n  const hideField = useCallback(\n    (key: string) => {\n      const index = displayedFields?.indexOf(key);\n      if (index !== undefined && index > -1) {\n        setDisplayedFields(displayedFields?.filter((k) => key !== k));\n      }\n    },\n    [displayedFields]\n  );\n\n  useEffect(() => {\n    if (options.displayedFields) {\n      setDisplayedFields(options.displayedFields);\n    }\n  }, [options.displayedFields]);\n\n  // Respect the scroll position when refreshing the panel\n  useEffect(() => {\n    function handleScroll() {\n      if (!scrollElement) {\n        return;\n      }\n      // Signal to keep the user scroll position\n      keepScrollPositionRef.current = 'user';\n      const atTheBottom = scrollElement.scrollHeight - scrollElement.scrollTop - scrollElement.clientHeight === 0;\n      // Except when the user resets the scroll to the original position depending on the sort direction\n      if (scrollElement.scrollTop === 0 && !isAscending) {\n        keepScrollPositionRef.current = null;\n      } else if (atTheBottom && isAscending) {\n        keepScrollPositionRef.current = null;\n      }\n    }\n    scrollElement?.addEventListener('scroll', handleScroll);\n    scrollElement?.addEventListener('wheel', handleScroll);\n    return () => {\n      scrollElement?.removeEventListener('scroll', handleScroll);\n      scrollElement?.removeEventListener('wheel', handleScroll);\n    };\n  }, [isAscending, scrollElement]);\n\n  const loadMoreLogs = useCallback(\n    async (scrollRange: AbsoluteTimeRange) => {\n      if (!data.request || !config.featureToggles.logsInfiniteScrolling || loadingRef.current) {\n        return;\n      }\n\n      loadingRef.current = true;\n      setInfiniteScrolling(true);\n\n      const onNewLogsReceivedCallback = isOnNewLogsReceivedType(onNewLogsReceived) ? onNewLogsReceived : undefined;\n\n      let newSeries: DataFrame[] = [];\n      try {\n        newSeries = await requestMoreLogs(dataSourcesMap, panelData, scrollRange, timeZone, onNewLogsReceivedCallback);\n      } catch (e) {\n        console.error(e);\n      } finally {\n        setInfiniteScrolling(false);\n        loadingRef.current = false;\n      }\n\n      keepScrollPositionRef.current = 'infinite-scroll';\n      setPanelData({\n        ...panelData,\n        series: newSeries,\n      });\n    },\n    [data.request, dataSourcesMap, onNewLogsReceived, panelData, timeZone]\n  );\n\n  const renderCommonLabels = () => (\n    <div className={cx(style.labelContainer, isAscending && style.labelContainerAscending)}>\n      <span className={style.label}>\n        <Trans i18nKey=\"logs.logs-panel.render-common-labels.common-labels\">Common labels:</Trans>\n      </span>\n      <LogLabels\n        labels={typeof commonLabels?.value === 'object' ? commonLabels?.value : noCommonLabels}\n        emptyMessage=\"(no common labels)\"\n      />\n    </div>\n  );\n\n  const initialScrollPosition = useMemo(() => {\n    /**\n     * In dashboards, users with newest logs at the bottom have the expectation of keeping the scroll at the bottom\n     * when new data is received. See https://github.com/grafana/grafana/pull/37634\n     */\n    if (app === CoreApp.Dashboard || app === CoreApp.PanelEditor) {\n      return sortOrder === LogsSortOrder.Ascending ? 'bottom' : 'top';\n    }\n    return 'top';\n  }, [app, sortOrder]);\n\n  const storageKey = useMemo(() => {\n    if (controlsStorageKey) {\n      return controlsStorageKey;\n    }\n    if (!data.request) {\n      return undefined;\n    }\n    return `${data.request?.dashboardUID}.${id}`;\n  }, [controlsStorageKey, data.request, id]);\n\n  if (!data || logRows.length === 0) {\n    return <PanelDataErrorView fieldConfig={fieldConfig} panelId={id} data={data} needsStringField />;\n  }\n\n  // Passing callbacks control the display of the filtering buttons. We want to pass it only if onAddAdHocFilter is defined.\n  const defaultOnClickFilterLabel = onAddAdHocFilter ? handleOnClickFilterLabel : undefined;\n  const defaultOnClickFilterOutLabel = onAddAdHocFilter ? handleOnClickFilterOutLabel : undefined;\n\n  const onClickShowField = isOnClickShowField(options.onClickShowField) ? options.onClickShowField : showField;\n  const onClickHideField = isOnClickHideField(options.onClickHideField) ? options.onClickHideField : hideField;\n\n  return (\n    <>\n      {contextRow && (\n        <LogRowContextModal\n          open={contextRow !== null}\n          row={contextRow}\n          onClose={onCloseContext}\n          getRowContext={(row, options) => getLogRowContext(row, contextRow, options)}\n          logsSortOrder={sortOrder}\n          timeZone={timeZone}\n          getLogRowContextUi={getLogRowContextUi}\n        />\n      )}\n      {config.featureToggles.newLogsPanel && (\n        <div\n          onMouseLeave={onLogContainerMouseLeave}\n          className={style.logListContainer}\n          ref={(element: HTMLDivElement) => setScrollElement(element)}\n        >\n          {deduplicatedRows.length > 0 && scrollElement && (\n            <LogList\n              app={isCoreApp(app) ? app : CoreApp.Dashboard}\n              containerElement={scrollElement}\n              dedupStrategy={dedupStrategy}\n              detailsMode={detailsMode}\n              displayedFields={displayedFields}\n              enableLogDetails={enableLogDetails}\n              fontSize={fontSize}\n              getFieldLinks={getFieldLinks}\n              isLabelFilterActive={isIsFilterLabelActive(isFilterLabelActive) ? isFilterLabelActive : undefined}\n              initialScrollPosition={initialScrollPosition}\n              loading={infiniteScrolling}\n              logLineMenuCustomItems={\n                isLogLineMenuCustomItems(logLineMenuCustomItems) ? logLineMenuCustomItems : undefined\n              }\n              logs={deduplicatedRows}\n              logSupportsContext={showContextToggle}\n              loadMore={enableInfiniteScrolling ? loadMoreLogs : undefined}\n              onClickFilterLabel={\n                isOnClickFilterLabel(onClickFilterLabel) ? onClickFilterLabel : defaultOnClickFilterLabel\n              }\n              onClickFilterOutLabel={\n                isOnClickFilterOutLabel(onClickFilterOutLabel) ? onClickFilterOutLabel : defaultOnClickFilterOutLabel\n              }\n              onClickFilterString={isOnClickFilterString(onClickFilterString) ? onClickFilterString : undefined}\n              onClickFilterOutString={\n                isOnClickFilterOutString(onClickFilterOutString) ? onClickFilterOutString : undefined\n              }\n              onClickShowField={displayedFields !== undefined ? onClickShowField : undefined}\n              onClickHideField={displayedFields !== undefined ? onClickHideField : undefined}\n              onLogLineHover={onLogRowHover}\n              onLogOptionsChange={isOnLogOptionsChange(onLogOptionsChange) ? onLogOptionsChange : undefined}\n              onOpenContext={onOpenContext}\n              onPermalinkClick={showPermaLink() ? onPermalinkClick : undefined}\n              permalinkedLogId={getLogsPanelState()?.logs?.id ?? undefined}\n              setDisplayedFields={setDisplayedFields}\n              showControls={Boolean(showControls)}\n              showTime={showTime}\n              sortOrder={sortOrder}\n              logOptionsStorageKey={storageKey}\n              syntaxHighlighting={syntaxHighlighting}\n              timeRange={data.timeRange}\n              timeZone={timeZone}\n              wrapLogMessage={wrapLogMessage}\n            />\n          )}\n        </div>\n      )}\n      {!config.featureToggles.newLogsPanel && !showControls && (\n        <ScrollContainer ref={(scrollElement) => setScrollElement(scrollElement)}>\n          <div onMouseLeave={onLogContainerMouseLeave} className={style.container} ref={logsContainerRef}>\n            {showCommonLabels && !isAscending && renderCommonLabels()}\n            <InfiniteScroll\n              loading={infiniteScrolling}\n              loadMoreLogs={enableInfiniteScrolling ? loadMoreLogs : undefined}\n              range={data.timeRange}\n              timeZone={timeZone}\n              rows={logRows}\n              scrollElement={scrollElement}\n              sortOrder={sortOrder}\n            >\n              <LogRows\n                scrollElement={scrollElement}\n                scrollIntoView={scrollIntoView}\n                permalinkedRowId={getLogsPanelState()?.logs?.id ?? undefined}\n                onPermalinkClick={showPermaLink() ? onPermalinkClick : undefined}\n                logRows={logRows}\n                showContextToggle={showContextToggle}\n                deduplicatedRows={deduplicatedRows}\n                dedupStrategy={dedupStrategy}\n                showLabels={showLabels}\n                showTime={showTime}\n                wrapLogMessage={wrapLogMessage}\n                prettifyLogMessage={prettifyLogMessage}\n                timeZone={timeZone}\n                getFieldLinks={getFieldLinks}\n                logsSortOrder={sortOrder}\n                enableLogDetails={enableLogDetails}\n                previewLimit={isAscending ? logRows.length : undefined}\n                onLogRowHover={onLogRowHover}\n                app={isCoreApp(app) ? app : CoreApp.Dashboard}\n                onOpenContext={onOpenContext}\n                onClickFilterLabel={\n                  isOnClickFilterLabel(onClickFilterLabel) ? onClickFilterLabel : defaultOnClickFilterLabel\n                }\n                onClickFilterOutLabel={\n                  isOnClickFilterOutLabel(onClickFilterOutLabel) ? onClickFilterOutLabel : defaultOnClickFilterOutLabel\n                }\n                onClickFilterString={isOnClickFilterString(onClickFilterString) ? onClickFilterString : undefined}\n                onClickFilterOutString={\n                  isOnClickFilterOutString(onClickFilterOutString) ? onClickFilterOutString : undefined\n                }\n                isFilterLabelActive={isIsFilterLabelActive(isFilterLabelActive) ? isFilterLabelActive : undefined}\n                displayedFields={displayedFields}\n                onClickShowField={displayedFields !== undefined ? onClickShowField : undefined}\n                onClickHideField={displayedFields !== undefined ? onClickHideField : undefined}\n                logRowMenuIconsBefore={isReactNodeArray(logRowMenuIconsBefore) ? logRowMenuIconsBefore : undefined}\n                logRowMenuIconsAfter={isReactNodeArray(logRowMenuIconsAfter) ? logRowMenuIconsAfter : undefined}\n                // Ascending order causes scroll to stick to the bottom, so previewing is futile\n                renderPreview={isAscending ? false : true}\n              />\n            </InfiniteScroll>\n            {showCommonLabels && isAscending && renderCommonLabels()}\n          </div>\n        </ScrollContainer>\n      )}\n      {!config.featureToggles.newLogsPanel && showControls && (\n        <div onMouseLeave={onLogContainerMouseLeave} className={style.controlledLogsContainer}>\n          {showCommonLabels && !isAscending && renderCommonLabels()}\n          <ControlledLogRows\n            ref={(scrollElement: HTMLDivElement | null) => setScrollElement(scrollElement)}\n            visualisationType=\"logs\"\n            loading={infiniteScrolling}\n            loadMoreLogs={enableInfiniteScrolling ? loadMoreLogs : undefined}\n            range={data.timeRange}\n            logRows={logRows}\n            deduplicatedRows={deduplicatedRows}\n            dedupStrategy={dedupStrategy}\n            onClickFilterLabel={\n              isOnClickFilterLabel(onClickFilterLabel) ? onClickFilterLabel : defaultOnClickFilterLabel\n            }\n            onClickFilterOutLabel={\n              isOnClickFilterOutLabel(onClickFilterOutLabel) ? onClickFilterOutLabel : defaultOnClickFilterOutLabel\n            }\n            showContextToggle={showContextToggle}\n            showLabels={showLabels}\n            showTime={showTime}\n            enableLogDetails={enableLogDetails}\n            wrapLogMessage={wrapLogMessage}\n            prettifyLogMessage={prettifyLogMessage}\n            timeZone={timeZone}\n            getFieldLinks={getFieldLinks}\n            logsSortOrder={sortOrder}\n            displayedFields={displayedFields}\n            onClickShowField={displayedFields !== undefined ? onClickShowField : undefined}\n            onClickHideField={displayedFields !== undefined ? onClickHideField : undefined}\n            app={isCoreApp(app) ? app : CoreApp.Dashboard}\n            onLogRowHover={onLogRowHover}\n            onOpenContext={onOpenContext}\n            onPermalinkClick={onPermalinkClick}\n            permalinkedRowId={getLogsPanelState()?.logs?.id ?? undefined}\n            scrollIntoView={scrollIntoView}\n            isFilterLabelActive={isIsFilterLabelActive(isFilterLabelActive) ? isFilterLabelActive : undefined}\n            onClickFilterString={isOnClickFilterString(onClickFilterString) ? onClickFilterString : undefined}\n            onClickFilterOutString={\n              isOnClickFilterOutString(onClickFilterOutString) ? onClickFilterOutString : undefined\n            }\n            logRowMenuIconsBefore={isReactNodeArray(logRowMenuIconsBefore) ? logRowMenuIconsBefore : undefined}\n            logRowMenuIconsAfter={isReactNodeArray(logRowMenuIconsAfter) ? logRowMenuIconsAfter : undefined}\n            onLogOptionsChange={isOnLogOptionsChange(onLogOptionsChange) ? onLogOptionsChange : undefined}\n            logOptionsStorageKey={controlsStorageKey}\n            // Ascending order causes scroll to stick to the bottom, so previewing is futile\n            renderPreview={isAscending ? false : true}\n          />\n          {showCommonLabels && isAscending && renderCommonLabels()}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    marginBottom: theme.spacing(1.5),\n  }),\n  logListContainer: css({\n    minHeight: '100%',\n    maxHeight: '100%',\n    display: 'flex',\n    flex: 1,\n    flexDirection: 'column',\n  }),\n  controlledLogsContainer: css({\n    height: '100%',\n  }),\n  labelContainer: css({\n    margin: theme.spacing(0, 0, 0.5, 0.5),\n    display: 'flex',\n    alignItems: 'center',\n  }),\n  labelContainerAscending: css({\n    margin: theme.spacing(0.5, 0, 0.5, 0),\n  }),\n  label: css({\n    marginRight: theme.spacing(0.5),\n    fontSize: theme.typography.bodySmall.fontSize,\n    fontWeight: theme.typography.fontWeightMedium,\n  }),\n});\n\nfunction getLogsPanelState(): LogsPermalinkUrlState | undefined {\n  const urlParams = urlUtil.getUrlSearchParams();\n  const panelStateEncoded = urlParams?.panelState;\n  if (\n    panelStateEncoded &&\n    Array.isArray(panelStateEncoded) &&\n    panelStateEncoded?.length > 0 &&\n    typeof panelStateEncoded[0] === 'string'\n  ) {\n    try {\n      return JSON.parse(panelStateEncoded[0]);\n    } catch (e) {\n      console.error('error parsing logsPanelState', e);\n    }\n  }\n\n  return undefined;\n}\n\nasync function copyDashboardUrl(row: LogRowModel, rows: LogRowModel[], timeRange: TimeRange) {\n  // this is an extra check, to be sure that we are not\n  // creating permalinks for logs without an id-field.\n  // normally it should never happen, because we do not\n  // display the permalink button in such cases.\n  if (row.rowId === undefined || !row.dataFrame.refId) {\n    return;\n  }\n\n  // get panel state, add log-row-id\n  const panelState = {\n    logs: { id: row.uid },\n  };\n\n  // Grab the current dashboard URL\n  const currentURL = new URL(window.location.href);\n\n  // Add panel state containing the rowId, and absolute time range from the current query, but leave everything else the same, if the user is in edit mode when grabbing the link, that's what will be linked to, etc.\n  currentURL.searchParams.set('panelState', JSON.stringify(panelState));\n  const range = getLogsPermalinkRange(row, rows, {\n    from: toUtc(timeRange.from).valueOf(),\n    to: toUtc(timeRange.to).valueOf(),\n  });\n  currentURL.searchParams.set('from', range.from.toString());\n  currentURL.searchParams.set('to', range.to.toString());\n\n  await createAndCopyShortLink(currentURL.toString());\n\n  return Promise.resolve();\n}\n\nexport async function requestMoreLogs(\n  dataSourcesMap: Map<string, DataSourceApi>,\n  panelData: PanelData,\n  timeRange: AbsoluteTimeRange,\n  timeZone: TimeZone,\n  onNewLogsReceived?: onNewLogsReceivedType\n) {\n  if (!panelData.request) {\n    return [];\n  }\n\n  const range: TimeRange = rangeUtil.convertRawToRange({\n    from: dateTimeForTimeZone(timeZone, timeRange.from),\n    to: dateTimeForTimeZone(timeZone, timeRange.to),\n  });\n\n  const targetGroups = groupBy(panelData.request.targets, 'datasource.uid');\n  const dataRequests = [];\n\n  for (const uid in targetGroups) {\n    const dataSource = dataSourcesMap.get(panelData.request.targets[0].refId);\n    if (!dataSource) {\n      console.warn(`Could not resolve data source for target ${panelData.request.targets[0].refId}`);\n      continue;\n    }\n    dataRequests.push(\n      dataSource.query({\n        ...panelData.request,\n        range,\n        targets: targetGroups[uid],\n      })\n    );\n  }\n\n  const responses = await Promise.all(dataRequests);\n  let updatedSeries = panelData.series;\n  for (const response of responses) {\n    const newData = isObservable(response) ? await lastValueFrom(response) : response;\n\n    updatedSeries = combineResponses(\n      {\n        data: updatedSeries,\n      },\n      { data: newData.data }\n    ).data;\n\n    if (onNewLogsReceived) {\n      onNewLogsReceived(updatedSeries, newData.data);\n    }\n  }\n\n  return updatedSeries;\n}\n","import { useState } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { DataSourceApi } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { DataQuery } from '@grafana/schema';\n\nexport const useDatasourcesFromTargets = (targets: DataQuery[] | undefined): Map<string, DataSourceApi> => {\n  const [dataSourcesMap, setDataSourcesMap] = useState(new Map<string, DataSourceApi>());\n\n  useAsync(async () => {\n    if (!targets) {\n      setDataSourcesMap(new Map<string, DataSourceApi>());\n      return;\n    }\n\n    const raw = await Promise.all(\n      targets\n        .filter((target) => !!target.datasource?.uid)\n        .map((target) =>\n          getDataSourceSrv()\n            .get(target.datasource?.uid)\n            .then((ds) => ({ key: target.refId, ds }))\n        )\n    );\n\n    setDataSourcesMap(new Map<string, DataSourceApi>(raw.map(({ key, ds }) => [key, ds])));\n  }, [targets]);\n\n  return dataSourcesMap;\n};\n"],"names":["isOnClickFilterLabel","callback","isOnClickFilterOutLabel","isOnClickFilterString","isOnClickFilterOutString","isIsFilterLabelActive","isOnClickShowField","isOnClickHideField","isOnNewLogsReceivedType","isOnLogOptionsChange","isReactNodeArray","node","isCoreApp","app","apps","coreApp","isLogLineMenuCustomItems","items","item","noCommonLabels","LogsPanel","data","timeZone","fieldConfig","showControls","controlsStorageKey","showLabels","showTime","wrapLogMessage","showCommonLabels","prettifyLogMessage","sortOrder","dedupStrategy","enableLogDetails","showLogContextToggle","onClickFilterLabel","onClickFilterOutLabel","onClickFilterOutString","onClickFilterString","onLogOptionsChange","isFilterLabelActive","logRowMenuIconsBefore","logRowMenuIconsAfter","logLineMenuCustomItems","enableInfiniteScrolling","onNewLogsReceived","fontSize","syntaxHighlighting","detailsMode","options","id","isAscending","style","getStyles","logsContainerRef","contextRow","setContextRow","scrollElement","setScrollElement","displayedFields","setDisplayedFields","infiniteScrolling","setInfiniteScrolling","loadingRef","panelData","setPanelData","dataSourcesMap","useDatasourcesFromTargets","keepScrollPositionRef","closeCallback","eventBus","onAddAdHocFilter","onLogRowHover","row","onLogContainerMouseLeave","onCloseContext","onOpenContext","onClose","showContextToggle","dataSource","showPermaLink","getLogRowContext","origRow","query","getLogRowContextUi","runContextQuery","logRows","deduplicatedRows","commonLabels","logs","m","onPermalinkClick","copyDashboardUrl","config","getFieldLinks","field","rowIndex","dataFrame","vars","scrollIntoView","handleOnClickFilterLabel","key","value","handleOnClickFilterOutLabel","showField","hideField","index","k","handleScroll","atTheBottom","loadMoreLogs","scrollRange","onNewLogsReceivedCallback","newSeries","requestMoreLogs","e","renderCommonLabels","LogLabels","initialScrollPosition","storageKey","PanelDataErrorView","defaultOnClickFilterLabel","defaultOnClickFilterOutLabel","onClickShowField","onClickHideField","LogRowContextModal","element","LogList","getLogsPanelState","ScrollContainer","InfiniteScroll","LogRows","ControlledLogRows","theme","panelStateEncoded","url","rows","timeRange","panelState","currentURL","range","targetGroups","dataRequests","uid","responses","updatedSeries","response","newData","isObservable","lastValueFrom","targets","setDataSourcesMap","raw","target","ds"],"sourceRoot":""}