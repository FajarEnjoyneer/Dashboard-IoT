"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8550],{20276:(Gi,it,g)=>{g.d(it,{w:()=>F});var u=g(74848),ie=g(22803),v=g(96540),Me=g(63142);const wt=10,F=({colorPalette:U,min:le,max:M,display:j,hoverValue:ce,useStopsPercentage:G})=>{const[W,de]=(0,v.useState)([]),[J,fe]=(0,v.useState)({isShown:!1,value:0}),[P,ze]=(0,v.useState)(null),L=(0,Me.$j)(),B=St(L,W);(0,v.useEffect)(()=>{de(Ze({colorArray:U,stops:wt,useStopsPercentage:G}))},[U,G]);const he=Fe=>{const ge=Fe.nativeEvent.offsetX,D=Fe.currentTarget.offsetWidth,q=Math.floor(ge*100/D+1),st=Math.floor((M-le)*q/100+le);fe({isShown:!0,value:st}),ze(q)},Pe=()=>{fe({isShown:!1,value:0})};return(0,v.useEffect)(()=>{ze(ce==null?null:Ct((ce-le)/(M-le)))},[ce,le,M]),(0,u.jsxs)("div",{className:B.scaleWrapper,onMouseMove:he,onMouseLeave:Pe,children:[(0,u.jsx)("div",{className:B.scaleGradient,children:j&&(J.isShown||ce!==void 0)&&(0,u.jsx)("div",{className:B.followerContainer,children:(0,u.jsx)("div",{className:B.follower,style:{left:`${P}%`}})})}),j&&(0,u.jsxs)("div",{className:B.followerContainer,children:[(0,u.jsxs)("div",{className:B.legendValues,children:[(0,u.jsx)("span",{className:B.disabled,children:j(le)}),(0,u.jsx)("span",{className:B.disabled,children:j(M)})]}),P!=null&&(J.isShown||ce!==void 0)&&(0,u.jsx)("span",{className:B.hoverValue,style:{left:`${P}%`},children:j(ce??J.value)})]})]})},Ze=({colorArray:U,stops:le,useStopsPercentage:M=!0})=>{const j=U.length;if(M&&j<=20){const de=1/j*100;let J=0;const fe=[];for(const P of U)J>0?fe.push(`${P} ${J}%`):fe.push(P),J+=de,fe.push(`${P} ${J}%`);return fe}const ce=U[j-1],G=Math.ceil(j/le),W=new Set;for(let de=0;de<j;de+=G)W.add(U[de]);return W.add(ce),[...W]};function Ct(U){return U>1?100:U<0?0:U*100}const St=(U,le)=>({scaleWrapper:(0,ie.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,ie.css)({background:`linear-gradient(90deg, ${le.join()})`,height:"9px",pointerEvents:"none",borderRadius:U.shape.radius.default}),legendValues:(0,ie.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,ie.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,ie.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,ie.css)({position:"absolute",height:"13px",width:"13px",borderRadius:U.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${U.colors.text.primary}`,top:"5px"}),disabled:(0,ie.css)({color:U.colors.text.disabled})})},13326:(Gi,it,g)=>{g.d(it,{e:()=>j});var u=g(74848),ie=g(22803),v=g(16515),Me=g(55386),wt=g(46635),F=g(92745),Ze=g(739),Ct=g(63142),St=g(89640),U=g(53049),le=g(70362);function M(G,W,de,J,fe){const P=G.fields,ze=de!=null?P[de]:null,L=P.filter(D=>!D.config.custom?.hideFrom?.tooltip),B=L.find(D=>D.name==="traceID")||P[0],he=[];if(L.filter(D=>B===D).length>0&&he.push(B),he.push(...L.filter(D=>B!==D)),he.length===0)return null;const Pe=[],Fe=[],ge=new Set;for(const D of he){if(fe===Ze.$N.Single&&D!==ze)continue;const q=D.values[W],st=D.display?D.display(q):{text:`${q}`,numeric:+q};D.getLinks&&D.getLinks({calculatedValue:st,valueRowIndex:W}).forEach(At=>{const Nt=`${At.title}/${At.href}`;ge.has(Nt)||(Fe.push(At),ge.add(Nt))}),Pe.push({name:(0,v.Ct)(D,G),value:q,valueString:(0,Me.cN)(st),highlight:D===ze})}return J&&J!==Ze.xB.None&&Pe.sort((D,q)=>wt.sortValues(J)(D.value,q.value)),{displayValues:Pe,links:Fe}}const j=({data:G,rowIndex:W,columnIndex:de,sortOrder:J,mode:fe,header:P,padding:ze=0,maxHeight:L})=>{const B=(0,Ct.of)(ce,ze);if(!G||W==null)return null;const he=M(G,W,de,J,fe);if(he==null)return null;const{displayValues:Pe,links:Fe}=he;return P==="Exemplar"?(0,u.jsx)(le.i,{displayValues:Pe,links:Fe,header:P,maxHeight:L}):(0,u.jsxs)("div",{className:B.wrapper,children:[P&&(0,u.jsx)("div",{className:B.header,children:(0,u.jsx)("span",{className:B.title,children:P})}),(0,u.jsx)("table",{className:B.infoWrap,children:(0,u.jsxs)("tbody",{children:[Pe.map((ge,D)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:ge.name}),(0,u.jsx)("td",{children:(0,U.A)(ge.valueString)})]},`${D}/${W}`)),Fe.map((ge,D)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:(0,u.jsx)(F.x6,{i18nKey:"visualization.data-hover-view.link",children:"Link"})}),(0,u.jsx)("td",{colSpan:2,children:(0,u.jsx)(St.Y,{href:ge.href,external:ge.target==="_blank",weight:"medium",inline:!1,children:ge.title})})]},D))]})})]})},ce=(G,W=0)=>({wrapper:(0,ie.css)({padding:`${W}px`,background:G.components.tooltip.background,borderRadius:G.shape.borderRadius(2)}),header:(0,ie.css)({background:G.colors.background.secondary,alignItems:"center",alignContent:"center",display:"flex",paddingBottom:G.spacing(1)}),title:(0,ie.css)({fontWeight:G.typography.fontWeightMedium,overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),infoWrap:(0,ie.css)({padding:G.spacing(1),background:"transparent",border:"none",th:{fontWeight:G.typography.fontWeightMedium,padding:G.spacing(.25,2,.25,0)},tr:{borderBottom:`1px solid ${G.colors.border.weak}`,"&:last-child":{borderBottom:"none"}}}),link:(0,ie.css)({color:G.colors.text.link})})},98550:(Gi,it,g)=>{g.r(it),g.d(it,{plugin:()=>ea});var u=g(74848),ie=g(16207),v=g(92745),Me=g(43173),wt=g(45013),F=g(22803),Ze=g(17437),Ct=g(91765),St=g(57456),U=g(10972),le=g(25176),M=g(22796),j=g(90588);const ce="units",G=[1,2,5],W=25.4/.28;class de extends U.A{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+le.XI,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ce,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ce)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ce,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),o=s=="degrees"?"degrees":"m";let r=(0,M.hO)(i,e.resolution,t,o);const a=this.minWidth_*(this.dpi_||W)/W,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||W)/W:void 0;let c=a*r,d="";if(s=="degrees"){const T=M.Ig.degrees;c*=T,c<T/60?(d="\u2033",r*=3600):c<T?(d="\u2032",r*=60):d="\xB0"}else s=="imperial"?c<.9144?(d="in",r/=.0254):c<1609.344?(d="ft",r/=.3048):(d="mi",r/=1609.344):s=="nautical"?(r/=1852,d="NM"):s=="metric"?c<.001?(d="\u03BCm",r*=1e6):c<1?(d="mm",r*=1e3):c<1e3?d="m":(d="km",r/=1e3):s=="us"?c<.9144?(d="in",r*=39.37):c<1609.344?(d="ft",r/=.30480061):(d="mi",r/=1609.3472):(0,j.v)(!1,33);let h=3*Math.floor(Math.log(a*r)/Math.log(10)),f,m,p,y,x,C;for(;;){p=Math.floor(h/3);const T=Math.pow(10,p);if(f=G[(h%3+3)%3]*T,m=Math.round(f/r),isNaN(m)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&m>=l){f=y,m=x,p=C;break}else if(m>=a)break;y=f,x=m,C=p,++h}const S=this.scaleBar_?this.createScaleBar(m,f,d):f.toFixed(p<0?-p:0)+" "+d;this.renderedHTML_!=S&&(this.innerElement_.innerHTML=S,this.renderedHTML_=S),this.renderedWidth_!=m&&(this.innerElement_.style.width=m+"px",this.renderedWidth_=m),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),o=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,a=e/r,l=[this.createMarker("absolute")];for(let d=0;d<r;++d){const h=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(d%2===0||r===2?this.createStepText(d,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(r,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,o){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),l=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=(0,M.hO)(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||W,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const J=de;var fe=g(69186),P=g(70915),ze=g(88751),L=g(96540),B=g(64423),he=g(57852),Pe=g(64400),Fe=g(45229),ge=g(88813),D=g(87745),q=g(63142);const st=({topRight1:n,topRight2:e,bottomLeft:t,blStyle:i})=>{const s=(n&&n.length>0)??!1,o=(0,q.of)(At(s));return(0,u.jsxs)("div",{className:o.overlay,children:[!!n?.length&&(0,u.jsx)("div",{className:o.TR1,children:n}),!!e?.length&&(0,u.jsx)("div",{className:o.TR2,children:e}),!!t?.length&&(0,u.jsx)("div",{className:o.BL,style:i,children:t})]})},At=n=>e=>({overlay:(0,F.css)({position:"absolute",width:"100%",height:"100%",zIndex:500,pointerEvents:"none"}),TR1:(0,F.css)({right:"0.5em",pointerEvents:"auto",position:"absolute",top:"0.5em"}),TR2:(0,F.css)({position:"absolute",top:n?"80px":"8px",right:"8px",pointerEvents:"auto"}),BL:(0,F.css)({position:"absolute",bottom:"8px",left:"8px",pointerEvents:"auto"})});var Nt=g(18828),ln=g(93225),cn=g(15245),dn=g(71076),hn=g(15840),se=g(2543),bt=g(95004),un=g(16515),fn=g(13941),gn=g(89599),Ni=g(53049),mn=g(27359),pn=g(13326);const Bi=({feature:n})=>{let e,t=0;if(!n)return null;if(e=n.get("frame"),e)t=n.get("rowIndex");else{const{geometry:i,...s}=n.getProperties();e=new mn.f([s])}return(0,u.jsx)(pn.e,{data:e,rowIndex:t})},yn=({layers:n,activeTabIndex:e})=>{const t=(0,q.of)(vn),[i,s]=(0,L.useState)(new Map),o=(r,a)=>{s(new Map(i.set(r,a)))};return(0,u.jsx)(fn.J,{children:n.map((r,a)=>a===e&&(0,u.jsx)("div",{children:(0,u.jsx)("div",{children:r.features.map((l,c)=>{const d=l.getId()??c;return r.features.length>1?(0,u.jsx)(gn.S,{collapsible:!0,label:xn(l,c),isOpen:i.get(d),onToggle:()=>{o(d,!i.get(d))},className:t.collapsibleRow,children:(0,u.jsx)(Bi,{feature:l})},d):(0,u.jsx)(Bi,{feature:l},d)})})},r.layer.getName()))})},xn=(n,e)=>{const t=["Name","name","Title","ID","id"];let i=n.getProperties(),s="";const o=n.get("frame");if(o){const r=n.get("rowIndex");for(const a of o.fields)if(a.type===bt.PU.string){const l=(0,un.Ct)(a,o);s||(s=l),i[l]=a.values[r]}}for(let r of t){const a=i[r];if(a)return a}if(s)return(0,u.jsxs)("span",{children:[s,": ",(0,Ni.A)(i[s])]});for(let r of Object.keys(i)){const a=i[r];if((0,se.isString)(a))return(0,u.jsxs)("span",{children:[r,": ",(0,Ni.A)(a)]})}return`Match: ${e+1}`},vn=n=>({collapsibleRow:(0,F.css)({marginBottom:0})});var wn=g(54314),Cn=g(60208);const Sn=({layers:n,setActiveTabIndex:e,activeTabIndex:t})=>(0,u.jsx)(wn.U,{children:n&&n.map((i,s)=>(0,u.jsx)(Cn.o,{label:i.layer.getName(),active:s===t,counter:i.features.length>1?i.features.length:null,onChangeTab:()=>{e(s)}},s))}),An=({layers:n,onClose:e,isOpen:t})=>{const[i,s]=(0,L.useState)(0);return n?(0,u.jsxs)(u.Fragment,{children:[t&&(0,u.jsx)(hn.J,{style:{zIndex:1},onClick:e}),(0,u.jsx)(Sn,{layers:n,setActiveTabIndex:s,activeTabIndex:i}),(0,u.jsx)(yn,{layers:n,activeTabIndex:i})]}):null},bn=({ttip:n,onClose:e,isOpen:t})=>{const i=(0,L.createRef)(),{overlayProps:s}=(0,ln.e)({onClose:e,isDismissable:!0,isOpen:t},i),{dialogProps:o}=(0,Nt.s)({},i);return(0,u.jsx)(u.Fragment,{children:n&&n.layers&&(0,u.jsx)(cn.ZL,{children:(0,u.jsx)(dn.o,{position:{x:n.pageX,y:n.pageY},offset:{x:10,y:10},allowPointerEvents:!0,children:(0,u.jsx)("section",{ref:i,...s,...o,children:(0,u.jsx)(An,{layers:n.layers,isOpen:t,onClose:e})})})})})};var Ie=g(84140),Ui=g(51898),$e=g(65642);class Tn extends L.PureComponent{constructor(e){super(e),this.style=En($e.$W.theme2),this.updateViewState=()=>{const t=this.props.map.getView();this.setState({zoom:t.getZoom(),center:(0,M.pd)(t.getCenter(),t.getProjection(),"EPSG:4326")})},this.state={zoom:0,center:[0,0]}}componentDidMount(){this.props.map.on("moveend",this.updateViewState),this.updateViewState()}render(){const{zoom:e,center:t}=this.state;return(0,u.jsx)("div",{className:this.style.infoWrap,"aria-label":Ui.Tp.components.DebugOverlay.wrapper,children:(0,u.jsx)("table",{children:(0,u.jsxs)("tbody",{children:[(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:(0,u.jsx)(v.x6,{i18nKey:"geomap.debug-overlay.zoom",children:"Zoom:"})}),(0,u.jsx)("td",{children:e?.toFixed(1)})]}),(0,u.jsxs)("tr",{children:[(0,u.jsxs)("th",{children:[(0,u.jsx)(v.x6,{i18nKey:"geomap.debug-overlay.center",children:"Center:"}),"\xA0"]}),(0,u.jsxs)("td",{children:[t[0].toFixed(5),", ",t[1].toFixed(5)]})]})]})})})}}const En=n=>({infoWrap:(0,F.css)({color:n.colors.text.primary,background:(0,Ie.A)(n.components.panel.background).setAlpha(.7).toString(),borderRadius:n.shape.radius.default,padding:n.spacing(1)})});var nt=g(77824),Bt=g(45861),ot=g(18857),ci=g(76319),we=g(55386);const ne=[{value:"length",label:"Length",geometry:"LineString",units:[{label:"Metric (m/km)",value:"m",format:n=>(0,we.j_)("lengthm")(n)},{label:"Feet (ft)",value:"ft",format:n=>(0,we.j_)("lengthft")(n*3.28084)},{label:"Miles (mi)",value:"mi",format:n=>(0,we.j_)("lengthmi")(n/1609)},{label:"Nautical miles (nmi)",value:"nmi",format:n=>(0,we.j_)("nmi")(n/1852)}],getUnit:n=>{const e=ne[0].units;return n?.endsWith("2")&&(n=n.substring(0,n.length-1)),e.find(t=>t.value===n)??e[0]}},{value:"area",label:"Area",geometry:"Polygon",units:[{label:"Square Meters (m\xB2)",value:"m2",format:n=>(0,we.j_)("areaM2")(n)},{label:"Square Kilometers (km\xB2)",value:"km2",format:n=>(0,we.G8)("km\xB2")(n*1e-6)},{label:"Square Feet (ft\xB2)",value:"ft2",format:n=>(0,we.j_)("areaF2")(n*10.76391)},{label:"Square Miles (mi\xB2)",value:"mi2",format:n=>(0,we.j_)("areaMI2")(n*3861e-10)},{label:"Acres",value:"acre2",format:n=>(0,we.G8)("acre")(n*247105e-9)},{label:"Hectare",value:"hectare2",format:n=>(0,we.G8)("ha")(n*1e-4)}],getUnit:n=>{const e=ne[1].units;return n?.endsWith("2")||(n+="2"),e.find(t=>t.value===n)??e[0]}}];var Le=g(71064),oe=g(11217),me=g(44294),di=g(50071),Ut=g(32135),Wt=g(1685),Tt=g(6837),K=g(86717),Ce=g(73445),Wi=g(21409),_n=g(35341),N=g(4087),hi=g(43530);class Mn{constructor(e){this.rbush_=new _n(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[(0,N.v6)(t)]=i}load(e,t){const i=new Array(t.length);for(let s=0,o=t.length;s<o;s++){const r=e[s],a=t[s],l={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:a};i[s]=l,this.items_[(0,N.v6)(a)]=l}this.rbush_.load(i)}remove(e){const t=(0,N.v6)(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[(0,N.v6)(t)],s=[i.minX,i.minY,i.maxX,i.maxY];(0,P.aI)(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let s=0,o=e.length;s<o;s++)if(i=t(e[s]),i)return i;return i}isEmpty(){return(0,hi.p)(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return(0,P.N)(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const ui=Mn;var pe=g(88280),Ne=g(82986),Pn=g(28450),Fn=g(34120);class In extends Fn.A{constructor(e){super(),this.projection=(0,M.Jt)(e.projection),this.attributions_=Vi(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,s){t.viewResolver=i,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Vi(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Vi(n){return n?Array.isArray(n)?function(e){return n}:typeof n=="function"?n:function(e){return[n]}:null}const Xi=In;var Et=g(74238);function Yi(n,e){return[[-1/0,-1/0,1/0,1/0]]}function na(n,e){return[n]}function oa(n){return function(e,t,i){const s=n.getZForResolution(fromUserResolution(t,i)),o=n.getTileRangeForExtentAndZ(fromUserExtent(e,i),s),r=[],a=[s,0,0];for(a[1]=o.minX;a[1]<=o.maxX;++a[1])for(a[2]=o.minY;a[2]<=o.maxY;++a[2])r.push(toUserExtent(n.getTileCoordExtent(a),i));return r}}var Vt=g(66514),Xt=g(9438);let Zi=!1;function Ln(n,e,t,i,s,o,r){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Zi,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();let d;c=="json"||c=="text"?d=a.responseText:c=="xml"?(d=a.responseXML,d||(d=new DOMParser().parseFromString(a.responseText,"application/xml"))):c=="arraybuffer"&&(d=a.response),d?o(e.readFeatures(d,{extent:t,featureProjection:s}),e.readProjection(d)):r()}else r()},a.onerror=r,a.send()}function $i(n,e){return function(t,i,s,o,r){const a=this;Ln(n,e,t,i,s,function(l,c){a.addFeatures(l),o!==void 0&&o(l)},r||Et.tV)}}function ra(n){Zi=n}class Be extends Wt.Ay{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Dn extends Xi{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Et.tV,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&((0,j.v)(this.format_,7),this.loader_=$i(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Yi;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new ui:null,this.loadedExtentsRtree_=new ui,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(e.features)?s=e.features:e.features&&(i=e.features,s=i.getArray()),!t&&i===void 0&&(i=new di.A(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=(0,N.v6)(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Be(pe.A.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[(0,Xt.KT)(t,Tt.A.CHANGE,this.handleFeatureChange_,this),(0,Xt.KT)(t,Pn.A.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let i=!0;const s=t.getId();return s!==void 0&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=t),i&&((0,j.v)(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],s=[];for(let o=0,r=e.length;o<r;o++){const a=e[o],l=(0,N.v6)(a);this.addToIndex_(l,a)&&i.push(a)}for(let o=0,r=i.length;o<r;o++){const a=i[o],l=(0,N.v6)(a);this.setupChangeEvents_(l,a);const c=a.getGeometry();if(c){const d=c.getExtent();t.push(d),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(pe.A.ADDFEATURE))for(let o=0,r=i.length;o<r;o++)this.dispatchEvent(new Be(pe.A.ADDFEATURE,i[o]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(pe.A.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(pe.A.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Ut.A.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Ut.A.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(Xt.JH);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(i);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Be(pe.A.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(s){if(s.getGeometry().intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){if(i.getGeometry().intersectsExtent(e)){const o=t(i);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),(0,hi.p)(this.nullGeometryFeatures_)||(0,Vt.X$)(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=(0,P.QJ)(e,t);return[].concat(...s.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],s=e[1];let o=null;const r=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Et.rT,this.featuresRtree_.forEachInExtent(l,function(c){if(t(c)){const d=c.getGeometry(),h=a;if(a=d.closestPointXY(i,s,r,a),a<h){o=c;const f=Math.sqrt(a);l[0]=i-f,l[1]=s-f,l[2]=i+f,l[3]=s+f}}}),o}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=(0,N.v6)(t),s=t.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const r=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,t)):this.featuresRtree_&&this.featuresRtree_.update(r,t)}const o=t.getId();if(o!==void 0){const r=o.toString();this.idIndex_[r]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[r]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Be(pe.A.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:(0,N.v6)(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&(0,hi.p)(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const s=this.loadedExtentsRtree_,o=this.strategy_(e,t,i);for(let r=0,a=o.length;r<a;++r){const l=o[r];s.forEachInExtent(l,function(d){return(0,P.ms)(d.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Be(pe.A.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,d=>{--this.loadingExtentsCount_,this.dispatchEvent(new Be(pe.A.FEATURESLOADEND,void 0,d))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Be(pe.A.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(s){if((0,P.aI)(s.extent,e))return i=s,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=(0,N.v6)(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=(0,N.v6)(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(Xt.JH),delete this.featureChangeKeys_[t];const s=e.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[t],this.dispatchEvent(new Be(pe.A.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){(0,j.v)(this.format_,7),this.url_=e,this.setLoader($i(e,this.format_))}}const ye=Dn;var Oe=g(58704),H=g(6933),I=g(29276);const Ki=0,_t=1,Hi=[0,0,0,0],rt=[],fi={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class gi extends Wt.Ay{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Rn extends Wi.A{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Oe.fs,this.defaultDeleteCondition_=function(i){return(0,Oe.Js)(i)&&(0,Oe.t5)(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Oe.Gk,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ui,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ne.A({source:new ye({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:zn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new di.A(this.source_.getFeatures()),this.source_.addEventListener(pe.A.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(pe.A.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ut.A.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ut.A.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(Tt.A.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new di.A;const i=this.featuresBeingModified_.getArray();for(let s=0,o=t.length;s<o;++s){const r=t[s];for(let a=0,l=r.length;a<l;++a){const c=r[a].feature;c&&!i.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new gi(fi.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Tt.A.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const o=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===o&&this.dragSegments_.splice(r,1);t.remove(o)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length-1;s<o;++s){const r=i.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert((0,P.Tr)(r),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const c=r.slice(a,a+2),d={feature:e,geometry:t,depth:[s],index:a,segment:c};this.rBush_.insert((0,P.Tr)(c),d)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const c=r.slice(a,a+2),d={feature:e,geometry:t,depth:[s],index:a,segment:c};this.rBush_.insert((0,P.Tr)(c),d)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a){const c=r[a];for(let d=0,h=c.length-1;d<h;++d){const f=c.slice(d,d+2),m={feature:e,geometry:t,depth:[a,s],index:d,segment:f};this.rBush_.insert((0,P.Tr)(f),m)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:Ki,segment:[i,i]},o={feature:e,geometry:t,index:_t,segment:[i,i]},r=[s,o];s.featureSegments=r,o.featureSegments=r,this.rBush_.insert((0,P.dP)(i),s);let a=t;const l=(0,M.Tf)();if(l&&this.getMap()){const c=this.getMap().getView().getProjection();a=a.clone().transform(l,c),a=(0,Le.nD)(a).transform(c,l)}this.rBush_.insert(a.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const o=i[s],r=this.SEGMENT_WRITERS_[o.getType()];r(e,o)}}createOrUpdateVertexFeature_(e,t,i){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new K.A(new me.A(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",i),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Ce.A.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Ce.A.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Ce.A.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[];for(let o=0,r=this.dragSegments_.length;o<r;++o){const a=this.dragSegments_[o],l=a[0],c=l.feature;i.includes(c)||i.push(c);const d=l.geometry;s.includes(d)||s.push(d);const h=l.depth;let f;const m=l.segment,p=a[1];for(;t.length<d.getStride();)t.push(m[p][t.length]);switch(d.getType()){case"Point":f=t,m[0]=t,m[1]=t;break;case"MultiPoint":f=d.getCoordinates(),f[l.index]=t,m[0]=t,m[1]=t;break;case"LineString":f=d.getCoordinates(),f[l.index+p]=t,m[p]=t;break;case"MultiLineString":f=d.getCoordinates(),f[h[0]][l.index+p]=t,m[p]=t;break;case"Polygon":f=d.getCoordinates(),f[h[0]][l.index+p]=t,m[p]=t;break;case"MultiPolygon":f=d.getCoordinates(),f[h[1]][h[0]][l.index+p]=t,m[p]=t;break;case"Circle":if(m[0]=t,m[1]=t,l.index===Ki)this.changingFeature_=!0,d.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const y=e.map.getView().getProjection();let x=(0,H.Io)((0,M.Ad)(d.getCenter(),y),(0,M.Ad)(t,y));const C=(0,M.Tf)();if(C){const S=d.clone().transform(C,y);S.setRadius(x),x=S.transform(y,C).getRadius()}d.setRadius(x),this.changingFeature_=!1}break;default:}f&&this.setGeometryCoordinates_(d,f)}this.createOrUpdateVertexFeature_(t,i,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const s=e.map.getView().getProjection(),o=[],r=i.getGeometry().getCoordinates(),a=(0,P.Tr)([r]),l=this.rBush_.getInExtent(a),c={};l.sort(jn);for(let d=0,h=l.length;d<h;++d){const f=l[d],m=f.segment;let p=(0,N.v6)(f.geometry);const y=f.depth;if(y&&(p+="-"+y.join("-")),c[p]||(c[p]=new Array(2)),f.geometry.getType()==="Circle"&&f.index===_t){const x=Ji(t,f,s);(0,H.aI)(x,r)&&!c[p][0]&&(this.dragSegments_.push([f,0]),c[p][0]=f);continue}if((0,H.aI)(m[0],r)&&!c[p][0]){this.dragSegments_.push([f,0]),c[p][0]=f;continue}if((0,H.aI)(m[1],r)&&!c[p][1]){if(c[p][0]&&c[p][0].index===0){let x=f.geometry.getCoordinates();switch(f.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":x=x[y[1]];case"Polygon":if(f.index!==x[y[0]].length-2)continue;break;default:}}this.dragSegments_.push([f,1]),c[p][1]=f;continue}(0,N.v6)(m)in this.vertexSegments_&&!c[p][0]&&!c[p][1]&&this.insertVertexCondition_(e)&&o.push(f)}o.length&&this.willModifyFeatures_(e,[o]);for(let d=o.length-1;d>=0;--d)this.insertVertex_(o[d],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const o=s.getCenter(),r=i.featureSegments[0],a=i.featureSegments[1];r.segment[0]=o,r.segment[1]=o,a.segment[0]=o,a.segment[1]=o,this.rBush_.update((0,P.dP)(o),r);let l=s;const c=(0,M.Tf)();if(c){const d=e.map.getView().getProjection();l=l.clone().transform(c,d),l=(0,Le.nD)(l).transform(d,c)}this.rBush_.update(l.getExtent(),a)}else this.rBush_.update((0,P.Tr)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new gi(fi.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const s=i||t.getCoordinateFromPixel(e),o=t.getView().getProjection(),r=function(c,d){return Qi(s,c,o)-Qi(s,d,o)};let a,l;if(this.hitDetection_){const c=typeof this.hitDetection_=="object"?d=>d===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(d,h,f)=>{f&&(f=new me.A((0,M.te)(f.getCoordinates(),o)));const m=f||d.getGeometry();if(m.getType()==="Point"&&d instanceof K.A&&this.features_.getArray().includes(d)){l=m;const p=d.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:d,geometry:l,segment:[p,p]}]}return!0},{layerFilter:c})}if(!a){const c=(0,M.SD)((0,P.dP)(s,Hi),o),d=t.getView().getResolution()*this.pixelTolerance_,h=(0,M.JR)((0,P.r)(c,d,Hi),o);a=this.rBush_.getInExtent(h)}if(a&&a.length>0){const c=a.sort(r)[0],d=c.segment;let h=Ji(s,c,o);const f=t.getPixelFromCoordinate(h);let m=(0,H.Io)(e,f);if(l||m<=this.pixelTolerance_){const p={};if(p[(0,N.v6)(d)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-s[0],this.delta_[1]=h[1]-s[1]),c.geometry.getType()==="Circle"&&c.index===_t)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[c.feature],[c.geometry]);else{const y=t.getPixelFromCoordinate(d[0]),x=t.getPixelFromCoordinate(d[1]),C=(0,H.hG)(f,y),S=(0,H.hG)(f,x);m=Math.sqrt(Math.min(C,S)),this.snappedToVertex_=m<=this.pixelTolerance_,this.snappedToVertex_&&(h=C>S?d[1]:d[0]),this.createOrUpdateVertexFeature_(h,[c.feature],[c.geometry]);const T={};T[(0,N.v6)(c.geometry)]=!0;for(let b=1,E=a.length;b<E;++b){const _=a[b].segment;if((0,H.aI)(d[0],_[0])&&(0,H.aI)(d[1],_[1])||(0,H.aI)(d[0],_[1])&&(0,H.aI)(d[1],_[0])){const A=(0,N.v6)(a[b].geometry);A in T||(T[A]=!0,p[(0,N.v6)(_)]=!0)}else break}}this.vertexSegments_=p;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,o=e.geometry,r=e.depth,a=e.index;let l;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"Polygon":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"MultiPolygon":l=o.getCoordinates(),l[r[1]][r[0]].splice(a+1,0,t);break;case"LineString":l=o.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(o,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(o,a,r,1);const d={segment:[i[0],t],feature:s,geometry:o,depth:r,index:a};c.insert((0,P.Tr)(d.segment),d),this.dragSegments_.push([d,1]);const h={segment:[t,i[1]],feature:s,geometry:o,depth:r,index:a+1};c.insert((0,P.Tr)(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Ce.A.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new gi(fi.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,o,r,a,l,c,d,h,f,m,p;for(l=e.length-1;l>=0;--l)r=e[l],m=r[0],p=(0,N.v6)(m.feature),m.depth&&(p+="-"+m.depth.join("-")),p in t||(t[p]={}),r[1]===0?(t[p].right=m,t[p].index=m.index):r[1]==1&&(t[p].left=m,t[p].index=m.index+1);for(p in t){switch(f=t[p].right,d=t[p].left,c=t[p].index,h=c-1,d!==void 0?m=d:m=f,h<0&&(h=0),a=m.geometry,o=a.getCoordinates(),s=o,i=!1,a.getType()){case"MultiLineString":o[m.depth[0]].length>2&&(o[m.depth[0]].splice(c,1),i=!0);break;case"LineString":o.length>2&&(o.splice(c,1),i=!0);break;case"MultiPolygon":s=s[m.depth[1]];case"Polygon":s=s[m.depth[0]],s.length>4&&(c==s.length-1&&(c=0),s.splice(c,1),i=!0,c===0&&(s.pop(),s.push(s[0]),h=s.length-1));break;default:}if(i){this.setGeometryCoordinates_(a,o);const y=[];if(d!==void 0&&(this.rBush_.remove(d),y.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),y.push(f.segment[1])),d!==void 0&&f!==void 0){const x={depth:m.depth,feature:m.feature,geometry:m.geometry,index:h,segment:y};this.rBush_.insert((0,P.Tr)(x.segment),x)}this.updateSegmentIndices_(a,c,m.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(i===void 0||o.depth===void 0||(0,Vt.aI)(o.depth,i))&&o.index>t&&(o.index+=s)})}}function jn(n,e){return n.index-e.index}function Qi(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let o=i;if(e.index===_t){const r=(0,M.Tf)();r&&(o=o.clone().transform(r,t));const a=(0,H.hG)(o.getCenter(),(0,M.Ad)(n,t)),l=Math.sqrt(a)-o.getRadius();return l*l}}const s=(0,M.Ad)(n,t);return rt[0]=(0,M.Ad)(e.segment[0],t),rt[1]=(0,M.Ad)(e.segment[1],t),(0,H.$x)(s,rt)}function Ji(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===_t){let o=i;const r=(0,M.Tf)();return r&&(o=o.clone().transform(r,t)),(0,M.te)(o.getClosestPoint((0,M.Ad)(n,t)),t)}const s=(0,M.Ad)(n,t);return rt[0]=(0,M.Ad)(e.segment[0],t),rt[1]=(0,M.Ad)(e.segment[1],t),(0,M.te)((0,H.sG)(s,rt),t)}function zn(){const n=(0,I.mY)();return function(e,t){return n.Point}}const On=Rn;var Mt=g(62096),kn=g(92497),Gn=g(87622);class Yt extends Mt.Ay{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Yt(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const o=this.flatCoordinates,r=e-o[0],a=t-o[1],l=r*r+a*a;if(l<s){if(l===0)for(let c=0;c<this.stride;++c)i[c]=o[c];else{const c=this.getRadius()/Math.sqrt(l);i[0]=o[0]+c*r,i[1]=o[1]+c*a;for(let d=2;d<this.stride;++d)i[d]=o[d]}return i.length=this.stride,l}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],o=t-i[1];return s*s+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,P.N)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,P.HY)(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:(0,P.sB)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let o=1;o<t;++o)s[t+o]=e[o];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let o=(0,kn._n)(s,0,e,this.stride);s[o++]=s[0]+t;for(let r=1,a=this.stride;r<a;++r)s[o++]=s[r];s.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter((0,Gn.e$)(i,0,i.length,s,e,t,i)),this.changed()}}Yt.prototype.transform;const qi=Yt;var Nn=g(34338),Bn=g(82187),Un=g(10277),Zt=g(74321),Wn=g(30503),at=g(83123),re=g(61597);const $t={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Kt extends Wt.Ay{constructor(e,t){super(e),this.feature=t}}function Vn(n,e){const t=[];for(let i=0;i<e.length;++i){const o=e[i].getGeometry();es(n,o,t)}return t}function Ht(n,e){return(0,re.hG)(n[0],n[1],e[0],e[1])}function lt(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function Qt(n,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const o=Math.ceil(i),r=Math.floor(s);if(o>r){const l=ct(n,i),c=ct(n,s);return Ht(l,c)}let a=0;if(i<o){const l=ct(n,i),c=lt(n,o);a+=Ht(l,c)}if(r<s){const l=lt(n,r),c=ct(n,s);a+=Ht(l,c)}for(let l=o;l<r-1;++l){const c=lt(n,l),d=lt(n,l+1);a+=Ht(c,d)}return a}function es(n,e,t){if(e instanceof oe.A){Jt(n,e.getCoordinates(),!1,t);return}if(e instanceof Zt.A){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)Jt(n,i[s],!1,t);return}if(e instanceof Le.Ay){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)Jt(n,i[s],!0,t);return}if(e instanceof at.A){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a)Jt(n,r[a],!0,t)}return}if(e instanceof Nn.A){const i=e.getGeometries();for(let s=0;s<i.length;++s)es(n,i[s],t);return}}const mi={index:-1,endIndex:NaN};function Xn(n,e,t,i){const s=n[0],o=n[1];let r=1/0,a=-1,l=NaN;for(let h=0;h<e.targets.length;++h){const f=e.targets[h],m=f.coordinates;let p=1/0,y;for(let x=0;x<m.length-1;++x){const C=m[x],S=m[x+1],T=ts(s,o,C,S);T.squaredDistance<p&&(p=T.squaredDistance,y=x+T.along)}p<r&&(r=p,f.ring&&e.targetIndex===h&&(f.endIndex>f.startIndex?y<f.startIndex&&(y+=m.length):f.endIndex<f.startIndex&&y>f.startIndex&&(y-=m.length)),l=y,a=h)}const c=e.targets[a];let d=c.ring;if(e.targetIndex===a&&d){const h=ct(c.coordinates,l),f=t.getPixelFromCoordinate(h);(0,H.Io)(f,e.startPx)>i&&(d=!1)}if(d){const h=c.coordinates,f=h.length,m=c.startIndex,p=l;if(m<p){const y=Qt(h,m,p);Qt(h,m,p-f)<y&&(l-=f)}else{const y=Qt(h,m,p);Qt(h,m,p+f)<y&&(l+=f)}}return mi.index=a,mi.endIndex=l,mi}function Jt(n,e,t,i){const s=n[0],o=n[1];for(let r=0,a=e.length-1;r<a;++r){const l=e[r],c=e[r+1],d=ts(s,o,l,c);if(d.squaredDistance===0){const h=r+d.along;i.push({coordinates:e,ring:t,startIndex:h,endIndex:h});return}}}const pi={along:0,squaredDistance:0};function ts(n,e,t,i){const s=t[0],o=t[1],r=i[0],a=i[1],l=r-s,c=a-o;let d=0,h=s,f=o;return(l!==0||c!==0)&&(d=(0,re.qE)(((n-s)*l+(e-o)*c)/(l*l+c*c),0,1),h+=l*d,f+=c*d),pi.along=d,pi.squaredDistance=(0,re.Mg)((0,re.hG)(n,e,h,f),10),pi}function ct(n,e){const t=n.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let o=i+1;o>=t&&(o-=t);const r=n[i],a=r[0],l=r[1],c=n[o],d=c[0]-a,h=c[1]-l;return[a+d*s,l+h*s]}class Yn extends Wi.A{constructor(e){const t=e;t.stopDown||(t.stopDown=Et.W8),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=$n(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Et.rT,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=function(o,r,a){const l=r||new qi([NaN,NaN]),c=(0,M.Ad)(o[0],a),d=(0,H.hG)(c,(0,M.Ad)(o[o.length-1],a));l.setCenterAndRadius(c,Math.sqrt(d),this.geometryLayout_);const h=(0,M.Tf)();return h&&l.transform(a,h),l};else{let o;s==="Point"?o=me.A:s==="LineString"?o=oe.A:s==="Polygon"&&(o=Le.Ay),i=function(r,a,l){return a?s==="Polygon"?r[0].length?a.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(r,this.geometryLayout_):a=new o(r,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Ne.A({source:new ye({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Zn(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Oe.TS,this.freehandCondition_,e.freehand?this.freehandCondition_=Oe.Gk:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Oe.Kg,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Bn.A.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Oe.Gk:t=e:t=Oe.Zm,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Tt.A.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Ce.A.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Ce.A.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Ce.A.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===Ce.A.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===Ce.A.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Ce.A.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Ce.A.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Un.A(Ce.A.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=(0,P.Tr)([i,s]),r=this.traceSource_.getFeaturesInExtent(o);if(r.length===0)return;const a=Vn(e.coordinate,r);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-s+1}else{const s=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=s-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const o=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let a=o;a<=r;++a)s.push(lt(e.coordinates,a))}else{const o=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let a=o;a>=r;--a)s.push(lt(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&(0,H.Io)(t.startPx,e.pixel)<this.snapTolerance_)return;const i=Xn(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const o=ct(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],o=t[1]-i[1],r=s*s+o*o;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,o=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,o=[a[0][0],a[0][a[0].length-2]],t?o=[a[0][0]]:o=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,c=o.length;l<c;l++){const d=o[l],h=a.getPixelFromCoordinate(d),f=e[0]-h[0],m=e[1]-h[1],p=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(f*f+m*m)<=p,i){this.finishCoordinate_=d;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new K.A(new me.A(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new K.A);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new oe.A(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=(0,Mt.dn)(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new K.A(new oe.A(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new K.A,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Kt($t.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),o=(0,Mt.dn)(this.geometryLayout_);let r,a;for(;e.length<o;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],a=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,a=r[r.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,o;const r=this.mode_;r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):r==="Polygon"&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),s&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let o=0;o<e;++o){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const a=this.finishCoordinate_.slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(r,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const a=this.sketchLine_.getGeometry();if(r.length>=2){const l=r[r.length-2].slice();r[r.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Wn.A([t])):this.type_==="MultiLineString"?e.setGeometry(new Zt.A([t])):this.type_==="MultiPolygon"&&e.setGeometry(new at.A([t])),this.dispatchEvent(new Kt($t.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Kt($t.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const o=e[e.length-1];this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new K.A(new me.A(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Kt($t.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Zn(){const n=(0,I.mY)();return function(e,t){return n[e.getGeometry().getType()]}}function aa(n,e){return function(t,i,s){const o=fromUserCoordinate(t[0],s),r=fromUserCoordinate(t[t.length-1],s),a=Math.sqrt(squaredCoordinateDistance(o,r));i=i||fromCircle(new Circle(o),n);let l=e;if(!e&&e!==0){const d=r[0]-o[0],h=r[1]-o[1];l=Math.atan2(h,d)}makeRegular(i,o,a,l);const c=getUserProjection();return c&&i.transform(s,c),i}}function la(){return function(n,e,t){const i=boundingExtent([n[0],n[n.length-1]].map(function(r){return fromUserCoordinate(r,t)})),s=[[getBottomLeft(i),getBottomRight(i),getTopRight(i),getTopLeft(i),getBottomLeft(i)]];e?e.setCoordinates(s):e=new Polygon(s);const o=getUserProjection();return o&&e.transform(t,o),e}}function $n(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const Kn=Yn;var is=g(52490),dt=g(81426),O=g(13628),xe=g(86936),Ue=g(27733),z=g(953);class ss extends Ne.A{constructor(){super({source:new ye}),this.opts={action:"length",unit:"m"},this.segmentStyle=new I.Ay({text:new dt.A({font:"12px Calibri,sans-serif",fill:new O.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new O.A({color:"rgba(0, 0, 0, 0.4)"}),padding:[2,2,2,2],textBaseline:"bottom",offsetY:-12}),image:new xe.A({radius:6,points:3,angle:Math.PI,displacement:[0,8],fill:new O.A({color:"rgba(0, 0, 0, 0.4)"})})}),this.segmentStyles=[this.segmentStyle],this.shapeStyle=[new I.Ay({fill:new O.A({color:"rgba(255, 255, 255, 0.2)"}),image:new Ue.A({radius:5,stroke:new z.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new O.A({color:"rgba(255, 255, 255, 0.2)"})})}),new I.Ay({stroke:new z.A({color:[0,0,0,1],width:2,lineDash:[4,8],lineDashOffset:6})}),new I.Ay({stroke:new z.A({color:[255,255,255,1],width:2,lineDash:[4,8]})})],this.labelStyle=new I.Ay({text:new dt.A({font:"14px Calibri,sans-serif",fill:new O.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new O.A({color:"rgba(0, 0, 0, 0.7)"}),padding:[3,3,3,3],textBaseline:"bottom",offsetY:-15}),image:new xe.A({radius:8,points:3,angle:Math.PI,displacement:[0,10],fill:new O.A({color:"rgba(0, 0, 0, 0.7)"})})}),this.tipStyle=new I.Ay({text:new dt.A({font:"12px Calibri,sans-serif",fill:new O.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new O.A({color:"rgba(0, 0, 0, 0.4)"}),padding:[2,2,2,2],textAlign:"left",offsetX:15})}),this.modifyStyle=new I.Ay({image:new Ue.A({radius:5,stroke:new z.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new O.A({color:"rgba(0, 0, 0, 0.4)"})}),text:new dt.A({text:"Drag to modify",font:"12px Calibri,sans-serif",fill:new O.A({color:"rgba(255, 255, 255, 1)"}),backgroundFill:new O.A({color:"rgba(0, 0, 0, 0.7)"}),padding:[2,2,2,2],textAlign:"left",offsetX:15})}),this.modify=new On({source:this.getSource(),style:this.modifyStyle}),this.setStyle(e=>this.styleFunction(e,!1)),this.setVisible(!0)}setOptions(e){this.opts=e,this.getSource()?.refresh()}getMapMeasurement(e){let t=0,i=ne[0];return this.opts.action==="area"?(i=ne[1],t=(0,is.UG)(e)):t=(0,is.R3)(e),(0,we.cN)(i.getUnit(this.opts.unit).format(t))}styleFunction(e,t,i,s){const o=[...this.shapeStyle],r=e.getGeometry();if(r){const a=r.getType();let l,c,d;if((!i||i===a)&&(a==="Polygon"&&r instanceof Le.Ay?(l=r.getInteriorPoint(),c=this.getMapMeasurement(r),d=new oe.A(r.getCoordinates()[0])):a==="LineString"&&r instanceof oe.A&&(l=new me.A(r.getLastCoordinate()),c=this.getMapMeasurement(r))),t&&d){let h=0;d.forEachSegment((f,m)=>{const p=new oe.A([f,m]),y=this.getMapMeasurement(p);this.segmentStyles.length-1<h&&this.segmentStyles.push(this.segmentStyle.clone());const x=new me.A(p.getCoordinateAt(.5));this.segmentStyles[h].setGeometry(x),this.segmentStyles[h].getText().setText(y),o.push(this.segmentStyles[h]),h++})}c&&(this.labelStyle.setGeometry(l),this.labelStyle.getText().setText(c),o.push(this.labelStyle)),s&&a==="Point"&&r instanceof me.A&&!this.modify.getOverlay().getSource().getFeatures().length&&(this.tipPoint=r,this.tipStyle.getText().setText(s),o.push(this.tipStyle))}return o}addInteraction(e,t,i,s){const o=t,r=" Click to continue "+(o==="Polygon"?"polygon":"line")+` 
 (double-click to end) `,a=" Click to start ";let l=a;this.draw=new Kn({source:this.getSource(),type:o,style:c=>this.styleFunction(c,i,o,l)}),this.draw.on("drawstart",()=>{s&&this.getSource().clear(),this.modify.setActive(!1),l=r}),this.draw.on("drawend",()=>{this.modifyStyle.setGeometry(this.tipPoint),this.modify.setActive(!0),e.once("pointermove",()=>{this.modifyStyle.setGeometry("")}),l=a}),this.modify.setActive(!0),e.addInteraction(this.draw)}}const Hn=({map:n,menuActiveState:e})=>{const t=(0,L.useRef)(new ss),i=Qn($e.$W.theme2),[s,o]=(0,L.useState)(!0),[r,a]=(0,L.useState)(!1),[l,c]=(0,L.useState)({action:ne[0].value,unit:ne[0].units[0].value}),d=(0,L.useMemo)(()=>{const p=ne.find(x=>x.value===l.action)??ne[0],y=p.getUnit(l.unit);return t.current.setOptions(l),{current:y,options:p.units}},[l]),h=!0,f=!1;function m(){if(a(!r),e(!r),r)n.removeInteraction(t.current.draw),t.current.setVisible(!1);else{s&&(o(!1),t.current.setZIndex(1),n.addLayer(t.current),n.addInteraction(t.current.modify)),t.current.setVisible(!0),n.removeInteraction(t.current.draw);const p=ne.find(y=>y.value===l.action)??ne[0];t.current.addInteraction(n,p.geometry,f,h)}}return(0,u.jsx)("div",{className:`${i.infoWrap} ${r?null:i.infoWrapClosed}`,children:r?(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:i.rowGroup,children:[(0,u.jsx)(nt.z,{value:l.action,options:ne,size:"md",fullWidth:!1,onChange:p=>{n.removeInteraction(t.current.draw);const y=ne.find(C=>C.value===p)??ne[0],x=y.getUnit(l.unit);c({...l,action:y.value,unit:x.value}),t.current.addInteraction(n,y.geometry,f,h)}}),(0,u.jsx)(Bt.$n,{className:i.button,icon:"times",variant:"secondary",size:"sm",onClick:m})]}),(0,u.jsx)(ot.l6,{className:i.unitSelect,value:d.current,options:d.options,isSearchable:!1,onChange:p=>{const y=ne.find(C=>C.value===l.action)??ne[0],x=y.getUnit(p.value)??y.units[0];c({...l,unit:x.value})}})]}):(0,u.jsx)(ci.K,{className:i.icon,"data-testid":Ui.Tp.components.PanelEditor.measureButton,name:"ruler-combined",tooltip:(0,v.t)("geomap.measure-overlay.tooltip-show-measure-tools","Show measure tools"),tooltipPlacement:"left",onClick:m})})},Qn=n=>({button:(0,F.css)({marginLeft:"auto"}),icon:(0,F.css)({backgroundColor:n.colors.secondary.main,display:"inline-block",height:"19.25px",margin:"1px",width:"19.25px"}),infoWrap:(0,F.css)({color:`${n.colors.text}`,backgroundColor:n.colors.background.secondary,borderRadius:"4px",padding:"2px"}),infoWrapClosed:(0,F.css)({height:"25.25px",width:"25.25px"}),rowGroup:(0,F.css)({display:"flex",justifyContent:"flex-end"}),unitSelect:(0,F.css)({minWidth:"200px"})});var ca=g(99639);function Jn(n){return(0,Ze.css)({".ol-scale-line":{background:n.colors.border.weak},".ol-scale-line-inner":{border:`1px solid ${n.colors.text.primary}`,borderTop:0,color:n.colors.text.primary},".ol-control":{backgroundColor:n.colors.background.primary},".ol-control:hover":{backgroundColor:n.colors.background.secondary},".ol-control button":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.main},".ol-control button:hover":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.shade},".ol-control button:focus":{color:n.colors.secondary.text,backgroundColor:n.colors.secondary.main},".ol-attribution ul":{color:n.colors.text.primary,textShadow:"none"},".ol-attribution:not(.ol-collapsed)":{backgroundColor:n.colors.background.secondary}})}var ee=g(46568),ht=g(35598),Pt=g(15816),qt=g(39741),X=g(739),be=g(87039);class Ft extends ye{constructor(e){super({}),this.location=e}update(e){this.clear(!0);const t=(0,be.FM)(e,this.location);if(!t.field){this.changed();return}for(let i=0;i<e.length;i++)this.addFeatureInternal(new K.A({frame:e,rowIndex:i,geometry:t.field.values[i]}));this.changed()}updateLineString(e){this.clear(!0);const t=(0,be.FM)(e,this.location);if(!t.field){this.changed();return}const i=t.field,s=new oe.A(i.values.map(o=>o.getCoordinates()));this.addFeatureInternal(new K.A({frame:e,rowIndex:0,geometry:s})),this.changed()}}var ei=g(24120),ns=g(62467),os=g(76637),qn=g(79118),eo=g(20276),to=g(30868),io=g(68706);function rs(n){const{layerName:e,styleConfig:t,layer:i}=n,s=(0,q.of)(so),o=(0,ei.A)(i?.__state?.mouseEvents??(0,ns.of)(void 0)),r=t?.dims?.color?.field,a=(0,L.useMemo)(()=>{if(!r||!o)return;const p=o.getProperties();if(!p.frame)return;const x=p.rowIndex;return r.values[x]},[o,r]);if(!t)return(0,u.jsx)(u.Fragment,{});const{color:l,opacity:c}=t?.base??{},d=t?.config.symbol?.fixed;if(l&&d&&!r)return(0,u.jsxs)("div",{className:s.infoWrap,children:[(0,u.jsx)("div",{className:s.layerName,children:e}),(0,u.jsx)("div",{className:(0,F.cx)(s.layerBody,s.fixedColorContainer),children:(0,u.jsx)(to.y,{src:`public/${d}`,className:s.legendSymbol,title:(0,v.t)("geomap.markers-legend.title-symbol","Symbol"),style:{fill:l,opacity:c}})})]});if(!r)return(0,u.jsx)(u.Fragment,{});const h=(0,os.Qi)(r);if(h.isContinuous&&h.getColors){const p=h.getColors($e.$W.theme2),y=(0,qn.AP)(r),x=r.display?C=>(0,we.cN)(r.display(C)):C=>`${C}`;return(0,u.jsxs)("div",{className:s.infoWrap,children:[(0,u.jsx)("div",{className:s.layerName,children:e}),(0,u.jsx)("div",{className:(0,F.cx)(s.layerBody,s.colorScaleWrapper),children:(0,u.jsx)(eo.w,{hoverValue:a,colorPalette:p,min:y.min??0,max:y.max??100,display:x,useStopsPercentage:!1})})]})}const f=r?.config?.thresholds;if(!f||f.steps.length<2)return(0,u.jsx)("div",{});const m=(0,io.EI)(r.config,$e.$W.theme2);return(0,u.jsxs)("div",{className:s.infoWrap,children:[(0,u.jsx)("div",{className:s.layerName,children:e}),(0,u.jsx)("div",{className:(0,F.cx)(s.layerBody,s.legend),children:m.map((p,y)=>(0,u.jsxs)("div",{className:s.legendItem,children:[(0,u.jsx)("i",{style:{background:p.color}}),p.label]},`${y}/${p.label}`))})]})}const so=n=>({infoWrap:(0,F.css)({display:"flex",flexDirection:"column",background:n.colors.background.secondary,borderRadius:"1px",padding:n.spacing(1),borderBottom:`2px solid ${n.colors.border.strong}`,minWidth:"150px"}),layerName:(0,F.css)({fontSize:n.typography.body.fontSize}),layerBody:(0,F.css)({paddingLeft:"10px"}),legend:(0,F.css)({lineHeight:"18px",display:"flex",flexDirection:"column",fontSize:n.typography.bodySmall.fontSize,padding:"5px 10px 0",i:{width:"15px",height:"15px",float:"left",marginRight:"8px",opacity:.7,borderRadius:n.shape.radius.circle}}),legendItem:(0,F.css)({whiteSpace:"nowrap"}),fixedColorContainer:(0,F.css)({minWidth:"80px",fontSize:n.typography.bodySmall.fontSize,paddingTop:"5px"}),legendSymbol:(0,F.css)({height:"18px",width:"18px",margin:"auto"}),colorScaleWrapper:(0,F.css)({minWidth:"200px",fontSize:n.typography.bodySmall.fontSize,paddingTop:"10px"})});class as extends L.Component{constructor(e){super(e),this.state={subProps:e.initialSubProps}}componentDidMount(){this.sub=this.props.watch.subscribe({next:e=>{this.setState({subProps:e})},complete:()=>{},error:e=>{}})}componentWillUnmount(){this.sub&&this.sub.unsubscribe()}render(){const{subProps:e}=this.state;return(0,u.jsx)(this.props.child,{...e})}}var Te=g(97095),ve=g(18027),ue=g(37386),no=g(79233),oo=g(35427),yi=g(32881),xi=g(85053),ls=g(21253),ro=g(87405),cs=g(44798),ds=g(68694),hs=g(71820),ao=g(22001),ti=g(4896),w=g(53497),us=g(3407),fs=g(63704),ii=g(42954),gs=g(20012),lo=(n=>(n.circle="circle",n.square="square",n.triangle="triangle",n.star="star",n.cross="cross",n.x="x",n))(lo||{});const ut={circle:"img/icons/marker/circle.svg",square:"img/icons/marker/square.svg",triangle:"img/icons/marker/triangle.svg",star:"img/icons/marker/star.svg",cross:"img/icons/marker/cross.svg",x:"img/icons/marker/x-mark.svg"},ms={circle:"img/icons/marker/circle.svg",square:"img/icons/marker/square.svg",triangle:"img/icons/marker/triangle.svg"};function ft(n){const e=n.opacity==null?.8:n.opacity;if(e===1)return new O.A({color:n.color});if(e>0){const t=(0,Ie.A)(n.color).setAlpha(e).toRgbString();return new O.A({color:t})}}function co(n){const e=n.opacity==null?.8:n.opacity;if(e===1)return new z.A({color:n.color,width:n.lineWidth??1});if(e>0){const t=(0,Ie.A)(n.color).setAlpha(e).toRgbString();return new z.A({color:t,width:n.lineWidth??1})}}const De=n=>{if(!n.text)return;const e=Me.$.theme2.typography.fontFamily,t={...w.T5.textConfig,...n.textConfig};return new dt.A({text:n.text,fill:new O.A({color:n.color??w.T5.color.fixed}),font:`normal ${t.fontSize}px ${e}`,...t})},ps=n=>new I.Ay({text:De(n)}),ys=n=>{const e=new z.A({color:n.color,width:n.lineWidth??1}),t=n.size??w._7;return new I.Ay({image:new Ue.A({stroke:e,fill:ft(n),radius:t,displacement:We(n.symbolAlign??w.T5.symbolAlign,t)}),text:De(n),stroke:e})},It=n=>new I.Ay({fill:ft(n),stroke:new z.A({color:n.color,width:n.lineWidth??1}),text:De(n)}),vi=n=>new I.Ay({fill:ft(n),stroke:co(n),text:De(n)}),xs=n=>{const e=n.size??w._7,t=new z.A({color:"#F00",width:1});return[new I.Ay({image:new xe.A({stroke:t,points:4,radius:e,angle:Math.PI/4})}),new I.Ay({image:new xe.A({stroke:t,points:4,radius:e,radius2:0,angle:0})})]},ho=[{id:"circle",name:"Circle",aliasIds:[ut.circle],make:ys},{id:"square",name:"Square",aliasIds:[ut.square],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new I.Ay({image:new xe.A({stroke:new z.A({color:n.color,width:n.lineWidth??1}),fill:ft(n),points:4,radius:e,angle:Math.PI/4,rotation:t*Math.PI/180,displacement:We(n.symbolAlign??w.T5.symbolAlign,e)}),text:De(n)})}},{id:"triangle",name:"Triangle",aliasIds:[ut.triangle],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new I.Ay({image:new xe.A({stroke:new z.A({color:n.color,width:n.lineWidth??1}),fill:ft(n),points:3,radius:e,rotation:t*Math.PI/180,angle:0,displacement:We(n.symbolAlign??w.T5.symbolAlign,e)}),text:De(n)})}},{id:"star",name:"Star",aliasIds:[ut.star],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new I.Ay({image:new xe.A({stroke:new z.A({color:n.color,width:n.lineWidth??1}),fill:ft(n),points:5,radius:e,radius2:e*.4,angle:0,rotation:t*Math.PI/180,displacement:We(n.symbolAlign??w.T5.symbolAlign,e)}),text:De(n)})}},{id:"cross",name:"Cross",aliasIds:[ut.cross],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new I.Ay({image:new xe.A({stroke:new z.A({color:n.color,width:n.lineWidth??1}),points:4,radius:e,radius2:0,angle:0,rotation:t*Math.PI/180,displacement:We(n.symbolAlign??w.T5.symbolAlign,e)}),text:De(n)})}},{id:"x",name:"X",aliasIds:[ut.x],make:n=>{const e=n.size??w._7,t=n.rotation??0;return new I.Ay({image:new xe.A({stroke:new z.A({color:n.color,width:n.lineWidth??1}),points:4,radius:e,radius2:0,angle:Math.PI/4,rotation:t*Math.PI/180,displacement:We(n.symbolAlign??w.T5.symbolAlign,e)}),text:De(n)})}}];async function vs(n,e,t){return fetch(n,{method:"GET"}).then(i=>i.text()).then(i=>{i=fs.sQ.sanitizeSVGContent(i);const o=new DOMParser().parseFromString(i,"image/svg+xml"),r=o.getElementsByTagName("svg")[0];if(!r)return"";const a=e??100,l=r.getAttribute("width")??a,c=r.getAttribute("height")??a;if(r.setAttribute("fill","#fff"),r.setAttribute("width",`${l}px`),r.setAttribute("height",`${c}px`),t){const f=r.getAttribute("viewBox")?.split(" ")??[0,0,l,c],m=Number(f[2])/2,p=Number(f[3])/2,y=o.createElementNS("http://www.w3.org/2000/svg","circle");y.setAttribute("cx",m.toString()),y.setAttribute("cy",p.toString()),y.setAttribute("fill","none"),y.setAttribute("r",(m/2).toString()),y.setAttribute("stroke",`rgba(255,255,255,${t})`),y.setAttribute("stroke-width",m.toString()),r.prepend(y)}const d=new XMLSerializer().serializeToString(r);return`data:image/svg+xml,${encodeURIComponent(d)}`}).catch(i=>(console.error(i),""))}const wi=new ii.O(()=>ho);function uo(n){const e=wi.getIfExists(n);if(e?.aliasIds?.length)return e.aliasIds[0]}async function fo(n,e){const t={symbol:{symbolType:"circle",size:["get","size","number"],color:["color",["get","red"],["get","green"],["get","blue"]],offset:["array",["get","offsetX"],["get","offsetY"]],rotation:["get","rotation","number"],opacity:["get","opacity","number"]}};if(n&&t.symbol){const i="image",s=Object.keys(ms).find(o=>ms[o]===n)??i;if(t.symbol={...t.symbol,symbolType:s},s===i){const o=e===0?0:.1/(e??1);t.symbol={...t.symbol,src:await vs((0,gs.D)(n),void 0,o)}}}return t}async function go(n,e){if(!n)return e?ps:ys;let t=wi.getIfExists(n);if(t)return t.make;if(n.endsWith(".svg")){const i=await vs((0,gs.D)(n));return t={id:n,name:n,aliasIds:[],make:i?s=>{const o=s.size??w._7,r=s.rotation??0;return[new I.Ay({image:new us.A({src:i,color:s.color,opacity:s.opacity??1,scale:(w._7+o)/100,rotation:r*Math.PI/180,displacement:We(s.symbolAlign??w.T5.symbolAlign,o/2)}),text:s?.text?De(s):void 0}),new I.Ay({image:new xe.A({fill:new O.A({color:"rgba(0,0,0,0)"}),points:4,radius:s.size,rotation:r*Math.PI/180+Math.PI/4})})]}:xs},wi.register(t),t.make}return xs}function Ci(n){const e=n?.text;return e?!!(e.mode===X.RU.Fixed&&e.fixed?.length||e.mode===X.RU.Field&&e.field?.length):!1}async function ke(n){n||(n=w.T5);const e=Ci(n),t={},i=await go(n.symbol?.fixed,e),s={config:n,hasText:e,fields:t,base:{color:Me.$.theme2.visualization.getColorByName(n.color?.fixed??w.T5.color.fixed),opacity:n.opacity??w.T5.opacity,lineWidth:n.lineWidth??1,size:n.size?.fixed??w.T5.size.fixed,rotation:n.rotation?.fixed??w.T5.rotation.fixed,symbolAlign:n.symbolAlign??w.T5.symbolAlign},maker:i};return n.color?.field?.length&&(t.color=n.color.field),n.size?.field?.length&&(t.size=n.size.field),n.rotation?.field?.length&&(t.rotation=n.rotation.field),e&&(s.base.text=n.text?.fixed,s.base.textConfig=n.textConfig??w.T5.textConfig,n.text?.field?.length&&(t.text=n.text.field)),Object.keys(t).length||(s.fields=void 0),s}function We(n,e){const t=[0,0];return n?.horizontal===w.wq.Left?t[0]=-e:n?.horizontal===w.wq.Right&&(t[0]=e),n?.vertical===w.G4.Top?t[1]=e:n?.vertical===w.G4.Bottom&&(t[1]=-e),t}function mo(n){return n.startsWith("#")?po(n):n.startsWith("rgb")?yo(n):(console.warn(`Unsupported color format: ${n}`),null)}function po(n){n=n.slice(1);const e=parseInt(n.slice(0,2),16),t=parseInt(n.slice(2,4),16),i=parseInt(n.slice(4,6),16);return{r:e,g:t,b:i}}function yo(n){const e=n.match(/\d+\.?\d*/g);if(e){if(e.length===3)return{r:parseInt(e[0],10),g:parseInt(e[1],10),b:parseInt(e[2],10)};if(e.length===4)return{r:parseInt(e[0],10),g:parseInt(e[1],10),b:parseInt(e[2],10),a:parseFloat(e[3])};console.warn(`Unsupported color format: ${n}`)}else console.warn(`Unsupported color format: ${n}`);return null}const Ve=n=>{const{value:e,onChange:t,item:i}=n,s=(0,L.useMemo)(()=>i.settings?.frameMatcher?{...n.context,data:n.context.data.filter(i.settings.frameMatcher)}:n.context,[n.context,i.settings]),o=i.settings,r=A=>{t({...e,size:A})},a=A=>{t({...e,symbol:A})},l=A=>{t({...e,color:A})},c=A=>{t({...e,opacity:A})},d=A=>{t({...e,rotation:A})},h=A=>{t({...e,text:A})},f=A=>{t({...e,textConfig:{...e.textConfig,fontSize:A}})},m=A=>{t({...e,textConfig:{...e.textConfig,offsetX:A}})},p=A=>{t({...e,textConfig:{...e.textConfig,offsetY:A}})},y=A=>{t({...e,textConfig:{...e.textConfig,textAlign:A}})},x=A=>{t({...e,textConfig:{...e.textConfig,textBaseline:A}})},C=A=>{t({...e,symbolAlign:{...e?.symbolAlign,horizontal:A}})},S=A=>{t({...e,symbolAlign:{...e?.symbolAlign,vertical:A}})},b=(0,ei.A)(o?.layerInfo??(0,ns.of)())?.geometryType===w.W_.Point,E=Ci(e),_=2e3;return o?.simpleFixedValues?(0,u.jsxs)(u.Fragment,{children:[b&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.style-editor.label-symbol","Symbol"),children:(0,u.jsx)(cs.m,{value:e?.symbol??w.T5.symbol,context:s,onChange:a,item:{settings:{resourceType:"icon",folderName:ti.Iu.Marker,placeholderText:E?(0,v.t)("geomap.style-editor.placeholderText-select-symbol","Select a symbol"):(0,v.t)("geomap.style-editor.placeholderText-select-symbol-or-add-text","Select a symbol or add a text label"),placeholderValue:w.T5.symbol.fixed,showSourceRadio:!1,maxFiles:_}}})})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-rotation-angle","Rotation angle"),children:(0,u.jsx)(ds.A,{value:e?.rotation??w.T5.rotation,context:s,onChange:d,item:{settings:{min:w.T5.rotation.min,max:w.T5.rotation.max}}})})]}),(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.style-editor.label-color","Color"),labelWidth:10,children:(0,u.jsx)(no.c,{width:4,children:(0,u.jsx)(oo.sk,{color:e?.color?.fixed??w.T5.color.fixed,onChange:A=>{l({fixed:A})}})})})}),(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.style-editor.label-opacity","Opacity"),labelWidth:10,grow:!0,children:(0,u.jsx)(ls.G,{value:e?.opacity??w.T5.opacity,context:s,onChange:c,item:{settings:{min:0,max:1,step:.1}}})})})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-size","Size"),children:(0,u.jsx)(hs.g,{value:e?.size??w.T5.size,context:s,onChange:r,item:{settings:{min:1,max:100}}})}),!o?.hideSymbol&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-symbol","Symbol"),children:(0,u.jsx)(cs.m,{value:e?.symbol??w.T5.symbol,context:s,onChange:a,item:{settings:{resourceType:ti.zu.Icon,folderName:ti.Iu.Marker,placeholderText:E?(0,v.t)("geomap.style-editor.placeholderText-select-symbol","Select a symbol"):(0,v.t)("geomap.style-editor.placeholderText-select-symbol-or-add-text","Select a symbol or add a text label"),placeholderValue:w.T5.symbol.fixed,showSourceRadio:!1,maxFiles:_}}})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-symbol-vertical-align","Symbol vertical align"),children:(0,u.jsx)(nt.z,{value:e?.symbolAlign?.vertical??w.T5.symbolAlign.vertical,onChange:S,options:[{value:w.G4.Top,label:(0,v.t)("geomap.style-editor.vertical-align-options.label-top","Top")},{value:w.G4.Center,label:(0,v.t)("geomap.style-editor.vertical-align-options.label-center","Center")},{value:w.G4.Bottom,label:(0,v.t)("geomap.style-editor.vertical-align-options.label-bottom","Bottom")}]})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-symbol-horizontal-align","Symbol horizontal align"),children:(0,u.jsx)(nt.z,{value:e?.symbolAlign?.horizontal??w.T5.symbolAlign.horizontal,onChange:C,options:[{value:w.wq.Left,label:(0,v.t)("geomap.style-editor.horizontal-align-options.label-left","Left")},{value:w.wq.Center,label:(0,v.t)("geomap.style-editor.horizontal-align-options.label-center","Center")},{value:w.wq.Right,label:(0,v.t)("geomap.style-editor.horizontal-align-options.label-right","Right")}]})})]}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-color","Color"),children:(0,u.jsx)(ro.N,{value:e?.color??w.T5.color,context:s,onChange:l,item:{}})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-fill-opacity","Fill opacity"),children:(0,u.jsx)(ls.G,{value:e?.opacity??w.T5.opacity,context:s,onChange:c,item:{settings:{min:0,max:1,step:.1}}})}),o?.displayRotation&&(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-rotation-angle","Rotation angle"),children:(0,u.jsx)(ds.A,{value:e?.rotation??w.T5.rotation,context:s,onChange:d,item:{settings:{min:w.T5.rotation.min,max:w.T5.rotation.max}}})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-text-label","Text label"),children:(0,u.jsx)(ao.h,{value:e?.text??ti.nG,context:s,onChange:h,item:{}})}),E&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(yi.Gy,{children:[(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-font-size","Font size"),children:(0,u.jsx)(xi.w,{value:e?.textConfig?.fontSize??w.T5.textConfig.fontSize,context:s,onChange:f,item:{}})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-x-offset","X offset"),children:(0,u.jsx)(xi.w,{value:e?.textConfig?.offsetX??w.T5.textConfig.offsetX,context:s,onChange:m,item:{}})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-y-offset","Y offset"),children:(0,u.jsx)(xi.w,{value:e?.textConfig?.offsetY??w.T5.textConfig.offsetY,context:s,onChange:p,item:{}})})]}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-align","Align"),children:(0,u.jsx)(nt.z,{value:e?.textConfig?.textAlign??w.T5.textConfig.textAlign,onChange:y,options:[{value:w.DY.Left,label:(0,se.capitalize)(w.DY.Left)},{value:w.DY.Center,label:(0,se.capitalize)(w.DY.Center)},{value:w.DY.Right,label:(0,se.capitalize)(w.DY.Right)}]})}),(0,u.jsx)(ue.D,{label:(0,v.t)("geomap.style-editor.label-baseline","Baseline"),children:(0,u.jsx)(nt.z,{value:e?.textConfig?.textBaseline??w.T5.textConfig.textBaseline,onChange:x,options:[{value:w.fX.Top,label:(0,se.capitalize)(w.fX.Top)},{value:w.fX.Middle,label:(0,se.capitalize)(w.fX.Middle)},{value:w.fX.Bottom,label:(0,se.capitalize)(w.fX.Bottom)}]})})]})]})};var Q=g(46300);const Lt={style:w.T5,showLegend:!0},Si="markers",Ai={type:Si,name:"",config:Lt,location:{mode:X.aG.Auto},tooltip:!0},xo={id:Si,name:"Markers",description:"Use markers to render each data point",isBaseMap:!1,showLocation:!0,hideOpacity:!0,create:async(n,e,t,i)=>{const s={...Lt,...e?.config},o=await ke(s.style),r=s.style.symbol?.fixed,a=await fo(r,s.style.opacity),l=Ci(s.style),c=await(0,be.nE)(e.location),d=new Ft(c),h=new Pt.A({source:d,style:a}),f=new ee.A({source:d,declutter:!0});let m=l;const p=new ht.A({layers:m&&r?[h,f]:m&&!r?[f]:[h]}),y=new qt.m(1);let x=null;return s.showLegend&&(x=(0,u.jsx)(as,{watch:y,initialSubProps:{},child:rs})),{init:()=>p,legend:x,update:C=>{if(!C.series?.length){d.clear();return}for(const S of C.series){o.dims=(0,Q.ue)(S,o,i),x&&y.next({styleConfig:o,size:o.dims?.size,layerName:e.name,layer:h}),d.update(S);let T=!1;const b=new Set,E=(A,Y)=>{const ae=`${A[0]},${A[1]}`,{color:te,size:Z,text:R,rotation:k}=Y;return`markerAddressKey|${ae}|${te}|${Z}|${R}|${k}`};d.forEachFeature(A=>{const Y=A.getGeometry(),ae=Y?.getType()==="LineString";ae&&(T=!0);const te=A.get("rowIndex"),Z=o.dims,R={...o.base};if(Z?.color&&(R.color=Z.color.get(te)),Z?.size&&(R.size=Z.size.get(te)),Z?.text&&(R.text=Z.text.get(te)),Z?.rotation&&(R.rotation=Z.rotation.get(te)),Y?.getType()==="Point"){const k=Y.getCoordinates();if(!k||k.length<2)return;const V=E(k,R);if(b.has(V))return;b.add(V)}if(!ae){const k=(0,Ie.A)(i.visualization.getColorByName(R.color)).toString(),V=mo(k),$=R.size??w._7,_e=We(R.symbolAlign??w.T5.symbolAlign,$);A.setProperties({red:V?.r??255}),A.setProperties({green:V?.g??255}),A.setProperties({blue:V?.b??255}),A.setProperties({size:(R.size??1)*2}),A.setProperties({rotation:(R.rotation??0)*Math.PI/180}),A.setProperties({opacity:(R.opacity??1)*(V?.a??1)}),A.setProperties({offsetX:_e[0]}),A.setProperties({offsetY:_e[1]})}if(l){const k=ps(R);A.setStyle(k)}if(ae){const k=o.maker(R);A.setStyle(k)}}),m=l||T;const _=p.getLayers();_.clear(),m&&r?_.extend([h,f]):m&&!r?_.extend([f]):_.extend([h]);break}},registerOptionsUI:C=>{C.addCustomEditor({id:"config.style",path:"config.style",name:(0,v.t)("geomap.markers-layer.name-styles","Styles"),editor:Ve,settings:{displayRotation:!0},defaultValue:Lt.style}).addBooleanSwitch({path:"config.showLegend",name:(0,v.t)("geomap.markers-layer.name-show-legend","Show legend"),description:(0,v.t)("geomap.markers-layer.description-show-legend","Show map legend"),defaultValue:Lt.showLegend})}}},defaultOptions:Lt};var Ke=g(11594),bi=g(13504),vo=g(40190),wo=g(97404),Co=g(14969),Re=g(40186);class So extends Co.A{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=(0,Re.K)(e)[0];this.forEach(s=>{s.tileCoord[0]!==i&&(this.remove((0,Re.i7)(s.tileCoord)),s.release())})}}const ws=So;var He=g(11078);const Ti={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var Qe=g(91110),Ei=g(57115),Ao=g(4350),Xe=g(6782);const gt=[0,0,0],Ye=5;class bo{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,(0,j.v)((0,Vt.WC)(this.resolutions_,function(s,o){return o-s},!0),17);let t;if(!e.origins){for(let s=0,o=this.resolutions_.length-1;s<o;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,(0,j.v)(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=(0,P.Py)(i)),(0,j.v)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,(0,j.v)(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Ei.R,(0,j.v)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(s,o){const r=new Qe.A(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,o);r.minX=Math.max(a.minX,r.minX),r.maxX=Math.min(a.maxX,r.maxX),r.minY=Math.max(a.minY,r.minY),r.maxY=Math.min(a.maxY,r.maxY)}return r},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const s=this.getTileRangeForExtentAndZ(e,t);for(let o=s.minX,r=s.maxX;o<=r;++o)for(let a=s.minY,l=s.maxY;a<=l;++a)i([t,o,a])}forEachTileCoordParentTileRange(e,t,i,s){let o,r,a,l=null,c=e[0]-1;for(this.zoomFactor_===2?(r=e[1],a=e[2]):l=this.getTileCoordExtent(e,s);c>=this.minZoom;){if(this.zoomFactor_===2?(r=Math.floor(r/2),a=Math.floor(a/2),o=(0,Qe.N)(r,r,a,a,i)):o=this.getTileRangeForExtentAndZ(l,c,i),t(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const o=e[1]*2,r=e[2]*2;return(0,Qe.N)(o,o+1,r,r+1,t)}const s=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],o=e[1],r=e[2];if(t===s)return(0,Qe.N)(o,r,o,r,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-s),c=Math.floor(o*l),d=Math.floor(r*l);if(t<s)return(0,Qe.N)(c,c,d,d,i);const h=Math.floor(l*(o+1))-1,f=Math.floor(l*(r+1))-1;return(0,Qe.N)(c,h,d,f,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,gt);const s=gt[1],o=gt[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,gt);const r=gt[1],a=gt[2];return(0,Qe.N)(s,r,o,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=(0,Xe.xq)(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*i,t[1]-(e[2]+.5)*s[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),o=(0,Xe.xq)(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*o[0]*s,a=i[1]-(e[2]+1)*o[1]*s,l=r+o[0]*s,c=a+o[1]*s;return(0,P.N)(r,a,l,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,s,o){const r=this.getZForResolution(i),a=i/this.getResolution(r),l=this.getOrigin(r),c=(0,Xe.xq)(this.getTileSize(r),this.tmpSize_);let d=a*(e-l[0])/i/c[0],h=a*(l[1]-t)/i/c[1];return s?(d=(0,re.mk)(d,Ye)-1,h=(0,re.mk)(h,Ye)-1):(d=(0,re.RI)(d,Ye),h=(0,re.RI)(h,Ye)),(0,Re.N)(r,d,h,o)}getTileCoordForXYAndZ_(e,t,i,s,o){const r=this.getOrigin(i),a=this.getResolution(i),l=(0,Xe.xq)(this.getTileSize(i),this.tmpSize_);let c=(e-r[0])/a/l[0],d=(r[1]-t)/a/l[1];return s?(c=(0,re.mk)(c,Ye)-1,d=(0,re.mk)(d,Ye)-1):(c=(0,re.RI)(c,Ye),d=(0,re.RI)(d,Ye)),(0,Re.N)(i,c,d,o)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=(0,Vt.FT)(this.resolutions_,e,t||0);return(0,re.qE)(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return(0,Ao.sj)(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=i}}const Cs=bo;function Ss(n){let e=n.getDefaultTileGrid();return e||(e=Mo(n),n.setDefaultTileGrid(e)),e}function To(n,e,t){const i=e[0],s=n.getTileCoordCenter(e),o=_i(t);if(!(0,P.Ym)(o,s)){const r=(0,P.RG)(o),a=Math.ceil((o[0]-s[0])/r);return s[0]+=r*a,n.getTileCoordForCoordAndZ(s,i)}return e}function Eo(n,e,t,i){i=i!==void 0?i:"top-left";const s=As(n,e,t);return new Cs({extent:n,origin:(0,P.qF)(n,i),resolutions:s,tileSize:t})}function _o(n){const e=n||{},t=e.extent||(0,M.Jt)("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:As(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Cs(i)}function As(n,e,t,i){e=e!==void 0?e:Ei.L,t=(0,Xe.xq)(t!==void 0?t:Ei.R);const s=(0,P.Oq)(n),o=(0,P.RG)(n);i=i>0?i:Math.max(o/t[0],s/t[1]);const r=e+1,a=new Array(r);for(let l=0;l<r;++l)a[l]=i/Math.pow(2,l);return a}function Mo(n,e,t,i){const s=_i(n);return Eo(s,e,t,i)}function _i(n){n=(0,M.Jt)(n);let e=n.getExtent();if(!e){const t=180*M.Ig.degrees/n.getMetersPerUnit();e=(0,P.N)(-t,-t,t,t)}return e}class Po extends Xi{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&(0,Xe.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new ws(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,s){const o=this.getTileCacheForProjection(e);if(!o)return!1;let r=!0,a,l,c;for(let d=i.minX;d<=i.maxX;++d)for(let h=i.minY;h<=i.maxY;++h)l=(0,Re.dp)(t,d,h),c=!1,o.containsKey(l)&&(a=o.get(l),c=a.getState()===He.A.LOADED,c&&(c=s(a)!==!1)),c||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,o){return(0,N.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Ss(e)}getTileCacheForProjection(e){const t=this.getProjection();return(0,j.v)(t===null||(0,M.tI)(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),r=(0,Xe.xq)(s.getTileSize(e),this.tmpSize);return o==1?r:(0,Xe.hs)(r,o,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=To(i,e,t)),(0,Re.N5)(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,s){}}class Fo extends Wt.Ay{constructor(e,t){super(e),this.tile=t}}const Io=Po;function Lo(n,e){const t=/\{z\}/g,i=/\{x\}/g,s=/\{y\}/g,o=/\{-y\}/g;return function(r,a,l){if(r)return n.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(s,r[2].toString()).replace(o,function(){const c=r[0],d=e.getFullTileRange(c);return(0,j.v)(d,55),(d.getHeight()-r[2]-1).toString()})}}function Do(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=Lo(n[s],e);return Ro(i)}function Ro(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const s=(0,Re.tW)(e),o=(0,re.xP)(s,n.length);return n[o](e,t,i)}}function da(n,e,t){}function jo(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let o;for(o=i;o<=s;++o)e.push(n.replace(t[0],String.fromCharCode(o)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=i;s++)e.push(n.replace(t[0],s.toString()));return e}return e.push(n),e}class Mi extends Io{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Mi.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=(0,N.v6)(t),s=t.getState();let o;s==He.A.LOADING?(this.tileLoadingKeys_[i]=!0,o=Ti.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],o=s==He.A.ERROR?Ti.TILELOADERROR:s==He.A.LOADED?Ti.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new Fo(o,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=jo(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Do(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const s=(0,Re.dp)(e,t,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const zo=Mi;class Oo extends zo{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ko,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:vo.A,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const s in this.tileCacheForProjection){const o=this.tileCacheForProjection[s];o.expireCache(o==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!(0,M.tI)(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!(0,M.tI)(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||(0,M.tI)(t,e)))return this.tileGrid;const i=(0,N.v6)(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ss(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||(0,M.tI)(t,e))return this.tileCache;const i=(0,N.v6)(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new ws(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,s,o,r){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,o),c=l?this.tileUrlFunction(l,s,o):void 0,d=new this.tileClass(a,c!==void 0?He.A.IDLE:He.A.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=r,d.addEventListener(Tt.A.CHANGE,this.handleTileChange.bind(this)),d}getTile(e,t,i,s,o){const r=this.getProjection();if(!r||!o||(0,M.tI)(r,o))return this.getTileInternal(e,t,i,s,r||o);const a=this.getTileCacheForProjection(o),l=[e,t,i];let c;const d=(0,Re.i7)(l);a.containsKey(d)&&(c=a.get(d));const h=this.getKey();if(c&&c.key==h)return c;const f=this.getTileGridForProjection(r),m=this.getTileGridForProjection(o),p=this.getTileCoordForTileUrlFunction(l,o),y=new wo.A(r,f,o,m,l,p,this.getTilePixelRatio(s),this.getGutter(),(x,C,S,T)=>this.getTileInternal(x,C,S,T,r),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return y.key=h,c?(y.interimTile=c,y.refreshInterimChain(),a.replace(d,y)):a.set(d,y),y}getTileInternal(e,t,i,s,o){let r=null;const a=(0,Re.dp)(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))r=this.createTile_(e,t,i,s,o,l),this.tileCache.set(a,r);else if(r=this.tileCache.get(a),r.key!=l){const c=r;r=this.createTile_(e,t,i,s,o,l),c.getState()==He.A.IDLE?r.interimTile=c.interimTile:r.interimTile=c,r.refreshInterimChain(),this.tileCache.replace(a,r)}return r}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=(0,M.Jt)(e);if(i){const s=(0,N.v6)(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function ko(n,e){n.getImage().src=e}const Go=Oo;class No extends Go{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:_o({extent:_i(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Pi=No;var Bo=(n=>(n.Auto="auto",n.Light="light",n.Dark="dark",n))(Bo||{});const si={theme:"auto",showLabels:!0},bs={id:"carto",name:"CARTO basemap",description:"Add layer CARTO Raster basemaps",isBaseMap:!0,defaultOptions:si,create:async(n,e,t,i)=>({init:()=>{const s={...si,...e.config};let o=s.theme;(!o||o==="auto")&&(o=i.isDark?"dark":"light"),s.showLabels?o+="_all":o+="_nolabels";const r=window.devicePixelRatio>1?"@2x":"";return new bi.A({source:new Pi({attributions:'<a href="https://carto.com/attribution/">\xA9CARTO</a> <a href="https://www.openstreetmap.org/copyright">\xA9OpenStreetMap</a> contributors',url:`https://{1-4}.basemaps.cartocdn.com/${o}/{z}/{x}/{y}${r}.png`})})},registerOptionsUI:s=>{s.addRadio({path:"config.theme",name:"Theme",settings:{options:[{value:"auto",label:"Auto",description:"Match grafana theme"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},defaultValue:si.theme}).addBooleanSwitch({path:"config.showLabels",name:"Show labels",description:"",defaultValue:si.showLabels})}})},Uo=[bs],Ts="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",mt={url:Ts+"/tile/{z}/{y}/{x}",attribution:`Tiles \xA9 <a href="${Ts}">ArcGIS</a>`},Es={id:"xyz",name:"XYZ Tile layer",description:"Add map from a generic tile layer",isBaseMap:!0,create:async(n,e,t,i)=>({init:()=>{const s={...e.config};return s.url||(s.url=mt.url,s.attribution=s.attribution??mt.attribution),new bi.A({source:new Pi({url:s.url,attributions:s.attribution}),minZoom:s.minZoom,maxZoom:s.maxZoom})},registerOptionsUI:s=>{s.addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:mt.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:mt.attribution}})}})},Wo=[Es],ni="custom",Fi="streets",_s=new ii.O(()=>[{id:Fi,name:"World Street Map",slug:"World_Street_Map"},{id:"world-imagery",name:"World Imagery",slug:"World_Imagery"},{id:"world-physical",name:"World Physical",slug:"World_Physical_Map"},{id:"topo",name:"Topographic",slug:"World_Topo_Map"},{id:"usa-topo",name:"USA Topographic",slug:"USA_Topo_Maps"},{id:"ocean",name:"World Ocean",slug:"Ocean/World_Ocean_Base"},{id:ni,name:"Custom MapServer",description:"Use a custom MapServer with pre-cached values",slug:""}]),Vo=[{id:"esri-xyz",name:"ArcGIS MapServer",description:"Add layer from an ESRI ArcGIS MapServer",isBaseMap:!0,create:async(n,e,t,i)=>{const s={...e.config},o=_s.getIfExists(s.server??Fi);if(o.id!==ni){const a="https://services.arcgisonline.com/ArcGIS/rest/services/";s.url=`${a}${o.slug}/MapServer/tile/{z}/{y}/{x}`,s.attribution=`Tiles \xA9 <a href="${a}${o.slug}/MapServer">ArcGIS</a>`}const r={...e,config:s};return Es.create(n,r,t,i).then(a=>(a.registerOptionsUI=l=>{l.addSelect({path:"config.server",name:"Server instance",settings:{options:_s.selectOptions().options}}).addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:mt.url},showIf:c=>c.config?.server===ni}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:mt.attribution},showIf:c=>c.config?.server===ni})},a))},defaultOptions:{server:Fi}}],Xo='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Yo extends Pi{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Xo];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}const Zo=Yo,Ii=[...[{id:"osm-standard",name:"Open Street Map",description:"Add map from a collaborative free geographic world database",isBaseMap:!0,create:async(n,e,t)=>({init:()=>new bi.A({source:new Zo})})}],...Uo,...Vo,...Wo];var je=class extends ye{constructor(e){e=e||{},e.strategy=Yi,super(e),this.setLoader(this._loader),this.set("time",e.time||new Date),this.set("step",e.step||1)}static _sunEclipticPosition(e){var t=Math.PI/180,i=e-2451545,s=280.46+.9856474*i;s%=360;var o=357.528+.9856003*i;o%=360;var r=s+1.915*Math.sin(o*t)+.02*Math.sin(2*o*t),a=1.00014-.01671*Math.cos(o*t)-.0014*Math.cos(2*o*t);return{lambda:r,R:a}}static _eclipticObliquity(e){var t=e-2451545,i=t/36525,s=23.43929111-i*(46.836769/3600-i*(1831e-7/3600+i*(.0020034/3600-i*(576e-9/3600-i*434e-10/3600))));return s}static _sunEquatorialPosition(e,t){var i=180/Math.PI,s=Math.PI/180,o=Math.atan(Math.cos(t*s)*Math.tan(e*s))*i,r=Math.asin(Math.sin(t*s)*Math.sin(e*s))*i,a=Math.floor(e/90)*90,l=Math.floor(o/90)*90;return o=o+(a-l),{alpha:o,delta:r}}static getNightLat(e,t){var i=180/Math.PI,s=Math.PI/180,o=t?new Date(t):new Date,r=o/864e5+24405875e-1,a=(18.697374558+24.06570982441908*(r-2451545))%24,l=je._sunEclipticPosition(r),c=je._eclipticObliquity(r),d=je._sunEquatorialPosition(l.lambda,c),h=a*15+e-d.alpha,f=Math.atan(-Math.cos(h*s)/Math.tan(d.delta*s))*i;return f}_loader(e,t,i){var s=this.getCoordinates(this.get("time")),o=new Le.Ay([s]);o.transform("EPSG:4326",i),this.addFeature(new K.A(o))}setTime(e){this.set("time",e),this.refresh()}getSunPosition(e){var t=e?new Date(e):new Date,i=t/864e5+24405875e-1,s=(18.697374558+24.06570982441908*(i-2451545))%24,o=je._sunEclipticPosition(i),r=je._eclipticObliquity(i),a=je._sunEquatorialPosition(o.lambda,r);return[a.alpha-s*15,a.delta]}getCoordinates(e,t){for(var i=180/Math.PI,s=Math.PI/180,o=e?new Date(e):new Date,r=o/864e5+24405875e-1,a=(18.697374558+24.06570982441908*(r-2451545))%24,l=[],c=je._sunEclipticPosition(r),d=je._eclipticObliquity(r),h=je._sunEquatorialPosition(c.lambda,d),f=this.get("step")||1,m=-180;m<=180;m+=f){var p=m,y=a*15+p-h.alpha,x=Math.atan(-Math.cos(y*s)/Math.tan(h.delta*s))*i;l.push([p,x])}switch(t){case"line":break;case"day":h.delta*=-1;default:{x=h.delta<0?90:-90;for(var C=180;C>=-180;C-=f)l.push([C,x]);l.push(l[0]);break}}if(t==="daynight"){var S=[];l.forEach(function(T){S.push(T.slice())}),S[0][1]=-S[0][1],S[S.length-1][1]=-S[0][1],S[S.length-1][1]=-S[0][1],l=[l,S]}return l}};const $o=je;var Ko=(n=>(n.From="from",n.To="to",n))(Ko||{});const Je={show:"to",sun:!1,nightColor:"#a7a6ba4D"},Ms="dayNight",ga={type:Ms,name:"",config:Je,tooltip:!0},Ho={id:Ms,name:"Night / Day",description:"Show day and night regions",isBaseMap:!1,create:async(n,e,t,i)=>{const s={...Je,...e?.config},o=new $o({}),r=Object.getPrototypeOf(o),a=new ee.A({source:o,style:new I.Ay({fill:new O.A({color:i.visualization.getColorByName(s.nightColor)})})}),l=new ee.A({source:new ye({features:[]}),style:new I.Ay({stroke:new z.A({color:"#607D8B",width:1.5,lineDash:[2,3]})})}),c=new K.A({geometry:new me.A([])}),d=new ee.A({source:new ye({features:[c]}),style:new I.Ay({image:new Ue.A({radius:13,fill:new O.A({color:"rgb(253,184,19)"})})})}),h=new K.A({geometry:new me.A([])}),f=new I.Ay({image:new Ue.A({radius:13,stroke:new z.A({color:"rgb(253,184,19)",width:1.5})})}),m=new I.Ay({image:new Ue.A({radius:15,stroke:new z.A({color:"#607D8B",width:1.5,lineDash:[2,3]})})}),p=new ee.A({source:new ye({features:[h]}),style:[m,f]}),y=new ht.A({layers:s.sun?[a,d,p,l]:[a,l]}),x=new B.yU;return{init:()=>y,dispose:()=>x.unsubscribe(),update:C=>{const S=new Date(C.timeRange.from.valueOf()),T=new Date(C.timeRange.to.valueOf());let b=new Date,E=[];s.show==="from"?b=S:b=T,o.setTime(b),s.sun&&(E=r.getSunPosition(b),c.getGeometry()?.setCoordinates((0,M.Rb)(E)))},registerOptionsUI:C=>{e.config?.nightColor||(e.config={...Je,...e.config}),C.addRadio({path:"config.show",name:"Show",settings:{options:[{label:"From",value:"from"},{label:"To",value:"to"}]},defaultValue:Je.show}),C.addColorPicker({path:"config.nightColor",name:"Night region color",description:"Pick color of night region",defaultValue:Je.nightColor,settings:[{enableNamedColors:!1}]}),C.addBooleanSwitch({path:"config.sun",name:"Display sun",description:"Show the sun",defaultValue:Je.sun})}}},defaultOptions:Je};var Ps=g(11854),Fs=g(11365),Is=g(57532),Ls=g(81160),Ds=g(32503),Qo=g(53685);const Rs=(n,e)=>{const t=e.get(n.property);return(0,Qo.c)(t,n.operation,n.value)};function js(n){const e=new Set,t=new Set;n.some((s,o)=>{for(const r in s.getProperties()){if(r==="geometry")continue;t.add(r);const a=s.getGeometry();a&&e.add(a.getType())}return o>10});let i=w.W_.Any;if(e.size===1)switch(e.values().next().value){case"Point":case"MultiPoint":i=w.W_.Point;break;case"Line":case"MultiLine":i=w.W_.Line;break;case"Polygon":i=w.W_.Polygon}return{geometryType:i,propertes:Array.from(t.keys()).map(s=>({label:s,value:s}))}}function Jo(n,e){const t=new Set;for(const s of n){const o=s.get(e);o!=null&&t.add(`${o}`)}const i=Array.from(t);return i.sort(),i}const Dt={src:"public/maps/countries.geojson",rules:[],style:w.T5,dataStyle:{}},ma={style:w.T5,check:{property:"",operation:X.zT.EQ,value:""}},qo={id:"dynamic-geojson",name:"Dynamic GeoJSON",description:"Style a geojson file based on query results",isBaseMap:!1,state:Ke.pn.alpha,create:async(n,e,t,i)=>{const s={...Dt,...e.config},o=new ye({url:s.src,format:new Fs.A}),r=new qt.m,a=o.on("change",()=>{o.getState()==="ready"&&((0,Ps.e)(a),r.next(o.getFeatures()))}),l=[];if(s.rules){for(const m of s.rules)if(m.style){const p=await ke(m.style);l.push({state:p,rule:m.check})}}const c=await ke(s.style);l.push({state:c});const d=await ke(s.style),h=new Map,f=new ee.A({source:o,style:m=>{const p=h.get(m.getId()),y=d.dims;if(p&&y)return new I.Ay({fill:new O.A({color:y.color?.get(p)}),stroke:new z.A({color:d.base.color,width:d.base.lineWidth??1})});const x=m.getGeometry()?.getType()==="Point";for(const C of l)if(!(C.rule&&!Rs(C.rule,m))){if(C.state.fields){const S={...C.state.base},{text:T}=C.state.fields;return T&&(S.text=`${m.get(T)}`),x?C.state.maker(S):It(S)}return x?(C.point||(C.point=C.state.maker(C.state.base)),C.point):(C.poly||(C.poly=It(C.state.base)),C.poly)}}});return{init:()=>f,update:m=>{const p=m.series[0];if(p){const y=(0,Ds.UI)(p,s.idField);y&&(h.clear(),y.values.forEach((x,C)=>h.set(x,C))),d.dims=(0,Q.ue)(p,d,i,s.dataStyle)}f.changed()},registerOptionsUI:m=>{const p=r.pipe((0,Is.$)(),(0,Ls.T)(y=>js(y)));m.addSelect({path:"config.src",name:"GeoJSON URL",settings:{options:(0,Q.G_)()??[],allowCustomValue:!0},defaultValue:Dt.src}).addFieldNamePicker({path:"config.idField",name:"ID Field"}).addCustomEditor({id:"config.dataStyle",path:"config.dataStyle",name:"Data style",editor:Ve,settings:{displayRotation:!1},defaultValue:Dt.dataStyle}).addCustomEditor({id:"config.style",path:"config.style",name:"Default style",description:"The style to apply when no rules above match",editor:Ve,settings:{simpleFixedValues:!0,layerInfo:p},defaultValue:Dt.style})}}},defaultOptions:Dt};var er=g(2863),zs=g(18105),Rt=g(19753);function Os(n,e){if(n&&!e){const i={label:`${n}`,value:n};return{options:[i],current:i}}e||(e=[]);let t=e.find(i=>i.value===n);return n&&!t&&(t={label:`${n} (not found)`,value:n},e.push(t)),{options:e,current:t}}const tr=({value:n,onChange:e,item:t,context:i})=>{const s=t.settings;if(!s)throw Error("Settings not found");const{features:o,layerInfo:r}=s,a=(0,ei.A)(r),l=(0,ei.A)(o),c=(0,L.useMemo)(()=>{const E=n?.check?.property;return E&&l&&n.check?.operation===X.zT.EQ?Jo(l,E).map(_=>{let A;return!isNaN(Number(_))?A={value:Number(_),label:_}:A={value:_,label:_},A}):[]},[l,n]),d=(0,q.of)(ir),h=10,f=(0,L.useCallback)(E=>{e({...n,check:{...n.check,property:E?.value}})},[e,n]),m=(0,L.useCallback)(E=>{e({...n,check:{...n.check,operation:E.value??X.zT.EQ}})},[e,n]),p=(0,L.useCallback)(E=>{e({...n,check:{...n.check,value:E?.value}})},[e,n]),y=(0,L.useCallback)(E=>{e({...n,check:{...n.check,value:E}})},[e,n]),x=(0,L.useCallback)(E=>{e({...n,style:E})},[e,n]),C=(0,L.useCallback)(()=>{e(void 0)},[e]),S=n.check??ks.check,T=Os(S.property,a?.propertes),b=Os(S.value,c);return(0,u.jsxs)("div",{className:d.rule,children:[(0,u.jsxs)(Te.C,{className:d.row,children:[(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.style-rule-editor.label-rule","Rule"),labelWidth:h,grow:!0,children:(0,u.jsx)(ot.l6,{placeholder:(0,v.t)("geomap.style-rule-editor.placeholder-feature-property","Feature property"),value:T.current,options:T.options,onChange:f,"aria-label":(0,v.t)("geomap.style-rule-editor.aria-label-feature-property","Feature property"),isClearable:!0,allowCustomValue:!0})}),(0,u.jsx)(ve.I,{className:d.inline,children:(0,u.jsx)(ot.l6,{value:zs.N.find(E=>E.value===S.operation),options:zs.N,onChange:m,"aria-label":(0,v.t)("geomap.style-rule-editor.aria-label-comparison-operator","Comparison operator"),width:8})}),(0,u.jsx)(ve.I,{className:d.inline,grow:!0,children:(0,u.jsxs)("div",{className:d.flexRow,children:[(S.operation===X.zT.EQ||S.operation===X.zT.NEQ)&&(0,u.jsx)(ot.l6,{placeholder:(0,v.t)("geomap.style-rule-editor.placeholder-value","value"),value:b.current,options:b.options,onChange:p,"aria-label":(0,v.t)("geomap.style-rule-editor.aria-label-comparison-value","Comparison value"),isClearable:!0,allowCustomValue:!0}),S.operation!==X.zT.EQ&&(0,u.jsx)(Rt.Q,{value:isNaN(Number(S.value))?0:Number(S.value),placeholder:(0,v.t)("geomap.style-rule-editor.placeholder-numeric-value","Numeric value"),onChange:y},`${S.property}/${S.operation}`)]})}),(0,u.jsx)(Bt.$n,{size:"md",icon:"trash-alt",onClick:()=>C(),variant:"secondary","aria-label":(0,v.t)("geomap.style-rule-editor.aria-label-delete-style-rule","Delete style rule"),className:d.button})]}),(0,u.jsx)("div",{children:(0,u.jsx)(Ve,{value:n.style??w.T5,context:i,onChange:x,item:{settings:{simpleFixedValues:!0,layerInfo:r}}})})]})},ir=n=>({rule:(0,F.css)({marginBottom:n.spacing(1)}),row:(0,F.css)({display:"flex",marginBottom:"4px"}),inline:(0,F.css)({marginBottom:0,marginLeft:"4px"}),button:(0,F.css)({marginLeft:"4px"}),flexRow:(0,F.css)({display:"flex",flexDirection:"row",alignItems:"flex-start"})}),sr=({value:n,onChange:e,context:t,item:i})=>{const s=(0,q.$j)(),o=i.settings,r=(0,L.useCallback)(()=>{const{palette:c}=s.visualization,d={fixed:c[Math.floor(Math.random()*c.length)]},h=[...n,{...ks,style:{...w.T5,color:d}}];e(h)},[e,n,s.visualization]),a=(0,L.useCallback)(c=>d=>{const h=[...n];d?h[c]=d:h.splice(c,1),e(h)},[e,n]),l=n&&n.map((c,d)=>{const h={settings:o};return(0,u.jsx)(tr,{value:c,onChange:a(d),context:t,item:h},`${d}-${c.check?.property}`)});return(0,u.jsxs)(u.Fragment,{children:[l,(0,u.jsx)(Bt.$n,{size:"sm",icon:"plus",onClick:r,variant:"secondary","aria-label":(0,v.t)("geomap.geomap-style-rules-editor.aria-label-add-geomap-style-rule","Add geomap style rule"),children:"Add style rule"})]})},oi={src:"public/maps/countries.geojson",rules:[],style:w.T5},ks={style:w.T5,check:{property:"",operation:X.zT.EQ,value:""}},nr={id:"geojson",name:"GeoJSON",description:"Load static data from a geojson file",isBaseMap:!1,create:async(n,e,t,i)=>{const s={...oi,...e.config},o=(0,er.w)().replace(s.src||""),r=new ye({url:o,format:new Fs.A}),a=new qt.m,l=r.on("change",()=>{r.getState()==="ready"&&((0,Ps.e)(l),a.next(r.getFeatures()))}),c=[];if(s.rules){for(const y of s.rules)if(y.style){const x=await ke(y.style);c.push({state:x,rule:y.check})}}const d=await ke(s.style);c.push({state:d});const h=Object.values(w.Sq),f=Object.values(w.yQ),m=Object.values(w.yu),p=new ee.A({source:r,style:y=>{const x=y.getGeometry()?.getType(),C=x==="Point"||x==="MultiPoint",S=x==="Polygon"||x==="MultiPolygon",T=x==="LineString"||x==="MultiLineString";for(const b of c){if(b.rule&&!Rs(b.rule,y))continue;if(b.state.fields){const _={...b.state.base},{text:A}=b.state.fields;return A&&(_.text=`${y.get(A)}`),C?b.state.maker(_):It(_)}const E=y.getProperties();if(S&&Object.keys(E).some(_=>h.includes(_))){const _={color:E[w.Sq.color]??b.state.base.color,opacity:E[w.Sq.opacity]??b.state.base.opacity,lineWidth:E[w.Sq.lineWidth]??b.state.base.lineWidth};return It(_)}else if(T&&Object.keys(E).some(_=>m.includes(_))){const _={color:E[w.yu.color]??b.state.base.color,lineWidth:E[w.yu.lineWidth]??b.state.base.lineWidth};return b.state.maker(_)}else if(C&&Object.keys(E).some(_=>f.includes(_))){const _={color:E[w.yQ.color]??b.state.base.color,size:E[w.yQ.size]??b.state.base.size};return b.state.maker(_)}return C?(b.point||(b.point=b.state.maker(b.state.base)),b.point):(b.poly||(b.poly=It(b.state.base)),b.poly)}}});return{init:()=>p,registerOptionsUI:y=>{const x=a.pipe((0,Is.$)(),(0,Ls.T)(C=>js(C)));y.addSelect({path:"config.src",name:"GeoJSON URL",settings:{options:(0,Q.G_)()??[],allowCustomValue:!0,supportVariables:!0},defaultValue:oi.src}).addCustomEditor({id:"config.style",path:"config.style",name:"Default style",description:"The style to apply when no rules above match",editor:Ve,settings:{simpleFixedValues:!0,layerInfo:x},defaultValue:oi.style}).addCustomEditor({id:"config.rules",path:"config.rules",name:"Style rules",description:"Apply styles based on feature properties",editor:sr,settings:{features:a,layerInfo:x},defaultValue:[]})}}},defaultOptions:oi};var or=g(26469),rr=g(89990),ar=g(68711);const Ee={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},lr=["#00f","#0ff","#0f0","#ff0","#f00"];class cr extends or.A{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(Ee.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:lr),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";typeof i=="string"?this.weightFunction_=function(s){return s.get(i)}:this.weightFunction_=i,this.setRenderOrder(null)}getBlur(){return this.get(Ee.BLUR)}getGradient(){return this.get(Ee.GRADIENT)}getRadius(){return this.get(Ee.RADIUS)}handleGradientChanged_(){this.gradient_=dr(this.getGradient())}setBlur(e){this.set(Ee.BLUR,e)}setGradient(e){this.set(Ee.GRADIENT,e)}setRadius(e){this.set(Ee.RADIUS,e)}createRenderer(){return new rr.A(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const t=this.weightFunction_(e);return t!==void 0?(0,re.qE)(t,0,1):1}}],vertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_weight = a_weight;
        }`,fragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          gl_FragColor = vec4(alpha, alpha, alpha, alpha);
        }`,hitVertexShader:`
        precision mediump float;
        uniform mat4 u_projectionMatrix;
        uniform mat4 u_offsetScaleMatrix;
        uniform float u_size;
        attribute vec2 a_position;
        attribute float a_index;
        attribute float a_weight;
        attribute vec4 a_hitColor;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          mat4 offsetMatrix = u_offsetScaleMatrix;
          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;
          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;
          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);
          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;
          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;
          v_texCoord = vec2(u, v);
          v_hitColor = a_hitColor;
          v_weight = a_weight;
        }`,hitFragmentShader:`
        precision mediump float;
        uniform float u_blurSlope;

        varying vec2 v_texCoord;
        varying float v_weight;
        varying vec4 v_hitColor;

        void main(void) {
          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);
          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;
          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;
          float alpha = smoothstep(0.0, 1.0, value) * v_weight;
          if (alpha < 0.05) {
            discard;
          }

          gl_FragColor = v_hitColor;
        }`,uniforms:{u_size:()=>(this.get(Ee.RADIUS)+this.get(Ee.BLUR))*2,u_blurSlope:()=>this.get(Ee.RADIUS)/Math.max(1,this.get(Ee.BLUR))},postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function dr(n){const i=(0,ar.Y)(1,256),s=i.createLinearGradient(0,0,1,256),o=1/(n.length-1);for(let r=0,a=n.length;r<a;++r)s.addColorStop(r*o,n[r]);return i.fillStyle=s,i.fillRect(0,0,1,256),i.canvas}const hr=cr;var ur=g(10392);const ri={weight:{fixed:1,min:0,max:1},blur:15,radius:5},fr={id:"heatmap",name:"Heatmap",description:"Visualizes a heatmap of the data",isBaseMap:!1,showLocation:!0,create:async(n,e,t,i)=>{const s={...ri,...e.config},o=await(0,be.nE)(e.location),r=new Ft(o),a="_weight",l=new hr({source:r,blur:s.blur,radius:s.radius,weight:c=>c.get(a)});return{init:()=>l,update:c=>{const d=c.series[0];if(!d)return;r.update(d);const h=(0,ur.hX)(d,s.weight);r.forEachFeature(p=>{const y=p.get("rowIndex");y!=null&&p.set(a,h.get(y))});let f=["#00f","#0ff","#0f0","#ff0","#f00"];const m=h.field??d.fields.find(p=>p.type===bt.PU.number);if(m){const p=(0,os.Qi)(m);p.isContinuous&&p.getColors&&(f=p.getColors(i))}l.setGradient(f)},registerOptionsUI:c=>{c.addCustomEditor({id:"config.weight",path:"config.weight",name:"Weight values",description:"Scale the distribution for each row",editor:hs.g,settings:{min:0,max:1,hideRange:!0},defaultValue:{fixed:1,min:0,max:1}}).addSliderInput({path:"config.radius",description:"Configures the size of clusters",name:"Radius",defaultValue:ri.radius,settings:{min:1,max:50,step:1}}).addSliderInput({path:"config.blur",description:"Configures the amount of blur of clusters",name:"Blur",defaultValue:ri.blur,settings:{min:1,max:50,step:1}})}}},defaultOptions:ri},Gs={icon:"https://openlayers.org/en/latest/examples/data/icon.png"},gr={id:"last-point-tracker",name:"Icon at last point",description:"Show an icon at the last point",isBaseMap:!1,showLocation:!0,state:Ke.pn.alpha,create:async(n,e,t,i)=>{const s=new K.A({}),o={...Gs,...e.config};s.setStyle(new I.Ay({image:new us.A({src:o.icon})}));const r=new ye({features:[s]}),a=new Ne.A({source:r}),l=await(0,be.nE)(e.location);return{init:()=>a,update:c=>{const d=c.series[0];if(d&&d.length){const h=(0,be.FM)(d,l);if(!h.field)return;s.setGeometry(h.field.values[d.length-1])}}}},defaultOptions:Gs};var pt=g(89352),Se=function(n,e){var t=n[0]-e[0],i=n[1]-e[1];return Math.sqrt(t*t+i*i)},Li=function(n,e){return n[0]==e[0]&&n[1]==e[1]},pa=function(n){return mr(n.getGeometry())},mr=function(n){switch(n.getType()){case"Point":return n.getCoordinates();case"MultiPolygon":n=n.getPolygon(0);case"Polygon":return n.getInteriorPoint().getCoordinates();default:return n.getClosestPoint(ol_extent_getCenter(n.getExtent()))}},ya=function(n,e){var t=[],i=n.length-1,s=i,o,r,a,l,c,d,h,f,m,p,y,x,C,S=Li(n[0],n[i]);S||(y=n[0],x=n[1],C=[y[0]+(x[1]-y[1])/Se(y,x)*e,y[1]-(x[0]-y[0])/Se(y,x)*e],t.push(C),n.push(n[i]),i++,s--);for(var T=0;T<s;T++)y=n[T],x=n[(T+1)%i],C=n[(T+2)%i],o=(x[1]-y[1])/(x[0]-y[0]),r=(C[1]-x[1])/(C[0]-x[0]),Math.abs(o-r)>1e-10&&(a=Math.sqrt((x[0]-y[0])*(x[0]-y[0])+(x[1]-y[1])*(x[1]-y[1])),l=Math.sqrt((C[0]-x[0])*(C[0]-x[0])+(C[1]-x[1])*(C[1]-x[1])),c=y[0]+e*(x[1]-y[1])/a,d=x[0]+e*(C[1]-x[1])/l,h=y[1]-e*(x[0]-y[0])/a,f=x[1]-e*(C[0]-x[0])/l,m=(r*d-o*c+h-f)/(r-o),p=(o*r*(d-c)+r*h-o*f)/(r-o),x[0]-y[0]==0&&(m=x[0]+e*(x[1]-y[1])/Math.abs(x[1]-y[1]),p=r*m-r*d+f),C[0]-x[0]==0&&(m=C[0]+e*(C[1]-x[1])/Math.abs(C[1]-x[1]),p=o*m-o*c+h),t.push([m,p]));return S?t.push(t[0]):(n.pop(),y=n[n.length-1],x=n[n.length-2],C=[y[0]-(x[1]-y[1])/Se(y,x)*e,y[1]+(x[0]-y[0])/Se(y,x)*e],t.push(C)),t},xa=function(n,e){for(var t=0;t<e.length-1;t++){var i=e[t],s=e[t+1];if(Li(n,i)||Li(n,s))return{index:1,segment:[i,s]};var o=Se(i,s),r=[(s[0]-i[0])/o,(s[1]-i[1])/o],a=Se(i,n),l=[(n[0]-i[0])/a,(n[1]-i[1])/a];if(Math.abs(r[0]*l[1]-r[1]*l[0])<1e-10)return{index:1,segment:[i,s]}}return{index:-1}},va=function(n,e,t){for(var i,s,o=[],r=0;r<n.length-1;r++)!n[r].length||!n[r+1].length||(n[r][1]<=e&&n[r+1][1]>e||n[r][1]>=e&&n[r+1][1]<e)&&(s=(e-n[r][1])/(n[r+1][1]-n[r][1]),i=s*(n[r+1][0]-n[r][0])+n[r][0],o.push({contour:t,index:r,pt:[i,e],abs:s}));o.sort(function(c,d){return c.pt[0]-d.pt[0]});for(var a=[],l=0;l<o.length-1;l+=2)a.push([o[l],o[l+1]]);return a},wa=function(n,e){switch(n){case"LineString":return new ol_geom_LineString(e);case"LinearRing":return new ol_geom_LinearRing(e);case"MultiLineString":return new ol_geom_MultiLineString(e);case"MultiPoint":return new ol_geom_MultiPoint(e);case"MultiPolygon":return new ol_geom_MultiPolygon(e);case"Point":return new ol_geom_Point(e);case"Polygon":return new ol_geom_Polygon(e);default:return console.error("[createFromType] Unsupported type: "+n),null}},Ca=function(n,e){var t=n[1][0]-n[0][0],i=n[1][1]-n[0][1],s=e[1][0]-e[0][0],o=e[1][1]-e[0][1],r=t*o-i*s;if(r!=0){var a=(t*n[0][1]-t*e[0][1]-i*n[0][0]+i*e[0][0])/r;return[e[0][0]+a*s,e[0][1]+a*o]}else return!1},Ns;(function(){function n(t,i){var s;for(let o=t.length-1;o>0;o--)(t[o][0]>i&&t[o-1][0]<i||t[o][0]<i&&t[o-1][0]>i)&&(s=[i,(i-t[o][0])/(t[o-1][0]-t[o][0])*(t[o-1][1]-t[o][1])+t[o][1]],t.splice(o,0,s))}function e(t,i){var s;for(let o=t.length-1;o>0;o--)(t[o][1]>i&&t[o-1][1]<i||t[o][1]<i&&t[o-1][1]>i)&&(s=[(i-t[o][1])/(t[o-1][1]-t[o][1])*(t[o-1][0]-t[o][0])+t[o][0],i],t.splice(o,0,s))}Ns=function(t,i){var s=i.getType()==="Polygon";if(!s&&i.getType()!=="MultiPolygon")return null;var o=i.getCoordinates();return s&&(o=[o]),o.forEach(function(r){r.forEach(function(a){n(a,t[0]),n(a,t[2]),e(a,t[1]),e(a,t[3])})}),o.forEach(function(r){r.forEach(function(a){a.forEach(function(l){l[0]<t[0]?l[0]=t[0]:l[0]>t[2]&&(l[0]=t[2]),l[1]<t[1]?l[1]=t[1]:l[1]>t[3]&&(l[1]=t[3])})})}),s?new Le.Ay(o[0]):new at.A(o)}})();var ai=function(n,e,t,i){var s=[];i!==!1&&s.push(n);var o=Se(n,e);if(o){var r=Math.round(o/t);if(r>1)for(var a=(e[0]-n[0])/r,l=(e[1]-n[1])/r,c=1;c<r;c++)s.push([n[0]+a*c,n[1]+l*c])}return s.push(e),s};oe.A.prototype.sampleAt=function(n){for(var e=this.getCoordinates(),t=[],i=1;i<e.length;i++)t=t.concat(ai(e[i-1],e[i],n,i===1));return new oe.A(t)},Zt.A.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],o=1;o<i.length;o++)s=s.concat(ai(i[o-1],i[o],n,o===1));t.push(s)}),new Zt.A(t)},Le.Ay.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var s=[],o=1;o<i.length;o++)s=s.concat(ai(i[o-1],i[o],n,o===1));t.push(s)}),new Le.Ay(t)},at.A.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){var s=[];t.push(s),i.forEach(function(o){for(var r=[],a=1;a<o.length;a++)r=r.concat(ai(o[a-1],o[a],n,a===1));s.push(r)})}),new at.A(t)},qi.prototype.intersection=function(n,e){if(n.sampleAt){var t=(0,P.r)(this.getCenter().concat(this.getCenter()),this.getRadius());n=Ns(t,n),n=n.simplify(e);var i=this.getCenter(),s=this.getRadius(),o=n.sampleAt(e).getCoordinates();switch(n.getType()){case"Polygon":o=[o];case"MultiPolygon":{var r=!1,a=[];return o.forEach(function(l){var c=[];a.push(c),l.forEach(function(d){var h=[];c.push(h),d.forEach(function(f){var m=Se(i,f);m>s?(r=!0,h.push([i[0]+s/m*(f[0]-i[0]),i[1]+s/m*(f[1]-i[1])])):h.push(f)})})}),r?n.getType()==="Polygon"?new Le.Ay(a[0]):new at.A(a):n}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+n.getType());return n};var pr=class extends I.Ay{constructor(e){e=e||{},super({stroke:e.stroke,text:e.text,zIndex:e.zIndex,geometry:e.geometry}),this.setRenderer(this._render.bind(this)),this._visible=e.visible!==!1,typeof e.width=="function"?this._widthFn=e.width:this.setWidth(e.width),this.setWidth2(e.width2),typeof e.color=="function"?this._colorFn=e.color:this.setColor(e.color),this.setColor2(e.color2),this.setLineCap(e.lineCap),this.setArrow(e.arrow),this.setArrowSize(e.arrowSize),this.setArrowColor(e.arrowColor),this._offset=[0,0],this.setOffset(e.offset0,0),this.setOffset(e.offset1,1),this._noOverlap=e.noOverlap}setWidth(e){this._width=e||0}setWidth2(e){this._width2=e}getOffset(e){return this._offset[e]}setOffset(e,t){switch(e=Math.max(0,parseFloat(e)),t){case 0:{this._offset[0]=e;break}case 1:{this._offset[1]=e;break}}}setLineCap(e){this._lineCap=e==="round"?"round":"butt"}getWidth(e,t){if(this._widthFn)return this._widthFn(e,t);var i=typeof this._width2=="number"?this._width2:this._width;return this._width+(i-this._width)*t}setColor(e){try{this._color=(0,pt._j)(e)}catch{this._color=[0,0,0,1]}}setColor2(e){try{this._color2=(0,pt._j)(e)}catch{this._color2=null}}setArrowColor(e){try{this._acolor=(0,pt.oJ)(e)}catch{this._acolor=null}}getColor(e,t){if(this._colorFn)return(0,pt.oJ)(this._colorFn(e,t));var i=this._color,s=this._color2||this._color;return"rgba("+ +Math.round(i[0]+(s[0]-i[0])*t)+","+Math.round(i[1]+(s[1]-i[1])*t)+","+Math.round(i[2]+(s[2]-i[2])*t)+","+(i[3]+(s[3]-i[3])*t)+")"}getArrow(){return this._arrow}setArrow(e){this._arrow=parseInt(e),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(e){Array.isArray(e)?this._arrowSize=e:typeof e=="number"&&(this._arrowSize=[e,e])}drawArrow(e,t,i,s,o){var r=this.getArrowSize()[0]*o,a=Se(t,i),l=(t[0]-i[0])/a,c=(t[1]-i[1])/a;s=Math.max(this.getArrowSize()[1]/2,s/2)*o,e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[0]-r*l+s*c,t[1]-r*c-s*l),e.lineTo(t[0]-r*l-s*c,t[1]-r*c+s*l),e.lineTo(t[0],t[1]),e.fill()}_render(e,t){if(t.geometry.getType()==="LineString"){var i,s,o,r=t.context;if(!this._visible){var a=t.pixelRatio/t.resolution,l=Math.cos(t.rotation),c=Math.sin(t.rotation);s=t.geometry.getCoordinates();var d=e[0][0]-s[0][0]*a*l-s[0][1]*a*c,h=e[0][1]-s[0][0]*a*c+s[0][1]*a*l;for(e=[],i=0;o=s[i];i++)e[i]=[d+o[0]*a*l+o[1]*a*c,h+o[0]*a*c-o[1]*a*l,o[2]]}var f=this.getArrowSize()[0]*t.pixelRatio;r.save(),this.getOffset(0)&&this._splitAsize(e,this.getOffset(0)*t.pixelRatio),this.getOffset(1)&&this._splitAsize(e,this.getOffset(1)*t.pixelRatio,!0),e.length>1&&(this.getArrow()===-1||this.getArrow()===2)&&(o=this._splitAsize(e,f),this._acolor?r.fillStyle=this._acolor:r.fillStyle=this.getColor(t.feature,0),this.drawArrow(r,o[0],o[1],this.getWidth(t.feature,0),t.pixelRatio)),e.length>1&&this.getArrow()>0&&(o=this._splitAsize(e,f,!0),this._acolor?r.fillStyle=this._acolor:r.fillStyle=this.getColor(t.feature,1),this.drawArrow(r,o[0],o[1],this.getWidth(t.feature,1),t.pixelRatio));var m=this._splitInto(e,255,2),p=0,y=m.length;if(r.lineJoin="round",r.lineCap=this._lineCap||"butt",m.length>1)for(p=0;p<m.length;p++){var x=p/y;for(s=m[p],r.lineWidth=this.getWidth(t.feature,x)*t.pixelRatio,r.strokeStyle=this.getColor(t.feature,x),r.beginPath(),r.moveTo(s[0][0],s[0][1]),i=1;o=s[i];i++)r.lineTo(o[0],o[1]);r.stroke()}r.restore()}}_splitAsize(e,t,i){var s,o,r,a,l=0;for(i?r=e.pop():r=e.shift(),s=r;e.length;){if(i?o=e.pop():o=e.shift(),a=Se(s,o),l+a>t){s=[s[0]+(o[0]-s[0])*(t-l)/a,s[1]+(o[1]-s[1])*(t-l)/a],a=Se(s,r),i?(e.push(o),e.push(s),e.push([s[0]+(r[0]-s[0])/a,s[1]+(r[1]-s[1])/a])):(e.unshift(o),e.unshift(s),e.unshift([s[0]+(r[0]-s[0])/a,s[1]+(r[1]-s[1])/a]));break}l+=a,s=o}return[r,s]}_splitInto(e,t,i){var s,o,r=this._noOverlap?1:.9,a=[],l,c=0;for(s=1;o=e[s];s++)c+=Se(e[s-1],o);var d=Math.max(i||2,c/(t||255)),h=e[0];c=0;var f=[h];for(s=1,o=e[1];s<e.length;){var m=o[0]-h[0],p=o[1]-h[1];if(l=Math.sqrt(m*m+p*p),c+l>d){var y=(d-c)/l;f.push([h[0]+m*y,h[1]+p*y]),a.push(f),h=[h[0]+m*y*r,h[1]+p*y*r],f=[h],c=0}else c+=l,h=o,f.push(h),s++,o=e[s]}return a.push(f),a}};const Bs=pr;var Us=g(34072);const qe={style:w.T5,showLegend:!1,edgeStyle:w.T5,arrow:0},Ws="network",Sa={type:Ws,name:"",config:qe,location:{mode:X.aG.Auto}},yr={id:Ws,name:"Network",description:"Render a node graph as a map layer",isBaseMap:!1,showLocation:!0,hideOpacity:!0,state:Ke.pn.beta,create:async(n,e,t,i)=>{const s={...qe,...e?.config},o=await ke(s.style),r=await ke(s.edgeStyle),a=await(0,be.nE)(e.location),l=new Ft(a),c=new ee.A({source:l}),d=s.arrow===1||s.arrow===-1||s.arrow===2,h=new qt.m(1);let f=null;return s.showLegend&&(f=(0,u.jsx)(as,{watch:h,initialSubProps:{},child:rs})),c.setStyle(m=>{const p=m.getGeometry(),y=m.get("rowIndex"),x=o.dims;if(!o.fields&&!r.fields&&!d&&p?.getType()!=="LineString")return o.maker(o.base);if(p?.getType()==="LineString"&&p instanceof Mt.Ay){const S=r.dims,T=r.config.textConfig,b=Number(m.getId()),E=p.getCoordinates(),_=r.config.opacity??1;if(E&&S){const A=E[0],Y=E[1],ae=(0,Ie.A)(i.visualization.getColorByName((S.color&&S.color.get(b))??r.base.color)).setAlpha(_).toString(),te=(0,Ie.A)(i.visualization.getColorByName((S.color&&S.color.get(b))??r.base.color)).setAlpha(_).toString(),Z=(S.size&&S.size.get(b))??r.base.size,R=(S.size&&S.size.get(b))??r.base.size,k=[],V=new Bs({visible:!0,lineCap:s.arrow===0?"round":"square",color:ae,color2:te,width:(S.size&&S.size.get(b))??r.base.size,width2:(S.size&&S.size.get(b))??r.base.size});s.arrow&&(V.setArrow(s.arrow),s.arrow>0?(V.setArrowColor(te),V.setArrowSize((R??0)*2)):(V.setArrowColor(ae),V.setArrowSize((Z??0)*2)));const $=new oe.A([A,Y]);V.setGeometry($);const _e=i.typography.fontFamily;if(S.text||r.config.text?.mode===X.RU.Fixed){const et=new I.Ay({zIndex:10,text:new dt.A({text:S.text?.get(b)??r.config.text?.fixed,font:`normal ${T?.fontSize}px ${_e}`,fill:new O.A({color:ae??w.T5.color.fixed}),stroke:new z.A({color:(0,Ie.A)(i.visualization.getColorByName("text")).setAlpha(_).toString(),width:Math.max(T?.fontSize/10,1)}),...T})});et.setGeometry($),k.push(et)}return k.push(V),k}}if(!x||!(0,se.isNumber)(y))return o.maker(o.base);const C={...o.base};return x.color&&(C.color=x.color.get(y)),x.size&&(C.size=x.size.get(y)),x.text&&(C.text=x.text.get(y)),x.rotation&&(C.rotation=x.rotation.get(y)),o.maker(C)}),{init:()=>c,legend:f,update:m=>{if(!m.series?.length){l.clear();return}f&&h.next({styleConfig:o,size:o.dims?.size,layerName:e.name,layer:c});const p=(0,Us.CP)(m.series);for(const y of m.series)y===p.edges[0]?r.dims=(0,Q.ue)(y,r,i):o.dims=(0,Q.ue)(y,o,i),xr(l,p)},registerOptionsUI:(m,p)=>{const y=(0,Us.CP)(p.data),x=y.nodes[0],C=y.edges[0];m.addCustomEditor({id:"config.style",category:["Node Styles"],path:"config.style",name:"Node Styles",editor:Ve,settings:{displayRotation:!0,frameMatcher:S=>S===x},defaultValue:qe.style}).addCustomEditor({id:"config.edgeStyle",category:["Edge Styles"],path:"config.edgeStyle",name:"Edge Styles",editor:Ve,settings:{hideSymbol:!0,frameMatcher:S=>S===C},defaultValue:qe.style}).addRadio({path:"config.arrow",name:"Arrow",settings:{options:[{label:"None",value:0},{label:"Forward",value:1},{label:"Reverse",value:-1},{label:"Both",value:2}]},defaultValue:qe.arrow}).addBooleanSwitch({path:"config.showLegend",name:"Show legend",description:"Show map legend",defaultValue:qe.showLegend})}}},defaultOptions:qe};function xr(n,e){n.clear(!0);const t=e.nodes[0],i=e.edges[0];if(!t||!i)return;const s=(0,be.FM)(t,n.location);if(!s.field){n.changed();return}const o=s.field,r=t.fields.findIndex(f=>f.name==="id"),a=t.fields[r].values,l=i.fields.findIndex(f=>f.name==="source"),c=i.fields.findIndex(f=>f.name==="target"),d=i.fields[l].values,h=i.fields[c].values;for(let f=0;f<d.length;f++){const m=d[f],p=h[f],y=a.findIndex(T=>T===m),x=a.findIndex(T=>T===p);if(!o.values[y]||!o.values[x])continue;const C=new oe.A([o.values[y].getCoordinates(),o.values[x].getCoordinates()]),S=new K.A({geometry:C});S.setId(f),n.addFeatureInternal(S)}for(let f=0;f<t.length;f++)n.addFeatureInternal(new K.A({frameNodes:t,rowIndex:f,geometry:s.field.values[f]}));n.changed()}var Vs=class extends xe.A{constructor(e){e=e||{},e.displacement||(e.displacement=[e.offsetX||0,-e.offsetY||0]);var t=e.kind==="anchored"?8:0,i=Number(e.shadow)||0;e.stroke||(e.stroke=new z.A({width:0,color:"#000"}));var s=e.stroke.getWidth();if(s<0&&(s=0),e.kind=="folio"&&(s+=6),e.stroke.setWidth(s),super({radius:e.radius+s+t/2+i/2,points:0,displacement:[e.displacement[0]||0,(e.displacement[1]||0)+t],fill:xe.A.prototype.render?new O.A({color:[0,0,0,0]}):null,declutterMode:e.declutterMode}),this.sanchor_=t,this._shadow=i,!this.getHitDetectionImage){var o=super.getImage.call(this);if(!this.hitDetectionCanvas_){for(var r in this)if(this[r]&&this[r].getContext&&this[r]!==o){this.hitDetectionCanvas_=this[r];break}}this.hitDetectionCanvas_=document.createElement("canvas"),this.hitDetectionCanvas_.width=o.width,this.hitDetectionCanvas_.height=o.height;var a=this.hitDetectionCanvas_;this.getHitDetectionImage=function(){return a}}this._stroke=e.stroke,this._fill=e.fill,this._crop=e.crop,this._crossOrigin=e.crossOrigin,this._kind=e.kind||"default",this._radius=e.radius,this._src=e.src,this._offset=[e.offsetX?e.offsetX:0,e.offsetY?e.offsetY:0],this._onload=e.onload,this._onerror=e.onerror,typeof e.opacity=="number"&&this.setOpacity(e.opacity),typeof e.rotation=="number"&&this.setRotation(e.rotation),this.render(),this.getImage()}setOffset(e){this._offset=[e[0]||0,e[1]||0],this.render(),this.getImage()}clone(){var e=new Vs({stroke:this._stroke,fill:this._fill,shadow:this._shadow,crop:this._crop,crossOrigin:this._crossOrigin,kind:this._kind,radius:this._radius,src:this._src,offsetX:this._offset[0],offsetY:this._offset[1],opacity:this.getOpacity(),rotation:this.getRotation(),declutterMode:this.getDeclutterMode?this.getDeclutterMode():null});return e.render(),e.getImage(),e}drawBack_(e,t,i,s){var o=this._shadow,r=e.canvas;e.beginPath(),e.fillStyle=t,e.clearRect(0,0,r.width,r.height);var a=r.width/s,l=r.height/s;switch(this._kind){case"square":{e.rect(0,0,a-o,l-o);break}case"circle":{e.arc(this._radius+i,this._radius+i,this._radius+i,0,2*Math.PI,!1);break}case"folio":{var c=6;i-=c,e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=1;var d=a-o-2*c,h=Math.atan(6/d);e.save(),e.rotate(-h),e.translate(-6,2),e.beginPath(),e.rect(c,c,d,d),e.stroke(),e.fill(),e.restore(),e.save(),e.translate(6,-1),e.rotate(h),e.beginPath(),e.rect(c,c,d,d),e.stroke(),e.fill(),e.restore(),e.beginPath(),e.rect(c,c,d,d),e.stroke();break}case"anchored":{e.roundRect(this.sanchor_/2,0,a-this.sanchor_-o,l-this.sanchor_-o,i),e.moveTo(a/2-this.sanchor_-o/2,l-this.sanchor_-o),e.lineTo(a/2+this.sanchor_-o/2,l-this.sanchor_-o),e.lineTo(a/2-o/2,l-o);break}default:{e.roundRect(0,0,a-o,l-o,i);break}}e.closePath()}createRenderOptions(){var e=super.createRenderOptions();return e.photoOptions=["photo",this._crossOrigin,this._crop,this._src,this._shadow,this._kind].join("-"),e}getImage(e){e=e||window.devicePixelRatio;var t=super.getImage(e);if((this._gethit||this.img_)&&this._currentRatio===e)return t;this._currentRatio=e;var i,s=0;this._stroke&&(i=(0,pt.oJ)(this._stroke.getColor()),s=this._stroke.getWidth()),this._gethit=!0;var o=this.getHitDetectionImage().getContext("2d");o.save(),o.setTransform(1,0,0,1,0,0),this.drawBack_(o,"#000",s,1),o.fill(),o.restore(),this._gethit=!1,o=t.getContext("2d"),o.save(),o.setTransform(e,0,0,e,0,0),this.drawBack_(o,i,s,e),this._shadow&&(o.shadowColor="rgba(0,0,0,0.5)",o.shadowBlur=e*this._shadow/2,o.shadowOffsetX=e*this._shadow/2,o.shadowOffsetY=e*this._shadow/2),o.fill(),o.restore();var r=this,a=this.img_=new Image;if(this._crossOrigin&&(a.crossOrigin=this._crossOrigin),a.src=this._src,a.width?r.drawImage_(t,a,e):(a.onload=function(){r.drawImage_(t,a,e),r._onload&&r._onload()},r._onerror&&(a.onerror=function(){r._onerror()})),!this.getDisplacement){var l=this.getAnchor();l[0]=(t.width/e-this._shadow)/2-this._offset[0],this.sanchor_?l[1]=t.height/e-this._shadow-this._offset[1]:l[1]=(t.height/e-this._shadow)/2-this._offset[1]}return t}getPhoto(){return this.img_}drawImage_(e,t,i){var s=e.getContext("2d"),o=0;this._stroke&&(o=this._stroke.getWidth());var r=2*this._radius;s.save(),xe.A.prototype.render&&s.setTransform(i,0,0,i,0,0),this._kind=="circle"&&(s.beginPath(),s.arc(this._radius+o,this._radius+o,this._radius,0,2*Math.PI,!1),s.clip());var a,l,c,d,h,f,m,p,y;this._crop?(a=Math.min(t.width/r,t.height/r),p=y=a*r,f=(t.width-p)/2,m=(t.height-y)/2,l=c=0,d=h=r+1):(a=Math.min(r/t.width,r/t.height),f=m=0,p=t.width,y=t.height,d=a*p,h=a*y,l=(r-d)/2,c=(r-h)/2),l+=o+this.sanchor_/2,c+=o,s.drawImage(t,f,m,p,y,l,c,d,h),this._kind=="circle"&&o&&(s.beginPath(),s.strokeStyle=(0,pt.oJ)(this._stroke.getColor()),s.lineWidth=o/4,s.arc(this._radius+o,this._radius+o,this._radius,0,2*Math.PI,!1),s.stroke()),s.restore()}};CanvasRenderingContext2D.prototype.roundRect=function(n,e,t,i,s){return s?(t<2*s&&(s=t/2),i<2*s&&(s=i/2),this.beginPath(),this.moveTo(n+s,e),this.arcTo(n+t,e,n+t,e+i,s),this.arcTo(n+t,e+i,n,e+i,s),this.arcTo(n,e+i,n,e,s),this.arcTo(n,e,n+t,e,s),this.closePath()):this.rect(n,e,t,i),this};const Di=Vs,Ge={kind:"square",border:2,shadow:!0,crop:!0,radius:20,color:"rgb(200, 200, 200)"},Xs="photos",Aa={type:Xs,name:"",config:Ge,location:{mode:X.aG.Auto},tooltip:!0},Ri="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBjbGFzcz0iY3NzLWV5eDRkbyI+PHBhdGggZD0iTTExLjI5LDE1LjI5YTEuNTgsMS41OCwwLDAsMC0uMTIuMTUuNzYuNzYsMCwwLDAtLjA5LjE4LjY0LjY0LDAsMCwwLS4wNi4xOCwxLjM2LDEuMzYsMCwwLDAsMCwuMi44NC44NCwwLDAsMCwuMDguMzguOS45LDAsMCwwLC41NC41NC45NC45NCwwLDAsMCwuNzYsMCwuOS45LDAsMCwwLC41NC0uNTRBMSwxLDAsMCwwLDEzLDE2YTEsMSwwLDAsMC0uMjktLjcxQTEsMSwwLDAsMCwxMS4yOSwxNS4yOVpNMTIsMkExMCwxMCwwLDEsMCwyMiwxMiwxMCwxMCwwLDAsMCwxMiwyWm0wLDE4YTgsOCwwLDEsMSw4LThBOCw4LDAsMCwxLDEyLDIwWk0xMiw3QTMsMywwLDAsMCw5LjQsOC41YTEsMSwwLDEsMCwxLjczLDFBMSwxLDAsMCwxLDEyLDlhMSwxLDAsMCwxLDAsMiwxLDEsMCwwLDAtMSwxdjFhMSwxLDAsMCwwLDIsMHYtLjE4QTMsMywwLDAsMCwxMiw3WiI+PC9wYXRoPjwvc3ZnPgo=",vr="data:image/svg+xml;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==";let jt=[];const wr={id:Xs,name:"Photos",description:"Render photos at each data point",isBaseMap:!1,showLocation:!0,hideOpacity:!0,state:Ke.pn.beta,create:async(n,e,t,i)=>{const s={...Ge,...e?.config},o=await(0,be.nE)(e.location),r=new Ft(o),a=new ee.A({source:r});let l=[];return a.setStyle(c=>{let d=Ri,h=1/0;l.length>0&&(h=c.get("rowIndex"),d=l[h]??Ri);const f=new I.Ay({image:new Di({src:d,radius:s.radius,crop:s.crop,kind:s.kind,shadow:0,stroke:new z.A({width:0,color:"rgba(0,0,0,0)"}),onload:()=>{a.changed(),jt&&!jt.includes(h)&&jt.push(h)}})}),m=new I.Ay({image:new Di({src:vr,radius:s.radius,crop:!1,kind:s.kind,shadow:s.shadow?2:0,stroke:new z.A({width:s.border??0,color:i.visualization.getColorByName(s.color)}),onload:()=>{a.changed()}})}),p=new I.Ay({image:new Di({src:Ri,radius:s.radius,crop:!1,kind:s.kind,shadow:0,stroke:new z.A({width:0,color:"rgba(0,0,0,0)"}),onload:()=>{a.changed()}})});return jt&&jt.includes(h)?[m,f]:[m,p,f]}),{init:()=>a,update:c=>{if(!c.series?.length){r.clear();return}for(const d of c.series){if(r.update(d),s.src){const h=(0,Ds.UI)(d,s.src);h&&(l=h?.values)}else for(let h=0;h<d.fields.length;h++){const f=d.fields[h];if(f.type===bt.PU.string){l=f.values;break}}break}},registerOptionsUI:c=>{c.addFieldNamePicker({path:"config.src",name:"Image Source field",settings:{filter:d=>d.type===bt.PU.string,noFieldsMessage:(0,v.t)("geomap.photos-layer.noFieldsMessage-no-string-fields","No string fields found")}}).addRadio({path:"config.kind",name:"Kind",settings:{options:[{label:"Square",value:"square"},{label:"Circle",value:"circle"},{label:"Anchored",value:"anchored"},{label:"Folio",value:"folio"}]},defaultValue:Ge.kind}).addBooleanSwitch({path:"config.crop",name:"Crop",settings:{},defaultValue:Ge.crop}).addBooleanSwitch({path:"config.shadow",name:"Shadow",settings:{},defaultValue:Ge.shadow}).addSliderInput({path:"config.border",name:"Border",settings:{min:0,max:10},defaultValue:Ge.border}).addColorPicker({path:"config.color",name:"Border color",defaultValue:Ge.color,settings:[{enableNamedColors:!1}]}).addSliderInput({path:"config.radius",name:"Radius",settings:{min:1,max:100},defaultValue:Ge.radius})}}},defaultOptions:Ge};var Cr=g(99165),Ys=g(6773);const zt={style:{...w.T5,opacity:1,lineWidth:2},arrow:0},Zs="route",ba={type:Zs,name:"",config:zt,location:{mode:X.aG.Auto},tooltip:!1};var Sr=(n=>(n[n.x1=0]="x1",n[n.y1=1]="y1",n[n.x2=2]="x2",n[n.y2=3]="y2",n))(Sr||{});const ji="#607D8B",Ar={id:Zs,name:"Route",description:"Render data points as a route",isBaseMap:!1,showLocation:!0,state:Ke.pn.beta,create:async(n,e,t,i)=>{const s={...zt,...e?.config},o=await ke(s.style),r=await(0,be.nE)(e.location),a=new Ft(r),l=new ee.A({source:a}),c=s.arrow===1||s.arrow===-1;if(!o.fields&&!c){const E=vi(o.base);o.config.size&&o.config.size.fixed&&E.getStroke().setWidth(o.config.size.fixed),l.setStyle(E)}else l.setStyle(E=>{const _=E.get("rowIndex"),A=o.dims;if(!A||!(0,se.isNumber)(_))return vi(o.base);const Y=[],ae=E.getGeometry(),te=o.config.opacity??1;if(ae instanceof Mt.Ay){const R=ae.getCoordinates();if(R){let k=0;const V=2;for(let $=0;$<R.length-1;$++){const _e=R[k],et=R[$+1],Gt=(0,Ie.A)(i.visualization.getColorByName((A.color&&A.color.get(k))??o.base.color)).setAlpha(te).toString(),an=(0,Ie.A)(i.visualization.getColorByName((A.color&&A.color.get($+1))??o.base.color)).setAlpha(te).toString(),ta=(A.size&&A.size.get(k))??o.base.size,ia=(A.size&&A.size.get($+1))??o.base.size,tt=new Bs({visible:!0,lineCap:s.arrow===0?"round":"square",color:Gt,color2:an,width:(A.size&&A.size.get(k))??o.base.size,width2:(A.size&&A.size.get($+1))??o.base.size});if(s.arrow&&(tt.setArrow(s.arrow),s.arrow>0?(tt.setArrowColor(an),tt.setArrowSize((ia??0)*1.5)):(tt.setArrowColor(Gt),tt.setArrowSize((ta??0)*1.5))),(0,Q.o3)(n,V,_e,et)){const sa=new oe.A([_e,et]);tt.setGeometry(sa),Y.push(tt),k=$+1}}if(Y.length===0){const $=new me.A(R[0]),_e=((A.size&&A.size.get(0))??o.base.size??10)/2,et=(0,Ie.A)(i.visualization.getColorByName((A.color&&A.color.get(0))??o.base.color)).setAlpha(te).toString(),Gt=new I.Ay({image:new Ue.A({radius:_e,fill:new O.A({color:et})})});Gt.setGeometry($),Y.push(Gt)}}return Y}const Z={...o.base};return A.color&&(Z.color=A.color.get(_)),vi(Z)});const d=new K.A({}),h=new K.A({}),f=new K.A({}),m=[h,f],p=(o.base.lineWidth||6)+3,y=new I.Ay({image:new Ue.A({radius:p,stroke:new z.A({color:Ys.MV.alpha(ji,1),width:1}),fill:new O.A({color:Ys.MV.alpha(ji,.4)})})}),x=new I.Ay({stroke:new z.A({color:ji,width:1,lineDash:[3,3],lineCap:"square"})}),C=new ee.A({source:new ye({features:[d]}),style:y}),S=new ee.A({source:new ye({features:m}),style:x}),T=new ht.A({layers:[l,C,S]}),b=new B.yU;return b.add(t.getStream(he.b_).pipe((0,Cr.c)(8)).subscribe({next:E=>{const _=n.getView().calculateExtent(n.getSize()),Y=a.getFeatures()[0]?.get("frame"),ae=E.payload?.point?.time;if(Y&&ae){const te=Y.fields.find(Z=>Z.type===bt.PU.time);if(te){const Z=te.values,R=br(Z,ae);if(R!==null){const k=(0,be.FM)(Y,r);if(k.field){const V=k.field.values[R],$=V.getCoordinates();d.setGeometry(V),d.setStyle(y),h.setGeometry(new oe.A([[_[0],$[1]],[_[2],$[1]]])),f.setGeometry(new oe.A([[$[0],_[1]],[$[0],_[3]]])),m.forEach(_e=>_e.setStyle(x))}}}}}})),b.add(t.subscribe(he.ql,E=>{d.setStyle(new I.Ay({})),m.forEach(_=>_.setStyle(new I.Ay({})))})),{init:()=>T,dispose:()=>b.unsubscribe(),update:E=>{if(E.series?.length)for(const _ of E.series){(o.fields||c)&&(o.dims=(0,Q.ue)(_,o,i)),a.updateLineString(_);break}},registerOptionsUI:E=>{E.addCustomEditor({id:"config.style",path:"config.style",name:"Style",editor:Ve,settings:{simpleFixedValues:!1},defaultValue:zt.style}).addRadio({path:"config.arrow",name:"Arrow",settings:{options:[{label:"None",value:0},{label:"Forward",value:1},{label:"Reverse",value:-1}]},defaultValue:zt.arrow})}}},defaultOptions:zt};function br(n,e){if(n.length===0)return null;if(n.length===1)return 0;const t=n.length-1;if(e<n[0])return 0;if(e>n[t])return t;const i=Math.abs(Math.round(t*(e-n[0])/(n[t]-n[0])));if(e<n[i]){for(let s=i;s>0;s--)if(e>n[s])return s<t?s+1:t;return 0}else{for(let s=i;s<t;s++)if(e<n[s])return s>0?s-1:0;return t}}const $s=[xo,fr,gr,nr,qo,Ho,Ar,wr,yr],yt={type:"default",name:"",config:{}},Ks={id:yt.type,name:"Default base layer",isBaseMap:!0,create:(n,e,t,i)=>{const s=$e.$W?.geomapDefaultBaseLayerConfig?.type;if(s){const o=Ot.getIfExists(s);if(!o)throw new Error("Invalid basemap configuration on server");return o.create(n,$e.$W.geomapDefaultBaseLayerConfig,t,i)}return bs.create(n,e,t,i)}},Ot=new ii.O(()=>[Ks,...Ii,...$s]);function Hs(n,e){const t={options:[],current:[]},i=[];for(const s of n){const o={label:s.name,value:s.id,description:s.description};switch(s.state){case Ke.pn.alpha:if(!$e.yn)break;o.label=`${s.name} (Alpha)`,o.icon="bolt",i.push(o);break;case Ke.pn.beta:o.label=`${s.name} (Beta)`;default:t.options.push(o)}s.id===e&&t.current.push(o)}for(const s of i)t.options.push(s);return t}function Qs(n,e){return Hs(n?[Ks,...Ii]:[...$s,...Ii],e)}const Ta={layers:[]},Js={allLayers:!0,id:"zero",lat:0,lon:0,zoom:1};var xt=(n=>(n.Details="details",n.None="none",n))(xt||{}),Tr=(n=>(n.Coords="coords",n.Fit="fit",n.Zero="zero",n))(Tr||{}),Er=g(13752),qs=g(36638);const zi=(n,e,t)=>{if(n.update){let i=t;if(e.filterData){const s=(0,qs.Dq)(e.filterData);i={...i,series:i.series.filter(s)}}n.update(i)}};async function _r(n,e,t){if(!n.map)return!1;const i=n.byName.get(e);if(!i)return!1;let s=-1;const o=n.map?.getLayers();for(let a=0;a<o?.getLength();a++)if(o.item(a)===i.layer){s=a;break}if(t.name!==e){if(!t.name)t.name=e;else if(n.byName.has(t.name))return!1;n.byName.delete(e),e=t.name,n.byName.set(e,i)}i.options.type,t.type;const r=n.layers.slice(0);try{const a=await li(n,n.map,t,i.isBasemap);r[s]?.handler.dispose?.(),r[s]=a,o.setAt(s,a.layer),zi(a.handler,t,n.props.data)}catch(a){return console.warn("ERROR",a),!1}return n.setState({legends:[]}),n.layers=r,n.doOptionsUpdate(s),!0}async function li(n,e,t,i){i&&(!t?.type||Me.$.geomapDisableCustomBaseLayer)&&(t=yt),t?.type||(t={type:Si,name:(0,Q.q)(n),config:{}});const s=Ot.getIfExists(t.type);if(!s)return Promise.reject("unknown layer: "+t.type);t.config?.attribution&&(t.config.attribution=fs.sQ.sanitizeTextPanelContent(t.config.attribution));const o=await s.create(e,t,n.props.eventBus,Me.$.theme2),r=o.init();t.opacity!=null&&r.setOpacity(t.opacity),t.name||(t.name=(0,Q.q)(n));const a=t.name,l={isBasemap:i,options:t,layer:r,handler:o,mouseEvents:new Er.B,getName:()=>a,onChange:c=>{_r(n,a,c)}};return n.byName.set(a,l),l.layer.__state=l,r instanceof ht.A&&r.getLayers().getArray().forEach(c=>{c instanceof Pt.A&&(c.__state=l)}),zi(o,t,n.props.data),l}const en=n=>n?.__state,Mr=n=>({selectLayer:t=>{const i=n.layers.findIndex(s=>s.options.name===t);n.panelContext&&n.panelContext.onInstanceStateChange&&n.panelContext.onInstanceStateChange({map:n.map,layers:n.layers,selected:i,actions:n.actions})},canRename:t=>!n.byName.has(t),deleteLayer:t=>{const i=[];for(const s of n.layers)s.options.name===t?n.map?.removeLayer(s.layer):i.push(s);n.layers=i,n.doOptionsUpdate(0)},addlayer:t=>{const i=Ot.getIfExists(t);i&&li(n,n.map,{type:i.id,name:(0,Q.q)(n),config:(0,se.cloneDeep)(i.defaultOptions),location:i.showLocation?{mode:X.aG.Auto}:void 0,tooltip:!0,...!i.hideOpacity&&{opacity:w.T5.opacity}},!1).then(s=>{n.layers=n.layers.slice(0),n.layers.push(s),n.map?.addLayer(s.layer),n.doOptionsUpdate(n.layers.length-1)})},reorder:(t,i)=>{const s=Array.from(n.layers),[o]=s.splice(t,1);s.splice(i,0,o),n.layers=s,n.doOptionsUpdate(i);const r=n.map?.getLayers();r.clear(),n.layers.forEach(a=>r.push(a.layer))}});function Pr(n=[],e=!1,t=!1,i){return n.filter(s=>s.layer instanceof Ne.A||s.layer instanceof ht.A||s.layer instanceof ee.A).flatMap(s=>{const o=s.options.name,r=s.layer;if(r instanceof ht.A)return!e&&o!==i?[]:Fr(r,t);if(r instanceof Ne.A||r instanceof ee.A){if(e)return[r.getSource().getExtent()];if(t&&i===o){const a=r.getSource().getFeatures(),c=a[a.length-1]?.getGeometry();return c?[c.getExtent()]:[]}else if(!t&&i===o)return[r.getSource().getExtent()];return[]}else return[]}).reduce(P.X$,(0,P.S5)())}function Fr(n,e){return n.getLayers().getArray().filter(t=>t instanceof Ne.A||t instanceof ee.A||t instanceof Pt.A).map(t=>{if(t instanceof Ne.A||t instanceof ee.A||t instanceof Pt.A){if(e){const i=t.getSource().getFeatures(),o=i[i.length-1]?.getGeometry();if(o){const r=o.flatCoordinates,a=r.length;if(a>1){const l=r[a-2],c=r[a-1];return[l,c,l,c]}}return[]}return t.getSource().getExtent()??[]}else return[]})}const Ir=n=>{n.map?.on("singleclick",n.pointerClickListener),n.map?.on("pointermove",(0,se.debounce)(n.pointerMoveListener,200)),n.map?.getViewport().addEventListener("mouseout",e=>{n.props.eventBus.publish(new he.ql)})},Lr=(n,e)=>{tn(n,e)&&(n.preventDefault(),n.stopPropagation(),e.mapDiv.style.cursor="auto",e.setState({ttipOpen:!0}))},tn=(n,e)=>{if(e.state.measureMenuActive)return!0;if(!e.map||e.state.ttipOpen&&e.state?.ttip?.layers?.length)return!1;const t=n.originalEvent,i=e.map.getEventPixel(t),s=(0,M.WP)(e.map.getCoordinateFromPixel(i)),{hoverPayload:o}=e;o.pageX=t.pageX,o.pageY=t.pageY-window.scrollY,o.point={lat:s[1],lon:s[0]},o.data=void 0,o.columnIndex=void 0,o.rowIndex=void 0,o.layers=void 0;const r=[],a=new Map;let l={};e.map.forEachFeatureAtPixel(i,(d,h,f)=>{const m=en(h);if(!o.data){const p=d.getProperties(),y=p.frame;y&&(o.data=l.data=y,o.rowIndex=l.rowIndex=p.rowIndex),m?.mouseEvents&&m.mouseEvents.next(d)}if(m){let p=a.get(m);if(p||(p={layer:m,features:[]},a.set(m,p),r.push(p)),p.features.some(y=>y===d)||p.features.push(d),h instanceof Pt.A){const y=d.getGeometry();if(y instanceof me.A){const x=y.getCoordinates(),C=h.getSource();let S=!1;C.forEachFeature(T=>{if(T!==d&&!p.features.some(b=>b===T)){const b=T.getGeometry();if(b instanceof me.A){const E=b.getCoordinates();E[0]===x[0]&&E[1]===x[1]&&(p.features.push(T),S=!0)}}}),S&&p.features.sort((T,b)=>{const E=T.getProperties().rowIndex!==void 0?Number(T.getProperties().rowIndex):Number.MAX_SAFE_INTEGER,_=b.getProperties().rowIndex!==void 0?Number(b.getProperties().rowIndex):Number.MAX_SAFE_INTEGER;return E-_})}}}},{layerFilter:d=>en(d)?.options?.tooltip!==!1}),e.hoverPayload.layers=r.length?r:void 0,e.props.eventBus.publish(e.hoverEvent),(e.state.ttip===void 0||e.state.ttip?.layers!==o.layers||o.layers)&&e.setState({ttip:{...o}}),r.length||e.layers.forEach(d=>{d.mouseEvents.next(void 0)});const c=!!r.length;return e.mapDiv.style.cursor=c?"pointer":"auto",c};var Ae=(n=>(n.Zero="zero",n.Coordinates="coords",n.Fit="fit",n))(Ae||{});const kt=new ii.O(()=>[{id:"fit",name:"Fit to data",zoom:15},{id:"zero",name:"(0\xB0, 0\xB0)",lat:0,lon:0},{id:"coords",name:"Coordinates"},{id:"north-america",name:"North America",lat:40,lon:-100,zoom:4},{id:"south-america",name:"South America",lat:-20,lon:-60,zoom:3},{id:"europe",name:"Europe",lat:46,lon:14,zoom:4},{id:"africa",name:"Africa",lat:0,lon:30,zoom:3},{id:"west-asia",name:"West Asia",lat:26,lon:53,zoom:4},{id:"s-asia",name:"South Asia",lat:19.5,lon:80,zoom:4},{id:"se-asia",name:"South-East Asia",lat:10,lon:106,zoom:4},{id:"e-asia",name:"East Asia",lat:33,lon:120,zoom:4},{id:"australia",name:"Australia",lat:-25,lon:135,zoom:4},{id:"oceania",name:"Oceania",lat:-10,lon:-140,zoom:3}]);let Oi;class Dr extends L.Component{constructor(e){super(e),this.panelContext=void 0,this.subs=new B.yU,this.globalCSS=Jn(Me.$.theme2),this.hoverPayload={point:{},pageX:-1,pageY:-1},this.hoverEvent=new he.b_(this.hoverPayload),this.layers=[],this.byName=new Map,this.actions=Mr(this),this.initMapRef=async t=>{if(!t)return;this.mapDiv=t,this.map&&this.map.dispose();const{options:i}=this.props,s=(0,Q.rd)(this,i,t);this.byName.clear();const o=[];try{o.push(await li(this,s,i.basemap??yt,!0)),i.layers||(i.layers=[Ai]);for(const r of i.layers)o.push(await li(this,s,r,!1))}catch(r){console.error("error loading layers",r)}for(const r of o)s.addLayer(r.layer);this.layers=o,this.map=s,this.initViewExtent(s.getView(),i.view),this.mouseWheelZoom=new ze.A,this.map?.addInteraction(this.mouseWheelZoom),(0,Q.Lc)(this,i),Ir(this),(0,Q.Bz)(this,o,o.length-1),this.setState({legends:this.getLegends()})},this.clearTooltip=()=>{this.state.ttip&&!this.state.ttipOpen&&this.tooltipPopupClosed()},this.tooltipPopupClosed=()=>{this.setState({ttipOpen:!1,ttip:void 0})},this.pointerClickListener=t=>{Lr(t,this)},this.pointerMoveListener=t=>{tn(t,this)},this.initMapView=t=>{let i=new Ct.Ay({center:[0,0],zoom:1,showFullExtent:!0});return t.shared&&(Oi?i=Oi:Oi=i),this.initViewExtent(i,t),i},this.state={ttipOpen:!1,legends:[]},this.subs.add(this.props.eventBus.subscribe(D.i0,t=>{this.mapDiv&&this.props.id===t.payload&&this.initMapRef(this.mapDiv)})),this.subs.add(Fe.l.subscribe(ge.og,()=>{this.mapDiv&&this.layers.some(i=>{const s=i.options.config;return!s||typeof s!="object"?!1:(0,Q.cA)(s)})&&this.initMapRef(this.mapDiv)}))}static{this.contextType=Pe.e4}componentDidMount(){this.panelContext=this.context}componentWillUnmount(){this.subs.unsubscribe();for(const e of this.layers)e.handler.dispose?.();this.map?.dispose()}shouldComponentUpdate(e){return this.map&&((this.props.height!==e.height||this.props.width!==e.width)&&this.map.updateSize(),this.props.data!==e.data&&this.dataChanged(e.data),this.props.options!==e.options&&this.optionsChanged(e.options)),!0}componentDidUpdate(e){this.map&&(this.props.height!==e.height||this.props.width!==e.width)&&this.map.updateSize(),this.map&&this.props.data!==e.data&&this.dataChanged(this.props.data)}doOptionsUpdate(e){const{options:t,onOptionsChange:i}=this.props,s=this.layers;this.map?.getLayers().forEach(o=>{o instanceof ss&&(this.map?.removeLayer(o),this.map?.addLayer(o))}),i({...t,basemap:s[0].options,layers:s.slice(1).map(o=>o.options)}),(0,Q.Bz)(this,s,e),this.setState({legends:this.getLegends()})}optionsChanged(e){const t=this.props.options;if(e.view!==t.view){const i=this.initMapView(e.view);this.map&&i&&this.map.setView(i)}e.controls!==t.controls&&this.initControls(e.controls??{showZoom:!0,showAttribution:!0})}dataChanged(e){if(e===this.props.data)for(const i of this.layers)zi(i.handler,i.options,this.props.data);const t=kt.getIfExists(this.props.options.view.id);if(t&&t.id===Ae.Fit){const i=this.initMapView(this.props.options.view);this.map&&i&&this.map.setView(i)}this.setState({legends:this.getLegends()})}initViewExtent(e,t){const i=kt.getIfExists(t.id);if(i){let s;if(i.lat==null){if(i.id===Ae.Coordinates)s=[t.lon??0,t.lat??0];else if(i.id===Ae.Fit){const o=Pr(this.layers,t.allLayers,t.lastOnly,t.layer);if(!(0,P.Im)(o)){const r=t.padding??5,a=e.getResolutionForExtent(o,this.map?.getSize()),l=t.zoom??t.maxZoom;e.fit(o,{maxZoom:l}),e.setResolution(a*(r/100+1));const c=e.getZoom();c&&l&&c>l&&e.setZoom(l)}}}else s=[i.lon??0,i.lat??0];s&&e.setCenter((0,M.Rb)(s))}t.maxZoom&&e.setMaxZoom(t.maxZoom),t.minZoom&&e.setMaxZoom(t.minZoom),t.zoom&&i?.id!==Ae.Fit&&e.setZoom(t.zoom)}initControls(e){if(!this.map)return;this.map.getControls().clear(),e.showZoom&&this.map.addControl(new fe.A),e.showScale&&this.map.addControl(new J({units:e.scaleUnits,minWidth:100})),this.mouseWheelZoom.setActive(!!e.mouseWheelZoom),e.showAttribution&&this.map.addControl(new St.A({collapsed:!0,collapsible:!0}));let t=[];e.showMeasure&&(t=[(0,u.jsx)(Hn,{map:this.map,menuActiveState:s=>{this.setState({ttipOpen:s,measureMenuActive:s})}},"measure")]);let i=[];e.showDebug&&(i=[(0,u.jsx)(Tn,{map:this.map},"debug")]),this.setState({topRight1:t,topRight2:i})}getLegends(){const e=[];for(const t of this.layers)t.handler.legend&&(0,Q.sN)(t.layer)&&e.push((0,u.jsx)("div",{children:t.handler.legend},t.options.name));return e}render(){let{ttip:e,ttipOpen:t,topRight1:i,legends:s,topRight2:o}=this.state;const{options:r}=this.props,a=r.controls.showScale;return!t&&r.tooltip?.mode===xt.None&&(e=void 0),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Ze.Global,{styles:this.globalCSS}),(0,u.jsxs)("div",{className:sn.wrap,onMouseLeave:this.clearTooltip,children:[(0,u.jsx)("div",{role:"application",className:sn.map,tabIndex:0,"aria-label":(0,v.t)("geomap.geomap-panel.aria-label-map","Navigable map"),ref:this.initMapRef}),(0,u.jsx)(st,{bottomLeft:s,topRight1:i,topRight2:o,blStyle:{bottom:a?"35px":"8px"}})]}),(0,u.jsx)(bn,{ttip:e,isOpen:t,onClose:this.tooltipPopupClosed})]})}}const sn={wrap:(0,F.css)({position:"relative",width:"100%",height:"100%"}),map:(0,F.css)({position:"absolute",zIndex:0,width:"100%",height:"100%"})};var Rr=g(86956),ki=g(89332),jr=g(30703),zr=g(34316);const Or="layer-drag-drop-list",kr=({layers:n,getLayerInfo:e,onDragEnd:t,onSelect:i,onDelete:s,onDuplicate:o,showActions:r,selection:a,excludeBaseLayer:l,onNameChange:c,verifyLayerNameUniqueness:d})=>{const h=(0,q.of)(Gr),f=m=>m?`${h.row} ${h.sel}`:h.row;return(0,u.jsx)(ki.JY,{onDragEnd:t,children:(0,u.jsx)(ki.gL,{droppableId:"droppable",children:(m,p)=>(0,u.jsxs)("div",{...m.droppableProps,ref:m.innerRef,"data-testid":Or,children:[(()=>{const y=[],x=l?1:0,C=l?2:1;for(let S=n.length-1;S>=x;S--){const T=n[S],b=T.getName(),E=!!a?.includes(b);y.push((0,u.jsx)(ki.sx,{draggableId:b,index:y.length,children:(_,A)=>(0,u.jsxs)("div",{className:f(E),ref:_.innerRef,..._.draggableProps,..._.dragHandleProps,onMouseDown:()=>i(T),role:"button",tabIndex:0,children:[(0,u.jsx)(zr.R,{name:b,onChange:Y=>c(T,Y),verifyLayerNameUniqueness:d??void 0}),(0,u.jsxs)("div",{className:h.textWrapper,children:["\xA0 ",e(T)]}),r(T)&&(0,u.jsxs)(u.Fragment,{children:[o?(0,u.jsx)(ci.K,{name:"copy",tooltip:(0,v.t)("layers.layer-drag-drop-list.duplicate-tooltip","Duplicate"),className:h.actionIcon,onClick:()=>o(T)}):null,(0,u.jsx)(ci.K,{name:"trash-alt",tooltip:(0,v.t)("layers.layer-drag-drop-list.remove-tooltip","Remove"),className:(0,F.cx)(h.actionIcon,h.dragIcon),onClick:()=>s(T)})]}),n.length>C&&(0,u.jsx)(jr.I,{"aria-label":(0,v.t)("layers.layer-drag-drop-list.draggable-aria-label","Drag and drop to reorder"),name:"draggabledots",size:"lg",className:h.dragIcon})]})},b))}return y})(),m.placeholder]})})})},Gr=n=>({wrapper:(0,F.css)({marginBottom:n.spacing(2)}),row:(0,F.css)({padding:n.spacing(.5,1),borderRadius:n.shape.radius.default,background:n.colors.background.secondary,minHeight:n.spacing(4),display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"3px",cursor:"pointer",border:`1px solid ${n.components.input.borderColor}`,"&:hover":{border:`1px solid ${n.components.input.borderHover}`}}),sel:(0,F.css)({border:`1px solid ${n.colors.primary.border}`,"&:hover":{border:`1px solid ${n.colors.primary.border}`}}),dragIcon:(0,F.css)({cursor:"drag"}),actionIcon:(0,F.css)({color:n.colors.text.secondary,"&:hover":{color:n.colors.text.primary}}),typeWrapper:(0,F.css)({color:n.colors.primary.text,marginRight:"5px"}),textWrapper:(0,F.css)({display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginRight:n.spacing(1)})}),Nr=n=>{const{layers:e,selected:t,actions:i}=n.context.instanceState??{};if(!e||!i)return(0,u.jsx)("div",{children:(0,u.jsx)(v.x6,{i18nKey:"geomap.layers-editor.no-layers",children:"No layers?"})});const s=d=>{if(!d.destination)return;const{layers:h,actions:f}=n.context.instanceState??{};if(!h||!f)return;const m=h.length-1,p=(d.source.index-m)*-1,y=(d.destination.index-m)*-1;f.reorder(p,y)},o=d=>{i.selectLayer(d.options.name)},r=d=>{i.deleteLayer(d.options.name)},a=d=>d.options.type,l=(d,h)=>{d.onChange({...d.options,name:h})},c=t?[e[t]?.getName()]:[];return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(yi.mc,{children:(0,u.jsx)(Rr.r,{onChange:d=>i.addlayer(d.value),options:Qs(!1).options,label:(0,v.t)("geomap.layers-editor.label-add-layer","Add layer")})}),(0,u.jsx)("br",{}),(0,u.jsx)(kr,{layers:e,showActions:()=>e.length>2,getLayerInfo:a,onDragEnd:s,onSelect:o,onDelete:r,selection:c,excludeBaseLayer:!0,onNameChange:l,verifyLayerNameUniqueness:i.canRename})]})},Br=({labelWidth:n,value:e,onChange:t})=>{const i=o=>{t({...e,lat:o})},s=o=>{t({...e,lon:o})};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.coordinates-map-view-editor.label-latitude","Latitude"),labelWidth:n,grow:!0,children:(0,u.jsx)(Rt.Q,{value:e.lat,min:-90,max:90,step:.001,onChange:i})})}),(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.coordinates-map-view-editor.label-longitude","Longitude"),labelWidth:n,grow:!0,children:(0,u.jsx)(Rt.Q,{value:e.lon,min:-180,max:180,step:.001,onChange:s})})})]})};var nn=(n=>(n.all="all",n.layer="layer",n.last="last",n))(nn||{}),on=(n=>(n.all="All layers",n.layer="Layer",n.last="Last value",n))(on||{});const Ur=Object.values(nn).map(n=>({label:on[n],value:n})),Wr=({labelWidth:n,value:e,onChange:t,context:i})=>{const s=(0,L.useMemo)(()=>i.options?.layers?i.options.layers.map(h=>({label:h.name,value:h.name,description:void 0})):[],[i.options?.layers]),o=(0,L.useCallback)(h=>{t({...e,layer:h.value})},[e,t]),r=(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.fit-map-view-editor.all-layers-editor-fragment.label-layer","Layer"),labelWidth:n,grow:!0,children:(0,u.jsx)(ot.l6,{options:s,onChange:o,placeholder:s[0]?.label,value:e.layer})})}),a=h=>{t({...e,padding:h})},l=(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.fit-map-view-editor.last-only-editor-fragment.label-padding","Padding"),labelWidth:n,grow:!0,tooltip:(0,v.t)("geomap.fit-map-view-editor.last-only-editor-fragment.tooltip-padding-relative-percent-beyond-extent","Sets padding in relative percent beyond data extent"),children:(0,u.jsx)(Rt.Q,{value:e?.padding??5,min:0,step:1,onChange:a})})}),c=e.allLayers?"all":!e.allLayers&&e.lastOnly?"last":"layer",d=h=>{h!=="all"&&!e.layer?t({...e,allLayers:h==="all",lastOnly:h==="last",layer:s[0].value}):t({...e,allLayers:h==="all",lastOnly:h==="last"})};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.fit-map-view-editor.label-data","Data"),labelWidth:n,grow:!0,children:(0,u.jsx)(nt.z,{value:c,options:Ur,onChange:d})})}),!e?.allLayers&&r,!e?.lastOnly&&l]})},Vr=({value:n,onChange:e,context:t})=>{const s=(0,L.useMemo)(()=>{const a=[];return n?.id?a.push(n.id):a.push(kt.list()[0].id),kt.selectOptions(a)},[n?.id]),o=(0,L.useCallback)(()=>{const a=t.instanceState?.map;if(a){const l=a.getView(),c=l.getCenter();if(c){const d=(0,M.WP)(c,l.getProjection());e({...n,id:Ae.Coordinates,lon:+d[0].toFixed(6),lat:+d[1].toFixed(6),zoom:+l.getZoom().toFixed(2)})}}},[n,e,t.instanceState]),r=(0,L.useCallback)(a=>{const l=kt.getIfExists(a.value);l&&e({...n,id:l.id,lat:l.lat??n?.lat,lon:l.lon??n?.lon,zoom:l.zoom??n?.zoom})},[n,e]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:(0,v.t)("geomap.map-view-editor.label-view","View"),labelWidth:10,grow:!0,children:(0,u.jsx)(ot.l6,{options:s.options,value:s.current,onChange:r})})}),n.id===Ae.Coordinates&&(0,u.jsx)(Br,{labelWidth:10,value:n,onChange:e}),n.id===Ae.Fit&&(0,u.jsx)(Wr,{labelWidth:10,value:n,onChange:e,context:t}),(0,u.jsx)(Te.C,{children:(0,u.jsx)(ve.I,{label:n?.id===Ae.Fit?(0,v.t)("geomap.map-view-editor.label-max-zoom","Max Zoom"):(0,v.t)("geomap.map-view-editor.label-zoom","Zoom"),labelWidth:10,grow:!0,children:(0,u.jsx)(Rt.Q,{value:n?.zoom??1,min:1,max:18,step:.01,onChange:a=>{e({...n,zoom:a})}})})}),(0,u.jsx)(yi.gW,{children:(0,u.jsx)(Bt.$n,{variant:"secondary",size:"sm",fullWidth:!0,onClick:o,children:(0,u.jsx)("span",{children:(0,u.jsx)(v.x6,{i18nKey:"geomap.map-view-editor.use-current-map-settings",children:"Use current map settings"})})})})]})};var Xr=g(61215),Yr=g(90267),Zr=g(42240);function rn(n){return{category:n.category,path:"--",defaultValue:n.basemaps?yt:Ai,values:e=>({getContext:t=>({...t,options:n.state.options,instanceState:n.state}),getValue:t=>(0,se.get)(n.state.options,t),onChange:(t,i)=>{const{state:s}=n,{options:o}=s;if(t==="type"&&i){const r=Ot.getIfExists(i);if(r){const a={...o,type:r.id,config:{...r.defaultOptions}};r.showLocation&&(a.location?.mode?delete a.location:a.location={mode:X.aG.Auto}),s.onChange(a);return}}s.onChange((0,Xr.Sf)(o,t,i))}}),build:(e,t)=>{if(!n.state)return;const{handler:i,options:s}=n.state,o=Ot.getIfExists(s?.type),r=Qs(n.basemaps,s?.type?s.type:yt.type);if(e.addSelect({path:"type",name:(0,v.t)("geomap.layer-editor.name-layer-type","Layer type"),settings:{options:r.options}}),i.update&&e.addCustomEditor({id:"filterData",path:"filterData",name:(0,v.t)("geomap.layer-editor.name-data","Data"),editor:Zr.x,defaultValue:void 0}),!!o&&s.type!==yt.type){if(o.showLocation){let a=t.data;if(s.filterData){const l=(0,qs.Dq)(s.filterData);a=a.filter(l)}(0,Yr.G)("Location","location.",e,s.location,a)}i.registerOptionsUI&&i.registerOptionsUI(e,t),(0,se.isEqual)(n.category,[(0,v.t)("geomap.layer-editor.category-base-layer","Base layer")])||(o.hideOpacity||e.addSliderInput({path:"opacity",name:(0,v.t)("geomap.layer-editor.name-opacity","Opacity"),defaultValue:1,settings:{min:0,max:1,step:.1}}),e.addBooleanSwitch({path:"layer-tooltip",name:(0,v.t)("geomap.layer-editor.name-display-tooltip","Display tooltip"),description:(0,v.t)("geomap.layer-editor.description-display-tooltip","Show the tooltip for layer"),defaultValue:!0}))}}}}var $r=g(46644),Kr=g(64761),Hr=g(33553);const Qr=(n,e,t,i)=>{if(e==="grafana-worldmap-panel"&&t.angular){const{fieldConfig:s,options:o,xform:r}=Jr({...t.angular,fieldConfig:i});return r?.id?.length&&(n.transformations=n.transformations?[...n.transformations,r]:[r]),n.fieldConfig=s,o}return{}};function Jr(n){const e={defaults:{},overrides:[]},t=(0,se.cloneDeep)(Ai),i={view:{id:Ae.Zero},controls:{showZoom:!0,mouseWheelZoom:!!n.mouseWheelZoom},basemap:{type:"default",name:"Basemap"},layers:[t],tooltip:{mode:xt.Details}};let s=vt(n.decimals);s&&(e.defaults.decimals=s);const o=t.config.style;s=vt(n.circleMaxSize),s&&(o.size.max=s),s=vt(n.circleMinSize),s&&(o.size.min=s);let r;const a=$r.AS.getIfExists(n.valueName);if(a&&n.locationData?.length)switch(r={id:Kr.F.reduce,options:{reducers:[a.id]}},n.locationData){case"countries":case"countries_3letter":t.location={mode:X.aG.Lookup,gazetteer:"public/gazetteer/countries.json",lookup:void 0};break;case"states":t.location={mode:X.aG.Lookup,gazetteer:"public/gazetteer/usa-states.json",lookup:void 0};break}if(n.thresholds&&n.colors){const c=n.thresholds.split(",").map(h=>Number(h.trim())),d=[];for(const h of n.colors){const f=d.length-1;f>=0?d.push({value:c[f],color:h}):d.push({value:-1/0,color:h})}e.defaults.thresholds={mode:Hr.O.Absolute,steps:d}}s=vt(n.initialZoom),s&&(i.view.zoom=s);const l={"(0\xB0, 0\xB0)":Ae.Zero,"North America":"north-america",Europe:"europe","West Asia":"west-asia","SE Asia":"se-asia","Last GeoHash":Ae.Coordinates};return i.view.id=l[n.mapCenter],i.view.lat=vt(n.mapCenterLatitude),i.view.lon=vt(n.mapCenterLongitude),{fieldConfig:e,options:i,xform:r}}function vt(n){const e=Number(n);return isNaN(e)?void 0:e}const qr=n=>{const e=n?.pluginVersion??"";if((e.startsWith("8.1")||e.startsWith("8.2"))&&n.options?.layers?.length===1){const i=n.options.layers[0];if(i?.type==="markers"&&i.config){const s=i.config,o={style:(0,se.cloneDeep)(w.T5),showLegend:!!s.showLegend};s.size&&(o.style.size=s.size),s.color&&(o.style.color=s.color),s.fillOpacity&&(o.style.opacity=s.fillOpacity);const r=uo(s.shape);return r&&(o.style.symbol={fixed:r,mode:X.q_.Fixed}),{...n.options,layers:[{...i,config:o}]}}}return n.options},ea=new ie.m(Dr).setNoPadding().setPanelChangeHandler(Qr).setMigrationHandler(qr).useFieldConfig({useCustomConfig:n=>{wt.e(n)}}).setPanelOptions((n,e)=>{let t=[(0,v.t)("geomap.category-map-view","Map view")];n.addCustomEditor({category:t,id:"view",path:"view",name:(0,v.t)("geomap.name-initial-view","Initial view"),description:(0,v.t)("geomap.description-initial-view","This location will show when the panel first loads."),editor:Vr,defaultValue:Js}),n.addBooleanSwitch({category:t,path:"view.shared",description:(0,v.t)("geomap.description-share-view","Use the same view across multiple panels.  Note: this may require a dashboard reload."),name:(0,v.t)("geomap.name-share-view","Share view"),defaultValue:Js.shared});const i=e.instanceState;if(i?.layers){const s=[(0,v.t)("geomap.category-map-layers","Map layers")],o=[(0,v.t)("geomap.category-basemap-layer","Basemap layer")];n.addCustomEditor({category:s,id:"layers",path:"",name:"",editor:Nr});const r=i.layers[i.selected];i.selected&&r&&n.addNestedOptions(rn({state:r,category:s,basemaps:!1}));const a=i.layers[0];Me.$.geomapDisableCustomBaseLayer?n.addCustomEditor({category:o,id:"layers",path:"",name:"",editor:()=>(0,u.jsx)("div",{children:(0,u.jsx)(v.x6,{i18nKey:"geomap.plugin.basemap-layer-configured-server-admin",children:"The basemap layer is configured by the server admin."})})}):a&&n.addNestedOptions(rn({state:a,category:o,basemaps:!0}))}t=[(0,v.t)("geomap.category-map-controls","Map controls")],n.addBooleanSwitch({category:t,path:"controls.showZoom",description:(0,v.t)("geomap.description-show-zoom","Show zoom control buttons in the upper left corner"),name:(0,v.t)("geomap.name-show-zoom","Show zoom control"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.mouseWheelZoom",description:(0,v.t)("geomap.description-mouse-wheel-zoom","Enable zoom control via mouse wheel"),name:(0,v.t)("geomap.name-mouse-wheel-zoom","Mouse wheel zoom"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.showAttribution",name:(0,v.t)("geomap.name-show-attribution","Show attribution"),description:(0,v.t)("geomap.description-show-attribution","Show the map source attribution info in the lower right"),defaultValue:!0}).addBooleanSwitch({category:t,path:"controls.showScale",name:(0,v.t)("geomap.name-show-scale","Show scale"),description:(0,v.t)("geomap.description-show-scale","Indicate map scale"),defaultValue:!1}).addBooleanSwitch({category:t,path:"controls.showMeasure",name:(0,v.t)("geomap.name-show-measure","Show measure tools"),description:(0,v.t)("geomap.description-show-measure","Show tools for making measurements on the map"),defaultValue:!1}).addBooleanSwitch({category:t,path:"controls.showDebug",name:(0,v.t)("geomap.name-show-debug","Show debug"),description:(0,v.t)("geomap.description-show-debug","Show map info"),defaultValue:!1}).addRadio({category:t,path:"tooltip.mode",name:(0,v.t)("geomap.name-tooltip","Tooltip"),defaultValue:xt.Details,settings:{options:[{label:(0,v.t)("geomap.tooltip-options.label-none","None"),value:xt.None,description:(0,v.t)("geomap.tooltip-options.description-none","Show contents on click, not hover")},{label:(0,v.t)("geomap.tooltip-options.label-details","Details"),value:xt.Details,description:(0,v.t)("geomap.tooltip-options.description-details","Show popup on hover")}]}})})}}]);

//# sourceMappingURL=8550.1050208231e6d139344b.js.map