"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9119],{91087:(Z,f,e)=>{e.d(f,{y:()=>d});var s=e(74848),o=e(96540),U=e(41053),i=e(73427),u=e(11257),l=e(59812),E=e(34418);const d=({basicRole:M,roles:v,userId:m,orgId:c,onBasicRoleChange:h,roleOptions:x,disabled:L,basicRoleDisabled:P,basicRoleDisabledMessage:p,apply:O=!1,onApplyRoles:y,pendingRoles:j,maxWidth:z,width:C,isLoading:I})=>{const[{loading:Y,value:w=v||[]},K]=(0,U.A)(async()=>{try{if(v)return v;if(O&&j?.length)return j;if(i.TP.hasPermission(u.w.ActionUserRolesList)&&m>0)return await(0,E.Xh)(m,c)}catch{console.error("Error loading options")}return[]},[c,m,j,v]);(0,o.useEffect)(()=>{c&&K()},[K,c]);const n=async D=>{O?y&&y(D,m,c):(await(0,E.eA)(D,m,c),await K())},t=i.TP.hasPermission(u.w.ActionUserRolesAdd)&&i.TP.hasPermission(u.w.ActionUserRolesRemove);return(0,s.jsx)(l.n,{appliedRoles:w,basicRole:M,onRolesChange:n,onBasicRoleChange:h,roleOptions:x,isLoading:Y||I,disabled:L,basicRoleDisabled:P,basicRoleDisabledMessage:p,showBasicRole:!0,apply:O,canUpdateRoles:t,maxWidth:z,width:C})}},31908:(Z,f,e)=>{e.d(f,{I:()=>c});var s=e(74848),o=e(49785),U=e(90382),i=e(47184),u=e(92745),l=e(89640),E=e(8207),d=e(37386),M=e(77824);const v=Object.keys(U.X).map(i.z),m=(0,s.jsxs)(u.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,s.jsx)(l.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),c=({onClose:h})=>{const x=(0,o.xW)(),{control:L,getValues:P,setValue:p}=x,[O,y]=P(["name","roles"]);return(0,s.jsx)(E._,{title:O,subtitle:m,onClose:h,children:(0,s.jsx)(d.D,{label:(0,u.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,s.jsx)(o.xI,{name:"role",control:L,render:({field:{onChange:j,ref:z,...C}})=>(0,s.jsx)(M.z,{...C,options:v,onChange:I=>{p("roleCollection",[I,...y]),j(I)}})})})})}},88947:(Z,f,e)=>{e.r(f),e.d(f,{default:()=>K});var s=e(74848),o=e(96540),U=e(49785),i=e(54148),u=e(41053),l=e(92745),E=e(34999),d=e(53487),M=e(37386),v=e(63527),m=e(45861),c=e(13791),h=e(73427),x=e(11257),L=e(77527),P=e(68143),p=e(81871);const O=30,y=async n=>await(0,P.AI)().get(`/api/orgs/${n}`),j=async(n,t)=>h.TP.hasPermission(x.w.OrgUsersRead)?(0,P.AI)().get(`/api/orgs/${n}/users/search`,(0,p.F)({perpage:O,page:t})):{orgUsers:[]},z=async(n,t)=>{const D=t.map(R=>R.userId),W=await(0,P.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:D,orgId:n});t.forEach(R=>{R.roles=W?W[R.userId]||[]:[]})},C=(n,t)=>(0,P.AI)().patch(`/api/orgs/${t}/users/${n.userId}`,n),I=(n,t)=>(0,P.AI)().delete(`/api/orgs/${t}/users/${n.userId}`),Y=(n,t)=>(0,P.AI)().put(`/api/orgs/${t}`,{name:n}),K=()=>{const{id:n=""}=(0,i.g)(),t=parseInt(n,10),D=h.TP.hasPermission(x.w.OrgsWrite),W=h.TP.hasPermission(x.w.OrgUsersRead),[R,q]=(0,o.useState)([]),[S,T]=(0,o.useState)(1),[g,b]=(0,o.useState)(1),[A,F]=(0,u.A)(()=>y(t),[]),{handleSubmit:G,register:$,formState:{errors:X}}=(0,U.mN)(),[,B]=(0,u.A)(async a=>{const r=await j(t,a);h.TP.licensedAccessControlEnabled()&&await z(t,r.orgUsers);const J=r?.perPage!==0?Math.ceil(r.totalCount/r.perPage):0;return b(J),q(r.orgUsers),r.orgUsers},[]);(0,o.useEffect)(()=>{F(),B(S)},[F,B,S]);const N=async({orgName:a})=>{await Y(a,t)},V=()=>(0,s.jsx)(E.F,{severity:"info",title:(0,l.t)("admin.admin-edit-org-page.render-missing-permission-message.title-access-denied","Access denied"),children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.access-denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."})}),H=a=>{T(a)},k=async a=>{await I(a,t),B(S)},_=async(a,r)=>{await C({...r,role:a},t),B(S)},ee={text:A?.value?.name??"",icon:"shield",subTitle:(0,l.t)("admin.admin-edit-org-page.page-nav.subTitle.manage-settings-roles-organization","Manage settings and user roles for an organization.")};return(0,s.jsx)(c.Y,{navId:"global-orgs",pageNav:ee,subTitle:"Manage settings for this specific org.",children:(0,s.jsx)(c.Y.Contents,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.s,{children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.heading",children:"Edit Organization"})}),A.value&&(0,s.jsxs)("form",{onSubmit:G(N),style:{maxWidth:"600px"},children:[(0,s.jsx)(M.D,{label:(0,l.t)("admin.admin-edit-org-page.label-name","Name"),invalid:!!X.orgName,error:"Name is required",disabled:!D,children:(0,s.jsx)(v.p,{...$("orgName",{required:!0}),id:"org-name-input",defaultValue:A.value.name})}),(0,s.jsx)(m.$n,{type:"submit",disabled:!D,children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.update-button",children:"Update"})})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)(d.s,{children:(0,s.jsx)(l.x6,{i18nKey:"admin.edit-org.users-heading",children:"Organization users"})}),!W&&V(),W&&!!R.length&&(0,s.jsx)(L.b,{users:R,orgId:t,onRoleChange:_,onRemoveUser:k,changePage:H,page:S,totalPages:g})]})]})})})}},9390:(Z,f,e)=>{e.d(f,{r:()=>E});var s=e(74848),o=e(90382),U=e(92745),i=e(18857);const l=Object.values(o.X).filter(d=>d!==o.X.None).map(d=>({label:d,value:d}));function E({value:d,onChange:M,"aria-label":v,inputId:m,autoFocus:c,...h}){return(0,s.jsx)(i.l6,{inputId:m,value:d,options:l,onChange:x=>M(x.value??o.X.None),placeholder:(0,U.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":v,autoFocus:c,...h})}},77527:(Z,f,e)=>{e.d(f,{b:()=>S});var s=e(74848),o=e(96540),U=e(51898),i=e(92745),u=e(43173),l=e(71555),E=e(66404),d=e(31286),M=e(45967),v=e(30703),m=e(94018),c=e(45861),h=e(41654),x=e(27594),L=e(34213),P=e(71599),p=e(91087),O=e(34418),y=e(22803),j=e(49785),z=e(63142),C=e(99887),I=e(31908);const Y=({disabled:T,user:g})=>{const[b,A]=(0,o.useState)(!1),{badge:F,badgeDisabled:G}=(0,z.of)(w),$=T?G:F,X=(0,j.mN)({defaultValues:{name:g.name,role:g.role,roles:g.roles}}),{watch:B}=X,N=()=>{T||A(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.B,{gap:1,children:[(0,s.jsx)(C.E,{className:$,color:"blue",onClick:N,text:B("role")}),g.roles&&g.roles.length>0&&(0,s.jsx)(C.E,{className:$,color:"blue",onClick:N,text:(0,i.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:g.roles.length})})]}),b&&(0,s.jsx)(j.Op,{...X,children:(0,s.jsx)(I.I,{onClose:()=>A(!1)})})]})};function w(T){return{badge:(0,y.css)({cursor:"pointer"}),badgeDisabled:(0,y.css)({cursor:"not-allowed"})}}var K=e(11297),n=e(73427),t=e(11257),D=e(9390);const W=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,R=T=>{const g=T?.isExternallySynced;return!n.TP.hasPermissionInMetadata(t.w.OrgUsersWrite,T)||g},q=U.Tp.pages.UserListPage.UsersListPage,S=({users:T,orgId:g,onRoleChange:b,onUserRolesChange:A,onRemoveUser:F,fetchData:G,changePage:$,page:X,totalPages:B,rolesLoading:N})=>{const[V,H]=(0,o.useState)(null),[k,_]=(0,o.useState)([]);(0,o.useEffect)(()=>{async function a(){try{if(n.TP.hasPermission(t.w.ActionRolesList)){let r=await(0,O.RL)(g);_(r)}}catch{console.error("Error loading options")}}n.TP.licensedAccessControlEnabled()&&a()},[g]);const ee=(0,o.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:a}})=>a&&(0,s.jsx)(l.e,{src:a,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:a}})=>(0,s.jsx)("div",{children:a}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(s.Fragment,{children:a==="10 years"?(0,s.jsx)(E.E,{color:"disabled",children:(0,s.jsx)(i.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):a})}),sortType:(a,r)=>new Date(a.original.lastSeenAt).getTime()-new Date(r.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:a},row:{original:r}})=>{const J=R(r),se=async(Q,ae,te)=>{await(0,O.eA)(Q,ae,te),A&&A()};return u.$.featureToggles.rolePickerDrawer?(0,s.jsx)(Y,{disabled:J,user:r}):n.TP.licensedAccessControlEnabled()?(0,s.jsx)(p.y,{userId:r.userId,roles:r.roles,apply:!0,onApplyRoles:se,isLoading:N,orgId:g,roleOptions:k,basicRole:a,onBasicRoleChange:Q=>b(Q,r),basicRoleDisabled:J,basicRoleDisabledMessage:W,width:40}):(0,s.jsx)(D.r,{"aria-label":(0,i.t)("admin.org-users-table.columns.aria-label-role","Role"),value:a,disabled:J,onChange:Q=>b(Q,r)})}},{id:"info",header:"",cell:({row:{original:a}})=>R(a)&&(0,s.jsx)(d.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(M.m,{interactive:!0,content:(0,s.jsx)("div",{children:(0,s.jsxs)(i.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,s.jsx)(v.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(a)&&a.length>0&&(0,s.jsx)(K.E,{label:a[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(m.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:a}})=>(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)(m.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:a}})=>n.TP.hasPermissionInMetadata(t.w.OrgUsersRemove,a)&&(0,s.jsx)(c.$n,{size:"sm",variant:"destructive",onClick:()=>{H(a)},icon:"times","aria-label":(0,i.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:a.name})})}],[N,g,k,A,b]);return(0,s.jsxs)(h.B,{direction:"column",gap:2,"data-testid":q.container,children:[(0,s.jsx)(x.j,{columns:ee,data:T,getRowId:a=>String(a.userId),fetchData:G}),(0,s.jsx)(h.B,{justifyContent:"flex-end",children:(0,s.jsx)(L.d,{onNavigate:$,currentPage:X,numberOfPages:B,hideWhenSinglePage:!0})}),!!V&&(0,s.jsx)(P.u,{body:(0,i.t)("admin.org-users-table.body-delete","Are you sure you want to delete user {{user}}?",{user:V?.login}),confirmText:(0,i.t)("admin.org-users-table.confirmText-delete","Delete"),title:(0,i.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{H(null)},isOpen:!0,onConfirm:()=>{V&&(F(V),H(null))}})]})}}}]);

//# sourceMappingURL=AdminEditOrgPage.6e83ac403fabad42f7bf.js.map