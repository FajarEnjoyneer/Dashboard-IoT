"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1290,4351],{58102:(D,m,e)=>{e.d(m,{GU:()=>f,YO:()=>y,qm:()=>c});var s=e(74848),a=e(22803),_=e(96540),h=e(92745),u=e(63142),g=e(92948),E=e(10388);const c=({children:t,enterAnimation:l=!0})=>{const p=(0,u.of)(y);return(0,s.jsx)("div",{className:(0,a.cx)(p.loginInnerBox,l&&p.enterAnimation),children:t})},f=({children:t,branding:l,isChangingPassword:p})=>{const d=(0,u.of)(y),[o,i]=(0,_.useState)(!1),n=l?.loginSubtitle??g.M.GetLoginSubTitle(),r=l?.loginTitle??g.M.LoginTitle,v=l?.loginBoxBackground||g.M.LoginBoxBackground(),x=l?.loginLogo,T=l?.hideEdition??g.M.HideEdition;return(0,_.useEffect)(()=>i(!0),[]),(0,s.jsxs)(g.M.LoginBackground,{className:(0,a.cx)(d.container,o&&d.loginAnim,l?.loginBackground),children:[(0,s.jsx)("div",{className:d.loginMain,children:(0,s.jsxs)("div",{className:(0,a.cx)(d.loginContent,v,"login-content-box"),children:[(0,s.jsxs)("div",{className:d.loginLogoWrapper,children:[(0,s.jsx)(g.M.LoginLogo,{className:d.loginLogo,logo:x}),(0,s.jsx)("div",{className:d.titleWrapper,children:p?(0,s.jsx)("h1",{className:d.mainTitle,children:(0,s.jsx)(h.x6,{i18nKey:"login.layout.update-password",children:"Update your password"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:d.mainTitle,children:r}),n&&(0,s.jsx)("h3",{className:d.subTitle,children:n})]})})]}),(0,s.jsx)("div",{className:d.loginOuterBox,children:t})]})}),l?.hideFooter?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)(E.wi,{hideEdition:T,customLinks:l?.footerLinks})]})},b=(0,a.keyframes)`
from{
  opacity: 0;
  transform: translate(-60px, 0px);
}

to{
  opacity: 1;
  transform: translate(0px, 0px);
}`,y=t=>({loginMain:(0,a.css)({flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:"100%"}),container:(0,a.css)({minHeight:"100%",backgroundPosition:"center",backgroundRepeat:"no-repeat",flex:1,minWidth:"100%",marginLeft:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),loginAnim:(0,a.css)({"&:before":{opacity:1},".login-content-box":{opacity:1}}),submitButton:(0,a.css)({justifyContent:"center",width:"100%"}),loginLogo:(0,a.css)({width:"100%",maxWidth:60,marginBottom:t.spacing(2),[t.breakpoints.up("sm")]:{maxWidth:100}}),loginLogoWrapper:(0,a.css)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:t.spacing(3)}),titleWrapper:(0,a.css)({textAlign:"center"}),mainTitle:(0,a.css)({fontSize:22,[t.breakpoints.up("sm")]:{fontSize:32}}),subTitle:(0,a.css)({fontSize:t.typography.size.md,color:t.colors.text.secondary}),loginContent:(0,a.css)({maxWidth:478,width:"calc(100% - 2rem)",display:"flex",alignItems:"stretch",flexDirection:"column",position:"relative",justifyContent:"flex-start",zIndex:1,minHeight:320,borderRadius:t.shape.radius.default,padding:t.spacing(2,0),opacity:0,[t.transitions.handleMotion("no-preference","reduce")]:{transition:"opacity 0.5s ease-in-out"},[t.breakpoints.up("sm")]:{minHeight:t.spacing(40),justifyContent:"center"}}),loginOuterBox:(0,a.css)({display:"flex",overflowY:"hidden",alignItems:"center",justifyContent:"center"}),loginInnerBox:(0,a.css)({padding:t.spacing(0,2,2,2),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,maxWidth:415,width:"100%",transform:"translate(0px, 0px)",[t.transitions.handleMotion("no-preference")]:{transition:"0.25s ease"}}),enterAnimation:(0,a.css)({[t.transitions.handleMotion("no-preference")]:{animation:`${b} ease-out 0.2s`}})})},35919:(D,m,e)=>{e.r(m),e.d(m,{ConfirmAccessPage:()=>l,default:()=>p});var s=e(74848),a=e(22803),_=e(54148),h=e(51898),u=e(92745),g=e(63142),E=e(45861),c=e(68079),f=e(58102),b=e(70958),y=e(54351);const t=h.Tp.pages.PublicDashboardConfirmAccess;function l(){const o=(0,g.of)(d),{accessToken:i=""}=(0,_.g)(),[{magicLinkToken:n}]=(0,b.s)(),[r,{isLoading:v,isSuccess:x}]=(0,y.useConfirmAccessMutation)(),T=async()=>{await r({accessToken:i,magicLinkToken:String(n)})};return(0,s.jsx)(f.GU,{branding:{loginTitle:(0,u.t)("public-dashboards.confirm-access-page.login-title","Dashboard access"),loginSubtitle:(0,u.t)("public-dashboards.confirm-access-page.login-subtitle","Get access to the dashboard for 30 days. After 30 days, you can request access again to continue viewing the dashboard."),hideFooter:!0},children:(0,s.jsx)(f.qm,{children:(0,s.jsxs)(E.$n,{"data-testid":t.submitButton,disabled:v||x,type:"submit",className:o.form,onClick:T,children:[(0,s.jsx)("span",{children:(0,s.jsx)(u.x6,{i18nKey:"public-dashboards.confirm-access-page.confirm-access",children:"Confirm access"})}),v&&(0,s.jsx)(c.y,{className:o.loadingSpinner})]})})})}const p=l,d=o=>({loadingSpinner:(0,a.css)({marginLeft:o.spacing(1)}),form:(0,a.css)({justifyContent:"center",width:"100%"})})},54351:(D,m,e)=>{e.r(m),e.d(m,{default:()=>d,useConfirmAccessMutation:()=>p,useGetActiveUserDashboardsQuery:()=>t,useGetActiveUsersQuery:()=>l,useRequestAccessMutation:()=>y});var s=e(92745),a=e(68143),_=e(43173),h=e(6890),u=e(64762),g=e(62905),E=e(18393);function c(o){return typeof o=="object"&&o!=null&&"error"in o}function f(o){return c(o)&&(0,a.NF)(o.error)}const b=g.Sm.injectEndpoints({endpoints:o=>({requestAccess:o.mutation({query:i=>({url:"/public/dashboards/share/request-access",method:"POST",body:i})}),confirmAccess:o.mutation({query:({magicLinkToken:i,accessToken:n})=>({url:`/public/dashboards/share/${i}`,method:"POST",manageError:g.Ht}),async onQueryStarted({accessToken:i},{dispatch:n,queryFulfilled:r}){try{await r,n((0,h.dx)((0,u.tZ)((0,s.t)("public-dashboard.email-sharing.success-confirm-access","Access confirmed!")))),window.location.assign(_.$.appSubUrl+`public-dashboards/${i}`)}catch(v){if(f(v)){const{data:{messageId:x}}=v.error;x&&Object.values(E.b5).includes(x)&&window.location.assign(_.$.appSubUrl+`public-dashboards/${i}/request-access?error=${x}`)}}}}),addRecipient:o.mutation({query:({recipient:i,uid:n})=>({url:`/public-dashboards/${n}/share/recipients`,method:"POST",body:{recipient:i}}),async onQueryStarted(i,{dispatch:n,queryFulfilled:r}){await r,n((0,h.dx)((0,u.tZ)((0,s.t)("public-dashboard.email-sharing.success-send-recipient-invitation","The email invitation has been sent."))))},invalidatesTags:(i,n,{dashboardUid:r})=>[{type:"PublicDashboard",id:r}]}),deleteRecipient:o.mutation({query:({uid:i,recipientUid:n})=>({url:`/public-dashboards/${i}/share/recipients/${n}`,method:"DELETE"}),async onQueryStarted({recipientEmail:i},{dispatch:n,queryFulfilled:r}){await r,n((0,h.dx)((0,u.tZ)((0,s.t)("public-dashboard.email-sharing.success-revoke-access-title","Access Revoked"),(0,s.t)("public-dashboard.email-sharing.success-revoke-access-description","You have successfully revoked access for {{recipientEmail}}.",{recipientEmail:i}))))},invalidatesTags:(i,n,{dashboardUid:r})=>[{type:"PublicDashboard",id:r},"UsersWithActiveSessions","ActiveUserDashboards"]}),reshareAccessToRecipient:o.mutation({query:({uid:i,recipientUid:n})=>({url:`/public-dashboards/${i}/share/recipients/${n}`,method:"PATCH"}),async onQueryStarted(i,{dispatch:n,queryFulfilled:r}){await r,n((0,h.dx)((0,u.tZ)((0,s.t)("public-dashboard.email-sharing.success-resend-recipient-invitation","The email invitation has been resent."))))}}),getActiveUsers:o.query({query:()=>({url:"/public-dashboards/share/users?status=active"}),providesTags:["UsersWithActiveSessions"]}),getActiveUserDashboards:o.query({query:i=>({url:`/public-dashboards/share/users/${i}/dashboards?status=active`}),providesTags:(i,n,r)=>[{type:"ActiveUserDashboards",id:r}]}),revokeAllAccess:o.mutation({query:({email:i})=>({url:`/public-dashboards/share/users/${i}`,method:"DELETE"}),async onQueryStarted({email:i},{dispatch:n,queryFulfilled:r}){await r,n((0,h.dx)((0,u.tZ)((0,s.t)("public-dashboard.email-sharing.success-revoke-all-accesses-title","Access Revoked"),(0,s.t)("public-dashboard.email-sharing.success-revoke-all-accesses-description","{{email}}'s access to all public dashboards has been successfully removed.",{email:i}))))},invalidatesTags:["UsersWithActiveSessions"]})}),overrideExisting:!0}),{useRequestAccessMutation:y,useGetActiveUserDashboardsQuery:t,useGetActiveUsersQuery:l,useConfirmAccessMutation:p}=b,d=b},18393:(D,m,e)=>{e.d(m,{Z:()=>E,b5:()=>s});var s=(c=>(c.NOT_FOUND_MAGIC_LINK="publicdashboards.magicLinkNotFound",c.EXPIRED_MAGIC_LINK="publicdashboards.magicLinkExpired",c))(s||{}),a=(c=>(c.INTERNAL_SERVER_ERROR="publicdashboards.internalServerError",c.INVALID_SESSION="publicdashboards.invalidSession",c.EXPIRED_SESSION="publicdashboards.sessionExpired",c))(a||{});const _={title:"Request access",description:"You'll receive an email with a one-time link."},h="Something went wrong",u="To request access to the dashboard again, enter your email. You'll receive an email with a one-time link.",g={"publicdashboards.internalServerError":h,"publicdashboards.magicLinkNotFound":"This link has expired or already been used","publicdashboards.magicLinkExpired":"This magic link has expired","publicdashboards.invalidSession":"You no longer have access","publicdashboards.sessionExpired":"Your access has expired"},E=c=>c?{title:g[String(c)]||h,description:u}:_}}]);

//# sourceMappingURL=ConfirmAccessPage.4e0fb8320a8b1991860a.js.map