"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8638],{21819:(T,v,a)=>{a.r(v),a.d(v,{DashboardScenePage:()=>G,default:()=>Q});var e=a(74848),r=a(96540),i=a(54148),u=a(84596),c=a(75683),d=a(36490),x=a(36674),g=a(31286),D=a(13791),E=a(11098),p=a(99362),h=a(6262),O=a(22803),l=a(92745),C=a(8515),L=a(63142),y=a(22787),B=a(45861),S=a(83560),b=a(15130),z=a(17732),W=a(8285);const N=(0,r.memo)(({dashboard:n})=>{const f=(0,r.useMemo)(()=>d.Ny.getLocation().pathname,[n]),{showModal:m,hideModal:o}=(0,r.useContext)(C.wE);(0,r.useEffect)(()=>{const t=s=>{F(n)||n.state.isDirty&&(s.preventDefault(),s.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[n]);const P=t=>{const s=n.state.editPanel,U=s?.getPanel(),K=new URLSearchParams(t.search);if(s&&U&&(0,W.ME)(U)&&s.state.isDirty&&!K.has("editPanel")){const M=(0,W.iL)(U);return m(z.Z,{dashboard:n,isUnsavedPrompt:!0,libraryPanel:M,onConfirm:()=>{s.onConfirmSaveLibraryPanel(),o(),I(t)},onDiscard:()=>{s.onDiscard(),o(),I(t)},onDismiss:o}),!1}return f===t.pathname||F(n)||!n.state.isDirty?!0:(m($,{dashboard:n,onSaveDashboardClick:()=>{o(),n.openSaveDrawer({onSaveSuccess:()=>{I(t)}})},onDiscard:()=>{n.exitEditMode({skipConfirm:!0}),o(),I(t)},onDismiss:o}),!1)};return(0,e.jsx)(S.X,{when:!0,message:P})});N.displayName="DashboardPrompt";function I(n){n&&setTimeout(()=>d.Ny.push(n),10)}const $=({onDiscard:n,onDismiss:f,onSaveDashboardClick:m})=>{const o=(0,L.of)(V);return(0,e.jsxs)(y.a,{isOpen:!0,title:(0,l.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:f,icon:"exclamation-triangle",className:o.modal,children:[(0,e.jsx)("h5",{children:(0,e.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(y.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{variant:"secondary",onClick:f,fill:"outline",children:(0,e.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(B.$n,{variant:"destructive",onClick:n,children:(0,e.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(B.$n,{onClick:m,children:(0,e.jsx)(l.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},V=()=>({modal:(0,O.css)({width:"500px"})});function F(n){if(!n?.getInitialSaveModel()||n?.state.meta.version===0||!b.TP.isSignedIn||!n)return!0;const{canSave:m,fromScript:o,fromFile:P}=n.state.meta;return!b.TP.isEditor&&!m?!0:!m||o||P}var Z=a(94786),_=a(17788),Y=a(41644);function G({route:n,queryParams:f,location:m}){const o=(0,i.g)(),{type:P,slug:t,uid:s}=o,U=o["*"],K=(0,u.A)({params:o}),M=(0,Y.sP)(),{dashboard:R,isLoading:X,loadError:H}=M.useState(),J=m.state?.routeReloadCounter,j=(0,r.useRef)(o);if((0,r.useEffect)(()=>(n.routeName===h.Z4.Normal&&P==="snapshot"?M.loadSnapshot(t):M.loadDashboard({uid:(n.routeName===h.Z4.Provisioning?U:s)??"",type:P,slug:t,route:n.routeName,urlFolderUid:f.folderUid}),()=>{(0,_.zf)(d.Ny.getSearch(),s),M.clearState(),M.resetActiveManager()}),[M,s,n.routeName,f.folderUid,J,P]),(0,r.useEffect)(()=>{if(n.routeName===h.Z4.Normal&&s===j.current.uid&&j.current.slug&&!t){const A=`/d/${s}/${j.current.slug}`;d.Ny.replace({...d.Ny.getLocation(),pathname:A})}return()=>{j.current={uid:s,slug:t||j.current.slug}}},[n,t,P,s]),!R){let A;return H&&(A=(0,e.jsx)(p.i,{error:H,type:P})),A||(0,e.jsx)(D.Y,{navId:"dashboards/browse",layout:c.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,e.jsx)(g.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:X&&(0,e.jsx)(E.A,{})})})}return P!=="snapshot"&&(!K||s!==K?.params.uid)?(console.log("skipping rendering"),null):(0,e.jsxs)(x.$L,{scene:R,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,e.jsx)(Z.h,{queryParams:f,route:n.routeName,slug:t,path:U}),(0,e.jsx)(R.Component,{model:R},R.state.key),(0,e.jsx)(N,{dashboard:R})]})}const Q=G},94786:(T,v,a)=>{a.d(v,{h:()=>p,s:()=>D});var e=a(74848),r=a(92745),i=a(43173),u=a(34999),c=a(33680),d=a(96727),x=a(6262),g=a(55001);const D={severity:"info",style:{flex:0}};function E({queryParams:h,slug:O,path:l}){const{prURL:C}=(0,d.H)(),L=(0,c.Kw)({name:O,path:l,ref:h.ref});if(L.data?.errors)return(0,e.jsx)(u.F,{title:(0,r.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:L.data.errors.map((B,S)=>(0,e.jsx)("div",{children:B},S))});if(C?.length)return(0,e.jsx)(g.G,{prParam:C});const y=L.data?.urls?.newPullRequestURL??L.data?.urls?.compareURL;return y?(0,e.jsx)(g.G,{prParam:y,isNewPr:!0}):(0,e.jsx)(u.F,{...D,title:(0,r.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(r.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function p({queryParams:h,route:O,slug:l,path:C}){return!i.$.featureToggles.provisioning||"kiosk"in h||!C||O!==x.Z4.Provisioning||!l?null:(0,e.jsx)(E,{queryParams:h,slug:l,path:C})}},55001:(T,v,a)=>{a.d(v,{G:()=>g});var e=a(74848),r=a(63704),i=a(92745),u=a(34999),c=a(41654),d=a(30703),x=a(94786);function g({prParam:D,isNewPr:E}){const p=E?(0,i.t)("provisioned-resource-preview-banner.title-created-branch-git-hub","A new resource has been created in a branch in GitHub."):(0,i.t)("provisioned-resource-preview-banner.title-loaded-pull-request-git-hub","This resource is loaded from a pull request in GitHub.");return(0,e.jsx)(u.F,{...x.s,title:p,buttonContent:(0,e.jsxs)(c.B,{alignItems:"center",children:[E?(0,i.t)("provisioned-resource-preview-banner.preview-banner.open-pull-request-in-git-hub","Open pull request in GitHub"):(0,i.t)("provisioned-resource-preview-banner.preview-banner.view-pull-request-in-git-hub","View pull request in GitHub"),(0,e.jsx)(d.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(r.sQ.sanitizeUrl(D),"_blank"),children:(0,e.jsx)(i.x6,{i18nKey:"provisioned-resource-preview-banner.preview-banner.not-saved",children:"The value is not yet saved in the Grafana database"})})}},99362:(T,v,a)=>{a.d(v,{i:()=>D});var e=a(74848),r=a(75683),i=a(92745),u=a(31286),c=a(34999),d=a(13791),x=a(1506),g=a(47797);function D({error:E,type:p}){const h=(0,g.do)(E),O=(0,g.q6)(E),l=p==="snapshot"?"Snapshot":"Dashboard";return(0,e.jsx)(d.Y,{navId:"dashboards/browse",layout:r.k.Canvas,pageNav:{text:(0,i.t)("dashboard.dashboard-page-error.text.not-found","Not found")},children:(0,e.jsx)(u.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:h===404?(0,e.jsx)(x.L,{entity:l}):(0,e.jsx)(c.F,{title:(0,i.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:O})})})}},96727:(T,v,a)=>{a.d(v,{H:()=>i});var e=a(63704),r=a(74101);const i=()=>{const[u]=(0,r.z)(),c=u.get("pull_request_url"),d=u.get("new_pull_request_url");return{prURL:c?e.sQ.sanitizeUrl(c):void 0,newPrURL:d?e.sQ.sanitizeUrl(d):void 0}}}}]);

//# sourceMappingURL=DashboardScenePage.91e3c459beb0cf385ddf.js.map