"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{85185:(X,O,e)=>{e.r(O),e.d(O,{BrowseFolderAlertingPage:()=>z,default:()=>B});var s=e(74848),d=e(96540),a=e(54148),n=e(92745),P=e(34999),y=e(13791),o=e(66198),l=e(22803),M=e(2543),i=e(40996),b=e(63142),u=e(41654),p=e(12737),g=e(18857),h=e(30703),j=e(8073),C=e(37658),W=e(34213),w=e(95943),F=e(1404),S=e(74048),H=e(20962),G=e(86017),k=e(52161),_=e(63895),ee=e(29442),se=(t=>(t.Ascending="alpha-asc",t.Descending="alpha-desc",t))(se||{});const ae=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],te=({folder:t,rules:r})=>{const v=(0,b.of)(c),f=V=>{const ie=(0,G.EU)(x,V);D(ie)},{nameFilter:E,labelFilter:x,sortOrder:m,setNameFilter:L,setLabelFilter:D,setSortOrder:U}=ne(),Z=re(r,E,x,m??"alpha-asc"),I=Z.length===0,{page:Y,numberOfPages:Q,onPageChange:T,pageItems:de}=(0,S.W)(Z,1,w.FG);return(0,s.jsx)("div",{className:v.container,children:(0,s.jsxs)(u.B,{direction:"column",gap:3,children:[(0,s.jsx)(p.Z,{value:E,onChange:L,placeholder:(0,n.t)("alerting.alerts-folder-view.name-filter-placeholder-search-alert-rules-by-name","Search alert rules by name"),"data-testid":"name-filter"}),(0,s.jsxs)(u.B,{direction:"row",children:[(0,s.jsx)(g.l6,{value:m,onChange:({value:V})=>V&&U(V),options:ae,width:25,"aria-label":(0,n.t)("alerting.alerts-folder-view.aria-label-sort","Sort"),placeholder:(0,n.t)("alerting.alerts-folder-view.placeholder-sort-default-az","Sort (Default A-Z)"),prefix:(0,s.jsx)(h.I,{name:m==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(p.Z,{value:x,onChange:D,placeholder:(0,n.t)("alerting.alerts-folder-view.label-filter-placeholder-search-alerts-by-labels","Search alerts by labels"),className:v.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(u.B,{direction:"column",gap:1,children:de.map(({grafana_alert:V,labels:ie={}})=>(0,s.jsxs)(j.Z,{href:le(V),className:v.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(j.Z.Heading,{children:V.title}),(0,s.jsx)(j.Z.Tags,{children:(0,s.jsx)(C.L,{onClick:f,tags:Object.entries(ie).map(([ce,he])=>`${ce}=${he}`)})}),(0,s.jsx)(j.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(h.I,{name:"folder"})," ",t.title]})})]},V.uid))}),I&&(0,s.jsx)("div",{className:v.noResults,children:(0,s.jsx)(n.x6,{i18nKey:"alerting.alerts-folder-view.no-alert-rules-found",children:"No alert rules found"})}),(0,s.jsx)("div",{className:v.pagination,children:(0,s.jsx)(W.d,{currentPage:Y,numberOfPages:Q,onNavigate:T,hideWhenSinglePage:!0})})]})})};var oe=(t=>(t.nameFilter="nameFilter",t.labelFilter="labelFilter",t.sortOrder="sort",t))(oe||{});function ne(){const[t,r]=(0,H.l)(),[v,f]=(0,d.useState)(t.get("nameFilter")??""),[E,x]=(0,d.useState)(t.get("labelFilter")??""),m=t.get("sort"),L=(()=>{if(m==="alpha-asc")return"alpha-asc";if(m==="alpha-desc")return"alpha-desc"})(),[D,U]=(0,d.useState)(L);return(0,i.A)(()=>r({nameFilter:(0,F.fE)(v),labelFilter:(0,F.fE)(E),sort:(0,F.fE)(D)},!0),400,[v,E,D]),{nameFilter:v,labelFilter:E,sortOrder:D,setNameFilter:f,setLabelFilter:x,setSortOrder:U}}function re(t,r,v,f){const E=(0,_.Zc)(v),x=t.filter(m=>{const L=m.grafana_alert.title.toLowerCase().includes(r.toLowerCase()),D=(0,G.Av)(m.labels??{},E);return L&&D});return(0,M.orderBy)(x,m=>m.grafana_alert.title.toLowerCase(),[f==="alpha-asc"?"asc":"desc"])}function le(t){return ee.PP.detailsPageLink(k.hY,{uid:t.uid,ruleSourceName:k.hY},void 0)}const c=t=>({container:(0,l.css)({padding:t.spacing(1)}),card:(0,l.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,l.css)({alignSelf:"center"}),filterLabelsInput:(0,l.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,l.css)({padding:t.spacing(2),backgroundColor:t.colors.background.secondary,fontStyle:"italic"})});var R=e(70327),K=e(55143),J=e(77256),N=e(29609),$=e(18346),A=e(13756);const{useRulerNamespaceQuery:q}=R.hK;function z(){const{uid:t=""}=(0,a.g)(),{data:r,isLoading:v}=(0,$.kH)(t),{data:f={},isLoading:E,error:x}=q({rulerConfig:K.b,namespace:t}),[m]=(0,$.iB)(),L=(0,d.useMemo)(()=>{if(!r)return;const I=(0,o.R4)(r),Y=(0,o.Fk)(r.uid),Q=I.children?.find(T=>T.id===Y);return Q&&(Q.active=!0),I},[r]),D=t?async I=>{if(r){const Y=await m({...r,title:I});if("error"in Y)throw Y.error}}:void 0,U=v||E,Z=Object.values(f).flatMap(I=>I).flatMap(I=>I.rules).filter(N.p.grafana.rule);return(0,s.jsx)(y.Y,{navId:"dashboards/browse",pageNav:L,onEditTitle:D,actions:(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsx)(A.m,{folder:r})}),children:(0,s.jsxs)(y.Y.Contents,{isLoading:U,children:[!r&&(0,s.jsx)(P.F,{title:(0,n.t)("browse-dashboards.browse-folder-alerting-page.title-folder-not-found","Folder not found")}),!!x&&(0,s.jsx)(P.F,{title:(0,n.t)("browse-dashboards.browse-folder-alerting-page.title-ruler-namespace-error","Cannot load rules"),severity:"error",children:(0,J.JZ)(x)}),r&&(0,s.jsx)(te,{folder:r,rules:Z})]})})}const B=z},72472:(X,O,e)=>{e.d(O,{T:()=>u});var s=e(74848),d=e(96540),a=e(92745),n=e(27489),P=e(43173),y=e(71599),o=e(66404),l=e(35137),M=e(34999),i=e(18346),b=e(78059);const u=({onConfirm:p,onDismiss:g,selectedItems:h,...j})=>{const{data:C}=(0,i.G2)(h),W=!!(C&&(C.alertRule||C.libraryPanel)),[w,F]=(0,d.useState)(!1),S=async()=>{(0,n.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(h.dashboard).length,folder:Object.keys(h.folder).length},source:"browse_dashboards",restore_enabled:!1}),F(!0);try{await p(),F(!1),g()}catch{F(!1)}};return(0,s.jsx)(y.u,{body:(0,s.jsxs)(s.Fragment,{children:[P.$.featureToggles.restoreDashboards&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(l.$,{v:2})]}),(0,s.jsx)(o.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(b.x,{selectedItems:h}),(0,s.jsx)(l.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:W?(0,s.jsx)(M.F,{severity:"warning",title:(0,a.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,a.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:w?(0,a.t)("browse-dashboards.action.deleting","Deleting..."):(0,a.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:g,onConfirm:S,title:(0,a.t)("browse-dashboards.action.delete-modal-title","Delete"),...j,disabled:W})}},65542:(X,O,e)=>{e.d(O,{J:()=>u});var s=e(74848),d=e(96540),a=e(92745),n=e(22787),P=e(34999),y=e(66404),o=e(35137),l=e(37386),M=e(45861),i=e(91156),b=e(78059);const u=({onConfirm:p,onDismiss:g,selectedItems:h,...j})=>{const[C,W]=(0,d.useState)(),[w,F]=(0,d.useState)(!1),S=Object.keys(h.folder).filter(G=>h.folder[G]),H=async()=>{if(C!==void 0){F(!0);try{await p(C),F(!1),g()}catch{F(!1)}}};return(0,s.jsxs)(n.a,{title:(0,a.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:g,...j,children:[S.length>0&&(0,s.jsx)(P.F,{severity:"info",title:(0,a.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(y.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(b.x,{selectedItems:h}),(0,s.jsx)(o.$,{v:3}),(0,s.jsx)(l.D,{label:(0,a.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(i.d,{value:C,excludeUIDs:S,onChange:W})}),(0,s.jsxs)(n.a.ButtonRow,{children:[(0,s.jsx)(M.$n,{onClick:g,variant:"secondary",fill:"outline",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(M.$n,{disabled:C===void 0||w,onClick:H,variant:"primary",children:w?(0,a.t)("browse-dashboards.action.moving","Moving..."):(0,a.t)("browse-dashboards.action.move-button","Move")})]})]})}},13756:(X,O,e)=>{e.d(O,{m:()=>le});var s=e(74848),d=e(96540),a=e(92745),n=e(43173),P=e(27489),y=e(36490),o=e(87063),l=e(94535),M=e(88559),i=e(45861),b=e(30703),u=e(8207),p=e(17159),g=e(73427),h=e(87745),j=e(75735),C=e(18346),W=e(83485),w=e(72472),F=e(65542),S=e(49785),H=e(32899),G=e(75234),k=e(41654),_=e(31286),ee=e(33680),se=e(89314),ae=e(41769),te=e(78059),oe=e(62963);function ne({initialValues:c,parentFolder:R,repository:K,workflowOptions:J,folder:N,isGitHub:$,onDismiss:A}){const q=R?.uid||"",[z,B]=(0,ee.Qo)(),t=(0,S.mN)({defaultValues:c}),{handleSubmit:r,watch:v}=t,f=v("workflow"),E=async({repo:x,path:m,comment:L,ref:D})=>{if(!K?.name)return;const U=L||`Delete folder: ${N?.metadata?.annotations?.[j.Y_]}`,Z=f==="write"?void 0:D;z({name:x,path:`${m}/`,ref:Z,message:U})};return(0,d.useEffect)(()=>{if(B.isSuccess&&K){if(f==="branch")return;f==="write"&&((0,G.J7)().publish({type:H.r1.alertSuccess.name,payload:[(0,a.t)("browse-dashboards.delete-provisioned-folder-form.alert-folder-deleted-successfully","Folder deleted successfully")]}),R?.parentUid?window.location.href=(0,oe._0)(R.parentUid):window.location.href="/dashboards")}if(B.isError){(0,G.J7)().publish({type:H.r1.alertError.name,payload:[(0,a.t)("browse-dashboards.delete-provisioned-folder-form.api-error","Failed to delete folder"),B.error]});return}},[B,K,f,R]),(0,s.jsx)(S.Op,{...t,children:(0,s.jsx)("form",{onSubmit:r(E),children:(0,s.jsxs)(k.B,{direction:"column",gap:2,children:[(0,s.jsxs)(_.a,{paddingBottom:2,children:[(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.delete-warning",children:"This will delete this folder and all its descendants. In total, this will affect:"}),(0,s.jsx)(te.x,{selectedItems:{folder:{[q]:!0},dashboard:{},panel:{},$all:!1}})]}),(0,s.jsx)(se.x,{resourceType:"folder",isNew:!1,workflow:f,workflowOptions:J,isGitHub:$}),(0,s.jsxs)(k.B,{gap:2,children:[(0,s.jsx)(i.$n,{type:"submit",disabled:B.isLoading,variant:"destructive",children:B.isLoading?(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-deleting","Deleting..."):(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-delete","Delete")}),(0,s.jsx)(i.$n,{variant:"secondary",fill:"outline",onClick:A,children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.button-cancel",children:"Cancel"})})]})]})})})}function re({parentFolder:c,onDismiss:R}){const{workflowOptions:K,isGitHub:J,repository:N,folder:$,initialValues:A}=(0,ae.Y)({folderUid:c?.uid,action:"delete",title:c?.title});return A?(0,s.jsx)(ne,{parentFolder:c,onDismiss:R,initialValues:A,repository:N,workflowOptions:K,folder:$,isGitHub:J}):null}function le({folder:c}){const[R,K]=(0,d.useState)(!1),[J,N]=(0,d.useState)(!1),[$,A]=(0,d.useState)(!1),[q]=(0,C.aF)(),[z]=(0,C.Ko)(),{canEditFolders:B,canDeleteFolders:t,canViewPermissions:r,canSetPermissions:v}=(0,W.N)(c),f=c.managedBy===j.Sf.Repo,E=n.$.featureToggles.nestedFolders&&B&&!f,x=async T=>{await q({folder:c,destinationUID:T}),(0,P.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},m=async()=>{await z(c),(0,P.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:T}=c,de=T&&T.length?T[T.length-1].url:"/dashboards";y.Ny.push(de)},L=()=>{g.lE.publish(new h.S8({component:F.J,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:x}}))},D=()=>{g.lE.publish(new h.S8({component:w.T,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:m}}))},U=()=>{A(!0)},Z=(0,a.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),I=(0,a.t)("browse-dashboards.folder-actions-button.move","Move"),Y=(0,a.t)("browse-dashboards.folder-actions-button.delete","Delete"),Q=(0,s.jsxs)(o.W,{children:[r&&(0,s.jsx)(l.D,{onClick:()=>N(!0),label:Z}),E&&(0,s.jsx)(l.D,{onClick:L,label:I}),t&&!f&&(0,s.jsx)(l.D,{destructive:!0,onClick:f?U:D,label:Y})]});return!r&&!E&&!t?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.m,{overlay:Q,onVisibleChange:K,children:(0,s.jsxs)(i.$n,{variant:"secondary",children:[(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(b.I,{name:R?"angle-up":"angle-down"})]})}),J&&(0,s.jsx)(u._,{title:(0,a.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:c.title,onClose:()=>N(!1),size:"md",children:(0,s.jsx)(p.x,{resource:"folders",resourceId:c.uid,canSetPermissions:v})}),$&&(0,s.jsx)(u._,{title:(0,a.t)("browse-dashboards.action.delete-provisioned-folder","Delete provisioned folder"),subtitle:c.title,onClose:()=>A(!1),children:(0,s.jsx)(re,{parentFolder:c,onDismiss:()=>A(!1)})})]})}},41769:(X,O,e)=>{e.d(O,{Y:()=>y});var s=e(96540),d=e(75735),a=e(99454),n=e(57512),P=e(55266);function y({folderUid:o,action:l,title:M}){const{repository:i,folder:b,isLoading:u}=(0,P.T)({folderName:o}),p=(0,a.a)(i),g=i?.type==="github",h=(0,n.g)(),j=(0,s.useMemo)(()=>{if(!(!i||u))return{title:M||"",comment:"",ref:`folder/${h}`,repo:i.name||"",path:b?.metadata?.annotations?.[d.Y_]||"",workflow:(0,a.r)(i)}},[i,b,M,u,h]);return{repository:i,folder:b,workflowOptions:p,isGitHub:g,initialValues:j}}},83485:(X,O,e)=>{e.d(O,{N:()=>y});var s=e(43173),d=e(73427),a=e(11257);function n(o,l){return l?d.TP.hasPermissionInMetadata(o,l):d.TP.hasPermission(o)}function P(o){return o&&o.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:n(a.w.FoldersCreate,o)}function y(o){const l=n(a.w.DashboardsCreate,o),M=P(o),i=n(a.w.FoldersDelete,o),b=n(a.w.DashboardsWrite,o),u=n(a.w.FoldersWrite,o),p=n(a.w.FoldersPermissionsWrite,o),g=n(a.w.FoldersPermissionsRead,o);return{canCreateDashboards:l,canCreateFolders:M,canDeleteFolders:i,canEditDashboards:b,canEditFolders:u,canSetPermissions:p,canViewPermissions:g}}}}]);

//# sourceMappingURL=FolderAlerting.3eb9df16195963f4db8b.js.map