"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{95576:(I,O,e)=>{e.r(O),e.d(O,{BrowseFolderLibraryPanelsPage:()=>t,default:()=>D});var s=e(74848),c=e(96540),a=e(54148),n=e(13791),g=e(13756),d=e(66198),o=e(24438),h=e(94708),f=e(18346);function t(){const{uid:m=""}=(0,a.g)(),{data:i}=(0,f.kH)(m),[r,l]=(0,c.useState)(void 0),[M]=(0,f.iB)(),P=(0,c.useMemo)(()=>{if(!i)return;const E=(0,d.R4)(i),v=(0,d.pq)(i.uid),b=E.children?.find(x=>x.id===v);return b&&(b.active=!0),E},[i]),_=m?async E=>{if(i){const v=await M({...i,title:E});if("error"in v)throw v.error}}:void 0;return(0,s.jsx)(n.Y,{navId:"dashboards/browse",pageNav:P,onEditTitle:_,actions:(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsx)(g.m,{folder:i})}),children:(0,s.jsxs)(n.Y.Contents,{children:[(0,s.jsx)(o.j,{onClick:l,currentFolderUID:m,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),r?(0,s.jsx)(h.F,{onDismiss:()=>l(void 0),libraryPanel:r}):null]})})}const D=t},72472:(I,O,e)=>{e.d(O,{T:()=>m});var s=e(74848),c=e(96540),a=e(92745),n=e(27489),g=e(43173),d=e(71599),o=e(66404),h=e(35137),f=e(34999),t=e(18346),D=e(78059);const m=({onConfirm:i,onDismiss:r,selectedItems:l,...M})=>{const{data:P}=(0,t.G2)(l),_=!!(P&&(P.alertRule||P.libraryPanel)),[E,v]=(0,c.useState)(!1),b=async()=>{(0,n.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(l.dashboard).length,folder:Object.keys(l.folder).length},source:"browse_dashboards",restore_enabled:!1}),v(!0);try{await i(),v(!1),r()}catch{v(!1)}};return(0,s.jsx)(d.u,{body:(0,s.jsxs)(s.Fragment,{children:[g.$.featureToggles.restoreDashboards&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(h.$,{v:2})]}),(0,s.jsx)(o.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(D.x,{selectedItems:l}),(0,s.jsx)(h.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:_?(0,s.jsx)(f.F,{severity:"warning",title:(0,a.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,a.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:E?(0,a.t)("browse-dashboards.action.deleting","Deleting..."):(0,a.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:r,onConfirm:b,title:(0,a.t)("browse-dashboards.action.delete-modal-title","Delete"),...M,disabled:_})}},65542:(I,O,e)=>{e.d(O,{J:()=>m});var s=e(74848),c=e(96540),a=e(92745),n=e(22787),g=e(34999),d=e(66404),o=e(35137),h=e(37386),f=e(45861),t=e(91156),D=e(78059);const m=({onConfirm:i,onDismiss:r,selectedItems:l,...M})=>{const[P,_]=(0,c.useState)(),[E,v]=(0,c.useState)(!1),b=Object.keys(l.folder).filter(B=>l.folder[B]),x=async()=>{if(P!==void 0){v(!0);try{await i(P),v(!1),r()}catch{v(!1)}}};return(0,s.jsxs)(n.a,{title:(0,a.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:r,...M,children:[b.length>0&&(0,s.jsx)(g.F,{severity:"info",title:(0,a.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(d.E,{element:"p",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(D.x,{selectedItems:l}),(0,s.jsx)(o.$,{v:3}),(0,s.jsx)(h.D,{label:(0,a.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(t.d,{value:P,excludeUIDs:b,onChange:_})}),(0,s.jsxs)(n.a.ButtonRow,{children:[(0,s.jsx)(f.$n,{onClick:r,variant:"secondary",fill:"outline",children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(f.$n,{disabled:P===void 0||E,onClick:x,variant:"primary",children:E?(0,a.t)("browse-dashboards.action.moving","Moving..."):(0,a.t)("browse-dashboards.action.move-button","Move")})]})]})}},13756:(I,O,e)=>{e.d(O,{m:()=>oe});var s=e(74848),c=e(96540),a=e(92745),n=e(43173),g=e(27489),d=e(36490),o=e(87063),h=e(94535),f=e(88559),t=e(45861),D=e(30703),m=e(8207),i=e(17159),r=e(73427),l=e(87745),M=e(75735),P=e(18346),_=e(83485),E=e(72472),v=e(65542),b=e(49785),x=e(32899),B=e(75234),F=e(41654),R=e(31286),$=e(33680),Z=e(89314),k=e(41769),q=e(78059),ee=e(62963);function se({initialValues:u,parentFolder:y,repository:L,workflowOptions:A,folder:T,isGitHub:U,onDismiss:j}){const V=y?.uid||"",[N,p]=(0,$.Qo)(),W=(0,b.mN)({defaultValues:u}),{handleSubmit:w,watch:Y}=W,C=Y("workflow"),S=async({repo:G,path:H,comment:J,ref:z})=>{if(!L?.name)return;const Q=J||`Delete folder: ${T?.metadata?.annotations?.[M.Y_]}`,X=C==="write"?void 0:z;N({name:G,path:`${H}/`,ref:X,message:Q})};return(0,c.useEffect)(()=>{if(p.isSuccess&&L){if(C==="branch")return;C==="write"&&((0,B.J7)().publish({type:x.r1.alertSuccess.name,payload:[(0,a.t)("browse-dashboards.delete-provisioned-folder-form.alert-folder-deleted-successfully","Folder deleted successfully")]}),y?.parentUid?window.location.href=(0,ee._0)(y.parentUid):window.location.href="/dashboards")}if(p.isError){(0,B.J7)().publish({type:x.r1.alertError.name,payload:[(0,a.t)("browse-dashboards.delete-provisioned-folder-form.api-error","Failed to delete folder"),p.error]});return}},[p,L,C,y]),(0,s.jsx)(b.Op,{...W,children:(0,s.jsx)("form",{onSubmit:w(S),children:(0,s.jsxs)(F.B,{direction:"column",gap:2,children:[(0,s.jsxs)(R.a,{paddingBottom:2,children:[(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.delete-warning",children:"This will delete this folder and all its descendants. In total, this will affect:"}),(0,s.jsx)(q.x,{selectedItems:{folder:{[V]:!0},dashboard:{},panel:{},$all:!1}})]}),(0,s.jsx)(Z.x,{resourceType:"folder",isNew:!1,workflow:C,workflowOptions:A,isGitHub:U}),(0,s.jsxs)(F.B,{gap:2,children:[(0,s.jsx)(t.$n,{type:"submit",disabled:p.isLoading,variant:"destructive",children:p.isLoading?(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-deleting","Deleting..."):(0,a.t)("browse-dashboards.delete-provisioned-folder-form.button-delete","Delete")}),(0,s.jsx)(t.$n,{variant:"secondary",fill:"outline",onClick:j,children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.delete-provisioned-folder-form.button-cancel",children:"Cancel"})})]})]})})})}function ae({parentFolder:u,onDismiss:y}){const{workflowOptions:L,isGitHub:A,repository:T,folder:U,initialValues:j}=(0,k.Y)({folderUid:u?.uid,action:"delete",title:u?.title});return j?(0,s.jsx)(se,{parentFolder:u,onDismiss:y,initialValues:j,repository:T,workflowOptions:L,folder:U,isGitHub:A}):null}function oe({folder:u}){const[y,L]=(0,c.useState)(!1),[A,T]=(0,c.useState)(!1),[U,j]=(0,c.useState)(!1),[V]=(0,P.aF)(),[N]=(0,P.Ko)(),{canEditFolders:p,canDeleteFolders:W,canViewPermissions:w,canSetPermissions:Y}=(0,_.N)(u),C=u.managedBy===M.Sf.Repo,S=n.$.featureToggles.nestedFolders&&p&&!C,G=async K=>{await V({folder:u,destinationUID:K}),(0,g.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},H=async()=>{await N(u),(0,g.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:K}=u,le=K&&K.length?K[K.length-1].url:"/dashboards";d.Ny.push(le)},J=()=>{r.lE.publish(new l.S8({component:v.J,props:{selectedItems:{folder:{[u.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:G}}))},z=()=>{r.lE.publish(new l.S8({component:E.T,props:{selectedItems:{folder:{[u.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:H}}))},Q=()=>{j(!0)},X=(0,a.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),ne=(0,a.t)("browse-dashboards.folder-actions-button.move","Move"),te=(0,a.t)("browse-dashboards.folder-actions-button.delete","Delete"),re=(0,s.jsxs)(o.W,{children:[w&&(0,s.jsx)(h.D,{onClick:()=>T(!0),label:X}),S&&(0,s.jsx)(h.D,{onClick:J,label:ne}),W&&!C&&(0,s.jsx)(h.D,{destructive:!0,onClick:C?Q:z,label:te})]});return!w&&!S&&!W?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.m,{overlay:re,onVisibleChange:L,children:(0,s.jsxs)(t.$n,{variant:"secondary",children:[(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(D.I,{name:y?"angle-up":"angle-down"})]})}),A&&(0,s.jsx)(m._,{title:(0,a.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:u.title,onClose:()=>T(!1),size:"md",children:(0,s.jsx)(i.x,{resource:"folders",resourceId:u.uid,canSetPermissions:Y})}),U&&(0,s.jsx)(m._,{title:(0,a.t)("browse-dashboards.action.delete-provisioned-folder","Delete provisioned folder"),subtitle:u.title,onClose:()=>j(!1),children:(0,s.jsx)(ae,{parentFolder:u,onDismiss:()=>j(!1)})})]})}},41769:(I,O,e)=>{e.d(O,{Y:()=>d});var s=e(96540),c=e(75735),a=e(99454),n=e(57512),g=e(55266);function d({folderUid:o,action:h,title:f}){const{repository:t,folder:D,isLoading:m}=(0,g.T)({folderName:o}),i=(0,a.a)(t),r=t?.type==="github",l=(0,n.g)(),M=(0,s.useMemo)(()=>{if(!(!t||m))return{title:f||"",comment:"",ref:`folder/${l}`,repo:t.name||"",path:D?.metadata?.annotations?.[c.Y_]||"",workflow:(0,a.r)(t)}},[t,D,f,m,l]);return{repository:t,folder:D,workflowOptions:i,isGitHub:r,initialValues:M}}},83485:(I,O,e)=>{e.d(O,{N:()=>d});var s=e(43173),c=e(73427),a=e(11257);function n(o,h){return h?c.TP.hasPermissionInMetadata(o,h):c.TP.hasPermission(o)}function g(o){return o&&o.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:n(a.w.FoldersCreate,o)}function d(o){const h=n(a.w.DashboardsCreate,o),f=g(o),t=n(a.w.FoldersDelete,o),D=n(a.w.DashboardsWrite,o),m=n(a.w.FoldersWrite,o),i=n(a.w.FoldersPermissionsWrite,o),r=n(a.w.FoldersPermissionsRead,o);return{canCreateDashboards:h,canCreateFolders:f,canDeleteFolders:t,canEditDashboards:D,canEditFolders:m,canSetPermissions:i,canViewPermissions:r}}},94708:(I,O,e)=>{e.d(O,{F:()=>m});var s=e(74848),c=e(76459),a=e.n(c),n=e(96540),g=e(83175),d=e(92745),o=e(36490),h=e(22787),f=e(18857),t=e(45861),D=e(30124);function m({libraryPanel:r,onDismiss:l}){const[M,P]=(0,n.useState)(!1),[_,E]=(0,n.useState)(0),[v,b]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{(async()=>{const $=await(0,D.GN)(r.uid);E($.length)})()},[r.uid]);const x=(0,n.useCallback)(R=>i(r.uid,R,P),[r.uid]),B=(0,n.useMemo)(()=>a()(x,300,{leading:!0}),[x]),F=R=>{R.preventDefault(),o.Ny.push(g.kM.renderUrl(`/d/${v?.value?.uid}`,{}))};return(0,s.jsxs)(h.a,{title:(0,d.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:l,onClickBackdrop:l,isOpen:!0,children:[(0,s.jsxs)("div",{children:[_===0?(0,s.jsx)("span",{children:(0,s.jsx)(d.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,_>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:(0,s.jsxs)(d.x6,{i18nKey:"library-panels.modal.body",count:_,children:["This panel is being used in ",{count:_}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,s.jsx)(f.DW,{isClearable:!0,isLoading:M,defaultOptions:!0,loadOptions:B,onChange:b,placeholder:(0,d.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,d.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,s.jsxs)(h.a.ButtonRow,{children:[(0,s.jsx)(t.$n,{variant:"secondary",onClick:l,fill:"outline",children:(0,s.jsx)(d.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,s.jsx)(t.$n,{onClick:F,disabled:!v,children:v?(0,d.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:v?.label}):(0,d.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function i(r,l,M){M(!0);const _=(await(0,D.xV)(r)).filter(E=>E.title.toLowerCase().includes(l.toLowerCase())).map(E=>({label:E.title,value:E}));return M(!1),_}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.f422cca9e4005e280245.js.map