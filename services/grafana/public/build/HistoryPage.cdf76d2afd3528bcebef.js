"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[44],{12266:(oe,B,a)=>{a.d(B,{e:()=>W});var t=a(74848),z=a(45861);const W=({isCollapsed:m,onToggle:j,idControlled:O,className:u,text:c,size:b="xl",...R})=>(0,t.jsx)(z.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!m,"aria-controls":O,className:u,icon:m?"angle-right":"angle-down",onClick:()=>j(!m),...R,children:c})},56102:(oe,B,a)=>{a.r(B),a.d(B,{default:()=>ft});var t=a(74848),z=a(88547),W=a(36826),m=a(22803),j=a(96540),O=a(7389),u=a(92745),c=a(36674),b=a(739),R=a(45967),le=a(45861),S=a(63142),p=a(66404),H=a(30703),L=a(74268),ce=a(2863),de=a(75421),ue=a(8535),G=a(59614),ge=a(54148),me=a(49185),X=a(34999),he=a(47327),T=a(41654),ye=a(34213),fe=a(36303),C=a(24619),xe=a(74048),V=a(86017),ve=a(52161),pe=a(92367),je=a(7840),Te=a(12266),D=a(2543),Fe=a(44109),J=a(63895),be=a(94646),Se=a(1625),Ce=a(45746),Ee=a(88215),Re=a(54302),N=a(93571),Ne=a(68143),Ie=a(1506),Le=a(77256);function k({error:e}){if((0,Ne.NF)(e)&&e.status===404)return(0,t.jsx)(Ie.L,{entity:"History"});const n=(0,u.t)("alerting.central-alert-history.error","Something went wrong loading the alert state history"),s=(0,Le.JZ)(e);return(0,t.jsx)(X.F,{title:n,children:s})}var I=a(95004),Ae=a(18600),Pe=a(33553),we=a(11576),q=a(92446);const _=10*1e3,Q="var-",$e={stateTo:"all",stateFrom:"all",labels:""};function Be({data:e},n=$e){const{stateTo:s,stateFrom:r}=n,[i=[],d=[]]=e?.values??[],l=((0,N.bF)(i)?i:[]).reduce((h,f,F)=>{const v=d[F];if(!(0,N.PA)(v))return h;const E=(0,C.lh)(v.current),$=(0,C.lh)(v.previous),Z=s!==x.all?s===E:!0,Y=r!==x.all?r===$:!0;return Z&&Y&&h.push({timestamp:f,line:v}),h},[]),g=(0,D.groupBy)(l,h=>JSON.stringify(h.line.labels)),y=Object.entries(g).map(([h,f])=>He(h,f));return Oe(y,n)}function vt(){return new URLSearchParams(window.location.search).get(`${Q}${LABELS_FILTER}`)??""}function pt(){return new URLSearchParams(window.location.search).get(`${Q}${STATE_FILTER_TO}`)??StateFilterValues.all}function jt(){return new URLSearchParams(window.location.search).get(`${Q}${STATE_FILTER_FROM}`)??StateFilterValues.all}function Oe(e,n){const s=n.labels,i=e.filter(g=>{const y=JSON.parse(g.name??""),h=s?(0,J.Zc)(s):[];return(0,V.Av)(y,h)}).flatMap(g=>g.fields.find(y=>y.name==="time")),d=(0,D.groupBy)(i?.flatMap(g=>g?.values),g=>Math.floor(g/_)*_),o={name:"time",type:I.PU.time,values:Object.keys(d).map(Number),config:{displayName:"Time",custom:{fillOpacity:100}}},l={name:"value",type:I.PU.number,values:Object.values(d).map(g=>g.length),config:{}};return[{fields:[o,l],length:o.values.length}]}function He(e,n){const s={name:"time",type:I.PU.time,values:[...n.map(d=>d.timestamp)],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((d,o)=>o);return r.sort((0,q.i)(s)),{fields:[{...s,values:s.values.map((d,o)=>s.values[r[o]])},{name:e,type:I.PU.number,values:s.values.map(d=>1),config:{}}],length:s.values.length,name:e}}function Ve(e,n){const s={name:"time",type:I.PU.time,values:[...e.map(o=>o.timestamp),Date.now()],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((o,l)=>l);r.sort((0,q.i)(s));const i=[...e.map(o=>o.line.current),e.at(-1)?.line.current],d={fields:[{...s,values:s.values.map((o,l)=>s.values[r[l]])},{name:"State",type:I.PU.string,values:i.map((o,l)=>i[r[l]]),config:{displayName:"State",color:{mode:"thresholds"},custom:{fillOpacity:100},mappings:[{type:Ae.d.ValueToText,options:{Alerting:{color:n.colors.error.main},Pending:{color:n.colors.warning.main},Recovering:{color:n.colors.warning.main},Normal:{color:n.colors.success.main},NoData:{color:n.colors.info.main}}}],thresholds:{mode:Pe.O.Absolute,steps:[]}}}],length:s.values.length,name:""};return d.fields.forEach(o=>{o.display=(0,we.J)({field:o,theme:n})}),d}function De({record:e,addFilter:n,timeRange:s}){(0,j.useEffect)(()=>{(0,L.iW)()},[]);const r=e.line?.ruleUID??"",i=e.line?.labels,d=(0,j.useMemo)(()=>(0,be.qg)(r,!0),[r]),{error:o,loading:l,result:g}=(0,Fe.ZU)({ruleIdentifier:d,limitAlerts:0});return o?(0,t.jsx)(p.E,{children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.error",children:"Error loading rule for this event."})}):l?(0,t.jsx)(p.E,{children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})}):g?(0,t.jsxs)(T.B,{direction:"column",gap:.5,children:[(0,t.jsxs)(T.B,{direction:"row",gap:6,children:[(0,t.jsx)(Ke,{record:e,addFilter:n}),(0,t.jsx)(We,{record:e})]}),(0,t.jsx)(ze,{rule:g}),(0,t.jsx)(Ue,{ruleUID:r,timeRange:s,labels:i??{}})]}):(0,t.jsx)(p.E,{children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.not-found",children:"Rule not found for this event."})})}function Me(e,n){const s=(0,S.$j)();return(0,j.useMemo)(()=>{const r=n?.data?.values[0]??[],i=(0,N.bF)(r)?r:[],d=n?.data?.values[1]??[],o=i.reduce((f,F,v)=>{const E=d[v];return(0,N.PA)(E)&&f.push({timestamp:F,line:E}),f},[]),l=(0,D.groupBy)(o,f=>JSON.stringify(f.line.labels)),g=(0,J.Zc)(e),y=Object.entries(l).filter(([f])=>{const F=JSON.parse(f);return(0,V.Av)(F,g)});return{dataFrames:Object.values(y).map(f=>Ve(f[1],s))}},[n,e,s])}function Ue({ruleUID:e,timeRange:n,labels:s}){const{useGetRuleHistoryQuery:r}=G.U,{currentData:i,isLoading:d,isError:o,error:l}=r({ruleUid:e,from:n.from.unix(),to:n.to.unix(),limit:M},{refetchOnFocus:!0,refetchOnReconnect:!0}),{dataFrames:g}=Me(s?Object.entries(s).map(([F,v])=>`${F}=${v}`).join(","):"",i),{frameSubset:y,frameTimeRange:h}=(0,Re.useFrameSubset)(g);if(d)return(0,t.jsx)("div",{children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})});if(o)return(0,t.jsx)(k,{error:l});if(!y||y.length===0)return null;const f=g[0]?.fields[0]?.values?.length-1||0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ge,{transitions:e?f:0}),(0,t.jsx)(Ee.A,{frames:y,timeRange:h})]})}function Ke({record:e,addFilter:n}){return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(p.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state-transitions",children:"State transition"})}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(U,{state:e.line.previous,showLabel:!0,addFilter:n,type:"from"}),(0,t.jsx)(H.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(U,{state:e.line.current,showLabel:!0,addFilter:n,type:"to"})]})]})}const ze=({rule:e})=>{const n=(0,S.of)(ee),s=e.annotations;return!s||Object.keys(s).length===0?null:(0,t.jsx)("div",{className:n.metadataWrapper,children:Object.entries(s).map(([r,i])=>{const d=(0,D.capitalize)(r);return(0,t.jsxs)(Se.P,{direction:"column",children:[d,(0,t.jsx)(Ce.$,{value:i})]},d)})})};function We({record:e}){const n=e?.line?.values?JSON.stringify(e.line.values):(0,u.t)("alerting.central-alert-history.details.no-values","No values");return(0,t.jsxs)(T.B,{gap:.5,direction:"column",children:[(0,t.jsx)(p.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.value-in-transition",children:"Value in transition"})}),(0,t.jsx)(T.B,{gap:.5,direction:"row",alignItems:"center",children:(0,t.jsx)(p.E,{variant:"body",weight:"light",children:n})})]})}function Ge({transitions:e}){const n=(0,S.of)(ee);return(0,t.jsxs)("div",{className:n.transitionsNumber,children:[(0,t.jsx)(p.E,{variant:"body",weight:"bold",color:"secondary",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.number-transitions",children:"State transitions for selected period:"})}),(0,t.jsx)(p.E,{variant:"body",weight:"light",children:e})]})}const ee=e=>({metadataWrapper:(0,m.css)({display:"grid",gridTemplateColumns:"auto auto",rowGap:e.spacing(3),columnGap:e.spacing(12)}),transitionsNumber:(0,m.css)({display:"flex",flexDirection:"row",gap:e.spacing(.5),alignItems:"center",marginTop:e.spacing(1.5)})}),te={labels:"",stateFrom:"all",stateTo:"all"};function Je(e,n=te){return(0,j.useMemo)(()=>Qe(e,n),[n,e])}function Qe(e,n=te){const{labels:s,stateFrom:r,stateTo:i}=n;if(!e?.data)return{historyRecords:[]};const d=s?(0,J.Zc)(s):[],[o,l]=e.data.values;return{historyRecords:((0,N.bF)(o)?o:[]).reduce((h,f,F)=>{const v=l[F];if(!(0,N.PA)(v))return h;const E=v.labels&&(0,V.Av)(v.labels,d),$=(0,C.lh)(v.current),Z=(0,C.lh)(v.previous),Y=i!==x.all?i===$:!0,xt=r!==x.all?r===Z:!0;return E&&Y&&xt&&h.push({timestamp:f,line:v}),h},[])}}const M=5e3,Ze=100,ne=({timeRange:e,valueInLabelFilter:n,valueInStateToFilter:s,valueInStateFromFilter:r,addFilter:i})=>{const d=e?.from.unix(),o=e?.to.unix(),{data:l,isLoading:g,isError:y,error:h}=G.U.endpoints.getRuleHistory.useQuery({from:d,to:o,limit:M}),{historyRecords:f}=Je(l,{labels:n.toString(),stateFrom:r.toString(),stateTo:s.toString()}),F=f.sort((E,$)=>$.timestamp-E.timestamp);if(y)return(0,t.jsx)(k,{error:h});const v=!g&&l?.data?.values?.[0]?.length===M;return v&&(0,L.Hs)({from:d,to:o}),(0,t.jsxs)(t.Fragment,{children:[v&&(0,t.jsx)(X.F,{severity:"warning",title:(0,u.t)("alerting.central-alert-history.too-many-events.title","Unable to display all events"),children:(0,u.t)("alerting.central-alert-history.too-many-events.text","The selected time period has too many events to display. Diplaying the latest 5000 events. Try using a shorter time period.")}),(0,t.jsx)(Ye,{visible:g}),(0,t.jsx)(Xe,{logRecords:F,addFilter:i,timeRange:e})]})},Ye=({visible:e=!1})=>{const[n,{width:s}]=(0,me.A)();return(0,t.jsx)("div",{ref:n,children:e&&(0,t.jsx)(he.G,{width:s,"data-testid":"loading-bar"})})};function Xe({logRecords:e,addFilter:n,timeRange:s}){const{page:r,pageItems:i,numberOfPages:d,onPageChange:o}=(0,xe.W)(e,1,Ze);return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsx)(ke,{}),(0,t.jsx)("ul",{children:i.map(l=>(0,t.jsx)(qe,{record:l,addFilter:n,timeRange:s},l.timestamp+(l.line.fingerprint??"")))}),(0,t.jsx)(ye.d,{currentPage:r,numberOfPages:d,onNavigate:o,hideWhenSinglePage:!0})]})}function ke(){const e=(0,S.of)(K);return(0,t.jsx)("div",{className:e.headerWrapper,children:(0,t.jsxs)("div",{className:e.mainHeader,children:[(0,t.jsx)("div",{className:e.timeCol,children:(0,t.jsx)(p.E,{variant:"body",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.header.timestamp",children:"Timestamp"})})}),(0,t.jsx)("div",{className:e.transitionCol,children:(0,t.jsx)(p.E,{variant:"body",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.header.state",children:"State"})})}),(0,t.jsx)("div",{className:e.alertNameCol,children:(0,t.jsx)(p.E,{variant:"body",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.header.alert-rule",children:"Alert rule"})})}),(0,t.jsx)("div",{className:e.labelsCol,children:(0,t.jsx)(p.E,{variant:"body",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.header.instance",children:"Instance"})})})]})})}function qe({record:e,addFilter:n,timeRange:s}){const r=(0,S.of)(K),[i,d]=(0,j.useState)(!0);function o(l,g){n(l,g,"label")}return(0,t.jsxs)(T.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:(0,m.cx)(r.header,i?r.collapsedHeader:r.notCollapsedHeader),"data-testid":"event-row-header",children:[(0,t.jsx)(Te.e,{size:"sm",className:r.collapseToggle,isCollapsed:i,onToggle:d}),(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:r.timeCol,children:(0,t.jsx)(tt,{time:e.timestamp})}),(0,t.jsx)("div",{className:r.transitionCol,children:(0,t.jsx)(et,{previous:e.line.previous,current:e.line.current,addFilter:n})}),(0,t.jsx)("div",{className:r.alertNameCol,children:e.line.labels?(0,t.jsx)(_e,{labels:e.line.labels,ruleUID:e.line.ruleUID}):null}),(0,t.jsx)("div",{className:r.labelsCol,children:(0,t.jsx)(je.m,{labels:e.line.labels??{},size:"xs",onClick:o})})]})]}),!i&&(0,t.jsx)("div",{className:r.expandedRow,children:(0,t.jsx)(De,{record:e,addFilter:n,timeRange:s})})]})}function _e({labels:e,ruleUID:n}){const s=(0,S.of)(K),{pathname:r,search:i}=(0,ge.zy)(),d=`${r}${i}`,o=e.alertname;if(!n)return(0,t.jsx)(p.E,{children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.unknown-rule",children:"Unknown"})});const l=(0,pe.G)(`/alerting/${ve.hY}/${n}/view`,{tab:"history",returnTo:d});return(0,t.jsx)(R.m,{content:o??"",children:(0,t.jsx)("a",{href:l,className:s.alertName,children:o})})}function et({previous:e,current:n,addFilter:s}){return(0,t.jsxs)(T.B,{gap:.5,direction:"row",children:[(0,t.jsx)(U,{state:e,addFilter:s,type:"from"}),(0,t.jsx)(H.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(U,{state:n,addFilter:s,type:"to"})]})}const se=({iconName:e,iconColor:n,tooltipContent:s,labelText:r,showLabel:i})=>(0,t.jsx)(R.m,{content:s,placement:"top",children:(0,t.jsxs)(T.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(H.I,{name:e,size:"md",className:n}),i&&(0,t.jsx)(p.E,{variant:"body",weight:"light",children:r})]})});function U({state:e,showLabel:n=!1,addFilter:s,type:r}){const i=(0,S.of)(K),d=(0,u.t)("alerting.central-alert-history.details.no-recognized-state","No recognized state");if(!(0,C.s1)(e)&&!(0,C.qr)(e))return(0,t.jsx)(se,{iconName:"exclamation-triangle",tooltipContent:d,labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.unknown-event-state",children:"Unknown"}),showLabel:n,iconColor:i.warningColor});const o=(0,C.lh)(e),l=(0,C.$k)(e),g={Normal:{iconName:"check-circle",iconColor:l?i.warningColor:i.normalColor,tooltipContent:l?`Normal (${l})`:"Normal",labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.normal",children:"Normal"})},Alerting:{iconName:"exclamation-circle",iconColor:i.alertingColor,tooltipContent:"Alerting",labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.alerting",children:"Alerting"})},NoData:{iconName:"exclamation-triangle",iconColor:i.warningColor,tooltipContent:"Insufficient data",labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.no-data",children:"No data"})},Error:{iconName:"exclamation-circle",tooltipContent:"Error",iconColor:i.warningColor,labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.error",children:"Error"})},Pending:{iconName:"circle",iconColor:i.warningColor,tooltipContent:l?`Pending (${l})`:"Pending",labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.pending",children:"Pending"})},Recovering:{iconName:"circle",iconColor:i.warningColor,tooltipContent:l?`Recovering (${l})`:"Recovering",labelText:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.details.state.recovering",children:"Recovering"})}};function y(){s("state",o,r==="from"?"stateFrom":"stateTo")}const h=g[o]||{iconName:"exclamation-triangle",tooltipContent:"Unknown State"};return(0,t.jsx)("div",{onClick:y,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&y()},className:i.state,role:"button",tabIndex:0,children:(0,t.jsx)(se,{...h,showLabel:n})})}const tt=({time:e})=>{const s=new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return(0,t.jsx)(p.E,{variant:"body",weight:"light",children:s})},Tt=(0,fe.Xc)(ne,{style:"page"}),K=e=>({header:(0,m.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,flexWrap:"nowrap","&:hover":{backgroundColor:e.components.table.rowHoverBackground}}),collapsedHeader:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),notCollapsedHeader:(0,m.css)({borderBottom:"none"}),collapseToggle:(0,m.css)({background:"none",border:"none",marginTop:`-${e.spacing(1)}`,marginBottom:`-${e.spacing(1)}`,svg:{marginBottom:0}}),normalColor:(0,m.css)({fill:e.colors.success.text}),warningColor:(0,m.css)({fill:e.colors.warning.text}),alertingColor:(0,m.css)({fill:e.colors.error.text}),timeCol:(0,m.css)({width:"150px"}),transitionCol:(0,m.css)({width:"80px"}),alertNameCol:(0,m.css)({width:"300px"}),labelsCol:(0,m.css)({display:"flex",overflow:"hidden",alignItems:"center",paddingRight:e.spacing(2),flex:1}),alertName:(0,m.css)({whiteSpace:"nowrap",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",display:"block",color:e.colors.text.link}),expandedRow:(0,m.css)({padding:e.spacing(2),marginLeft:e.spacing(2),borderLeft:`1px solid ${e.colors.border.weak}`}),colorIcon:(0,m.css)({color:e.colors.primary.text,"&:hover":{opacity:.8}}),state:(0,m.css)({"&:hover":{opacity:.8,cursor:"pointer"}}),headerWrapper:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),mainHeader:(0,m.css)({display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"nowrap",marginLeft:"30px",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,gap:e.spacing(.5)})});class nt extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[A,w,P]})}static{this.Component=st}}function st({model:e}){e.useState();const{value:n}=c.jh.getTimeRange(e).useState(),s=c.jh.lookupVariable(A,e),r=c.jh.lookupVariable(P,e),i=c.jh.lookupVariable(w,e),d=(o,l,g)=>{const y=`${o}=${l}`;if((0,L.P6)({type:g,key:o,value:l}),g==="stateTo"&&r instanceof c.yP&&r.changeValueTo(l),g==="stateFrom"&&i instanceof c.yP&&i.changeValueTo(l),g==="label"&&s instanceof c.TS){const h=(0,V.EU)(s.state.value.toString(),y);s.setValue(h)}};return r instanceof c.yP&&i instanceof c.yP&&s instanceof c.TS?(0,t.jsx)(ne,{timeRange:n,valueInLabelFilter:s.state.value,addFilter:d,valueInStateToFilter:r.state.value,valueInStateFromFilter:i.state.value}):null}const ae="__history_api_ds_uid__",re="__history_api_ds_pluginId__",at={type:re,uid:ae,settings:void 0};function rt(){const e=(0,j.useMemo)(()=>new it(ae,re),[]);(0,j.useEffect)(()=>{try{c.Go.registerRuntimeDataSource({dataSource:e})}catch{}},[e])}class it extends c.UU{constructor(n,s){super(s,n)}async query(n){const s=n.range.from.unix(),r=n.range.to.unix(),i=n.targets[0],d=(0,ce.w)(),o=d.replace(i.labels??"",n.scopedVars),l=d.replace(i.stateTo??"",n.scopedVars),g=d.replace(i.stateFrom??"",n.scopedVars),y=await ot(s,r);return{data:Be(y,{stateTo:l,stateFrom:g,labels:o})}}testDatasource(){return Promise.resolve({status:"success",message:(0,u.t)("alerting.history-apidatasource.message.data-source-is-working","Data source is working"),title:(0,u.t)("alerting.history-apidatasource.title.success","Success")})}}const ot=(e,n)=>(0,ue.JD)(G.U.endpoints.getRuleHistory.initiate({from:e,to:n,limit:M},{forceRefetch:!!(0,de.jG)().getAutoRefreshInteval().interval})).unwrap(),A="LABELS_FILTER",P="STATE_FILTER_TO",w="STATE_FILTER_FROM",x={all:"all",firing:"Alerting",normal:"Normal",pending:"Pending",recovering:"Recovering"},lt=()=>{(0,j.useEffect)(()=>{(0,L.fH)(L.le.loadedCentralAlertStateHistory)},[]),rt();const e=(0,j.useMemo)(()=>{const s=new c.TS({name:A,label:(0,u.t)("alerting.central-alert-history-scene.scene.labels-filter-variable.label.labels","Labels: ")}),r=new c.yP({name:P,value:x.all,label:(0,u.t)("alerting.central-alert-history-scene.scene.transitions-to-filter-variable.label.end-state","End state:"),hide:O.zL.dontHide,query:`All : ${x.all}, To Firing : ${x.firing},To Normal : ${x.normal},To Pending : ${x.pending},To Recovering : ${x.recovering}`}),i=new c.yP({name:w,value:x.all,label:(0,u.t)("alerting.central-alert-history-scene.scene.transitions-from-filter-variable.label.start-state","Start state:"),hide:O.zL.dontHide,query:`All : ${x.all}, From Firing : ${x.firing},From Normal : ${x.normal},From Pending : ${x.pending},From Recovering : ${x.recovering}`});return new c.P1({controls:[new c.dM({component:mt}),new c.dM({component:ht}),new c.K8({}),new ut({}),new c.N0,new c.KE({}),new c.WM({})],$timeRange:new c.JZ({from:"now-1h",to:"now"}),$variables:new c.Pj({variables:[s,i,r]}),body:new c.G1({direction:"column",children:[dt(),new c.vA({body:new nt({})})]})})},[]);return(0,c.Yg)(e)?(0,t.jsx)(e.Component,{model:e}):null};function ct(){return new c.dt({datasource:at,queries:[{refId:"A",labels:"${LABELS_FILTER}",stateFrom:"${STATE_FILTER_FROM}",stateTo:"${STATE_FILTER_TO}"}]})}function dt(){return new c.vA({minHeight:300,ySizing:"content",body:c.d0.timeseries().setTitle("Alert Events").setDescription("Each alert event represents an alert instance that changed its state at a particular point in time. The history of the data is displayed over a period of time.").setData(ct()).setColor({mode:"continuous-BlPu"}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("drawStyle",b.GR.Bars).setCustomFieldConfig("lineInterpolation",b.dx.Linear).setCustomFieldConfig("lineWidth",1).setCustomFieldConfig("barAlignment",0).setCustomFieldConfig("spanNulls",!1).setCustomFieldConfig("insertNulls",!1).setCustomFieldConfig("showPoints",b.yL.Auto).setCustomFieldConfig("pointSize",5).setCustomFieldConfig("stacking",{mode:b.gs.None,group:"A"}).setCustomFieldConfig("gradientMode",b.on.Hue).setCustomFieldConfig("scaleDistribution",{type:b.L4.Linear}).setOption("legend",{showLegend:!1,displayMode:b.lm.Hidden}).setOption("tooltip",{mode:b.$N.Single}).setNoValue("No events found").build()})}class ut extends c.Bs{constructor(){super(...arguments),this._variableDependency=new c.Sh(this,{variableNames:[A,w,P]})}static{this.Component=gt}}function gt({model:e}){e.useState();const n=c.jh.interpolate(e,"${LABELS_FILTER}"),s=c.jh.interpolate(e,"${STATE_FILTER_TO}"),r=c.jh.interpolate(e,"${STATE_FILTER_FROM}");if(!n&&s===x.all&&r===x.all)return null;const i=()=>{const d=c.jh.lookupVariable(A,e);d instanceof c.TS&&d.setValue("");const o=c.jh.lookupVariable(P,e);o instanceof c.yP&&o.changeValueTo(x.all);const l=c.jh.lookupVariable(w,e);l instanceof c.yP&&l.changeValueTo(x.all)};return(0,t.jsx)(R.m,{content:(0,u.t)("alerting.clear-filter-button-object-renderer.content-clear-filter","Clear filter"),children:(0,t.jsx)(le.$n,{variant:"secondary",icon:"times",onClick:i,children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filter.clear",children:"Clear filters"})})})}const mt=()=>{const e=(0,S.of)(ie);return(0,t.jsx)("div",{className:e.filterLabelContainer,children:(0,t.jsx)(p.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filterBy",children:"Filter by:"})})})},ht=()=>{const e=(0,S.of)(ie);return(0,t.jsx)("div",{className:e.filterInfoContainer,children:(0,t.jsx)(R.m,{content:(0,t.jsxs)("div",{children:[(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filter.info.label1",children:"Filter events using label querying without spaces, ex:"}),(0,t.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'}),(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filter.info.label2",children:"Invalid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity= "critical"}'}),(0,t.jsx)("pre",{children:'{severity ="critical"}'}),(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filter.info.label3",children:"Valid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity=" critical"}'}),(0,t.jsx)(u.x6,{i18nKey:"alerting.central-alert-history.filter.info.label4",children:"Filter alerts using label querying without braces, ex:"}),(0,t.jsx)("pre",{children:'severity="critical", instance=~"cluster-us-.+"'})]}),children:(0,t.jsx)(H.I,{name:"info-circle",size:"sm"})})})},ie=e=>({filterInfoContainer:(0,m.css)({padding:"0",alignSelf:"center",marginRight:e.spacing(-1)}),filterLabelContainer:(0,m.css)({padding:"0",alignSelf:"center"})});function yt(){return(0,t.jsx)(W.d,{navId:"alerts-history",isLoading:!1,children:(0,t.jsx)(lt,{})})}const ft=(0,z.S)(yt)}}]);

//# sourceMappingURL=HistoryPage.cdf76d2afd3528bcebef.js.map