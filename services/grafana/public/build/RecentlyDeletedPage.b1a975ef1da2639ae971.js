"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6299],{3853:(G,x,t)=>{t.r(x),t.d(x,{default:()=>it});var s=t(74848),M=t(22803),n=t(96540),f=t(70713),l=t(92745),c=t(63142),r=t(12737),m=t(13791),h=t(63498),T=t(55860),p=t(52763),y=t(78012),v=t(99090),O=t(42361),I=t(75793);class W extends I.lC{constructor(){super(...arguments),this.getTagOptions=async()=>{try{const d=await O.v.get(),S=new Map;return d.forEach(A=>{A.tags.forEach(D=>{D&&S.set(D,(S.get(D)||0)+1)})}),Array.from(S.entries()).map(([A,D])=>({term:A,count:D})).sort((A,D)=>D.count-A.count)}catch(d){return console.error("Failed to get tags from deleted dashboards:",d),[]}},this.getSortOptions=async()=>Promise.resolve([{label:(0,l.t)("browse-dashboards.trash-state-manager.label.alphabetically-az","Alphabetically (A\u2013Z)"),value:"alpha-asc"},{label:(0,l.t)("browse-dashboards.trash-state-manager.label.alphabetically-za","Alphabetically (Z\u2013A)"),value:"alpha-desc"}])}setStateAndDoSearch(d){const S=d.sort||this.state.sort||y.M.get(v.w7)||void 0,o=d.query??this.state.query,A=d.tag??this.state.tag,D=o.length===0&&A.length===0;this.setState({sort:S,result:D?void 0:this.state.result,...d}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}}let a;function C(){return a||(a=new W({...I.ue,includePanels:!1,deleted:!0})),a}function e(){const g=C();return[g.useState(),g]}var i=t(27489),u=t(41654),R=t(45861),P=t(45229),B=t(75735),N=t(87745),V=t(18346),_=t(80231),L=t(87186),H=t(71599),Q=t(66404),b=t(35137),E=t(91156);const U=({onConfirm:g,onDismiss:d,selectedDashboards:S,dashboardOrigin:o,isLoading:A,...D})=>{const[F,j]=(0,n.useState)(()=>o.length>0&&o.every(tt=>tt===o[0])?o[0]:void 0),K=S.length,w=async()=>{(0,i.rR)("grafana_restore_confirm_clicked",{item_counts:{dashboard:K}}),F!==void 0&&(await g(F),d())};return(0,s.jsx)(H.u,{body:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.E,{element:"p",children:(0,s.jsxs)(l.x6,{i18nKey:"recently-deleted.restore-modal.text",count:K,children:["This action will restore ",{numberOfDashboards:K}," dashboards."]})}),(0,s.jsx)(b.$,{v:3}),(0,s.jsx)(Q.E,{element:"p",children:(0,s.jsx)(l.x6,{i18nKey:"recently-deleted.restore-modal.folder-picker-text",count:K,children:"Please choose a folder where your dashboards will be restored."})}),(0,s.jsx)(b.$,{v:1}),(0,s.jsx)(E.d,{onChange:j,value:F})]}),confirmText:A?(0,l.t)("recently-deleted.restore-modal.restore-loading","Restoring..."):(0,l.t)("recently-deleted.restore-modal.restore-button","Restore"),confirmButtonVariant:"primary",onDismiss:d,onConfirm:w,title:(0,l.t)("recently-deleted.restore-modal.title","Restore Dashboards"),disabled:F===void 0,...D})};function q(){const g=(0,p.wA)(),d=(0,_.xK)(),[S,o]=e(),A=(0,V.CE)(),[D,{isLoading:F}]=(0,V.vR)(),j=(0,n.useMemo)(()=>Object.entries(d.dashboard).filter(([$,Y])=>Y).map(([$])=>$),[d.dashboard]),K=[];if(S.result)for(const $ of j){const Y=S.result.view.fields.uid.values.findIndex(J=>J===$),X=S.result.view.fields.location.values[Y],k=X===v.TF?"":X;K.push(k)}const w=()=>{g((0,L.cT)({isSelected:!1,folderUID:void 0})),O.v.clear(),o.doSearchWithDebounce()},tt=async $=>{const Y=o.state.result?.view.toArray();if(!Y)return;const X=j.map(J=>{const z=A.data?.items.find(et=>et.metadata.name===J);if(!z)return Promise.resolve();const Z=structuredClone(z);return Z.metadata={...Z.metadata,annotations:{...Z.metadata?.annotations,[B.ew]:$}},D({dashboard:Z})});await Promise.all(X);const k=new Set;for(const J of j){const z=Y.find(et=>et.uid===J);if(!z)continue;const Z=z.location===v.TF?void 0:z.location;k.add(Z)}g((0,L.xN)(Array.from(k))),w()},dt=()=>{(0,i.rR)("grafana_restore_clicked",{item_counts:{dashboard:j.length}}),P.A.publish(new N.S8({component:U,props:{selectedDashboards:j,dashboardOrigin:K,onConfirm:tt,isLoading:F}}))};return(0,s.jsx)(u.B,{gap:1,children:(0,s.jsx)(R.$n,{onClick:dt,variant:"secondary",children:(0,s.jsx)(l.x6,{i18nKey:"recently-deleted.buttons.restore",children:"Restore"})})})}var at=t(50201);const rt=({searchState:g})=>{const d=!!(g.query||g.tag.length);return(0,s.jsx)(at.p,{message:d?(0,l.t)("recently-deleted.page.no-search-result","No results found for your query"):(0,l.t)("recently-deleted.page.no-deleted-dashboards","You haven't deleted any dashboards recently."),variant:d?"not-found":"completed",role:"alert",children:(0,s.jsx)(l.x6,{i18nKey:"recently-deleted.page.no-deleted-dashboards-text",children:"When you delete a dashboard, it will appear here for 30 days before being permanently deleted. Your organization administrator can restore recently-deleted dashboards."})})};var nt=t(85643),ot=t(83485);const st=(0,n.memo)(()=>{const g=(0,p.wA)(),d=(0,c.of)(lt),[S,o]=e(),A=(0,_.QE)(),{canEditFolders:D,canEditDashboards:F}=(0,ot.N)(),j=D||F;return(0,n.useEffect)(()=>{o.initStateFromUrl(void 0),g((0,L.cT)({isSelected:!1,folderUID:void 0}))},[g,o]),(0,s.jsx)(m.Y,{navId:"dashboards/recently-deleted",children:(0,s.jsxs)(m.Y.Contents,{className:d.pageContents,children:[(0,s.jsx)("div",{children:(0,s.jsx)(r.Z,{placeholder:(0,l.t)("recentlyDeleted.filter.placeholder","Search for dashboards"),value:S.query,escapeRegex:!1,onChange:o.onQueryChange})}),A?(0,s.jsx)(q,{}):(0,s.jsx)("div",{className:d.filters,children:(0,s.jsx)(h.bj,{state:S,getTagOptions:o.getTagOptions,getSortOptions:o.getSortOptions,sortPlaceholder:(0,T.S)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}),(0,s.jsx)("div",{className:d.subView,children:(0,s.jsx)(f.Ay,{children:({width:K,height:w})=>(0,s.jsx)(nt.Q,{canSelect:j,width:K,height:w,searchStateManager:o,searchState:S,emptyState:(0,s.jsx)(rt,{searchState:S})})})})]})})}),lt=g=>({pageContents:(0,M.css)({display:"flex",flexDirection:"column",gap:g.spacing(1),height:"100%"}),subView:(0,M.css)({height:"100%"}),filters:(0,M.css)({display:"none",[g.breakpoints.up("md")]:{display:"block"}})});st.displayName="RecentlyDeletedPage";const it=st},85643:(G,x,t)=>{t.d(x,{Q:()=>I});var s=t(74848),M=t(96540),n=t(88673),f=t(41119),l=t(92745),c=t(50201),r=t(45861),m=t(5478),h=t(86436),T=t(52763),p=t(80231),y=t(87186);const v=25,O={view:new n.R((0,f.Vc)({fields:[{name:"uid",display:!0,values:Array(v).fill(null)},{name:"kind",display:!0,values:Array(v).fill("dashboard")},{name:"name",display:!0,values:Array(v).fill("")},{name:"location",display:!0,values:Array(v).fill("")},{name:"tags",display:!0,values:Array(v).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:v};function I({width:a,height:C,canSelect:e,searchState:i,searchStateManager:u,emptyState:R}){const P=(0,T.wA)(),B=(0,T.d4)(E=>E.browseDashboards.selectedItems),N=(0,p.QE)(),{keyboardEvents:V}=(0,m.d)(),_=i.result??O,L=(0,M.useCallback)((E,U)=>E?E==="*"&&U==="*"?N:E==="*"?!1:B[W(E)][U]??!1:!1,[B,N]),H=(0,M.useCallback)(()=>{P((0,y.cT)({isSelected:!1,folderUID:void 0}))},[P]),Q=(0,M.useCallback)((E,U)=>{const q=!L(E,U);P((0,y.t$)({item:{kind:W(E),uid:U},isSelected:q}))},[L,P]);if(_.totalRows===0){const E=R??(0,s.jsx)(c.p,{button:(0,s.jsx)(r.$n,{variant:"secondary",onClick:u.onClearSearchAndFilters,children:(0,s.jsx)(l.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,l.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,s.jsx)("div",{style:{width:a},children:E})}const b={response:_,selection:e?L:void 0,selectionToggle:e?Q:void 0,clearSelection:H,width:a,height:C,onTagSelected:u.onAddTag,keyboardEvents:V,onDatasourceChange:i.datasource?u.onDatasourceChange:void 0,onClickItem:u.onSearchItemClicked};return(0,s.jsx)(h.P,{...b})}function W(a){switch(a){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+a)}},83485:(G,x,t)=>{t.d(x,{N:()=>c});var s=t(43173),M=t(73427),n=t(11257);function f(r,m){return m?M.TP.hasPermissionInMetadata(r,m):M.TP.hasPermission(r)}function l(r){return r&&r.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:f(n.w.FoldersCreate,r)}function c(r){const m=f(n.w.DashboardsCreate,r),h=l(r),T=f(n.w.FoldersDelete,r),p=f(n.w.DashboardsWrite,r),y=f(n.w.FoldersWrite,r),v=f(n.w.FoldersPermissionsWrite,r),O=f(n.w.FoldersPermissionsRead,r);return{canCreateDashboards:m,canCreateFolders:h,canDeleteFolders:T,canEditDashboards:p,canEditFolders:y,canSetPermissions:v,canViewPermissions:O}}},63498:(G,x,t)=>{t.d(x,{bj:()=>I});var s=t(74848),M=t(22803),n=t(92745),f=t(43173),l=t(63142),c=t(41654),r=t(32635),m=t(45861),h=t(77824),T=t(18552),p=t(93732),y=t(83458);function v(){return[{value:y.P.Folders,icon:"folder",description:(0,n.t)("search.actions.view-as-folders","View by folders")},{value:y.P.List,icon:"list-ul",description:(0,n.t)("search.actions.view-as-list","View as list")}]}function O(a){const C=a.layout??y.P.Folders;return C===y.P.Folders&&(a.query||a.sort||a.starred||a.tag.length>0)?y.P.List:C}const I=({state:a,showStarredFilter:C,showLayout:e,sortPlaceholder:i,onLayoutChange:u,onSortChange:R,onStarredFilterChange:P=()=>{},onTagFilterChange:B,getTagOptions:N,getSortOptions:V,onDatasourceChange:_,onPanelTypeChange:L,onSetIncludePanels:H})=>{const Q=(0,l.of)(W),b=O(a),E=a.tag.length||a.starred||a.query||a.datasource||a.panel_type?[y.P.Folders]:[];return(0,s.jsxs)(c.B,{justifyContent:"space-between",alignItems:"center",children:[(0,s.jsxs)(c.B,{gap:2,alignItems:"center",children:[(0,s.jsx)(p.$,{isClearable:!1,tags:a.tag,tagOptions:N,onChange:B}),f.$.featureToggles.panelTitleSearch&&(0,s.jsx)(r.S,{"data-testid":"include-panels",disabled:b===y.P.Folders,value:a.includePanels,onChange:()=>H(!a.includePanels),label:(0,n.t)("search.actions.include-panels","Include panels")}),C&&(0,s.jsx)("div",{className:Q.checkboxWrapper,children:(0,s.jsx)(r.S,{label:(0,n.t)("search.actions.starred","Starred"),onChange:P,value:a.starred})}),a.datasource&&(0,s.jsx)(m.$n,{icon:"times",variant:"secondary",onClick:()=>_(void 0),children:(0,s.jsxs)(n.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:a.datasource}]})}),a.panel_type&&(0,s.jsx)(m.$n,{icon:"times",variant:"secondary",onClick:()=>L(void 0),children:(0,s.jsxs)(n.x6,{i18nKey:"search.action-row.panel-type",values:{panel:a.panel_type},children:["Panel: ","{{panel}}"]})})]}),(0,s.jsxs)(c.B,{gap:2,children:[e&&(0,s.jsx)(h.z,{options:v(),disabledOptions:E,onChange:u,value:b}),(0,s.jsx)(T.r,{onChange:U=>R(U?.value),value:a.sort,getSortOptions:V,placeholder:i||(0,n.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};I.displayName="ActionRow";const W=a=>({checkboxWrapper:(0,M.css)({label:{lineHeight:"1.2"}})})},75793:(G,x,t)=>{t.d(x,{ET:()=>a,lC:()=>O,ue:()=>p});var s=t(2543),M=t.n(s),n=t(36490),f=t(5114),l=t(29043),c=t(99090),r=t(67497),m=t(55860),h=t(83458),T=t(35886);const p={query:"",tag:[],starred:!1,layout:h.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},y={sort:null,starred:null,query:null,tag:null,layout:null},v=()=>localStorage.getItem(c.YU)===h.P.List?h.P.List:h.P.Folders;class O extends f.Q{constructor(){super(...arguments),this.updateLocation=(0,s.debounce)(e=>n.Ny.partial(e,!0),300),this.doSearchWithDebounce=(0,s.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...y})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=e=>{this.setStateAndDoSearch({query:e})},this.onRemoveTag=e=>{this.setStateAndDoSearch({tag:this.state.tag.filter(i=>i!==e)})},this.onTagFilterChange=e=>{this.setStateAndDoSearch({tag:e})},this.onAddTag=e=>{this.state.tag&&this.state.tag.includes(e)||this.setStateAndDoSearch({tag:[...this.state.tag,e]})},this.onDatasourceChange=e=>{this.setStateAndDoSearch({datasource:e})},this.onPanelTypeChange=e=>{this.setStateAndDoSearch({panel_type:e})},this.onStarredFilterChange=e=>{const i=e.currentTarget.checked;this.setStateAndDoSearch({starred:i})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=e=>{e!==this.state.starred&&this.setStateAndDoSearch({starred:e})},this.onSortChange=e=>{e?(localStorage.setItem(c.w7,e),localStorage.setItem(c.YU,h.P.List)):localStorage.removeItem(c.w7),this.state.layout===h.P.Folders?this.setStateAndDoSearch({sort:e,layout:h.P.List}):this.setStateAndDoSearch({sort:e})},this.onLayoutChange=e=>{localStorage.setItem(c.YU,e),this.state.sort&&e===h.P.Folders?this.setStateAndDoSearch({layout:e,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:e,sort:this.state.prevSort})},this.onSetIncludePanels=e=>{this.setStateAndDoSearch({includePanels:e}),l.A.set(c.d7,e)},this.getTagOptions=()=>{const e=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,m.S)().tags(e)},this.onSearchItemClicked=e=>{(0,r.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,r.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(e,i=!0){const u=(0,T.N1)(n.Ny.getSearchObject());(u.query||u.datasource||u.panel_type)&&(u.layout=h.P.List);const R=v(),P=localStorage.getItem(c.w7)??void 0,B=R===h.P.List?u.sort||P:null;this.setState({...p,...u,layout:R,sort:B??p.sort,prevSort:P,folderUid:e,eventTrackingNamespace:e?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),i&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(e){const i=e.sort||this.state.sort||localStorage.getItem(c.w7)||void 0;this.setState({sort:i,...e}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===h.P.List)}getSearchQuery(){const e={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return e.sort?.length&&!e.sort.includes("name")&&(e.kind=["dashboard","folder"]),e.query?.length||(e.query="*",e.location||(e.kind=["dashboard","folder"])),!this.state.includePanels&&!e.kind&&(e.kind=["dashboard","folder"]),e.panel_type?.length&&(e.kind=["panel"]),e}doSearch(){const e={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,r.J$)(this.state.eventTrackingNamespace,e),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const i=(0,m.S)(),u=Date.now();(this.state.starred?i.starred(this.lastQuery):i.search(this.lastQuery)).then(P=>{u>this.lastSearchTimestamp&&(this.setState({result:P,loading:!1}),this.lastSearchTimestamp=u)}).catch(P=>{(0,r.KZ)(this.state.eventTrackingNamespace,{...e,error:P?.message}),this.setState({loading:!1})})}}let I;function W(){if(!I){const e=localStorage.getItem(c.YU)??p.layout;let i=l.A.getBool(c.d7,!0);i&&(i=!1),I=new O({...p,layout:e,includePanels:i})}return I}function a(){const C=W();return[C.useState(),C]}}}]);

//# sourceMappingURL=RecentlyDeletedPage.b1a975ef1da2639ae971.js.map