"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6092],{11065:(k,K,s)=>{s.d(K,{R:()=>c});var e=s(84140);function c(O,p,I){if(O.isLight)return p;{if(I){const j=(0,e.A)(p);return e.A.mostReadable(I,[j.clone().lighten(25),j.clone().lighten(10),j,j.clone().darken(10),j.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const n=(0,e.A)(p).toHsl();n.l=1-n.l;const g=(0,e.A)(n);return g.isLight()?g.darken(5).toHex8String():g.lighten(5).toHex8String()}}},21961:(k,K,s)=>{s.d(K,{Ay:()=>G});var e=s(74848),c=s(22803),O=s(46942),p=s.n(O),I=s(30703),n=s(63142),g=s(11065),j=s(96540),i=s(92745),C=s(45967),U=s(45861);const P=()=>({CopyIcon:(0,c.css)({backgroundColor:"transparent",border:"none",color:"inherit",height:"100%",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function F({copyText:a,icon:R="copy",tooltipTitle:E}){const v=(0,n.of)(P),[b,N]=(0,j.useState)(!1),y=()=>{navigator.clipboard.writeText(a),N(!0)};return(0,e.jsx)(C.m,{content:b?(0,i.t)("explore.trace-view.tooltip-copy-icon","Copied"):E,children:(0,e.jsx)(U.$n,{className:p()(v.CopyIcon),type:"button",icon:R,onClick:y})})}const D="    ";function M(a){let R="";return a&&Object.keys(a).forEach(function(E){R+=E+":"+a[E]+";"}),R}function w(a){function R(v){return'class="'+v+'"'}function E(v){return'style="'+M(a["."+v])+'"'}return a?E:R}function H(a){return a===null?"null":Array.isArray(a)?"array":typeof a=="string"&&/^https?:/.test(a)?"link":typeof a=="object"&&typeof a.toISOString=="function"?"date":typeof a}function A(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function x(a,R){let E="";const v=w(R);let b=function(y,B,d,z){if(!y.length)return B+" "+d;let Q=B+`
`;return E+=D,y.forEach(function(X,q){Q+=E+z(X)+(q<y.length-1?",":"")+`
`}),E=E.slice(0,-D.length),Q+E+d};function N(y){if(y===void 0)return"";switch(H(y)){case"boolean":return"<span "+v("json-markup-bool")+">"+y+"</span>";case"number":return"<span "+v("json-markup-number")+">"+y+"</span>";case"date":return'<span class="json-markup-string">"'+A(y.toISOString())+'"</span>';case"null":return"<span "+v("json-markup-null")+">null</span>";case"string":return"<span "+v("json-markup-string")+'>"'+A(y.replace(/\n/g,`
`+E))+'"</span>';case"link":return"<span "+v("json-markup-string")+'>"<a href="'+encodeURI(y)+'">'+A(y)+'</a>"</span>';case"array":return b(y,"[","]",N);case"object":const B=Object.keys(y).filter(function(d){return y[d]!==void 0});return b(B,"{","}",function(d){return"<span "+v("json-markup-key")+'>"'+A(d)+'":</span> '+N(y[d])})}return""}return"<div "+v("json-markup")+">"+N(a)+"</div>"}const L="copyIcon",V=a=>({KeyValueTable:(0,c.css)({label:"KeyValueTable",background:(0,g.R)(a,"#fff"),border:`1px solid ${(0,g.R)(a,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,c.css)({width:"100%"}),body:(0,c.css)({label:"body",verticalAlign:"baseline"}),row:(0,c.css)({label:"row","& > td":{padding:"0.5rem 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,g.R)(a,"#f5f5f5")},[`&:not(:hover) .${L}`]:{visibility:"hidden"},"a span":{color:`${a.colors.text.link} !important`},"a:hover span":{textDecoration:"underline"}}),keyColumn:(0,c.css)({label:"keyColumn",color:(0,g.R)(a,"#888"),whiteSpace:"pre",width:"125px",verticalAlign:"top"}),copyColumn:(0,c.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,c.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,c.css)({display:"inline-block"})}),Z=/^(\[|\{)/;function $(a){if(typeof a=="string"&&Z.test(a))try{return JSON.parse(a)}catch{}return a}const Y=({link:a,children:R})=>{const{path:E,title:v="",onClick:b,icon:N="external-link-alt"}=a;return(0,e.jsxs)("a",{href:E,title:v,onClick:b,target:"_blank",rel:"noopener noreferrer",children:[R," ",(0,e.jsx)(I.I,{name:N})]})};function G(a){const{data:R,linksGetter:E}=a,v=(0,n.of)(V);return(0,e.jsx)("div",{className:p()(v.KeyValueTable),"data-testid":"KeyValueTable",children:(0,e.jsx)("table",{className:v.table,children:(0,e.jsx)("tbody",{className:v.body,children:R.map((b,N)=>{const y={__html:x($(b.value))},B=(0,e.jsx)("div",{className:v.jsonTable,dangerouslySetInnerHTML:y}),d=E?.(R,N);let z;return d&&d.length?z=(0,e.jsx)("div",{children:(0,e.jsx)(Y,{link:d[0],children:B})}):z=B,(0,e.jsxs)("tr",{className:v.row,children:[(0,e.jsx)("td",{className:v.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:b.key}),(0,e.jsx)("td",{children:z}),(0,e.jsx)("td",{className:v.copyColumn,children:(0,e.jsx)(F,{className:L,copyText:JSON.stringify(b,null,2),tooltipTitle:"Copy JSON"})})]},`${b.key}-${N}`)})})})})}},34888:(k,K,s)=>{s.d(K,{c:()=>I});var e=s(74848),c=s(41654),O=s(27594);const p=()=>[{id:"resource",header:"Resource",cell:({row:{original:n}})=>n.resource},{id:"created",header:"Created",cell:({row:{original:n}})=>n.create?.toString()||"-"},{id:"deleted",header:"Deleted",cell:({row:{original:n}})=>n.delete?.toString()||"-"},{id:"updated",header:"Updated",cell:({row:{original:n}})=>n.update?.toString()||"-"},{id:"unchanged",header:"Unchanged",cell:({row:{original:n}})=>n.noop?.toString()||"-"},{id:"errors",header:"Errors",cell:({row:{original:n}})=>n.error?.toString()||"-"},{id:"total",header:"Total",cell:({row:{original:n}})=>((n.create||0)+(n.delete||0)+(n.update||0)+(n.noop||0)+(n.error||0)).toString()}];function I({summary:n}){return(0,e.jsx)(c.B,{direction:"column",gap:2,children:(0,e.jsx)(O.j,{data:n,columns:p(),getRowId:g=>g.resource||"",pageSize:10})})}},52524:(k,K,s)=>{s.d(K,{q:()=>j});var e=s(74848),c=s(96540),O=s(54148),p=s(92745),I=s(76319),n=s(71599),g=s(33680);function j({name:i,redirectTo:C}){const[U,P]=(0,g.So)(),[F,D]=(0,c.useState)(!1),M=(0,O.Zp)();(0,c.useEffect)(()=>{P.isSuccess&&(D(!1),C&&M(C))},[P.isSuccess,C,M]);const w=(0,c.useCallback)(()=>{U({name:i})},[U,i]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.K,{name:"trash-alt",tooltip:(0,p.t)("provisioning.delete-repository-button.tooltip-delete-this-repository","Delete this repository"),disabled:P.isLoading,onClick:()=>{D(!0)}}),(0,e.jsx)(n.u,{isOpen:F,title:(0,p.t)("provisioning.delete-repository-button.title-delete-repository","Delete repository config"),body:(0,p.t)("provisioning.delete-repository-button.confirm-delete-repository","Are you sure you want to delete the repository config?"),confirmText:(0,p.t)("provisioning.delete-repository-button.button-delete","Delete"),onConfirm:w,onDismiss:()=>D(!1)})]})}},6299:(k,K,s)=>{s.r(K),s.d(K,{default:()=>fe});var e=s(74848),c=s(96540),O=s(96014),p=s(54148),I=s(83175),n=s(92745),g=s(34999),j=s(50201),i=s(66404),C=s(89640),U=s(54314),P=s(60208),F=s(13941),D=s(68079),M=s(33680),w=s(13791),H=s(70958),A=s(62939),x=s(41654),L=s(45861),V=s(12737),Z=s(27594),$=s(91555);function Y({repo:t}){const r=t.metadata?.name??"",o=(0,M.Bm)({name:r}),[f,T]=(0,c.useState)(""),m=[...o.data?.items??[]].filter(l=>l.path.toLowerCase().includes(f.toLowerCase())),h=[{id:"path",header:"Path",sortType:"string",cell:({row:{original:l}})=>{const{path:u}=l;return(0,e.jsx)("a",{href:`${$.mL}/${r}/file/${u}`,children:u})}},{id:"size",header:"Size (KB)",cell:({row:{original:l}})=>{const{size:u}=l;return(parseInt(u,10)/1024).toFixed(2)},sortType:"number"},{id:"hash",header:"Hash",sortType:"string"},{id:"actions",header:"",cell:({row:{original:l}})=>{const{path:u}=l;return(0,e.jsxs)(x.B,{children:[(u.endsWith(".json")||u.endsWith(".yaml")||u.endsWith(".yml"))&&(0,e.jsx)(L.z9,{href:`${$.mL}/${r}/file/${u}`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.files-view.columns.view",children:"View"})}),(0,e.jsx)(L.z9,{href:`${$.mL}/${r}/history/${u}`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.files-view.columns.history",children:"History"})})]})}}];return o.isLoading?(0,e.jsx)(x.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(D.y,{})}):(0,e.jsxs)(x.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(x.B,{gap:2,children:(0,e.jsx)(V.Z,{placeholder:(0,n.t)("provisioning.files-view.placeholder-search","Search"),autoFocus:!0,value:f,onChange:T})}),(0,e.jsx)(Z.j,{columns:h,data:m,pageSize:25,getRowId:l=>String(l.path)})]})}var G=s(34145),a=s(92784),R=s(52524),E=s(31660);function v({repository:t}){const r=t.metadata?.name??"",o=(0,a.a)(t.spec?.github);return(0,e.jsxs)(x.B,{children:[(0,e.jsx)(G.W,{repo:t}),o&&(0,e.jsx)(L.$n,{variant:"secondary",icon:"github",onClick:()=>window.open(o,"_blank"),children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-actions.source-code",children:"Source Code"})}),(0,e.jsx)(E.w,{repository:t}),(0,e.jsx)(L.z9,{variant:"secondary",icon:"cog",href:`${$.mL}/${r}/edit`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-actions.settings",children:"Settings"})}),(0,e.jsx)(R.q,{name:r,redirectTo:$.mL})]})}var b=s(22803),N=s(63142),y=s(31286),B=s(13943),d=s(8073),z=s(74529),Q=s(99887),X=s(30703),q=s(21961),_=s(40996);function ee(t){return t?`provisioning.grafana.app/repository=${t}`:void 0}function ne({repositoryName:t}){const r=(0,M.L3)({labelSelector:ee(t),watch:!0}),o=(0,M.qC)({name:t});(0,_.A)(()=>{o.refetch()},250,[r.data]);const f=[...r.data?.items??[],...o.data?.items??[]],T=new Intl.Collator(void 0,{numeric:!0});return[f.slice().sort((h,l)=>{const u=h.metadata?.creationTimestamp??"",S=l.metadata?.creationTimestamp??"";return T.compare(S,u)}),r,o]}var J=s(79755),se=s(34888);const te=t=>{switch(t){case"success":return"green";case"working":case"pending":return"orange";case"error":return"red";default:return"darkgrey"}},re=()=>[{id:"status",header:(0,n.t)("provisioning.recent-jobs.column-status","Status"),cell:({row:{original:t}})=>(0,e.jsx)(Q.E,{text:t.status?.state||"",color:te(t.status?.state),icon:t.status?.state==="working"?"spinner":void 0})},{id:"action",header:(0,n.t)("provisioning.recent-jobs.column-action","Action"),cell:({row:{original:t}})=>t.spec?.action},{id:"started",header:(0,n.t)("provisioning.recent-jobs.column-started","Started"),cell:({row:{original:t}})=>(0,J.E)(t.status?.started)},{id:"duration",header:(0,n.t)("provisioning.recent-jobs.column-duration","Duration"),cell:({row:{original:t}})=>{const r={start:t.status?.started??0,end:t.status?.finished??Date.now()};if(!r.start)return null;const o=r.end-r.start;return o<1e3?`${o}ms`:(0,z.dU)(r,!0)}},{id:"message",header:(0,n.t)("provisioning.recent-jobs.column-message","Message"),cell:({row:{original:t}})=>(0,e.jsx)("span",{children:t.status?.message})}];function oe({row:t}){const r=!!t.status?.summary?.length,o=!!t.status?.errors?.length,f=!!t.spec;if(!r&&!o&&!f)return null;const T=(0,c.useMemo)(()=>{const m=[],h=t.spec?.action;if(!h)return m;const l=t.spec?.[h];if(!l)return m;for(const[u,S]of Object.entries(l))m.push({key:u,value:S});return m},[t.spec]);return(0,e.jsx)(y.a,{padding:2,children:(0,e.jsxs)(x.B,{direction:"column",gap:2,children:[f&&(0,e.jsxs)(x.B,{direction:"column",children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.expanded-row.job-specification",children:"Job Specification"})}),(0,e.jsx)(q.Ay,{data:T})]}),o&&(0,e.jsx)(x.B,{direction:"column",children:t.status?.errors?.map((m,h)=>m.trim()&&(0,e.jsx)(g.F,{severity:"error",title:(0,n.t)("provisioning.expanded-row.title-error","Error"),children:(0,e.jsxs)(x.B,{alignItems:"center",gap:1,children:[(0,e.jsx)(X.I,{name:"exclamation-circle",size:"sm"}),m]})},h))}),r&&(0,e.jsxs)(x.B,{direction:"column",gap:2,children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.expanded-row.summary",children:"Summary"})}),(0,e.jsx)(se.c,{summary:t.status.summary})]})]})})}function ie(){return(0,e.jsx)(x.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.empty-state.no-jobs",children:"No jobs..."})})})}function ae(t,r){return(0,e.jsx)(g.F,{title:(0,n.t)("provisioning.recent-jobs.error-loading","Error loading {{type}}",{type:t}),severity:"error",children:(0,e.jsx)("pre",{children:JSON.stringify(r)})})}function le(){return(0,e.jsx)(x.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(D.y,{})})}function ce({repo:t}){const[r,o,f]=ne({repositoryName:t.metadata?.name??"x"}),T=(0,c.useMemo)(()=>re(),[]);let m;return o.isLoading||f.isLoading?m=le():o.isError?m=ae((0,n.t)("provisioning.recent-jobs.active-jobs","active jobs"),o.error):r?.length?m=(0,e.jsx)(Z.j,{data:r,columns:T,getRowId:h=>`${h.metadata?.uid}`,renderExpandedRow:h=>(0,e.jsx)(oe,{row:h}),pageSize:10}):m=(0,e.jsx)(ie,{}),(0,e.jsxs)(d.Z,{children:[(0,e.jsx)(d.Z.Heading,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.recent-jobs.jobs",children:"Jobs"})}),(0,e.jsx)(d.Z.Description,{children:m})]})}function de({repository:t}){const[r,o]=(0,M.L)(),f=t.metadata?.name,T=()=>{f&&r({name:f,body:{}})};return o.isLoading?(0,e.jsx)(D.y,{}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(L.$n,{icon:"check-circle",variant:"secondary",disabled:o.isLoading||!f,onClick:T,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.check-repository.check",children:"Check"})})})}function ue({health:t}){return(0,e.jsx)(x.B,{gap:2,direction:"column",alignItems:"flex-start",children:t.healthy?(0,e.jsx)(g.F,{title:(0,n.t)("provisioning.repository-health.title-repository-is-healthy","Repository is healthy"),severity:"success",style:{width:"100%"},children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-health.no-errors-found",children:"No errors found"})}):(0,e.jsx)(g.F,{title:(0,n.t)("provisioning.repository-health.title-repository-is-unhealthy","Repository is unhealthy"),severity:"warning",style:{width:"100%"},children:t.message&&t.message.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.E,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-health.details",children:"Details:"})}),(0,e.jsx)("ul",{children:t.message.map(r=>(0,e.jsx)("li",{children:r},r))})]})})})}function he(t){return t?4:3}function ge({repo:t}){const r=(0,N.of)(pe),o=t.status,f=ye(t),T=he(!!t.status?.webhook),m=(0,c.useMemo)(()=>[{id:"Resource",header:"Resource Type",cell:({row:{original:h}})=>(0,e.jsx)("span",{children:h.resource}),size:"auto"},{id:"count",header:"Count",cell:({row:{original:h}})=>(0,e.jsx)("span",{children:h.count}),size:100}],[]);return(0,e.jsx)(y.a,{padding:2,children:(0,e.jsxs)(x.B,{direction:"column",gap:2,children:[(0,e.jsxs)(B.x,{columns:T,gap:2,children:[(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(d.Z,{className:r.card,children:[(0,e.jsx)(d.Z.Heading,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.resources",children:"Resources"})}),(0,e.jsx)(d.Z.Description,{children:t.status?.stats?(0,e.jsx)(Z.j,{columns:m,data:t.status.stats,getRowId:h=>`${h.group}-${h.resource}`}):null}),(0,e.jsx)(d.Z.Actions,{className:r.actions,children:(0,e.jsx)(L.z9,{fill:"outline",size:"md",href:ve(t),icon:"folder-open",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.view-folder",children:"View Folder"})})})]})}),t.status?.health&&(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(d.Z,{className:r.card,children:[(0,e.jsx)(d.Z.Heading,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.health",children:"Health"})}),(0,e.jsxs)(d.Z.Description,{children:[(0,e.jsx)(ue,{health:t.status?.health}),(0,e.jsxs)(B.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.health?.healthy?(0,n.t)("provisioning.repository-overview.healthy","Healthy"):(0,n.t)("provisioning.repository-overview.unhealthy","Unhealthy")})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.checked",children:"Checked:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.health?.checked)})}),!!o?.health?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(x.B,{gap:1,children:o.health.message.map((h,l)=>(0,e.jsx)(i.E,{variant:"body",children:h},l))})})]})]})]}),(0,e.jsx)(d.Z.Actions,{className:r.actions,children:(0,e.jsx)(de,{repository:t})})]})}),(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(d.Z,{className:r.card,children:[(0,e.jsx)(d.Z.Heading,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.pull-status",children:"Pull status"})}),(0,e.jsx)(d.Z.Description,{children:(0,e.jsxs)(B.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.state??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.job-id",children:"Job ID:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.job??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.last-ref",children:"Last Ref:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.lastRef?o.sync.lastRef.substring(0,7):(0,n.t)("provisioning.repository-overview.not-available","N/A")})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.started",children:"Started:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.sync.started)})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.finished",children:"Finished:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.sync.finished)})}),!!o?.sync?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(x.B,{gap:1,children:o.sync.message.map((h,l)=>(0,e.jsx)(i.E,{variant:"body",children:h},l))})})]})]})}),(0,e.jsx)(d.Z.Actions,{className:r.actions,children:(0,e.jsx)(E.w,{repository:t})})]})}),t.status?.webhook&&(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsxs)(d.Z,{className:r.card,children:[(0,e.jsx)(d.Z.Heading,{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.webhook",children:"Webhook"})}),(0,e.jsx)(d.Z.Description,{children:(0,e.jsxs)(B.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.webhook-id",children:"ID:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.id??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.webhook-events",children:"Events:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.subscribedEvents?.join(", ")??"N/A"})}),(0,e.jsx)("div",{className:r.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.webhook-last-event",children:"Last Event:"})})}),(0,e.jsx)("div",{className:r.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.webhook?.lastEvent)})})]})}),f&&(0,e.jsx)(d.Z.Actions,{className:r.actions,children:(0,e.jsx)(L.z9,{fill:"outline",href:f,icon:"external-link-alt",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-overview.webhook-url",children:"View Webhook"})})})]})})]}),(0,e.jsx)("div",{className:r.cardContainer,children:(0,e.jsx)(ce,{repo:t})})]})})}function ve(t){return t.spec?.sync.target==="folder"?`/dashboards/f/${t.metadata?.name}`:"/dashboards"}const pe=()=>({cardContainer:(0,b.css)({height:"100%"}),card:(0,b.css)({height:"100%",display:"flex",flexDirection:"column"}),actions:(0,b.css)({marginTop:"auto"}),labelColumn:(0,b.css)({gridColumn:"span 3"}),valueColumn:(0,b.css)({gridColumn:"span 9"})});function ye(t){const{status:r,spec:o}=t;if(o?.type==="github"&&r?.webhook?.url&&o.github?.url)return`${o.github.url}/settings/hooks/${r.webhook?.id}`}var xe=s(20941);function me({repo:t}){const r=t.metadata?.name??"",o=(0,M.nS)({name:r}),[f,T]=(0,c.useState)(""),m=(o.data?.items??[]).filter(l=>l.path.toLowerCase().includes(f.toLowerCase())),h=(0,c.useMemo)(()=>[{id:"title",header:"Title",sortType:"string",cell:({row:{original:l}})=>{const{resource:u,name:S,title:W}=l;return u==="dashboards"?(0,e.jsx)("a",{href:`/d/${S}`,children:W}):u==="folders"?(0,e.jsx)("a",{href:`/dashboards/f/${S}`,children:W}):(0,e.jsx)("span",{children:W})}},{id:"resource",header:"Type",sortType:"string",cell:({row:{original:l}})=>(0,e.jsx)("span",{style:{textTransform:"capitalize"},children:l.resource})},{id:"path",header:"Path",sortType:"string",cell:({row:{original:l}})=>{const{resource:u,name:S,path:W}=l;return u==="dashboards"?(0,e.jsx)("a",{href:`/d/${S}`,children:W}):(0,e.jsx)("span",{children:W})}},{id:"hash",header:"Hash",sortType:"string",cell:({row:{original:l}})=>{const{hash:u}=l;return(0,e.jsx)("span",{title:u,children:u.substring(0,7)})}},{id:"folder",header:"Folder",sortType:"string",cell:({row:{original:l}})=>{const{folder:u}=l;return u?.length?(0,e.jsx)(xe.N,{href:`/dashboards/f/${u}`,children:u}):(0,e.jsx)("span",{})}},{id:"actions",header:"",cell:({row:{original:l}})=>{const{resource:u,name:S,path:W}=l;return(0,e.jsxs)(x.B,{children:[u==="dashboards"&&(0,e.jsx)(L.z9,{href:`/d/${S}`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-resources.columns.view-dashboard",children:"View"})}),u==="folders"&&(0,e.jsx)(L.z9,{href:`/dashboards/f/${S}`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-resources.columns.view-folder",children:"View"})}),(0,e.jsx)(L.z9,{href:`${$.mL}/${t.metadata?.name}/history/${W}`,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-resources.columns.history",children:"History"})})]})}}],[t.metadata?.name]);return o.isLoading?(0,e.jsx)(x.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(D.y,{})}):(0,e.jsxs)(x.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(x.B,{gap:2,children:(0,e.jsx)(V.Z,{placeholder:(0,n.t)("provisioning.repository-resources.placeholder-search","Search"),autoFocus:!0,value:f,onChange:T})}),(0,e.jsx)(Z.j,{columns:h,data:m,pageSize:25,getRowId:l=>String(l.path)})]})}var je=(t=>(t.Overview="overview",t.Resources="resources",t.Files="files",t))(je||{});function fe(){const{name:t=""}=(0,p.g)(),r=(0,M.Ih)({fieldSelector:`metadata.name=${t}`,watch:!0}),o=r.data?.items?.[0],f=(0,O.zy)(),[T]=(0,H.s)(),m=(0,M.F9)(),h=T.tab??"overview",l=r.isError&&(0,A.E)(r.error),u=(0,c.useMemo)(()=>[{value:"overview",label:(0,n.t)("provisioning.repository-status-page.tab-overview","Overview"),title:(0,n.t)("provisioning.repository-status-page.tab-overview-title","Repository overview")},{value:"resources",label:(0,n.t)("provisioning.repository-status-page.tab-resources","Resources"),title:(0,n.t)("provisioning.repository-status-page.tab-resources-title","Resources saved in grafana database")},{value:"files",label:(0,n.t)("provisioning.repository-status-page.tab-files","Files"),title:(0,n.t)("provisioning.repository-status-page.tab-files-title","The raw file list from the repository")}],[]);return(0,e.jsx)(w.Y,{navId:"provisioning",pageNav:{text:o?.spec?.title??(0,n.t)("provisioning.repository-status-page.title","Repository Status"),subTitle:o?.spec?.description},actions:o&&(0,e.jsx)(v,{repository:o}),children:(0,e.jsxs)(w.Y.Contents,{isLoading:r.isLoading,children:[m.data?.legacyStorage&&(0,e.jsx)(g.F,{title:(0,n.t)("provisioning.repository-status-page.title-legacy-storage","Legacy Storage"),severity:"error",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-status-page.legacy-storage-message",children:"Instance is not yet running unified storage -- requires migration wizard"})}),l?(0,e.jsxs)(j.p,{message:(0,n.t)("provisioning.repository-status-page.not-found-message","Repository not found"),variant:"not-found",children:[(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-status-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(C.Y,{href:$.mL,children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-status-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(e.Fragment,{children:o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U.U,{children:u.map(S=>(0,e.jsx)(P.o,{href:I.kM.renderUrl(f.pathname,{...T,tab:S.value}),label:S.label,active:h===S.value,title:S.title},S.value))}),(0,e.jsxs)(F.J,{children:[o?.metadata?.deletionTimestamp&&(0,e.jsxs)(g.F,{title:(0,n.t)("provisioning.repository-status-page.title-queued-for-deletion","Queued for deletion"),severity:"warning",children:[(0,e.jsx)(D.y,{})," ",(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-status-page.cleaning-up-resources",children:"Cleaning up repository resources"})]}),h==="overview"&&(0,e.jsx)(ge,{repo:o}),h==="resources"&&(0,e.jsx)(me,{repo:o}),h==="files"&&(0,e.jsx)(Y,{repo:o})]})]}):(0,e.jsx)("div",{children:(0,e.jsx)(n.x6,{i18nKey:"provisioning.repository-status-page.not-found",children:"not found"})})})]})})}},31660:(k,K,s)=>{s.d(K,{w:()=>i});var e=s(74848),c=s(96540),O=s(54148),p=s(92745),I=s(45861),n=s(71599),g=s(33680),j=s(91555);function i({repository:C}){const[U,P]=(0,g.bS)(),[F,D]=(0,c.useState)(!1),M=(0,O.Zp)(),w=C.metadata?.name,H=()=>{w&&(U({name:w,jobSpec:{pull:{incremental:!1}}}),D(!1))},A=!!C.status?.health.healthy;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.$n,{icon:"cloud-download",variant:"secondary",tooltip:A?void 0:(0,p.t)("provisioning.sync-repository.tooltip-unhealthy-repository","Unable to pull an unhealthy repository"),disabled:P.isLoading||!w||!A,onClick:H,children:(0,e.jsx)(p.x6,{i18nKey:"provisioning.sync-repository.pull",children:"Pull"})}),!C.spec?.sync.enabled&&(0,e.jsx)(n.u,{isOpen:F,title:(0,p.t)("provisioning.sync-repository.title-pull-not-enabled","Pull is not enabled"),body:(0,p.t)("provisioning.sync-repository.body-edit-configuration","Edit the configuration"),confirmText:(0,p.t)("provisioning.sync-repository.button-edit","Edit"),onConfirm:()=>M(`${j.mL}/${w}/edit`),onDismiss:()=>D(!1)})]})}},34145:(k,K,s)=>{s.d(K,{W:()=>I});var e=s(74848),c=s(36490),O=s(99887),p=s(91555);function I({repo:n}){if(!n)return null;let g,j="purple",i="Unknown",C="exclamation-triangle";if(n.metadata?.deletionTimestamp)j="red",i="Deleting",C="spinner";else if(!n.spec?.sync?.enabled)j="red",i="Automatic pulling disabled",C="info-circle";else if(!n.status?.sync?.state?.length)j="orange",i="Pending",C="spinner",g="Waiting for health check to run";else switch(n.status?.sync?.state){case"success":C="check",i="Up-to-date",j="green";break;case"working":case"pending":j="orange",i="Pulling",C="spinner";break;case"error":j="red",i="Error",C="exclamation-triangle";break;default:break}return(0,e.jsx)(O.E,{color:j,icon:C,text:i,style:{cursor:"pointer"},tooltip:g,onClick:()=>{c.Ny.push(`${p.mL}/${n.metadata?.name}/?tab=overview`)}})}},79755:(k,K,s)=>{s.d(K,{E:()=>e});function e(c){return c?new Date(c).toLocaleString():"N/A"}}}]);

//# sourceMappingURL=RepositoryStatusPage.7d86ead8a7a06ce5b4df.js.map