"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{91087:(ee,L,t)=>{t.d(L,{y:()=>c});var e=t(74848),C=t(96540),i=t(41053),p=t(73427),n=t(11257),m=t(59812),x=t(34418);const c=({basicRole:d,roles:A,userId:u,orgId:P,onBasicRoleChange:U,roleOptions:M,disabled:z,basicRoleDisabled:F,basicRoleDisabledMessage:J,apply:v=!1,onApplyRoles:r,pendingRoles:a,maxWidth:s,width:N,isLoading:j})=>{const[{loading:y,value:b=A||[]},O]=(0,i.A)(async()=>{try{if(A)return A;if(v&&a?.length)return a;if(p.TP.hasPermission(n.w.ActionUserRolesList)&&u>0)return await(0,x.Xh)(u,P)}catch{console.error("Error loading options")}return[]},[P,u,a,A]);(0,C.useEffect)(()=>{P&&O()},[O,P]);const K=async R=>{v?r&&r(R,u,P):(await(0,x.eA)(R,u,P),await O())},w=p.TP.hasPermission(n.w.ActionUserRolesAdd)&&p.TP.hasPermission(n.w.ActionUserRolesRemove);return(0,e.jsx)(m.n,{appliedRoles:b,basicRole:d,onRolesChange:K,onBasicRoleChange:U,roleOptions:M,isLoading:y||j,disabled:z,basicRoleDisabled:F,basicRoleDisabledMessage:J,showBasicRole:!0,apply:v,canUpdateRoles:w,maxWidth:s,width:N})}},9390:(ee,L,t)=>{t.d(L,{r:()=>x});var e=t(74848),C=t(90382),i=t(92745),p=t(18857);const m=Object.values(C.X).filter(c=>c!==C.X.None).map(c=>({label:c,value:c}));function x({value:c,onChange:d,"aria-label":A,inputId:u,autoFocus:P,...U}){return(0,e.jsx)(p.l6,{inputId:u,value:c,options:m,onChange:M=>d(M.value??C.X.None),placeholder:(0,i.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":A,autoFocus:P,...U})}},75955:(ee,L,t)=>{t.r(L),t.d(L,{ServiceAccountsListPageUnconnected:()=>se,default:()=>G});var e=t(74848),C=t(22803),i=t(96540),p=t(71468),n=t(92745),m=t(63142),x=t(89640),c=t(45861),d=t(41654),A=t(18027),u=t(12737),P=t(31286),U=t(77824),M=t(50201),z=t(71599),F=t(13791),J=t(65642),v=t(73427),r=t(11257),a=t(92654),s=t(70255),N=t(27594),j=t(34213),y=t(71555),b=t(30703),O=t(76319),K=t(91087),w=t(9390);const R=({services:o,onRoleChange:l,roleOptions:k,onRemoveButtonClick:f,onDisable:h,onEnable:g,onAddTokenClick:Y,showPaging:V,totalPages:ce,onChangePage:_,currentPage:oe,isLoading:$})=>{const q=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:E},row:{original:B}})=>W(E,B,$,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:E},row:{original:B}})=>W(E,B,$),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:E},row:{original:B}})=>W(E,B,$,"id")},{id:"role",header:"Roles",cell:({cell:{value:E},row:{original:B}})=>I(E,B,$,k,l)},{id:"tokens",header:"Tokens",cell:({cell:{value:E},row:{original:B}})=>W(E,B,$,"tokens")},{id:"actions",header:"",cell:({row:{original:E}})=>te(E,$,Y,g,h,f)}],[$,Y,h,g,f,l,k]);return(0,e.jsxs)(d.B,{direction:"column",gap:2,children:[(0,e.jsx)(N.j,{columns:q,data:o,getRowId:E=>String(E.id)}),V&&ce>1&&(0,e.jsx)(d.B,{justifyContent:"flex-end",children:(0,e.jsx)(j.d,{numberOfPages:ce,currentPage:oe,onNavigate:_})})]})},W=(o,l,k,f)=>{if(k)return f==="avatarUrl"?(0,e.jsx)(s.A,{circle:!0,width:24,height:24}):(0,e.jsx)(s.A,{width:100});const h=`/org/serviceaccounts/${l.uid}`,g=`Edit service account's ${l.name} details`;switch(f){case"avatarUrl":return(0,e.jsx)("a",{"aria-label":g,href:h,children:(0,e.jsx)(y.e,{src:o,alt:"User avatar"})});case"id":return(0,e.jsx)(x.Y,{href:h,"aria-label":g,color:"secondary",inline:!1,children:l.login});case"tokens":return(0,e.jsxs)(d.B,{alignItems:"center",children:[(0,e.jsx)(b.I,{name:"key-skeleton-alt"}),(0,e.jsx)(x.Y,{href:h,"aria-label":g,color:"primary",inline:!1,children:o||"No tokens"})]});default:return(0,e.jsx)(x.Y,{href:h,"aria-label":g,color:"primary",inline:!1,children:o})}},I=(o,l,k,f,h)=>{const g=v.TP.hasPermission(r.w.ActionRolesList)&&v.TP.hasPermission(r.w.ActionUserRolesList),Y=v.TP.hasPermissionInMetadata(r.w.ServiceAccountsWrite,l);return k?(0,e.jsx)(s.A,{width:100}):v.TP.licensedAccessControlEnabled()?g&&(0,e.jsx)(K.y,{userId:l.id,orgId:l.orgId,basicRole:o,roles:l.roles||[],onBasicRoleChange:V=>h(V,l),roleOptions:f,basicRoleDisabled:!Y,disabled:l.isExternal||l.isDisabled,width:40}):(0,e.jsx)(w.r,{"aria-label":(0,n.t)("serviceaccounts.get-role-cell.aria-label-role","Role"),value:o,disabled:l.isExternal||!Y||l.isDisabled,onChange:V=>h(V,l)})},te=(o,l,k,f,h,g)=>l?(0,e.jsx)(s.A,{width:100}):o.isExternal?(0,e.jsx)(d.B,{alignItems:"center",justifyContent:"flex-end",children:(0,e.jsx)(O.K,{disabled:!0,name:"lock",size:"md",tooltip:(0,n.t)("serviceaccounts.get-actions-cell.tooltip-managed-service-account-cannot-modified","This is a managed service account and cannot be modified")})}):(0,e.jsxs)(d.B,{alignItems:"center",justifyContent:"flex-end",children:[v.TP.hasPermission(r.w.ServiceAccountsWrite)&&!o.tokens&&(0,e.jsx)(c.$n,{onClick:()=>k(o),disabled:o.isDisabled,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.add-token",children:"Add token"})}),v.TP.hasPermissionInMetadata(r.w.ServiceAccountsWrite,o)&&(o.isDisabled?(0,e.jsx)(c.$n,{variant:"secondary",size:"md",onClick:()=>f(o),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.enable",children:"Enable"})}):(0,e.jsx)(c.$n,{variant:"secondary",size:"md",onClick:()=>h(o),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.disable",children:"Disable"})})),v.TP.hasPermissionInMetadata(r.w.ServiceAccountsDelete,o)&&(0,e.jsx)(O.K,{name:"trash-alt","aria-label":(0,n.t)("serviceaccounts.get-actions-cell.aria-label-delete-button","Delete service account {{serviceAccountName}}",{serviceAccountName:o.name}),variant:"secondary",onClick:()=>g(o)})]});R.displayName="ServiceAccountTable";var X=t(18079),S=t(76031);function ie(o){return{...o.serviceAccounts}}const ne={changePage:S.yd,changeQuery:S.nM,fetchACOptions:S.pJ,fetchServiceAccounts:S.iJ,deleteServiceAccount:S.W4,updateServiceAccount:S.mV,changeStateFilter:S.qS,createServiceAccountToken:S.yC},Z=(0,p.connect)(ie,ne),ae=[{label:"All",value:a.i.All},{label:"With expired tokens",value:a.i.WithExpiredTokens},{label:"Disabled",value:a.i.Disabled}];J.Ay.featureToggles.externalServiceAccounts&&ae.push({label:"Managed",value:a.i.External});const se=({page:o,changePage:l,totalPages:k,serviceAccounts:f,isLoading:h,roleOptions:g,query:Y,serviceAccountStateFilter:V,changeQuery:ce,fetchACOptions:_,fetchServiceAccounts:oe,deleteServiceAccount:$,updateServiceAccount:q,changeStateFilter:E,createServiceAccountToken:B})=>{const[Ee,de]=(0,i.useState)(!1),[De,ue]=(0,i.useState)(!1),[Pe,ve]=(0,i.useState)(!1),[fe,he]=(0,i.useState)(""),[T,Q]=(0,i.useState)(null),Ae=(0,m.of)(H);(0,i.useEffect)(()=>{oe({withLoadingIndicator:!0}),v.TP.licensedAccessControlEnabled()&&_()},[_,oe]);const re=f.length===0&&V===a.i.All&&!Y,ye=async(D,Le)=>{const Ue={...Le,role:D};q(Ue),v.TP.licensedAccessControlEnabled()&&_()},ge=D=>{ce(D)},Te=D=>{E(D)},Ce=D=>{Q(D),ue(!0)},pe=async()=>{T&&$(T.uid),me()},Me=D=>{Q(D),ve(!0)},je=()=>{T&&q({...T,isDisabled:!0}),xe()},Oe=D=>{q({...D,isDisabled:!1})},Re=D=>{Q(D),de(!0)},Ie=async D=>{T&&B(T.uid,D,he)},Se=()=>{de(!1),Q(null),he("")},me=()=>{ue(!1),Q(null)},xe=()=>{ve(!1),Q(null)},Be=(0,e.jsx)("span",{children:(0,e.jsxs)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.sub-title",children:["Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",(0,e.jsx)(x.Y,{href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",external:!0,children:"documentation."})]})});return(0,e.jsx)(F.Y,{navId:"serviceaccounts",subTitle:Be,actions:(0,e.jsx)(e.Fragment,{children:!re&&v.TP.hasPermission(r.w.ServiceAccountsCreate)&&(0,e.jsx)(c.z9,{href:"org/serviceaccounts/create",variant:"primary",children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.add-service-account",children:"Add service account"})})}),children:(0,e.jsxs)(F.Y.Contents,{children:[(0,e.jsxs)(d.B,{justifyContent:"space-between",wrap:"wrap",children:[(0,e.jsx)(A.I,{grow:!0,children:(0,e.jsx)(u.Z,{className:Ae.filterInput,placeholder:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.placeholder-search-service-account-by-name","Search service account by name"),value:Y,onChange:ge})}),(0,e.jsx)(P.a,{marginBottom:1,children:(0,e.jsx)(U.z,{options:ae,onChange:Te,value:V})})]}),!h&&!re&&f.length===0&&(0,e.jsx)(M.p,{variant:"not-found",message:(0,n.t)("service-accounts.empty-state.message","No services accounts found")}),!h&&re&&(0,e.jsx)(M.p,{variant:"call-to-action",button:(0,e.jsx)(c.z9,{disabled:!v.TP.hasPermission(r.w.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg",children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.button-title",children:"Add service account"})}),message:(0,n.t)("service-accounts.empty-state.title","You haven't created any service accounts yet"),children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.more-info",children:"Remember, you can provide specific permissions for API access to other applications"})}),(h||f.length!==0)&&(0,e.jsx)(R,{services:f,showPaging:!0,totalPages:k,onChangePage:l,currentPage:o,onRoleChange:ye,roleOptions:g,onRemoveButtonClick:Ce,onDisable:Me,onEnable:Oe,onAddTokenClick:Re,isLoading:h}),T&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.u,{isOpen:De,body:T.tokens?(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-delete","Are you sure you want to delete {{serviceAccountName}} and {{count}} accompanying tokens?",{serviceAccountName:T.name,count:T.tokens}):(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-delete-with-tokens","Are you sure you want to delete {{serviceAccountName}}?",{serviceAccountName:T.name}),confirmText:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.confirmText-delete","Delete"),title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-delete-service-account","Delete service account"),onConfirm:pe,onDismiss:me}),(0,e.jsx)(z.u,{isOpen:Pe,title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-disable-service-account","Disable service account"),body:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.body-disable-service-account","Are you sure you want to disable '{{accountToDisable}}'?",{accountToDisable:T.name}),confirmText:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.confirmText-disable-service-account","Disable service account"),onConfirm:je,onDismiss:xe}),(0,e.jsx)(X.z,{isOpen:Ee,token:fe,serviceAccountLogin:T.login,onCreateToken:Ie,onClose:Se})]})]})})},H=o=>({filterInput:(0,C.css)({maxWidth:o.spacing(50)})}),G=Z(se)},18079:(ee,L,t)=>{t.d(L,{z:()=>F});var e=t(74848),C=t(22803),i=t(96540),p=t(24726),n=t(92745),m=t(43173),x=t(63142),c=t(22787),d=t(37386),A=t(63527),u=t(77824),P=t(43482),U=t(45861),M=t(47931);const z=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],F=({isOpen:r,token:a,serviceAccountLogin:s,onCreateToken:N,onClose:j})=>{const y=new Date;y.setDate(y.getDate()+1);const b=new Date;m.$.tokenExpirationDayLimit!==void 0&&m.$.tokenExpirationDayLimit>-1?b.setDate(b.getDate()+m.$.tokenExpirationDayLimit+1):b.setDate(864e13);const O=m.$.tokenExpirationDayLimit!==void 0&&m.$.tokenExpirationDayLimit>0,[K,w]=(0,i.useState)(""),[R,W]=(0,i.useState)(""),[I,te]=(0,i.useState)(O),[X,S]=(0,i.useState)(y),[ie,ne]=(0,i.useState)(X!==""),Z=(0,x.of)(v);(0,i.useEffect)(()=>{r&&w(`${s}-${(0,p.A)()}`)},[s,r]);const ae=G=>{ne(G!==""),S(G)},se=()=>{N({name:R||K,secondsToLive:I?J(X):void 0})},H=()=>{W(""),w(""),te(O),S(y),ne(X!==""),j()},le=a?"Service account token created":"Add service account token";return(0,e.jsx)(c.a,{isOpen:r,title:le,onDismiss:H,className:Z.modal,children:a?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-token","Token"),description:(0,n.t)("serviceaccounts.create-token-modal.description-token","Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."),children:(0,e.jsxs)("div",{className:Z.modalTokenRow,children:[(0,e.jsx)(A.p,{name:"tokenValue",value:a,readOnly:!0}),(0,e.jsx)(M.b,{className:Z.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>a,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-clipboard",children:"Copy to clipboard"})})]})}),(0,e.jsxs)(c.a.ButtonRow,{children:[(0,e.jsx)(M.b,{variant:"primary",getText:()=>a,onClipboardCopy:H,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-to-clipboard-and-close",children:"Copy to clipboard and close"})}),(0,e.jsx)(U.$n,{variant:"secondary",onClick:H,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.close",children:"Close"})})]})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)(d.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-display-name","Display name"),description:(0,n.t)("serviceaccounts.create-token-modal.description-name-to-easily-identify-the-token","Name to easily identify the token"),required:!0,children:(0,e.jsx)(A.p,{name:"tokenName",value:R,placeholder:K,onChange:G=>{W(G.currentTarget.value)}})}),(0,e.jsx)(d.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-expiration","Expiration"),children:(0,e.jsx)(u.z,{options:z,value:I,onChange:te,size:"md"})}),I&&(0,e.jsx)(d.D,{label:(0,n.t)("serviceaccounts.create-token-modal.label-expiration-date","Expiration date"),children:(0,e.jsx)(P.l,{onChange:ae,value:X,placeholder:"",minDate:y,maxDate:b})}),(0,e.jsx)(c.a.ButtonRow,{children:(0,e.jsx)(U.$n,{onClick:se,disabled:I&&!ie,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.create-token-modal.generate-token",children:"Generate token"})})})]})})},J=r=>{const a=new Date(r),s=new Date;return Math.ceil((a.getTime()-s.getTime())/1e3)},v=r=>({modal:(0,C.css)({width:"550px"}),modalTokenRow:(0,C.css)({display:"flex"}),modalCopyToClipboardButton:(0,C.css)({marginLeft:r.spacing(.5)})})},76031:(ee,L,t)=>{t.d(L,{W4:()=>M,iJ:()=>u,mV:()=>U,nM:()=>J,pJ:()=>A,qS:()=>v,yC:()=>z,yd:()=>r});var e=t(2543),C=t.n(e),i=t(68143),p=t(34418),n=t(15130),m=t(11257),x=t(92654),c=t(91259);const d="/api/serviceaccounts";function A(){return async a=>{try{if(n.TP.licensedAccessControlEnabled()&&n.TP.hasPermission(m.w.ActionRolesList)){const s=await(0,p.RL)();a((0,c.ew)(s))}}catch(s){console.error(s)}}}function u({withLoadingIndicator:a}={withLoadingIndicator:!1}){return async(s,N)=>{try{if(n.TP.hasPermission(m.w.ServiceAccountsRead)){a&&s((0,c.FW)());const{perPage:j,page:y,query:b,serviceAccountStateFilter:O}=N().serviceAccounts,K=await(0,i.AI)().get(`/api/serviceaccounts/search?perpage=${j}&page=${y}&query=${b}${F(O)}&accesscontrol=true`);if(n.TP.licensedAccessControlEnabled()&&n.TP.hasPermission(m.w.ActionUserRolesList)){s((0,c.dJ)());const w=n.TP.user.orgId,R=K?.serviceAccounts.map(I=>I.id),W=await(0,i.AI)().post("/api/access-control/users/roles/search",{userIds:R,orgId:w});K.serviceAccounts.forEach(I=>{I.roles=W?W[I.id]||[]:[]}),s((0,c.jE)())}s((0,c.zh)(K))}}catch(j){console.error(j)}finally{s((0,c.Yh)())}}}const P=(0,e.debounce)(a=>a(u()),500,{leading:!0});function U(a){return async s=>{await(0,i.AI)().patch(`${d}/${a.uid}?accesscontrol=true`,{...a}),s(u())}}function M(a){return async s=>{await(0,i.AI)().delete(`${d}/${a}`),s(u())}}function z(a,s,N){return async j=>{const y=await(0,i.AI)().post(`${d}/${a}/tokens`,s);N(y.key),j(u())}}const F=a=>{switch(a){case x.i.WithExpiredTokens:return"&expiredTokens=true";case x.i.Disabled:return"&disabled=true";case x.i.External:return"&external=true";default:return""}};function J(a){return async s=>{s((0,c.L5)(a)),P(s)}}function v(a){return async s=>{s((0,c.c3)(a)),s(u())}}function r(a){return async s=>{s((0,c.EC)(a)),s(u())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.4d251ebefea4dce4033b.js.map