{"version":3,"file":"prometheusPlugin.0c7a2c5c57d073def5ed.js","mappings":"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","sources":["webpack://grafana/./packages/grafana-prometheus/src/result_transformer.ts","webpack://grafana/./node_modules/@lezer/highlight/dist/index.js","webpack://grafana/./node_modules/@prometheus-io/lezer-promql/dist/index.es.js","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/types.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/operationUtils.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/binaryScalarOperations.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/parsingUtils.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/parsing.ts","webpack://grafana/./packages/grafana-prometheus/src/escaping.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/rendering/labels.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/rendering/operations.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/rendering/query.ts","webpack://grafana/./packages/grafana-prometheus/src/add_label_to_query.ts","webpack://grafana/./packages/grafana-prometheus/src/query_hints.ts","webpack://grafana/./packages/grafana-prometheus/src/components/cancelable-promise.ts","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/selectorBuilder.ts","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/useMetricsLabelsValues.ts","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/MetricsBrowserContext.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/styles.ts","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/LabelSelector.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/MetricSelector.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/SelectorActions.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/ValueSelector.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/metrics-browser/MetricsBrowser.tsx","webpack://grafana/./node_modules/monaco-promql/promql/promql.contribution.js","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/getOverrideServices.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/data_provider.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/util.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/completions.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/situation.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/monaco-completion-provider.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/monaco-completion-provider/validation.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/promql.ts","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/MonacoQueryField.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/MonacoQueryFieldLazy.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/monaco-query-field/MonacoQueryFieldWrapper.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/useMetricsState.ts","webpack://grafana/./packages/grafana-prometheus/src/types.ts","webpack://grafana/./packages/grafana-prometheus/src/caching.ts","webpack://grafana/./packages/grafana-prometheus/src/language_utils.ts","webpack://grafana/./packages/grafana-prometheus/src/components/usePromQueryFieldEffects.ts","webpack://grafana/./packages/grafana-prometheus/src/components/PromQueryField.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationExplainedBox.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/RawQuery.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationListExplained.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/operations.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/aggregations.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/LokiAndPromQueryModellerBase.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/PromQueryModeller.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/modeller_instance.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryBuilderExplained.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryCodeEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/AnnotationQueryEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/annotations.ts","webpack://grafana/./packages/grafana-prometheus/src/resource_clients.ts","webpack://grafana/./packages/grafana-prometheus/src/language_provider.ts","webpack://grafana/./packages/grafana-prometheus/src/migrations/variableMigration.ts","webpack://grafana/./packages/grafana-prometheus/src/metric_find_query.ts","webpack://grafana/./packages/grafana-prometheus/src/querycache/QueryCache.ts","webpack://grafana/./packages/grafana-prometheus/src/tracking.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/LabelFilterItem.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/LabelFilters.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/shared/testIds.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/state/state.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/state/helpers.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/AdditionalSettings.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/FeedbackLink.tsx","webpack://grafana/./packages/grafana-prometheus/src/configuration/shared/utils.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/ResultsTable.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/styles.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/uFuzzy.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/metrics-modal/MetricsModal.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/MetricCombobox.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/MetricsLabelsSection.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/VariableQueryEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/variables.ts","webpack://grafana/./packages/grafana-prometheus/src/datasource.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/QueryPattern.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/QueryPatternsModal.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/hooks/useFlag.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/types.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/QueryEditorModeToggle.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/QueryHeaderSwitch.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/state.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationInfoButton.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationHeader.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/param_utils.ts","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/LabelParamEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationParamEditorRegistry.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationList.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/OperationsEditorRow.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/QueryBuilderHints.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/shared/QueryBuilderContent.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/NestedQuery.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/NestedQueryList.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/shared/BaseQueryBuilder.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryBuilder.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/QueryPreview.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryBuilderContainer.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/PromExemplarField.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/PromExploreExtraField.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/shared/QueryOptionGroup.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryLegendEditor.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryBuilderOptions.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryCodeEditorAutocompleteInfo.tsx","webpack://grafana/./packages/grafana-prometheus/src/querybuilder/components/PromQueryEditorSelector.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/PromQueryEditorForAlerting.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/PromQueryEditorByApp.tsx","webpack://grafana/./packages/grafana-prometheus/src/components/PromCheatSheet.tsx","webpack://grafana/./node_modules/@grafana/azure-sdk/dist/esm/clouds.js","webpack://grafana/./node_modules/@grafana/azure-sdk/dist/esm/credentials/AzureCredentials.js","webpack://grafana/./node_modules/@grafana/azure-sdk/dist/esm/credentials/AzureCredentialsConfig.js","webpack://grafana/./node_modules/@grafana/azure-sdk/dist/esm/resources/ResourceTypes.js","webpack://grafana/./node_modules/@grafana/azure-sdk/dist/esm/resources/MetricsResourceTypes.js","webpack://grafana/./packages/grafana-prometheus/src/configuration/AlertingSettingsOverhaul.tsx","webpack://grafana/./packages/grafana-prometheus/src/configuration/ExemplarSetting.tsx","webpack://grafana/./packages/grafana-prometheus/src/configuration/ExemplarsSettings.tsx","webpack://grafana/./packages/grafana-prometheus/src/configuration/PromFlavorVersions.ts","webpack://grafana/./packages/grafana-prometheus/src/configuration/PromSettings.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureCredentialsConfig.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureCredentialsForm.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureAuthSettings.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/DataSourceHttpSettingsOverhaulPackage.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/ConfigEditorPackage.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/module.ts","webpack://grafana/./node_modules/react-use/esm/useLatest.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/AccessoryButton.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorFieldGroup.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorHeader.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorList.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorRows.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/EditorSwitch.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/FlexItem.js","webpack://grafana/./node_modules/@grafana/plugin-ui/dist/esm/components/QueryEditor/InputGroup.js"],"sourcesContent":["// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/result_transformer.ts\nimport { flatten, forOwn, groupBy, partition } from 'lodash';\n\nimport {\n  CoreApp,\n  DataFrame,\n  DataFrameType,\n  DataLink,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataTopic,\n  Field,\n  FieldType,\n  getDisplayProcessor,\n  getFieldDisplayName,\n  Labels,\n  sortDataFrame,\n  TIME_SERIES_TIME_FIELD_NAME,\n  TIME_SERIES_VALUE_FIELD_NAME,\n} from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\n\nimport { ExemplarTraceIdDestination, PromMetric, PromQuery, PromValue } from './types';\n\n// handles case-insensitive Inf, +Inf, -Inf (with optional \"inity\" suffix)\nconst INFINITY_SAMPLE_REGEX = /^[+-]?inf(?:inity)?$/i;\n\nconst isTableResult = (dataFrame: DataFrame, options: DataQueryRequest<PromQuery>): boolean => {\n  // We want to process vector and scalar results in Explore as table\n  if (\n    options.app === CoreApp.Explore &&\n    (dataFrame.meta?.custom?.resultType === 'vector' || dataFrame.meta?.custom?.resultType === 'scalar')\n  ) {\n    return true;\n  }\n\n  // We want to process all dataFrames with target.format === 'table' as table\n  const target = options.targets.find((target) => target.refId === dataFrame.refId);\n  return target?.format === 'table';\n};\n\nconst isCumulativeHeatmapResult = (dataFrame: DataFrame, options: DataQueryRequest<PromQuery>): boolean => {\n  if (dataFrame.meta?.type === DataFrameType.HeatmapCells) {\n    return false;\n  }\n\n  const target = options.targets.find((target) => target.refId === dataFrame.refId);\n  return target?.format === 'heatmap';\n};\n\n// V2 result transformer used to transform query results from queries that were run through prometheus backend\nexport function transformV2(\n  response: DataQueryResponse,\n  request: DataQueryRequest<PromQuery>,\n  options: { exemplarTraceIdDestinations?: ExemplarTraceIdDestination[] }\n) {\n  // migration for dataplane field name issue\n  // update displayNameFromDS in the field config\n  response.data.forEach((f: DataFrame) => {\n    const target = request.targets.find((t) => t.refId === f.refId);\n    // check that the legend is selected as auto\n    if (target && target.legendFormat === '__auto') {\n      f.fields.forEach((field) => {\n        if (field.labels?.__name__ && field.labels?.__name__ === field.name) {\n          const fieldCopy = { ...field, name: TIME_SERIES_VALUE_FIELD_NAME };\n          field.config.displayNameFromDS = getFieldDisplayName(fieldCopy, f, response.data);\n        }\n      });\n    }\n  });\n\n  const [tableFrames, framesWithoutTable] = partition<DataFrame>(response.data, (df) => isTableResult(df, request));\n  const processedTableFrames = transformDFToTable(tableFrames);\n\n  const [exemplarFrames, framesWithoutTableAndExemplars] = partition<DataFrame>(\n    framesWithoutTable,\n    (df) => df.meta?.custom?.resultType === 'exemplar'\n  );\n\n  // EXEMPLAR FRAMES: We enrich exemplar frames with data links and add dataTopic meta info\n  const { exemplarTraceIdDestinations: destinations } = options;\n  const processedExemplarFrames = exemplarFrames.map((dataFrame) => {\n    if (destinations?.length) {\n      for (const exemplarTraceIdDestination of destinations) {\n        const traceIDField = dataFrame.fields.find((field) => field.name === exemplarTraceIdDestination.name);\n        if (traceIDField) {\n          const links = getDataLinks(exemplarTraceIdDestination);\n          traceIDField.config.links = traceIDField.config.links?.length\n            ? [...traceIDField.config.links, ...links]\n            : links;\n        }\n      }\n    }\n\n    return { ...dataFrame, meta: { ...dataFrame.meta, dataTopic: DataTopic.Annotations } };\n  });\n\n  const [heatmapResults, framesWithoutTableHeatmapsAndExemplars] = partition<DataFrame>(\n    framesWithoutTableAndExemplars,\n    (df) => isCumulativeHeatmapResult(df, request)\n  );\n\n  // this works around the fact that we only get back frame.name with le buckets when legendFormat == {{le}}...which is not the default\n  heatmapResults.forEach((df) => {\n    if (df.name == null) {\n      let f = df.fields.find((f) => f.type === FieldType.number);\n\n      if (f) {\n        let le = f.labels?.le;\n\n        if (le) {\n          // this is used for sorting the frames by numeric ascending le labels for de-accum\n          df.name = le;\n          // this is used for renaming the Value fields to le label\n          f.config.displayNameFromDS = le;\n        }\n      }\n    }\n  });\n\n  // Group heatmaps by query\n  const heatmapResultsGroupedByQuery = groupBy<DataFrame>(heatmapResults, (h) => h.refId);\n\n  // Initialize empty array to push grouped histogram frames to\n  let processedHeatmapResultsGroupedByQuery: DataFrame[][] = [];\n\n  // Iterate through every query in this heatmap\n  for (const query in heatmapResultsGroupedByQuery) {\n    // Get reference to dataFrames for heatmap\n    const heatmapResultsGroup = heatmapResultsGroupedByQuery[query];\n\n    // Create a new grouping by iterating through the data frames...\n    const heatmapResultsGroupedByValues = groupBy<DataFrame>(heatmapResultsGroup, (dataFrame) => {\n      // Each data frame has `Time` and `Value` properties, we want to get the values\n      const values = dataFrame.fields.find((field) => field.type === FieldType.number);\n      // Specific functionality for special \"le\" quantile heatmap value, we know if this value exists, that we do not want to calculate the heatmap density across data frames from the same quartile\n      if (values?.labels && HISTOGRAM_QUANTILE_LABEL_NAME in values.labels) {\n        const { le, ...notLE } = values?.labels;\n        return Object.values(notLE).join();\n      }\n\n      // Return a string made from the concatenation of this frame's values to represent a grouping in the query\n      return Object.values(values?.labels ?? []).join();\n    });\n\n    // Then iterate through the resultant object\n    forOwn(heatmapResultsGroupedByValues, (dataFrames, key) => {\n      // Sort frames within each grouping\n      const sortedHeatmap = dataFrames.sort(sortSeriesByLabel);\n      // And push the sorted grouping with the rest\n      processedHeatmapResultsGroupedByQuery.push(mergeHeatmapFrames(transformToHistogramOverTime(sortedHeatmap)));\n    });\n  }\n\n  // Everything else is processed as time_series result and graph preferredVisualisationType\n  const otherFrames = framesWithoutTableHeatmapsAndExemplars.map((dataFrame) => {\n    const df: DataFrame = {\n      ...dataFrame,\n      meta: {\n        ...dataFrame.meta,\n        preferredVisualisationType: 'graph',\n      },\n    };\n    return df;\n  });\n\n  const flattenedProcessedHeatmapFrames = flatten(processedHeatmapResultsGroupedByQuery);\n\n  return {\n    ...response,\n    data: [...otherFrames, ...processedTableFrames, ...flattenedProcessedHeatmapFrames, ...processedExemplarFrames],\n  };\n}\n\nconst HISTOGRAM_QUANTILE_LABEL_NAME = 'le';\n\nexport function transformDFToTable(dfs: DataFrame[]): DataFrame[] {\n  // If no dataFrames or if 1 dataFrames with no values, return original dataFrame\n  if (dfs.length === 0 || (dfs.length === 1 && dfs[0].length === 0)) {\n    return dfs;\n  }\n\n  // Group results by refId and process dataFrames with the same refId as 1 dataFrame\n  const dataFramesByRefId = groupBy(dfs, 'refId');\n  const refIds = Object.keys(dataFramesByRefId);\n\n  const frames = refIds.map((refId) => {\n    // Create timeField, valueField and labelFields\n    const valueText = getValueText(refIds.length, refId);\n    const valueField = getValueField({ data: [], valueName: valueText });\n    const timeField = getTimeField([]);\n    const labelFields: Field[] = [];\n\n    // Fill labelsFields with labels from dataFrames\n    dataFramesByRefId[refId].forEach((df) => {\n      const frameValueField = df.fields[1];\n      const promLabels = frameValueField?.labels ?? {};\n\n      Object.keys(promLabels)\n        .sort()\n        .forEach((label) => {\n          // If we don't have label in labelFields, add it\n          if (!labelFields.some((l) => l.name === label)) {\n            labelFields.push({\n              name: label,\n              config: { filterable: true },\n              type: FieldType.string,\n              values: [],\n            });\n          }\n        });\n    });\n\n    let prevTime = -Infinity;\n    let needsSort = false;\n\n    // Fill valueField, timeField and labelFields with values\n    dataFramesByRefId[refId].forEach((df) => {\n      timeField.config.interval ??= df.fields[0]?.config.interval;\n\n      const timeFields = df.fields[0]?.values ?? [];\n      const dataFields = df.fields[1]?.values ?? [];\n\n      timeFields.forEach((value) => {\n        timeField.values.push(value);\n\n        if (value < prevTime) {\n          needsSort = true;\n        }\n\n        prevTime = value;\n      });\n\n      dataFields.forEach((value) => {\n        valueField.values.push(parseSampleValue(value));\n        const labelsForField = df.fields[1].labels ?? {};\n        labelFields.forEach((field) => field.values.push(getLabelValue(labelsForField, field.name)));\n      });\n    });\n\n    const fields = [timeField, ...labelFields, valueField];\n\n    const frame: DataFrame = {\n      refId,\n      fields,\n      // Prometheus specific UI for instant queries\n      meta: {\n        ...dataFramesByRefId[refId][0].meta,\n        preferredVisualisationType: 'rawPrometheus' as const,\n      },\n      length: timeField.values.length,\n    };\n\n    return needsSort ? sortDataFrame(frame, 0) : frame;\n  });\n\n  return frames;\n}\n\nfunction getValueText(responseLength: number, refId = '') {\n  return responseLength > 1 ? `Value #${refId}` : 'Value';\n}\n\nfunction getDataLinks(options: ExemplarTraceIdDestination): DataLink[] {\n  const dataLinks: DataLink[] = [];\n\n  if (options.datasourceUid) {\n    const dataSourceSrv = getDataSourceSrv();\n    const dsSettings = dataSourceSrv.getInstanceSettings(options.datasourceUid);\n\n    // dsSettings is undefined because of the reasons below:\n    // - permissions issues (probably most likely)\n    // - deleted datasource\n    // - misconfiguration\n    if (dsSettings) {\n      dataLinks.push({\n        title: options.urlDisplayLabel || `Query with ${dsSettings?.name}`,\n        url: '',\n        internal: {\n          query: { query: '${__value.raw}', queryType: 'traceql' },\n          panelsState: {\n            trace: {\n              spanId: '${__data.fields[\"span_id\"]}',\n            },\n          },\n          datasourceUid: options.datasourceUid,\n          datasourceName: dsSettings?.name ?? 'Data source not found',\n        },\n      });\n    }\n  }\n\n  if (options.url) {\n    dataLinks.push({\n      title: options.urlDisplayLabel || `Go to ${options.url}`,\n      url: options.url,\n      targetBlank: true,\n    });\n  }\n  return dataLinks;\n}\n\nfunction getLabelValue(metric: PromMetric, label: string): string | number {\n  if (metric.hasOwnProperty(label)) {\n    return metric[label];\n  }\n  return '';\n}\n\nfunction getTimeField(data: PromValue[], isMs = false): Field<number> {\n  return {\n    name: TIME_SERIES_TIME_FIELD_NAME,\n    type: FieldType.time,\n    config: {},\n    values: data.map((val) => (isMs ? val[0] : val[0] * 1000)),\n  };\n}\n\ntype ValueFieldOptions = {\n  data: PromValue[];\n  valueName?: string;\n  parseValue?: boolean;\n  labels?: Labels;\n  displayNameFromDS?: string;\n};\n\nfunction getValueField({\n  data,\n  valueName = TIME_SERIES_VALUE_FIELD_NAME,\n  parseValue = true,\n  labels,\n  displayNameFromDS,\n}: ValueFieldOptions): Field {\n  return {\n    name: valueName,\n    type: FieldType.number,\n    display: getDisplayProcessor(),\n    config: {\n      displayNameFromDS,\n    },\n    labels,\n    values: data.map((val) => (parseValue ? parseSampleValue(val[1]) : val[1])),\n  };\n}\n\nexport function getOriginalMetricName(labelData: { [key: string]: string }) {\n  const metricName = labelData.__name__ || '';\n  delete labelData.__name__;\n  const labelPart = Object.entries(labelData)\n    .map((label) => `${label[0]}=\"${label[1]}\"`)\n    .join(',');\n  return `${metricName}{${labelPart}}`;\n}\n\nfunction mergeHeatmapFrames(frames: DataFrame[]): DataFrame[] {\n  if (frames.length === 0 || (frames.length === 1 && frames[0].length === 0)) {\n    return [];\n  }\n\n  const timeField = frames[0].fields.find((field) => field.type === FieldType.time)!;\n  const countFields = frames.map((frame) => {\n    let field = frame.fields.find((field) => field.type === FieldType.number)!;\n\n    return {\n      ...field,\n      name: field.config.displayNameFromDS!,\n    };\n  });\n\n  return [\n    {\n      ...frames[0],\n      meta: {\n        ...frames[0].meta,\n        type: DataFrameType.HeatmapRows,\n      },\n      fields: [timeField!, ...countFields],\n    },\n  ];\n}\n\n/** @internal */\nexport function transformToHistogramOverTime(seriesList: DataFrame[]): DataFrame[] {\n  /*      t1 = timestamp1, t2 = timestamp2 etc.\n            t1  t2  t3          t1  t2  t3\n    le10    10  10  0     =>    10  10  0\n    le20    20  10  30    =>    10  0   30\n    le30    30  10  35    =>    10  0   5\n    */\n\n  for (let i = seriesList.length - 1; i > 0; i--) {\n    const topSeries = seriesList[i].fields.find((s) => s.type === FieldType.number);\n    const bottomSeries = seriesList[i - 1].fields.find((s) => s.type === FieldType.number);\n    if (!topSeries || !bottomSeries) {\n      throw new Error('Prometheus heatmap transform error: data should be a time series');\n    }\n\n    for (let j = 0; j < topSeries.values.length; j++) {\n      const bottomPoint = bottomSeries.values[j] || [0];\n      topSeries.values[j] -= bottomPoint;\n\n      if (topSeries.values[j] < 1e-9) {\n        topSeries.values[j] = 0;\n      }\n    }\n  }\n\n  return seriesList;\n}\n\nexport function sortSeriesByLabel(s1: DataFrame, s2: DataFrame): number {\n  let le1, le2;\n\n  try {\n    // the state.displayName conditions are here because we also use this sorting util fn\n    // in panels where isHeatmapResult was false but we still want to sort numerically-named\n    // fields after the full unique displayName is cached in field state\n    le1 = parseSampleValue(s1.fields[1].state?.displayName ?? s1.name ?? s1.fields[1].name);\n    le2 = parseSampleValue(s2.fields[1].state?.displayName ?? s2.name ?? s2.fields[1].name);\n  } catch (err) {\n    // fail if not integer. might happen with bad queries\n    console.error(err);\n    return 0;\n  }\n\n  if (le1 > le2) {\n    return 1;\n  }\n\n  if (le1 < le2) {\n    return -1;\n  }\n\n  return 0;\n}\n\n/** @internal */\nexport function parseSampleValue(value: string): number {\n  if (INFINITY_SAMPLE_REGEX.test(value)) {\n    return value[0] === '-' ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;\n  }\n  return parseFloat(value);\n}\n","import { NodeProp } from '@lezer/common';\n\nlet nextTagID = 0;\n/**\nHighlighting tags are markers that denote a highlighting category.\nThey are [associated](#highlight.styleTags) with parts of a syntax\ntree by a language mode, and then mapped to an actual CSS style by\na [highlighter](#highlight.Highlighter).\n\nBecause syntax tree node types and highlight styles have to be\nable to talk the same language, CodeMirror uses a mostly _closed_\n[vocabulary](#highlight.tags) of syntax tags (as opposed to\ntraditional open string-based systems, which make it hard for\nhighlighting themes to cover all the tokens produced by the\nvarious languages).\n\nIt _is_ possible to [define](#highlight.Tag^define) your own\nhighlighting tags for system-internal use (where you control both\nthe language package and the highlighter), but such tags will not\nbe picked up by regular highlighters (though you can derive them\nfrom standard tags to allow highlighters to fall back to those).\n*/\nclass Tag {\n    /**\n    @internal\n    */\n    constructor(\n    /**\n    The optional name of the base tag @internal\n    */\n    name, \n    /**\n    The set of this tag and all its parent tags, starting with\n    this one itself and sorted in order of decreasing specificity.\n    */\n    set, \n    /**\n    The base unmodified tag that this one is based on, if it's\n    modified @internal\n    */\n    base, \n    /**\n    The modifiers applied to this.base @internal\n    */\n    modified) {\n        this.name = name;\n        this.set = set;\n        this.base = base;\n        this.modified = modified;\n        /**\n        @internal\n        */\n        this.id = nextTagID++;\n    }\n    toString() {\n        let { name } = this;\n        for (let mod of this.modified)\n            if (mod.name)\n                name = `${mod.name}(${name})`;\n        return name;\n    }\n    static define(nameOrParent, parent) {\n        let name = typeof nameOrParent == \"string\" ? nameOrParent : \"?\";\n        if (nameOrParent instanceof Tag)\n            parent = nameOrParent;\n        if (parent === null || parent === void 0 ? void 0 : parent.base)\n            throw new Error(\"Can not derive from a modified tag\");\n        let tag = new Tag(name, [], null, []);\n        tag.set.push(tag);\n        if (parent)\n            for (let t of parent.set)\n                tag.set.push(t);\n        return tag;\n    }\n    /**\n    Define a tag _modifier_, which is a function that, given a tag,\n    will return a tag that is a subtag of the original. Applying the\n    same modifier to a twice tag will return the same value (`m1(t1)\n    == m1(t1)`) and applying multiple modifiers will, regardless or\n    order, produce the same tag (`m1(m2(t1)) == m2(m1(t1))`).\n    \n    When multiple modifiers are applied to a given base tag, each\n    smaller set of modifiers is registered as a parent, so that for\n    example `m1(m2(m3(t1)))` is a subtype of `m1(m2(t1))`,\n    `m1(m3(t1)`, and so on.\n    */\n    static defineModifier(name) {\n        let mod = new Modifier(name);\n        return (tag) => {\n            if (tag.modified.indexOf(mod) > -1)\n                return tag;\n            return Modifier.get(tag.base || tag, tag.modified.concat(mod).sort((a, b) => a.id - b.id));\n        };\n    }\n}\nlet nextModifierID = 0;\nclass Modifier {\n    constructor(name) {\n        this.name = name;\n        this.instances = [];\n        this.id = nextModifierID++;\n    }\n    static get(base, mods) {\n        if (!mods.length)\n            return base;\n        let exists = mods[0].instances.find(t => t.base == base && sameArray(mods, t.modified));\n        if (exists)\n            return exists;\n        let set = [], tag = new Tag(base.name, set, base, mods);\n        for (let m of mods)\n            m.instances.push(tag);\n        let configs = powerSet(mods);\n        for (let parent of base.set)\n            if (!parent.modified.length)\n                for (let config of configs)\n                    set.push(Modifier.get(parent, config));\n        return tag;\n    }\n}\nfunction sameArray(a, b) {\n    return a.length == b.length && a.every((x, i) => x == b[i]);\n}\nfunction powerSet(array) {\n    let sets = [[]];\n    for (let i = 0; i < array.length; i++) {\n        for (let j = 0, e = sets.length; j < e; j++) {\n            sets.push(sets[j].concat(array[i]));\n        }\n    }\n    return sets.sort((a, b) => b.length - a.length);\n}\n/**\nThis function is used to add a set of tags to a language syntax\nvia [`NodeSet.extend`](#common.NodeSet.extend) or\n[`LRParser.configure`](#lr.LRParser.configure).\n\nThe argument object maps node selectors to [highlighting\ntags](#highlight.Tag) or arrays of tags.\n\nNode selectors may hold one or more (space-separated) node paths.\nSuch a path can be a [node name](#common.NodeType.name), or\nmultiple node names (or `*` wildcards) separated by slash\ncharacters, as in `\"Block/Declaration/VariableName\"`. Such a path\nmatches the final node but only if its direct parent nodes are the\nother nodes mentioned. A `*` in such a path matches any parent,\nbut only a single levelwildcards that match multiple parents\naren't supported, both for efficiency reasons and because Lezer\ntrees make it rather hard to reason about what they would match.)\n\nA path can be ended with `/...` to indicate that the tag assigned\nto the node should also apply to all child nodes, even if they\nmatch their own style (by default, only the innermost style is\nused).\n\nWhen a path ends in `!`, as in `Attribute!`, no further matching\nhappens for the node's child nodes, and the entire node gets the\ngiven style.\n\nIn this notation, node names that contain `/`, `!`, `*`, or `...`\nmust be quoted as JSON strings.\n\nFor example:\n\n```javascript\nparser.withProps(\n  styleTags({\n    // Style Number and BigNumber nodes\n    \"Number BigNumber\": tags.number,\n    // Style Escape nodes whose parent is String\n    \"String/Escape\": tags.escape,\n    // Style anything inside Attributes nodes\n    \"Attributes!\": tags.meta,\n    // Add a style to all content inside Italic nodes\n    \"Italic/...\": tags.emphasis,\n    // Style InvalidString nodes as both `string` and `invalid`\n    \"InvalidString\": [tags.string, tags.invalid],\n    // Style the node named \"/\" as punctuation\n    '\"/\"': tags.punctuation\n  })\n)\n```\n*/\nfunction styleTags(spec) {\n    let byName = Object.create(null);\n    for (let prop in spec) {\n        let tags = spec[prop];\n        if (!Array.isArray(tags))\n            tags = [tags];\n        for (let part of prop.split(\" \"))\n            if (part) {\n                let pieces = [], mode = 2 /* Mode.Normal */, rest = part;\n                for (let pos = 0;;) {\n                    if (rest == \"...\" && pos > 0 && pos + 3 == part.length) {\n                        mode = 1 /* Mode.Inherit */;\n                        break;\n                    }\n                    let m = /^\"(?:[^\"\\\\]|\\\\.)*?\"|[^\\/!]+/.exec(rest);\n                    if (!m)\n                        throw new RangeError(\"Invalid path: \" + part);\n                    pieces.push(m[0] == \"*\" ? \"\" : m[0][0] == '\"' ? JSON.parse(m[0]) : m[0]);\n                    pos += m[0].length;\n                    if (pos == part.length)\n                        break;\n                    let next = part[pos++];\n                    if (pos == part.length && next == \"!\") {\n                        mode = 0 /* Mode.Opaque */;\n                        break;\n                    }\n                    if (next != \"/\")\n                        throw new RangeError(\"Invalid path: \" + part);\n                    rest = part.slice(pos);\n                }\n                let last = pieces.length - 1, inner = pieces[last];\n                if (!inner)\n                    throw new RangeError(\"Invalid path: \" + part);\n                let rule = new Rule(tags, mode, last > 0 ? pieces.slice(0, last) : null);\n                byName[inner] = rule.sort(byName[inner]);\n            }\n    }\n    return ruleNodeProp.add(byName);\n}\nconst ruleNodeProp = new NodeProp();\nclass Rule {\n    constructor(tags, mode, context, next) {\n        this.tags = tags;\n        this.mode = mode;\n        this.context = context;\n        this.next = next;\n    }\n    get opaque() { return this.mode == 0 /* Mode.Opaque */; }\n    get inherit() { return this.mode == 1 /* Mode.Inherit */; }\n    sort(other) {\n        if (!other || other.depth < this.depth) {\n            this.next = other;\n            return this;\n        }\n        other.next = this.sort(other.next);\n        return other;\n    }\n    get depth() { return this.context ? this.context.length : 0; }\n}\nRule.empty = new Rule([], 2 /* Mode.Normal */, null);\n/**\nDefine a [highlighter](#highlight.Highlighter) from an array of\ntag/class pairs. Classes associated with more specific tags will\ntake precedence.\n*/\nfunction tagHighlighter(tags, options) {\n    let map = Object.create(null);\n    for (let style of tags) {\n        if (!Array.isArray(style.tag))\n            map[style.tag.id] = style.class;\n        else\n            for (let tag of style.tag)\n                map[tag.id] = style.class;\n    }\n    let { scope, all = null } = options || {};\n    return {\n        style: (tags) => {\n            let cls = all;\n            for (let tag of tags) {\n                for (let sub of tag.set) {\n                    let tagClass = map[sub.id];\n                    if (tagClass) {\n                        cls = cls ? cls + \" \" + tagClass : tagClass;\n                        break;\n                    }\n                }\n            }\n            return cls;\n        },\n        scope\n    };\n}\nfunction highlightTags(highlighters, tags) {\n    let result = null;\n    for (let highlighter of highlighters) {\n        let value = highlighter.style(tags);\n        if (value)\n            result = result ? result + \" \" + value : value;\n    }\n    return result;\n}\n/**\nHighlight the given [tree](#common.Tree) with the given\n[highlighter](#highlight.Highlighter). Often, the higher-level\n[`highlightCode`](#highlight.highlightCode) function is easier to\nuse.\n*/\nfunction highlightTree(tree, highlighter, \n/**\nAssign styling to a region of the text. Will be called, in order\nof position, for any ranges where more than zero classes apply.\n`classes` is a space separated string of CSS classes.\n*/\nputStyle, \n/**\nThe start of the range to highlight.\n*/\nfrom = 0, \n/**\nThe end of the range.\n*/\nto = tree.length) {\n    let builder = new HighlightBuilder(from, Array.isArray(highlighter) ? highlighter : [highlighter], putStyle);\n    builder.highlightRange(tree.cursor(), from, to, \"\", builder.highlighters);\n    builder.flush(to);\n}\n/**\nHighlight the given tree with the given highlighter, calling\n`putText` for every piece of text, either with a set of classes or\nwith the empty string when unstyled, and `putBreak` for every line\nbreak.\n*/\nfunction highlightCode(code, tree, highlighter, putText, putBreak, from = 0, to = code.length) {\n    let pos = from;\n    function writeTo(p, classes) {\n        if (p <= pos)\n            return;\n        for (let text = code.slice(pos, p), i = 0;;) {\n            let nextBreak = text.indexOf(\"\\n\", i);\n            let upto = nextBreak < 0 ? text.length : nextBreak;\n            if (upto > i)\n                putText(text.slice(i, upto), classes);\n            if (nextBreak < 0)\n                break;\n            putBreak();\n            i = nextBreak + 1;\n        }\n        pos = p;\n    }\n    highlightTree(tree, highlighter, (from, to, classes) => {\n        writeTo(from, \"\");\n        writeTo(to, classes);\n    }, from, to);\n    writeTo(to, \"\");\n}\nclass HighlightBuilder {\n    constructor(at, highlighters, span) {\n        this.at = at;\n        this.highlighters = highlighters;\n        this.span = span;\n        this.class = \"\";\n    }\n    startSpan(at, cls) {\n        if (cls != this.class) {\n            this.flush(at);\n            if (at > this.at)\n                this.at = at;\n            this.class = cls;\n        }\n    }\n    flush(to) {\n        if (to > this.at && this.class)\n            this.span(this.at, to, this.class);\n    }\n    highlightRange(cursor, from, to, inheritedClass, highlighters) {\n        let { type, from: start, to: end } = cursor;\n        if (start >= to || end <= from)\n            return;\n        if (type.isTop)\n            highlighters = this.highlighters.filter(h => !h.scope || h.scope(type));\n        let cls = inheritedClass;\n        let rule = getStyleTags(cursor) || Rule.empty;\n        let tagCls = highlightTags(highlighters, rule.tags);\n        if (tagCls) {\n            if (cls)\n                cls += \" \";\n            cls += tagCls;\n            if (rule.mode == 1 /* Mode.Inherit */)\n                inheritedClass += (inheritedClass ? \" \" : \"\") + tagCls;\n        }\n        this.startSpan(Math.max(from, start), cls);\n        if (rule.opaque)\n            return;\n        let mounted = cursor.tree && cursor.tree.prop(NodeProp.mounted);\n        if (mounted && mounted.overlay) {\n            let inner = cursor.node.enter(mounted.overlay[0].from + start, 1);\n            let innerHighlighters = this.highlighters.filter(h => !h.scope || h.scope(mounted.tree.type));\n            let hasChild = cursor.firstChild();\n            for (let i = 0, pos = start;; i++) {\n                let next = i < mounted.overlay.length ? mounted.overlay[i] : null;\n                let nextPos = next ? next.from + start : end;\n                let rangeFrom = Math.max(from, pos), rangeTo = Math.min(to, nextPos);\n                if (rangeFrom < rangeTo && hasChild) {\n                    while (cursor.from < rangeTo) {\n                        this.highlightRange(cursor, rangeFrom, rangeTo, inheritedClass, highlighters);\n                        this.startSpan(Math.min(rangeTo, cursor.to), cls);\n                        if (cursor.to >= nextPos || !cursor.nextSibling())\n                            break;\n                    }\n                }\n                if (!next || nextPos > to)\n                    break;\n                pos = next.to + start;\n                if (pos > from) {\n                    this.highlightRange(inner.cursor(), Math.max(from, next.from + start), Math.min(to, pos), \"\", innerHighlighters);\n                    this.startSpan(Math.min(to, pos), cls);\n                }\n            }\n            if (hasChild)\n                cursor.parent();\n        }\n        else if (cursor.firstChild()) {\n            if (mounted)\n                inheritedClass = \"\";\n            do {\n                if (cursor.to <= from)\n                    continue;\n                if (cursor.from >= to)\n                    break;\n                this.highlightRange(cursor, from, to, inheritedClass, highlighters);\n                this.startSpan(Math.min(to, cursor.to), cls);\n            } while (cursor.nextSibling());\n            cursor.parent();\n        }\n    }\n}\n/**\nMatch a syntax node's [highlight rules](#highlight.styleTags). If\nthere's a match, return its set of tags, and whether it is\nopaque (uses a `!`) or applies to all child nodes (`/...`).\n*/\nfunction getStyleTags(node) {\n    let rule = node.type.prop(ruleNodeProp);\n    while (rule && rule.context && !node.matchContext(rule.context))\n        rule = rule.next;\n    return rule || null;\n}\nconst t = Tag.define;\nconst comment = t(), name = t(), typeName = t(name), propertyName = t(name), literal = t(), string = t(literal), number = t(literal), content = t(), heading = t(content), keyword = t(), operator = t(), punctuation = t(), bracket = t(punctuation), meta = t();\n/**\nThe default set of highlighting [tags](#highlight.Tag).\n\nThis collection is heavily biased towards programming languages,\nand necessarily incomplete. A full ontology of syntactic\nconstructs would fill a stack of books, and be impractical to\nwrite themes for. So try to make do with this set. If all else\nfails, [open an\nissue](https://github.com/codemirror/codemirror.next) to propose a\nnew tag, or [define](#highlight.Tag^define) a local custom tag for\nyour use case.\n\nNote that it is not obligatory to always attach the most specific\ntag possible to an elementif your grammar can't easily\ndistinguish a certain type of element (such as a local variable),\nit is okay to style it as its more general variant (a variable).\n\nFor tags that extend some parent tag, the documentation links to\nthe parent.\n*/\nconst tags = {\n    /**\n    A comment.\n    */\n    comment,\n    /**\n    A line [comment](#highlight.tags.comment).\n    */\n    lineComment: t(comment),\n    /**\n    A block [comment](#highlight.tags.comment).\n    */\n    blockComment: t(comment),\n    /**\n    A documentation [comment](#highlight.tags.comment).\n    */\n    docComment: t(comment),\n    /**\n    Any kind of identifier.\n    */\n    name,\n    /**\n    The [name](#highlight.tags.name) of a variable.\n    */\n    variableName: t(name),\n    /**\n    A type [name](#highlight.tags.name).\n    */\n    typeName: typeName,\n    /**\n    A tag name (subtag of [`typeName`](#highlight.tags.typeName)).\n    */\n    tagName: t(typeName),\n    /**\n    A property or field [name](#highlight.tags.name).\n    */\n    propertyName: propertyName,\n    /**\n    An attribute name (subtag of [`propertyName`](#highlight.tags.propertyName)).\n    */\n    attributeName: t(propertyName),\n    /**\n    The [name](#highlight.tags.name) of a class.\n    */\n    className: t(name),\n    /**\n    A label [name](#highlight.tags.name).\n    */\n    labelName: t(name),\n    /**\n    A namespace [name](#highlight.tags.name).\n    */\n    namespace: t(name),\n    /**\n    The [name](#highlight.tags.name) of a macro.\n    */\n    macroName: t(name),\n    /**\n    A literal value.\n    */\n    literal,\n    /**\n    A string [literal](#highlight.tags.literal).\n    */\n    string,\n    /**\n    A documentation [string](#highlight.tags.string).\n    */\n    docString: t(string),\n    /**\n    A character literal (subtag of [string](#highlight.tags.string)).\n    */\n    character: t(string),\n    /**\n    An attribute value (subtag of [string](#highlight.tags.string)).\n    */\n    attributeValue: t(string),\n    /**\n    A number [literal](#highlight.tags.literal).\n    */\n    number,\n    /**\n    An integer [number](#highlight.tags.number) literal.\n    */\n    integer: t(number),\n    /**\n    A floating-point [number](#highlight.tags.number) literal.\n    */\n    float: t(number),\n    /**\n    A boolean [literal](#highlight.tags.literal).\n    */\n    bool: t(literal),\n    /**\n    Regular expression [literal](#highlight.tags.literal).\n    */\n    regexp: t(literal),\n    /**\n    An escape [literal](#highlight.tags.literal), for example a\n    backslash escape in a string.\n    */\n    escape: t(literal),\n    /**\n    A color [literal](#highlight.tags.literal).\n    */\n    color: t(literal),\n    /**\n    A URL [literal](#highlight.tags.literal).\n    */\n    url: t(literal),\n    /**\n    A language keyword.\n    */\n    keyword,\n    /**\n    The [keyword](#highlight.tags.keyword) for the self or this\n    object.\n    */\n    self: t(keyword),\n    /**\n    The [keyword](#highlight.tags.keyword) for null.\n    */\n    null: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) denoting some atomic value.\n    */\n    atom: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that represents a unit.\n    */\n    unit: t(keyword),\n    /**\n    A modifier [keyword](#highlight.tags.keyword).\n    */\n    modifier: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that acts as an operator.\n    */\n    operatorKeyword: t(keyword),\n    /**\n    A control-flow related [keyword](#highlight.tags.keyword).\n    */\n    controlKeyword: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) that defines something.\n    */\n    definitionKeyword: t(keyword),\n    /**\n    A [keyword](#highlight.tags.keyword) related to defining or\n    interfacing with modules.\n    */\n    moduleKeyword: t(keyword),\n    /**\n    An operator.\n    */\n    operator,\n    /**\n    An [operator](#highlight.tags.operator) that dereferences something.\n    */\n    derefOperator: t(operator),\n    /**\n    Arithmetic-related [operator](#highlight.tags.operator).\n    */\n    arithmeticOperator: t(operator),\n    /**\n    Logical [operator](#highlight.tags.operator).\n    */\n    logicOperator: t(operator),\n    /**\n    Bit [operator](#highlight.tags.operator).\n    */\n    bitwiseOperator: t(operator),\n    /**\n    Comparison [operator](#highlight.tags.operator).\n    */\n    compareOperator: t(operator),\n    /**\n    [Operator](#highlight.tags.operator) that updates its operand.\n    */\n    updateOperator: t(operator),\n    /**\n    [Operator](#highlight.tags.operator) that defines something.\n    */\n    definitionOperator: t(operator),\n    /**\n    Type-related [operator](#highlight.tags.operator).\n    */\n    typeOperator: t(operator),\n    /**\n    Control-flow [operator](#highlight.tags.operator).\n    */\n    controlOperator: t(operator),\n    /**\n    Program or markup punctuation.\n    */\n    punctuation,\n    /**\n    [Punctuation](#highlight.tags.punctuation) that separates\n    things.\n    */\n    separator: t(punctuation),\n    /**\n    Bracket-style [punctuation](#highlight.tags.punctuation).\n    */\n    bracket,\n    /**\n    Angle [brackets](#highlight.tags.bracket) (usually `<` and `>`\n    tokens).\n    */\n    angleBracket: t(bracket),\n    /**\n    Square [brackets](#highlight.tags.bracket) (usually `[` and `]`\n    tokens).\n    */\n    squareBracket: t(bracket),\n    /**\n    Parentheses (usually `(` and `)` tokens). Subtag of\n    [bracket](#highlight.tags.bracket).\n    */\n    paren: t(bracket),\n    /**\n    Braces (usually `{` and `}` tokens). Subtag of\n    [bracket](#highlight.tags.bracket).\n    */\n    brace: t(bracket),\n    /**\n    Content, for example plain text in XML or markup documents.\n    */\n    content,\n    /**\n    [Content](#highlight.tags.content) that represents a heading.\n    */\n    heading,\n    /**\n    A level 1 [heading](#highlight.tags.heading).\n    */\n    heading1: t(heading),\n    /**\n    A level 2 [heading](#highlight.tags.heading).\n    */\n    heading2: t(heading),\n    /**\n    A level 3 [heading](#highlight.tags.heading).\n    */\n    heading3: t(heading),\n    /**\n    A level 4 [heading](#highlight.tags.heading).\n    */\n    heading4: t(heading),\n    /**\n    A level 5 [heading](#highlight.tags.heading).\n    */\n    heading5: t(heading),\n    /**\n    A level 6 [heading](#highlight.tags.heading).\n    */\n    heading6: t(heading),\n    /**\n    A prose [content](#highlight.tags.content) separator (such as a horizontal rule).\n    */\n    contentSeparator: t(content),\n    /**\n    [Content](#highlight.tags.content) that represents a list.\n    */\n    list: t(content),\n    /**\n    [Content](#highlight.tags.content) that represents a quote.\n    */\n    quote: t(content),\n    /**\n    [Content](#highlight.tags.content) that is emphasized.\n    */\n    emphasis: t(content),\n    /**\n    [Content](#highlight.tags.content) that is styled strong.\n    */\n    strong: t(content),\n    /**\n    [Content](#highlight.tags.content) that is part of a link.\n    */\n    link: t(content),\n    /**\n    [Content](#highlight.tags.content) that is styled as code or\n    monospace.\n    */\n    monospace: t(content),\n    /**\n    [Content](#highlight.tags.content) that has a strike-through\n    style.\n    */\n    strikethrough: t(content),\n    /**\n    Inserted text in a change-tracking format.\n    */\n    inserted: t(),\n    /**\n    Deleted text.\n    */\n    deleted: t(),\n    /**\n    Changed text.\n    */\n    changed: t(),\n    /**\n    An invalid or unsyntactic element.\n    */\n    invalid: t(),\n    /**\n    Metadata or meta-instruction.\n    */\n    meta,\n    /**\n    [Metadata](#highlight.tags.meta) that applies to the entire\n    document.\n    */\n    documentMeta: t(meta),\n    /**\n    [Metadata](#highlight.tags.meta) that annotates or adds\n    attributes to a given syntactic element.\n    */\n    annotation: t(meta),\n    /**\n    Processing instruction or preprocessor directive. Subtag of\n    [meta](#highlight.tags.meta).\n    */\n    processingInstruction: t(meta),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates that a\n    given element is being defined. Expected to be used with the\n    various [name](#highlight.tags.name) tags.\n    */\n    definition: Tag.defineModifier(\"definition\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates that\n    something is constant. Mostly expected to be used with\n    [variable names](#highlight.tags.variableName).\n    */\n    constant: Tag.defineModifier(\"constant\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) used to indicate that\n    a [variable](#highlight.tags.variableName) or [property\n    name](#highlight.tags.propertyName) is being called or defined\n    as a function.\n    */\n    function: Tag.defineModifier(\"function\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that can be applied to\n    [names](#highlight.tags.name) to indicate that they belong to\n    the language's standard environment.\n    */\n    standard: Tag.defineModifier(\"standard\"),\n    /**\n    [Modifier](#highlight.Tag^defineModifier) that indicates a given\n    [names](#highlight.tags.name) is local to some scope.\n    */\n    local: Tag.defineModifier(\"local\"),\n    /**\n    A generic variant [modifier](#highlight.Tag^defineModifier) that\n    can be used to tag language-specific alternative variants of\n    some common tag. It is recommended for themes to define special\n    forms of at least the [string](#highlight.tags.string) and\n    [variable name](#highlight.tags.variableName) tags, since those\n    come up a lot.\n    */\n    special: Tag.defineModifier(\"special\")\n};\nfor (let name in tags) {\n    let val = tags[name];\n    if (val instanceof Tag)\n        val.name = name;\n}\n/**\nThis is a highlighter that adds stable, predictable classes to\ntokens, for styling with external CSS.\n\nThe following tags are mapped to their name prefixed with `\"tok-\"`\n(for example `\"tok-comment\"`):\n\n* [`link`](#highlight.tags.link)\n* [`heading`](#highlight.tags.heading)\n* [`emphasis`](#highlight.tags.emphasis)\n* [`strong`](#highlight.tags.strong)\n* [`keyword`](#highlight.tags.keyword)\n* [`atom`](#highlight.tags.atom)\n* [`bool`](#highlight.tags.bool)\n* [`url`](#highlight.tags.url)\n* [`labelName`](#highlight.tags.labelName)\n* [`inserted`](#highlight.tags.inserted)\n* [`deleted`](#highlight.tags.deleted)\n* [`literal`](#highlight.tags.literal)\n* [`string`](#highlight.tags.string)\n* [`number`](#highlight.tags.number)\n* [`variableName`](#highlight.tags.variableName)\n* [`typeName`](#highlight.tags.typeName)\n* [`namespace`](#highlight.tags.namespace)\n* [`className`](#highlight.tags.className)\n* [`macroName`](#highlight.tags.macroName)\n* [`propertyName`](#highlight.tags.propertyName)\n* [`operator`](#highlight.tags.operator)\n* [`comment`](#highlight.tags.comment)\n* [`meta`](#highlight.tags.meta)\n* [`punctuation`](#highlight.tags.punctuation)\n* [`invalid`](#highlight.tags.invalid)\n\nIn addition, these mappings are provided:\n\n* [`regexp`](#highlight.tags.regexp),\n  [`escape`](#highlight.tags.escape), and\n  [`special`](#highlight.tags.special)[`(string)`](#highlight.tags.string)\n  are mapped to `\"tok-string2\"`\n* [`special`](#highlight.tags.special)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName2\"`\n* [`local`](#highlight.tags.local)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName tok-local\"`\n* [`definition`](#highlight.tags.definition)[`(variableName)`](#highlight.tags.variableName)\n  to `\"tok-variableName tok-definition\"`\n* [`definition`](#highlight.tags.definition)[`(propertyName)`](#highlight.tags.propertyName)\n  to `\"tok-propertyName tok-definition\"`\n*/\nconst classHighlighter = tagHighlighter([\n    { tag: tags.link, class: \"tok-link\" },\n    { tag: tags.heading, class: \"tok-heading\" },\n    { tag: tags.emphasis, class: \"tok-emphasis\" },\n    { tag: tags.strong, class: \"tok-strong\" },\n    { tag: tags.keyword, class: \"tok-keyword\" },\n    { tag: tags.atom, class: \"tok-atom\" },\n    { tag: tags.bool, class: \"tok-bool\" },\n    { tag: tags.url, class: \"tok-url\" },\n    { tag: tags.labelName, class: \"tok-labelName\" },\n    { tag: tags.inserted, class: \"tok-inserted\" },\n    { tag: tags.deleted, class: \"tok-deleted\" },\n    { tag: tags.literal, class: \"tok-literal\" },\n    { tag: tags.string, class: \"tok-string\" },\n    { tag: tags.number, class: \"tok-number\" },\n    { tag: [tags.regexp, tags.escape, tags.special(tags.string)], class: \"tok-string2\" },\n    { tag: tags.variableName, class: \"tok-variableName\" },\n    { tag: tags.local(tags.variableName), class: \"tok-variableName tok-local\" },\n    { tag: tags.definition(tags.variableName), class: \"tok-variableName tok-definition\" },\n    { tag: tags.special(tags.variableName), class: \"tok-variableName2\" },\n    { tag: tags.definition(tags.propertyName), class: \"tok-propertyName tok-definition\" },\n    { tag: tags.typeName, class: \"tok-typeName\" },\n    { tag: tags.namespace, class: \"tok-namespace\" },\n    { tag: tags.className, class: \"tok-className\" },\n    { tag: tags.macroName, class: \"tok-macroName\" },\n    { tag: tags.propertyName, class: \"tok-propertyName\" },\n    { tag: tags.operator, class: \"tok-operator\" },\n    { tag: tags.comment, class: \"tok-comment\" },\n    { tag: tags.meta, class: \"tok-meta\" },\n    { tag: tags.invalid, class: \"tok-invalid\" },\n    { tag: tags.punctuation, class: \"tok-punctuation\" }\n]);\n\nexport { Tag, classHighlighter, getStyleTags, highlightCode, highlightTree, styleTags, tagHighlighter, tags };\n","import { LRParser } from '@lezer/lr';\nimport { styleTags, tags } from '@lezer/highlight';\n\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst inf$1 = 158,\n  nan$1 = 159,\n  Bool$1 = 1,\n  Ignoring$1 = 2,\n  On$1 = 3,\n  GroupLeft$1 = 4,\n  GroupRight$1 = 5,\n  Offset$1 = 6,\n  Atan2$1 = 7,\n  Avg$1 = 8,\n  Bottomk$1 = 9,\n  Count$1 = 10,\n  CountValues$1 = 11,\n  Group$1 = 12,\n  Max$1 = 13,\n  Min$1 = 14,\n  Quantile$1 = 15,\n  LimitK$1 = 16,\n  LimitRatio$1 = 17,\n  Stddev$1 = 18,\n  Stdvar$1 = 19,\n  Sum$1 = 20,\n  Topk$1 = 21,\n  By$1 = 22,\n  Without$1 = 23,\n  And$1 = 24,\n  Or$1 = 25,\n  Unless$1 = 26,\n  Start$1 = 27,\n  End$1 = 28;\n\n// Copyright 2021 The Prometheus Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\nconst keywordTokens = {\n    inf: inf$1,\n    nan: nan$1,\n    bool: Bool$1,\n    ignoring: Ignoring$1,\n    on: On$1,\n    group_left: GroupLeft$1,\n    group_right: GroupRight$1,\n    offset: Offset$1,\n};\n\nconst specializeIdentifier = (value, stack) => {\n    return keywordTokens[value.toLowerCase()] || -1;\n};\n\nconst contextualKeywordTokens = {\n    avg: Avg$1,\n    atan2: Atan2$1,\n    bottomk: Bottomk$1,\n    count: Count$1,\n    count_values: CountValues$1,\n    group: Group$1,\n    max: Max$1,\n    min: Min$1,\n    quantile: Quantile$1,\n    limitk: LimitK$1,\n    limit_ratio: LimitRatio$1,\n    stddev: Stddev$1,\n    stdvar: Stdvar$1,\n    sum: Sum$1,\n    topk: Topk$1,\n    by: By$1,\n    without: Without$1,\n    and: And$1,\n    or: Or$1,\n    unless: Unless$1,\n    start: Start$1,\n    end: End$1,\n};\n\nconst extendIdentifier = (value, stack) => {\n    return contextualKeywordTokens[value.toLowerCase()] || -1;\n};\n\n// Copyright 2022 The Prometheus Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\nconst promQLHighLight = styleTags({\n    LineComment: tags.comment,\n    LabelName: tags.labelName,\n    StringLiteral: tags.string,\n    NumberDurationLiteral: tags.number,\n    NumberDurationLiteralInDurationContext: tags.number,\n    Identifier: tags.variableName,\n    'Abs Absent AbsentOverTime Acos Acosh Asin Asinh Atan Atanh AvgOverTime Ceil Changes Clamp ClampMax ClampMin Cos Cosh CountOverTime DaysInMonth DayOfMonth DayOfWeek DayOfYear Deg Delta Deriv Exp Floor HistogramAvg HistogramCount HistogramFraction HistogramQuantile HistogramSum DoubleExponentialSmoothing Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MaxOverTime MinOverTime Minute Month Pi PredictLinear PresentOverTime QuantileOverTime Rad Rate Resets Round Scalar Sgn Sin Sinh Sort SortDesc SortByLabel SortByLabelDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Tan Tanh Time Timestamp Vector Year':\n        tags.function(tags.variableName),\n    'Avg Bottomk Count Count_values Group LimitK LimitRatio Max Min Quantile Stddev Stdvar Sum Topk': tags.operatorKeyword,\n    'By Without Bool On Ignoring GroupLeft GroupRight Offset Start End': tags.modifier,\n    'And Unless Or': tags.logicOperator,\n    'Sub Add Mul Mod Div Atan2 Eql Neq Lte Lss Gte Gtr EqlRegex EqlSingle NeqRegex Pow At': tags.operator,\n    UnaryOp: tags.arithmeticOperator,\n    '( )': tags.paren,\n    '[ ]': tags.squareBracket,\n    '{ }': tags.brace,\n    '': tags.invalid,\n});\n\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst spec_Identifier = {__proto__:null,absent_over_time:335, absent:337, abs:339, acos:341, acosh:343, asin:345, asinh:347, atan:349, atanh:351, avg_over_time:353, ceil:355, changes:357, clamp:359, clamp_max:361, clamp_min:363, cos:365, cosh:367, count_over_time:369, days_in_month:371, day_of_month:373, day_of_week:375, day_of_year:377, deg:379, delta:381, deriv:383, exp:385, floor:387, histogram_count:389, histogram_fraction:391, histogram_quantile:393, histogram_stddev:395, histogram_stdvar:397, histogram_sum:399, histogram_avg:401, double_exponential_smoothing:403, hour:405, idelta:407, increase:409, info:411, irate:413, label_replace:415, label_join:417, last_over_time:419, ln:421, log10:423, log2:425, mad_over_time:427, max_over_time:429, min_over_time:431, minute:433, month:435, pi:437, predict_linear:439, present_over_time:441, quantile_over_time:443, rad:445, rate:447, resets:449, round:451, scalar:453, sgn:455, sin:457, sinh:459, sort:461, sort_desc:463, sort_by_label:465, sort_by_label_desc:467, sqrt:469, stddev_over_time:471, stdvar_over_time:473, sum_over_time:475, tan:477, tanh:479, timestamp:481, time:483, vector:485, year:487};\nconst parser = LRParser.deserialize({\n  version: 14,\n  states: \"9bOYQPOOO'tQPOOOOQO'#C|'#C|O'yQPO'#C{Q(UQQOOOOQO'#De'#DeO(PQPO'#DdOOQO'#FY'#FYO)cQPO'#F_OYQPO'#F[OYQPO'#F^O0WQSO'#FaO0cQQO'#F`OOQO'#F`'#F`OOQO'#Ft'#FtOOQO'#Df'#DfOOQO'#Dh'#DhOOQO'#Di'#DiOOQO'#Dj'#DjOOQO'#Dk'#DkOOQO'#Dl'#DlOOQO'#Dm'#DmOOQO'#Dn'#DnOOQO'#Do'#DoOOQO'#Dp'#DpOOQO'#Dq'#DqOOQO'#Dr'#DrOOQO'#Ds'#DsOOQO'#Dt'#DtOOQO'#Du'#DuOOQO'#Dv'#DvOOQO'#Dw'#DwOOQO'#Dx'#DxOOQO'#Dy'#DyOOQO'#Dz'#DzOOQO'#D{'#D{OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[OOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsOOQO'#Et'#EtOOQO'#Eu'#EuOOQO'#Ev'#EvOOQO'#Ew'#EwOOQO'#Ex'#ExOOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO'#E|'#E|OOQO'#E}'#E}OOQO'#FO'#FOOOQO'#FP'#FPOOQO'#FQ'#FQOOQO'#FR'#FROOQO'#FS'#FSOOQO'#FT'#FTOOQO'#FU'#FUOOQO'#FV'#FVQOQPOOO1|QPO'#C}O2RQPO'#DSO(PQPO,59gO2YQQO,59gO3vQPO,59oO3vQPO,59oO3vQPO,59oO3vQPO,59oO3vQPO,59oO:kQPO,5;rO:kQPO,5;uO:|QPO,5<SOOQO,5:O,5:OOOQO,5;t,5;tO;eQQO,5;vO;lQQO,5;xOOQO'#DQ'#DQO=SQPO'#FbO=bQPO,5;{OOQO,5;{,5;{O=nQPO,5;{OOQO,5;z,5;zO=vQSO'#DOOOQO,59i,59iOOQO,59n,59nO>RQQO,59nOOQO1G/R1G/ROOQO'#DV'#DVO1|QPO'#DWOOQO'#Fx'#FxO>]QPO'#FxOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOYQPO1G/ZOOQO'#FX'#FXOD}QPO'#FXOEYQSO1G1^OOQO1G1a1G1aOEbQPO'#FYOOQO'#Fj'#FjOOQO1G1n1G1nOEmQPO1G1nOOQO1G1b1G1bOOQO'#Fc'#FcOErQPO,5;|OEwQPO,5<ROE|QSO1G1gOFXQPO1G1gOOQO1G1g1G1gOOQO,59j,59jOFaQPO,59jOYQPO'#FmOFiQPO1G/YOOQO1G/Y1G/YOFqQPO,59rOOQO,5<d,5<dONmQQO7+$uON}QQO7+$uO!!cQQO7+$uO!!yQQO7+$uO!$bQQO7+$uOOQO,5;s,5;sOOQO7+&x7+&xO!${QPO7+&}O!%SQPO7+'YOOQO1G1h1G1hOOQO1G1m1G1mO!%XQPO,5<YOOQO,5<Y,5<YOOQO7+'R7+'RO!%mQSO7+'ROOQO-E9l-E9lO!%xQSO1G/UO!&TQPO1G/UOOQO1G/U1G/UO!&]QQO,5<XOOQO-E9k-E9kOOQO7+$t7+$tO!&gQPO1G/^OOQO<<Ji<<JiO!-RQPO<<JiOOQO<<Jt<<JtOOQO<<Jm<<JmP!-WQSO'#FnOOQO,5<W,5<WOOQO7+$p7+$pO!-`QSO7+$pOOQO-E9j-E9jOOQO7+$x7+$xOOQOAN@TAN@TOOQO<<H[<<H[P!-kQSO'#Fl\",\n  stateData: \"!-s~O$gOSmOS~OWQOXQOYQOZQO[QO]QO^QO_QO`QOaQObQOcQOdQOeQOu^O!Z[O$dVO$eVO$iXO$m_O$n`O$oaO$pbO$qcO$rdO$seO$tfO$ugO$vhO$wiO$xjO$ykO$zlO${mO$|nO$}oO%OpO%PqO%QrO%RsO%StO%TuO%UvO%VwO%WxO%XyO%YzO%Z{O%[|O%]}O%^!OO%_!PO%`!QO%a!RO%b!SO%c!TO%d!UO%e!VO%f!WO%g!XO%h!YO%i!ZO%j![O%k!]O%l!^O%m!_O%n!`O%o!aO%p!bO%q!cO%r!dO%s!eO%t!fO%u!gO%v!hO%w!iO%x!jO%y!kO%z!lO%{!mO%|!nO%}!oO&O!pO&P!qO&Q!rO&R!sO&S!tO&T!uO&U!vO&V!wO&W!xO&X!yO&Y!zO&Z!{O&[!|O&]!}O&_WO&`WO&aVO&dZO~O!Z#OO~Of#POg#PO$i#QO~OU#ZOV#TOh#WOi#XOj#WOx#TO{#TO|#TO}#TO!O#UO!P#UO!Q#VO!R#VO!S#VO!T#VO!U#VO!V#VO$]#[O&^#YO~O$d#^O$e#^O&a#^OW$RXX$RXY$RXZ$RX[$RX]$RX^$RX_$RX`$RXa$RXb$RXc$RXd$RXe$RXu$RX!Z$RX$d$RX$e$RX$i$RX$m$RX$n$RX$o$RX$p$RX$q$RX$r$RX$s$RX$t$RX$u$RX$v$RX$w$RX$x$RX$y$RX$z$RX${$RX$|$RX$}$RX%O$RX%P$RX%Q$RX%R$RX%S$RX%T$RX%U$RX%V$RX%W$RX%X$RX%Y$RX%Z$RX%[$RX%]$RX%^$RX%_$RX%`$RX%a$RX%b$RX%c$RX%d$RX%e$RX%f$RX%g$RX%h$RX%i$RX%j$RX%k$RX%l$RX%m$RX%n$RX%o$RX%p$RX%q$RX%r$RX%s$RX%t$RX%u$RX%v$RX%w$RX%x$RX%y$RX%z$RX%{$RX%|$RX%}$RX&O$RX&P$RX&Q$RX&R$RX&S$RX&T$RX&U$RX&V$RX&W$RX&X$RX&Y$RX&Z$RX&[$RX&]$RX&_$RX&`$RX&a$RX&d$RX~Os#bOu#aO&e#dO~O&dZOU$SXV$SXh$SXi$SXj$SXx$SX{$SX|$SX}$SX!O$SX!P$SX!Q$SX!R$SX!S$SX!T$SX!U$SX!V$SX$]$SX$c$SX&^$SX$k$SX$j$SX~O$i#gO~O$k#iO~PYOf#POg#POUoaVoahoaioajoaxoa{oa|oa}oa!Ooa!Poa!Qoa!Roa!Soa!Toa!Uoa!Voa$]oa$coa&^oa$koa$joa~OP#lOQ#mOR#mOW$lPX$lPY$lPZ$lP[$lP]$lP^$lP_$lP`$lPa$lPb$lPc$lPd$lPe$lPu$lP!Z$lP$d$lP$e$lP$i$lP$m$lP$n$lP$o$lP$p$lP$q$lP$r$lP$s$lP$t$lP$u$lP$v$lP$w$lP$x$lP$y$lP$z$lP${$lP$|$lP$}$lP%O$lP%P$lP%Q$lP%R$lP%S$lP%T$lP%U$lP%V$lP%W$lP%X$lP%Y$lP%Z$lP%[$lP%]$lP%^$lP%_$lP%`$lP%a$lP%b$lP%c$lP%d$lP%e$lP%f$lP%g$lP%h$lP%i$lP%j$lP%k$lP%l$lP%m$lP%n$lP%o$lP%p$lP%q$lP%r$lP%s$lP%t$lP%u$lP%v$lP%w$lP%x$lP%y$lP%z$lP%{$lP%|$lP%}$lP&O$lP&P$lP&Q$lP&R$lP&S$lP&T$lP&U$lP&V$lP&W$lP&X$lP&Y$lP&Z$lP&[$lP&]$lP&_$lP&`$lP&a$lP&d$lP~O$d#uO$e#uO&_#vO&`#vO&a#uO~Ok#zOl#zO$dVO$eVO&_#yO&`#yO&aVO~O$k#}O~P(UOx#TOU$QaV$Qah$Qai$Qaj$Qa{$Qa|$Qa}$Qa!O$Qa!P$Qa!Q$Qa!R$Qa!S$Qa!T$Qa!U$Qa!V$Qa$]$Qa$c$Qa&^$Qa$k$Qa$j$Qa~O!V$OO$W$OO$X$OO$Y$OO~O!V$OO$W$OO$X$OO$Y$OO$j$RO&e$TO~Os$VOu#aO$k$UO~O$j$WO$k$YO~P(UOQ#mOR#mOW$lXX$lXY$lXZ$lX[$lX]$lX^$lX_$lX`$lXa$lXb$lXc$lXd$lXe$lXu$lX!Z$lX$d$lX$e$lX$i$lX$m$lX$n$lX$o$lX$p$lX$q$lX$r$lX$s$lX$t$lX$u$lX$v$lX$w$lX$x$lX$y$lX$z$lX${$lX$|$lX$}$lX%O$lX%P$lX%Q$lX%R$lX%S$lX%T$lX%U$lX%V$lX%W$lX%X$lX%Y$lX%Z$lX%[$lX%]$lX%^$lX%_$lX%`$lX%a$lX%b$lX%c$lX%d$lX%e$lX%f$lX%g$lX%h$lX%i$lX%j$lX%k$lX%l$lX%m$lX%n$lX%o$lX%p$lX%q$lX%r$lX%s$lX%t$lX%u$lX%v$lX%w$lX%x$lX%y$lX%z$lX%{$lX%|$lX%}$lX&O$lX&P$lX&Q$lX&R$lX&S$lX&T$lX&U$lX&V$lX&W$lX&X$lX&Y$lX&Z$lX&[$lX&]$lX&_$lX&`$lX&a$lX&d$lX~O$d$bO$e$bO&a$bO~O&b$cO&c$dO~O$d#^O$e#^O&a#^O~O$i$eO~Ou$fO~Ou$gO~Os#bOu#aO&e$jO~O$j$kO&e$jO~O$j$mO$k$oO~O$j$WO$k$rO~OS$sOT$sOWzaXzaYzaZza[za]za^za_za`zaazabzaczadzaezauza!Zza$dza$eza$iza$mza$nza$oza$pza$qza$rza$sza$tza$uza$vza$wza$xza$yza$zza${za$|za$}za%Oza%Pza%Qza%Rza%Sza%Tza%Uza%Vza%Wza%Xza%Yza%Zza%[za%]za%^za%_za%`za%aza%bza%cza%dza%eza%fza%gza%hza%iza%jza%kza%lza%mza%nza%oza%pza%qza%rza%sza%tza%uza%vza%wza%xza%yza%zza%{za%|za%}za&Oza&Pza&Qza&Rza&Sza&Tza&Uza&Vza&Wza&Xza&Yza&Zza&[za&]za&_za&`za&aza&dza~Ox#TOUwqhwqiwqjwq!Owq!Pwq!Qwq!Rwq!Swq!Twq!Uwq!Vwq$]wq$cwq&^wq$kwq$jwq~OVwq{wq|wq}wq~PMcOV#TO{#TO|#TO}#TO~PMcOV#TOx#TO{#TO|#TO}#TO!O#UO!P#UOUwqhwqiwqjwq$]wq$cwq&^wq$kwq$jwq~O!Qwq!Rwq!Swq!Twq!Uwq!Vwq~P! _O!Q#VO!R#VO!S#VO!T#VO!U#VO!V#VO~P! _OV#TOh#WOj#WOx#TO{#TO|#TO}#TO!O#UO!P#UO!Q#VO!R#VO!S#VO!T#VO!U#VO!V#VO~OUwqiwq$]wq$cwq&^wq$kwq$jwq~P!#aO&b$tO~P:kO$k$vO~O!V$OO$W$OO$X$OO$Y$OO$j$ba&e$ba~Os#bOu#aO&e$wO~Os$yOu#aO$k$zO~O$j${O$k$zO~O$j$aa$k$aa~P(UO$i#gOWziXziYziZzi[zi]zi^zi_zi`ziazibziczidzieziuzi!Zzi$dzi$ezi$mzi$nzi$ozi$pzi$qzi$rzi$szi$tzi$uzi$vzi$wzi$xzi$yzi$zzi${zi$|zi$}zi%Ozi%Pzi%Qzi%Rzi%Szi%Tzi%Uzi%Vzi%Wzi%Xzi%Yzi%Zzi%[zi%]zi%^zi%_zi%`zi%azi%bzi%czi%dzi%ezi%fzi%gzi%hzi%izi%jzi%kzi%lzi%mzi%nzi%ozi%pzi%qzi%rzi%szi%tzi%uzi%vzi%wzi%xzi%yzi%zzi%{zi%|zi%}zi&Ozi&Pzi&Qzi&Rzi&Szi&Tzi&Uzi&Vzi&Wzi&Xzi&Yzi&Zzi&[zi&]zi&_zi&`zi&azi&dzi~O&b%OO~Os#bOu#aO~Os$yOu#aO$k%PO~Os$yOu#aO~O\",\n  goto: \")v$mPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$n$z%W%^P%gP%w$nP&Q&XPPPPPPPPPPP$n&c&oP&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o&o$n&{'U$n$n$n$n'e$n'q(Q(YPPP(Q$nP(aP(d(j(pPPPPP(wPPP)ge^OXY#Q#p#q#r#s#t$WeROXY#Q#p#q#r#s#t$WQ#RRR#k#SQ#h#PQ$Z#mR$}$sQ#cZQ$V#gU$h$R$k$xV$y$m${%QQ#SRQ#]UR#k#RZ#o#T#U#V#W#XY#n#T#U#V#W#XR$[#oeUOXY#Q#p#q#r#s#t$WeTOXY#Q#p#q#r#s#t$WQ#w#YQ#x#ZR$u$dd^OXY#Q#p#q#r#s#t$WR#{#[eYOXY#Q#p#q#r#s#t$Wd]OXY#Q#p#q#r#s#t$WR#f[Q#eZV$i$R$k$xQ$P#bT$Q#c$hR#|#[Q$n$VR$|$nQ$X#jR$q$XS$S#c#eR$l$SQSOQ#_XQ#`YQ#j#QQ$]#pQ$^#qQ$_#rQ$`#sQ$a#tR$p$WQ#p#TQ#q#UQ#r#VQ#s#WR#t#X\",\n  nodeNames: \" Bool Ignoring On GroupLeft GroupRight Offset Atan2 Avg Bottomk Count CountValues Group Max Min Quantile LimitK LimitRatio Stddev Stdvar Sum Topk By Without And Or Unless Start End LineComment PromQL AggregateExpr AggregateOp AggregateModifier GroupingLabels LabelName QuotedLabelName StringLiteral FunctionCallBody BinaryExpr Pow BoolModifier MatchingModifierClause Mul Div Mod Add Sub Eql Gte Gtr Lte Lss Neq FunctionCall FunctionIdentifier AbsentOverTime Identifier Absent Abs Acos Acosh Asin Asinh Atan Atanh AvgOverTime Ceil Changes Clamp ClampMax ClampMin Cos Cosh CountOverTime DaysInMonth DayOfMonth DayOfWeek DayOfYear Deg Delta Deriv Exp Floor HistogramCount HistogramFraction HistogramQuantile HistogramStdDev HistogramStdVar HistogramSum HistogramAvg DoubleExponentialSmoothing Hour Idelta Increase Info Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MadOverTime MaxOverTime MinOverTime Minute Month Pi PredictLinear PresentOverTime QuantileOverTime Rad Rate Resets Round Scalar Sgn Sin Sinh Sort SortDesc SortByLabel SortByLabelDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Tan Tanh Timestamp Time Vector Year MatrixSelector NumberDurationLiteralInDurationContext NumberDurationLiteral OffsetExpr ParenExpr SubqueryExpr UnaryExpr UnaryOp VectorSelector LabelMatchers UnquotedLabelMatcher MatchOp EqlSingle EqlRegex NeqRegex QuotedLabelMatcher StepInvariantExpr At AtModifierPreprocessors MetricName\",\n  maxTerm: 251,\n  nodeProps: [\n    [\"group\", -12,31,37,39,54,134,136,137,138,139,140,142,150,\"Expr\"]\n  ],\n  propSources: [promQLHighLight],\n  skippedNodes: [0,29],\n  repeatNodeCount: 3,\n  tokenData: \"4k~RwX^#lpq#lqr$ars$tst&luv'Twx'Yxy({yz)Qz{)V{|)[|})c}!O)h!O!P)o!P!Q*u!Q!R*z!R![+u![!]1O!^!_1z!_!`2X!`!a2n!b!c2{!c!}3Q!}#O3h#P#Q3m#Q#R3r#R#S3Q#S#T3w#T#o3Q#o#p4a#q#r4f#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~#qY$g~X^#lpq#l#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~$dQ!_!`$j#r#s$o~$oO!V~~$tO$Y~~$yWu~OY$tZr$trs%cs#O$t#O#P%h#P;'S$t;'S;=`&f<%lO$t~%hOu~~%kRO;'S$t;'S;=`%t;=`O$t~%yXu~OY$tZr$trs%cs#O$t#O#P%h#P;'S$t;'S;=`&f;=`<%l$t<%lO$t~&iP;=`<%l$t~&qSm~OY&lZ;'S&l;'S;=`&}<%lO&l~'QP;=`<%l&l~'YO}~~'_Wu~OY'YZw'Ywx%cx#O'Y#O#P'w#P;'S'Y;'S;=`(u<%lO'Y~'zRO;'S'Y;'S;=`(T;=`O'Y~(YXu~OY'YZw'Ywx%cx#O'Y#O#P'w#P;'S'Y;'S;=`(u;=`<%l'Y<%lO'Y~(xP;=`<%l'Y~)QO$i~~)VO$k~~)[O{~R)cO&`P!OQ~)hO$j~R)oO&_P!PQ~)rP!Q![)u~)zS&a~!Q![)u!g!h*W#R#S)o#X#Y*W~*ZR{|*d}!O*d!Q![*j~*gP!Q![*j~*oQ&a~!Q![*j#R#S*d~*zO|~~+P[&a~!O!P)o!Q![+u!g!h*W#R#S,m#W#X-X#X#Y*W#[#]-p#a#b.U#g#h.x#k#l/Z#l#m0d#m#n/u~+zZ&a~!O!P)o!Q![+u!g!h*W#R#S,m#W#X-X#X#Y*W#[#]-p#a#b.U#g#h.x#k#l/Z#m#n/u~,pP!Q![,s~,xT&a~!O!P)o!Q![,s!g!h*W#R#S,m#X#Y*W~-^P&a~!Q![-a~-dS!Q![-a#[#]-p#a#b.U#g#h.x~-uP&a~!Q![-x~-{R!Q![-x#a#b.U#g#h.x~.ZQ&a~!Q![.a#g#h.s~.dR!Q![.a#a#b.m#g#h.x~.pP#g#h.s~.xO&a~~.}P&a~!Q![/Q~/TQ!Q![/Q#a#b.m~/`P&a~!Q![/c~/fT!Q![/c#W#X-X#[#]-p#a#b.U#g#h.x~/zP&a~!Q![/}~0QU!Q![/}#W#X-X#[#]-p#a#b.U#g#h.x#k#l/Z~0gR!Q![0p!c!i0p#T#Z0p~0uR&a~!Q![0p!c!i0p#T#Z0pV1VT&cS!ZR!Q![1f![!]1f!c!}1f#R#S1f#T#o1fR1kT!ZR!Q![1f![!]1f!c!}1f#R#S1f#T#o1f~2PP!U~!_!`2S~2XO!T~~2^Q$WP!_!`2d#r#s2iQ2iO!QQ~2nO$X~~2sP!S~!_!`2v~2{O!R~~3QO$]~V3XT!ZRsS!Q![3Q![!]1f!c!}3Q#R#S3Q#T#o3Q~3mO&^~~3rO&b~~3wOx~~3zTO#S3w#S#T%c#T;'S3w;'S;=`4Z<%lO3w~4^P;=`<%l3w~4fO&d~~4kO&e~\",\n  tokenizers: [0, 1, 2],\n  topRules: {\"PromQL\":[0,30],\"MetricName\":[1,153]},\n  specialized: [{term: 57, get: (value, stack) => (specializeIdentifier(value) << 1), external: specializeIdentifier},{term: 57, get: (value, stack) => (extendIdentifier(value) << 1) | 1, external: extendIdentifier, extend: true},{term: 57, get: (value) => spec_Identifier[value] || -1}],\n  tokenPrec: 0\n});\n// This file was generated by lezer-generator. You probably shouldn't edit it.\nconst inf = 158,\n  nan = 159,\n  Bool = 1,\n  Ignoring = 2,\n  On = 3,\n  GroupLeft = 4,\n  GroupRight = 5,\n  Offset = 6,\n  Atan2 = 7,\n  Avg = 8,\n  Bottomk = 9,\n  Count = 10,\n  CountValues = 11,\n  Group = 12,\n  Max = 13,\n  Min = 14,\n  Quantile = 15,\n  LimitK = 16,\n  LimitRatio = 17,\n  Stddev = 18,\n  Stdvar = 19,\n  Sum = 20,\n  Topk = 21,\n  By = 22,\n  Without = 23,\n  And = 24,\n  Or = 25,\n  Unless = 26,\n  Start = 27,\n  End = 28,\n  LineComment = 29,\n  PromQL = 30,\n  AggregateExpr = 31,\n  AggregateOp = 32,\n  AggregateModifier = 33,\n  GroupingLabels = 34,\n  LabelName = 35,\n  QuotedLabelName = 36,\n  StringLiteral = 37,\n  FunctionCallBody = 38,\n  BinaryExpr = 39,\n  Pow = 40,\n  BoolModifier = 41,\n  MatchingModifierClause = 42,\n  Mul = 43,\n  Div = 44,\n  Mod = 45,\n  Add = 46,\n  Sub = 47,\n  Eql = 48,\n  Gte = 49,\n  Gtr = 50,\n  Lte = 51,\n  Lss = 52,\n  Neq = 53,\n  FunctionCall = 54,\n  FunctionIdentifier = 55,\n  AbsentOverTime = 56,\n  Identifier = 57,\n  Absent = 58,\n  Abs = 59,\n  Acos = 60,\n  Acosh = 61,\n  Asin = 62,\n  Asinh = 63,\n  Atan = 64,\n  Atanh = 65,\n  AvgOverTime = 66,\n  Ceil = 67,\n  Changes = 68,\n  Clamp = 69,\n  ClampMax = 70,\n  ClampMin = 71,\n  Cos = 72,\n  Cosh = 73,\n  CountOverTime = 74,\n  DaysInMonth = 75,\n  DayOfMonth = 76,\n  DayOfWeek = 77,\n  DayOfYear = 78,\n  Deg = 79,\n  Delta = 80,\n  Deriv = 81,\n  Exp = 82,\n  Floor = 83,\n  HistogramCount = 84,\n  HistogramFraction = 85,\n  HistogramQuantile = 86,\n  HistogramStdDev = 87,\n  HistogramStdVar = 88,\n  HistogramSum = 89,\n  HistogramAvg = 90,\n  DoubleExponentialSmoothing = 91,\n  Hour = 92,\n  Idelta = 93,\n  Increase = 94,\n  Info = 95,\n  Irate = 96,\n  LabelReplace = 97,\n  LabelJoin = 98,\n  LastOverTime = 99,\n  Ln = 100,\n  Log10 = 101,\n  Log2 = 102,\n  MadOverTime = 103,\n  MaxOverTime = 104,\n  MinOverTime = 105,\n  Minute = 106,\n  Month = 107,\n  Pi = 108,\n  PredictLinear = 109,\n  PresentOverTime = 110,\n  QuantileOverTime = 111,\n  Rad = 112,\n  Rate = 113,\n  Resets = 114,\n  Round = 115,\n  Scalar = 116,\n  Sgn = 117,\n  Sin = 118,\n  Sinh = 119,\n  Sort = 120,\n  SortDesc = 121,\n  SortByLabel = 122,\n  SortByLabelDesc = 123,\n  Sqrt = 124,\n  StddevOverTime = 125,\n  StdvarOverTime = 126,\n  SumOverTime = 127,\n  Tan = 128,\n  Tanh = 129,\n  Timestamp = 130,\n  Time = 131,\n  Vector = 132,\n  Year = 133,\n  MatrixSelector = 134,\n  NumberDurationLiteralInDurationContext = 135,\n  NumberDurationLiteral = 136,\n  OffsetExpr = 137,\n  ParenExpr = 138,\n  SubqueryExpr = 139,\n  UnaryExpr = 140,\n  UnaryOp = 141,\n  VectorSelector = 142,\n  LabelMatchers = 143,\n  UnquotedLabelMatcher = 144,\n  MatchOp = 145,\n  EqlSingle = 146,\n  EqlRegex = 147,\n  NeqRegex = 148,\n  QuotedLabelMatcher = 149,\n  StepInvariantExpr = 150,\n  At = 151,\n  AtModifierPreprocessors = 152,\n  MetricName = 153;\n\nexport { Abs, Absent, AbsentOverTime, Acos, Acosh, Add, AggregateExpr, AggregateModifier, AggregateOp, And, Asin, Asinh, At, AtModifierPreprocessors, Atan, Atan2, Atanh, Avg, AvgOverTime, BinaryExpr, Bool, BoolModifier, Bottomk, By, Ceil, Changes, Clamp, ClampMax, ClampMin, Cos, Cosh, Count, CountOverTime, CountValues, DayOfMonth, DayOfWeek, DayOfYear, DaysInMonth, Deg, Delta, Deriv, Div, DoubleExponentialSmoothing, End, Eql, EqlRegex, EqlSingle, Exp, Floor, FunctionCall, FunctionCallBody, FunctionIdentifier, Group, GroupLeft, GroupRight, GroupingLabels, Gte, Gtr, HistogramAvg, HistogramCount, HistogramFraction, HistogramQuantile, HistogramStdDev, HistogramStdVar, HistogramSum, Hour, Idelta, Identifier, Ignoring, Increase, Info, Irate, LabelJoin, LabelMatchers, LabelName, LabelReplace, LastOverTime, LimitK, LimitRatio, LineComment, Ln, Log10, Log2, Lss, Lte, MadOverTime, MatchOp, MatchingModifierClause, MatrixSelector, Max, MaxOverTime, MetricName, Min, MinOverTime, Minute, Mod, Month, Mul, Neq, NeqRegex, NumberDurationLiteral, NumberDurationLiteralInDurationContext, Offset, OffsetExpr, On, Or, ParenExpr, Pi, Pow, PredictLinear, PresentOverTime, PromQL, Quantile, QuantileOverTime, QuotedLabelMatcher, QuotedLabelName, Rad, Rate, Resets, Round, Scalar, Sgn, Sin, Sinh, Sort, SortByLabel, SortByLabelDesc, SortDesc, Sqrt, Start, Stddev, StddevOverTime, Stdvar, StdvarOverTime, StepInvariantExpr, StringLiteral, Sub, SubqueryExpr, Sum, SumOverTime, Tan, Tanh, Time, Timestamp, Topk, UnaryExpr, UnaryOp, Unless, UnquotedLabelMatcher, Vector, VectorSelector, Without, Year, inf, nan, parser };\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/types.ts\nimport { VisualQueryBinary } from './shared/LokiAndPromQueryModellerBase';\nimport { QueryBuilderLabelFilter, QueryBuilderOperation, QueryBuilderOperationDef } from './shared/types';\n\n/**\n * Visual query model\n */\nexport interface PromVisualQuery {\n  metric: string;\n  labels: QueryBuilderLabelFilter[];\n  operations: QueryBuilderOperation[];\n  binaryQueries?: PromVisualQueryBinary[];\n  // metrics explorer additional settings\n  useBackend?: boolean;\n  disableTextWrap?: boolean;\n  includeNullMetadata?: boolean;\n  fullMetaSearch?: boolean;\n}\n\nexport interface PromQueryModellerInterface {\n  renderLabels(labels: QueryBuilderLabelFilter[]): string;\n  renderQuery(query: PromVisualQuery, nested?: boolean): string;\n  hasBinaryOp(query: PromVisualQuery): boolean;\n  getQueryPatterns(): PromQueryPattern[];\n  getOperationsForCategory(category: string): QueryBuilderOperationDef[];\n  getOperationDef(id: string): QueryBuilderOperationDef | undefined;\n  getAlternativeOperations(key: string): QueryBuilderOperationDef[];\n  getCategories(): string[];\n}\n\nexport type PromVisualQueryBinary = VisualQueryBinary<PromVisualQuery>;\n\nexport enum PromVisualQueryOperationCategory {\n  Aggregations = 'Aggregations',\n  RangeFunctions = 'Range functions',\n  Functions = 'Functions',\n  BinaryOps = 'Binary operations',\n  Trigonometric = 'Trigonometric',\n  Time = 'Time Functions',\n}\n\nexport enum PromOperationId {\n  Abs = 'abs',\n  Absent = 'absent',\n  AbsentOverTime = 'absent_over_time',\n  Acos = 'acos',\n  Acosh = 'acosh',\n  Asin = 'asin',\n  Asinh = 'asinh',\n  Atan = 'atan',\n  Atanh = 'atanh',\n  Avg = 'avg',\n  AvgOverTime = 'avg_over_time',\n  BottomK = 'bottomk',\n  Ceil = 'ceil',\n  Changes = 'changes',\n  Clamp = 'clamp',\n  ClampMax = 'clamp_max',\n  ClampMin = 'clamp_min',\n  Cos = 'cos',\n  Cosh = 'cosh',\n  Count = 'count',\n  CountOverTime = 'count_over_time',\n  CountScalar = 'count_scalar',\n  CountValues = 'count_values',\n  DayOfMonth = 'day_of_month',\n  DayOfWeek = 'day_of_week',\n  DayOfYear = 'day_of_year',\n  DaysInMonth = 'days_in_month',\n  Deg = 'deg',\n  Delta = 'delta',\n  Deriv = 'deriv',\n  DoubleExponentialSmoothing = 'double_exponential_smoothing',\n  DropCommonLabels = 'drop_common_labels',\n  Exp = 'exp',\n  Floor = 'floor',\n  Group = 'group',\n  HistogramQuantile = 'histogram_quantile',\n  HistogramAvg = 'histogram_avg',\n  HistogramCount = 'histogram_count',\n  HistogramSum = 'histogram_sum',\n  HistogramFraction = 'histogram_fraction',\n  HistogramStddev = 'histogram_stddev',\n  HistogramStdvar = 'histogram_stdvar',\n  // Renamed as DoubleExponentialSmoothing with Prometheus v3.x\n  // https://github.com/prometheus/prometheus/pull/14930\n  HoltWinters = 'holt_winters',\n  Hour = 'hour',\n  Idelta = 'idelta',\n  Increase = 'increase',\n  Info = 'info',\n  Irate = 'irate',\n  LabelJoin = 'label_join',\n  LabelReplace = 'label_replace',\n  Last = 'last',\n  LastOverTime = 'last_over_time',\n  Ln = 'ln',\n  Log10 = 'log10',\n  Log2 = 'log2',\n  Max = 'max',\n  MaxOverTime = 'max_over_time',\n  Min = 'min',\n  MinOverTime = 'min_over_time',\n  Minute = 'minute',\n  Month = 'month',\n  Pi = 'pi',\n  PredictLinear = 'predict_linear',\n  Present = 'present',\n  PresentOverTime = 'present_over_time',\n  Quantile = 'quantile',\n  QuantileOverTime = 'quantile_over_time',\n  Rad = 'rad',\n  Rate = 'rate',\n  Resets = 'resets',\n  Round = 'round',\n  Scalar = 'scalar',\n  Sgn = 'sgn',\n  Sin = 'sin',\n  Sinh = 'sinh',\n  Sort = 'sort',\n  SortDesc = 'sort_desc',\n  Sqrt = 'sqrt',\n  Stddev = 'stddev',\n  StddevOverTime = 'stddev_over_time',\n  Sum = 'sum',\n  SumOverTime = 'sum_over_time',\n  Tan = 'tan',\n  Tanh = 'tanh',\n  Time = 'time',\n  Timestamp = 'timestamp',\n  TopK = 'topk',\n  Vector = 'vector',\n  Year = 'year',\n  // Binary ops\n  Addition = '__addition',\n  Subtraction = '__subtraction',\n  MultiplyBy = '__multiply_by',\n  DivideBy = '__divide_by',\n  Modulo = '__modulo',\n  Exponent = '__exponent',\n  NestedQuery = '__nested_query',\n  EqualTo = '__equal_to',\n  NotEqualTo = '__not_equal_to',\n  GreaterThan = '__greater_than',\n  LessThan = '__less_than',\n  GreaterOrEqual = '__greater_or_equal',\n  LessOrEqual = '__less_or_equal',\n}\n\nexport enum PromQueryPatternType {\n  Rate = 'rate',\n  Histogram = 'histogram',\n  Binary = 'binary',\n}\n\nexport interface PromQueryPattern {\n  name: string;\n  operations: QueryBuilderOperation[];\n  type: PromQueryPatternType;\n  binaryQueries?: PromVisualQueryBinary[];\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/operationUtils.ts\nimport { capitalize } from 'lodash';\nimport pluralize from 'pluralize';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport {\n  QueryBuilderLabelFilter,\n  QueryBuilderOperation,\n  QueryBuilderOperationDef,\n  QueryBuilderOperationParamDef,\n  QueryBuilderOperationParamValue,\n  QueryWithOperations,\n} from './shared/types';\nimport { PromVisualQueryOperationCategory } from './types';\n\nexport function functionRendererLeft(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n  const params = renderParams(model, def, innerExpr);\n  const str = model.id + '(';\n\n  if (innerExpr) {\n    params.push(innerExpr);\n  }\n\n  return str + params.join(', ') + ')';\n}\n\nexport function functionRendererRight(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n  const params = renderParams(model, def, innerExpr);\n  const str = model.id + '(';\n\n  if (innerExpr) {\n    params.unshift(innerExpr);\n  }\n\n  return str + params.join(', ') + ')';\n}\n\nfunction rangeRendererWithParams(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string,\n  renderLeft: boolean\n) {\n  if (def.params.length < 2) {\n    throw `Cannot render a function with params of length [${def.params.length}]`;\n  }\n\n  let rangeVector = (model.params ?? [])[0] ?? '5m';\n\n  // Next frame the remaining parameters, but get rid of the first one because it's used to move the\n  // instant vector into a range vector.\n  const params = renderParams(\n    {\n      ...model,\n      params: model.params.slice(1),\n    },\n    {\n      ...def,\n      params: def.params.slice(1),\n      defaultParams: def.defaultParams.slice(1),\n    },\n    innerExpr\n  );\n\n  const str = model.id + '(';\n\n  // Depending on the renderLeft variable, render parameters to the left or right\n  // renderLeft === true (renderLeft) => (param1, param2, rangeVector[...])\n  // renderLeft === false (renderRight) => (rangeVector[...], param1, param2)\n  if (innerExpr) {\n    renderLeft ? params.push(`${innerExpr}[${rangeVector}]`) : params.unshift(`${innerExpr}[${rangeVector}]`);\n  }\n\n  // stick everything together\n  return str + params.join(', ') + ')';\n}\n\nexport function rangeRendererRightWithParams(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  return rangeRendererWithParams(model, def, innerExpr, false);\n}\n\nexport function rangeRendererLeftWithParams(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  return rangeRendererWithParams(model, def, innerExpr, true);\n}\n\nfunction renderParams(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n  return (model.params ?? []).map((value, index) => {\n    const paramDef = def.params[index];\n    if (paramDef?.type === 'string') {\n      return `\"${value}\"`;\n    }\n\n    return value;\n  });\n}\n\nexport function defaultAddOperationHandler<T extends QueryWithOperations>(def: QueryBuilderOperationDef, query: T) {\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  return {\n    ...query,\n    operations: [...query.operations, newOperation],\n  };\n}\n\nexport function getPromOperationDisplayName(funcName: string) {\n  return capitalize(funcName.replace(/_/g, ' '));\n}\n\nexport function getRangeVectorParamDef(withRateInterval = false): QueryBuilderOperationParamDef {\n  /* eslint-disable @grafana/i18n/no-untranslated-strings */\n  const options: Array<SelectableValue<string>> = [\n    {\n      label: '$__interval',\n      value: '$__interval',\n      // tooltip: 'Dynamic interval based on max data points, scrape and min interval',\n    },\n    { label: '1m', value: '1m' },\n    { label: '5m', value: '5m' },\n    { label: '10m', value: '10m' },\n    { label: '1h', value: '1h' },\n    { label: '24h', value: '24h' },\n  ];\n\n  if (withRateInterval) {\n    options.unshift({\n      label: '$__rate_interval',\n      value: '$__rate_interval',\n      // tooltip: 'Always above 4x scrape interval',\n    });\n  }\n  /* eslint-enable @grafana/i18n/no-untranslated-strings */\n\n  const param: QueryBuilderOperationParamDef = {\n    name: 'Range',\n    type: 'string',\n    options,\n  };\n\n  return param;\n}\n\nexport function createAggregationOperation(\n  name: string,\n  overrides: Partial<QueryBuilderOperationDef> = {}\n): QueryBuilderOperationDef[] {\n  const operations: QueryBuilderOperationDef[] = [\n    {\n      id: name,\n      name: getPromOperationDisplayName(name),\n      params: [\n        {\n          name: 'By label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n        },\n      ],\n      defaultParams: [],\n      alternativesKey: 'plain aggregations',\n      category: PromVisualQueryOperationCategory.Aggregations,\n      renderer: functionRendererLeft,\n      paramChangedHandler: getOnLabelAddedHandler(`__${name}_by`),\n      explainHandler: getAggregationExplainer(name, ''),\n      addOperationHandler: defaultAddOperationHandler,\n      ...overrides,\n    },\n    {\n      id: `__${name}_by`,\n      name: `${getPromOperationDisplayName(name)} by`,\n      params: [\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: 'LabelParamEditor',\n        },\n      ],\n      defaultParams: [''],\n      alternativesKey: 'aggregations by',\n      category: PromVisualQueryOperationCategory.Aggregations,\n      renderer: getAggregationByRenderer(name),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'by'),\n      addOperationHandler: defaultAddOperationHandler,\n      hideFromList: true,\n      ...overrides,\n    },\n    {\n      id: `__${name}_without`,\n      name: `${getPromOperationDisplayName(name)} without`,\n      params: [\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: 'LabelParamEditor',\n        },\n      ],\n      defaultParams: [''],\n      alternativesKey: 'aggregations by',\n      category: PromVisualQueryOperationCategory.Aggregations,\n      renderer: getAggregationWithoutRenderer(name),\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name, 'without'),\n      addOperationHandler: defaultAddOperationHandler,\n      hideFromList: true,\n      ...overrides,\n    },\n  ];\n\n  return operations;\n}\n\nexport function createAggregationOperationWithParam(\n  name: string,\n  paramsDef: { params: QueryBuilderOperationParamDef[]; defaultParams: QueryBuilderOperationParamValue[] },\n  overrides: Partial<QueryBuilderOperationDef> = {}\n): QueryBuilderOperationDef[] {\n  const operations = createAggregationOperation(name, overrides);\n  operations[0].params.unshift(...paramsDef.params);\n  operations[1].params.unshift(...paramsDef.params);\n  operations[2].params.unshift(...paramsDef.params);\n  operations[0].defaultParams = paramsDef.defaultParams;\n  operations[1].defaultParams = [...paramsDef.defaultParams, ''];\n  operations[2].defaultParams = [...paramsDef.defaultParams, ''];\n  operations[1].renderer = getAggregationByRendererWithParameter(name);\n  operations[2].renderer = getAggregationByRendererWithParameter(name);\n  return operations;\n}\n\nexport function getAggregationByRenderer(aggregation: string) {\n  return function aggregationRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    return `${aggregation} by(${model.params.join(', ')}) (${innerExpr})`;\n  };\n}\n\nfunction getAggregationWithoutRenderer(aggregation: string) {\n  return function aggregationRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    return `${aggregation} without(${model.params.join(', ')}) (${innerExpr})`;\n  };\n}\n\n/**\n * Very simple poc implementation, needs to be modified to support all aggregation operators\n */\nexport function getAggregationExplainer(aggregationName: string, mode: 'by' | 'without' | '') {\n  return function aggregationExplainer(model: QueryBuilderOperation) {\n    const labels = model.params.map((label) => `\\`${label}\\``).join(' and ');\n    const labelWord = pluralize('label', model.params.length);\n\n    switch (mode) {\n      case 'by':\n        return `Calculates ${aggregationName} over dimensions while preserving ${labelWord} ${labels}.`;\n      case 'without':\n        return `Calculates ${aggregationName} over the dimensions ${labels}. All other labels are preserved.`;\n      default:\n        return `Calculates ${aggregationName} over the dimensions.`;\n    }\n  };\n}\n\nfunction getAggregationByRendererWithParameter(aggregation: string) {\n  return function aggregationRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    const restParamIndex = def.params.findIndex((param) => param.restParam);\n    const params = model.params.slice(0, restParamIndex);\n    const restParams = model.params.slice(restParamIndex);\n\n    return `${aggregation} by(${restParams.join(', ')}) (${params\n      .map((param, idx) => (def.params[idx].type === 'string' ? `\\\"${param}\\\"` : param))\n      .join(', ')}, ${innerExpr})`;\n  };\n}\n\n/**\n * This function will transform operations without labels to their plan aggregation operation\n */\nexport function getLastLabelRemovedHandler(changeToOperationId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation, def: QueryBuilderOperationDef) {\n    // If definition has more params then is defined there are no optional rest params anymore.\n    // We then transform this operation into a different one\n    if (op.params.length < def.params.length) {\n      return {\n        ...op,\n        id: changeToOperationId,\n      };\n    }\n\n    return op;\n  };\n}\n\nexport function getOnLabelAddedHandler(changeToOperationId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation, def: QueryBuilderOperationDef) {\n    // Check if we actually have the label param. As it's optional the aggregation can have one less, which is the\n    // case of just simple aggregation without label. When user adds the label it now has the same number of params\n    // as its definition, and now we can change it to its `_by` variant.\n    if (op.params.length === def.params.length) {\n      return {\n        ...op,\n        id: changeToOperationId,\n      };\n    }\n    return op;\n  };\n}\n\nexport function isConflictingSelector(\n  newLabel: Partial<QueryBuilderLabelFilter>,\n  labels: Array<Partial<QueryBuilderLabelFilter>>\n): boolean {\n  if (!newLabel.label || !newLabel.op || !newLabel.value) {\n    return false;\n  }\n\n  if (labels.length < 2) {\n    return false;\n  }\n\n  const operationIsNegative = newLabel.op.toString().startsWith('!');\n\n  const candidates = labels.filter(\n    (label) => label.label === newLabel.label && label.value === newLabel.value && label.op !== newLabel.op\n  );\n\n  const conflict = candidates.some((candidate) => {\n    if (operationIsNegative && candidate?.op?.toString().startsWith('!') === false) {\n      return true;\n    }\n    if (operationIsNegative === false && candidate?.op?.toString().startsWith('!')) {\n      return true;\n    }\n    return false;\n  });\n\n  return conflict;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/binaryScalarOperations.ts\nimport { defaultAddOperationHandler } from './operationUtils';\nimport { QueryBuilderOperation, QueryBuilderOperationDef, QueryBuilderOperationParamDef } from './shared/types';\nimport { PromOperationId, PromVisualQueryOperationCategory } from './types';\n\nexport const binaryScalarDefs = [\n  {\n    id: PromOperationId.Addition,\n    name: 'Add scalar',\n    sign: '+',\n  },\n  {\n    id: PromOperationId.Subtraction,\n    name: 'Subtract scalar',\n    sign: '-',\n  },\n  {\n    id: PromOperationId.MultiplyBy,\n    name: 'Multiply by scalar',\n    sign: '*',\n  },\n  {\n    id: PromOperationId.DivideBy,\n    name: 'Divide by scalar',\n    sign: '/',\n  },\n  {\n    id: PromOperationId.Modulo,\n    name: 'Modulo by scalar',\n    sign: '%',\n  },\n  {\n    id: PromOperationId.Exponent,\n    name: 'Exponent',\n    sign: '^',\n  },\n  {\n    id: PromOperationId.EqualTo,\n    name: 'Equal to',\n    sign: '==',\n    comparison: true,\n  },\n  {\n    id: PromOperationId.NotEqualTo,\n    name: 'Not equal to',\n    sign: '!=',\n    comparison: true,\n  },\n  {\n    id: PromOperationId.GreaterThan,\n    name: 'Greater than',\n    sign: '>',\n    comparison: true,\n  },\n  {\n    id: PromOperationId.LessThan,\n    name: 'Less than',\n    sign: '<',\n    comparison: true,\n  },\n  {\n    id: PromOperationId.GreaterOrEqual,\n    name: 'Greater or equal to',\n    sign: '>=',\n    comparison: true,\n  },\n  {\n    id: PromOperationId.LessOrEqual,\n    name: 'Less or equal to',\n    sign: '<=',\n    comparison: true,\n  },\n];\n\nexport const binaryScalarOperatorToOperatorName = binaryScalarDefs.reduce<\n  Record<string, { id: string; comparison?: boolean }>\n>((acc, def) => {\n  acc[def.sign] = {\n    id: def.id,\n    comparison: def.comparison,\n  };\n  return acc;\n}, {});\n\n// Not sure about this one. It could also be a more generic 'Simple math operation' where user specifies\n// both the operator and the operand in a single input\nexport const binaryScalarOperations: QueryBuilderOperationDef[] = binaryScalarDefs.map((opDef) => {\n  const params: QueryBuilderOperationParamDef[] = [{ name: 'Value', type: 'number' }];\n  let defaultParams: [number] | [number, boolean] = [2];\n  if (opDef.comparison) {\n    params.push({\n      name: 'Bool',\n      type: 'boolean',\n      description: 'If checked comparison will return 0 or 1 for the value rather than filtering.',\n    });\n    defaultParams = [2, false];\n  }\n\n  return {\n    id: opDef.id,\n    name: opDef.name,\n    params,\n    defaultParams,\n    alternativesKey: 'binary scalar operations',\n    category: PromVisualQueryOperationCategory.BinaryOps,\n    renderer: getSimpleBinaryRenderer(opDef.sign),\n    addOperationHandler: defaultAddOperationHandler,\n  };\n});\n\nfunction getSimpleBinaryRenderer(operator: string) {\n  return function binaryRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    let param = model.params[0];\n    let bool = '';\n    if (model.params.length === 2) {\n      bool = model.params[1] ? ' bool' : '';\n    }\n\n    return `${innerExpr} ${operator}${bool} ${param}`;\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/parsingUtils.ts\nimport { SyntaxNode, TreeCursor } from '@lezer/common';\n\nimport { QueryBuilderOperation, QueryBuilderOperationParamValue } from './shared/types';\n\n// Although 0 isn't explicitly provided in the lezer-promql library as the error node ID, it does appear to be the ID of error nodes within lezer.\nexport const ErrorId = 0;\n\nexport function getLeftMostChild(cur: SyntaxNode): SyntaxNode {\n  return cur.firstChild ? getLeftMostChild(cur.firstChild) : cur;\n}\n\nexport function makeError(expr: string, node: SyntaxNode) {\n  return {\n    text: getString(expr, node),\n    // TODO: this are positions in the string with the replaced variables. Means it cannot be used to show exact\n    //  placement of the error for the user. We need some translation table to positions before the variable\n    //  replace.\n    from: node.from,\n    to: node.to,\n    parentType: node.parent?.name,\n  };\n}\n\n// Taken from template_srv, but copied so to not mess with the regex.index which is manipulated in the service\n/*\n * This regex matches 3 types of variable reference with an optional format specifier\n * \\$(\\w+)                          $var1\n * \\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]    [[var2]] or [[var2:fmt2]]\n * \\${(\\w+)(?::(\\w+))?}             ${var3} or ${var3:fmt3}\n */\nconst variableRegex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]|\\${(\\w+)(?:\\.([^:^\\}]+))?(?::([^\\}]+))?}/g;\n\n/**\n * As variables with $ are creating parsing errors, we first replace them with magic string that is\n * parsable and at the same time we can get the variable and its format back from it.\n */\nexport function replaceVariables(expr: string) {\n  const replacedVariables: Record<string, string> = {};\n  const replacedExpr = expr.replace(variableRegex, (match, var1, var2, fmt2, var3, fieldPath, fmt3) => {\n    const fmt = fmt2 || fmt3;\n    let variable = var1;\n    let varType = '0';\n\n    if (var2) {\n      variable = var2;\n      varType = '1';\n    }\n\n    if (var3) {\n      variable = var3;\n      varType = '2';\n    }\n\n    const replacement = `__V_${varType}__` + variable + '__V__' + (fmt ? '__F__' + fmt + '__F__' : '');\n    replacedVariables[replacement] = match;\n    return replacement;\n  });\n\n  return { replacedExpr, replacedVariables };\n}\n\nconst varTypeFunc = [\n  (v: string, f?: string) => `\\$${v}`,\n  (v: string, f?: string) => `[[${v}${f ? `:${f}` : ''}]]`,\n  (v: string, f?: string) => `\\$\\{${v}${f ? `:${f}` : ''}\\}`,\n];\n\n/**\n * Get back the text with variables in their original format.\n * @param expr\n */\nexport function returnVariables(expr: string) {\n  return expr.replace(/__V_(\\d)__(.+?)__V__(?:__F__(\\w+)__F__)?/g, (match, type, v, f) => {\n    return varTypeFunc[parseInt(type, 10)](v, f);\n  });\n}\n\n/**\n * Get the actual string of the expression. That is not stored in the tree so we have to get the indexes from the node\n * and then based on that get it from the expression.\n * @param expr\n * @param node\n */\nexport function getString(expr: string, node: SyntaxNode | TreeCursor | null | undefined) {\n  if (!node) {\n    return '';\n  }\n  return returnVariables(expr.substring(node.from, node.to));\n}\n\n/**\n * Create simple scalar binary op object.\n * @param opDef - definition of the op to be created\n * @param expr\n * @param numberNode - the node for the scalar\n * @param hasBool - whether operation has a bool modifier. Is used only for ops for which it makes sense.\n */\nexport function makeBinOp(\n  opDef: { id: string; comparison?: boolean },\n  expr: string,\n  numberNode: SyntaxNode,\n  hasBool: boolean\n): QueryBuilderOperation {\n  const params: QueryBuilderOperationParamValue[] = [parseFloat(getString(expr, numberNode))];\n  if (opDef.comparison) {\n    params.push(hasBool);\n  }\n  return {\n    id: opDef.id,\n    params,\n  };\n}\n\n/**\n * Get all nodes with type in the tree. This traverses the tree so it is safe only when you know there shouldn't be\n * too much nesting but you just want to skip some of the wrappers. For example getting function args this way would\n * not be safe is it would also find arguments of nested functions.\n * @param expr\n * @param cur\n * @param type\n */\nexport function getAllByType(expr: string, cur: SyntaxNode, type: number): string[] {\n  if (cur.type.id === type) {\n    return [getString(expr, cur)];\n  }\n  const values: string[] = [];\n  let pos = 0;\n  let child = cur.childAfter(pos);\n  while (child) {\n    values.push(...getAllByType(expr, child, type));\n    pos = child.to;\n    child = cur.childAfter(pos);\n  }\n  return values;\n}\n\n/**\n * There aren't any spaces in the metric names, so let's introduce a wildcard into the regex for each space to better facilitate a fuzzy search\n */\nexport const regexifyLabelValuesQueryString = (query: string) => {\n  const queryArray = query.split(' ');\n  return queryArray.map((query) => `${query}.*`).join('');\n};\n\n/**\n * Built-in Grafana variables used for time ranges and intervals in Prometheus queries\n * Each variable has a carefully crafted numeric replacement that:\n * 1. Has exactly the same string length as the original variable\n * 2. Is valid in Prometheus syntax to avoid parsing errors\n * 3. Preserves error position information for accurate error reporting\n * 4. Uses readable number formatting with digit grouping via underscores\n * https://prometheus.io/docs/prometheus/latest/querying/basics/#float-literals-and-time-durations\n */\nconst BUILT_IN_VARIABLES = [\n  { variable: '$__interval_ms', replacement: '79_999_999_999' },\n  { variable: '$__interval', replacement: '711_999_999' },\n  { variable: '$__rate_interval', replacement: '7999799979997999' },\n  { variable: '$__range_ms', replacement: '722_999_999' },\n  { variable: '$__range_s', replacement: '79_299_999' },\n  { variable: '$__range', replacement: '799_999' },\n];\n\n// Derived maps for efficient lookups\nconst variableToReplacement = BUILT_IN_VARIABLES.reduce<Record<string, string>>((map, { variable, replacement }) => {\n  map[variable] = replacement;\n  return map;\n}, {});\n\nconst replacementToVariable = BUILT_IN_VARIABLES.reduce<Record<string, string>>((map, { variable, replacement }) => {\n  map[replacement] = variable;\n  return map;\n}, {});\n\n// Pre-compiled regular expressions for efficient search/replace\nconst builtInVariablePattern = BUILT_IN_VARIABLES.map(({ variable }) => variable.replace(/\\$/g, '\\\\$')).join('|');\nconst builtInVariableRegex = new RegExp(builtInVariablePattern, 'g');\n\nconst builtInReplacementPattern = BUILT_IN_VARIABLES.map(({ replacement }) => replacement).join('|');\nconst builtInReplacementRegex = new RegExp(builtInReplacementPattern, 'g');\n\n/**\n * Replaces Grafana built-in variables with numeric replacements\n * This helps prevent these variables from causing parsing errors\n */\nexport function replaceBuiltInVariable(expr: string): string {\n  return expr.replace(builtInVariableRegex, (match) => variableToReplacement[match]);\n}\n\n/**\n * Restores the original built-in variables from their replacement format\n * Reverses the transformation done by replaceBuiltInVariable\n */\nexport function returnBuiltInVariable(expr: string): string {\n  return expr.replace(builtInReplacementRegex, (match) => replacementToVariable[match]);\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/parsing.ts\nimport { SyntaxNode } from '@lezer/common';\nimport {\n  AggregateExpr,\n  AggregateModifier,\n  AggregateOp,\n  BinaryExpr,\n  BoolModifier,\n  FunctionCall,\n  FunctionCallBody,\n  FunctionIdentifier,\n  GroupingLabels,\n  Identifier,\n  LabelName,\n  QuotedLabelName,\n  MatchingModifierClause,\n  MatchOp,\n  NumberDurationLiteral,\n  On,\n  ParenExpr,\n  parser,\n  StringLiteral,\n  QuotedLabelMatcher,\n  UnquotedLabelMatcher,\n  VectorSelector,\n  Without,\n} from '@prometheus-io/lezer-promql';\n\nimport { t } from '@grafana/i18n';\n\nimport { binaryScalarOperatorToOperatorName } from './binaryScalarOperations';\nimport {\n  ErrorId,\n  getAllByType,\n  getLeftMostChild,\n  getString,\n  makeBinOp,\n  makeError,\n  replaceBuiltInVariable,\n  replaceVariables,\n  returnBuiltInVariable,\n} from './parsingUtils';\nimport { QueryBuilderLabelFilter, QueryBuilderOperation } from './shared/types';\nimport { PromVisualQuery, PromVisualQueryBinary } from './types';\n\n/**\n * Parses a PromQL query into a visual query model.\n *\n * It traverses the tree and uses sort of state machine to update the query model.\n * The query model is modified during the traversal and sent to each handler as context.\n */\nexport function buildVisualQueryFromString(expr: string): Omit<Context, 'replacements'> {\n  expr = replaceBuiltInVariable(expr);\n  const { replacedExpr, replacedVariables } = replaceVariables(expr);\n  const tree = parser.parse(replacedExpr);\n  const node = tree.topNode;\n\n  // This will be modified in the handlers.\n  const visQuery: PromVisualQuery = {\n    metric: '',\n    labels: [],\n    operations: [],\n  };\n  const context: Context = {\n    query: visQuery,\n    errors: [],\n    replacements: replacedVariables,\n  };\n\n  try {\n    handleExpression(replacedExpr, node, context);\n  } catch (err) {\n    // Not ideal to log it here, but otherwise we would lose the stack trace.\n    console.error(err);\n    if (err instanceof Error) {\n      context.errors.push({\n        text: err.message,\n      });\n    }\n  }\n\n  // If we have empty query, we want to reset errors\n  if (isEmptyQuery(context.query)) {\n    context.errors = [];\n  }\n\n  // No need to return replaced variables\n  delete context.replacements;\n\n  return context;\n}\n\ninterface ParsingError {\n  text: string;\n  from?: number;\n  to?: number;\n  parentType?: string;\n}\n\ninterface Context {\n  query: PromVisualQuery;\n  errors: ParsingError[];\n  replacements?: Record<string, string>;\n}\n\n/**\n * Handler for default state. It will traverse the tree and call the appropriate handler for each node. The node\n * handled here does not necessarily need to be of type == Expr.\n * @param expr\n * @param node\n * @param context\n */\nexport function handleExpression(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n\n  switch (node.type.id) {\n    case Identifier: {\n      // Expectation is that there is only one of those per query.\n      visQuery.metric = getString(expr, node);\n      break;\n    }\n\n    case QuotedLabelName: {\n      // Usually we got the metric name above in the Identifier case.\n      // If we didn't get the name that's potentially we have it in curly braces as quoted string.\n      // It must be quoted because that's how utf8 metric names should be defined\n      // See proposal https://github.com/prometheus/proposals/blob/main/proposals/2023-08-21-utf8.md\n      if (visQuery.metric === '') {\n        const strLiteral = node.getChild(StringLiteral);\n        const quotedMetric = getString(expr, strLiteral);\n        visQuery.metric = quotedMetric.slice(1, -1);\n      }\n      break;\n    }\n\n    case QuotedLabelMatcher: {\n      const quotedLabel = getLabel(expr, node, QuotedLabelName);\n      quotedLabel.label = quotedLabel.label.slice(1, -1);\n      visQuery.labels.push(quotedLabel);\n      const err = node.getChild(ErrorId);\n      if (err) {\n        context.errors.push(makeError(expr, err));\n      }\n      break;\n    }\n\n    case UnquotedLabelMatcher: {\n      // Same as MetricIdentifier should be just one per query.\n      visQuery.labels.push(getLabel(expr, node, LabelName));\n      const err = node.getChild(ErrorId);\n      if (err) {\n        context.errors.push(makeError(expr, err));\n      }\n      break;\n    }\n\n    case FunctionCall: {\n      handleFunction(expr, node, context);\n      break;\n    }\n\n    case AggregateExpr: {\n      handleAggregation(expr, node, context);\n      break;\n    }\n\n    case BinaryExpr: {\n      handleBinary(expr, node, context);\n      break;\n    }\n\n    case ErrorId: {\n      if (isIntervalVariableError(node)) {\n        break;\n      }\n      context.errors.push(makeError(expr, node));\n      break;\n    }\n\n    default: {\n      if (node.type.id === ParenExpr) {\n        // We don't support parenthesis in the query to group expressions.\n        // We just report error but go on with the parsing.\n        context.errors.push(makeError(expr, node));\n      }\n      // Any other nodes we just ignore and go to its children. This should be fine as there are lots of wrapper\n      // nodes that can be skipped.\n      // TODO: there are probably cases where we will just skip nodes we don't support and we should be able to\n      //  detect those and report back.\n      let child = node.firstChild;\n      while (child) {\n        handleExpression(expr, child, context);\n        child = child.nextSibling;\n      }\n    }\n  }\n}\n\n// TODO check if we still need this\nfunction isIntervalVariableError(node: SyntaxNode) {\n  return node.prevSibling?.firstChild?.type.id === VectorSelector;\n}\n\nfunction getLabel(\n  expr: string,\n  node: SyntaxNode,\n  labelType: typeof LabelName | typeof QuotedLabelName\n): QueryBuilderLabelFilter {\n  const label = getString(expr, node.getChild(labelType));\n  const op = getString(expr, node.getChild(MatchOp));\n  const value = getString(expr, node.getChild(StringLiteral)).replace(/^[\"'`]|[\"'`]$/g, '');\n  return {\n    label,\n    op,\n    value,\n  };\n}\n\nconst rangeFunctions = ['changes', 'rate', 'irate', 'increase', 'delta'];\n\n/**\n * Handle function call which is usually and identifier and its body > arguments.\n * @param expr\n * @param node\n * @param context\n */\nfunction handleFunction(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n  const nameNode = node.getChild(FunctionIdentifier);\n  const funcName = getString(expr, nameNode);\n\n  // Visual query builder doesn't support nested queries and so info function.\n  if (funcName === 'info') {\n    context.errors.push({\n      text: t(\n        'grafana-prometheus.querybuilder.handle-function.text.query-parsing-is-ambiguous',\n        'Query parsing is ambiguous.'\n      ),\n      from: node.from,\n      to: node.to,\n    });\n  }\n\n  const body = node.getChild(FunctionCallBody);\n  const params = [];\n  let interval = '';\n\n  // This is a bit of a shortcut to get the interval argument. Reasons are\n  // - interval is not part of the function args per promQL grammar but we model it as argument for the function in\n  //   the query model.\n  // - it is easier to handle template variables this way as template variable is an error for the parser\n  if (rangeFunctions.includes(funcName) || funcName.endsWith('_over_time')) {\n    let match = getString(expr, node).match(/\\[(.+)\\]/);\n    if (match?.[1]) {\n      interval = match[1];\n      // We were replaced the builtin variables to prevent errors\n      // Here we return those back\n      params.push(returnBuiltInVariable(match[1]));\n    }\n  }\n\n  const op = { id: funcName, params };\n  // We unshift operations to keep the more natural order that we want to have in the visual query editor.\n  visQuery.operations.unshift(op);\n\n  if (body) {\n    if (getString(expr, body) === '([' + interval + '])') {\n      // This is a special case where we have a function with a single argument and it is the interval.\n      // This happens when you start adding operations in query builder and did not set a metric yet.\n      return;\n    }\n    updateFunctionArgs(expr, body, context, op);\n  }\n}\n\n/**\n * Handle aggregation as they are distinct type from other functions.\n * @param expr\n * @param node\n * @param context\n */\nfunction handleAggregation(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n  const nameNode = node.getChild(AggregateOp);\n  let funcName = getString(expr, nameNode);\n\n  const modifier = node.getChild(AggregateModifier);\n  const labels = [];\n\n  if (modifier) {\n    const byModifier = modifier.getChild(`By`);\n    if (byModifier && funcName) {\n      funcName = `__${funcName}_by`;\n    }\n\n    const withoutModifier = modifier.getChild(Without);\n    if (withoutModifier) {\n      funcName = `__${funcName}_without`;\n    }\n\n    labels.push(...getAllByType(expr, modifier, LabelName), ...getAllByType(expr, modifier, QuotedLabelName));\n  }\n\n  const body = node.getChild(FunctionCallBody);\n\n  const op: QueryBuilderOperation = { id: funcName, params: [] };\n  visQuery.operations.unshift(op);\n  updateFunctionArgs(expr, body, context, op);\n  // We add labels after params in the visual query editor.\n  op.params.push(...labels);\n}\n\n/**\n * Handle (probably) all types of arguments that function or aggregation can have.\n *\n * We cannot just get all the children and iterate them as arguments we have to again recursively traverse through\n *  them.\n *\n * @param expr\n * @param node\n * @param context\n * @param op - We need the operation to add the params to as an additional context.\n */\nfunction updateFunctionArgs(expr: string, node: SyntaxNode | null, context: Context, op: QueryBuilderOperation) {\n  if (!node) {\n    return;\n  }\n  switch (node.type.id) {\n    case FunctionCallBody: {\n      let child = node.firstChild;\n\n      while (child) {\n        let binaryExpressionWithinFunctionArgs: SyntaxNode | null;\n        if (child.type.id === BinaryExpr) {\n          binaryExpressionWithinFunctionArgs = child;\n        } else {\n          binaryExpressionWithinFunctionArgs = child.getChild(BinaryExpr);\n        }\n\n        if (binaryExpressionWithinFunctionArgs) {\n          context.errors.push({\n            text: t(\n              'grafana-prometheus.querybuilder.update-function-args.text.query-parsing-is-ambiguous',\n              'Query parsing is ambiguous.'\n            ),\n            from: binaryExpressionWithinFunctionArgs.from,\n            to: binaryExpressionWithinFunctionArgs.to,\n          });\n        }\n\n        updateFunctionArgs(expr, child, context, op);\n        child = child.nextSibling;\n      }\n      break;\n    }\n\n    case NumberDurationLiteral: {\n      op.params.push(parseFloat(getString(expr, node)));\n      break;\n    }\n\n    case StringLiteral: {\n      op.params.push(getString(expr, node).replace(/\"/g, ''));\n      break;\n    }\n\n    case VectorSelector: {\n      // When we replace a custom variable to prevent errors during parsing we receive VectorSelector and Identifier in it.\n      // But this is also a normal case for a normal function body. i.e. topk(5, http_requests_total{})\n      // In such cases we got identifier as http_requests_total. So we shouldn't push this as param.\n      // So we check whether the given VectorSelector is something we replaced earlier.\n      if (context.replacements?.[expr.substring(node.from, node.to)]) {\n        const identifierNode = node.getChild(Identifier);\n        const customVarName = getString(expr, identifierNode);\n        op.params.push(customVarName);\n        break;\n      }\n    }\n\n    default: {\n      // Means we get to something that does not seem like simple function arg and is probably nested query so jump\n      // back to main context\n      handleExpression(expr, node, context);\n    }\n  }\n}\n\n/**\n * Right now binary expressions can be represented in 2 way in visual query. As additional operation in case it is\n * just operation with scalar or it creates a binaryQuery when it's 2 queries.\n * @param expr\n * @param node\n * @param context\n */\nfunction handleBinary(expr: string, node: SyntaxNode, context: Context) {\n  const visQuery = context.query;\n  const left = node.firstChild!;\n  const op = getString(expr, left.nextSibling);\n  const binModifier = getBinaryModifier(expr, node.getChild(BoolModifier) ?? node.getChild(MatchingModifierClause));\n\n  const right = node.lastChild!;\n\n  const opDef = binaryScalarOperatorToOperatorName[op];\n\n  const leftNumber = left.type.id === NumberDurationLiteral;\n  const rightNumber = right.type.id === NumberDurationLiteral;\n\n  const rightBinary = right.type.id === BinaryExpr;\n\n  if (leftNumber) {\n    // TODO: this should be already handled in case parent is binary expression as it has to be added to parent\n    //  if query starts with a number that isn't handled now.\n  } else {\n    // If this is binary we don't really know if there is a query or just chained scalars. So\n    // we have to traverse a bit deeper to know\n    handleExpression(expr, left, context);\n  }\n\n  if (rightNumber) {\n    visQuery.operations.push(makeBinOp(opDef, expr, right, !!binModifier?.isBool));\n  } else if (rightBinary) {\n    // Due to the way binary ops are parsed we can get a binary operation on the right that starts with a number which\n    // is a factor for a current binary operation. So we have to add it as an operation now.\n    const leftMostChild = getLeftMostChild(right);\n    if (leftMostChild?.type.id === NumberDurationLiteral) {\n      visQuery.operations.push(makeBinOp(opDef, expr, leftMostChild, !!binModifier?.isBool));\n    }\n\n    // If we added the first number literal as operation here we still can continue and handle the rest as the first\n    // number will be just skipped.\n    handleExpression(expr, right, context);\n  } else {\n    visQuery.binaryQueries = visQuery.binaryQueries || [];\n    const binQuery: PromVisualQueryBinary = {\n      operator: op,\n      query: {\n        metric: '',\n        labels: [],\n        operations: [],\n      },\n    };\n    if (binModifier?.isMatcher) {\n      binQuery.vectorMatchesType = binModifier.matchType;\n      binQuery.vectorMatches = binModifier.matches;\n    }\n    visQuery.binaryQueries.push(binQuery);\n    handleExpression(expr, right, {\n      query: binQuery.query,\n      errors: context.errors,\n      replacements: context.replacements,\n    });\n  }\n}\n\n// TODO revisit this function.\nfunction getBinaryModifier(\n  expr: string,\n  node: SyntaxNode | null\n):\n  | { isBool: true; isMatcher: false }\n  | { isBool: false; isMatcher: true; matches: string; matchType: 'ignoring' | 'on' }\n  | undefined {\n  if (!node) {\n    return undefined;\n  }\n  if (node.getChild('Bool')) {\n    return { isBool: true, isMatcher: false };\n  } else {\n    let labels = '';\n    const groupingLabels = node.getChild(GroupingLabels);\n    if (groupingLabels) {\n      labels = getAllByType(expr, groupingLabels, LabelName).join(', ');\n    }\n\n    return {\n      isMatcher: true,\n      isBool: false,\n      matches: labels,\n      matchType: node.getChild(On) ? 'on' : 'ignoring',\n    };\n  }\n}\n\nfunction isEmptyQuery(query: PromVisualQuery) {\n  if (query.labels.length === 0 && query.operations.length === 0 && !query.metric) {\n    return true;\n  }\n  return false;\n}\n","// NOTE: these two functions are similar to the escapeLabelValueIn* functions\n// in language_utils.ts, but they are not exactly the same algorithm, and we found\n\nimport { config } from '@grafana/runtime';\n\n// no way to reuse one in the another or vice versa.\nexport function prometheusRegularEscape<T>(value: T) {\n  if (typeof value !== 'string') {\n    return value;\n  }\n\n  if (config.featureToggles.prometheusSpecialCharsInLabelValues) {\n    // if the string looks like a complete label matcher (e.g. 'job=\"grafana\"' or 'job=~\"grafana\"'),\n    // don't escape the encapsulating quotes\n    if (/^\\w+(=|!=|=~|!~)\".*\"$/.test(value)) {\n      return value;\n    }\n\n    return value\n      .replace(/\\\\/g, '\\\\\\\\') // escape backslashes\n      .replace(/\"/g, '\\\\\"'); // escape double quotes\n  }\n\n  // classic behavior\n  return value\n    .replace(/\\\\/g, '\\\\\\\\') // escape backslashes\n    .replace(/'/g, \"\\\\\\\\'\"); // escape single quotes\n}\n\nexport function prometheusSpecialRegexEscape<T>(value: T) {\n  if (typeof value !== 'string') {\n    return value;\n  }\n\n  if (config.featureToggles.prometheusSpecialCharsInLabelValues) {\n    return value\n      .replace(/\\\\/g, '\\\\\\\\\\\\\\\\') // escape backslashes\n      .replace(/\"/g, '\\\\\\\\\\\\\"') // escape double quotes\n      .replace(/[$^*{}\\[\\]\\'+?.()|]/g, '\\\\\\\\$&'); // escape regex metacharacters\n  }\n\n  // classic behavior\n  return value\n    .replace(/\\\\/g, '\\\\\\\\\\\\\\\\') // escape backslashes\n    .replace(/[$^*{}\\[\\]+?.()|]/g, '\\\\\\\\$&'); // escape regex metacharacters\n}\n\n// NOTE: the following 2 exported functions are very similar to the prometheus*Escape\n// functions in datasource.ts, but they are not exactly the same algorithm, and we found\n// no way to reuse one in the another or vice versa.\n\n// Prometheus regular-expressions use the RE2 syntax (https://github.com/google/re2/wiki/Syntax),\n// so every character that matches something in that list has to be escaped.\n// the list of metacharacters is: *+?()|\\.[]{}^$\n// we make a javascript regular expression that matches those characters:\nconst RE2_METACHARACTERS = /[*+?()|\\\\.\\[\\]{}^$]/g;\n\nfunction escapePrometheusRegexp(value: string): string {\n  return value.replace(RE2_METACHARACTERS, '\\\\$&');\n}\n\n// based on the openmetrics-documentation, the 3 symbols we have to handle are:\n// - \\n ... the newline character\n// - \\  ... the backslash character\n// - \"  ... the double-quote character\nexport function escapeLabelValueInExactSelector(labelValue: string): string {\n  return labelValue.replace(/\\\\/g, '\\\\\\\\').replace(/\\n/g, '\\\\n').replace(/\"/g, '\\\\\"');\n}\n\nexport function escapeLabelValueInRegexSelector(labelValue: string): string {\n  return escapeLabelValueInExactSelector(escapePrometheusRegexp(labelValue));\n}\n","import { config } from '@grafana/runtime';\n\nimport { prometheusRegularEscape } from '../../../escaping';\nimport { utf8Support } from '../../../utf8_support';\nimport { QueryBuilderLabelFilter } from '../types';\n\n/**\n * Renders label filters in the format: {label1=\"value1\", label2=\"value2\"}\n */\nexport function renderLabels(labels: QueryBuilderLabelFilter[]): string {\n  if (labels.length === 0) {\n    return '';\n  }\n\n  let expr = '{';\n  for (const filter of labels) {\n    if (expr !== '{') {\n      expr += ', ';\n    }\n\n    let labelValue = filter.value;\n    const usingRegexOperator = filter.op === '=~' || filter.op === '!~';\n\n    if (config.featureToggles.prometheusSpecialCharsInLabelValues && !usingRegexOperator) {\n      labelValue = prometheusRegularEscape(labelValue);\n    }\n    expr += `${utf8Support(filter.label)}${filter.op}\"${labelValue}\"`;\n  }\n\n  return expr + `}`;\n}\n\nexport function renderLabelsWithoutBrackets(labels: QueryBuilderLabelFilter[]): string[] {\n  if (labels.length === 0) {\n    return [];\n  }\n\n  const renderedLabels: string[] = [];\n  for (const filter of labels) {\n    let labelValue = filter.value;\n    const usingRegexOperator = filter.op === '=~' || filter.op === '!~';\n\n    if (config.featureToggles.prometheusSpecialCharsInLabelValues && !usingRegexOperator) {\n      labelValue = prometheusRegularEscape(labelValue);\n    }\n    renderedLabels.push(`${utf8Support(filter.label)}${filter.op}\"${labelValue}\"`);\n  }\n\n  return renderedLabels;\n}\n","import { PromVisualQueryOperationCategory } from '../../types';\nimport { PromLokiVisualQuery } from '../LokiAndPromQueryModellerBase';\nimport { QueryBuilderOperation, QueryBuilderOperationDef } from '../types';\n\n/**\n * Renders operations\n */\nexport function renderOperations(\n  queryString: string,\n  operations: QueryBuilderOperation[],\n  operationsRegistry: Map<string, QueryBuilderOperationDef>\n): string {\n  for (const operation of operations) {\n    const def = operationsRegistry.get(operation.id);\n    if (!def) {\n      throw new Error(`Could not find operation ${operation.id} in the registry`);\n    }\n    queryString = def.renderer(operation, def, queryString);\n  }\n\n  return queryString;\n}\n\n/**\n * Checks if query has binary operation\n */\nexport function hasBinaryOp(\n  query: PromLokiVisualQuery,\n  operationsRegistry: Map<string, QueryBuilderOperationDef>\n): boolean {\n  return (\n    query.operations.find((op) => {\n      const def = operationsRegistry.get(op.id);\n      return def?.category === PromVisualQueryOperationCategory.BinaryOps;\n    }) !== undefined\n  );\n}\n","import { isValidLegacyName } from '../../../utf8_support';\nimport { PromLokiVisualQuery, VisualQueryBinary } from '../LokiAndPromQueryModellerBase';\nimport { QueryBuilderOperationDef } from '../types';\n\nimport { renderLabels } from './labels';\nimport { hasBinaryOp, renderOperations } from './operations';\n\n/**\n * Renders binary queries\n */\nexport function renderBinaryQueries(\n  queryString: string,\n  binaryQueries?: Array<VisualQueryBinary<PromLokiVisualQuery>>\n): string {\n  if (binaryQueries) {\n    for (const binQuery of binaryQueries) {\n      queryString = `${renderBinaryQuery(queryString, binQuery)}`;\n    }\n  }\n  return queryString;\n}\n\n/**\n * Renders a binary query\n */\nexport function renderBinaryQuery(leftOperand: string, binaryQuery: VisualQueryBinary<PromLokiVisualQuery>): string {\n  let result = leftOperand + ` ${binaryQuery.operator} `;\n\n  if (binaryQuery.vectorMatches) {\n    result += `${binaryQuery.vectorMatchesType}(${binaryQuery.vectorMatches}) `;\n  }\n\n  return result + renderQuery(binaryQuery.query, true);\n}\n\n/**\n * Renders a full query\n */\nexport function renderQuery(\n  query: PromLokiVisualQuery,\n  nested?: boolean,\n  operationsRegistry?: Map<string, QueryBuilderOperationDef>\n): string {\n  // Handle empty query\n  if (!query.metric && query.labels.length === 0 && query.operations.length === 0) {\n    return '';\n  }\n\n  let queryString = '';\n  const labels = renderLabels(query.labels);\n\n  if (query.metric) {\n    if (isValidLegacyName(query.metric)) {\n      // This is a legacy metric, put outside the curl legacy_query{label=\"value\"}\n      queryString = `${query.metric}${labels}`;\n    } else {\n      // This is a utf8 metric, put inside the curly and quotes {\"utf8.metric\", label=\"value\"}\n      queryString = `{\"${query.metric}\"${labels.length > 0 ? `, ${labels.substring(1)}` : `}`}`;\n    }\n  } else if (query.labels.length > 0) {\n    // No metric just use labels {label=\"value\"}\n    queryString = labels;\n  } else if (query.operations.length > 0) {\n    // For query patterns, we want the operation to render as e.g. rate([$__rate_interval])\n    queryString = '';\n  }\n\n  // If we have operations and an operations registry, render the operations\n  if (query.operations.length > 0) {\n    if (operationsRegistry) {\n      queryString = renderOperations(queryString, query.operations, operationsRegistry);\n    } else {\n      // For cases like add_label_to_query, handle operations generically\n      for (const operation of query.operations) {\n        // Special case to handle basic operations like multiplication\n        if (operation.id === 'MultiplyBy' && operation.params && operation.params.length > 0) {\n          queryString = `${queryString} * ${operation.params[0]}`;\n        }\n      }\n    }\n  }\n\n  // Check if this query or child queries need parentheses\n  const hasNesting = Boolean(query.binaryQueries?.length);\n  const hasBinaryOperation = operationsRegistry ? hasBinaryOp(query, operationsRegistry) : false;\n\n  // Handle nested queries with binary operations\n  if (!nested && hasBinaryOperation && hasNesting) {\n    queryString = `(${queryString})`;\n  }\n\n  // Render any binary queries\n  if (hasNesting) {\n    for (const binQuery of query.binaryQueries!) {\n      const rightOperand = renderNestedPart(binQuery.query, operationsRegistry);\n\n      // Add vector matching if present\n      let vectorMatchingStr = '';\n      if (binQuery.vectorMatches) {\n        vectorMatchingStr = `${binQuery.vectorMatchesType}(${binQuery.vectorMatches}) `;\n      }\n\n      // Combine left and right operands with operator\n      queryString = `${queryString} ${binQuery.operator} ${vectorMatchingStr}${rightOperand}`;\n    }\n  }\n\n  // Add parentheses for nested queries when needed\n  if (nested && (hasBinaryOperation || hasNesting)) {\n    queryString = `(${queryString})`;\n  }\n\n  return queryString;\n}\n\n/**\n * Special helper for rendering a nested part of a binary query\n * This ensures we only add parentheses when needed\n */\nfunction renderNestedPart(\n  query: PromLokiVisualQuery,\n  operationsRegistry?: Map<string, QueryBuilderOperationDef>\n): string {\n  // First render the query itself\n  const renderedQuery = renderQuery(query, false, operationsRegistry);\n\n  const hasOps = query.operations.length > 0;\n  const hasNestedBinary = Boolean(query.binaryQueries?.length);\n\n  // If this is an operation-only query (no metric, no labels, no binaryQueries, at least one operation), do not add parentheses\n  if (hasOps && !hasNestedBinary && !query.metric && (!query.labels || query.labels.length === 0)) {\n    return renderedQuery;\n  }\n\n  // Keep the correct format for test expectations\n  if (hasOps || hasNestedBinary) {\n    return `(${renderedQuery})`;\n  }\n\n  return renderedQuery;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/add_label_to_query.ts\nimport { parser, VectorSelector } from '@prometheus-io/lezer-promql';\n\nimport { buildVisualQueryFromString } from './querybuilder/parsing';\nimport { renderQuery } from './querybuilder/shared/rendering/query';\nimport { QueryBuilderLabelFilter } from './querybuilder/shared/types';\nimport { PromVisualQuery } from './querybuilder/types';\n\n/**\n * Adds label filter to existing query. Useful for query modification for example for ad hoc filters.\n *\n * It uses PromQL parser to find instances of metric and labels, alters them and then splices them back into the query.\n * Ideally we could use the parse -> change -> render is a simple 3 steps but right now building the visual query\n * object does not support all possible queries.\n *\n * So instead this just operates on substrings of the query with labels and operates just on those. This makes this\n * more robust and can alter even invalid queries, and preserves in general the query structure and whitespace.\n * @param query\n * @param key\n * @param value\n * @param operator\n */\nexport function addLabelToQuery(query: string, key: string, value: string | number, operator = '='): string {\n  if (!key || !value) {\n    throw new Error('Need label to add to query.');\n  }\n\n  const vectorSelectorPositions = getVectorSelectorPositions(query);\n  if (!vectorSelectorPositions.length) {\n    return query;\n  }\n\n  const filter = toLabelFilter(key, value, operator);\n  return addFilter(query, vectorSelectorPositions, filter);\n}\n\ntype VectorSelectorPosition = { from: number; to: number; query: PromVisualQuery };\n\n/**\n * Parse the string and get all VectorSelector positions in the query together with parsed representation of the vector\n * selector.\n * @param query\n */\nfunction getVectorSelectorPositions(query: string): VectorSelectorPosition[] {\n  const tree = parser.parse(query);\n  const positions: VectorSelectorPosition[] = [];\n  tree.iterate({\n    enter: ({ to, from, type }): false | void => {\n      if (type.id === VectorSelector) {\n        const visQuery = buildVisualQueryFromString(query.substring(from, to));\n        positions.push({ query: visQuery.query, from, to });\n        return false;\n      }\n    },\n  });\n  return positions;\n}\n\nfunction toLabelFilter(key: string, value: string | number, operator: string): QueryBuilderLabelFilter {\n  // We need to make sure that we convert the value back to string because it may be a number\n  const transformedValue = value === Infinity ? '+Inf' : value.toString();\n  return { label: key, op: operator, value: transformedValue };\n}\n\nfunction addFilter(\n  query: string,\n  vectorSelectorPositions: VectorSelectorPosition[],\n  filter: QueryBuilderLabelFilter\n): string {\n  let newQuery = '';\n  let prev = 0;\n\n  for (let i = 0; i < vectorSelectorPositions.length; i++) {\n    // This is basically just doing splice on a string for each matched vector selector.\n\n    const match = vectorSelectorPositions[i];\n    const isLast = i === vectorSelectorPositions.length - 1;\n\n    const start = query.substring(prev, match.from);\n    const end = isLast ? query.substring(match.to) : '';\n\n    if (!labelExists(match.query.labels, filter)) {\n      // We don't want to add duplicate labels.\n      match.query.labels.push(filter);\n    }\n    const newLabels = renderQuery(match.query);\n    newQuery += start + newLabels + end;\n    prev = match.to;\n  }\n  return newQuery;\n}\n\n/**\n * Check if label exists in the list of labels but ignore the operator.\n * @param labels\n * @param filter\n */\nfunction labelExists(labels: QueryBuilderLabelFilter[], filter: QueryBuilderLabelFilter) {\n  return labels.find((label) => label.label === filter.label && label.value === filter.value);\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/query_hints.ts\nimport { size } from 'lodash';\n\nimport { QueryFix, QueryHint } from '@grafana/data';\n\nimport { PrometheusDatasource } from './datasource';\nimport { buildVisualQueryFromString } from './querybuilder/parsing';\nimport { QueryBuilderLabelFilter } from './querybuilder/shared/types';\nimport { PromVisualQuery } from './querybuilder/types';\nimport { PromMetricsMetadata, RecordingRuleIdentifier, RuleQueryMapping } from './types';\n\n/**\n * Number of time series results needed before starting to suggest sum aggregation hints\n */\nexport const SUM_HINT_THRESHOLD_COUNT = 20;\n\nexport function getQueryHints(query: string, series?: unknown[], datasource?: PrometheusDatasource): QueryHint[] {\n  const hints = [];\n\n  const metricsMetadata = datasource?.languageProvider?.retrieveMetricsMetadata();\n\n  // ..._bucket metric needs a histogram_quantile()\n  // this regex also prevents hints from being shown when a query already has a function\n  const oldHistogramMetric = query.trim().match(/^\\w+_bucket$|^\\w+_bucket{.*}$/);\n  if (oldHistogramMetric) {\n    const label = 'Selected metric has buckets.';\n    hints.push({\n      type: 'HISTOGRAM_QUANTILE',\n      label,\n      fix: {\n        label: 'Consider calculating aggregated quantile by adding histogram_quantile().',\n        action: {\n          type: 'ADD_HISTOGRAM_QUANTILE',\n          query,\n        },\n      },\n    });\n  } else if (metricsMetadata && simpleQueryCheck(query)) {\n    // having migrated to native histograms\n    // there will be no more old histograms (no buckets)\n    // and we can identify a native histogram by the following\n    // type === 'histogram'\n    // metric name does not include '_bucket'\n    const queryTokens = getQueryTokens(query);\n\n    // Determine whether any of the query identifier tokens refers to a native histogram metric\n    const { nameMetric } = checkMetricType(queryTokens, 'histogram', metricsMetadata, false);\n\n    const nativeHistogramNameMetric = nameMetric;\n\n    if (nativeHistogramNameMetric) {\n      // add hints:\n      // histogram_quantile, histogram_avg, histogram_count\n      const label = 'Selected metric is a native histogram.';\n      hints.push(\n        {\n          type: 'HISTOGRAM_QUANTILE',\n          label,\n          fix: {\n            label: 'Consider calculating aggregated quantile by adding histogram_quantile().',\n            action: {\n              type: 'ADD_HISTOGRAM_QUANTILE',\n              query,\n            },\n          },\n        },\n        {\n          type: 'HISTOGRAM_AVG',\n          label,\n          fix: {\n            label: 'Consider calculating the arithmetic average of observed values by adding histogram_avg().',\n            action: {\n              type: 'ADD_HISTOGRAM_AVG',\n              query,\n            },\n          },\n        },\n        {\n          type: 'HISTOGRAM_COUNT',\n          label,\n          fix: {\n            label: 'Consider calculating the count of observations by adding histogram_count().',\n            action: {\n              type: 'ADD_HISTOGRAM_COUNT',\n              query,\n            },\n          },\n        }\n      );\n    }\n  }\n\n  // Check for need of rate()\n  if (query.indexOf('rate(') === -1 && query.indexOf('increase(') === -1) {\n    // Use metric metadata for exact types\n    const nameMatch = query.match(/\\b((?<!:)\\w+_(total|sum|count)(?!:))\\b/);\n    let counterNameMetric = nameMatch ? nameMatch[1] : '';\n    let certain = false;\n\n    if (metricsMetadata) {\n      // Tokenize the query into its identifiers (see https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels)\n      const queryTokens = getQueryTokens(query);\n      // Determine whether any of the query identifier tokens refers to a counter metric\n      const metricTypeChecked = checkMetricType(queryTokens, 'counter', metricsMetadata, certain);\n\n      counterNameMetric = metricTypeChecked.nameMetric;\n      certain = metricTypeChecked.certain;\n    }\n\n    if (counterNameMetric) {\n      // FixableQuery consists of metric name and optionally label-value pairs. We are not offering fix for complex queries yet.\n      const fixableQuery = simpleQueryCheck(query);\n      const verb = certain ? 'is' : 'looks like';\n      let label = `Selected metric ${verb} a counter.`;\n      let fix: QueryFix | undefined;\n\n      if (fixableQuery) {\n        fix = {\n          label: 'Consider calculating rate of counter by adding rate().',\n          action: {\n            type: 'ADD_RATE',\n            query,\n          },\n        };\n      } else {\n        label = `${label} Consider calculating rate of counter by adding rate().`;\n      }\n\n      hints.push({\n        type: 'APPLY_RATE',\n        label,\n        fix,\n      });\n    }\n  }\n\n  // Check for recording rules expansion\n  if (datasource && datasource.ruleMappings) {\n    const expandQueryHints = getExpandRulesHints(query, datasource.ruleMappings);\n    hints.push(...expandQueryHints);\n  }\n\n  if (series && series.length >= SUM_HINT_THRESHOLD_COUNT) {\n    const simpleMetric = query.trim().match(/^\\w+$/);\n    if (simpleMetric) {\n      hints.push({\n        type: 'ADD_SUM',\n        label: 'Many time series results returned.',\n        fix: {\n          label: 'Consider aggregating with sum().',\n          action: {\n            type: 'ADD_SUM',\n            query: query,\n            preventSubmit: true,\n          },\n        },\n      });\n    }\n  }\n\n  return hints;\n}\n\nexport function getInitHints(datasource: PrometheusDatasource): QueryHint[] {\n  const hints = [];\n\n  // Hint for big disabled lookups\n  if (datasource.lookupsDisabled) {\n    hints.push({\n      label: `Labels and metrics lookup was disabled in data source settings.`,\n      type: 'INFO',\n    });\n  }\n\n  return hints;\n}\n\nexport function isRuleInQuery(query: string, ruleName: string) {\n  if (!query || !ruleName) {\n    return false;\n  }\n\n  const getRuleRegex = new RegExp(`(?<![\\\\w:])${ruleName}(?=[\\\\[{(\\\\s\\\\)]|$)`);\n  return getRuleRegex.test(query);\n}\n\nexport function getExpandRulesHints(query: string, mapping: RuleQueryMapping): QueryHint[] {\n  const hints: QueryHint[] = [];\n  const mappingForQuery = Object.keys(mapping).reduce((acc, ruleName) => {\n    if (!isRuleInQuery(query, ruleName)) {\n      return acc;\n    }\n\n    if (mapping[ruleName].length > 1) {\n      const { idx, expandedQuery, identifier, identifierValue } = getRecordingRuleIdentifierIdx(\n        query,\n        ruleName,\n        mapping[ruleName]\n      );\n\n      // No identifier detected add warning\n      if (idx === -1) {\n        hints.push({\n          type: 'EXPAND_RULES_WARNING',\n          label:\n            'We found multiple recording rules that match in this query. To expand the recording rule, add an identifier label/value.',\n        });\n        return acc;\n      } else {\n        // Identifier found.\n        return {\n          ...acc,\n          [ruleName]: {\n            expandedQuery,\n            identifier,\n            identifierValue,\n          },\n        };\n      }\n    } else {\n      return {\n        ...acc,\n        [ruleName]: {\n          expandedQuery: mapping[ruleName][0].query,\n        },\n      };\n    }\n  }, {});\n\n  if (size(mappingForQuery) > 0) {\n    const label = 'Query contains recording rules.';\n    hints.push({\n      type: 'EXPAND_RULES',\n      label,\n      fix: {\n        label: 'Expand rules',\n        action: {\n          type: 'EXPAND_RULES',\n          query,\n          options: mappingForQuery,\n        },\n      },\n    });\n  }\n\n  return hints;\n}\n\nexport function getRecordingRuleIdentifierIdx(\n  queryStr: string,\n  ruleName: string,\n  mapping: RuleQueryMapping[string]\n): RecordingRuleIdentifier & { idx: number } {\n  const { query } = buildVisualQueryFromString(queryStr);\n  const queryMetricLabels: QueryBuilderLabelFilter[] = getQueryLabelsForRuleName(ruleName, query);\n  if (queryMetricLabels.length === 0) {\n    return { idx: -1, identifier: '', identifierValue: '', expandedQuery: '' };\n  }\n\n  let uuidLabel = '';\n  let uuidLabelValue = '';\n  let uuidLabelIdx = -1;\n\n  queryMetricLabels.forEach((qml) => {\n    if (uuidLabelIdx === -1 && qml.label.search('uuid') !== -1) {\n      uuidLabel = qml.label;\n      uuidLabelValue = qml.value;\n    }\n  });\n\n  mapping.forEach((mp, idx) => {\n    if (mp.labels) {\n      Object.entries(mp.labels).forEach(([key, value]) => {\n        if (uuidLabelIdx === -1 && key === uuidLabel && value === uuidLabelValue) {\n          uuidLabelIdx = idx;\n        }\n      });\n    }\n  });\n\n  return {\n    idx: uuidLabelIdx,\n    identifier: uuidLabel,\n    identifierValue: uuidLabelValue,\n    expandedQuery: mapping[uuidLabelIdx]?.query ?? '',\n  };\n}\n\n// returns the labels of matching metric\n// metricName is the ruleName in query\nexport function getQueryLabelsForRuleName(metricName: string, query: PromVisualQuery): QueryBuilderLabelFilter[] {\n  if (query.metric === metricName) {\n    return query.labels;\n  } else {\n    if (query.binaryQueries) {\n      for (let i = 0; i < query.binaryQueries.length; i++) {\n        const labels = getQueryLabelsForRuleName(metricName, query.binaryQueries[i].query);\n        if (labels && labels.length > 0) {\n          return labels;\n        }\n      }\n    }\n    return [];\n  }\n}\n\nfunction getQueryTokens(query: string) {\n  return (\n    Array.from(query.matchAll(/\\$?[a-zA-Z_:][a-zA-Z0-9_:]*/g))\n      .map(([match]) => match)\n      // Exclude variable identifiers\n      .filter((token) => !token.startsWith('$'))\n      // Split composite keys to match the tokens returned by the language provider\n      .flatMap((token) => token.split(':'))\n  );\n}\n\nfunction checkMetricType(\n  queryTokens: string[],\n  metricType: string,\n  metricsMetadata: PromMetricsMetadata,\n  certain: boolean\n) {\n  // update certain to change language for counters\n  const nameMetric =\n    queryTokens.find((metricName) => {\n      // Only considering first type information, could be non-deterministic\n      const metadata = metricsMetadata[metricName];\n      if (metadata && metadata.type.toLowerCase() === metricType) {\n        certain = true;\n        return true;\n      } else {\n        return false;\n      }\n    }) ?? '';\n\n  return { nameMetric, certain };\n}\n\n/**\n * This regex check looks for only metric name and label filters.\n * This prevents hints from being shown when a query already has a functions or is complex.\n * */\nfunction simpleQueryCheck(query: string) {\n  return query.trim().match(/^\\w+$|^\\w+{.*}$/);\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/core/utils/CancelablePromise.ts\n// https://github.com/facebook/react/issues/5465\n\nexport interface CancelablePromise<T> {\n  promise: Promise<T>;\n  cancel: () => void;\n}\n\nexport interface CancelablePromiseRejection {\n  isCanceled: boolean;\n}\n\nexport function isCancelablePromiseRejection(promise: unknown): promise is CancelablePromiseRejection {\n  return typeof promise === 'object' && promise !== null && 'isCanceled' in promise;\n}\n\nexport const makePromiseCancelable = <T>(promise: Promise<T>): CancelablePromise<T> => {\n  let hasCanceled_ = false;\n\n  const wrappedPromise = new Promise<T>((resolve, reject) => {\n    const canceledPromiseRejection: CancelablePromiseRejection = { isCanceled: true };\n    promise.then((val) => (hasCanceled_ ? reject(canceledPromiseRejection) : resolve(val)));\n    promise.catch((error) => (hasCanceled_ ? reject(canceledPromiseRejection) : reject(error)));\n  });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled_ = true;\n    },\n  };\n};\n","import { escapeLabelValueInExactSelector, escapeLabelValueInRegexSelector } from '../../escaping';\nimport { isValidLegacyName, utf8Support } from '../../utf8_support';\n\n/**\n * Builds a Prometheus selector string from a metric name and label values\n * @param selectedMetric - The metric name, can be empty\n * @param selectedLabelValues - Record of label names to their selected values\n * @returns A properly formatted Prometheus selector string\n */\nexport function buildSelector(selectedMetric: string, selectedLabelValues: Record<string, string[]>): string {\n  // Handle empty case\n  if (selectedMetric === '' && Object.keys(selectedLabelValues).length === 0) {\n    return '{}';\n  }\n\n  // Build all label selectors\n  const selectorParts: string[] = [];\n\n  // Process label selectors\n  for (const [key, values] of Object.entries(selectedLabelValues)) {\n    // Skip empty value arrays\n    if (values.length === 0) {\n      continue;\n    }\n\n    // Use regex matcher for multiple values\n    if (values.length > 1) {\n      selectorParts.push(`${utf8Support(key)}=~\"${values.map(escapeLabelValueInRegexSelector).join('|')}\"`);\n    } else {\n      // Use exact matcher for single value\n      selectorParts.push(`${utf8Support(key)}=\"${escapeLabelValueInExactSelector(values[0])}\"`);\n    }\n  }\n\n  // Handle metric name cases\n  if (selectedMetric === '') {\n    return `{${selectorParts.join(',')}}`;\n  }\n\n  if (isValidLegacyName(selectedMetric)) {\n    return `${selectedMetric}{${selectorParts.join(',')}}`;\n  }\n\n  // Add quoted metric as another selector when it's not a valid legacy name\n  selectorParts.unshift(utf8Support(selectedMetric));\n  return `{${selectorParts.join(',')}}`;\n}\n","import { useCallback, useEffect, useRef, useState, useMemo } from 'react';\nimport { useDebounce } from 'react-use';\n\nimport { TimeRange } from '@grafana/data';\n\nimport { EMPTY_SELECTOR, LAST_USED_LABELS_KEY, METRIC_LABEL } from '../../constants';\nimport { PrometheusLanguageProviderInterface } from '../../language_provider';\n\nimport { Metric } from './MetricsBrowserContext';\nimport { buildSelector } from './selectorBuilder';\n\nexport const useMetricsLabelsValues = (timeRange: TimeRange, languageProvider: PrometheusLanguageProviderInterface) => {\n  const timeRangeRef = useRef<TimeRange>(timeRange);\n  const lastSeriesLimitRef = useRef(languageProvider.datasource.seriesLimit);\n  const isInitializedRef = useRef(false);\n\n  const [seriesLimit, setSeriesLimit] = useState(languageProvider.datasource.seriesLimit);\n  const [err, setErr] = useState('');\n  const [status, setStatus] = useState('Ready');\n  const [validationStatus, setValidationStatus] = useState('');\n\n  const [metrics, setMetrics] = useState<Metric[]>([]);\n  const [selectedMetric, setSelectedMetric] = useState('');\n  const [labelKeys, setLabelKeys] = useState<string[]>([]);\n  const [selectedLabelKeys, setSelectedLabelKeys] = useState<string[]>([]);\n  const [lastSelectedLabelKey, setLastSelectedLabelKey] = useState('');\n  const [labelValues, setLabelValues] = useState<Record<string, string[]>>({});\n  const [selectedLabelValues, setSelectedLabelValues] = useState<Record<string, string[]>>({});\n\n  // Memoize the effective series limit to use the default when seriesLimit is empty\n  const effectiveLimit = useMemo(() => seriesLimit, [seriesLimit]);\n\n  // We don't want to trigger fetching for small amount of time changes.\n  // When MetricsBrowser re-renders for any reason we might receive a new timerange.\n  // This particularly happens when we have relative time ranges: from: now, to: now-1h\n  useEffect(() => {\n    if (\n      timeRange.to.diff(timeRangeRef.current.to, 'second') >= 5 &&\n      timeRange.from.diff(timeRangeRef.current.from, 'second') >= 5\n    ) {\n      timeRangeRef.current = timeRange;\n    }\n  }, [timeRange]);\n\n  // Handler for error processing - logs the error and updates UI state\n  const handleError = useCallback((e: unknown, msg: string) => {\n    if (e instanceof Error) {\n      setErr(`${msg}: ${e.message}`);\n    } else {\n      setErr(`${msg}: Unknown error`);\n    }\n    setStatus('');\n  }, []);\n\n  // Get metadata details for a metric if available\n  const getMetricDetails = useCallback(\n    (metricName: string) => {\n      const meta = languageProvider.retrieveMetricsMetadata();\n      return meta && meta[metricName] ? `(${meta[metricName].type}) ${meta[metricName].help}` : undefined;\n    },\n    [languageProvider]\n  );\n\n  // Builds a safe selector string from metric name and label values\n  // Prometheus API doesn't allow empty matchers. This is bad => match[]={}\n  // Converts EMPTY_SELECTOR to undefined as some API calls need that\n  const buildSafeSelector = useCallback((metric: string, labelValues: Record<string, string[]>) => {\n    const selector = buildSelector(metric, labelValues);\n    return selector === EMPTY_SELECTOR ? undefined : selector;\n  }, []);\n\n  // Loads label keys from localStorage and filters them against available labels\n  // This ensures we only show label keys that are actually available in the current context\n  const loadSelectedLabelsFromStorage = useCallback(\n    (availableLabelKeys: string[]) => {\n      try {\n        const labelKeysInLocalStorageAsString = localStorage.getItem(LAST_USED_LABELS_KEY) || '[]';\n        const labelKeysInLocalStorage = JSON.parse(labelKeysInLocalStorageAsString);\n        return labelKeysInLocalStorage.filter((slk: string) => availableLabelKeys.includes(slk));\n      } catch (e) {\n        handleError(e, 'Failed to load saved label keys');\n        return [];\n      }\n    },\n    [handleError]\n  );\n\n  // Fetches metrics that match the given selector\n  // Transforms raw metric strings into Metric objects with metadata\n  const fetchMetrics = useCallback(\n    async (safeSelector?: string) => {\n      try {\n        const fetchedMetrics = await languageProvider.queryLabelValues(\n          timeRangeRef.current,\n          METRIC_LABEL,\n          safeSelector,\n          effectiveLimit\n        );\n        return fetchedMetrics.map((m) => ({\n          name: m,\n          details: getMetricDetails(m),\n        }));\n      } catch (e) {\n        handleError(e, 'Error fetching metrics');\n        return [];\n      }\n    },\n    [getMetricDetails, handleError, languageProvider, effectiveLimit]\n  );\n\n  // Fetches label keys based on an optional selector\n  // Uses different APIs depending on whether a selector is provided\n  const fetchLabelKeys = useCallback(\n    async (safeSelector?: string) => {\n      try {\n        return (\n          (await languageProvider.queryLabelKeys(timeRangeRef.current, safeSelector || undefined, effectiveLimit)) ?? []\n        );\n      } catch (e) {\n        handleError(e, 'Error fetching labels');\n        return [];\n      }\n    },\n    [handleError, languageProvider, effectiveLimit]\n  );\n\n  // Fetches values for multiple label keys and also prepares selected values\n  const fetchLabelValues = useCallback(\n    async (labelKeys: string[], safeSelector?: string) => {\n      const transformedLabelValues: Record<string, string[]> = {};\n      const newSelectedLabelValues: Record<string, string[]> = {};\n      for (const lk of labelKeys) {\n        try {\n          const values = await languageProvider.queryLabelValues(\n            timeRangeRef.current,\n            lk,\n            safeSelector,\n            effectiveLimit\n          );\n          transformedLabelValues[lk] = values;\n          if (selectedLabelValues[lk]) {\n            newSelectedLabelValues[lk] = [...selectedLabelValues[lk]];\n          }\n\n          setErr('');\n        } catch (e) {\n          handleError(e, 'Error fetching label values');\n        }\n      }\n      return [transformedLabelValues, newSelectedLabelValues];\n    },\n    [handleError, languageProvider, selectedLabelValues, effectiveLimit]\n  );\n\n  // Initial set up of the Metrics Browser\n  // This is called when \"Clear\" button clicked.\n  const initialize = useCallback(\n    async (metric: string, labelValues: Record<string, string[]>) => {\n      const selector = buildSelector(metric, labelValues);\n      const safeSelector = selector === EMPTY_SELECTOR ? undefined : selector;\n\n      // Metrics\n      const transformedMetrics: Metric[] = await fetchMetrics(safeSelector);\n\n      // Labels\n      const transformedLabelKeys: string[] = await fetchLabelKeys(safeSelector);\n\n      // Selected Labels\n      const labelKeysInLocalStorage: string[] = loadSelectedLabelsFromStorage(transformedLabelKeys);\n\n      // Selected Labels' Values\n      const [transformedLabelValues] = await fetchLabelValues(labelKeysInLocalStorage, safeSelector);\n\n      setMetrics(transformedMetrics);\n      setLabelKeys(transformedLabelKeys);\n      setSelectedLabelKeys(labelKeysInLocalStorage);\n      setLabelValues(transformedLabelValues);\n    },\n    [fetchLabelKeys, fetchLabelValues, fetchMetrics, loadSelectedLabelsFromStorage]\n  );\n\n  // Initialize the hook\n  useEffect(() => {\n    initialize(selectedMetric, selectedLabelValues);\n    isInitializedRef.current = true;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // We use debounce here to prevent fetching data on every keystroke\n  // We also track the seriesLimit change to prevent fetching twice right after the initialization\n  useDebounce(\n    () => {\n      if (isInitializedRef.current && lastSeriesLimitRef.current !== seriesLimit) {\n        initialize(selectedMetric, selectedLabelValues);\n        lastSeriesLimitRef.current = seriesLimit;\n      }\n    },\n    300,\n    [seriesLimit]\n  );\n\n  // Handles metric selection changes.\n  // If a metric selected it fetches the labels of that metric\n  // Otherwise it fetches all the labels.\n  // Based on the fetched labels, label value list is updated.\n  // If a label key is not present, its values are removed from the list.\n  const handleSelectedMetricChange = async (metricName: string) => {\n    const newSelectedMetric = selectedMetric !== metricName ? metricName : '';\n    const selector = buildSafeSelector(newSelectedMetric, selectedLabelValues);\n    try {\n      const fetchedMetrics = await fetchMetrics(selector);\n      const fetchedLabelKeys = await fetchLabelKeys(selector);\n      const newSelectedLabelKeys = selectedLabelKeys.filter((slk) => fetchedLabelKeys.includes(slk));\n      const [transformedLabelValues, newSelectedLabelValues] = await fetchLabelValues(\n        newSelectedLabelKeys,\n        newSelectedMetric === '' ? undefined : selector\n      );\n\n      setMetrics(fetchedMetrics);\n      setSelectedMetric(newSelectedMetric);\n      setLabelKeys(fetchedLabelKeys);\n      setSelectedLabelKeys(newSelectedLabelKeys);\n      setLabelValues(transformedLabelValues);\n      setSelectedLabelValues(newSelectedLabelValues);\n    } catch (e: unknown) {\n      handleError(e, 'Error fetching labels');\n    }\n  };\n\n  // Handles when a label key selection changed\n  // If it's a selection, it fetches the values based on the up-to-date selector\n  // If it's a de-selection, it clears the values from the list\n  const handleSelectedLabelKeyChange = async (labelKey: string) => {\n    const newSelectedLabelKeys = [...selectedLabelKeys];\n    const lkIdx = newSelectedLabelKeys.indexOf(labelKey);\n    const newLabelValues: Record<string, string[]> = { ...labelValues };\n    const newSelectedLabelValues: Record<string, string[]> = { ...selectedLabelValues };\n\n    if (lkIdx === -1) {\n      // Label key is not in the selectedLabelKeys. Let's add it.\n      newSelectedLabelKeys.push(labelKey);\n      const safeSelector = buildSafeSelector(selectedMetric, selectedLabelValues);\n      const [values] = await fetchLabelValues([labelKey], safeSelector);\n      newLabelValues[labelKey] = values[labelKey];\n    } else {\n      // Label key is in the selectedLabelKeys. Removing it and its values.\n      newSelectedLabelKeys.splice(lkIdx, 1);\n      delete newLabelValues[labelKey];\n      delete newSelectedLabelValues[labelKey];\n    }\n\n    localStorage.setItem(LAST_USED_LABELS_KEY, JSON.stringify(newSelectedLabelKeys));\n    setSelectedLabelKeys(newSelectedLabelKeys);\n    setLabelValues(newLabelValues);\n    setSelectedLabelValues(newSelectedLabelValues);\n  };\n\n  // Handle the labelValue click based on isSelected value.\n  // If it is false we need to remove it from selected values\n  // If it is true then we need to add it to selected values\n  // Then we first fetch the values of each selected label key using the up-to-date selector\n  // We merged the fetched and existing list for the list we interact.\n  // Because we might want to select more labels from the same list.\n  // For other value lists we use the intersection of fetched and selected values.\n  // Then we fetch the metrics based on new selector we have after value fetch\n  // Then we fetch the labels keys of the metrics we fetched.\n  const handleSelectedLabelValueChange = async (labelKey: string, labelValue: string, isSelected: boolean) => {\n    const newSelectedLabelValues = { ...selectedLabelValues };\n    let newLastSelectedLabelKey = lastSelectedLabelKey;\n    if (labelKey !== lastSelectedLabelKey) {\n      newLastSelectedLabelKey = labelKey;\n    }\n\n    // Label value selected\n    if (isSelected) {\n      if (!newSelectedLabelValues[labelKey]) {\n        newSelectedLabelValues[labelKey] = [];\n      }\n      newSelectedLabelValues[labelKey].push(labelValue);\n    } else {\n      newSelectedLabelValues[labelKey].splice(newSelectedLabelValues[labelKey].indexOf(labelValue), 1);\n      if (newSelectedLabelValues[labelKey].length === 0) {\n        delete newSelectedLabelValues[labelKey];\n      }\n    }\n\n    let safeSelector = buildSafeSelector(selectedMetric, newSelectedLabelValues);\n\n    // Fetch new values\n    let newLabelValues: Record<string, string[]> = {};\n    if (selectedLabelKeys.length !== 0) {\n      for (const lk of selectedLabelKeys) {\n        try {\n          const fetchedLabelValues = await languageProvider.queryLabelValues(\n            timeRange,\n            lk,\n            safeSelector,\n            effectiveLimit\n          );\n\n          // We don't want to discard values from last selected list.\n          // User might want to select more.\n          if (newLastSelectedLabelKey === lk) {\n            newLabelValues[lk] = Array.from(new Set([...labelValues[lk], ...fetchedLabelValues]));\n          } else {\n            // If there are already selected values merge them with the fetched values.\n            newLabelValues[lk] = fetchedLabelValues;\n            // Discard selected label values if they are not in response\n            newSelectedLabelValues[lk] = (newSelectedLabelValues[lk] ?? []).filter((item) =>\n              fetchedLabelValues.includes(item)\n            );\n          }\n\n          setErr('');\n        } catch (e: unknown) {\n          handleError(e, 'Error fetching label values');\n        }\n      }\n    }\n\n    // rebuild the selector based on the new selected label values\n    safeSelector = buildSafeSelector(selectedMetric, newSelectedLabelValues);\n\n    // Fetch metrics\n    const newMetrics: Metric[] = await fetchMetrics(safeSelector);\n\n    // Fetch label keys\n    // If there is no metric or label value selected fetch all the keys instead of creating a selector\n    let newLabelKeys: string[] = [];\n    if (!safeSelector) {\n      newLabelKeys = await fetchLabelKeys(undefined);\n    } else {\n      const labelKeysSelector = `{${METRIC_LABEL}=~\"${newMetrics.map((m) => m.name).join('|')}\"}`;\n      newLabelKeys = await fetchLabelKeys(labelKeysSelector);\n    }\n    const newSelectedLabelKeys: string[] = loadSelectedLabelsFromStorage(newLabelKeys);\n\n    setMetrics(newMetrics);\n    setLabelKeys(newLabelKeys);\n    setSelectedLabelKeys(newSelectedLabelKeys);\n    setLastSelectedLabelKey(newLastSelectedLabelKey);\n    setLabelValues(newLabelValues);\n    setSelectedLabelValues(newSelectedLabelValues);\n  };\n\n  // Validating if the selections we have can create a valid query\n  const handleValidation = async () => {\n    const selector = buildSelector(selectedMetric, selectedLabelValues);\n    setValidationStatus(`Validating selector ${selector}`);\n    setErr('');\n\n    try {\n      const results = await languageProvider.queryLabelKeys(timeRangeRef.current, selector, effectiveLimit);\n      setValidationStatus(`Selector is valid (${Object.keys(results).length} labels found)`);\n    } catch (e) {\n      handleError(e, 'Validation failed');\n      setValidationStatus('');\n    }\n  };\n\n  // Clears all the selections even the ones in localStorage\n  const handleClear = () => {\n    localStorage.setItem(LAST_USED_LABELS_KEY, '[]');\n\n    setSelectedMetric('');\n    setSelectedLabelKeys([]);\n    setSelectedLabelValues({});\n\n    setErr('');\n    setStatus('Ready');\n    setValidationStatus('');\n\n    initialize('', {});\n  };\n\n  return {\n    err,\n    setErr,\n    status,\n    setStatus,\n    seriesLimit,\n    setSeriesLimit,\n    validationStatus,\n    metrics,\n    labelKeys,\n    labelValues,\n    selectedMetric,\n    selectedLabelKeys,\n    selectedLabelValues,\n    handleSelectedMetricChange,\n    handleSelectedLabelKeyChange,\n    handleSelectedLabelValueChange,\n    handleValidation,\n    handleClear,\n    // Helper functions - not part of the public API\n    buildSafeSelector,\n    loadSelectedLabelsFromStorage,\n    fetchMetrics,\n    fetchLabelKeys,\n    fetchLabelValues,\n  };\n};\n","import { createContext, PropsWithChildren, useCallback, useContext, useMemo } from 'react';\n\nimport { TimeRange } from '@grafana/data';\n\nimport { PrometheusLanguageProviderInterface } from '../../language_provider';\n\nimport { buildSelector } from './selectorBuilder';\nimport { useMetricsLabelsValues } from './useMetricsLabelsValues';\n\nexport interface Metric {\n  name: string;\n  details?: string;\n}\n\n/**\n * Context for the Metrics Browser component\n * Provides state and handlers for browsing and selecting Prometheus metrics and labels\n */\ninterface MetricsBrowserContextType {\n  // Error and status state\n  err: string;\n  setErr: (err: string) => void;\n  status: string;\n  setStatus: (status: string) => void;\n\n  // Series limit settings\n  seriesLimit: number;\n  setSeriesLimit: (limit: number) => void;\n\n  // Callback when selector changes\n  onChange: (selector: string) => void;\n\n  // Data and selection state\n  metrics: Metric[];\n  labelKeys: string[];\n  labelValues: Record<string, string[]>;\n  selectedMetric: string;\n  selectedLabelKeys: string[];\n  selectedLabelValues: Record<string, string[]>;\n\n  // Event handlers\n  onMetricClick: (name: string) => void;\n  onLabelKeyClick: (name: string) => void;\n  onLabelValueClick: (labelKey: string, labelValue: string, isSelected: boolean) => void;\n  getSelector: () => string;\n  onClearClick: () => void;\n\n  // Validation\n  validationStatus: string;\n  onValidationClick: () => void;\n}\n\nconst MetricsBrowserContext = createContext<MetricsBrowserContextType | undefined>(undefined);\n\ntype MetricsBrowserProviderProps = {\n  timeRange: TimeRange;\n  languageProvider: PrometheusLanguageProviderInterface;\n  onChange: (selector: string) => void;\n};\n\n/**\n * Provider component for the Metrics Browser context\n * Manages state and data fetching for metrics, labels, and values\n */\nexport function MetricsBrowserProvider({\n  children,\n  timeRange,\n  languageProvider,\n  onChange,\n}: PropsWithChildren<MetricsBrowserProviderProps>) {\n  const {\n    err,\n    setErr,\n    status,\n    setStatus,\n    seriesLimit,\n    setSeriesLimit,\n    validationStatus,\n    metrics,\n    labelKeys,\n    labelValues,\n    selectedMetric,\n    selectedLabelKeys,\n    selectedLabelValues,\n    handleSelectedMetricChange,\n    handleSelectedLabelKeyChange,\n    handleSelectedLabelValueChange,\n    handleValidation,\n    handleClear,\n  } = useMetricsLabelsValues(timeRange, languageProvider);\n\n  // Build a Prometheus selector string from the current selections\n  const getSelector = useCallback(\n    () => buildSelector(selectedMetric, selectedLabelValues),\n    [selectedLabelValues, selectedMetric]\n  );\n\n  // Memoize the context value to prevent unnecessary re-renders\n  const value = useMemo(\n    () => ({\n      err,\n      setErr,\n      status,\n      setStatus,\n      seriesLimit,\n      setSeriesLimit,\n      validationStatus,\n      onChange,\n      getSelector,\n      metrics,\n      labelKeys,\n      labelValues,\n      selectedMetric,\n      selectedLabelKeys,\n      selectedLabelValues,\n      onMetricClick: handleSelectedMetricChange,\n      onLabelKeyClick: handleSelectedLabelKeyChange,\n      onLabelValueClick: handleSelectedLabelValueChange,\n      onValidationClick: handleValidation,\n      onClearClick: handleClear,\n    }),\n    [\n      err,\n      setErr,\n      status,\n      setStatus,\n      seriesLimit,\n      setSeriesLimit,\n      validationStatus,\n      onChange,\n      metrics,\n      getSelector,\n      labelKeys,\n      labelValues,\n      selectedMetric,\n      selectedLabelKeys,\n      selectedLabelValues,\n      handleSelectedLabelKeyChange,\n      handleSelectedLabelValueChange,\n      handleSelectedMetricChange,\n      handleValidation,\n      handleClear,\n    ]\n  );\n\n  return <MetricsBrowserContext.Provider value={value}>{children}</MetricsBrowserContext.Provider>;\n}\n\n/**\n * Hook to access the MetricsBrowser context\n * Must be used within a MetricsBrowserProvider\n */\nexport function useMetricsBrowser() {\n  const context = useContext(MetricsBrowserContext);\n  if (context === undefined) {\n    throw new Error('useMetricsBrowser must be used within a MetricsBrowserProvider');\n  }\n  return context;\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nexport const getStylesMetricsBrowser = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    backgroundColor: theme.colors.background.secondary,\n    padding: theme.spacing(1),\n    width: '100%',\n  }),\n});\n\nexport const getStylesMetricSelector = (theme: GrafanaTheme2) => ({\n  section: css({\n    '& + &': {\n      margin: `${theme.spacing(2)} 0`,\n    },\n    position: 'relative',\n  }),\n  valueListWrapper: css({\n    borderLeft: `1px solid ${theme.colors.border.medium}`,\n    margin: `${theme.spacing(1)} 0`,\n    padding: `${theme.spacing(1)} 0 ${theme.spacing(1)} ${theme.spacing(1)}`,\n  }),\n  valueList: css({\n    marginRight: theme.spacing(1),\n    resize: 'horizontal',\n  }),\n});\n\nexport const getStylesLabelSelector = (theme: GrafanaTheme2) => ({\n  section: css({\n    '& + &': {\n      margin: `${theme.spacing(2)} 0`,\n    },\n    position: 'relative',\n  }),\n  list: css({\n    marginTop: theme.spacing(1),\n    display: 'flex',\n    flexWrap: 'wrap',\n    maxHeight: '200px',\n    overflow: 'auto',\n    alignContent: 'flex-start',\n  }),\n});\n\nexport const getStylesValueSelector = (theme: GrafanaTheme2) => ({\n  section: css({\n    '& + &': {\n      margin: `${theme.spacing(2)} 0`,\n    },\n    position: 'relative',\n  }),\n  valueListArea: css({\n    display: 'flex',\n    flexWrap: 'wrap',\n    marginTop: theme.spacing(1),\n  }),\n  valueTitle: css({\n    marginLeft: `-${theme.spacing(0.5)}`,\n    marginBottom: theme.spacing(1),\n  }),\n  valueListWrapper: css({\n    borderLeft: `1px solid ${theme.colors.border.medium}`,\n    margin: `${theme.spacing(1)} 0`,\n    padding: `${theme.spacing(1)} 0 ${theme.spacing(1)} ${theme.spacing(1)}`,\n  }),\n  valueList: css({\n    marginRight: theme.spacing(1),\n    resize: 'horizontal',\n  }),\n});\n\nexport const getStylesSelectorActions = (theme: GrafanaTheme2) => ({\n  section: css({\n    '& + &': {\n      margin: `${theme.spacing(2)} 0`,\n    },\n    position: 'relative',\n  }),\n  selector: css({\n    fontFamily: theme.typography.fontFamilyMonospace,\n    marginBottom: theme.spacing(1),\n  }),\n  status: css({\n    padding: theme.spacing(0.5),\n    color: theme.colors.text.secondary,\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    width: '100%',\n    right: 0,\n    textAlign: 'right',\n    opacity: 0,\n    [theme.transitions.handleMotion('no-preference', 'reduce')]: {\n      transition: 'opacity 100ms linear',\n    },\n  }),\n  statusShowing: css({\n    opacity: 1,\n  }),\n  error: css({\n    color: theme.colors.error.main,\n  }),\n  validationStatus: css({\n    padding: theme.spacing(0.5),\n    marginBottom: theme.spacing(1),\n    color: theme.colors.text.maxContrast,\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n  }),\n});\n","import { useMemo, useState } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { BrowserLabel as PromLabel, Input, Label, useStyles2 } from '@grafana/ui';\n\nimport { METRIC_LABEL } from '../../constants';\n\nimport { useMetricsBrowser } from './MetricsBrowserContext';\nimport { getStylesLabelSelector } from './styles';\n\nexport function LabelSelector() {\n  const styles = useStyles2(getStylesLabelSelector);\n  const [labelSearchTerm, setLabelSearchTerm] = useState('');\n  const { labelKeys, selectedLabelKeys, onLabelKeyClick } = useMetricsBrowser();\n\n  const filteredLabelKeys = useMemo(() => {\n    return labelKeys.filter(\n      (lk) => lk !== METRIC_LABEL && (selectedLabelKeys.includes(lk) || lk.includes(labelSearchTerm))\n    );\n  }, [labelKeys, labelSearchTerm, selectedLabelKeys]);\n\n  return (\n    <div className={styles.section}>\n      <Label\n        description={t(\n          'grafana-prometheus.components.label-selector.description-select-labels',\n          'Once label values are selected, only possible label combinations are shown.'\n        )}\n      >\n        <Trans i18nKey=\"grafana-prometheus.components.label-selector.select-labels-to-search-in\">\n          2. Select labels to search in\n        </Trans>\n      </Label>\n      <div>\n        <Input\n          onChange={(e) => setLabelSearchTerm(e.currentTarget.value)}\n          aria-label={t(\n            'grafana-prometheus.components.label-selector.aria-label-filter-expression-for-label',\n            'Filter expression for label'\n          )}\n          value={labelSearchTerm}\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.labelNamesFilter}\n        />\n      </div>\n      {/* Using fixed height here to prevent jumpy layout */}\n      <div className={styles.list} style={{ height: 120 }}>\n        {filteredLabelKeys.map((label) => (\n          <PromLabel\n            key={label}\n            name={label}\n            loading={false}\n            active={selectedLabelKeys.includes(label)}\n            hidden={false}\n            facets={undefined}\n            onClick={(name: string) => {\n              // Resetting search to prevent empty results\n              setLabelSearchTerm('');\n              onLabelKeyClick(name);\n            }}\n            searchTerm={labelSearchTerm}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n","import { useMemo, useState } from 'react';\nimport { FixedSizeList } from 'react-window';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { BrowserLabel as PromLabel, Input, Label, useStyles2 } from '@grafana/ui';\n\nimport { LIST_ITEM_SIZE } from '../../constants';\n\nimport { useMetricsBrowser } from './MetricsBrowserContext';\nimport { getStylesMetricSelector } from './styles';\n\nexport function MetricSelector() {\n  const styles = useStyles2(getStylesMetricSelector);\n  const [metricSearchTerm, setMetricSearchTerm] = useState('');\n  const { metrics, selectedMetric, seriesLimit, setSeriesLimit, onMetricClick } = useMetricsBrowser();\n\n  const filteredMetrics = useMemo(() => {\n    return metrics.filter((m) => m.name === selectedMetric || m.name.includes(metricSearchTerm));\n  }, [metrics, selectedMetric, metricSearchTerm]);\n\n  return (\n    <div>\n      <div className={styles.section}>\n        <Label\n          description={t(\n            'grafana-prometheus.components.metric-selector.label-select-metric',\n            'Once a metric is selected only possible labels are shown. Labels are limited by the series limit below.'\n          )}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.metric-selector.select-a-metric\">1. Select a metric</Trans>\n        </Label>\n        <div>\n          <Input\n            onChange={(e) => setMetricSearchTerm(e.currentTarget.value)}\n            aria-label={t(\n              'grafana-prometheus.components.metric-selector.aria-label-filter-expression-for-metric',\n              'Filter expression for metric'\n            )}\n            value={metricSearchTerm}\n            data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.selectMetric}\n          />\n        </div>\n        <Label\n          description={t(\n            'grafana-prometheus.components.metric-selector.description-series-limit',\n            'The limit applies to all metrics, labels, and values. Leave the field empty to use the default limit. Set to 0 to disable the limit and fetch everything  this may cause performance issues.'\n          )}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.metric-selector.series-limit\">Series limit</Trans>\n        </Label>\n        <div>\n          <Input\n            onChange={(e) => setSeriesLimit(parseInt(e.currentTarget.value.trim(), 10))}\n            aria-label={t(\n              'grafana-prometheus.components.metric-selector.aria-label-limit-results-from-series-endpoint',\n              'Limit results from series endpoint'\n            )}\n            value={seriesLimit}\n            data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.seriesLimit}\n          />\n        </div>\n        <div\n          role=\"list\"\n          className={styles.valueListWrapper}\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.metricList}\n        >\n          <FixedSizeList\n            height={Math.min(450, filteredMetrics.length * LIST_ITEM_SIZE)}\n            itemCount={filteredMetrics.length}\n            itemSize={LIST_ITEM_SIZE}\n            itemKey={(i) => filteredMetrics[i].name}\n            width={300}\n            className={styles.valueList}\n          >\n            {({ index, style }) => {\n              const metric = filteredMetrics[index];\n              return (\n                <div style={style}>\n                  <PromLabel\n                    name={metric.name}\n                    value={metric.name}\n                    title={metric.details}\n                    active={metric.name === selectedMetric}\n                    onClick={(name: string, value: string | undefined) => {\n                      // Resetting search to prevent empty results\n                      setMetricSearchTerm('');\n                      onMetricClick(name);\n                    }}\n                    searchTerm={metricSearchTerm}\n                  />\n                </div>\n              );\n            }}\n          </FixedSizeList>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { cx } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Label, Stack, useStyles2 } from '@grafana/ui';\n\nimport { EMPTY_SELECTOR } from '../../constants';\n\nimport { useMetricsBrowser } from './MetricsBrowserContext';\nimport { getStylesSelectorActions } from './styles';\n\nexport function SelectorActions() {\n  const styles = useStyles2(getStylesSelectorActions);\n  const { validationStatus, onValidationClick, getSelector, onChange, status, err, onClearClick } = useMetricsBrowser();\n\n  const selector = getSelector();\n\n  const onClickRunQuery = () => {\n    onChange(selector);\n  };\n\n  const onClickRunRateQuery = () => {\n    const query = `rate(${selector}[$__rate_interval])`;\n    onChange(query);\n  };\n\n  const empty = useMemo(() => selector === EMPTY_SELECTOR, [selector]);\n\n  return (\n    <div className={styles.section}>\n      <Label>\n        <Trans i18nKey=\"grafana-prometheus.components.selector-actions.resulting-selector\">4. Resulting selector</Trans>\n      </Label>\n      <div\n        aria-label={t('grafana-prometheus.components.selector-actions.aria-label-selector', 'selector')}\n        className={styles.selector}\n      >\n        {selector}\n      </div>\n      {validationStatus && <div className={styles.validationStatus}>{validationStatus}</div>}\n      <Stack>\n        <Button\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.useQuery}\n          aria-label={t(\n            'grafana-prometheus.components.selector-actions.aria-label-use-selector-for-query-button',\n            'Use selector for query button'\n          )}\n          disabled={empty}\n          onClick={onClickRunQuery}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.selector-actions.use-query\">Use query</Trans>\n        </Button>\n        <Button\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.useAsRateQuery}\n          aria-label={t(\n            'grafana-prometheus.components.selector-actions.aria-label-use-selector-as-metrics-button',\n            'Use selector as metrics button'\n          )}\n          variant=\"secondary\"\n          disabled={empty}\n          onClick={onClickRunRateQuery}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.selector-actions.use-as-rate-query\">Use as rate query</Trans>\n        </Button>\n        <Button\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.validateSelector}\n          aria-label={t(\n            'grafana-prometheus.components.selector-actions.aria-label-validate-submit-button',\n            'Validate submit button'\n          )}\n          variant=\"secondary\"\n          disabled={empty}\n          onClick={onValidationClick}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.selector-actions.validate-selector\">Validate selector</Trans>\n        </Button>\n        <Button\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.clear}\n          aria-label={t(\n            'grafana-prometheus.components.selector-actions.aria-label-selector-clear-button',\n            'Selector clear button'\n          )}\n          variant=\"secondary\"\n          onClick={onClearClick}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.selector-actions.clear\">Clear</Trans>\n        </Button>\n        <div className={cx(styles.status, (status || err) && styles.statusShowing)}>\n          <span className={err ? styles.error : ''}>{err || status}</span>\n        </div>\n      </Stack>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { FixedSizeList } from 'react-window';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t, Trans } from '@grafana/i18n';\nimport { BrowserLabel as PromLabel, Input, Label, useStyles2 } from '@grafana/ui';\n\nimport { LIST_ITEM_SIZE } from '../../constants';\n\nimport { useMetricsBrowser } from './MetricsBrowserContext';\nimport { getStylesValueSelector } from './styles';\n\nexport function ValueSelector() {\n  const styles = useStyles2(getStylesValueSelector);\n  const [valueSearchTerm, setValueSearchTerm] = useState('');\n  const { labelValues, selectedLabelValues, onLabelValueClick, onLabelKeyClick } = useMetricsBrowser();\n\n  return (\n    <div className={styles.section}>\n      <Label\n        description={t(\n          'grafana-prometheus.components.value-selector.description-search-field-values-across-selected-labels',\n          'Use the search field to find values across selected labels.'\n        )}\n      >\n        <Trans i18nKey=\"grafana-prometheus.components.value-selector.select-multiple-values-for-your-labels\">\n          3. Select (multiple) values for your labels\n        </Trans>\n      </Label>\n      <div>\n        <Input\n          onChange={(e) => setValueSearchTerm(e.currentTarget.value)}\n          aria-label={t(\n            'grafana-prometheus.components.value-selector.aria-label-filter-expression-for-label-values',\n            'Filter expression for label values'\n          )}\n          value={valueSearchTerm}\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.labelValuesFilter}\n        />\n      </div>\n      <div className={styles.valueListArea}>\n        {Object.entries(labelValues).map(([lk, lv]) => {\n          if (!lk || !lv) {\n            console.error('label values are empty:', { lk, lv });\n            return null;\n          }\n          return (\n            <div\n              role=\"list\"\n              key={lk}\n              aria-label={t(\n                'grafana-prometheus.components.value-selector.aria-label-values-for',\n                'Values for {{labelKey}}',\n                {\n                  labelKey: lk,\n                }\n              )}\n              className={styles.valueListWrapper}\n            >\n              <div className={styles.valueTitle}>\n                <PromLabel\n                  name={lk}\n                  loading={false}\n                  active={true}\n                  hidden={false}\n                  facets={lv.length}\n                  onClick={onLabelKeyClick}\n                />\n              </div>\n              <FixedSizeList\n                height={Math.min(200, LIST_ITEM_SIZE * (lv.length || 0))}\n                itemCount={lv.length || 0}\n                itemSize={28}\n                itemKey={(i) => lv[i]}\n                width={200}\n                className={styles.valueList}\n              >\n                {({ index, style }) => {\n                  const value = lv[index];\n                  const isSelected = selectedLabelValues[lk]?.includes(value);\n                  return (\n                    <div style={style}>\n                      <PromLabel\n                        name={value}\n                        value={value}\n                        active={isSelected}\n                        onClick={(name) => onLabelValueClick(lk, name, !isSelected)}\n                        searchTerm={valueSearchTerm}\n                      />\n                    </div>\n                  );\n                }}\n              </FixedSizeList>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PrometheusMetricsBrowser.tsx\nimport { Stack, useStyles2 } from '@grafana/ui';\n\nimport { LabelSelector } from './LabelSelector';\nimport { MetricSelector } from './MetricSelector';\nimport { SelectorActions } from './SelectorActions';\nimport { ValueSelector } from './ValueSelector';\nimport { getStylesMetricsBrowser } from './styles';\n\nexport const MetricsBrowser = () => {\n  const styles = useStyles2(getStylesMetricsBrowser);\n\n  return (\n    <div className={styles.wrapper}>\n      <Stack gap={3}>\n        <MetricSelector />\n        <div>\n          <LabelSelector />\n\n          <ValueSelector />\n        </div>\n      </Stack>\n\n      <SelectorActions />\n    </div>\n  );\n};\n","// The MIT License (MIT)\n//\n// Copyright (c) Celian Garcia and Augustin Husson @ Amadeus IT Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n'use strict';\n// noinspection JSUnusedGlobalSymbols\nexport var promLanguageDefinition = {\n    id: 'promql',\n    extensions: ['.promql'],\n    aliases: ['Prometheus', 'prometheus', 'prom', 'Prom', 'promql', 'Promql', 'promQL', 'PromQL'],\n    mimetypes: [],\n    loader: function () { return import('./promql'); } // eslint-disable-line @typescript-eslint/explicit-function-return-type\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/getOverrideServices.ts\nimport { monacoTypes } from '@grafana/ui';\n\n// this thing here is a workaround in a way.\n// what we want to achieve, is that when the autocomplete-window\n// opens, the \"second, extra popup\" with the extra help,\n// also opens automatically.\n// but there is no API to achieve it.\n// the way to do it is to implement the `storageService`\n// interface, and provide our custom implementation,\n// which will default to `true` for the correct string-key.\n// unfortunately, while the typescript-interface exists,\n// it is not exported from monaco-editor,\n// so we cannot rely on typescript to make sure\n// we do it right. all we can do is to manually\n// lookup the interface, and make sure we code our code right.\n// our code is a \"best effort\" approach,\n// i am not 100% how the `scope` and `target` things work,\n// but so far it seems to work ok.\n// i would use an another approach, if there was one available.\n\nfunction makeStorageService() {\n  // we need to return an object that fulfills this interface:\n  // https://github.com/microsoft/vscode/blob/ff1e16eebb93af79fd6d7af1356c4003a120c563/src/vs/platform/storage/common/storage.ts#L37\n  // unfortunately it is not export from monaco-editor\n\n  const strings = new Map<string, string>();\n\n  // we want this to be true by default\n  strings.set('expandSuggestionDocs', true.toString());\n\n  return {\n    // we do not implement the on* handlers\n    onDidChangeValue: (data: unknown): void => undefined,\n    onDidChangeTarget: (data: unknown): void => undefined,\n    onWillSaveState: (data: unknown): void => undefined,\n\n    get: (key: string, scope: unknown, fallbackValue?: string): string | undefined => {\n      return strings.get(key) ?? fallbackValue;\n    },\n\n    getBoolean: (key: string, scope: unknown, fallbackValue?: boolean): boolean | undefined => {\n      const val = strings.get(key);\n      if (val !== undefined) {\n        // the interface-docs say the value will be converted\n        // to a boolean but do not specify how, so we improvise\n        return val === 'true';\n      } else {\n        return fallbackValue;\n      }\n    },\n\n    getNumber: (key: string, scope: unknown, fallbackValue?: number): number | undefined => {\n      const val = strings.get(key);\n      if (val !== undefined) {\n        return parseInt(val, 10);\n      } else {\n        return fallbackValue;\n      }\n    },\n\n    store: (\n      key: string,\n      value: string | boolean | number | undefined | null,\n      scope: unknown,\n      target: unknown\n    ): void => {\n      // the interface-docs say if the value is nullish, it should act as delete\n      if (value === null || value === undefined) {\n        strings.delete(key);\n      } else {\n        strings.set(key, value.toString());\n      }\n    },\n\n    remove: (key: string, scope: unknown): void => {\n      strings.delete(key);\n    },\n\n    keys: (scope: unknown, target: unknown): string[] => {\n      return Array.from(strings.keys());\n    },\n\n    logStorage: (): void => {\n      console.log('logStorage: not implemented');\n    },\n\n    migrate: (): Promise<void> => {\n      // we do not implement this\n      return Promise.resolve(undefined);\n    },\n\n    isNew: (scope: unknown): boolean => {\n      // we create a new storage for every session, we do not persist it,\n      // so we return `true`.\n      return true;\n    },\n\n    flush: (reason?: unknown): Promise<void> => {\n      // we do not implement this\n      return Promise.resolve(undefined);\n    },\n  };\n}\n\nlet overrideServices: monacoTypes.editor.IEditorOverrideServices | null = null;\n\nexport function getOverrideServices(): monacoTypes.editor.IEditorOverrideServices {\n  // only have one instance of this for every query editor\n  if (overrideServices === null) {\n    overrideServices = {\n      storageService: makeStorageService(),\n    };\n  }\n\n  return overrideServices;\n}\n","import { HistoryItem } from '@grafana/data';\nimport type { Monaco } from '@grafana/ui'; // used in TSDoc `@link` below\n\nimport { type PrometheusLanguageProviderInterface } from '../../../language_provider';\nimport { PromQuery } from '../../../types';\nimport { isValidLegacyName } from '../../../utf8_support';\n\nexport const CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT = 'codeModeSuggestionsIncomplete';\n\nexport type SuggestionsIncompleteEvent = CustomEvent<{\n  limit: number;\n  datasourceUid: string;\n}>;\n\nexport function isSuggestionsIncompleteEvent(e: Event): e is SuggestionsIncompleteEvent {\n  return (\n    e.type === CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT &&\n    'detail' in e &&\n    typeof e.detail === 'object' &&\n    e.detail !== null &&\n    'limit' in e.detail &&\n    'datasourceUid' in e.detail\n  );\n}\n\ninterface Metric {\n  name: string;\n  help: string;\n  type: string;\n  isUtf8?: boolean;\n}\n\nexport interface DataProviderParams {\n  languageProvider: PrometheusLanguageProviderInterface;\n  historyProvider: Array<HistoryItem<PromQuery>>;\n}\n\nexport class DataProvider {\n  readonly languageProvider: PrometheusLanguageProviderInterface;\n  readonly historyProvider: Array<HistoryItem<PromQuery>>;\n  readonly getSeriesLabels: typeof this.languageProvider.queryLabelKeys;\n  readonly getSeriesValues: typeof this.languageProvider.queryLabelValues;\n  readonly getAllLabelNames: typeof this.languageProvider.retrieveLabelKeys;\n  readonly getLabelValues: typeof this.languageProvider.queryLabelValues;\n  readonly metricNamesSuggestionLimit: number;\n  /**\n   * The text that's been typed so far within the current {@link Monaco.Range | Range}.\n   *\n   * @remarks\n   * This is useful with fuzzy searching items to provide as Monaco autocomplete suggestions.\n   */\n  private inputInRange: string;\n  private suggestionsIncomplete: boolean;\n\n  constructor(params: DataProviderParams) {\n    this.languageProvider = params.languageProvider;\n    this.historyProvider = params.historyProvider;\n    this.inputInRange = '';\n    this.metricNamesSuggestionLimit = this.languageProvider.datasource.metricNamesAutocompleteSuggestionLimit;\n    this.suggestionsIncomplete = false;\n    this.getSeriesLabels = this.languageProvider.queryLabelKeys.bind(this.languageProvider);\n    this.getSeriesValues = this.languageProvider.queryLabelValues.bind(this.languageProvider);\n    this.getAllLabelNames = this.languageProvider.retrieveLabelKeys.bind(this.languageProvider);\n    this.getLabelValues = this.languageProvider.queryLabelValues.bind(this.languageProvider);\n  }\n\n  getHistory(): string[] {\n    return this.historyProvider.map((h) => h.query.expr).filter(Boolean);\n  }\n\n  getAllMetricNames(): string[] {\n    return this.languageProvider.retrieveMetrics();\n  }\n\n  metricNamesToMetrics(metricNames: string[]): Metric[] {\n    const metricsMetadata = this.languageProvider.retrieveMetricsMetadata();\n    const result: Metric[] = metricNames.map((m) => {\n      const metaItem = metricsMetadata?.[m];\n      return {\n        name: m,\n        help: metaItem?.help ?? '',\n        type: metaItem?.type ?? '',\n        isUtf8: !isValidLegacyName(m),\n      };\n    });\n\n    return result;\n  }\n\n  private enableAutocompleteSuggestionsUpdate(): void {\n    this.suggestionsIncomplete = true;\n    dispatchEvent(\n      new CustomEvent(CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT, {\n        detail: { limit: this.metricNamesSuggestionLimit, datasourceUid: this.languageProvider.datasource.uid },\n      })\n    );\n  }\n\n  private setInputInRange(textInput: string): void {\n    this.inputInRange = textInput;\n  }\n\n  get monacoSettings() {\n    return {\n      /**\n       * Enable autocomplete suggestions update on every input change.\n       *\n       * @remarks\n       * If fuzzy search is used in `getCompletions` to trim down results to improve performance,\n       * we need to instruct Monaco to update the completions on every input change, so that the\n       * completions reflect the current input.\n       */\n      enableAutocompleteSuggestionsUpdate: this.enableAutocompleteSuggestionsUpdate.bind(this),\n      inputInRange: this.inputInRange,\n      setInputInRange: this.setInputInRange.bind(this),\n      suggestionsIncomplete: this.suggestionsIncomplete,\n    };\n  }\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/monaco-completion-provider/util.ts\n\n// this helper class is used to make typescript warn you when you forget\n// a case-block in a switch statement.\n// example code that triggers the typescript-error:\n//\n// const x:'A'|'B'|'C' = 'A';\n//\n// switch(x) {\n//   case 'A':\n//     // something\n//   case 'B':\n//     // something\n//   default:\n//     throw new NeverCaseError(x);\n// }\n//\n//\n// typescript will show an error in this case,\n// when you add the missing `case 'C'` code,\n// the problem will be fixed.\n\nexport class NeverCaseError extends Error {\n  constructor(value: never) {\n    super('should never happen');\n  }\n}\n","// Core grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/monaco-completion-provider/completions.ts\nimport UFuzzy from '@leeoniya/ufuzzy';\nimport { languages } from 'monaco-editor';\n\nimport { TimeRange } from '@grafana/data';\nimport { config } from '@grafana/runtime';\n\nimport { escapeLabelValueInExactSelector, prometheusRegularEscape } from '../../../escaping';\nimport { FUNCTIONS } from '../../../promql';\nimport { isValidLegacyName } from '../../../utf8_support';\n\nimport { DataProvider } from './data_provider';\nimport type { Label, Situation } from './situation';\nimport { NeverCaseError } from './util';\n// FIXME: we should not load this from the \"outside\", but we cannot do that while we have the \"old\" query-field too\n\nexport type CompletionType = 'HISTORY' | 'FUNCTION' | 'METRIC_NAME' | 'DURATION' | 'LABEL_NAME' | 'LABEL_VALUE';\n\n// We cannot use languages.CompletionItemInsertTextRule.InsertAsSnippet because grafana-prometheus package isn't compatible\n// It should first change the moduleResolution to bundler for TS to correctly resolve the types\n// https://github.com/grafana/grafana/pull/96450\nconst InsertAsSnippet = 4;\n\ntype Completion = {\n  type: CompletionType;\n  label: string;\n  insertText: string;\n  insertTextRules?: languages.CompletionItemInsertTextRule;\n  detail?: string;\n  documentation?: string;\n  triggerOnInsert?: boolean;\n};\n\nconst metricNamesSearch = {\n  // see https://github.com/leeoniya/uFuzzy?tab=readme-ov-file#how-it-works for details\n  multiInsert: new UFuzzy({ intraMode: 0 }),\n  singleError: new UFuzzy({ intraMode: 1 }),\n};\n\n// Snippet Marker is  telling monaco where to show the cursor and maybe a help text\n// With help text example: ${1:labelName}\n// labelName will be shown as selected. So user would know what to type next\nconst snippetMarker = '${1:}';\n\ninterface MetricFilterOptions {\n  metricNames: string[];\n  inputText: string;\n  limit: number;\n}\n\nexport function filterMetricNames({ metricNames, inputText, limit }: MetricFilterOptions): string[] {\n  if (!inputText?.trim()) {\n    return metricNames.slice(0, limit);\n  }\n\n  const terms = metricNamesSearch.multiInsert.split(inputText); // e.g. 'some_metric_name or-another' -> ['some', 'metric', 'name', 'or', 'another']\n  const isComplexSearch = terms.length > 4;\n  const fuzzyResults = isComplexSearch\n    ? metricNamesSearch.multiInsert.filter(metricNames, inputText) // for complex searches, prioritize performance by using MultiInsert fuzzy search\n    : metricNamesSearch.singleError.filter(metricNames, inputText); // for simple searches, prioritize flexibility by using SingleError fuzzy search\n\n  return fuzzyResults ? fuzzyResults.slice(0, limit).map((idx) => metricNames[idx]) : [];\n}\n\n// we order items like: history, functions, metrics\nfunction getAllMetricNamesCompletions(dataProvider: DataProvider): Completion[] {\n  let metricNames = dataProvider.getAllMetricNames();\n\n  if (\n    config.featureToggles.prometheusCodeModeMetricNamesSearch &&\n    metricNames.length > dataProvider.metricNamesSuggestionLimit\n  ) {\n    const { monacoSettings } = dataProvider;\n    monacoSettings.enableAutocompleteSuggestionsUpdate();\n\n    if (monacoSettings.inputInRange) {\n      metricNames = filterMetricNames({\n        metricNames,\n        inputText: monacoSettings.inputInRange,\n        limit: dataProvider.metricNamesSuggestionLimit,\n      });\n    } else {\n      metricNames = metricNames.slice(0, dataProvider.metricNamesSuggestionLimit);\n    }\n  }\n\n  return dataProvider.metricNamesToMetrics(metricNames).map((metric) => ({\n    type: 'METRIC_NAME',\n    label: metric.name,\n    detail: `${metric.name} : ${metric.type}`,\n    documentation: metric.help,\n    ...(metric.isUtf8\n      ? {\n          insertText: `{\"${metric.name}\"${snippetMarker}}`,\n          insertTextRules: InsertAsSnippet,\n        }\n      : {\n          insertText: metric.name,\n        }),\n  }));\n}\n\nconst FUNCTION_COMPLETIONS: Completion[] = FUNCTIONS.map((f) => ({\n  type: 'FUNCTION',\n  label: f.label,\n  insertText: f.insertText ?? '', // i don't know what to do when this is nullish. it should not be.\n  detail: f.detail,\n  documentation: f.documentation,\n}));\n\nasync function getAllFunctionsAndMetricNamesCompletions(dataProvider: DataProvider): Promise<Completion[]> {\n  const metricNames = getAllMetricNamesCompletions(dataProvider);\n\n  return [...FUNCTION_COMPLETIONS, ...metricNames];\n}\n\nconst DURATION_COMPLETIONS: Completion[] = [\n  '$__interval',\n  '$__range',\n  '$__rate_interval',\n  '1m',\n  '5m',\n  '10m',\n  '30m',\n  '1h',\n  '1d',\n].map((text) => ({\n  type: 'DURATION',\n  label: text,\n  insertText: text,\n}));\n\nfunction getAllHistoryCompletions(dataProvider: DataProvider): Completion[] {\n  // function getAllHistoryCompletions(queryHistory: PromHistoryItem[]): Completion[] {\n  // NOTE: the typescript types are wrong. historyItem.query.expr can be undefined\n  const allHistory = dataProvider.getHistory();\n  // FIXME: find a better history-limit\n  return allHistory.slice(0, 10).map((expr) => ({\n    type: 'HISTORY',\n    label: expr,\n    insertText: expr,\n  }));\n}\n\nfunction makeSelector(metricName: string | undefined, labels: Label[]): string {\n  const allLabels = [...labels];\n\n  // we transform the metricName to a label, if it exists\n  if (metricName !== undefined) {\n    allLabels.push({ name: '__name__', value: metricName, op: '=' });\n  }\n\n  const allLabelTexts = allLabels.map(\n    (label) => `${label.name}${label.op}\"${escapeLabelValueInExactSelector(label.value)}\"`\n  );\n\n  return `{${allLabelTexts.join(',')}}`;\n}\n\nasync function getLabelNames(\n  metric: string | undefined,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<string[]> {\n  if (metric === undefined && otherLabels.length === 0) {\n    // if there is no filtering, we have to use a special endpoint\n    return Promise.resolve(dataProvider.getAllLabelNames());\n  } else {\n    const selector = makeSelector(metric, otherLabels);\n    const labelNames = await dataProvider.getSeriesLabels(timeRange, selector);\n\n    // Exclude __name__ from output\n    otherLabels.push({ name: '__name__', value: '', op: '!=' });\n    const usedLabelNames = new Set(otherLabels.map((l) => l.name));\n    // names used in the query\n    return labelNames.filter((l) => !usedLabelNames.has(l));\n  }\n}\n\nasync function getLabelNamesForCompletions(\n  metric: string | undefined,\n  suffix: string,\n  triggerOnInsert: boolean,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<Completion[]> {\n  const labelNames = await getLabelNames(metric, otherLabels, dataProvider, timeRange);\n  return labelNames.map((text) => {\n    const isUtf8 = !isValidLegacyName(text);\n    return {\n      type: 'LABEL_NAME',\n      label: text,\n      ...(isUtf8\n        ? {\n            insertText: `\"${text}\"${suffix}`,\n            insertTextRules: InsertAsSnippet,\n          }\n        : {\n            insertText: `${text}${suffix}`,\n          }),\n      triggerOnInsert,\n    };\n  });\n}\n\nasync function getLabelNamesForSelectorCompletions(\n  metric: string | undefined,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<Completion[]> {\n  return getLabelNamesForCompletions(metric, '=', true, otherLabels, dataProvider, timeRange);\n}\n\nasync function getLabelNamesForByCompletions(\n  metric: string | undefined,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<Completion[]> {\n  return getLabelNamesForCompletions(metric, '', false, otherLabels, dataProvider, timeRange);\n}\n\nasync function getLabelValues(\n  metric: string | undefined,\n  labelName: string,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<string[]> {\n  if (metric === undefined && otherLabels.length === 0) {\n    // if there is no filtering, we have to use a special endpoint\n    return dataProvider.getLabelValues(timeRange, labelName);\n  } else {\n    const selector = makeSelector(metric, otherLabels);\n    return await dataProvider.getSeriesValues(timeRange, labelName, selector);\n  }\n}\n\nasync function getLabelValuesForMetricCompletions(\n  metric: string | undefined,\n  labelName: string,\n  betweenQuotes: boolean,\n  otherLabels: Label[],\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<Completion[]> {\n  const values = await getLabelValues(metric, labelName, otherLabels, dataProvider, timeRange);\n  return values.map((text) => ({\n    type: 'LABEL_VALUE',\n    label: text,\n    insertText: formatLabelValueForCompletion(text, betweenQuotes),\n  }));\n}\n\nfunction formatLabelValueForCompletion(value: string, betweenQuotes: boolean): string {\n  const text = config.featureToggles.prometheusSpecialCharsInLabelValues ? prometheusRegularEscape(value) : value;\n  return betweenQuotes ? text : `\"${text}\"`;\n}\n\nexport function getCompletions(\n  situation: Situation,\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): Promise<Completion[]> {\n  switch (situation.type) {\n    case 'IN_DURATION':\n      return Promise.resolve(DURATION_COMPLETIONS);\n    case 'IN_FUNCTION':\n      return getAllFunctionsAndMetricNamesCompletions(dataProvider);\n    case 'AT_ROOT': {\n      return getAllFunctionsAndMetricNamesCompletions(dataProvider);\n    }\n    case 'EMPTY': {\n      const metricNames = getAllMetricNamesCompletions(dataProvider);\n      const historyCompletions = getAllHistoryCompletions(dataProvider);\n      return Promise.resolve([...historyCompletions, ...FUNCTION_COMPLETIONS, ...metricNames]);\n    }\n    case 'IN_LABEL_SELECTOR_NO_LABEL_NAME':\n      return getLabelNamesForSelectorCompletions(situation.metricName, situation.otherLabels, dataProvider, timeRange);\n    case 'IN_GROUPING':\n      return getLabelNamesForByCompletions(situation.metricName, situation.otherLabels, dataProvider, timeRange);\n    case 'IN_LABEL_SELECTOR_WITH_LABEL_NAME':\n      return getLabelValuesForMetricCompletions(\n        situation.metricName,\n        situation.labelName,\n        situation.betweenQuotes,\n        situation.otherLabels,\n        dataProvider,\n        timeRange\n      );\n    default:\n      throw new NeverCaseError(situation);\n  }\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/monaco-completion-provider/situation.ts\nimport type { SyntaxNode, Tree } from '@lezer/common';\nimport {\n  AggregateExpr,\n  AggregateModifier,\n  BinaryExpr,\n  EqlRegex,\n  EqlSingle,\n  FunctionCallBody,\n  GroupingLabels,\n  Identifier,\n  LabelMatchers,\n  LabelName,\n  MatchOp,\n  MatrixSelector,\n  Neq,\n  NeqRegex,\n  NumberDurationLiteralInDurationContext,\n  parser,\n  PromQL,\n  QuotedLabelMatcher,\n  QuotedLabelName,\n  StringLiteral,\n  UnquotedLabelMatcher,\n  VectorSelector,\n} from '@prometheus-io/lezer-promql';\n\nimport { NeverCaseError } from './util';\n\ntype Direction = 'parent' | 'firstChild' | 'lastChild' | 'nextSibling';\n\ntype NodeTypeId =\n  | 0 // this is used as error-id\n  | typeof AggregateExpr\n  | typeof AggregateModifier\n  | typeof FunctionCallBody\n  | typeof GroupingLabels\n  | typeof Identifier\n  | typeof UnquotedLabelMatcher\n  | typeof QuotedLabelMatcher\n  | typeof LabelMatchers\n  | typeof LabelName\n  | typeof QuotedLabelName\n  | typeof PromQL\n  | typeof StringLiteral\n  | typeof VectorSelector\n  | typeof MatrixSelector\n  | typeof MatchOp\n  | typeof EqlSingle\n  | typeof Neq\n  | typeof EqlRegex\n  | typeof NeqRegex;\n\ntype Path = Array<[Direction, NodeTypeId]>;\n\nfunction move(node: SyntaxNode, direction: Direction): SyntaxNode | null {\n  switch (direction) {\n    case 'parent':\n      return node.parent;\n    case 'firstChild':\n      return node.firstChild;\n    case 'lastChild':\n      return node.lastChild;\n    case 'nextSibling':\n      return node.nextSibling;\n    default:\n      throw new NeverCaseError(direction);\n  }\n}\n\nfunction walk(node: SyntaxNode, path: Path): SyntaxNode | null {\n  let current: SyntaxNode | null = node;\n  for (const [direction, expectedType] of path) {\n    current = move(current, direction);\n    if (current === null) {\n      // we could not move in the direction, we stop\n      return null;\n    }\n    if (current.type.id !== expectedType) {\n      // the reached node has wrong type, we stop\n      return null;\n    }\n  }\n  return current;\n}\n\nfunction getNodeText(node: SyntaxNode, text: string, utf8?: boolean): string {\n  const nodeFrom = utf8 ? node.from + 1 : node.from;\n  const nodeTo = utf8 ? node.to - 1 : node.to;\n  return text.slice(nodeFrom, nodeTo);\n}\n\nfunction parsePromQLStringLiteral(text: string): string {\n  // if it is a string-literal, it is inside quotes of some kind\n  const inside = text.slice(1, text.length - 1);\n\n  // FIXME: support https://prometheus.io/docs/prometheus/latest/querying/basics/#string-literals\n  // FIXME: maybe check other promql code, if all is supported or not\n\n  // for now we do only some very simple un-escaping\n\n  // we start with double-quotes\n  if (text.startsWith('\"') && text.endsWith('\"')) {\n    // NOTE: this is not 100% perfect, we only unescape the double-quote,\n    // there might be other characters too\n    return inside.replace(/\\\\\"/, '\"');\n  }\n\n  // then single-quote\n  if (text.startsWith(\"'\") && text.endsWith(\"'\")) {\n    // NOTE: this is not 100% perfect, we only unescape the single-quote,\n    // there might be other characters too\n    return inside.replace(/\\\\'/, \"'\");\n  }\n\n  // then backticks\n  if (text.startsWith('`') && text.endsWith('`')) {\n    return inside;\n  }\n\n  throw new Error('FIXME: invalid string literal');\n}\n\ntype LabelOperator = '=' | '!=' | '=~' | '!~';\n\nexport type Label = {\n  name: string;\n  value: string;\n  op: LabelOperator;\n};\n\nexport type Situation =\n  | {\n      type: 'IN_FUNCTION';\n    }\n  | {\n      type: 'AT_ROOT';\n    }\n  | {\n      type: 'EMPTY';\n    }\n  | {\n      type: 'IN_DURATION';\n    }\n  | {\n      type: 'IN_LABEL_SELECTOR_NO_LABEL_NAME';\n      metricName?: string;\n      otherLabels: Label[];\n      // utf8 labels must be in quotes\n      betweenQuotes: boolean;\n    }\n  | {\n      type: 'IN_GROUPING';\n      metricName: string;\n      otherLabels: Label[];\n    }\n  | {\n      type: 'IN_LABEL_SELECTOR_WITH_LABEL_NAME';\n      metricName?: string;\n      labelName: string;\n      betweenQuotes: boolean;\n      otherLabels: Label[];\n    };\n\ntype Resolver = {\n  path: NodeTypeId[];\n  fun: (node: SyntaxNode, text: string, pos: number) => Situation | null;\n};\n\nfunction isPathMatch(resolverPath: NodeTypeId[], cursorPath: number[]): boolean {\n  return resolverPath.every((item, index) => item === cursorPath[index]);\n}\n\nconst ERROR_NODE_NAME: NodeTypeId = 0; // this is used as error-id\n\nconst RESOLVERS: Resolver[] = [\n  {\n    path: [LabelMatchers, VectorSelector],\n    fun: resolveLabelKeysWithEquals,\n  },\n  {\n    path: [StringLiteral, QuotedLabelName, LabelMatchers, VectorSelector],\n    fun: resolveUtf8LabelKeysWithEquals,\n  },\n  {\n    path: [PromQL],\n    fun: resolveTopLevel,\n  },\n  {\n    path: [FunctionCallBody],\n    fun: resolveInFunction,\n  },\n  {\n    path: [StringLiteral, UnquotedLabelMatcher],\n    fun: resolveLabelMatcher,\n  },\n  {\n    path: [StringLiteral, QuotedLabelMatcher],\n    fun: resolveQuotedLabelMatcher,\n  },\n  {\n    path: [ERROR_NODE_NAME, BinaryExpr, PromQL],\n    fun: resolveTopLevel,\n  },\n  {\n    path: [ERROR_NODE_NAME, UnquotedLabelMatcher],\n    fun: resolveLabelMatcher,\n  },\n  {\n    path: [ERROR_NODE_NAME, QuotedLabelMatcher],\n    fun: resolveQuotedLabelMatcher,\n  },\n  {\n    path: [ERROR_NODE_NAME, NumberDurationLiteralInDurationContext, MatrixSelector],\n    fun: resolveDurations,\n  },\n  {\n    path: [GroupingLabels],\n    fun: resolveLabelsForGrouping,\n  },\n];\n\nconst LABEL_OP_MAP = new Map<number, LabelOperator>([\n  [EqlSingle, '='],\n  [EqlRegex, '=~'],\n  [Neq, '!='],\n  [NeqRegex, '!~'],\n]);\n\nfunction getLabelOp(opNode: SyntaxNode): LabelOperator | null {\n  const opChild = opNode.firstChild;\n  if (opChild === null) {\n    return null;\n  }\n\n  return LABEL_OP_MAP.get(opChild.type.id) ?? null;\n}\n\nfunction getLabel(labelMatcherNode: SyntaxNode, text: string): Label | null {\n  const allowedMatchers = new Set([UnquotedLabelMatcher, QuotedLabelMatcher]);\n  if (!allowedMatchers.has(labelMatcherNode.type.id)) {\n    return null;\n  }\n\n  const nameNode =\n    walk(labelMatcherNode, [['firstChild', LabelName]]) ?? walk(labelMatcherNode, [['firstChild', QuotedLabelName]]);\n\n  if (nameNode === null) {\n    return null;\n  }\n\n  const opNode = walk(nameNode, [['nextSibling', MatchOp]]);\n  if (opNode === null) {\n    return null;\n  }\n\n  const op = getLabelOp(opNode);\n  if (op === null) {\n    return null;\n  }\n\n  const valueNode = walk(labelMatcherNode, [['lastChild', StringLiteral]]);\n\n  if (valueNode === null) {\n    return null;\n  }\n\n  const name = getNodeText(nameNode, text);\n  const value = parsePromQLStringLiteral(getNodeText(valueNode, text));\n\n  return { name, value, op };\n}\n\nfunction getLabels(labelMatchersNode: SyntaxNode, text: string): Label[] {\n  if (labelMatchersNode.type.id !== LabelMatchers) {\n    return [];\n  }\n\n  const matchers = [UnquotedLabelMatcher, QuotedLabelMatcher];\n\n  return matchers.reduce<Label[]>((acc, matcher) => {\n    labelMatchersNode.getChildren(matcher).forEach((ln) => {\n      const label = getLabel(ln, text);\n      if (notEmpty(label)) {\n        acc.push(label);\n      }\n    });\n    return acc;\n  }, []);\n}\n\nfunction getNodeChildren(node: SyntaxNode): SyntaxNode[] {\n  let child: SyntaxNode | null = node.firstChild;\n  const children: SyntaxNode[] = [];\n  while (child !== null) {\n    children.push(child);\n    child = child.nextSibling;\n  }\n  return children;\n}\n\nfunction getNodeInSubtree(node: SyntaxNode, typeId: NodeTypeId): SyntaxNode | null {\n  // first we try the current node\n  if (node.type.id === typeId) {\n    return node;\n  }\n\n  // then we try the children\n  const children = getNodeChildren(node);\n  for (const child of children) {\n    const n = getNodeInSubtree(child, typeId);\n    if (n !== null) {\n      return n;\n    }\n  }\n\n  return null;\n}\n\nfunction resolveLabelsForGrouping(node: SyntaxNode, text: string, pos: number): Situation | null {\n  const aggrExpNode = walk(node, [\n    ['parent', AggregateModifier],\n    ['parent', AggregateExpr],\n  ]);\n  if (aggrExpNode === null) {\n    return null;\n  }\n  const bodyNode = aggrExpNode.getChild(FunctionCallBody);\n  if (bodyNode === null) {\n    return null;\n  }\n\n  const metricIdNode = getNodeInSubtree(bodyNode, Identifier) ?? getNodeInSubtree(bodyNode, StringLiteral);\n\n  if (!metricIdNode) {\n    return null;\n  }\n\n  // Let's check whether it's a utf8 metric.\n  // A utf8 metric must be a StringLiteral and its parent must be a QuotedLabelName\n  if (metricIdNode.type.id === StringLiteral && metricIdNode.parent?.type.id !== QuotedLabelName) {\n    return null;\n  }\n\n  const metricName = getNodeText(metricIdNode, text, metricIdNode.type.id === StringLiteral);\n\n  return {\n    type: 'IN_GROUPING',\n    metricName,\n    otherLabels: [],\n  };\n}\n\nfunction resolveLabelMatcher(node: SyntaxNode, text: string, pos: number): Situation | null {\n  // we can arrive here in two situation. `node` is either:\n  // - a StringNode (like in `{job=\"^\"}`)\n  // - or an error node (like in `{job=^}`)\n  const inStringNode = !node.type.isError;\n\n  const parent = walk(node, [['parent', UnquotedLabelMatcher]]);\n  if (parent === null) {\n    return null;\n  }\n\n  const labelNameNode = walk(parent, [['firstChild', LabelName]]);\n  if (labelNameNode === null) {\n    return null;\n  }\n\n  const labelName = getNodeText(labelNameNode, text);\n\n  const labelMatchersNode = walk(parent, [['parent', LabelMatchers]]);\n  if (labelMatchersNode === null) {\n    return null;\n  }\n\n  // now we need to find the other names\n  const allLabels = getLabels(labelMatchersNode, text);\n\n  // we need to remove \"our\" label from all-labels, if it is in there\n  const otherLabels = allLabels.filter((label) => label.name !== labelName);\n\n  const metricName = getMetricName(labelMatchersNode, text);\n\n  // we are probably in a situation without a metric name\n  return {\n    type: 'IN_LABEL_SELECTOR_WITH_LABEL_NAME',\n    labelName,\n    betweenQuotes: inStringNode,\n    otherLabels,\n    ...(metricName ? { metricName } : {}),\n  };\n}\n\nfunction resolveQuotedLabelMatcher(node: SyntaxNode, text: string, pos: number): Situation | null {\n  // we can arrive here in two situation. `node` is either:\n  // - a StringNode (like in `{\"job\"=\"^\"}`)\n  // - or an error node (like in `{\"job\"=^}`)\n  const inStringNode = !node.type.isError;\n\n  const parent = walk(node, [['parent', QuotedLabelMatcher]]);\n  if (parent === null) {\n    return null;\n  }\n\n  const labelNameNode = walk(parent, [['firstChild', QuotedLabelName]]);\n  if (labelNameNode === null) {\n    return null;\n  }\n\n  const labelName = getNodeText(labelNameNode, text);\n\n  const labelMatchersNode = walk(parent, [['parent', LabelMatchers]]);\n  if (labelMatchersNode === null) {\n    return null;\n  }\n\n  // now we need to find the other names\n  const allLabels = getLabels(labelMatchersNode, text);\n\n  // we need to remove \"our\" label from all-labels, if it is in there\n  const otherLabels = allLabels.filter((label) => label.name !== labelName);\n  const metricName = getMetricName(parent.parent!, text);\n\n  return {\n    type: 'IN_LABEL_SELECTOR_WITH_LABEL_NAME',\n    labelName,\n    betweenQuotes: inStringNode,\n    otherLabels,\n    ...(metricName ? { metricName } : {}),\n  };\n}\n\nfunction resolveTopLevel(node: SyntaxNode, text: string, pos: number): Situation {\n  return {\n    type: 'AT_ROOT',\n  };\n}\n\nfunction resolveInFunction(node: SyntaxNode, text: string, pos: number): Situation {\n  return {\n    type: 'IN_FUNCTION',\n  };\n}\n\nfunction resolveDurations(node: SyntaxNode, text: string, pos: number): Situation {\n  return {\n    type: 'IN_DURATION',\n  };\n}\n\nfunction resolveLabelKeysWithEquals(node: SyntaxNode, text: string, pos: number): Situation | null {\n  // next false positive:\n  // `something{a=\"1\"^}`\n  let child = walk(node, [['firstChild', UnquotedLabelMatcher]]);\n  if (child !== null) {\n    // means the label-matching part contains at least one label already.\n    //\n    // in this case, we will need to have a `,` character at the end,\n    // to be able to suggest adding the next label.\n    // the area between the end-of-the-child-node and the cursor-pos\n    // must contain a `,` in this case.\n    const textToCheck = text.slice(child.to, pos);\n\n    if (!textToCheck.includes(',')) {\n      return null;\n    }\n  }\n\n  // next false positive:\n  // `{\"utf8.metric\"^}`\n  child = walk(node, [['firstChild', QuotedLabelName]]);\n  if (child !== null) {\n    // means the label-matching part contains a utf8 metric.\n    //\n    // in this case, we will need to have a `,` character at the end,\n    // to be able to suggest adding the next label.\n    // the area between the end-of-the-child-node and the cursor-pos\n    // must contain a `,` in this case.\n    const textToCheck = text.slice(child.to, pos);\n\n    if (!textToCheck.includes(',')) {\n      return null;\n    }\n  }\n\n  const otherLabels = getLabels(node, text);\n  const metricName = getMetricName(node, text);\n\n  return {\n    type: 'IN_LABEL_SELECTOR_NO_LABEL_NAME',\n    otherLabels,\n    betweenQuotes: false,\n    ...(metricName ? { metricName } : {}),\n  };\n}\n\nfunction resolveUtf8LabelKeysWithEquals(node: SyntaxNode, text: string, pos: number): Situation | null {\n  const otherLabels = getLabels(node, text);\n  const metricName = node.parent?.parent ? getMetricName(node.parent.parent, text) : null;\n\n  return {\n    type: 'IN_LABEL_SELECTOR_NO_LABEL_NAME',\n    otherLabels,\n    betweenQuotes: true,\n    ...(metricName ? { metricName } : {}),\n  };\n}\n\nfunction getMetricName(node: SyntaxNode, text: string): string | null {\n  // Legacy Metric metric_name{label=\"value\"}\n  const legacyMetricNameNode = walk(node, [\n    ['parent', VectorSelector],\n    ['firstChild', Identifier],\n  ]);\n\n  if (legacyMetricNameNode) {\n    return getNodeText(legacyMetricNameNode, text);\n  }\n\n  // check for a utf-8 metric\n  // utf-8 metric {\"metric.name\", label=\"value\"}\n  const utf8MetricNameNode = walk(node, [\n    ['parent', VectorSelector],\n    ['firstChild', LabelMatchers],\n    ['firstChild', QuotedLabelName],\n    ['firstChild', StringLiteral],\n  ]);\n\n  if (utf8MetricNameNode) {\n    return getNodeText(utf8MetricNameNode, text, true);\n  }\n\n  // no metric name\n  return null;\n}\n\n// we find the first error-node in the tree that is at the cursor-position.\n// NOTE: this might be too slow, might need to optimize it\n// (ideas: we do not need to go into every subtree, based on from/to)\n// also, only go to places that are in the sub-tree of the node found\n// by default by lezer. problem is, `next()` will go upward too,\n// and we do not want to go higher than our node\nfunction getErrorNode(tree: Tree, pos: number): SyntaxNode | null {\n  const cur = tree.cursorAt(pos);\n  while (true) {\n    if (cur.from === pos && cur.to === pos) {\n      const { node } = cur;\n      if (node.type.isError) {\n        return node;\n      }\n    }\n\n    if (!cur.next()) {\n      break;\n    }\n  }\n  return null;\n}\n\nexport function getSituation(text: string, pos: number): Situation | null {\n  // there is a special-case when we are at the start of writing text,\n  // so we handle that case first\n\n  if (text === '') {\n    return {\n      type: 'EMPTY',\n    };\n  }\n\n  /**\n   PromQL\n   Expr\n   VectorSelector\n   LabelMatchers\n   */\n  const tree = parser.parse(text);\n\n  // if the tree contains error, it is very probable that\n  // our node is one of those error-nodes.\n  // also, if there are errors, the node lezer finds us,\n  // might not be the best node.\n  // so first we check if there is an error-node at the cursor-position\n  const maybeErrorNode = getErrorNode(tree, pos);\n\n  const cur = maybeErrorNode != null ? maybeErrorNode.cursor() : tree.cursorAt(pos);\n  const currentNode = cur.node;\n\n  const ids = [cur.type.id];\n  while (cur.parent()) {\n    ids.push(cur.type.id);\n  }\n\n  for (let resolver of RESOLVERS) {\n    // i do not use a foreach because i want to stop as soon\n    // as i find something\n    if (isPathMatch(resolver.path, ids)) {\n      return resolver.fun(currentNode, text, pos);\n    }\n  }\n\n  return null;\n}\n\nfunction notEmpty<TValue>(value: TValue | null | undefined): value is TValue {\n  return value !== null && value !== undefined;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/monaco-completion-provider/index.ts\nimport { TimeRange } from '@grafana/data';\nimport type { Monaco, monacoTypes } from '@grafana/ui';\n\nimport { CompletionType, getCompletions } from './completions';\nimport { DataProvider } from './data_provider';\nimport { getSituation } from './situation';\nimport { NeverCaseError } from './util';\n\nexport function getSuggestOptions(): monacoTypes.editor.ISuggestOptions {\n  return {\n    // monaco-editor sometimes provides suggestions automatically, i am not\n    // sure based on what, seems to be by analyzing the words already\n    // written.\n    // to try it out:\n    // - enter `go_goroutines{job~`\n    // - have the cursor at the end of the string\n    // - press ctrl-enter\n    // - you will get two suggestions\n    // those were not provided by grafana, they are offered automatically.\n    // i want to remove those. the only way i found is:\n    // - every suggestion-item has a `kind` attribute,\n    //   that controls the icon to the left of the suggestion.\n    // - items auto-generated by monaco have `kind` set to `text`.\n    // - we make sure grafana-provided suggestions do not have `kind` set to `text`.\n    // - and then we tell monaco not to show suggestions of kind `text`\n    showWords: false,\n  };\n}\n\nfunction getMonacoCompletionItemKind(type: CompletionType, monaco: Monaco): monacoTypes.languages.CompletionItemKind {\n  switch (type) {\n    case 'DURATION':\n      return monaco.languages.CompletionItemKind.Unit;\n    case 'FUNCTION':\n      return monaco.languages.CompletionItemKind.Variable;\n    case 'HISTORY':\n      return monaco.languages.CompletionItemKind.Snippet;\n    case 'LABEL_NAME':\n      return monaco.languages.CompletionItemKind.Enum;\n    case 'LABEL_VALUE':\n      return monaco.languages.CompletionItemKind.EnumMember;\n    case 'METRIC_NAME':\n      return monaco.languages.CompletionItemKind.Constructor;\n    default:\n      throw new NeverCaseError(type);\n  }\n}\n\nexport function getCompletionProvider(\n  monaco: Monaco,\n  dataProvider: DataProvider,\n  timeRange: TimeRange\n): monacoTypes.languages.CompletionItemProvider {\n  const provideCompletionItems = (\n    model: monacoTypes.editor.ITextModel,\n    position: monacoTypes.Position\n  ): monacoTypes.languages.ProviderResult<monacoTypes.languages.CompletionList> => {\n    const word = model.getWordAtPosition(position);\n    const range =\n      word != null\n        ? monaco.Range.lift({\n            startLineNumber: position.lineNumber,\n            endLineNumber: position.lineNumber,\n            startColumn: word.startColumn,\n            endColumn: word.endColumn,\n          })\n        : monaco.Range.fromPositions(position);\n    // documentation says `position` will be \"adjusted\" in `getOffsetAt`\n    // i don't know what that means, to be sure i clone it\n\n    const positionClone = {\n      column: position.column,\n      lineNumber: position.lineNumber,\n    };\n    dataProvider.monacoSettings.setInputInRange(model.getValueInRange(range));\n\n    // Check to see if the browser supports window.getSelection()\n    if (window.getSelection) {\n      const selectedText = window.getSelection()?.toString();\n      // If the user has selected text, adjust the cursor position to be at the start of the selection, instead of the end\n      if (selectedText && selectedText.length > 0) {\n        positionClone.column = positionClone.column - selectedText.length;\n      }\n    }\n\n    const offset = model.getOffsetAt(positionClone);\n    const situation = getSituation(model.getValue(), offset);\n    const completionsPromise =\n      situation != null ? getCompletions(situation, dataProvider, timeRange) : Promise.resolve([]);\n\n    return completionsPromise.then((items) => {\n      // monaco by-default alphabetically orders the items.\n      // to stop it, we use a number-as-string sortkey,\n      // so that monaco keeps the order we use\n      const maxIndexDigits = items.length.toString().length;\n      const suggestions: monacoTypes.languages.CompletionItem[] = items.map((item, index) => ({\n        kind: getMonacoCompletionItemKind(item.type, monaco),\n        label: item.label,\n        insertText: item.insertText,\n        insertTextRules: item.insertTextRules,\n        detail: item.detail,\n        documentation: item.documentation,\n        sortText: index.toString().padStart(maxIndexDigits, '0'), // to force the order we have\n        range,\n        command: item.triggerOnInsert\n          ? {\n              id: 'editor.action.triggerSuggest',\n              title: '',\n            }\n          : undefined,\n      }));\n      return { suggestions, incomplete: dataProvider.monacoSettings.suggestionsIncomplete };\n    });\n  };\n\n  return {\n    triggerCharacters: ['{', ',', '[', '(', '=', '~', ' ', '\"'],\n    provideCompletionItems,\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/loki/components/monaco-query-field/monaco-completion-provider/validation.ts\nimport { SyntaxNode } from '@lezer/common';\nimport { LRParser } from '@lezer/lr';\n\n// Although 0 isn't explicitly provided in the @grafana/lezer-logql library as the error node ID, it does appear to be the ID of error nodes within lezer.\nexport const ErrorId = 0;\n\nexport const warningTypes: Record<string, string> = {\n  SubqueryExpr:\n    'This subquery may return only one data point, preventing rate/increase/delta calculations. Use a range at least twice the step size (e.g., [2x:x]).',\n};\n\nenum NodeType {\n  SubqueryExpr = 'SubqueryExpr',\n  Duration = 'NumberDurationLiteralInDurationContext',\n}\n\ninterface ParserIssueBoundary {\n  startLineNumber: number;\n  startColumn: number;\n  endLineNumber: number;\n  endColumn: number;\n  issue: string;\n}\n\ninterface ParseIssue {\n  text: string;\n  node: SyntaxNode;\n}\n\n/**\n * Conceived to work in combination with the MonacoQueryField component.\n * Given an original query, and it's interpolated version, it will return an array of ParserErrorBoundary\n * objects containing nodes which are actual errors. The interpolated version (even with placeholder variables)\n * is required because variables look like errors for Lezer.\n * @internal\n */\nexport function validateQuery(\n  query: string,\n  interpolatedQuery: string,\n  queryLines: string[],\n  parser: LRParser\n): { errors: ParserIssueBoundary[]; warnings: ParserIssueBoundary[] } {\n  if (!query) {\n    return { errors: [], warnings: [] };\n  }\n\n  /**\n   * To provide support to variable interpolation in query validation, we run the parser in the interpolated\n   * query. If there are errors there, we trace them back to the original unparsed query, so we can more\n   * accurately highlight the error in the query, since it's likely that the variable name and variable value\n   * have different lengths. With this, we also exclude irrelevant parser errors that are produced by\n   * lezer not understanding $variables and $__variables, which usually generate 2 or 3 error SyntaxNode.\n   */\n  const { errors: interpolatedErrors, warnings: interpolatedWarnings } = parseQuery(interpolatedQuery, parser);\n  if (!interpolatedErrors.length && !interpolatedWarnings.length) {\n    return { errors: [], warnings: [] };\n  }\n\n  let parseErrors: ParseIssue[] = interpolatedErrors;\n  let parseWarnings: ParseIssue[] = interpolatedWarnings;\n  if (query !== interpolatedQuery) {\n    const { errors: queryErrors, warnings: queryWarnings } = parseQuery(query, parser);\n    parseErrors = interpolatedErrors.flatMap(\n      (interpolatedError) =>\n        queryErrors.filter((queryError) => interpolatedError.text === queryError.text) || interpolatedError\n    );\n    parseWarnings = interpolatedWarnings.flatMap(\n      (interpolatedWarning) =>\n        queryWarnings.filter((queryWarning) => interpolatedWarning.node.from === queryWarning.node.from) ||\n        interpolatedWarning\n    );\n  }\n\n  const errorBoundaries = parseErrors\n    .map((parseError) => findIssueBoundary(query, queryLines, parseError, 'error'))\n    .filter(isValidIssueBoundary);\n  const warningBoundaries = parseWarnings\n    .map((parseWarning) => findIssueBoundary(query, queryLines, parseWarning, 'warning'))\n    .filter(isValidIssueBoundary);\n\n  return {\n    errors: errorBoundaries,\n    warnings: warningBoundaries,\n  };\n}\n\nfunction parseQuery(query: string, parser: LRParser) {\n  const parseErrors: ParseIssue[] = [];\n  const parseWarnings: ParseIssue[] = [];\n\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: (nodeRef): false | void => {\n      if (nodeRef.type.id === ErrorId) {\n        const node = nodeRef.node;\n        parseErrors.push({ node: node, text: query.substring(node.from, node.to) });\n      }\n\n      if (nodeRef.type.name === NodeType.SubqueryExpr) {\n        const node = nodeRef.node;\n        const durations: string[] = [];\n\n        const children = node.getChildren(NodeType.Duration);\n        for (const child of children) {\n          durations.push(query.substring(child.from, child.to));\n        }\n\n        if (durations.length === 2 && durations[0] === durations[1]) {\n          parseWarnings.push({ node: node, text: query.substring(node.from, node.to) });\n        }\n      }\n    },\n  });\n\n  return { errors: parseErrors, warnings: parseWarnings };\n}\n\nfunction findIssueBoundary(\n  query: string,\n  queryLines: string[],\n  parseError: ParseIssue,\n  issueType: 'error' | 'warning'\n): ParserIssueBoundary | null {\n  if (queryLines.length === 1) {\n    const isEmptyString = parseError.node.from === parseError.node.to;\n    const errorNode = isEmptyString && parseError.node.parent ? parseError.node.parent : parseError.node;\n    let issue: string;\n\n    if (issueType === 'error') {\n      issue = isEmptyString ? query.substring(errorNode.from, errorNode.to) : parseError.text;\n    } else {\n      issue = warningTypes[parseError.node.type.name];\n    }\n\n    return {\n      startLineNumber: 1,\n      startColumn: errorNode.from + 1,\n      endLineNumber: 1,\n      endColumn: errorNode.to + 1,\n      issue,\n    };\n  }\n\n  let startPos = 0,\n    endPos = 0;\n  for (let line = 0; line < queryLines.length; line++) {\n    endPos = startPos + queryLines[line].length;\n\n    if (parseError.node.from > endPos) {\n      startPos += queryLines[line].length + 1;\n      continue;\n    }\n\n    return {\n      startLineNumber: line + 1,\n      startColumn: parseError.node.from - startPos + 1,\n      endLineNumber: line + 1,\n      endColumn: parseError.node.to - startPos + 1,\n      issue: issueType === 'error' ? parseError.text : warningTypes[parseError.node.type.name],\n    };\n  }\n\n  return null;\n}\n\nfunction isValidIssueBoundary(boundary: ParserIssueBoundary | null): boundary is ParserIssueBoundary {\n  return boundary !== null;\n}\n\nexport const placeHolderScopedVars = {\n  __interval: { text: '1s', value: '1s' },\n  __rate_interval: { text: '1s', value: '1s' },\n  __auto: { text: '1s', value: '1s' },\n  __interval_ms: { text: '1000', value: 1000 },\n  __range_ms: { text: '1000', value: 1000 },\n  __range_s: { text: '1', value: 1 },\n  __range: { text: '1s', value: '1s' },\n};\n","// The MIT License (MIT)\n//\n// Copyright (c) Celian Garcia and Augustin Husson @ Amadeus IT Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n'use strict';\n// import { languages } from \"monaco-editor\";\n// noinspection JSUnusedGlobalSymbols\nexport const languageConfiguration = {\n  // the default separators except `@$`\n  wordPattern: /(-?\\d*\\.\\d\\w*)|([^`~!#%^&*()\\-=+\\[{\\]}\\\\|;:'\",.<>\\/?\\s]+)/g,\n  // Not possible to make comments in PromQL syntax\n  comments: {\n    lineComment: '#',\n  },\n  brackets: [\n    ['{', '}'],\n    ['[', ']'],\n    ['(', ')'],\n  ],\n  autoClosingPairs: [\n    { open: '{', close: '}' },\n    { open: '[', close: ']' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n  ],\n  surroundingPairs: [\n    { open: '{', close: '}' },\n    { open: '[', close: ']' },\n    { open: '(', close: ')' },\n    { open: '\"', close: '\"' },\n    { open: \"'\", close: \"'\" },\n    { open: '<', close: '>' },\n  ],\n  folding: {},\n};\n// PromQL Aggregation Operators\n// (https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators)\nconst aggregations = [\n  'sum',\n  'min',\n  'max',\n  'avg',\n  'group',\n  'stddev',\n  'stdvar',\n  'count',\n  'count_values',\n  'bottomk',\n  'topk',\n  'quantile',\n];\n// PromQL functions\n// (https://prometheus.io/docs/prometheus/latest/querying/functions/)\nconst functions = [\n  'abs',\n  'absent',\n  'ceil',\n  'changes',\n  'clamp_max',\n  'clamp_min',\n  'day_of_month',\n  'day_of_week',\n  'days_in_month',\n  'delta',\n  'deriv',\n  'double_exponential_smoothing',\n  'exp',\n  'floor',\n  'histogram_quantile',\n  'histogram_avg',\n  'histogram_count',\n  'histogram_sum',\n  'histogram_fraction',\n  'histogram_stddev',\n  'histogram_stdvar',\n  // Renamed as DoubleExponentialSmoothing with Prometheus v3.x\n  // https://github.com/prometheus/prometheus/pull/14930\n  'holt_winters',\n  'hour',\n  'idelta',\n  'increase',\n  'info',\n  'irate',\n  'label_join',\n  'label_replace',\n  'ln',\n  'log2',\n  'log10',\n  'minute',\n  'month',\n  'predict_linear',\n  'rate',\n  'resets',\n  'round',\n  'scalar',\n  'sort',\n  'sort_desc',\n  'sqrt',\n  'time',\n  'timestamp',\n  'vector',\n  'year',\n];\n// PromQL specific functions: Aggregations over time\n// (https://prometheus.io/docs/prometheus/latest/querying/functions/#aggregation_over_time)\nconst aggregationsOverTime = [];\nfor (let _i = 0, aggregations_1 = aggregations; _i < aggregations_1.length; _i++) {\n  let agg = aggregations_1[_i];\n  aggregationsOverTime.push(agg + '_over_time');\n}\n// PromQL vector matching + the by and without clauses\n// (https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching)\nconst vectorMatching = ['on', 'ignoring', 'group_right', 'group_left', 'by', 'without'];\n// Produce a regex matching elements : (elt1|elt2|...)\nconst vectorMatchingRegex =\n  '(' +\n  vectorMatching.reduce(function (prev, curr) {\n    return prev + '|' + curr;\n  }) +\n  ')';\n// PromQL Operators\n// (https://prometheus.io/docs/prometheus/latest/querying/operators/)\nconst operators = ['+', '-', '*', '/', '%', '^', '==', '!=', '>', '<', '>=', '<=', 'and', 'or', 'unless'];\n// PromQL offset modifier\n// (https://prometheus.io/docs/prometheus/latest/querying/basics/#offset-modifier)\nconst offsetModifier = ['offset'];\n// Merging all the keywords in one list\nconst keywords = aggregations\n  .concat(functions)\n  .concat(aggregationsOverTime)\n  .concat(vectorMatching)\n  .concat(offsetModifier);\n// noinspection JSUnusedGlobalSymbols\nexport const language = {\n  ignoreCase: false,\n  defaultToken: '',\n  tokenPostfix: '.promql',\n  keywords: keywords,\n  operators: operators,\n  vectorMatching: vectorMatchingRegex,\n  // we include these common regular expressions\n  symbols: /[=><!~?:&|+\\-*\\/^%]+/,\n  escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n  digits: /\\d+(_+\\d+)*/,\n  octaldigits: /[0-7]+(_+[0-7]+)*/,\n  binarydigits: /[0-1]+(_+[0-1]+)*/,\n  hexdigits: /[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,\n  integersuffix: /(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,\n  floatsuffix: /[fFlL]?/,\n  // The main tokenizer for our languages\n  tokenizer: {\n    root: [\n      // 'by', 'without' and vector matching\n      [/@vectorMatching\\s*(?=\\()/, 'type', '@clauses'],\n      // labels\n      [/[a-z_]\\w*(?=\\s*(=|!=|=~|!~))/, 'tag'],\n      // comments\n      [/(^#.*$)/, 'comment'],\n      // all keywords have the same color\n      [\n        /[a-zA-Z_]\\w*/,\n        {\n          cases: {\n            '@keywords': 'type',\n            '@default': 'identifier',\n          },\n        },\n      ],\n      // strings\n      [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],\n      [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'],\n      [/\"/, 'string', '@string_double'],\n      [/'/, 'string', '@string_single'],\n      [/`/, 'string', '@string_backtick'],\n      // whitespace\n      { include: '@whitespace' },\n      // delimiters and operators\n      [/[{}()\\[\\]]/, '@brackets'],\n      [/[<>](?!@symbols)/, '@brackets'],\n      [\n        /@symbols/,\n        {\n          cases: {\n            '@operators': 'delimiter',\n            '@default': '',\n          },\n        },\n      ],\n      // numbers\n      [/\\d+[smhdwy]/, 'number'],\n      [/\\d*\\d+[eE]([\\-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/\\d*\\.\\d+([eE][\\-+]?\\d+)?(@floatsuffix)/, 'number.float'],\n      [/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/, 'number.hex'],\n      [/0[0-7']*[0-7](@integersuffix)/, 'number.octal'],\n      [/0[bB][0-1']*[0-1](@integersuffix)/, 'number.binary'],\n      [/\\d[\\d']*\\d(@integersuffix)/, 'number'],\n      [/\\d(@integersuffix)/, 'number'],\n    ],\n    string_double: [\n      [/[^\\\\\"]+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/\"/, 'string', '@pop'],\n    ],\n    string_single: [\n      [/[^\\\\']+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/'/, 'string', '@pop'],\n    ],\n    string_backtick: [\n      [/[^\\\\`$]+/, 'string'],\n      [/@escapes/, 'string.escape'],\n      [/\\\\./, 'string.escape.invalid'],\n      [/`/, 'string', '@pop'],\n    ],\n    clauses: [\n      [/[^(,)]/, 'tag'],\n      [/\\)/, 'identifier', '@pop'],\n    ],\n    whitespace: [[/[ \\t\\r\\n]+/, 'white']],\n  },\n};\n// noinspection JSUnusedGlobalSymbols\n// export const completionItemProvider = {\n//     provideCompletionItems: function () {\n//         // To simplify, we made the choice to never create automatically the parenthesis behind keywords\n//         // It is because in PromQL, some keywords need parenthesis behind, some don't, some can have but it's optional.\n//         const suggestions = keywords.map(function (value) {\n//             return {\n//                 label: value,\n//                 kind: languages.CompletionItemKind.Keyword,\n//                 insertText: value,\n//                 insertTextRules: languages.CompletionItemInsertTextRule.InsertAsSnippet\n//             };\n//         });\n//         return { suggestions: suggestions };\n//     }\n// };\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryField.tsx\nimport { css } from '@emotion/css';\nimport { parser } from '@prometheus-io/lezer-promql';\nimport { promLanguageDefinition } from 'monaco-promql';\nimport { useEffect, useRef } from 'react';\nimport { useLatest } from 'react-use';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Monaco, monacoTypes, ReactMonacoEditor, useTheme2 } from '@grafana/ui';\n\nimport { Props } from './MonacoQueryFieldProps';\nimport { getOverrideServices } from './getOverrideServices';\nimport { DataProvider } from './monaco-completion-provider/data_provider';\nimport { getCompletionProvider, getSuggestOptions } from './monaco-completion-provider/monaco-completion-provider';\nimport { placeHolderScopedVars, validateQuery } from './monaco-completion-provider/validation';\nimport { language, languageConfiguration } from './promql';\n\nconst options: monacoTypes.editor.IStandaloneEditorConstructionOptions = {\n  codeLens: false,\n  contextmenu: false,\n  // we need `fixedOverflowWidgets` because otherwise in grafana-dashboards\n  // the popup is clipped by the panel-visualizations.\n  fixedOverflowWidgets: true,\n  folding: false,\n  fontSize: 14,\n  lineDecorationsWidth: 8, // used as \"padding-left\"\n  lineNumbers: 'off',\n  minimap: { enabled: false },\n  overviewRulerBorder: false,\n  overviewRulerLanes: 0,\n  padding: {\n    // these numbers were picked so that visually this matches the previous version\n    // of the query-editor the best\n    top: 4,\n    bottom: 5,\n  },\n  renderLineHighlight: 'none',\n  scrollbar: {\n    vertical: 'hidden',\n    verticalScrollbarSize: 8, // used as \"padding-right\"\n    horizontal: 'hidden',\n    horizontalScrollbarSize: 0,\n    alwaysConsumeMouseWheel: false,\n  },\n  scrollBeyondLastLine: false,\n  suggest: getSuggestOptions(),\n  suggestFontSize: 12,\n  wordWrap: 'on',\n};\n\n// this number was chosen by testing various values. it might be necessary\n// because of the width of the border, not sure.\n//it needs to do 2 things:\n// 1. when the editor is single-line, it should make the editor height be visually correct\n// 2. when the editor is multi-line, the editor should not be \"scrollable\" (meaning,\n//    you do a scroll-movement in the editor, and it will scroll the content by a couple pixels\n//    up & down. this we want to avoid)\nconst EDITOR_HEIGHT_OFFSET = 2;\n\nconst PROMQL_LANG_ID = promLanguageDefinition.id;\n\n// we must only run the promql-setup code once\nlet PROMQL_SETUP_STARTED = false;\n\nfunction ensurePromQL(monaco: Monaco) {\n  if (PROMQL_SETUP_STARTED === false) {\n    PROMQL_SETUP_STARTED = true;\n    const { aliases, extensions, mimetypes } = promLanguageDefinition;\n    monaco.languages.register({ id: PROMQL_LANG_ID, aliases, extensions, mimetypes });\n\n    // @ts-ignore\n    monaco.languages.setMonarchTokensProvider(PROMQL_LANG_ID, language);\n    // @ts-ignore\n    monaco.languages.setLanguageConfiguration(PROMQL_LANG_ID, languageConfiguration);\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2, placeholder: string) => {\n  return {\n    container: css({\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.components.input.borderColor}`,\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'start',\n      alignItems: 'center',\n      height: '100%',\n      overflow: 'hidden',\n    }),\n    placeholder: css({\n      '::after': {\n        content: `'${placeholder}'`,\n        fontFamily: theme.typography.fontFamilyMonospace,\n        opacity: 0.6,\n      },\n    }),\n  };\n};\n\nconst MonacoQueryField = (props: Props) => {\n  const id = uuidv4();\n\n  // we need only one instance of `overrideServices` during the lifetime of the react component\n  const overrideServicesRef = useRef(getOverrideServices());\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { languageProvider, history, onBlur, onRunQuery, initialValue, placeholder, datasource, timeRange } = props;\n\n  const lpRef = useLatest(languageProvider);\n  const historyRef = useLatest(history);\n  const onRunQueryRef = useLatest(onRunQuery);\n  const onBlurRef = useLatest(onBlur);\n\n  const autocompleteDisposeFun = useRef<(() => void) | null>(null);\n\n  const theme = useTheme2();\n  const styles = getStyles(theme, placeholder);\n\n  useEffect(() => {\n    // when we unmount, we unregister the autocomplete-function, if it was registered\n    return () => {\n      autocompleteDisposeFun.current?.();\n    };\n  }, []);\n\n  return (\n    <div\n      data-testid={selectors.components.QueryField.container}\n      className={styles.container}\n      // NOTE: we will be setting inline-style-width/height on this element\n      ref={containerRef}\n    >\n      <ReactMonacoEditor\n        // see https://github.com/suren-atoyan/monaco-react/issues/365\n        saveViewState\n        overrideServices={overrideServicesRef.current}\n        options={options}\n        language=\"promql\"\n        value={initialValue}\n        beforeMount={(monaco) => {\n          ensurePromQL(monaco);\n        }}\n        onMount={(editor, monaco) => {\n          const isEditorFocused = editor.createContextKey<boolean>('isEditorFocused' + id, false);\n          // we setup on-blur\n          editor.onDidBlurEditorWidget(() => {\n            isEditorFocused.set(false);\n            onBlurRef.current(editor.getValue());\n          });\n          editor.onDidFocusEditorText(() => {\n            isEditorFocused.set(true);\n          });\n          const dataProvider = new DataProvider({\n            historyProvider: historyRef.current,\n            languageProvider: lpRef.current,\n          });\n          const completionProvider = getCompletionProvider(monaco, dataProvider, timeRange);\n\n          // completion-providers in monaco are not registered directly to editor-instances,\n          // they are registered to languages. this makes it hard for us to have\n          // separate completion-providers for every query-field-instance\n          // (but we need that, because they might connect to different datasources).\n          // the trick we do is, we wrap the callback in a \"proxy\",\n          // and in the proxy, the first thing is, we check if we are called from\n          // \"our editor instance\", and if not, we just return nothing. if yes,\n          // we call the completion-provider.\n          const filteringCompletionProvider: monacoTypes.languages.CompletionItemProvider = {\n            ...completionProvider,\n            provideCompletionItems: (model, position, context, token) => {\n              // if the model-id does not match, then this call is from a different editor-instance,\n              // not \"our instance\", so return nothing\n              if (editor.getModel()?.id !== model.id) {\n                return { suggestions: [] };\n              }\n              return completionProvider.provideCompletionItems(model, position, context, token);\n            },\n          };\n\n          const { dispose } = monaco.languages.registerCompletionItemProvider(\n            PROMQL_LANG_ID,\n            filteringCompletionProvider\n          );\n\n          autocompleteDisposeFun.current = dispose;\n          // this code makes the editor resize itself so that the content fits\n          // (it will grow taller when necessary)\n          // FIXME: maybe move this functionality into CodeEditor, like:\n          // <CodeEditor resizingMode=\"single-line\"/>\n          const updateElementHeight = () => {\n            const containerDiv = containerRef.current;\n            if (containerDiv !== null) {\n              const pixelHeight = editor.getContentHeight();\n              containerDiv.style.height = `${pixelHeight + EDITOR_HEIGHT_OFFSET}px`;\n              containerDiv.style.width = '100%';\n              const pixelWidth = containerDiv.clientWidth;\n              editor.layout({ width: pixelWidth, height: pixelHeight });\n            }\n          };\n\n          editor.onDidContentSizeChange(updateElementHeight);\n          updateElementHeight();\n\n          // handle: shift + enter\n          // FIXME: maybe move this functionality into CodeEditor?\n          editor.addCommand(\n            monaco.KeyMod.Shift | monaco.KeyCode.Enter,\n            () => {\n              onRunQueryRef.current(editor.getValue());\n            },\n            'isEditorFocused' + id\n          );\n\n          // Fixes Monaco capturing the search key binding and displaying a useless search box within the Editor.\n          // See https://github.com/grafana/grafana/issues/85850\n          monaco.editor.addKeybindingRule({\n            keybinding: monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyF,\n            command: null,\n          });\n\n          // Something in this configuration of monaco doesn't bubble up [mod]+K,\n          // which the command palette uses. Pass the event out of monaco manually\n          editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyK, function () {\n            global.dispatchEvent(new KeyboardEvent('keydown', { key: 'k', metaKey: true }));\n          });\n\n          if (placeholder) {\n            const placeholderDecorators = [\n              {\n                range: new monaco.Range(1, 1, 1, 1),\n                options: {\n                  className: styles.placeholder,\n                  isWholeLine: true,\n                },\n              },\n            ];\n\n            let decorators: string[] = [];\n\n            const checkDecorators: () => void = () => {\n              const model = editor.getModel();\n\n              if (!model) {\n                return;\n              }\n\n              const newDecorators = model.getValueLength() === 0 ? placeholderDecorators : [];\n              decorators = model.deltaDecorations(decorators, newDecorators);\n            };\n\n            checkDecorators();\n            editor.onDidChangeModelContent(checkDecorators);\n\n            editor.onDidChangeModelContent((e) => {\n              const model = editor.getModel();\n              if (!model) {\n                return;\n              }\n              const query = model.getValue();\n              const { errors, warnings } = validateQuery(\n                query,\n                datasource.interpolateString(query, placeHolderScopedVars),\n                model.getLinesContent(),\n                parser\n              );\n\n              const errorMarkers = errors.map(({ issue, ...boundary }) => {\n                return {\n                  message: `${issue ? `Error parsing \"${issue}\"` : 'Parse error'}. The query appears to be incorrect and could fail to be executed.`,\n                  severity: monaco.MarkerSeverity.Error,\n                  ...boundary,\n                };\n              });\n\n              const warningMarkers = warnings.map(({ issue, ...boundary }) => {\n                return {\n                  message: `Warning: ${issue}`,\n                  severity: monaco.MarkerSeverity.Warning,\n                  ...boundary,\n                };\n              });\n\n              monaco.editor.setModelMarkers(model, 'owner', [...errorMarkers, ...warningMarkers]);\n            });\n          }\n        }}\n      />\n    </div>\n  );\n};\n\n// we will lazy-load this module using React.lazy,\n// and that only supports default-exports,\n// so we have to default-export this, even if\n// it is against the style-guidelines.\n\nexport default MonacoQueryField;\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryFieldLazy.tsx\nimport { Suspense } from 'react';\n\nimport MonacoQueryField from './MonacoQueryField';\nimport { Props } from './MonacoQueryFieldProps';\n\nexport const MonacoQueryFieldLazy = (props: Props) => {\n  return (\n    <Suspense fallback={null}>\n      <MonacoQueryField {...props} />\n    </Suspense>\n  );\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryFieldWrapper.tsx\nimport { useRef } from 'react';\n\nimport { MonacoQueryFieldLazy } from './MonacoQueryFieldLazy';\nimport { Props as MonacoProps } from './MonacoQueryFieldProps';\n\ntype Props = Omit<MonacoProps, 'onRunQuery' | 'onBlur'> & {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n};\n\nexport const MonacoQueryFieldWrapper = (props: Props) => {\n  const lastRunValueRef = useRef<string | null>(null);\n  const { onRunQuery, onChange, ...rest } = props;\n\n  const handleRunQuery = (value: string) => {\n    lastRunValueRef.current = value;\n    onChange(value);\n    onRunQuery();\n  };\n\n  const handleBlur = (value: string) => {\n    onChange(value);\n  };\n\n  return <MonacoQueryFieldLazy onRunQuery={handleRunQuery} onBlur={handleBlur} {...rest} />;\n};\n","import { useMemo } from 'react';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PrometheusLanguageProviderInterface } from '../language_provider';\n\nfunction getChooserText(metricsLookupDisabled: boolean, hasSyntax: boolean, hasMetrics: boolean) {\n  if (metricsLookupDisabled) {\n    return '(Disabled)';\n  }\n\n  if (!hasSyntax) {\n    return 'Loading metrics...';\n  }\n\n  if (!hasMetrics) {\n    return '(No metrics found)';\n  }\n\n  return 'Metrics browser';\n}\n\nexport function useMetricsState(\n  datasource: PrometheusDatasource,\n  languageProvider: PrometheusLanguageProviderInterface,\n  syntaxLoaded: boolean\n) {\n  return useMemo(() => {\n    const hasMetrics = languageProvider.retrieveMetrics().length > 0;\n    const chooserText = getChooserText(datasource.lookupsDisabled, syntaxLoaded, hasMetrics);\n    const buttonDisabled = !(syntaxLoaded && hasMetrics);\n\n    return {\n      hasMetrics,\n      chooserText,\n      buttonDisabled,\n    };\n  }, [languageProvider, datasource.lookupsDisabled, syntaxLoaded]);\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/types.ts\nimport { DataSourceJsonData } from '@grafana/data';\nimport { DataQuery } from '@grafana/schema';\n\nimport { Prometheus as GenPromQuery } from './dataquery';\nimport { QueryBuilderLabelFilter, QueryEditorMode } from './querybuilder/shared/types';\n\nexport interface PromQuery extends GenPromQuery, DataQuery {\n  /**\n   * Timezone offset to align start & end time on backend\n   */\n  utcOffsetSec?: number;\n  valueWithRefId?: boolean;\n  showingGraph?: boolean;\n  showingTable?: boolean;\n  hinting?: boolean;\n  interval?: string;\n  // store the metrics explorer additional settings\n  useBackend?: boolean;\n  disableTextWrap?: boolean;\n  fullMetaSearch?: boolean;\n  includeNullMetadata?: boolean;\n  fromExploreMetrics?: boolean;\n}\n\nexport enum PrometheusCacheLevel {\n  Low = 'Low',\n  Medium = 'Medium',\n  High = 'High',\n  None = 'None',\n}\n\nexport enum PromApplication {\n  Cortex = 'Cortex',\n  Mimir = 'Mimir',\n  Prometheus = 'Prometheus',\n  Thanos = 'Thanos',\n}\n\nexport interface PromOptions extends DataSourceJsonData {\n  timeInterval?: string;\n  queryTimeout?: string;\n  httpMethod?: string;\n  customQueryParameters?: string;\n  disableMetricsLookup?: boolean;\n  exemplarTraceIdDestinations?: ExemplarTraceIdDestination[];\n  prometheusType?: PromApplication;\n  prometheusVersion?: string;\n  cacheLevel?: PrometheusCacheLevel;\n  defaultEditor?: QueryEditorMode;\n  incrementalQuerying?: boolean;\n  incrementalQueryOverlapWindow?: string;\n  disableRecordingRules?: boolean;\n  allowAsRecordingRulesTarget?: boolean;\n  sigV4Auth?: boolean;\n  oauthPassThru?: boolean;\n  codeModeMetricNamesSuggestionLimit?: number;\n  seriesEndpoint?: boolean;\n  seriesLimit?: number;\n}\n\nexport type ExemplarTraceIdDestination = {\n  name: string;\n  url?: string;\n  urlDisplayLabel?: string;\n  datasourceUid?: string;\n};\n\nexport interface PromQueryRequest extends PromQuery {\n  step?: number;\n  requestId?: string;\n  start: number;\n  end: number;\n  headers?: any;\n}\n\nexport interface PromMetricsMetadataItem {\n  type: string;\n  help: string;\n  unit?: string;\n}\n\nexport interface PromMetricsMetadata {\n  [metric: string]: PromMetricsMetadataItem;\n}\n\nexport type PromValue = [number, any];\n\nexport interface PromMetric {\n  __name__?: string;\n\n  [index: string]: any;\n}\n\nexport interface PromBuildInfoResponse {\n  data: {\n    application?: string;\n    version: string;\n    revision: string;\n    features?: {\n      ruler_config_api?: 'true' | 'false';\n      alertmanager_config_api?: 'true' | 'false';\n      query_sharding?: 'true' | 'false';\n      federated_rules?: 'true' | 'false';\n    };\n    [key: string]: unknown;\n  };\n  status: 'success';\n}\n\n/**\n * Auto = query.legendFormat == '__auto'\n * Verbose = query.legendFormat == null/undefined/''\n * Custom query.legendFormat.length > 0 && query.legendFormat !== '__auto'\n */\nexport enum LegendFormatMode {\n  Auto = '__auto',\n  Verbose = '__verbose',\n  Custom = '__custom',\n}\n\nexport enum PromVariableQueryType {\n  LabelNames,\n  LabelValues,\n  MetricNames,\n  VarQueryResult,\n  SeriesQuery,\n  ClassicQuery,\n}\n\nexport interface PromVariableQuery extends DataQuery {\n  query?: string;\n  expr?: string;\n  qryType?: PromVariableQueryType;\n  label?: string;\n  metric?: string;\n  varQuery?: string;\n  seriesQuery?: string;\n  labelFilters?: QueryBuilderLabelFilter[];\n  match?: string;\n  classicQuery?: string;\n}\n\nexport type StandardPromVariableQuery = {\n  query: string;\n  refId: string;\n};\n\n// Rules that we fetch from Prometheus\nexport type RawRecordingRules = {\n  name: string;\n  file: string;\n  rules: Rule[];\n  interval?: number;\n  limit?: number;\n};\n\n// A single recording rule with its labels and the query it represents\n// In this object, there may be other fields but those are the ones we care for now\nexport type Rule = {\n  name: string;\n  query: string;\n  duration?: number;\n  labels?: Record<string, string>;\n  annotations?: Record<string, string>;\n  alerts?: AlertInfo[];\n  type: 'alerting' | 'recording';\n};\n\nexport type AlertInfo = {\n  labels: Record<string, string>;\n  annotations: Record<string, string>;\n  state: string;\n  activeAt: string;\n  value: string;\n};\n\n// Extracted recording rules with labels\n// We parse and extract the rules because\n// there might be multiple rules with same name but different labels and queries\nexport type RuleQueryMapping = {\n  [key: string]: Array<{\n    query: string;\n    labels?: Record<string, string>;\n  }>;\n};\n\nexport type RecordingRuleIdentifier = {\n  expandedQuery: string;\n  identifier?: string;\n  identifierValue?: string;\n};\n","import { PrometheusCacheLevel } from './types';\n\n/**\n * Returns the debounce time in milliseconds based on the cache level.\n * Used to control the frequency of API requests.\n *\n * @param {PrometheusCacheLevel} cacheLevel - The cache level (None, Low, Medium, High)\n * @returns {number} Debounce time in milliseconds:\n *   - Medium: 600ms\n *   - High: 1200ms\n *   - Default (None/Low): 350ms\n */\nexport const getDebounceTimeInMilliseconds = (cacheLevel: PrometheusCacheLevel): number => {\n  switch (cacheLevel) {\n    case PrometheusCacheLevel.Medium:\n      return 600;\n    case PrometheusCacheLevel.High:\n      return 1200;\n    default:\n      return 350;\n  }\n};\n\n/**\n * Returns the number of days to cache metadata based on the cache level.\n * Used for caching Prometheus metric metadata.\n *\n * @param {PrometheusCacheLevel} cacheLevel - The cache level (None, Low, Medium, High)\n * @returns {number} Number of days to cache:\n *   - Medium: 7 days\n *   - High: 30 days\n *   - Default (None/Low): 1 day\n */\nexport const getDaysToCacheMetadata = (cacheLevel: PrometheusCacheLevel): number => {\n  switch (cacheLevel) {\n    case PrometheusCacheLevel.Medium:\n      return 7;\n    case PrometheusCacheLevel.High:\n      return 30;\n    default:\n      return 1;\n  }\n};\n\n/**\n * Returns the cache duration in minutes based on the cache level.\n * Used for general API response caching.\n *\n * @param {PrometheusCacheLevel} cacheLevel - The cache level (None, Low, Medium, High)\n * @returns Cache duration in minutes:\n *   - Medium: 10 minutes\n *   - High: 60 minutes\n *   - Default (None/Low): 1 minute\n */\nexport const getCacheDurationInMinutes = (cacheLevel: PrometheusCacheLevel) => {\n  switch (cacheLevel) {\n    case PrometheusCacheLevel.Medium:\n      return 10;\n    case PrometheusCacheLevel.High:\n      return 60;\n    default:\n      return 1;\n  }\n};\n\n/**\n * Builds cache headers for Prometheus API requests.\n * Creates a standard cache control header with private scope and max-age directive.\n *\n * @param {number} durationInSeconds - Cache duration in seconds\n * @returns Object containing headers with cache control directives:\n *   - X-Grafana-Cache: private, max-age=<duration>\n * @example\n * // Returns { headers: { 'X-Grafana-Cache': 'private, max-age=300' } }\n * buildCacheHeaders(300)\n */\nexport const buildCacheHeaders = (durationInSeconds: number) => {\n  return {\n    headers: {\n      'X-Grafana-Cache': `private, max-age=${durationInSeconds}`,\n    },\n  };\n};\n\n/**\n * Gets appropriate cache headers based on the configured cache level.\n * Converts cache duration from minutes to seconds and builds the headers.\n * Returns undefined if caching is disabled (None level).\n *\n * @param {PrometheusCacheLevel} cacheLevel - Cache level (None, Low, Medium, High)\n * @returns Cache headers object or undefined if caching is disabled\n * @example\n * // For Medium level, returns { headers: { 'X-Grafana-Cache': 'private, max-age=600' } }\n * getDefaultCacheHeaders(PrometheusCacheLevel.Medium)\n */\nexport const getDefaultCacheHeaders = (cacheLevel: PrometheusCacheLevel) => {\n  if (cacheLevel !== PrometheusCacheLevel.None) {\n    return buildCacheHeaders(getCacheDurationInMinutes(cacheLevel) * 60);\n  }\n  return;\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/language_utils.ts\nimport { invert } from 'lodash';\nimport { Token } from 'prismjs';\n\nimport {\n  AbstractLabelMatcher,\n  AbstractLabelOperator,\n  AbstractQuery,\n  DataQuery,\n  dateMath,\n  DateTime,\n  incrRoundDn,\n  TimeRange,\n} from '@grafana/data';\n\nimport { addLabelToQuery } from './add_label_to_query';\nimport { getCacheDurationInMinutes } from './caching';\nimport { SUGGESTIONS_LIMIT, PROMETHEUS_QUERY_BUILDER_MAX_RESULTS } from './constants';\nimport { PrometheusCacheLevel, PromMetricsMetadata, PromMetricsMetadataItem, RecordingRuleIdentifier } from './types';\n\nexport const processHistogramMetrics = (metrics: string[]) => {\n  const resultSet: Set<string> = new Set();\n  const regexp = new RegExp('_bucket($|:)');\n  for (let index = 0; index < metrics.length; index++) {\n    const metric = metrics[index];\n    const isHistogramValue = regexp.test(metric);\n    if (isHistogramValue) {\n      resultSet.add(metric);\n    }\n  }\n  return [...resultSet];\n};\n\nexport function processLabels(labels: Array<{ [key: string]: string }>, withName = false) {\n  // For processing we are going to use sets as they have significantly better performance than arrays\n  // After we process labels, we will convert sets to arrays and return object with label values in arrays\n  const valueSet: { [key: string]: Set<string> } = {};\n  labels.forEach((label) => {\n    const { __name__, ...rest } = label;\n    if (withName) {\n      valueSet['__name__'] = valueSet['__name__'] || new Set();\n      if (!valueSet['__name__'].has(__name__)) {\n        valueSet['__name__'].add(__name__);\n      }\n    }\n\n    Object.keys(rest).forEach((key) => {\n      if (!valueSet[key]) {\n        valueSet[key] = new Set();\n      }\n      if (!valueSet[key].has(rest[key])) {\n        valueSet[key].add(rest[key]);\n      }\n    });\n  });\n\n  // valueArray that we are going to return in the object\n  const valueArray: { [key: string]: string[] } = {};\n  limitSuggestions(Object.keys(valueSet)).forEach((key) => {\n    valueArray[key] = limitSuggestions(Array.from(valueSet[key]));\n  });\n\n  return { values: valueArray, keys: Object.keys(valueArray) };\n}\n\n// const cleanSelectorRegexp = /\\{(\\w+=\"[^\"\\n]*?\")(,\\w+=\"[^\"\\n]*?\")*\\}/;\nexport const selectorRegexp = /\\{[^}]*?(\\}|$)/;\n\n// This will capture 4 groups. Example label filter => {instance=\"10.4.11.4:9003\"}\n// 1. label:    instance\n// 2. operator: =\n// 3. value:    \"10.4.11.4:9003\"\n// 4. comma:    if there is a comma it will give ,\n// 5. space:    if there is a space after comma it will give the whole space\n// comma and space is useful for addLabelsToExpression function\nexport const labelRegexp = /\\b(\\w+)(!?=~?)(\"[^\"\\n]*?\")(,)?(\\s*)?/g;\n\nexport function parseSelector(query: string, cursorOffset = 1): { labelKeys: string[]; selector: string } {\n  if (!query.match(selectorRegexp)) {\n    // Special matcher for metrics\n    if (query.match(/^[A-Za-z:][\\w:]*$/)) {\n      return {\n        selector: `{__name__=\"${query}\"}`,\n        labelKeys: ['__name__'],\n      };\n    }\n    throw new Error('Query must contain a selector: ' + query);\n  }\n\n  // Check if inside a selector\n  const prefix = query.slice(0, cursorOffset);\n  const prefixOpen = prefix.lastIndexOf('{');\n  const prefixClose = prefix.lastIndexOf('}');\n  if (prefixOpen === -1) {\n    throw new Error('Not inside selector, missing open brace: ' + prefix);\n  }\n  if (prefixClose > -1 && prefixClose > prefixOpen) {\n    throw new Error('Not inside selector, previous selector already closed: ' + prefix);\n  }\n  const suffix = query.slice(cursorOffset);\n  const suffixCloseIndex = suffix.indexOf('}');\n  const suffixClose = suffixCloseIndex + cursorOffset;\n  const suffixOpenIndex = suffix.indexOf('{');\n  const suffixOpen = suffixOpenIndex + cursorOffset;\n  if (suffixClose === -1) {\n    throw new Error('Not inside selector, missing closing brace in suffix: ' + suffix);\n  }\n  if (suffixOpenIndex > -1 && suffixOpen < suffixClose) {\n    throw new Error('Not inside selector, next selector opens before this one closed: ' + suffix);\n  }\n\n  // Extract clean labels to form clean selector, incomplete labels are dropped\n  const selector = query.slice(prefixOpen, suffixClose);\n  const labels: { [key: string]: { value: string; operator: string } } = {};\n  selector.replace(labelRegexp, (label, key, operator, value) => {\n    const labelOffset = query.indexOf(label);\n    const valueStart = labelOffset + key.length + operator.length + 1;\n    const valueEnd = labelOffset + key.length + operator.length + value.length - 1;\n    // Skip label if cursor is in value\n    if (cursorOffset < valueStart || cursorOffset > valueEnd) {\n      labels[key] = { value, operator };\n    }\n    return '';\n  });\n\n  // Add metric if there is one before the selector\n  const metricPrefix = query.slice(0, prefixOpen);\n  const metricMatch = metricPrefix.match(/[A-Za-z:][\\w:]*$/);\n  if (metricMatch) {\n    labels['__name__'] = { value: `\"${metricMatch[0]}\"`, operator: '=' };\n  }\n\n  // Build sorted selector\n  const labelKeys = Object.keys(labels).sort();\n  const cleanSelector = labelKeys.map((key) => `${key}${labels[key].operator}${labels[key].value}`).join(',');\n\n  const selectorString = ['{', cleanSelector, '}'].join('');\n\n  return { labelKeys, selector: selectorString };\n}\n\nexport function expandRecordingRules(query: string, mapping: { [name: string]: RecordingRuleIdentifier }): string {\n  const getRuleRegex = (ruleName: string) => new RegExp(`(\\\\s|\\\\(|^)(${ruleName})(\\\\s|$|\\\\(|\\\\[|\\\\{)`, 'ig');\n\n  // For each mapping key we iterate over the query and split them in parts.\n  // recording:rule{label=~\"/label/value\"} * some:other:rule{other_label=\"value\"}\n  // We want to keep parts in here like this:\n  // recording:rule\n  // {label=~\"/label/value\"} *\n  // some:other:rule\n  // {other_label=\"value\"}\n  const tmpSplitParts = Object.keys(mapping).reduce<string[]>(\n    (prev, curr) => {\n      let parts: string[] = [];\n      let tmpParts: string[] = [];\n      let removeIdx: number[] = [];\n\n      // we iterate over prev because it might be like this after first loop\n      // recording:rule and {label=~\"/label/value\"} * some:other:rule{other_label=\"value\"}\n      // so we need to split the second part too\n      prev.filter(Boolean).forEach((p, i) => {\n        const doesMatch = p.match(getRuleRegex(curr));\n        if (doesMatch) {\n          parts = p.split(curr);\n          if (parts.length === 2) {\n            // this is the case when we have such result for this query\n            // max (metric{label=\"value\"})\n            // \"max(\", \"{label=\"value\"}\"\n            removeIdx.push(i);\n            tmpParts.push(...[parts[0], curr, parts[1]].filter(Boolean));\n          } else if (parts.length > 2) {\n            // this is the case when we have such query\n            // metric + metric\n            // when we split it we have such data\n            // \"\", \" + \", \"\"\n            removeIdx.push(i);\n            parts = parts.map((p) => (p === '' ? curr : p));\n            tmpParts.push(...parts);\n          }\n        }\n      });\n\n      // if we have idx to remove that means we split the value in that index.\n      // No need to keep it. Have the new split values instead.\n      removeIdx.forEach((ri) => (prev[ri] = ''));\n      prev = prev.filter(Boolean);\n      prev.push(...tmpParts);\n\n      return prev;\n    },\n    [query]\n  );\n\n  // we have the separate parts. we need to replace the metric and apply the labels if there is any\n  let labelFound = false;\n  const trulyExpandedQuery = tmpSplitParts.map((tsp, i) => {\n    // if we know this loop tsp is a label, not the metric we want to expand\n    if (labelFound) {\n      labelFound = false;\n      return '';\n    }\n\n    // check if the mapping is there\n    if (mapping[tsp]) {\n      const { expandedQuery: recordingRule, identifierValue, identifier } = mapping[tsp];\n      // it is a recording rule. if the following is a label then apply it\n      if (i + 1 !== tmpSplitParts.length && tmpSplitParts[i + 1].match(labelRegexp)) {\n        // the next value in the loop is label. Let's apply labels to the metric\n        labelFound = true;\n        const regexp = new RegExp(`(,)?(\\\\s)?(${identifier}=\\\\\"${identifierValue}\\\\\")(,)?(\\\\s)?`, 'g');\n        const labels = tmpSplitParts[i + 1].replace(regexp, '');\n        const invalidLabelsRegex = /(\\)\\{|\\}\\{|\\]\\{)/;\n        return addLabelsToExpression(recordingRule + labels, invalidLabelsRegex);\n      } else {\n        // it is not a recording rule and might be a binary operation in between two recording rules\n        // So no need to do anything. just return it.\n        return recordingRule;\n      }\n    }\n\n    return tsp;\n  });\n\n  // Remove empty strings and merge them\n  return trulyExpandedQuery.filter(Boolean).join('');\n}\n\nfunction addLabelsToExpression(expr: string, invalidLabelsRegexp: RegExp) {\n  const match = expr.match(invalidLabelsRegexp);\n  if (!match) {\n    return expr;\n  }\n\n  // Split query into 2 parts - before the invalidLabelsRegex match and after.\n  const indexOfRegexMatch = match.index ?? 0;\n  const exprBeforeRegexMatch = expr.slice(0, indexOfRegexMatch + 1);\n  const exprAfterRegexMatch = expr.slice(indexOfRegexMatch + 1);\n\n  // Create arrayOfLabelObjects with label objects that have key, operator and value.\n  const arrayOfLabelObjects: Array<{\n    key: string;\n    operator: string;\n    value: string;\n    comma?: string;\n    space?: string;\n  }> = [];\n  exprAfterRegexMatch.replace(labelRegexp, (label, key, operator, value, comma, space) => {\n    arrayOfLabelObjects.push({ key, operator, value, comma, space });\n    return '';\n  });\n\n  // Loop through all label objects and add them to query.\n  // As a starting point we have valid query without the labels.\n  let result = exprBeforeRegexMatch;\n  arrayOfLabelObjects.filter(Boolean).forEach((obj) => {\n    // Remove extra set of quotes from obj.value\n    const value = obj.value.slice(1, -1);\n    result = addLabelToQuery(result, obj.key, value, obj.operator);\n  });\n\n  // reconstruct the labels\n  let existingLabel = arrayOfLabelObjects.reduce((prev, curr) => {\n    prev += `${curr.key}${curr.operator}${curr.value}${curr.comma ?? ''}${curr.space ?? ''}`;\n    return prev;\n  }, '');\n\n  // Check if there is anything besides labels\n  // Useful for this kind of metrics sum (recording_rule_metric{label1=\"value1\"}) by (env)\n  // if we don't check this part, ) by (env) part will be lost\n  existingLabel = '{' + existingLabel + '}';\n  const potentialLeftOver = exprAfterRegexMatch.replace(existingLabel, '');\n\n  return result + potentialLeftOver;\n}\n\n/**\n * Adds metadata for synthetic metrics for which the API does not provide metadata.\n * See https://github.com/grafana/grafana/issues/22337 for details.\n *\n * @param metadata HELP and TYPE metadata from /api/v1/metadata\n */\nexport function fixSummariesMetadata(metadata: { [metric: string]: PromMetricsMetadataItem[] }): PromMetricsMetadata {\n  if (!metadata) {\n    return metadata;\n  }\n  const baseMetadata: PromMetricsMetadata = {};\n  const summaryMetadata: PromMetricsMetadata = {};\n  for (const metric in metadata) {\n    // NOTE: based on prometheus-documentation, we can receive\n    // multiple metadata-entries for the given metric, it seems\n    // it happens when the same metric is on multiple targets\n    // and their help-text differs\n    // (https://prometheus.io/docs/prometheus/latest/querying/api/#querying-metric-metadata)\n    // for now we just use the first entry.\n    const item = metadata[metric][0];\n    baseMetadata[metric] = item;\n\n    if (item.type === 'histogram') {\n      summaryMetadata[`${metric}_bucket`] = {\n        type: 'counter',\n        help: `Cumulative counters for the observation buckets (${item.help})`,\n      };\n      summaryMetadata[`${metric}_count`] = {\n        type: 'counter',\n        help: `Count of events that have been observed for the histogram metric (${item.help})`,\n      };\n      summaryMetadata[`${metric}_sum`] = {\n        type: 'counter',\n        help: `Total sum of all observed values for the histogram metric (${item.help})`,\n      };\n    }\n    if (item.type === 'summary') {\n      summaryMetadata[`${metric}_count`] = {\n        type: 'counter',\n        help: `Count of events that have been observed for the base metric (${item.help})`,\n      };\n      summaryMetadata[`${metric}_sum`] = {\n        type: 'counter',\n        help: `Total sum of all observed values for the base metric (${item.help})`,\n      };\n    }\n  }\n  // Synthetic series\n  const syntheticMetadata: PromMetricsMetadata = {};\n  syntheticMetadata['ALERTS'] = {\n    type: 'gauge',\n    help: 'Time series showing pending and firing alerts. The sample value is set to 1 as long as the alert is in the indicated active (pending or firing) state.',\n  };\n\n  return { ...baseMetadata, ...summaryMetadata, ...syntheticMetadata };\n}\n\nexport function roundMsToMin(milliseconds: number): number {\n  return roundSecToMin(milliseconds / 1000);\n}\n\nexport function roundSecToMin(seconds: number): number {\n  return Math.floor(seconds / 60);\n}\n\n// Returns number of minutes rounded up to the nearest nth minute\nexport function roundSecToNextMin(seconds: number, secondsToRound = 1): number {\n  return Math.ceil(seconds / 60) - (Math.ceil(seconds / 60) % secondsToRound);\n}\n\nexport function limitSuggestions(items: string[]) {\n  return items.slice(0, SUGGESTIONS_LIMIT);\n}\n\nexport function addLimitInfo(items: unknown[] | undefined): string {\n  return items && items.length >= SUGGESTIONS_LIMIT ? `, limited to the first ${SUGGESTIONS_LIMIT} received items` : '';\n}\n\nconst FromPromLikeMap: Record<string, AbstractLabelOperator> = {\n  '=': AbstractLabelOperator.Equal,\n  '!=': AbstractLabelOperator.NotEqual,\n  '=~': AbstractLabelOperator.EqualRegEx,\n  '!~': AbstractLabelOperator.NotEqualRegEx,\n};\n\nconst ToPromLikeMap: Record<AbstractLabelOperator, string> = invert(FromPromLikeMap) as Record<\n  AbstractLabelOperator,\n  string\n>;\n\nexport function toPromLikeExpr(labelBasedQuery: AbstractQuery): string {\n  const expr = labelBasedQuery.labelMatchers\n    .map((selector: AbstractLabelMatcher) => {\n      const operator = ToPromLikeMap[selector.operator];\n      if (operator) {\n        return `${selector.name}${operator}\"${selector.value}\"`;\n      } else {\n        return '';\n      }\n    })\n    .filter((e: string) => e !== '')\n    .join(', ');\n\n  return expr ? `{${expr}}` : '';\n}\n\nexport function toPromLikeQuery(labelBasedQuery: AbstractQuery): PromLikeQuery {\n  return {\n    refId: labelBasedQuery.refId,\n    expr: toPromLikeExpr(labelBasedQuery),\n    range: true,\n  };\n}\n\nexport interface PromLikeQuery extends DataQuery {\n  expr: string;\n  range: boolean;\n}\n\nfunction getMaybeTokenStringContent(token: Token): string {\n  if (typeof token.content === 'string') {\n    return token.content;\n  }\n\n  return '';\n}\n\nexport function extractLabelMatchers(tokens: Array<string | Token>): AbstractLabelMatcher[] {\n  const labelMatchers: AbstractLabelMatcher[] = [];\n\n  for (const token of tokens) {\n    if (!(token instanceof Token)) {\n      continue;\n    }\n\n    if (token.type === 'context-labels') {\n      let labelKey = '';\n      let labelValue = '';\n      let labelOperator = '';\n\n      const contentTokens = Array.isArray(token.content) ? token.content : [token.content];\n\n      for (let currentToken of contentTokens) {\n        if (typeof currentToken === 'string') {\n          let currentStr: string;\n          currentStr = currentToken;\n          if (currentStr === '=' || currentStr === '!=' || currentStr === '=~' || currentStr === '!~') {\n            labelOperator = currentStr;\n          }\n        } else if (currentToken instanceof Token) {\n          switch (currentToken.type) {\n            case 'label-key':\n              labelKey = getMaybeTokenStringContent(currentToken);\n              break;\n            case 'label-value':\n              labelValue = getMaybeTokenStringContent(currentToken);\n              labelValue = labelValue.substring(1, labelValue.length - 1);\n              const labelComparator = FromPromLikeMap[labelOperator];\n              if (labelComparator) {\n                labelMatchers.push({ name: labelKey, operator: labelComparator, value: labelValue });\n              }\n              break;\n          }\n        }\n      }\n    }\n  }\n\n  return labelMatchers;\n}\n\n/**\n * Calculates new interval \"snapped\" to the closest Nth minute, depending on cache level datasource setting\n * @param cacheLevel\n * @param range\n */\nexport function getRangeSnapInterval(\n  cacheLevel: PrometheusCacheLevel,\n  range: TimeRange\n): {\n  start: string;\n  end: string;\n} {\n  // Don't round the range if we're not caching\n  if (cacheLevel === PrometheusCacheLevel.None) {\n    return {\n      start: getPrometheusTime(range.from, false).toString(),\n      end: getPrometheusTime(range.to, true).toString(),\n    };\n  }\n  // Otherwise round down to the nearest nth minute for the start time\n  const startTime = getPrometheusTime(range.from, false);\n  const startTimeQuantizedSeconds = incrRoundDn(startTime, getCacheDurationInMinutes(cacheLevel) * 60);\n\n  // And round up to the nearest nth minute for the end time\n  const endTime = getPrometheusTime(range.to, true);\n  const endTimeQuantizedSeconds = roundSecToNextMin(endTime, getCacheDurationInMinutes(cacheLevel)) * 60;\n\n  // If the interval was too short, we could have rounded both start and end to the same time, if so let's add one step to the end\n  if (startTimeQuantizedSeconds === endTimeQuantizedSeconds) {\n    const endTimePlusOneStep = endTimeQuantizedSeconds + getCacheDurationInMinutes(cacheLevel) * 60;\n    return { start: startTimeQuantizedSeconds.toString(), end: endTimePlusOneStep.toString() };\n  }\n\n  const start = startTimeQuantizedSeconds.toString();\n  const end = endTimeQuantizedSeconds.toString();\n\n  return { start, end };\n}\n\nexport function getPrometheusTime(date: string | DateTime, roundUp: boolean) {\n  if (typeof date === 'string') {\n    date = dateMath.parse(date, roundUp)!;\n  }\n\n  return Math.ceil(date.valueOf() / 1000);\n}\n\n/**\n * Used to truncate metrics, label names and label value in the query builder select components\n * to improve frontend performance. This is best used with an async select component including\n * the loadOptions property where we should still allow users to search all results with a string.\n * This can be done either storing the total results or querying an api that allows for matching a query.\n *\n * @param array\n * @param limit\n * @returns\n */\nexport function truncateResult<T>(array: T[], limit?: number): T[] {\n  if (limit === undefined) {\n    limit = PROMETHEUS_QUERY_BUILDER_MAX_RESULTS;\n  }\n  array.length = Math.min(array.length, limit);\n  return array;\n}\n","import { MutableRefObject, useEffect, useRef } from 'react';\n\nimport { DataFrame, DateTime, TimeRange } from '@grafana/data';\n\nimport { PrometheusLanguageProviderInterface } from '../language_provider';\nimport { roundMsToMin } from '../language_utils';\n\nimport { CancelablePromise } from './cancelable-promise';\n\nexport function usePromQueryFieldEffects(\n  languageProvider: PrometheusLanguageProviderInterface,\n  range: TimeRange | undefined,\n  series: DataFrame[] | undefined,\n  refreshMetrics: (languageProviderInitRef: MutableRefObject<CancelablePromise<unknown> | null>) => Promise<void>,\n  refreshHint: () => void\n) {\n  const lastRangeRef = useRef<{ from: DateTime; to: DateTime } | null>(null);\n  const languageProviderInitRef = useRef<CancelablePromise<unknown> | null>(null);\n\n  // Effect for initial load\n  useEffect(() => {\n    if (languageProvider) {\n      refreshMetrics(languageProviderInitRef);\n    }\n    refreshHint();\n\n    return () => {\n      if (languageProviderInitRef.current) {\n        languageProviderInitRef.current.cancel();\n        languageProviderInitRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Effect for time range changes\n  useEffect(() => {\n    if (!range) {\n      return;\n    }\n\n    const currentFrom = roundMsToMin(range.from.valueOf());\n    const currentTo = roundMsToMin(range.to.valueOf());\n\n    if (!lastRangeRef.current) {\n      lastRangeRef.current = { from: range.from, to: range.to };\n    }\n\n    const lastFrom = roundMsToMin(lastRangeRef.current.from.valueOf());\n    const lastTo = roundMsToMin(lastRangeRef.current.to.valueOf());\n\n    if (currentFrom !== lastFrom || currentTo !== lastTo) {\n      lastRangeRef.current = { from: range.from, to: range.to };\n      refreshMetrics(languageProviderInitRef);\n    }\n  }, [range, refreshMetrics]);\n\n  // Effect for data changes (refreshing hints)\n  useEffect(() => {\n    refreshHint();\n  }, [series, refreshHint]);\n\n  return languageProviderInitRef;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromQueryField.tsx\nimport { css, cx } from '@emotion/css';\nimport { MutableRefObject, ReactNode, useCallback, useState } from 'react';\n\nimport { getDefaultTimeRange, isDataFrame, QueryEditorProps, QueryHint, toLegacyResponseData } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { clearButtonStyles, Icon, useTheme2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { getInitHints } from '../query_hints';\nimport { PromOptions, PromQuery } from '../types';\n\nimport { CancelablePromise, isCancelablePromiseRejection, makePromiseCancelable } from './cancelable-promise';\nimport { MetricsBrowser } from './metrics-browser/MetricsBrowser';\nimport { MetricsBrowserProvider } from './metrics-browser/MetricsBrowserContext';\nimport { MonacoQueryFieldWrapper } from './monaco-query-field/MonacoQueryFieldWrapper';\nimport { useMetricsState } from './useMetricsState';\nimport { usePromQueryFieldEffects } from './usePromQueryFieldEffects';\n\ninterface PromQueryFieldProps extends QueryEditorProps<PrometheusDatasource, PromQuery, PromOptions> {\n  ExtraFieldElement?: ReactNode;\n  'data-testid'?: string;\n}\n\nexport const PromQueryField = (props: PromQueryFieldProps) => {\n  const {\n    app,\n    datasource,\n    datasource: { languageProvider },\n    query,\n    ExtraFieldElement,\n    history = [],\n    data,\n    range,\n    onChange,\n    onRunQuery,\n  } = props;\n\n  const theme = useTheme2();\n\n  const [syntaxLoaded, setSyntaxLoaded] = useState(false);\n  const [hint, setHint] = useState<QueryHint | null>(null);\n  const [labelBrowserVisible, setLabelBrowserVisible] = useState(false);\n\n  const updateLanguage = useCallback(() => {\n    if (languageProvider.retrieveMetrics()) {\n      setSyntaxLoaded(true);\n    }\n  }, [languageProvider]);\n\n  const refreshMetrics = useCallback(\n    async (languageProviderInitRef: MutableRefObject<CancelablePromise<any> | null>) => {\n      // Cancel any existing initialization using the ref\n      if (languageProviderInitRef.current) {\n        languageProviderInitRef.current.cancel();\n      }\n\n      if (!languageProvider || !range) {\n        return;\n      }\n\n      try {\n        const initialization = makePromiseCancelable(languageProvider.start(range));\n        languageProviderInitRef.current = initialization;\n\n        const remainingTasks = await initialization.promise;\n\n        // If there are remaining tasks, wait for them\n        if (Array.isArray(remainingTasks) && remainingTasks.length > 0) {\n          await Promise.all(remainingTasks);\n        }\n\n        updateLanguage();\n      } catch (err) {\n        if (isCancelablePromiseRejection(err) && err.isCanceled) {\n          // do nothing, promise was canceled\n        } else {\n          throw err;\n        }\n      } finally {\n        languageProviderInitRef.current = null;\n      }\n    },\n    [languageProvider, range, updateLanguage]\n  );\n\n  const refreshHint = useCallback(() => {\n    const initHints = getInitHints(datasource);\n    const initHint = initHints[0] ?? null;\n\n    // If no data or empty series, use default hint\n    if (!data?.series?.length) {\n      setHint(initHint);\n      return;\n    }\n\n    const result = isDataFrame(data.series[0]) ? data.series.map(toLegacyResponseData) : data.series;\n    const queryHints = datasource.getQueryHints(query, result);\n    let queryHint = queryHints.length > 0 ? queryHints[0] : null;\n\n    setHint(queryHint ?? initHint);\n  }, [data, datasource, query]);\n\n  const onChangeQuery = (value: string, override?: boolean) => {\n    if (!onChange) {\n      return;\n    }\n    // Send text change to parent\n    const nextQuery: PromQuery = { ...query, expr: value };\n    onChange(nextQuery);\n\n    if (override && onRunQuery) {\n      onRunQuery();\n    }\n  };\n\n  const onChangeLabelBrowser = (selector: string) => {\n    onChangeQuery(selector, true);\n    setLabelBrowserVisible(false);\n  };\n\n  const onClickChooserButton = () => {\n    setLabelBrowserVisible(!labelBrowserVisible);\n\n    reportInteraction('user_grafana_prometheus_metrics_browser_clicked', {\n      editorMode: labelBrowserVisible ? 'metricViewClosed' : 'metricViewOpen',\n      app: app ?? '',\n    });\n  };\n\n  const onClickHintFix = () => {\n    if (hint?.fix?.action) {\n      onChange(datasource.modifyQuery(query, hint.fix.action));\n    }\n    onRunQuery();\n  };\n\n  // Use our custom effects hook\n  usePromQueryFieldEffects(languageProvider, range, data?.series, refreshMetrics, refreshHint);\n\n  const { chooserText, buttonDisabled } = useMetricsState(datasource, languageProvider, syntaxLoaded);\n\n  return (\n    <>\n      <div\n        className=\"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1\"\n        data-testid={props['data-testid']}\n      >\n        <button\n          className=\"gf-form-label query-keyword pointer\"\n          onClick={onClickChooserButton}\n          disabled={buttonDisabled}\n          type=\"button\"\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsBrowser.openButton}\n        >\n          {chooserText}\n          <Icon name={labelBrowserVisible ? 'angle-down' : 'angle-right'} />\n        </button>\n\n        <div className=\"flex-grow-1 min-width-15\">\n          <MonacoQueryFieldWrapper\n            languageProvider={languageProvider}\n            history={history}\n            onChange={onChangeQuery}\n            onRunQuery={onRunQuery}\n            initialValue={query.expr ?? ''}\n            placeholder={t(\n              'grafana-prometheus.components.prom-query-field.placeholder-enter-a-prom-ql-query',\n              'Enter a PromQL query'\n            )}\n            datasource={datasource}\n            timeRange={range ?? getDefaultTimeRange()}\n          />\n        </div>\n      </div>\n      {labelBrowserVisible && (\n        <div className=\"gf-form\">\n          <MetricsBrowserProvider\n            timeRange={range ?? getDefaultTimeRange()}\n            languageProvider={languageProvider}\n            onChange={onChangeLabelBrowser}\n          >\n            <MetricsBrowser />\n          </MetricsBrowserProvider>\n        </div>\n      )}\n      {ExtraFieldElement}\n      {hint ? (\n        <div\n          className={css({\n            flexBasis: '100%',\n          })}\n        >\n          <div className=\"text-warning\">\n            {hint.label}{' '}\n            {hint.fix ? (\n              <button\n                type=\"button\"\n                className={cx(clearButtonStyles(theme), 'text-link', 'muted')}\n                onClick={onClickHintFix}\n              >\n                {hint.fix.label}\n              </button>\n            ) : null}\n          </div>\n        </div>\n      ) : null}\n    </>\n  );\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox.tsx\nimport { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2, renderMarkdown } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nexport interface Props {\n  title?: React.ReactNode;\n  children?: React.ReactNode;\n  markdown?: string;\n  stepNumber?: number;\n}\n\nexport function OperationExplainedBox({ title, stepNumber, markdown, children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.box}>\n      {stepNumber !== undefined && <div className={styles.stepNumber}>{stepNumber}</div>}\n      <div className={styles.boxInner}>\n        {title && (\n          <div className={styles.header}>\n            <span>{title}</span>\n          </div>\n        )}\n        <div className={styles.body}>\n          {markdown && <div dangerouslySetInnerHTML={{ __html: renderMarkdown(markdown) }}></div>}\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    box: css({\n      background: theme.colors.background.secondary,\n      padding: theme.spacing(1),\n      borderRadius: theme.shape.radius.default,\n      position: 'relative',\n    }),\n    boxInner: css({\n      marginLeft: theme.spacing(4),\n    }),\n    stepNumber: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      background: theme.colors.secondary.main,\n      width: '20px',\n      height: '20px',\n      borderRadius: theme.shape.radius.circle,\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      position: 'absolute',\n      top: '10px',\n      left: '11px',\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    header: css({\n      paddingBottom: theme.spacing(0.5),\n      display: 'flex',\n      alignItems: 'center',\n      fontFamily: theme.typography.fontFamilyMonospace,\n    }),\n    body: css({\n      color: theme.colors.text.secondary,\n      'p:last-child': {\n        margin: 0,\n      },\n      a: {\n        color: theme.colors.text.link,\n        textDecoration: 'underline',\n      },\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/RawQuery.tsx\nimport { css, cx } from '@emotion/css';\nimport Prism, { Grammar } from 'prismjs';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { useTheme2 } from '@grafana/ui';\n\nexport interface Props {\n  query: string;\n  lang: {\n    grammar: Grammar;\n    name: string;\n  };\n  className?: string;\n}\n\nexport function RawQuery({ query, lang, className }: Props) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const highlighted = Prism.highlight(query, lang.grammar, lang.name);\n\n  return (\n    <div\n      className={cx(styles.editorField, 'prism-syntax-highlight', className)}\n      aria-label={t('grafana-prometheus.querybuilder.raw-query.aria-label-selector', 'selector')}\n      dangerouslySetInnerHTML={{ __html: highlighted }}\n    />\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    editorField: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained.tsx\nimport { Grammar } from 'prismjs';\n\nimport { OperationExplainedBox } from './OperationExplainedBox';\nimport { RawQuery } from './RawQuery';\nimport { QueryBuilderOperation, QueryWithOperations, VisualQueryModeller } from './types';\n\nexport interface Props<T extends QueryWithOperations> {\n  query: T;\n  queryModeller: VisualQueryModeller;\n  explainMode?: boolean;\n  stepNumber: number;\n  lang: {\n    grammar: Grammar;\n    name: string;\n  };\n  onMouseEnter?: (op: QueryBuilderOperation, index: number) => void;\n  onMouseLeave?: (op: QueryBuilderOperation, index: number) => void;\n}\n\nexport function OperationListExplained<T extends QueryWithOperations>({\n  query,\n  queryModeller,\n  stepNumber,\n  lang,\n  onMouseEnter,\n  onMouseLeave,\n}: Props<T>) {\n  return (\n    <>\n      {query.operations.map((op, index) => {\n        const def = queryModeller.getOperationDef(op.id);\n        if (!def) {\n          return `Operation ${op.id} not found`;\n        }\n        const title = def.renderer(op, def, '<expr>');\n        const body = def.explainHandler ? def.explainHandler(op, def) : (def.documentation ?? 'no docs');\n\n        return (\n          <div\n            key={index}\n            onMouseEnter={() => onMouseEnter?.(op, index)}\n            onMouseLeave={() => onMouseLeave?.(op, index)}\n          >\n            <OperationExplainedBox\n              stepNumber={index + stepNumber}\n              title={<RawQuery query={title} lang={lang} />}\n              markdown={body}\n            />\n          </div>\n        );\n      })}\n    </>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/operations.ts\nimport { binaryScalarOperations } from './binaryScalarOperations';\nimport {\n  defaultAddOperationHandler,\n  functionRendererLeft,\n  functionRendererRight,\n  getPromOperationDisplayName,\n  getRangeVectorParamDef,\n  rangeRendererLeftWithParams,\n  rangeRendererRightWithParams,\n} from './operationUtils';\nimport {\n  QueryBuilderOperation,\n  QueryBuilderOperationDef,\n  QueryWithOperations,\n  VisualQueryModeller,\n} from './shared/types';\nimport { PromOperationId, PromVisualQuery, PromVisualQueryOperationCategory } from './types';\n\nexport function getOperationDefinitions(): QueryBuilderOperationDef[] {\n  const list: QueryBuilderOperationDef[] = [\n    {\n      id: PromOperationId.HistogramQuantile,\n      name: 'Histogram quantile',\n      params: [{ name: 'Quantile', type: 'number', options: [0.99, 0.95, 0.9, 0.75, 0.5, 0.25] }],\n      defaultParams: [0.9],\n      category: PromVisualQueryOperationCategory.Functions,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    createFunction({ id: PromOperationId.HistogramAvg }),\n    createFunction({ id: PromOperationId.HistogramCount }),\n    createFunction({ id: PromOperationId.HistogramSum }),\n    {\n      id: PromOperationId.HistogramFraction,\n      name: 'Histogram fraction',\n      params: [\n        { name: 'Lower scalar', type: 'number' },\n        { name: 'Upper scalar', type: 'number' },\n      ],\n      defaultParams: [0.0, 0.2],\n      category: PromVisualQueryOperationCategory.Functions,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    createFunction({ id: PromOperationId.HistogramStddev }),\n    createFunction({ id: PromOperationId.HistogramStdvar }),\n    {\n      id: PromOperationId.LabelReplace,\n      name: 'Label replace',\n      params: [\n        { name: 'Destination label', type: 'string' },\n        { name: 'Replacement', type: 'string' },\n        { name: 'Source label', type: 'string' },\n        { name: 'Regex', type: 'string' },\n      ],\n      category: PromVisualQueryOperationCategory.Functions,\n      defaultParams: ['', '$1', '', '(.*)'],\n      renderer: functionRendererRight,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    {\n      id: PromOperationId.Ln,\n      name: 'Ln',\n      params: [],\n      defaultParams: [],\n      category: PromVisualQueryOperationCategory.Functions,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    createRangeFunction(PromOperationId.Changes),\n    createRangeFunction(PromOperationId.Rate, true),\n    createRangeFunction(PromOperationId.Irate),\n    createRangeFunction(PromOperationId.Increase, true),\n    createRangeFunction(PromOperationId.Idelta),\n    createRangeFunction(PromOperationId.Delta),\n    createFunction({\n      id: PromOperationId.DoubleExponentialSmoothing,\n      params: [\n        getRangeVectorParamDef(),\n        { name: 'Smoothing Factor', type: 'number' },\n        { name: 'Trend Factor', type: 'number' },\n      ],\n      defaultParams: ['$__interval', 0.5, 0.5],\n      alternativesKey: 'range function',\n      category: PromVisualQueryOperationCategory.RangeFunctions,\n      renderer: rangeRendererRightWithParams,\n      addOperationHandler: addOperationWithRangeVector,\n      changeTypeHandler: operationTypeChangedHandlerForRangeFunction,\n    }),\n    createFunction({\n      id: PromOperationId.HoltWinters,\n      params: [\n        getRangeVectorParamDef(),\n        { name: 'Smoothing Factor', type: 'number' },\n        { name: 'Trend Factor', type: 'number' },\n      ],\n      defaultParams: ['$__interval', 0.5, 0.5],\n      alternativesKey: 'range function',\n      category: PromVisualQueryOperationCategory.RangeFunctions,\n      renderer: rangeRendererRightWithParams,\n      addOperationHandler: addOperationWithRangeVector,\n      changeTypeHandler: operationTypeChangedHandlerForRangeFunction,\n    }),\n    createFunction({\n      id: PromOperationId.PredictLinear,\n      params: [getRangeVectorParamDef(), { name: 'Seconds from now', type: 'number' }],\n      defaultParams: ['$__interval', 60],\n      alternativesKey: 'range function',\n      category: PromVisualQueryOperationCategory.RangeFunctions,\n      renderer: rangeRendererRightWithParams,\n      addOperationHandler: addOperationWithRangeVector,\n      changeTypeHandler: operationTypeChangedHandlerForRangeFunction,\n    }),\n    createFunction({\n      id: PromOperationId.QuantileOverTime,\n      params: [getRangeVectorParamDef(), { name: 'Quantile', type: 'number' }],\n      defaultParams: ['$__interval', 0.5],\n      alternativesKey: 'overtime function',\n      category: PromVisualQueryOperationCategory.RangeFunctions,\n      renderer: rangeRendererLeftWithParams,\n      addOperationHandler: addOperationWithRangeVector,\n      changeTypeHandler: operationTypeChangedHandlerForRangeFunction,\n    }),\n    ...binaryScalarOperations,\n    {\n      id: PromOperationId.NestedQuery,\n      name: 'Binary operation with query',\n      params: [],\n      defaultParams: [],\n      category: PromVisualQueryOperationCategory.BinaryOps,\n      renderer: (model, def, innerExpr) => innerExpr,\n      addOperationHandler: addNestedQueryHandler,\n    },\n    createFunction({ id: PromOperationId.Abs }),\n    createFunction({ id: PromOperationId.Absent }),\n    createFunction({\n      id: PromOperationId.Acos,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Acosh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Asin,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Asinh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Atan,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Atanh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({ id: PromOperationId.Ceil }),\n    createFunction({\n      id: PromOperationId.Clamp,\n      name: 'Clamp',\n      params: [\n        { name: 'Minimum Scalar', type: 'number' },\n        { name: 'Maximum Scalar', type: 'number' },\n      ],\n      defaultParams: [1, 1],\n    }),\n\n    createFunction({\n      id: PromOperationId.ClampMax,\n      params: [{ name: 'Maximum Scalar', type: 'number' }],\n      defaultParams: [1],\n    }),\n    createFunction({\n      id: PromOperationId.ClampMin,\n      params: [{ name: 'Minimum Scalar', type: 'number' }],\n      defaultParams: [1],\n    }),\n    createFunction({\n      id: PromOperationId.Cos,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Cosh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.DayOfMonth,\n      category: PromVisualQueryOperationCategory.Time,\n    }),\n    createFunction({\n      id: PromOperationId.DayOfWeek,\n      category: PromVisualQueryOperationCategory.Time,\n    }),\n    createFunction({\n      id: PromOperationId.DayOfYear,\n      category: PromVisualQueryOperationCategory.Time,\n    }),\n    createFunction({\n      id: PromOperationId.DaysInMonth,\n      category: PromVisualQueryOperationCategory.Time,\n    }),\n    createFunction({ id: PromOperationId.Deg }),\n    createRangeFunction(PromOperationId.Deriv),\n    //\n    createFunction({ id: PromOperationId.Exp }),\n    createFunction({ id: PromOperationId.Floor }),\n    createFunction({ id: PromOperationId.Hour }),\n    createFunction({\n      id: PromOperationId.LabelJoin,\n      params: [\n        {\n          name: 'Destination Label',\n          type: 'string',\n        },\n        {\n          name: 'Separator',\n          type: 'string',\n        },\n        {\n          name: 'Source Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n        },\n      ],\n      defaultParams: ['', ',', ''],\n      renderer: labelJoinRenderer,\n      explainHandler: labelJoinExplainHandler,\n      addOperationHandler: labelJoinAddOperationHandler,\n    }),\n    createFunction({ id: PromOperationId.Log10 }),\n    createFunction({ id: PromOperationId.Log2 }),\n    createFunction({ id: PromOperationId.Minute }),\n    createFunction({ id: PromOperationId.Month }),\n    createFunction({\n      id: PromOperationId.Pi,\n      renderer: (model) => `${model.id}()`,\n    }),\n    createFunction({ id: PromOperationId.Rad }),\n    createRangeFunction(PromOperationId.Resets),\n    createFunction({\n      id: PromOperationId.Round,\n      category: PromVisualQueryOperationCategory.Functions,\n      params: [{ name: 'To Nearest', type: 'number' }],\n      defaultParams: [1],\n    }),\n    createFunction({ id: PromOperationId.Scalar }),\n    createFunction({ id: PromOperationId.Sgn }),\n    createFunction({ id: PromOperationId.Sin, category: PromVisualQueryOperationCategory.Trigonometric }),\n    createFunction({\n      id: PromOperationId.Sinh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({ id: PromOperationId.Sort }),\n    createFunction({ id: PromOperationId.SortDesc }),\n    createFunction({ id: PromOperationId.Sqrt }),\n    createFunction({ id: PromOperationId.Stddev }),\n    createFunction({\n      id: PromOperationId.Tan,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Tanh,\n      category: PromVisualQueryOperationCategory.Trigonometric,\n    }),\n    createFunction({\n      id: PromOperationId.Time,\n      renderer: (model) => `${model.id}()`,\n    }),\n    createFunction({ id: PromOperationId.Timestamp }),\n    createFunction({\n      id: PromOperationId.Vector,\n      params: [{ name: 'Value', type: 'number' }],\n      defaultParams: [1],\n      renderer: (model) => `${model.id}(${model.params[0]})`,\n    }),\n    createFunction({ id: PromOperationId.Year }),\n  ];\n\n  return list;\n}\n\nexport function createFunction(definition: Partial<QueryBuilderOperationDef>): QueryBuilderOperationDef {\n  return {\n    ...definition,\n    id: definition.id!,\n    name: definition.name ?? getPromOperationDisplayName(definition.id!),\n    params: definition.params ?? [],\n    defaultParams: definition.defaultParams ?? [],\n    category: definition.category ?? PromVisualQueryOperationCategory.Functions,\n    renderer: definition.renderer ?? (definition.params ? functionRendererRight : functionRendererLeft),\n    addOperationHandler: definition.addOperationHandler ?? defaultAddOperationHandler,\n  };\n}\n\nexport function createRangeFunction(name: string, withRateInterval = false): QueryBuilderOperationDef {\n  return {\n    id: name,\n    name: getPromOperationDisplayName(name),\n    params: [getRangeVectorParamDef(withRateInterval)],\n    defaultParams: [withRateInterval ? '$__rate_interval' : '$__interval'],\n    alternativesKey: 'range function',\n    category: PromVisualQueryOperationCategory.RangeFunctions,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addOperationWithRangeVector,\n    changeTypeHandler: operationTypeChangedHandlerForRangeFunction,\n  };\n}\n\nfunction operationTypeChangedHandlerForRangeFunction(\n  operation: QueryBuilderOperation,\n  newDef: QueryBuilderOperationDef\n) {\n  // validate current parameter\n  if (operation.params[0] === '$__rate_interval' && newDef.defaultParams[0] !== '$__rate_interval') {\n    operation.params = newDef.defaultParams;\n  } else if (operation.params[0] === '$__interval' && newDef.defaultParams[0] !== '$__interval') {\n    operation.params = newDef.defaultParams;\n  }\n\n  return operation;\n}\n\nexport function operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  let rangeVector = (model.params ?? [])[0] ?? '5m';\n  return `${def.id}(${innerExpr}[${rangeVector}])`;\n}\n\n/**\n * Since there can only be one operation with range vector this will replace the current one (if one was added )\n */\nexport function addOperationWithRangeVector(\n  def: QueryBuilderOperationDef,\n  query: PromVisualQuery,\n  modeller: VisualQueryModeller\n) {\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  if (query.operations.length > 0) {\n    // If operation exists it has to be in the registry so no point to check if it was found\n    const firstOp = modeller.getOperationDef(query.operations[0].id)!;\n\n    if (firstOp.addOperationHandler === addOperationWithRangeVector) {\n      return {\n        ...query,\n        operations: [newOperation, ...query.operations.slice(1)],\n      };\n    }\n  }\n\n  return {\n    ...query,\n    operations: [newOperation, ...query.operations],\n  };\n}\n\nfunction addNestedQueryHandler(def: QueryBuilderOperationDef, query: PromVisualQuery): PromVisualQuery {\n  return {\n    ...query,\n    binaryQueries: [\n      ...(query.binaryQueries ?? []),\n      {\n        operator: '/',\n        query,\n      },\n    ],\n  };\n}\n\nfunction labelJoinRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n  const paramZero = model.params[0] ?? '';\n  const paramOne = model.params[1] ?? '';\n\n  const separator = `\"${paramOne}\"`;\n  return `${model.id}(${innerExpr}, \"${paramZero}\", ${separator}, \"${model.params.slice(2).join(separator)}\")`;\n}\n\nfunction labelJoinExplainHandler(op: QueryBuilderOperation, def?: QueryBuilderOperationDef): string {\n  let explainMessage = def?.documentation ?? 'no docs';\n\n  if (typeof op.params[1] !== 'string') {\n    explainMessage += '  The `separator` must be a string.';\n  }\n\n  return explainMessage;\n}\n\nfunction labelJoinAddOperationHandler<T extends QueryWithOperations>(def: QueryBuilderOperationDef, query: T) {\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  return {\n    ...query,\n    operations: [...query.operations, newOperation],\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/aggregations.ts\nimport {\n  createAggregationOperation,\n  createAggregationOperationWithParam,\n  getPromOperationDisplayName,\n  getRangeVectorParamDef,\n} from './operationUtils';\nimport { addOperationWithRangeVector } from './operations';\nimport { QueryBuilderOperation, QueryBuilderOperationDef } from './shared/types';\nimport { PromOperationId, PromVisualQueryOperationCategory } from './types';\n\nexport function getAggregationOperations(): QueryBuilderOperationDef[] {\n  return [\n    ...createAggregationOperation(PromOperationId.Sum),\n    ...createAggregationOperation(PromOperationId.Avg),\n    ...createAggregationOperation(PromOperationId.Min),\n    ...createAggregationOperation(PromOperationId.Max),\n    ...createAggregationOperation(PromOperationId.Count),\n    ...createAggregationOperation(PromOperationId.Group),\n    ...createAggregationOperationWithParam(PromOperationId.TopK, {\n      params: [{ name: 'K-value', type: 'number' }],\n      defaultParams: [5],\n    }),\n    ...createAggregationOperationWithParam(PromOperationId.BottomK, {\n      params: [{ name: 'K-value', type: 'number' }],\n      defaultParams: [5],\n    }),\n    ...createAggregationOperationWithParam(PromOperationId.CountValues, {\n      params: [{ name: 'Identifier', type: 'string' }],\n      defaultParams: ['count'],\n    }),\n    ...createAggregationOperationWithParam(PromOperationId.Quantile, {\n      params: [{ name: 'Value', type: 'number' }],\n      defaultParams: [1],\n    }),\n    createAggregationOverTime(PromOperationId.SumOverTime),\n    createAggregationOverTime(PromOperationId.AvgOverTime),\n    createAggregationOverTime(PromOperationId.MinOverTime),\n    createAggregationOverTime(PromOperationId.MaxOverTime),\n    createAggregationOverTime(PromOperationId.CountOverTime),\n    createAggregationOverTime(PromOperationId.LastOverTime),\n    createAggregationOverTime(PromOperationId.PresentOverTime),\n    createAggregationOverTime(PromOperationId.AbsentOverTime),\n    createAggregationOverTime(PromOperationId.StddevOverTime),\n  ];\n}\n\nfunction createAggregationOverTime(name: string): QueryBuilderOperationDef {\n  return {\n    id: name,\n    name: getPromOperationDisplayName(name),\n    params: [getRangeVectorParamDef()],\n    defaultParams: ['$__interval'],\n    alternativesKey: 'overtime function',\n    category: PromVisualQueryOperationCategory.RangeFunctions,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addOperationWithRangeVector,\n  };\n}\n\nfunction operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  let rangeVector = (model.params ?? [])[0] ?? '$__interval';\n  return `${def.id}(${innerExpr}[${rangeVector}])`;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/LokiAndPromQueryModellerBase.ts\nimport { Registry } from '@grafana/data';\n\nimport { renderLabels } from './rendering/labels';\nimport { hasBinaryOp, renderOperations } from './rendering/operations';\nimport { renderQuery, renderBinaryQueries } from './rendering/query';\nimport { QueryBuilderLabelFilter, QueryBuilderOperation, QueryBuilderOperationDef, VisualQueryModeller } from './types';\n\nexport interface VisualQueryBinary<T> {\n  operator: string;\n  vectorMatchesType?: 'on' | 'ignoring';\n  vectorMatches?: string;\n  query: T;\n}\n\nexport interface PromLokiVisualQuery {\n  metric?: string;\n  labels: QueryBuilderLabelFilter[];\n  operations: QueryBuilderOperation[];\n  binaryQueries?: Array<VisualQueryBinary<PromLokiVisualQuery>>;\n}\n\nexport abstract class LokiAndPromQueryModellerBase implements VisualQueryModeller {\n  protected operationsRegistry: Registry<QueryBuilderOperationDef>;\n  private categories: string[] = [];\n  private operationsMapCache: Map<string, QueryBuilderOperationDef> | null = null;\n\n  constructor(getOperations: () => QueryBuilderOperationDef[]) {\n    this.operationsRegistry = new Registry<QueryBuilderOperationDef>(getOperations);\n  }\n\n  private getOperationsMap(): Map<string, QueryBuilderOperationDef> {\n    if (!this.operationsMapCache) {\n      this.operationsMapCache = new Map<string, QueryBuilderOperationDef>();\n      this.operationsRegistry.list().forEach((op) => {\n        this.operationsMapCache!.set(op.id, op);\n      });\n    }\n    return this.operationsMapCache;\n  }\n\n  protected setOperationCategories(categories: string[]) {\n    this.categories = categories;\n  }\n\n  getOperationsForCategory(category: string) {\n    return this.operationsRegistry.list().filter((op) => op.category === category && !op.hideFromList);\n  }\n\n  getAlternativeOperations(key: string) {\n    return this.operationsRegistry.list().filter((op) => op.alternativesKey && op.alternativesKey === key);\n  }\n\n  getCategories() {\n    return this.categories;\n  }\n\n  getOperationDef(id: string): QueryBuilderOperationDef | undefined {\n    return this.operationsRegistry.getIfExists(id);\n  }\n\n  renderOperations(queryString: string, operations: QueryBuilderOperation[]) {\n    return renderOperations(queryString, operations, this.getOperationsMap());\n  }\n\n  renderBinaryQueries(queryString: string, binaryQueries?: Array<VisualQueryBinary<PromLokiVisualQuery>>) {\n    return renderBinaryQueries(queryString, binaryQueries);\n  }\n\n  renderLabels(labels: QueryBuilderLabelFilter[]) {\n    return renderLabels(labels);\n  }\n\n  renderQuery(query: PromLokiVisualQuery, nested?: boolean) {\n    return renderQuery(query, nested, this.getOperationsMap());\n  }\n\n  hasBinaryOp(query: PromLokiVisualQuery): boolean {\n    return hasBinaryOp(query, this.getOperationsMap());\n  }\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/PromQueryModeller.ts\nimport { FUNCTIONS } from '../promql';\n\nimport { getAggregationOperations } from './aggregations';\nimport { getOperationDefinitions } from './operations';\nimport { LokiAndPromQueryModellerBase } from './shared/LokiAndPromQueryModellerBase';\nimport {\n  PromQueryPattern,\n  PromQueryPatternType,\n  PromVisualQueryOperationCategory,\n  PromQueryModellerInterface,\n} from './types';\n\nexport class PromQueryModeller extends LokiAndPromQueryModellerBase implements PromQueryModellerInterface {\n  constructor() {\n    super(() => {\n      const allOperations = [...getOperationDefinitions(), ...getAggregationOperations()];\n      for (const op of allOperations) {\n        const func = FUNCTIONS.find((x) => x.insertText === op.id);\n        if (func) {\n          op.documentation = func.documentation;\n        }\n      }\n      return allOperations;\n    });\n\n    this.setOperationCategories([\n      PromVisualQueryOperationCategory.Aggregations,\n      PromVisualQueryOperationCategory.RangeFunctions,\n      PromVisualQueryOperationCategory.Functions,\n      PromVisualQueryOperationCategory.BinaryOps,\n      PromVisualQueryOperationCategory.Trigonometric,\n      PromVisualQueryOperationCategory.Time,\n    ]);\n  }\n\n  getQueryPatterns(): PromQueryPattern[] {\n    return [\n      {\n        name: 'Rate then sum',\n        type: PromQueryPatternType.Rate,\n        operations: [\n          { id: 'rate', params: ['$__rate_interval'] },\n          { id: 'sum', params: [] },\n        ],\n      },\n      {\n        name: 'Rate then sum by(label) then avg',\n        type: PromQueryPatternType.Rate,\n        operations: [\n          { id: 'rate', params: ['$__rate_interval'] },\n          { id: '__sum_by', params: [''] },\n          { id: 'avg', params: [] },\n        ],\n      },\n      {\n        name: 'Histogram quantile on rate',\n        type: PromQueryPatternType.Histogram,\n        operations: [\n          { id: 'rate', params: ['$__rate_interval'] },\n          { id: '__sum_by', params: ['le'] },\n          { id: 'histogram_quantile', params: [0.95] },\n        ],\n      },\n      {\n        name: 'Histogram quantile on increase',\n        type: PromQueryPatternType.Histogram,\n        operations: [\n          { id: 'increase', params: ['$__rate_interval'] },\n          { id: '__max_by', params: ['le'] },\n          { id: 'histogram_quantile', params: [0.95] },\n        ],\n      },\n      {\n        name: 'Binary Query',\n        type: PromQueryPatternType.Binary,\n        operations: [\n          { id: 'rate', params: ['$__rate_interval'] },\n          { id: 'sum', params: [] },\n        ],\n        binaryQueries: [\n          {\n            operator: '/',\n            query: {\n              metric: '',\n              labels: [],\n              operations: [\n                { id: 'rate', params: ['$__rate_interval'] },\n                { id: 'sum', params: [] },\n              ],\n            },\n          },\n        ],\n      },\n    ];\n  }\n}\n","import { PromQueryModeller } from '../PromQueryModeller';\nimport { PromQueryModellerInterface } from '../types';\n\n/**\n * This singleton instance of the Prometheus query modeller is a central point\n * for accessing the query modeller functionality while avoiding circular\n * dependencies in the codebase.\n */\n\nexport const promQueryModeller: PromQueryModellerInterface = new PromQueryModeller();\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderExplained.tsx\nimport { memo } from 'react';\n\nimport { Stack } from '@grafana/ui';\n\nimport promqlGrammar from '../../promql';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { OperationExplainedBox } from '../shared/OperationExplainedBox';\nimport { OperationListExplained } from '../shared/OperationListExplained';\nimport { RawQuery } from '../shared/RawQuery';\nimport { promQueryModeller } from '../shared/modeller_instance';\nimport { PromVisualQuery } from '../types';\n\nexport const EXPLAIN_LABEL_FILTER_CONTENT = 'Fetch all series matching metric name and label filters.';\n\nexport interface PromQueryBuilderExplainedProps {\n  query: string;\n}\n\nexport const PromQueryBuilderExplained = memo<PromQueryBuilderExplainedProps>(({ query }) => {\n  const visQuery = buildVisualQueryFromString(query || '').query;\n  const lang = { grammar: promqlGrammar, name: 'promql' };\n\n  return (\n    <Stack gap={0.5} direction=\"column\">\n      <OperationExplainedBox\n        stepNumber={1}\n        title={<RawQuery query={`${promQueryModeller.renderQuery(visQuery)}`} lang={lang} />}\n      >\n        {EXPLAIN_LABEL_FILTER_CONTENT}\n      </OperationExplainedBox>\n      <OperationListExplained<PromVisualQuery>\n        stepNumber={2}\n        queryModeller={promQueryModeller}\n        query={visQuery}\n        lang={lang}\n      />\n    </Stack>\n  );\n});\n\nPromQueryBuilderExplained.displayName = 'PromQueryBuilderExplained';\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryCodeEditor.tsx\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { PromQueryField } from '../../components/PromQueryField';\nimport { PromQueryEditorProps } from '../../components/types';\n\nimport { PromQueryBuilderExplained } from './PromQueryBuilderExplained';\n\ntype PromQueryCodeEditorProps = PromQueryEditorProps & {\n  showExplain: boolean;\n};\n\nexport function PromQueryCodeEditor(props: PromQueryCodeEditorProps) {\n  const { query, datasource, range, onRunQuery, onChange, data, app, showExplain } = props;\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div\n      data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.queryField}\n      className={styles.wrapper}\n    >\n      <PromQueryField\n        datasource={datasource}\n        query={query}\n        range={range}\n        onRunQuery={onRunQuery}\n        onChange={onChange}\n        history={[]}\n        data={data}\n        app={app}\n      />\n      {showExplain && <PromQueryBuilderExplained query={query.expr} />}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    // This wrapper styling can be removed after the old PromQueryEditor is removed.\n    // This is removing margin bottom on the old legacy inline form styles\n    wrapper: css({\n      '.gf-form': {\n        marginBottom: 0,\n      },\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/AnnotationQueryEditor.tsx\n\nimport { memo } from 'react';\n\nimport { AnnotationQuery } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { EditorField, EditorRow, EditorRows, EditorSwitch } from '@grafana/plugin-ui';\nimport { AutoSizeInput, Input, Space } from '@grafana/ui';\n\nimport { PromQueryCodeEditor } from '../querybuilder/components/PromQueryCodeEditor';\nimport { PromQuery } from '../types';\n\nimport { PromQueryEditorProps } from './types';\n\ntype Props = PromQueryEditorProps & {\n  annotation?: AnnotationQuery<PromQuery>;\n  onAnnotationChange?: (annotation: AnnotationQuery<PromQuery>) => void;\n};\n\nconst PLACEHOLDER_TITLE = '{{alertname}}';\nconst PLACEHOLDER_TEXT = '{{instance}}';\nconst PLACEHOLDER_TAGS = 'label1,label2';\n\n/**\n * AnnotationQueryEditor component for Prometheus datasource.\n * Allows users to configure annotation queries with options for title, tags, text format,\n * and timestamp settings.\n */\nexport const AnnotationQueryEditor = memo(function AnnotationQueryEditor(props: Props) {\n  const { annotation, onAnnotationChange, onChange, onRunQuery, query } = props;\n\n  if (!annotation || !onAnnotationChange) {\n    return (\n      <h3>\n        <Trans i18nKey=\"grafana-prometheus.components.annotation-query-editor.annotation-data-load-error\">\n          Annotation data load error!\n        </Trans>\n      </h3>\n    );\n  }\n\n  const handleMinStepChange = (value: string) => {\n    onChange({ ...query, interval: value });\n  };\n\n  const handleTitleChange = (value: string) => {\n    onAnnotationChange({\n      ...annotation,\n      titleFormat: value,\n    });\n  };\n\n  const handleTagsChange = (value: string) => {\n    onAnnotationChange({\n      ...annotation,\n      tagKeys: value,\n    });\n  };\n\n  const handleTextChange = (value: string) => {\n    onAnnotationChange({\n      ...annotation,\n      textFormat: value,\n    });\n  };\n\n  const handleUseValueForTimeChange = (checked: boolean) => {\n    onAnnotationChange({\n      ...annotation,\n      useValueForTime: checked,\n    });\n  };\n\n  return (\n    <>\n      <EditorRows>\n        <PromQueryCodeEditor {...props} query={query} showExplain={false} onRunQuery={onRunQuery} onChange={onChange} />\n        <EditorRow>\n          <EditorField\n            label={t('grafana-prometheus.components.annotation-query-editor.label-min-step', 'Min step')}\n            tooltip={\n              <Trans\n                i18nKey=\"grafana-prometheus.components.annotation-query-editor.tooltip-min-step\"\n                values={{ intervalVar: '$__interval', rateIntervalVar: '$__rate_interval' }}\n              >\n                An additional lower limit for the step parameter of the Prometheus query and for the{' '}\n                <code>{'{{intervalVar}}'}</code> and <code>{'{{rateIntervalVar}}'}</code> variables.\n              </Trans>\n            }\n          >\n            <AutoSizeInput\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.annotation-query-editor.aria-label-lower-limit-parameter',\n                'Set lower limit for the step parameter'\n              )}\n              placeholder={t('grafana-prometheus.components.annotation-query-editor.placeholder-auto', 'auto')}\n              minWidth={10}\n              value={query.interval ?? ''}\n              onChange={(e) => handleMinStepChange(e.currentTarget.value)}\n              id={selectors.components.DataSource.Prometheus.annotations.minStep}\n              data-testid={selectors.components.DataSource.Prometheus.annotations.minStep}\n            />\n          </EditorField>\n        </EditorRow>\n      </EditorRows>\n      <Space v={0.5} />\n      <EditorRow>\n        <EditorField\n          label={t('grafana-prometheus.components.annotation-query-editor.label-title', 'Title')}\n          tooltip={t(\n            'grafana-prometheus.components.annotation-query-editor.tooltip-either-pattern-example-instance-replaced-label',\n            'Use either the name or a pattern. For example, {{labelTemplate}} is replaced with label value for the label {{labelName}}.',\n            { labelName: 'instance', labelTemplate: '{{instance}}' }\n          )}\n        >\n          <Input\n            type=\"text\"\n            placeholder={PLACEHOLDER_TITLE}\n            value={annotation.titleFormat ?? ''}\n            onChange={(event) => handleTitleChange(event.currentTarget.value)}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.title}\n          />\n        </EditorField>\n        <EditorField label={t('grafana-prometheus.components.annotation-query-editor.label-tags', 'Tags')}>\n          <Input\n            type=\"text\"\n            placeholder={PLACEHOLDER_TAGS}\n            value={annotation.tagKeys ?? ''}\n            onChange={(event) => handleTagsChange(event.currentTarget.value)}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.tags}\n          />\n        </EditorField>\n        <EditorField\n          label={t('grafana-prometheus.components.annotation-query-editor.label-text', 'Text')}\n          tooltip={t(\n            'grafana-prometheus.components.annotation-query-editor.tooltip-either-pattern-example-instance-replaced-label',\n            'Use either the name or a pattern. For example, {{labelTemplate}} is replaced with label value for the label {{labelName}}.',\n            { labelName: 'instance', labelTemplate: '{{instance}}' }\n          )}\n        >\n          <Input\n            type=\"text\"\n            placeholder={PLACEHOLDER_TEXT}\n            value={annotation.textFormat ?? ''}\n            onChange={(event) => handleTextChange(event.currentTarget.value)}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.text}\n          />\n        </EditorField>\n        <EditorField\n          label={t(\n            'grafana-prometheus.components.annotation-query-editor.label-series-value-as-timestamp',\n            'Series value as timestamp'\n          )}\n          tooltip={t(\n            'grafana-prometheus.components.annotation-query-editor.tooltip-timestamp-milliseconds-series-value-seconds-multiply',\n            'The unit of timestamp is milliseconds. If the unit of the series value is seconds, multiply its range vector by 1000.'\n          )}\n        >\n          <EditorSwitch\n            value={annotation.useValueForTime ?? false}\n            onChange={(event) => handleUseValueForTimeChange(event.currentTarget.checked)}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.seriesValueAsTimestamp}\n          />\n        </EditorField>\n      </EditorRow>\n    </>\n  );\n});\n","import { Observable, of } from 'rxjs';\n\nimport {\n  AnnotationEvent,\n  AnnotationQuery,\n  AnnotationSupport,\n  DataFrame,\n  rangeUtil,\n  renderLegendFormat,\n} from '@grafana/data';\n\nimport { AnnotationQueryEditor } from './components/AnnotationQueryEditor';\nimport { PrometheusDatasource } from './datasource';\nimport { PromQuery } from './types';\n\nconst ANNOTATION_QUERY_STEP_DEFAULT = '60s';\n\nexport const PrometheusAnnotationSupport = (ds: PrometheusDatasource): AnnotationSupport<PromQuery> => {\n  return {\n    QueryEditor: AnnotationQueryEditor,\n    prepareAnnotation(json: AnnotationQuery<PromQuery>): AnnotationQuery<PromQuery> {\n      // Initialize target if it doesn't exist\n      if (!json.target) {\n        json.target = {\n          expr: '',\n          refId: 'Anno',\n        };\n      }\n\n      // Create a new target, preserving existing values when present\n      json.target = {\n        ...json.target,\n        refId: json.target.refId || json.refId || 'Anno',\n        expr: json.target.expr || json.expr || '',\n        interval: json.target.interval || json.step || '',\n      };\n\n      // Remove properties that have been transferred to target\n      delete json.expr;\n      delete json.step;\n\n      return json;\n    },\n    processEvents(anno: AnnotationQuery<PromQuery>, frames: DataFrame[]): Observable<AnnotationEvent[] | undefined> {\n      if (!frames.length) {\n        return new Observable<undefined>();\n      }\n\n      const { tagKeys = '', titleFormat = '', textFormat = '' } = anno;\n\n      const input = frames[0].meta?.executedQueryString || '';\n      const regex = /Step:\\s*([\\d\\w]+)/;\n      const match = input.match(regex);\n      const stepValue = match ? match[1] : null;\n      const step = rangeUtil.intervalToSeconds(stepValue || ANNOTATION_QUERY_STEP_DEFAULT) * 1000;\n      const tagKeysArray = tagKeys.split(',');\n\n      const eventList: AnnotationEvent[] = [];\n\n      for (const frame of frames) {\n        if (frame.fields.length === 0) {\n          continue;\n        }\n        const timeField = frame.fields[0];\n        const valueField = frame.fields[1];\n        const labels = valueField?.labels || {};\n\n        const tags = Object.keys(labels)\n          .filter((label) => tagKeysArray.includes(label))\n          .map((label) => labels[label]);\n\n        const timeValueTuple: Array<[number, number]> = [];\n\n        let idx = 0;\n        valueField.values.forEach((value: string) => {\n          let timeStampValue: number;\n          let valueValue: number;\n          const time = timeField.values[idx];\n\n          // If we want to use value as a time, we use value as timeStampValue and valueValue will be 1\n          if (anno.useValueForTime) {\n            timeStampValue = Math.floor(parseFloat(value));\n            valueValue = 1;\n          } else {\n            timeStampValue = Math.floor(parseFloat(time));\n            valueValue = parseFloat(value);\n          }\n\n          idx++;\n          timeValueTuple.push([timeStampValue, valueValue]);\n        });\n\n        const activeValues = timeValueTuple.filter((value) => value[1] > 0);\n        const activeValuesTimestamps = activeValues.map((value) => value[0]);\n\n        // Instead of creating singular annotation for each active event we group events into region if they are less\n        // or equal to `step` apart.\n        let latestEvent: AnnotationEvent | null = null;\n\n        for (const timestamp of activeValuesTimestamps) {\n          // We already have event `open` and we have new event that is inside the `step` so we just update the end.\n          if (latestEvent && (latestEvent.timeEnd ?? 0) + step >= timestamp) {\n            latestEvent.timeEnd = timestamp;\n            continue;\n          }\n\n          // Event exists but new one is outside of the `step` so we add it to eventList.\n          if (latestEvent) {\n            eventList.push(latestEvent);\n          }\n\n          // We start a new region.\n          latestEvent = {\n            time: timestamp,\n            timeEnd: timestamp,\n            annotation: anno,\n            title: renderLegendFormat(titleFormat, labels),\n            tags,\n            text: renderLegendFormat(textFormat, labels),\n          };\n        }\n\n        // Finish up last point if we have one\n        if (latestEvent) {\n          latestEvent.timeEnd = activeValuesTimestamps[activeValuesTimestamps.length - 1];\n          eventList.push(latestEvent);\n        }\n      }\n\n      return of(eventList);\n    },\n  };\n};\n","import { TimeRange } from '@grafana/data';\nimport { BackendSrvRequest } from '@grafana/runtime';\n\nimport { getDefaultCacheHeaders } from './caching';\nimport { DEFAULT_SERIES_LIMIT, EMPTY_SELECTOR, MATCH_ALL_LABELS, METRIC_LABEL } from './constants';\nimport { PrometheusDatasource } from './datasource';\nimport { removeQuotesIfExist } from './language_provider';\nimport { getRangeSnapInterval, processHistogramMetrics } from './language_utils';\nimport { buildVisualQueryFromString } from './querybuilder/parsing';\nimport { PrometheusCacheLevel } from './types';\nimport { escapeForUtf8Support, utf8Support } from './utf8_support';\n\ntype PrometheusSeriesResponse = Array<{ [key: string]: string }>;\ntype PrometheusLabelsResponse = string[];\n\nexport interface ResourceApiClient {\n  metrics: string[];\n  histogramMetrics: string[];\n  labelKeys: string[];\n  cachedLabelValues: Record<string, string[]>;\n\n  start: (timeRange: TimeRange) => Promise<void>;\n\n  queryMetrics: (timeRange: TimeRange) => Promise<{ metrics: string[]; histogramMetrics: string[] }>;\n  queryLabelKeys: (timeRange: TimeRange, match?: string, limit?: number) => Promise<string[]>;\n  queryLabelValues: (timeRange: TimeRange, labelKey: string, match?: string, limit?: number) => Promise<string[]>;\n\n  querySeries: (timeRange: TimeRange, match: string, limit: number) => Promise<PrometheusSeriesResponse>;\n}\n\ntype RequestFn = (\n  url: string,\n  params?: Record<string, unknown>,\n  options?: Partial<BackendSrvRequest>\n) => Promise<unknown>;\n\nexport abstract class BaseResourceClient {\n  private seriesLimit: number;\n\n  constructor(\n    protected readonly request: RequestFn,\n    protected readonly datasource: PrometheusDatasource\n  ) {\n    this.seriesLimit = this.datasource.seriesLimit;\n  }\n\n  protected getEffectiveLimit(limit?: number): number {\n    return limit || this.seriesLimit;\n  }\n\n  protected async requestLabels(\n    url: string,\n    params?: Record<string, unknown>,\n    options?: Partial<BackendSrvRequest>\n  ): Promise<PrometheusLabelsResponse> {\n    const response = await this.request(url, params, options);\n    return Array.isArray(response) ? response : [];\n  }\n\n  protected async requestSeries(\n    url: string,\n    params?: Record<string, unknown>,\n    options?: Partial<BackendSrvRequest>\n  ): Promise<PrometheusSeriesResponse> {\n    const response = await this.request(url, params, options);\n    return Array.isArray(response) ? response : [];\n  }\n\n  /**\n   * Fetches all time series that match a specific label matcher using **series** endpoint.\n   *\n   * @param {TimeRange} timeRange - Time range to use for the query\n   * @param {string} match - Label matcher to filter time series\n   * @param {string} limit - Maximum number of series to return\n   */\n  public querySeries = async (timeRange: TimeRange, match: string | undefined, limit: number) => {\n    const effectiveMatch = !match || match === EMPTY_SELECTOR ? MATCH_ALL_LABELS : match;\n    const timeParams = this.datasource.getTimeRangeParams(timeRange);\n    const searchParams = { ...timeParams, 'match[]': effectiveMatch, limit };\n    return await this.requestSeries('/api/v1/series', searchParams, getDefaultCacheHeaders(this.datasource.cacheLevel));\n  };\n}\n\nexport class LabelsApiClient extends BaseResourceClient implements ResourceApiClient {\n  private _cache: ResourceClientsCache = new ResourceClientsCache(this.datasource.cacheLevel);\n\n  public histogramMetrics: string[] = [];\n  public metrics: string[] = [];\n  public labelKeys: string[] = [];\n  public cachedLabelValues: Record<string, string[]> = {};\n\n  start = async (timeRange: TimeRange) => {\n    await this.queryMetrics(timeRange);\n    this.labelKeys = await this.queryLabelKeys(timeRange);\n  };\n\n  public queryMetrics = async (timeRange: TimeRange): Promise<{ metrics: string[]; histogramMetrics: string[] }> => {\n    this.metrics = await this.queryLabelValues(timeRange, METRIC_LABEL);\n    this.histogramMetrics = processHistogramMetrics(this.metrics);\n    this._cache.setLabelValues(timeRange, undefined, DEFAULT_SERIES_LIMIT, this.metrics);\n    return { metrics: this.metrics, histogramMetrics: this.histogramMetrics };\n  };\n\n  /**\n   * Fetches all available label keys from Prometheus using labels endpoint.\n   * Uses the labels endpoint with optional match parameter for filtering.\n   *\n   * @param {TimeRange} timeRange - Time range to use for the query\n   * @param {string} match - Optional label matcher to filter results\n   * @param {string} limit - Maximum number of results to return\n   * @returns {Promise<string[]>} Array of label keys sorted alphabetically\n   */\n  public queryLabelKeys = async (timeRange: TimeRange, match?: string, limit?: number): Promise<string[]> => {\n    let url = '/api/v1/labels';\n    const timeParams = getRangeSnapInterval(this.datasource.cacheLevel, timeRange);\n    const effectiveLimit = this.getEffectiveLimit(limit);\n    const searchParams = { limit: effectiveLimit, ...timeParams, ...(match ? { 'match[]': match } : {}) };\n    const effectiveMatch = match ?? '';\n    const maybeCachedKeys = this._cache.getLabelKeys(timeRange, effectiveMatch, effectiveLimit);\n    if (maybeCachedKeys) {\n      return maybeCachedKeys;\n    }\n\n    const res = await this.requestLabels(url, searchParams, getDefaultCacheHeaders(this.datasource.cacheLevel));\n    if (Array.isArray(res)) {\n      this.labelKeys = res.slice().sort();\n      this._cache.setLabelKeys(timeRange, effectiveMatch, effectiveLimit, this.labelKeys);\n      return this.labelKeys.slice();\n    }\n\n    return [];\n  };\n\n  /**\n   * Fetches all values for a specific label key from Prometheus using labels values endpoint.\n   *\n   * @param {TimeRange} timeRange - Time range to use for the query\n   * @param {string} labelKey - The label key to fetch values for\n   * @param {string} match - Optional label matcher to filter results\n   * @param {string} limit - Maximum number of results to return\n   * @returns {Promise<string[]>} Array of label values\n   */\n  public queryLabelValues = async (\n    timeRange: TimeRange,\n    labelKey: string,\n    match?: string,\n    limit?: number\n  ): Promise<string[]> => {\n    const timeParams = this.datasource.getAdjustedInterval(timeRange);\n    const effectiveLimit = this.getEffectiveLimit(limit);\n    const searchParams = { limit: effectiveLimit, ...timeParams, ...(match ? { 'match[]': match } : {}) };\n    const interpolatedName = this.datasource.interpolateString(labelKey);\n    const interpolatedAndEscapedName = escapeForUtf8Support(removeQuotesIfExist(interpolatedName));\n    const effectiveMatch = `${match ?? ''}-${interpolatedAndEscapedName}`;\n    const maybeCachedValues = this._cache.getLabelValues(timeRange, effectiveMatch, effectiveLimit);\n    if (maybeCachedValues) {\n      return maybeCachedValues;\n    }\n\n    const url = `/api/v1/label/${interpolatedAndEscapedName}/values`;\n    const value = await this.requestLabels(url, searchParams, getDefaultCacheHeaders(this.datasource.cacheLevel));\n    this._cache.setLabelValues(timeRange, effectiveMatch, effectiveLimit, value ?? []);\n    return value ?? [];\n  };\n}\n\nexport class SeriesApiClient extends BaseResourceClient implements ResourceApiClient {\n  private _cache: ResourceClientsCache = new ResourceClientsCache(this.datasource.cacheLevel);\n\n  public histogramMetrics: string[] = [];\n  public metrics: string[] = [];\n  public labelKeys: string[] = [];\n  public cachedLabelValues: Record<string, string[]> = {};\n\n  start = async (timeRange: TimeRange) => {\n    await this.queryMetrics(timeRange);\n  };\n\n  public queryMetrics = async (timeRange: TimeRange): Promise<{ metrics: string[]; histogramMetrics: string[] }> => {\n    const series = await this.querySeries(timeRange, undefined, DEFAULT_SERIES_LIMIT);\n    const { metrics, labelKeys } = processSeries(series, METRIC_LABEL);\n    this.metrics = metrics;\n    this.histogramMetrics = processHistogramMetrics(this.metrics);\n    this.labelKeys = labelKeys;\n    this._cache.setLabelValues(timeRange, undefined, DEFAULT_SERIES_LIMIT, metrics);\n    this._cache.setLabelKeys(timeRange, undefined, DEFAULT_SERIES_LIMIT, labelKeys);\n    return { metrics: this.metrics, histogramMetrics: this.histogramMetrics };\n  };\n\n  public queryLabelKeys = async (timeRange: TimeRange, match?: string, limit?: number): Promise<string[]> => {\n    const effectiveLimit = this.getEffectiveLimit(limit);\n    const effectiveMatch = !match || match === EMPTY_SELECTOR ? undefined : match;\n    const maybeCachedKeys = this._cache.getLabelKeys(timeRange, effectiveMatch, effectiveLimit);\n    if (maybeCachedKeys) {\n      return maybeCachedKeys;\n    }\n\n    const series = await this.querySeries(timeRange, effectiveMatch, effectiveLimit);\n    const { labelKeys } = processSeries(series);\n    this._cache.setLabelKeys(timeRange, effectiveMatch, effectiveLimit, labelKeys);\n    return labelKeys;\n  };\n\n  public queryLabelValues = async (\n    timeRange: TimeRange,\n    labelKey: string,\n    match?: string,\n    limit?: number\n  ): Promise<string[]> => {\n    let effectiveMatch = '';\n    if (!match || match === EMPTY_SELECTOR) {\n      // Just and empty matcher {} or no matcher\n      effectiveMatch = `{${utf8Support(removeQuotesIfExist(labelKey))}!=\"\"}`;\n    } else {\n      const {\n        query: { metric, labels },\n      } = buildVisualQueryFromString(match);\n      labels.push({\n        label: removeQuotesIfExist(labelKey),\n        op: '!=',\n        value: '',\n      });\n      const metricFilter = metric ? `__name__=\"${metric}\",` : '';\n      const labelFilters = labels.map((lf) => `${utf8Support(lf.label)}${lf.op}\"${lf.value}\"`).join(',');\n      effectiveMatch = `{${metricFilter}${labelFilters}}`;\n    }\n\n    const effectiveLimit = this.getEffectiveLimit(limit);\n    const maybeCachedValues = this._cache.getLabelValues(timeRange, effectiveMatch, effectiveLimit);\n    if (maybeCachedValues) {\n      return maybeCachedValues;\n    }\n\n    const series = await this.querySeries(timeRange, effectiveMatch, effectiveLimit);\n    const { labelValues } = processSeries(series, removeQuotesIfExist(labelKey));\n    this._cache.setLabelValues(timeRange, effectiveMatch, effectiveLimit, labelValues);\n    return labelValues;\n  };\n}\n\nclass ResourceClientsCache {\n  private readonly MAX_CACHE_ENTRIES = 1000; // Maximum number of cache entries\n  private readonly MAX_CACHE_SIZE_BYTES = 50 * 1024 * 1024; // 50MB max cache size\n\n  private _cache: Record<string, string[]> = {};\n  private _accessTimestamps: Record<string, number> = {};\n\n  constructor(private cacheLevel: PrometheusCacheLevel = PrometheusCacheLevel.High) {}\n\n  public setLabelKeys(timeRange: TimeRange, match: string | undefined, limit: number, keys: string[]) {\n    if (keys.length === 0) {\n      return;\n    }\n    // Check and potentially clean cache before adding new entry\n    this.cleanCacheIfNeeded();\n    const cacheKey = this.getCacheKey(timeRange, match, limit, 'key');\n    this._cache[cacheKey] = keys.slice().sort();\n    this._accessTimestamps[cacheKey] = Date.now();\n  }\n\n  public getLabelKeys(timeRange: TimeRange, match: string | undefined, limit: number): string[] | undefined {\n    const cacheKey = this.getCacheKey(timeRange, match, limit, 'key');\n    const result = this._cache[cacheKey];\n    if (result) {\n      // Update access timestamp on cache hit\n      this._accessTimestamps[cacheKey] = Date.now();\n    }\n    return result;\n  }\n\n  public setLabelValues(timeRange: TimeRange, match: string | undefined, limit: number, values: string[]) {\n    if (values.length === 0) {\n      return;\n    }\n    // Check and potentially clean cache before adding new entry\n    this.cleanCacheIfNeeded();\n    const cacheKey = this.getCacheKey(timeRange, match, limit, 'value');\n    this._cache[cacheKey] = values.slice().sort();\n    this._accessTimestamps[cacheKey] = Date.now();\n  }\n\n  public getLabelValues(timeRange: TimeRange, match: string, limit: number): string[] | undefined {\n    const cacheKey = this.getCacheKey(timeRange, match, limit, 'value');\n    const result = this._cache[cacheKey];\n    if (result) {\n      // Update access timestamp on cache hit\n      this._accessTimestamps[cacheKey] = Date.now();\n    }\n    return result;\n  }\n\n  private getCacheKey(timeRange: TimeRange, match: string | undefined, limit: number, type: 'key' | 'value') {\n    const snappedTimeRange = getRangeSnapInterval(this.cacheLevel, timeRange);\n    return [snappedTimeRange.start, snappedTimeRange.end, limit, match, type].join('|');\n  }\n\n  private cleanCacheIfNeeded() {\n    // Check number of entries\n    const currentEntries = Object.keys(this._cache).length;\n    if (currentEntries >= this.MAX_CACHE_ENTRIES) {\n      // Calculate 20% of current entries, but ensure we remove at least 1 entry\n      const entriesToRemove = Math.max(1, Math.floor(currentEntries - this.MAX_CACHE_ENTRIES + 1));\n      this.removeOldestEntries(entriesToRemove);\n    }\n\n    // Check cache size in bytes\n    const currentSize = this.getCacheSizeInBytes();\n    if (currentSize > this.MAX_CACHE_SIZE_BYTES) {\n      // Calculate 20% of current entries, but ensure we remove at least 1 entry\n      const entriesToRemove = Math.max(1, Math.floor(Object.keys(this._cache).length * 0.2));\n      this.removeOldestEntries(entriesToRemove);\n    }\n  }\n\n  private getCacheSizeInBytes(): number {\n    let size = 0;\n    for (const key in this._cache) {\n      // Calculate size of key\n      size += key.length * 2; // Approximate size of string in bytes (UTF-16)\n\n      // Calculate size of value array\n      const value = this._cache[key];\n      for (const item of value) {\n        size += item.length * 2; // Approximate size of each string in bytes\n      }\n    }\n    return size;\n  }\n\n  private removeOldestEntries(count: number) {\n    // Get all entries sorted by timestamp (oldest first)\n    const entries = Object.entries(this._accessTimestamps).sort(\n      ([, timestamp1], [, timestamp2]) => timestamp1 - timestamp2\n    );\n\n    // Take the oldest 'count' entries\n    const entriesToRemove = entries.slice(0, count);\n\n    // Remove these entries from both cache and timestamps\n    for (const [key] of entriesToRemove) {\n      delete this._cache[key];\n      delete this._accessTimestamps[key];\n    }\n  }\n}\n\nexport function processSeries(series: Array<{ [key: string]: string }>, findValuesForKey?: string) {\n  const metrics: Set<string> = new Set();\n  const labelKeys: Set<string> = new Set();\n  const labelValues: Set<string> = new Set();\n\n  // Extract metrics and label keys\n  series.forEach((item) => {\n    // Add the __name__ value to metrics\n    if (METRIC_LABEL in item) {\n      metrics.add(item.__name__);\n    }\n\n    // Add all keys except __name__ to labelKeys\n    Object.keys(item).forEach((key) => {\n      if (key !== METRIC_LABEL) {\n        labelKeys.add(key);\n      }\n      if (findValuesForKey && key === findValuesForKey) {\n        labelValues.add(item[key]);\n      }\n    });\n  });\n\n  return {\n    metrics: Array.from(metrics).sort(),\n    labelKeys: Array.from(labelKeys).sort(),\n    labelValues: Array.from(labelValues).sort(),\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/language_provider.ts\nimport { once } from 'lodash';\nimport Prism from 'prismjs';\n\nimport {\n  AbstractLabelMatcher,\n  AbstractLabelOperator,\n  AbstractQuery,\n  AdHocVariableFilter,\n  getDefaultTimeRange,\n  LanguageProvider,\n  Scope,\n  scopeFilterOperatorMap,\n  ScopeSpecFilter,\n  TimeRange,\n} from '@grafana/data';\nimport { BackendSrvRequest } from '@grafana/runtime';\n\nimport { buildCacheHeaders, getDaysToCacheMetadata, getDefaultCacheHeaders } from './caching';\nimport { Label } from './components/monaco-query-field/monaco-completion-provider/situation';\nimport { DEFAULT_SERIES_LIMIT, EMPTY_SELECTOR, REMOVE_SERIES_LIMIT } from './constants';\nimport { PrometheusDatasource } from './datasource';\nimport {\n  extractLabelMatchers,\n  fixSummariesMetadata,\n  processHistogramMetrics,\n  processLabels,\n  toPromLikeQuery,\n} from './language_utils';\nimport PromqlSyntax from './promql';\nimport { buildVisualQueryFromString } from './querybuilder/parsing';\nimport { LabelsApiClient, ResourceApiClient, SeriesApiClient } from './resource_clients';\nimport { PromMetricsMetadata, PromQuery } from './types';\nimport { escapeForUtf8Support, isValidLegacyName } from './utf8_support';\n\nconst DEFAULT_KEYS = ['job', 'instance'];\n\n/**\n * Prometheus API endpoints for fetching resources\n */\nconst API_V1 = {\n  METADATA: '/api/v1/metadata',\n  SERIES: '/api/v1/series',\n  LABELS: '/api/v1/labels',\n  LABELS_VALUES: (labelKey: string) => `/api/v1/label/${labelKey}/values`,\n};\n\nexport interface PrometheusBaseLanguageProvider {\n  datasource: PrometheusDatasource;\n\n  /**\n   * When no timeRange provided, we will use the default time range (now/now-6h)\n   * @param timeRange\n   */\n  start: (timeRange?: TimeRange) => Promise<any[]>;\n\n  request: (url: string, params?: any, options?: Partial<BackendSrvRequest>) => Promise<any>;\n\n  fetchSuggestions: (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ) => Promise<string[]>;\n}\n\n/**\n * @deprecated This interface is deprecated and will be removed.\n */\nexport interface PrometheusLegacyLanguageProvider {\n  /**\n   * @deprecated Use retrieveHistogramMetrics() method instead\n   */\n  histogramMetrics: string[];\n  /**\n   * @deprecated Use retrieveMetrics() method instead\n   */\n  metrics: string[];\n  /**\n   * @deprecated Use retrieveMetricsMetadata() method instead\n   */\n  metricsMetadata?: PromMetricsMetadata;\n  /**\n   * @deprecated Use retrieveLabelKeys() method instead\n   */\n  labelKeys: string[];\n\n  /**\n   * @deprecated Use queryMetricsMetadata() method instead.\n   */\n  loadMetricsMetadata: () => void;\n  /**\n   * @deprecated Use retrieveMetricsMetadata() method instead\n   */\n  getLabelKeys: () => string[];\n  /**\n   * @deprecated If you need labelKeys or labelValues please use queryLabelKeys() or queryLabelValues() functions\n   */\n  getSeries: (timeRange: TimeRange, selector: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * @deprecated Use queryLabelValues() method insteadIt'll determine the right endpoint based on the datasource settings\n   */\n  fetchLabelValues: (range: TimeRange, key: string, limit?: string | number) => Promise<string[]>;\n  /**\n   * @deprecated Use queryLabelValues() method insteadIt'll determine the right endpoint based on the datasource settings\n   */\n  getLabelValues: (range: TimeRange, key: string) => Promise<string[]>;\n  /**\n   * @deprecated If you need labelKeys or labelValues please use queryLabelKeys() or queryLabelValues() functions\n   */\n  fetchLabels: (timeRange: TimeRange, queries?: PromQuery[], limit?: string) => Promise<string[]>;\n  /**\n   * @deprecated Use queryLabelValues() method insteadIt'll determine the right endpoint based on the datasource settings\n   */\n  getSeriesValues: (timeRange: TimeRange, labelName: string, selector: string) => Promise<string[]>;\n  /**\n   * @deprecated Use queryLabelValues() method insteadIt'll determine the right endpoint based on the datasource settings\n   */\n  fetchSeriesValuesWithMatch: (\n    timeRange: TimeRange,\n    name: string,\n    match?: string,\n    requestId?: string,\n    withLimit?: string | number\n  ) => Promise<string[]>;\n  /**\n   * @deprecated Use queryLabelKeys() method instead. It'll determine the right endpoint based on the datasource settings\n   */\n  getSeriesLabels: (timeRange: TimeRange, selector: string, otherLabels: Label[]) => Promise<string[]>;\n  /**\n   * @deprecated Use queryLabelKeys() method instead. It'll determine the right endpoint based on the datasource settings\n   */\n  fetchLabelsWithMatch: (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string | number\n  ) => Promise<Record<string, string[]>>;\n  /**\n   * @deprecated Use queryLabelKeys() method instead. It'll determine the right endpoint based on the datasource settings\n   */\n  fetchSeriesLabels: (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string | number\n  ) => Promise<Record<string, string[]>>;\n  /**\n   * @deprecated Use queryLabelKeys() method instead. It'll determine the right endpoint based on the datasource settings\n   */\n  fetchSeriesLabelsMatch: (\n    timeRange: TimeRange,\n    name: string,\n    withLimit?: string | number\n  ) => Promise<Record<string, string[]>>;\n  /**\n   * @deprecated If you need labelKeys or labelValues please use queryLabelKeys() or queryLabelValues() functions\n   */\n  fetchSeries: (timeRange: TimeRange, match: string) => Promise<Array<Record<string, string>>>;\n  /**\n   * @deprecated If you need labelKeys or labelValues please use queryLabelKeys() or queryLabelValues() functions\n   */\n  fetchDefaultSeries: (timeRange: TimeRange) => Promise<{}>;\n}\n\n/**\n * Old implementation of prometheus language provider.\n * @deprecated Use PrometheusLanguageProviderInterface and PrometheusLanguageProvider class instead.\n */\nexport default class PromQlLanguageProvider extends LanguageProvider implements PrometheusLegacyLanguageProvider {\n  declare startTask: Promise<any>;\n  declare labelFetchTs: number;\n\n  datasource: PrometheusDatasource;\n\n  histogramMetrics: string[];\n  metrics: string[];\n  metricsMetadata?: PromMetricsMetadata;\n  labelKeys: string[] = [];\n\n  constructor(datasource: PrometheusDatasource, initialValues?: Partial<PromQlLanguageProvider>) {\n    super();\n\n    this.datasource = datasource;\n    this.histogramMetrics = [];\n    this.metrics = [];\n\n    Object.assign(this, initialValues);\n  }\n\n  request = async (url: string, params = {}, options?: Partial<BackendSrvRequest>) => {\n    try {\n      const res = await this.datasource.metadataRequest(url, params, options);\n      return res.data.data;\n    } catch (error) {\n      if (!isCancelledError(error)) {\n        console.error(error);\n      }\n    }\n\n    return undefined;\n  };\n\n  /**\n   * Overridden by PrometheusLanguageProvider\n   */\n  start = async (timeRange: TimeRange = getDefaultTimeRange()): Promise<any[]> => {\n    if (this.datasource.lookupsDisabled) {\n      return [];\n    }\n\n    this.metrics = (await this.fetchLabelValues(timeRange, '__name__')) || [];\n    this.histogramMetrics = processHistogramMetrics(this.metrics).sort();\n    return Promise.all([this.loadMetricsMetadata(), this.fetchLabels(timeRange)]);\n  };\n\n  async loadMetricsMetadata() {\n    const secondsInDay = 86400;\n    const headers = buildCacheHeaders(getDaysToCacheMetadata(this.datasource.cacheLevel) * secondsInDay);\n    this.metricsMetadata = fixSummariesMetadata(\n      await this.request(\n        API_V1.METADATA,\n        {},\n        {\n          showErrorAlert: false,\n          ...headers,\n        }\n      )\n    );\n  }\n\n  getLabelKeys(): string[] {\n    return this.labelKeys;\n  }\n\n  async getSeries(timeRange: TimeRange, selector: string, withName?: boolean): Promise<Record<string, string[]>> {\n    if (this.datasource.lookupsDisabled) {\n      return {};\n    }\n    try {\n      if (selector === EMPTY_SELECTOR) {\n        return await this.fetchDefaultSeries(timeRange);\n      } else {\n        return await this.fetchSeriesLabels(timeRange, selector, withName, REMOVE_SERIES_LIMIT);\n      }\n    } catch (error) {\n      // TODO: better error handling\n      console.error(error);\n      return {};\n    }\n  }\n\n  fetchLabelValues = async (range: TimeRange, key: string, limit?: string | number): Promise<string[]> => {\n    const params = { ...this.datasource.getAdjustedInterval(range), ...(limit ? { limit } : {}) };\n    const interpolatedName = this.datasource.interpolateString(key);\n    const interpolatedAndEscapedName = escapeForUtf8Support(removeQuotesIfExist(interpolatedName));\n    const value = await this.request(\n      API_V1.LABELS_VALUES(interpolatedAndEscapedName),\n      params,\n      getDefaultCacheHeaders(this.datasource.cacheLevel)\n    );\n    return value ?? [];\n  };\n\n  async getLabelValues(range: TimeRange, key: string): Promise<string[]> {\n    return await this.fetchLabelValues(range, key);\n  }\n\n  /**\n   * Fetches all label keys\n   */\n  fetchLabels = async (timeRange: TimeRange, queries?: PromQuery[], limit?: string): Promise<string[]> => {\n    let url = API_V1.LABELS;\n    const timeParams = this.datasource.getAdjustedInterval(timeRange);\n    this.labelFetchTs = Date.now().valueOf();\n\n    const searchParams = new URLSearchParams({ ...timeParams, ...(limit ? { limit } : {}) });\n    queries?.forEach((q) => {\n      const visualQuery = buildVisualQueryFromString(q.expr);\n      if (visualQuery.query.metric !== '') {\n        const isUtf8Metric = !isValidLegacyName(visualQuery.query.metric);\n        searchParams.append('match[]', isUtf8Metric ? `{\"${visualQuery.query.metric}\"}` : visualQuery.query.metric);\n        if (visualQuery.query.binaryQueries) {\n          visualQuery.query.binaryQueries.forEach((bq) => {\n            searchParams.append('match[]', isUtf8Metric ? `{\"${bq.query.metric}\"}` : bq.query.metric);\n          });\n        }\n      }\n    });\n\n    if (this.datasource.httpMethod === 'GET') {\n      url += `?${searchParams.toString()}`;\n    }\n\n    const res = await this.request(url, searchParams, getDefaultCacheHeaders(this.datasource.cacheLevel));\n    if (Array.isArray(res)) {\n      this.labelKeys = res.slice().sort();\n      return [...this.labelKeys];\n    }\n\n    return [];\n  };\n\n  /**\n   * Gets series values\n   * Function to replace old getSeries calls in a way that will provide faster endpoints\n   * for new prometheus instances, while maintaining backward compatability\n   */\n  getSeriesValues = async (timeRange: TimeRange, labelName: string, selector: string): Promise<string[]> => {\n    if (!this.datasource.hasLabelsMatchAPISupport()) {\n      const data = await this.getSeries(timeRange, selector);\n      return data[removeQuotesIfExist(labelName)] ?? [];\n    }\n    return await this.fetchSeriesValuesWithMatch(timeRange, labelName, selector);\n  };\n\n  /**\n   * Fetches all values for a label, with optional match[]\n   */\n  fetchSeriesValuesWithMatch = async (\n    timeRange: TimeRange,\n    name: string,\n    match?: string,\n    requestId?: string,\n    withLimit?: string | number\n  ): Promise<string[]> => {\n    const interpolatedName = name ? this.datasource.interpolateString(name) : null;\n    const interpolatedMatch = match ? this.datasource.interpolateString(match) : null;\n    const range = this.datasource.getAdjustedInterval(timeRange);\n    const urlParams = {\n      ...range,\n      ...(interpolatedMatch && { 'match[]': interpolatedMatch }),\n      ...(withLimit ? { limit: withLimit } : {}),\n    };\n    let requestOptions: Partial<BackendSrvRequest> | undefined = {\n      ...getDefaultCacheHeaders(this.datasource.cacheLevel),\n      ...(requestId && { requestId }),\n    };\n\n    if (!Object.keys(requestOptions).length) {\n      requestOptions = undefined;\n    }\n\n    const interpolatedAndEscapedName = escapeForUtf8Support(removeQuotesIfExist(interpolatedName ?? ''));\n\n    const value = await this.request(API_V1.LABELS_VALUES(interpolatedAndEscapedName), urlParams, requestOptions);\n    return value ?? [];\n  };\n\n  /**\n   * Gets series labels\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability. The old API call got the labels and the values in a single query,\n   * but with the new query we need two calls, one to get the labels, and another to get the values.\n   */\n  getSeriesLabels = async (timeRange: TimeRange, selector: string, otherLabels: Label[]): Promise<string[]> => {\n    let possibleLabelNames, data: Record<string, string[]>;\n\n    if (!this.datasource.hasLabelsMatchAPISupport()) {\n      data = await this.getSeries(timeRange, selector);\n      possibleLabelNames = Object.keys(data); // all names from prometheus\n    } else {\n      // Exclude __name__ from output\n      otherLabels.push({ name: '__name__', value: '', op: '!=' });\n      data = await this.fetchSeriesLabelsMatch(timeRange, selector);\n      possibleLabelNames = Object.keys(data);\n    }\n\n    const usedLabelNames = new Set(otherLabels.map((l) => l.name)); // names used in the query\n    return possibleLabelNames.filter((l) => !usedLabelNames.has(l));\n  };\n\n  /**\n   * Fetch labels using the best endpoint that datasource supports.\n   * This is cached by its args but also by the global timeRange currently selected as they can change over requested time.\n   */\n  fetchLabelsWithMatch = async (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string | number\n  ): Promise<Record<string, string[]>> => {\n    if (this.datasource.hasLabelsMatchAPISupport()) {\n      return this.fetchSeriesLabelsMatch(timeRange, name, withLimit);\n    } else {\n      return this.fetchSeriesLabels(timeRange, name, withName, REMOVE_SERIES_LIMIT);\n    }\n  };\n\n  /**\n   * Fetch labels for a series using /series endpoint. This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabels = async (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string | number\n  ): Promise<Record<string, string[]>> => {\n    const interpolatedName = this.datasource.interpolateString(name);\n    const range = this.datasource.getAdjustedInterval(timeRange);\n    let urlParams = {\n      ...range,\n      'match[]': interpolatedName,\n      ...(withLimit !== 'none' ? { limit: withLimit ?? DEFAULT_SERIES_LIMIT } : {}),\n    };\n\n    const data = await this.request(API_V1.SERIES, urlParams, getDefaultCacheHeaders(this.datasource.cacheLevel));\n    const { values } = processLabels(data, withName);\n    return values;\n  };\n\n  /**\n   * Fetch labels for a series using /labels endpoint.  This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabelsMatch = async (\n    timeRange: TimeRange,\n    name: string,\n    withLimit?: string | number\n  ): Promise<Record<string, string[]>> => {\n    const interpolatedName = this.datasource.interpolateString(name);\n    const range = this.datasource.getAdjustedInterval(timeRange);\n    const urlParams = {\n      ...range,\n      'match[]': interpolatedName,\n      ...(withLimit ? { limit: withLimit } : {}),\n    };\n\n    const data: string[] = await this.request(\n      API_V1.LABELS,\n      urlParams,\n      getDefaultCacheHeaders(this.datasource.cacheLevel)\n    );\n    // Convert string array to Record<string , []>\n    return data.reduce((ac, a) => ({ ...ac, [a]: '' }), {});\n  };\n\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   */\n  fetchSeries = async (timeRange: TimeRange, match: string): Promise<Array<Record<string, string>>> => {\n    const range = this.datasource.getTimeRangeParams(timeRange);\n    const params = { ...range, 'match[]': match };\n    return await this.request(API_V1.SERIES, params, getDefaultCacheHeaders(this.datasource.cacheLevel));\n  };\n\n  /**\n   * Fetch this only one as we assume this won't change over time. This is cached differently from fetchSeriesLabels\n   * because we can cache more aggressively here and also we do not want to invalidate this cache the same way as in\n   * fetchSeriesLabels.\n   */\n  fetchDefaultSeries = once(async (timeRange: TimeRange) => {\n    const values = await Promise.all(DEFAULT_KEYS.map((key) => this.fetchLabelValues(timeRange, key)));\n    return DEFAULT_KEYS.reduce((acc, key, i) => ({ ...acc, [key]: values[i] }), {});\n  });\n\n  /**\n   * Fetch labels or values for a label based on the queries, scopes, filters and time range\n   */\n  fetchSuggestions = async (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ): Promise<string[]> => {\n    if (!timeRange) {\n      timeRange = getDefaultTimeRange();\n    }\n\n    const url = '/suggestions';\n    const timeParams = this.datasource.getAdjustedInterval(timeRange);\n    const value = await this.request(\n      url,\n      {\n        labelName,\n        queries: queries?.map((q) =>\n          this.datasource.interpolateString(q.expr, {\n            ...this.datasource.getIntervalVars(),\n            ...this.datasource.getRangeScopedVars(timeRange),\n          })\n        ),\n        scopes: scopes?.reduce<ScopeSpecFilter[]>((acc, scope) => {\n          acc.push(...scope.spec.filters);\n\n          return acc;\n        }, []),\n        adhocFilters: adhocFilters?.map((filter) => ({\n          key: filter.key,\n          operator: scopeFilterOperatorMap[filter.operator],\n          value: filter.value,\n          values: filter.values,\n        })),\n        limit,\n        ...timeParams,\n      },\n      {\n        ...(requestId && { requestId }),\n        headers: {\n          ...getDefaultCacheHeaders(this.datasource.cacheLevel)?.headers,\n          'Content-Type': 'application/json',\n        },\n        method: 'POST',\n      }\n    );\n\n    return value ?? [];\n  };\n}\n\nexport interface PrometheusLanguageProviderInterface\n  extends PrometheusBaseLanguageProvider,\n    PrometheusLegacyLanguageProvider {\n  retrieveMetricsMetadata: () => PromMetricsMetadata;\n  retrieveHistogramMetrics: () => string[];\n  retrieveMetrics: () => string[];\n  retrieveLabelKeys: () => string[];\n\n  queryMetricsMetadata: (limit?: number) => Promise<PromMetricsMetadata>;\n  queryLabelKeys: (timeRange: TimeRange, match?: string, limit?: number) => Promise<string[]>;\n  queryLabelValues: (timeRange: TimeRange, labelKey: string, match?: string, limit?: number) => Promise<string[]>;\n}\n\n/**\n * Modern implementation of the Prometheus language provider that abstracts API endpoint selection.\n *\n * Features:\n * - Automatically selects the most efficient API endpoint based on Prometheus version and configuration\n * - Supports both labels and series endpoints for backward compatibility\n * - Handles match[] parameters for filtering time series data\n * - Implements automatic request limiting (default: 40_000 series)\n * - Provides unified interface for both modern and legacy Prometheus versions\n *\n * @see LabelsApiClient For modern Prometheus versions using the labels API\n * @see SeriesApiClient For legacy Prometheus versions using the series API\n */\nexport class PrometheusLanguageProvider extends PromQlLanguageProvider implements PrometheusLanguageProviderInterface {\n  private _metricsMetadata?: PromMetricsMetadata;\n  private _resourceClient?: ResourceApiClient;\n\n  constructor(datasource: PrometheusDatasource) {\n    super(datasource);\n  }\n\n  /**\n   * Lazily initializes and returns the appropriate resource client based on Prometheus version.\n   *\n   * The client selection logic:\n   * - For Prometheus v2.6+ with labels API: Uses LabelsApiClient for efficient label-based queries\n   * - For older versions: Falls back to SeriesApiClient for backward compatibility\n   *\n   * The client instance is cached after first initialization to avoid repeated creation.\n   *\n   * @returns {ResourceApiClient} An instance of either LabelsApiClient or SeriesApiClient\n   */\n  private get resourceClient(): ResourceApiClient {\n    if (!this._resourceClient) {\n      this._resourceClient = this.datasource.hasLabelsMatchAPISupport()\n        ? new LabelsApiClient(this.request, this.datasource)\n        : new SeriesApiClient(this.request, this.datasource);\n    }\n\n    return this._resourceClient;\n  }\n\n  /**\n   * Same start logic but it uses resource clients. Backward compatibility it calls _backwardCompatibleStart.\n   * Some places still relies on deprecated fields. Until we replace them we need _backwardCompatibleStart method\n   */\n  start = async (timeRange: TimeRange = getDefaultTimeRange()): Promise<any[]> => {\n    if (this.datasource.lookupsDisabled) {\n      return [];\n    }\n    await Promise.all([this.resourceClient.start(timeRange), this.queryMetricsMetadata(this.datasource.seriesLimit)]);\n    return this._backwardCompatibleStart();\n  };\n\n  /**\n   * This private method exists to make sure the old class will be functional until we remove it.\n   * When we remove old class (PromQlLanguageProvider) we should remove this method too.\n   */\n  private _backwardCompatibleStart = async () => {\n    this.metricsMetadata = this.retrieveMetricsMetadata();\n    this.metrics = this.retrieveMetrics();\n    this.histogramMetrics = this.retrieveHistogramMetrics();\n    this.labelKeys = this.retrieveLabelKeys();\n    return [];\n  };\n\n  /**\n   * Fetches metadata for metrics from Prometheus.\n   * Sets cache headers based on the configured metadata cache duration.\n   *\n   * @returns {Promise<PromMetricsMetadata>} Promise that resolves when metadata has been fetched\n   */\n  private _queryMetadata = async (limit?: number): Promise<PromMetricsMetadata> => {\n    const secondsInDay = 86400;\n    const headers = buildCacheHeaders(getDaysToCacheMetadata(this.datasource.cacheLevel) * secondsInDay);\n    const metadata = await this.request(\n      API_V1.METADATA,\n      { limit: limit ?? this.datasource.seriesLimit },\n      {\n        showErrorAlert: false,\n        ...headers,\n      }\n    );\n    return fixSummariesMetadata(metadata);\n  };\n\n  /**\n   * Retrieves the cached Prometheus metrics metadata.\n   * This metadata includes type information (counter, gauge, etc.) and help text for metrics.\n   *\n   * @returns {PromMetricsMetadata} Cached metadata or empty object if not yet fetched\n   */\n  public retrieveMetricsMetadata = (): PromMetricsMetadata => {\n    return this._metricsMetadata ?? {};\n  };\n\n  /**\n   * Retrieves the list of histogram metrics from the current resource client.\n   * Histogram metrics are identified by the '_bucket' suffix and are used for percentile calculations.\n   *\n   * @returns {string[]} Array of histogram metric names\n   */\n  public retrieveHistogramMetrics = (): string[] => {\n    return this.resourceClient?.histogramMetrics;\n  };\n\n  /**\n   * Retrieves the complete list of available metrics from the current resource client.\n   * This includes all metric names regardless of their type (counter, gauge, histogram).\n   *\n   * @returns {string[]} Array of all metric names\n   */\n  public retrieveMetrics = (): string[] => {\n    return this.resourceClient?.metrics;\n  };\n\n  /**\n   * Retrieves the list of available label keys from the current resource client.\n   * Label keys are the names of labels that can be used to filter and group metrics.\n   *\n   * @returns {string[]} Array of label key names\n   */\n  public retrieveLabelKeys = (): string[] => {\n    return this.resourceClient?.labelKeys;\n  };\n\n  /**\n   * Fetches fresh metrics metadata from Prometheus and updates the cache.\n   * This includes querying for metric types, help text, and unit information.\n   * If the fetch fails, the cache is set to an empty object to prevent stale data.\n   *\n   * @returns {Promise<PromMetricsMetadata>} Promise that resolves to the fetched metadata\n   */\n  public queryMetricsMetadata = async (limit?: number): Promise<PromMetricsMetadata> => {\n    try {\n      this._metricsMetadata = (await this._queryMetadata(limit)) ?? {};\n    } catch (error) {\n      this._metricsMetadata = {};\n    }\n    return this._metricsMetadata;\n  };\n\n  /**\n   * Fetches all available label keys that match the specified criteria.\n   *\n   * This method queries Prometheus for label keys within the specified time range.\n   * The results can be filtered using the match parameter and limited in size.\n   * Uses either the labels API (Prometheus v2.6+) or series API based on version.\n   *\n   * @param {TimeRange} timeRange - Time range to search for label keys\n   * @param {string} [match] - Optional PromQL selector to filter label keys (e.g., '{job=\"grafana\"}')\n   * @param {string} [limit] - Optional maximum number of label keys to return\n   * @returns {Promise<string[]>} Array of matching label key names, sorted alphabetically\n   */\n  public queryLabelKeys = async (timeRange: TimeRange, match?: string, limit?: number): Promise<string[]> => {\n    const interpolatedMatch = match ? this.datasource.interpolateString(match) : match;\n    return await this.resourceClient.queryLabelKeys(timeRange, interpolatedMatch, limit);\n  };\n\n  /**\n   * Fetches all values for a specific label key that match the specified criteria.\n   *\n   * This method queries Prometheus for label values within the specified time range.\n   * Results can be filtered using the match parameter to find values in specific contexts.\n   * Supports both modern (labels API) and legacy (series API) Prometheus versions.\n   *\n   * The method automatically handles UTF-8 encoded label keys by properly escaping them\n   * before making API requests. This means you can safely pass label keys containing\n   * special characters like dots, colons, or Unicode characters (e.g., 'http.status:code',\n   * 's', 'response.time').\n   *\n   * @param {TimeRange} timeRange - Time range to search for label values\n   * @param {string} labelKey - The label key to fetch values for (e.g., 'job', 'instance', 'http.status:code')\n   * @param {string} [match] - Optional PromQL selector to filter values (e.g., '{job=\"grafana\"}')\n   * @param {string} [limit] - Optional maximum number of values to return\n   * @returns {Promise<string[]>} Array of matching label values, sorted alphabetically\n   * @example\n   * // Fetch all values for the 'job' label\n   * const values = await queryLabelValues(timeRange, 'job');\n   * // Fetch 'instance' values only for jobs matching 'grafana'\n   * const instances = await queryLabelValues(timeRange, 'instance', '{job=\"grafana\"}');\n   * // Fetch values for a label key with special characters\n   * const statusCodes = await queryLabelValues(timeRange, 'http.status:code');\n   */\n  public queryLabelValues = async (\n    timeRange: TimeRange,\n    labelKey: string,\n    match?: string,\n    limit?: number\n  ): Promise<string[]> => {\n    const interpolatedMatch = match ? this.datasource.interpolateString(match) : match;\n    return await this.resourceClient.queryLabelValues(\n      timeRange,\n      this.datasource.interpolateString(labelKey),\n      interpolatedMatch,\n      limit\n    );\n  };\n}\n\nexport const importFromAbstractQuery = (labelBasedQuery: AbstractQuery): PromQuery => {\n  return toPromLikeQuery(labelBasedQuery);\n};\n\nexport const exportToAbstractQuery = (query: PromQuery): AbstractQuery => {\n  const promQuery = query.expr;\n  if (!promQuery || promQuery.length === 0) {\n    return { refId: query.refId, labelMatchers: [] };\n  }\n  const tokens = Prism.tokenize(promQuery, PromqlSyntax);\n  const labelMatchers: AbstractLabelMatcher[] = extractLabelMatchers(tokens);\n  const nameLabelValue = getNameLabelValue(promQuery, tokens);\n  if (nameLabelValue && nameLabelValue.length > 0) {\n    labelMatchers.push({\n      name: '__name__',\n      operator: AbstractLabelOperator.Equal,\n      value: nameLabelValue,\n    });\n  }\n\n  return {\n    refId: query.refId,\n    labelMatchers,\n  };\n};\n\n/**\n * Checks if an error is a cancelled request error.\n * Used to avoid logging cancelled request errors.\n *\n * @param {unknown} error - Error to check\n * @returns {boolean} True if the error is a cancelled request error\n */\nfunction isCancelledError(error: unknown): error is {\n  cancelled: boolean;\n} {\n  return typeof error === 'object' && error !== null && 'cancelled' in error && error.cancelled === true;\n}\n\n/**\n * Removes quotes from a string if they exist.\n * Used to handle utf8 label keys in Prometheus queries.\n *\n * @param {string} input - Input string that may have surrounding quotes\n * @returns {string} String with surrounding quotes removed if they existed\n */\nexport function removeQuotesIfExist(input: string): string {\n  const match = input.match(/^\"(.*)\"$/); // extract the content inside the quotes\n  return match?.[1] ?? input;\n}\n\nfunction getNameLabelValue(promQuery: string, tokens: Array<string | Prism.Token>): string {\n  let nameLabelValue = '';\n\n  for (const token of tokens) {\n    if (typeof token === 'string') {\n      nameLabelValue = token;\n      break;\n    }\n  }\n  return nameLabelValue;\n}\n\n/**\n * Extracts metrics from queries and populates match parameters.\n * This is used to filter time series data based on existing queries.\n * Handles UTF8 metrics by properly escaping them.\n *\n * @param {PromQuery[]} queries - Array of Prometheus queries\n * @returns {string[]} Metric names as a regex matcher inside the array for easy handling\n */\nexport const populateMatchParamsFromQueries = (queries?: PromQuery[]): string[] => {\n  if (!queries) {\n    return [];\n  }\n\n  const metrics = (queries ?? []).reduce<string[]>((params, query) => {\n    const visualQuery = buildVisualQueryFromString(query.expr);\n    if (visualQuery.query.metric !== '') {\n      params.push(visualQuery.query.metric);\n    }\n    if (visualQuery.query.binaryQueries) {\n      visualQuery.query.binaryQueries.forEach((bq) => {\n        if (bq.query.metric !== '') {\n          params.push(bq.query.metric);\n        }\n      });\n    }\n    return params;\n  }, []);\n\n  return metrics.length === 0 ? [] : [`__name__=~\"${metrics.join('|')}\"`];\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/migrations/variableMigration.ts\nimport { buildVisualQueryFromString } from '../querybuilder/parsing';\nimport { promQueryModeller } from '../querybuilder/shared/modeller_instance';\nimport { PromVariableQuery, PromVariableQueryType as QueryType } from '../types';\n\nexport const PrometheusLabelNamesRegex = /^label_names\\(\\)\\s*$/;\nexport const PrometheusLabelValuesRegex = /^label_values\\((?:(.+),\\s*)?(.+)\\)\\s*$/;\nexport const PrometheusMetricNamesRegex = /^metrics\\((.+)\\)\\s*$/;\nexport const PrometheusQueryResultRegex = /^query_result\\((.+)\\)\\s*$/;\nexport const PrometheusLabelNamesRegexWithMatch = /^label_names\\((.+)\\)\\s*$/;\n\nexport function migrateVariableQueryToEditor(rawQuery: string | PromVariableQuery): PromVariableQuery {\n  // If not string, we assume PromVariableQuery\n  if (typeof rawQuery !== 'string') {\n    return rawQuery;\n  }\n\n  const queryBase = {\n    refId: 'PrometheusDatasource-VariableQuery',\n    qryType: QueryType.LabelNames,\n  };\n\n  const labelNamesMatchQuery = rawQuery.match(PrometheusLabelNamesRegexWithMatch);\n\n  if (labelNamesMatchQuery) {\n    return {\n      ...queryBase,\n      qryType: QueryType.LabelNames,\n      match: labelNamesMatchQuery[1],\n    };\n  }\n\n  const labelNames = rawQuery.match(PrometheusLabelNamesRegex);\n  if (labelNames) {\n    return {\n      ...queryBase,\n      qryType: QueryType.LabelNames,\n    };\n  }\n\n  const labelValuesCheck = rawQuery.match(/^label_values\\(/);\n  if (labelValuesCheck) {\n    const labelValues = rawQuery.match(PrometheusLabelValuesRegex);\n    const label = labelValues ? labelValues[2] : '';\n    const metric = labelValues ? labelValues[1] : '';\n\n    if (metric) {\n      const visQuery = buildVisualQueryFromString(metric);\n      return {\n        ...queryBase,\n        qryType: QueryType.LabelValues,\n        label,\n        metric: visQuery.query.metric,\n        labelFilters: visQuery.query.labels,\n      };\n    } else {\n      return {\n        ...queryBase,\n        qryType: QueryType.LabelValues,\n        label,\n      };\n    }\n  }\n\n  const metricNamesCheck = rawQuery.match(/^metrics\\(/);\n  if (metricNamesCheck) {\n    const metricNames = rawQuery.match(PrometheusMetricNamesRegex);\n    const metric = metricNames ? metricNames[1] : '';\n    return {\n      ...queryBase,\n      qryType: QueryType.MetricNames,\n      metric,\n    };\n  }\n\n  const queryResultCheck = rawQuery.match(/^query_result\\(/);\n  if (queryResultCheck) {\n    const queryResult = rawQuery.match(PrometheusQueryResultRegex);\n    const varQuery = queryResult ? queryResult[1] : '';\n    return {\n      ...queryBase,\n      qryType: QueryType.VarQueryResult,\n      varQuery,\n    };\n  }\n\n  // seriesQuery does not have a function and no regex above\n  if (!labelNames && !labelValuesCheck && !metricNamesCheck && !queryResultCheck) {\n    return {\n      ...queryBase,\n      qryType: QueryType.SeriesQuery,\n      seriesQuery: rawQuery,\n    };\n  }\n\n  return queryBase;\n}\n\n// migrate it back to a string with the correct variables in place\nexport function migrateVariableEditorBackToVariableSupport(QueryVariable: PromVariableQuery): string {\n  switch (QueryVariable.qryType) {\n    case QueryType.LabelNames:\n      if (QueryVariable.match) {\n        return `label_names(${QueryVariable.match})`;\n      }\n      return 'label_names()';\n    case QueryType.LabelValues:\n      if (QueryVariable.metric || (QueryVariable.labelFilters && QueryVariable.labelFilters.length !== 0)) {\n        const visualQueryQuery = {\n          metric: QueryVariable.metric ?? '',\n          labels: QueryVariable.labelFilters ?? [],\n          operations: [],\n        };\n\n        const metric = promQueryModeller.renderQuery(visualQueryQuery);\n        return `label_values(${metric},${QueryVariable.label})`;\n      } else {\n        return `label_values(${QueryVariable.label})`;\n      }\n    case QueryType.MetricNames:\n      return `metrics(${QueryVariable.metric})`;\n    case QueryType.VarQueryResult:\n      const varQuery = removeLineBreaks(QueryVariable.varQuery);\n      return `query_result(${varQuery})`;\n    case QueryType.SeriesQuery:\n      return QueryVariable.seriesQuery ?? '';\n    case QueryType.ClassicQuery:\n      return QueryVariable.classicQuery ?? '';\n  }\n\n  return '';\n}\n\n// allow line breaks in query result textarea\nfunction removeLineBreaks(input?: string) {\n  return input ? input.replace(/[\\r\\n]+/gm, '') : '';\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/metric_find_query.ts\nimport { map as _map } from 'lodash';\n\nimport { MetricFindValue, TimeRange } from '@grafana/data';\n\nimport { METRIC_LABEL } from './constants';\nimport { PrometheusDatasource } from './datasource';\nimport { getPrometheusTime } from './language_utils';\nimport {\n  PrometheusLabelNamesRegex,\n  PrometheusLabelNamesRegexWithMatch,\n  PrometheusLabelValuesRegex,\n  PrometheusMetricNamesRegex,\n  PrometheusQueryResultRegex,\n} from './migrations/variableMigration';\nimport { getOriginalMetricName } from './result_transformer';\n\nexport class PrometheusMetricFindQuery {\n  constructor(\n    private datasource: PrometheusDatasource,\n    private query: string\n  ) {\n    this.datasource = datasource;\n    this.query = query;\n  }\n\n  async process(timeRange: TimeRange): Promise<MetricFindValue[]> {\n    const labelNamesRegex = PrometheusLabelNamesRegex;\n    const labelNamesRegexWithMatch = PrometheusLabelNamesRegexWithMatch;\n    const labelValuesRegex = PrometheusLabelValuesRegex;\n    const metricNamesRegex = PrometheusMetricNamesRegex;\n    const queryResultRegex = PrometheusQueryResultRegex;\n    const labelNamesQuery = this.query.match(labelNamesRegex);\n    const labelNamesMatchQuery = this.query.match(labelNamesRegexWithMatch);\n\n    if (labelNamesMatchQuery) {\n      const selector = `{__name__=~\".*${labelNamesMatchQuery[1]}.*\"}`;\n      const keys = await this.datasource.languageProvider.queryLabelKeys(timeRange, selector);\n      return keys.filter((key) => key !== METRIC_LABEL).map((result) => ({ text: result }));\n    }\n\n    if (labelNamesQuery) {\n      return this.datasource.getTagKeys({ filters: [], timeRange });\n    }\n\n    const labelValuesQuery = this.query.match(labelValuesRegex);\n    if (labelValuesQuery) {\n      const filter = labelValuesQuery[1];\n      const label = labelValuesQuery[2];\n      if (isFilterDefined(filter)) {\n        return await this.labelValuesQuery(label, timeRange, filter);\n      } else {\n        // Exclude the filter part of the expression because it is blank or empty\n        return await this.labelValuesQuery(label, timeRange);\n      }\n    }\n\n    const metricNamesQuery = this.query.match(metricNamesRegex);\n    if (metricNamesQuery) {\n      return await this.metricNameQuery(metricNamesQuery[1], timeRange);\n    }\n\n    const queryResultQuery = this.query.match(queryResultRegex);\n    if (queryResultQuery) {\n      return this.queryResultQuery(queryResultQuery[1], timeRange);\n    }\n\n    // if query contains full metric name, return metric name and label list\n    const expressions = ['label_values()', 'metrics()', 'query_result()'];\n    if (!expressions.includes(this.query)) {\n      return await this.metricNameAndLabelsQuery(this.query, timeRange);\n    }\n\n    return Promise.resolve([]);\n  }\n\n  async labelValuesQuery(label: string, range: TimeRange, metric?: string) {\n    const values = await this.datasource.languageProvider.queryLabelValues(range, label, metric);\n    return values.map((value) => ({ text: value }));\n  }\n\n  async metricNameQuery(metricFilterPattern: string, range: TimeRange) {\n    const names = await this.datasource.languageProvider.queryLabelValues(\n      range,\n      METRIC_LABEL,\n      `{__name__=~\"${metricFilterPattern}\"}`\n    );\n    return names.map((n) => ({ text: n, expandable: true }));\n  }\n\n  queryResultQuery(query: string, range: TimeRange) {\n    const url = '/api/v1/query';\n    const params = {\n      query,\n      time: getPrometheusTime(range.to, true).toString(),\n    };\n    return this.datasource.metadataRequest(url, params).then((result) => {\n      switch (result.data.data.resultType) {\n        case 'scalar': // [ <unix_time>, \"<scalar_value>\" ]\n        case 'string': // [ <unix_time>, \"<string_value>\" ]\n          return [\n            {\n              text: result.data.data.result[1] || '',\n              expandable: false,\n            },\n          ];\n        case 'vector':\n          return _map(result.data.data.result, (metricData) => {\n            let text = metricData.metric.__name__ || '';\n            delete metricData.metric.__name__;\n            text +=\n              '{' +\n              _map(metricData.metric, (v, k) => {\n                return k + '=\"' + v + '\"';\n              }).join(',') +\n              '}';\n            text += ' ' + metricData.value[1] + ' ' + metricData.value[0] * 1000;\n\n            return {\n              text: text,\n              expandable: true,\n            };\n          });\n        default:\n          throw Error(`Unknown/Unhandled result type: [${result.data.data.resultType}]`);\n      }\n    });\n  }\n\n  async metricNameAndLabelsQuery(query: string, range: TimeRange): Promise<MetricFindValue[]> {\n    const start = getPrometheusTime(range.from, false);\n    const end = getPrometheusTime(range.to, true);\n    const params = {\n      'match[]': query,\n      start: start.toString(),\n      end: end.toString(),\n    };\n\n    const result = await this.datasource.metadataRequest(`/api/v1/series`, params);\n    return result.data.data.map((metric: Record<string, string>) => ({\n      text: getOriginalMetricName(metric),\n      expandable: true,\n    }));\n  }\n}\n\nfunction isFilterDefined(filter: string) {\n  // We consider blank strings or the empty filter {} as an undefined filter\n  return filter && filter.split(' ').join('') !== '{}';\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querycache/QueryCache.ts\nimport {\n  amendTable,\n  DataFrame,\n  DataQueryRequest,\n  dateTime,\n  durationToMilliseconds,\n  Field,\n  incrRoundDn,\n  isValidDuration,\n  parseDuration,\n  rangeUtil,\n  ScopedVars,\n  Table,\n  trimTable,\n} from '@grafana/data';\n\nimport { PromQuery } from '../types';\n\n// dashboardUID + panelId + refId\n// (must be stable across query changes, time range changes / interval changes / panel resizes / template variable changes)\ntype TargetIdent = string;\n\n// query + template variables + interval + raw time range\n// used for full target cache busting -> full range re-query\ntype TargetSignature = string;\ntype TimestampMs = number;\ntype SupportedQueryTypes = PromQuery;\ntype ApplyInterpolation = (str: string, scopedVars?: ScopedVars) => string;\n\n// string matching requirements defined in durationutil.ts\nexport const defaultPrometheusQueryOverlapWindow = '10m';\n\ninterface TargetCache {\n  signature: TargetSignature;\n  prevTo: TimestampMs;\n  frames: DataFrame[];\n}\n\nexport interface CacheRequestInfo<T extends SupportedQueryTypes> {\n  requests: Array<DataQueryRequest<T>>;\n  targetSignatures: Map<TargetIdent, TargetSignature>;\n  shouldCache: boolean;\n}\n\n/**\n * Get field identity\n * This is the string used to uniquely identify a field within a \"target\"\n * @param field\n */\nexport const getFieldIdentity = (field: Field) => `${field.type}|${field.name}|${JSON.stringify(field.labels ?? '')}`;\n\n/**\n * NOMENCLATURE\n * Target: The request target (DataQueryRequest), i.e. a specific query reference within a panel\n * Identity: the string that is not expected to change\n * Signature: the string that is expected to change, upon which we wipe the cache fields\n */\nexport class QueryCache<T extends SupportedQueryTypes> {\n  private overlapWindowMs: number;\n  private getTargetSignature: (request: DataQueryRequest<T>, target: T) => string;\n  private applyInterpolation = (str: string, scopedVars?: ScopedVars) => str;\n\n  cache = new Map<TargetIdent, TargetCache>();\n\n  constructor(options: {\n    getTargetSignature: (request: DataQueryRequest<T>, target: T) => string;\n    overlapString: string;\n    applyInterpolation?: ApplyInterpolation;\n  }) {\n    const unverifiedOverlap = options.overlapString;\n    if (isValidDuration(unverifiedOverlap)) {\n      const duration = parseDuration(unverifiedOverlap);\n      this.overlapWindowMs = durationToMilliseconds(duration);\n    } else {\n      const duration = parseDuration(defaultPrometheusQueryOverlapWindow);\n      this.overlapWindowMs = durationToMilliseconds(duration);\n    }\n\n    this.getTargetSignature = options.getTargetSignature;\n    if (options.applyInterpolation) {\n      this.applyInterpolation = options.applyInterpolation;\n    }\n  }\n\n  // can be used to change full range request to partial, split into multiple requests\n  requestInfo(request: DataQueryRequest<T>): CacheRequestInfo<T> {\n    // TODO: align from/to to interval to increase probability of hitting backend cache\n\n    const newFrom = request.range.from.valueOf();\n    const newTo = request.range.to.valueOf();\n\n    // only cache 'now'-relative queries (that can benefit from a backfill cache)\n    const shouldCache = request.rangeRaw?.to?.toString() === 'now';\n\n    // all targets are queried together, so we check for any that causes group cache invalidation & full re-query\n    let doPartialQuery = shouldCache;\n    let prevTo: TimestampMs | undefined = undefined;\n\n    // pre-compute reqTargetSignatures\n    const reqTargetSignatures = new Map<TargetIdent, TargetSignature>();\n    request.targets.forEach((target) => {\n      let targetIdentity = `${request.dashboardUID}|${request.panelId}|${target.refId}`;\n      let targetSignature = this.getTargetSignature(request, target); // ${request.maxDataPoints} ?\n      reqTargetSignatures.set(targetIdentity, targetSignature);\n    });\n\n    // figure out if new query range or new target props trigger full cache invalidation & re-query\n    for (const [targetIdentity, targetSignature] of reqTargetSignatures) {\n      let cached = this.cache.get(targetIdentity);\n      let cachedSig = cached?.signature;\n\n      if (cachedSig !== targetSignature) {\n        doPartialQuery = false;\n      } else {\n        // only do partial queries when new request range follows prior request range (possibly with overlap)\n        // e.g. now-6h with refresh <= 6h\n        prevTo = cached?.prevTo ?? Infinity;\n\n        doPartialQuery = newTo > prevTo && newFrom <= prevTo;\n      }\n\n      if (!doPartialQuery) {\n        break;\n      }\n    }\n\n    if (doPartialQuery && prevTo) {\n      // clamp to make sure we don't re-query previous 10m when newFrom is ahead of it (e.g. 5min range, 30s refresh)\n      let newFromPartial = Math.max(prevTo - this.overlapWindowMs, newFrom);\n\n      const newToDate = dateTime(newTo);\n      const newFromPartialDate = dateTime(incrRoundDn(newFromPartial, request.intervalMs));\n\n      // modify to partial query\n      request = {\n        ...request,\n        range: {\n          ...request.range,\n          from: newFromPartialDate,\n          to: newToDate,\n        },\n      };\n    } else {\n      reqTargetSignatures.forEach((targSig, targIdent) => {\n        this.cache.delete(targIdent);\n      });\n    }\n\n    return {\n      requests: [request],\n      targetSignatures: reqTargetSignatures,\n      shouldCache,\n    };\n  }\n\n  // should amend existing cache with new frames and return full response\n  procFrames(\n    request: DataQueryRequest<T>,\n    requestInfo: CacheRequestInfo<T> | undefined,\n    respFrames: DataFrame[]\n  ): DataFrame[] {\n    if (requestInfo?.shouldCache) {\n      const newFrom = request.range.from.valueOf();\n      const newTo = request.range.to.valueOf();\n\n      // group frames by targets\n      const respByTarget = new Map<TargetIdent, DataFrame[]>();\n\n      respFrames.forEach((frame: DataFrame) => {\n        let targetIdent = `${request.dashboardUID}|${request.panelId}|${frame.refId}`;\n\n        let frames = respByTarget.get(targetIdent);\n\n        if (!frames) {\n          frames = [];\n          respByTarget.set(targetIdent, frames);\n        }\n\n        frames.push(frame);\n      });\n\n      let outFrames: DataFrame[] = [];\n\n      respByTarget.forEach((respFrames, targetIdentity) => {\n        let cachedFrames = (targetIdentity ? this.cache.get(targetIdentity)?.frames : null) ?? [];\n\n        respFrames.forEach((respFrame: DataFrame) => {\n          // skip empty frames\n          if (respFrame.length === 0 || respFrame.fields.length === 0) {\n            return;\n          }\n\n          // frames are identified by their second (non-time) field's name + labels\n          // TODO: maybe also frame.meta.type?\n          let respFrameIdentity = getFieldIdentity(respFrame.fields[1]);\n\n          let cachedFrame = cachedFrames.find((cached) => getFieldIdentity(cached.fields[1]) === respFrameIdentity);\n\n          if (!cachedFrame) {\n            // append new unknown frames\n            cachedFrames.push(respFrame);\n          } else {\n            // we assume that fields cannot appear/disappear and will all exist in same order\n\n            // amend & re-cache\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            let prevTable: Table = cachedFrame.fields.map((field) => field.values) as Table;\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            let nextTable: Table = respFrame.fields.map((field) => field.values) as Table;\n\n            let amendedTable = amendTable(prevTable, nextTable);\n            if (amendedTable) {\n              for (let i = 0; i < amendedTable.length; i++) {\n                cachedFrame.fields[i].values = amendedTable[i];\n                if (cachedFrame.fields[i].config.displayNameFromDS !== respFrame.fields[i].config.displayNameFromDS) {\n                  cachedFrame.fields[i].config.displayNameFromDS = respFrame.fields[i].config.displayNameFromDS;\n                }\n              }\n              cachedFrame.length = cachedFrame.fields[0].values.length;\n            }\n          }\n        });\n\n        // trim all frames to in-view range, evict those that end up with 0 length\n        let nonEmptyCachedFrames: DataFrame[] = [];\n\n        cachedFrames.forEach((frame) => {\n          // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n          let table: Table = frame.fields.map((field) => field.values) as Table;\n\n          const dataPointStep = findDatapointStep(request, respFrames, this.applyInterpolation);\n\n          // query interval is greater than request.intervalMs, use query interval to make sure we've always got one datapoint outside the panel viewport\n          let trimmed = trimTable(table, newFrom - dataPointStep, newTo);\n\n          if (trimmed[0].length > 0) {\n            for (let i = 0; i < trimmed.length; i++) {\n              frame.fields[i].values = trimmed[i];\n            }\n            nonEmptyCachedFrames.push(frame);\n          }\n        });\n\n        this.cache.set(targetIdentity, {\n          signature: requestInfo.targetSignatures.get(targetIdentity)!,\n          frames: nonEmptyCachedFrames,\n          prevTo: newTo,\n        });\n\n        outFrames.push(...nonEmptyCachedFrames);\n      });\n\n      // transformV2 mutates field values for heatmap de-accum, and modifies field order, so we gotta clone here, for now :(\n      respFrames = outFrames.map((frame) => ({\n        ...frame,\n        fields: frame.fields.map((field) => ({\n          ...field,\n          config: {\n            ...field.config, // prevents mutatative exemplars links (re)enrichment\n          },\n          values: field.values.slice(),\n        })),\n      }));\n    }\n\n    return respFrames;\n  }\n}\n\nexport function findDatapointStep(\n  request: DataQueryRequest<PromQuery>,\n  respFrames: DataFrame[],\n  applyInterpolation: ApplyInterpolation\n): number {\n  // Prometheus specific logic below\n  if (request.targets[0].datasource?.type !== 'prometheus') {\n    return 0;\n  }\n\n  const target = request.targets.find((t) => t.refId === respFrames[0].refId);\n\n  let dataPointStep = request.intervalMs;\n  if (target?.interval) {\n    const minStepMs = rangeUtil.intervalToMs(applyInterpolation(target.interval));\n    if (minStepMs > request.intervalMs) {\n      dataPointStep = minStepMs;\n    }\n  }\n  return dataPointStep;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/tracking.ts\nimport { CoreApp, DataQueryRequest, DataQueryResponse } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\n\nimport { PromQuery } from './types';\n\nexport function trackQuery(\n  response: DataQueryResponse,\n  request: DataQueryRequest<PromQuery> & { targets: PromQuery[] },\n  startTime: Date\n): void {\n  const { app, targets: queries } = request;\n  // We only track queries run in Explore.\n  // We do not want to track queries from the dashboard, viewing a panel,\n  // cloud-alerting, unified-alerting, scenes and unknown\n  if (app !== CoreApp.Explore) {\n    return;\n  }\n\n  for (const query of queries) {\n    reportInteraction('grafana_prometheus_query_executed', {\n      app,\n      grafana_version: config.buildInfo.version,\n      has_data: response.data.some((frame) => frame.length > 0),\n      has_error: response.error !== undefined,\n      expr: query.expr,\n      format: query.format,\n      instant: query.instant,\n      range: query.range,\n      exemplar: query.exemplar,\n      hinting: query.hinting,\n      interval: query.interval,\n      intervalFactor: query.intervalFactor,\n      utcOffsetSec: query.utcOffsetSec,\n      legend: query.legendFormat,\n      valueWithRefId: query.valueWithRefId,\n      requestId: request.requestId,\n      showingGraph: query.showingGraph,\n      showingTable: query.showingTable,\n      editor_mode: query.editorMode,\n      simultaneously_sent_query_count: queries.length,\n      time_range_from: request?.range?.from?.toISOString(),\n      time_range_to: request?.range?.to?.toISOString(),\n      time_taken: Date.now() - startTime.getTime(),\n    });\n  }\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/LabelFilterItem.tsx\nimport debounce from 'debounce-promise';\nimport { useState } from 'react';\n\nimport { SelectableValue, toOption } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { AccessoryButton, InputGroup } from '@grafana/plugin-ui';\nimport { AsyncSelect, Select } from '@grafana/ui';\n\nimport { truncateResult } from '../../language_utils';\nimport { QueryBuilderLabelFilter } from '../shared/types';\n\nexport interface LabelFilterItemProps {\n  defaultOp: string;\n  item: Partial<QueryBuilderLabelFilter>;\n  onChange: (value: QueryBuilderLabelFilter) => void;\n  onGetLabelNames: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onGetLabelValues: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onDelete: () => void;\n  invalidLabel?: boolean;\n  invalidValue?: boolean;\n  getLabelValuesAutofillSuggestions: (query: string, labelName?: string) => Promise<SelectableValue[]>;\n  debounceDuration: number;\n}\n\nexport function LabelFilterItem({\n  item,\n  defaultOp,\n  onChange,\n  onDelete,\n  onGetLabelNames,\n  onGetLabelValues,\n  invalidLabel,\n  invalidValue,\n  getLabelValuesAutofillSuggestions,\n  debounceDuration,\n}: LabelFilterItemProps) {\n  const [state, setState] = useState<{\n    labelNames?: SelectableValue[];\n    labelValues?: SelectableValue[];\n    isLoadingLabelNames?: boolean;\n    isLoadingLabelValues?: boolean;\n  }>({});\n  // there's a bug in react-select where the menu doesn't recalculate its position when the options are loaded asynchronously\n  // see https://github.com/grafana/grafana/issues/63558\n  // instead, we explicitly control the menu visibility and prevent showing it until the options have fully loaded\n  const [labelNamesMenuOpen, setLabelNamesMenuOpen] = useState(false);\n  const [labelValuesMenuOpen, setLabelValuesMenuOpen] = useState(false);\n  const [allLabels, setAllLabels] = useState<SelectableValue[]>([]);\n\n  const isMultiSelect = (operator = item.op) => {\n    return operators.find((op) => op.label === operator)?.isMultiValue;\n  };\n\n  const getSelectOptionsFromString = (item?: string): string[] => {\n    if (item) {\n      const regExp = /\\(([^)]+)\\)/;\n      const matches = item?.match(regExp);\n\n      if (matches && matches[0].indexOf('|') > 0) {\n        return [item];\n      }\n\n      if (item.indexOf('|') > 0) {\n        return item.split('|');\n      }\n      return [item];\n    }\n    return [];\n  };\n\n  const labelValueSearch = debounce(\n    (query: string) => getLabelValuesAutofillSuggestions(query, item.label),\n    debounceDuration\n  );\n\n  /**\n   * Debounce a search through all the labels possible and truncate by .\n   */\n  const labelNamesSearch = debounce((query: string) => {\n    // we limit the select to show 1000 options,\n    // but we still search through all the possible options\n    const results = allLabels.filter((label) => {\n      return label.value.includes(query);\n    });\n    return truncateResult(results);\n  }, debounceDuration);\n\n  const itemValue = item?.value ?? '';\n\n  return (\n    <div key={itemValue} data-testid=\"prometheus-dimensions-filter-item\">\n      <InputGroup>\n        {/* Label name select, loads all values at once */}\n        <AsyncSelect\n          placeholder={t('grafana-prometheus.querybuilder.label-filter-item.placeholder-select-label', 'Select label')}\n          data-testid={selectors.components.QueryBuilder.labelSelect}\n          inputId=\"prometheus-dimensions-filter-item-key\"\n          width=\"auto\"\n          value={item.label ? toOption(item.label) : null}\n          allowCustomValue\n          onOpenMenu={async () => {\n            setState({ isLoadingLabelNames: true });\n            const labelNames = await onGetLabelNames(item);\n            // store all label names to allow for full label searching by typing in the select option, see loadOptions function labelNamesSearch\n            setAllLabels(labelNames);\n            setLabelNamesMenuOpen(true);\n            // truncate the results the same amount as the metric select\n            const truncatedLabelNames = truncateResult(labelNames);\n            setState({ labelNames: truncatedLabelNames, isLoadingLabelNames: undefined });\n          }}\n          onCloseMenu={() => {\n            setLabelNamesMenuOpen(false);\n          }}\n          isOpen={labelNamesMenuOpen}\n          isLoading={state.isLoadingLabelNames ?? false}\n          loadOptions={labelNamesSearch}\n          defaultOptions={state.labelNames}\n          onChange={(change) => {\n            if (change.label) {\n              onChange({\n                ...item,\n                op: item.op ?? defaultOp,\n                label: change.label,\n                // eslint-ignore\n              } as QueryBuilderLabelFilter);\n            }\n          }}\n          invalid={invalidLabel}\n        />\n\n        {/* Operator select i.e.   = =~ != !~   */}\n        <Select\n          data-testid={selectors.components.QueryBuilder.matchOperatorSelect}\n          className=\"query-segment-operator\"\n          value={toOption(item.op ?? defaultOp)}\n          options={operators}\n          width=\"auto\"\n          onChange={(change) => {\n            if (change.value != null) {\n              onChange({\n                ...item,\n                op: change.value,\n                value: isMultiSelect(change.value) ? item.value : getSelectOptionsFromString(item?.value)[0],\n                // eslint-ignore\n              } as QueryBuilderLabelFilter);\n            }\n          }}\n        />\n\n        {/* Label value async select: autocomplete calls prometheus API */}\n        <AsyncSelect\n          placeholder={t('grafana-prometheus.querybuilder.label-filter-item.placeholder-select-value', 'Select value')}\n          data-testid={selectors.components.QueryBuilder.valueSelect}\n          inputId=\"prometheus-dimensions-filter-item-value\"\n          width=\"auto\"\n          value={\n            isMultiSelect()\n              ? getSelectOptionsFromString(itemValue).map(toOption)\n              : getSelectOptionsFromString(itemValue).map(toOption)[0]\n          }\n          allowCustomValue\n          formatCreateLabel={(input) => input} // to avoid confusion, opt out of using the `defaultFormatCreateLabel`\n          createOptionPosition={item.op?.includes('~') ? 'first' : 'last'}\n          onOpenMenu={async () => {\n            setState({ isLoadingLabelValues: true });\n            const labelValues = await onGetLabelValues(item);\n            truncateResult(labelValues);\n            setLabelValuesMenuOpen(true);\n            setState({\n              ...state,\n              labelValues,\n              isLoadingLabelValues: undefined,\n            });\n          }}\n          onCloseMenu={() => {\n            setLabelValuesMenuOpen(false);\n          }}\n          isOpen={labelValuesMenuOpen}\n          defaultOptions={state.labelValues}\n          isMulti={isMultiSelect()}\n          isLoading={state.isLoadingLabelValues}\n          loadOptions={labelValueSearch}\n          onChange={(change) => {\n            if (change.value) {\n              onChange({\n                ...item,\n                value: change.value,\n                op: item.op ?? defaultOp,\n                // eslint-ignore\n              } as QueryBuilderLabelFilter);\n            } else {\n              const changes = change\n                .map((change: { label?: string }) => {\n                  return change.label;\n                })\n                .join('|');\n              // eslint-ignore\n              onChange({ ...item, value: changes, op: item.op ?? defaultOp } as QueryBuilderLabelFilter);\n            }\n          }}\n          invalid={invalidValue}\n        />\n        <AccessoryButton\n          aria-label={t('grafana-prometheus.querybuilder.label-filter-item.aria-label-remove', 'Remove {{name}}', {\n            name: item.label,\n          })}\n          icon=\"times\"\n          variant=\"secondary\"\n          onClick={onDelete}\n        />\n      </InputGroup>\n    </div>\n  );\n}\n\nconst operators = [\n  { label: '=', value: '=', isMultiValue: false },\n  { label: '!=', value: '!=', isMultiValue: false },\n  { label: '=~', value: '=~', isMultiValue: true },\n  { label: '!~', value: '!~', isMultiValue: true },\n];\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/LabelFilters.tsx\nimport { css, cx } from '@emotion/css';\nimport { isEqual } from 'lodash';\nimport { useEffect, useState } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { EditorField, EditorFieldGroup, EditorList } from '@grafana/plugin-ui';\nimport { InlineFieldRow, InlineLabel } from '@grafana/ui';\n\nimport { QueryBuilderLabelFilter } from '../shared/types';\n\nimport { LabelFilterItem } from './LabelFilterItem';\n\nexport const MISSING_LABEL_FILTER_ERROR_MESSAGE = 'Select at least 1 label filter (label and value)';\n\nexport interface LabelFiltersProps {\n  labelsFilters: QueryBuilderLabelFilter[];\n  onChange: (labelFilters: Array<Partial<QueryBuilderLabelFilter>>) => void;\n  onGetLabelNames: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  onGetLabelValues: (forLabel: Partial<QueryBuilderLabelFilter>) => Promise<SelectableValue[]>;\n  /** If set to true, component will show error message until at least 1 filter is selected */\n  labelFilterRequired?: boolean;\n  getLabelValuesAutofillSuggestions: (query: string, labelName?: string) => Promise<SelectableValue[]>;\n  debounceDuration: number;\n  variableEditor?: boolean;\n}\n\nexport function LabelFilters({\n  labelsFilters,\n  onChange,\n  onGetLabelNames,\n  onGetLabelValues,\n  labelFilterRequired,\n  getLabelValuesAutofillSuggestions,\n  debounceDuration,\n  variableEditor,\n}: LabelFiltersProps) {\n  const defaultOp = '=';\n  const [items, setItems] = useState<Array<Partial<QueryBuilderLabelFilter>>>([{ op: defaultOp }]);\n\n  useEffect(() => {\n    if (labelsFilters.length > 0) {\n      setItems(labelsFilters);\n    } else {\n      setItems([{ op: defaultOp }]);\n    }\n  }, [labelsFilters]);\n\n  const onLabelsChange = (newItems: Array<Partial<QueryBuilderLabelFilter>>) => {\n    setItems(newItems);\n\n    // Extract full label filters with both label & value\n    const newLabels = newItems.filter((x) => x.label != null && x.value != null);\n    if (!isEqual(newLabels, labelsFilters)) {\n      onChange(newLabels);\n    }\n  };\n\n  const hasLabelFilter = items.some((item) => item.label && item.value);\n\n  const editorList = () => {\n    return (\n      <EditorList\n        items={items}\n        onChange={onLabelsChange}\n        renderItem={(item: Partial<QueryBuilderLabelFilter>, onChangeItem, onDelete) => (\n          <LabelFilterItem\n            debounceDuration={debounceDuration}\n            item={item}\n            defaultOp={defaultOp}\n            onChange={onChangeItem}\n            onDelete={onDelete}\n            onGetLabelNames={onGetLabelNames}\n            onGetLabelValues={onGetLabelValues}\n            invalidLabel={labelFilterRequired && !item.label}\n            invalidValue={labelFilterRequired && !item.value}\n            getLabelValuesAutofillSuggestions={getLabelValuesAutofillSuggestions}\n          />\n        )}\n      />\n    );\n  };\n\n  return (\n    <>\n      {variableEditor ? (\n        <InlineFieldRow>\n          <div\n            className={cx(\n              css({\n                display: 'flex',\n              })\n            )}\n          >\n            <InlineLabel\n              width={20}\n              tooltip={\n                <div>\n                  <Trans i18nKey=\"grafana-prometheus.querybuilder.label-filters.tooltip-label-filters\">\n                    Optional: used to filter the metric select for this query type.\n                  </Trans>\n                </div>\n              }\n            >\n              <Trans i18nKey=\"grafana-prometheus.querybuilder.label-filters.label-filters\">Label filters</Trans>\n            </InlineLabel>\n            {editorList()}\n          </div>\n        </InlineFieldRow>\n      ) : (\n        <EditorFieldGroup>\n          <EditorField\n            label={t('grafana-prometheus.querybuilder.label-filters.label-label-filters', 'Label filters')}\n            error={MISSING_LABEL_FILTER_ERROR_MESSAGE}\n            invalid={labelFilterRequired && !hasLabelFilter}\n          >\n            {editorList()}\n          </EditorField>\n        </EditorFieldGroup>\n      )}\n    </>\n  );\n}\n","export const metricsModaltestIds = {\n  metricModal: 'metric-modal',\n  searchMetric: 'search-metric',\n  searchWithMetadata: 'search-with-metadata',\n  selectType: 'select-type',\n  metricCard: 'metric-card',\n  useMetric: 'use-metric',\n  searchPage: 'search-page',\n  resultsPerPage: 'results-per-page',\n  setUseBackend: 'set-use-backend',\n  showAdditionalSettings: 'show-additional-settings',\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/state/state.ts\nimport { PayloadAction, createSlice } from '@reduxjs/toolkit';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { PromVisualQuery } from '../../../types';\nimport { HaystackDictionary, MetricsData } from '../types';\n\nexport const DEFAULT_RESULTS_PER_PAGE = 100;\nexport const MAXIMUM_RESULTS_PER_PAGE = 1000;\n\n/**\n * Initial state for the metrics explorer\n * @returns\n */\nexport function initialState(query?: PromVisualQuery): MetricsModalState {\n  return {\n    isLoading: true,\n    metrics: [],\n    hasMetadata: true,\n    metaHaystackDictionary: {},\n    metaHaystackMatches: [],\n    metaHaystackOrder: [],\n    nameHaystackDictionary: {},\n    nameHaystackOrder: [],\n    nameHaystackMatches: [],\n    totalMetricCount: 0,\n    filteredMetricCount: null,\n    resultsPerPage: DEFAULT_RESULTS_PER_PAGE,\n    pageNum: 1,\n    fuzzySearchQuery: '',\n    fullMetaSearch: query?.fullMetaSearch ?? false,\n    includeNullMetadata: query?.includeNullMetadata ?? true,\n    selectedTypes: [],\n    useBackend: query?.useBackend ?? false,\n    disableTextWrap: query?.disableTextWrap ?? false,\n    showAdditionalSettings: false,\n  };\n}\n\n/**\n * The metrics explorer state object\n */\nexport interface MetricsModalState {\n  /** Used for the loading spinner */\n  isLoading: boolean;\n  /**\n   * Initial collection of metrics.\n   * The frontend filters do not impact this, but\n   * it is reduced by the backend search.\n   */\n  metrics: MetricsData;\n  /** Field for disabling type select and switches that rely on metadata */\n  hasMetadata: boolean;\n  /** Used to display metrics and help with fuzzy order */\n  nameHaystackDictionary: HaystackDictionary;\n  /** Used to sort name fuzzy search by relevance */\n  nameHaystackOrder: string[];\n  /** Used to highlight text in fuzzy matches */\n  nameHaystackMatches: string[];\n  /** Used to display metrics and help with fuzzy order for search across all metadata */\n  metaHaystackDictionary: HaystackDictionary;\n  /** Used to sort meta fuzzy search by relevance */\n  metaHaystackOrder: string[];\n  /** Used to highlight text in fuzzy matches */\n  metaHaystackMatches: string[];\n  /** Total results computed on initialization */\n  totalMetricCount: number;\n  /** Set after filtering metrics */\n  filteredMetricCount: number | null;\n  /** Pagination field for showing results in table */\n  resultsPerPage: number;\n  /** Pagination field */\n  pageNum: number;\n  /** The text query used to match metrics */\n  fuzzySearchQuery: string;\n  /** Enables the fuzzy meatadata search */\n  fullMetaSearch: boolean;\n  /** Includes results that are missing type and description */\n  includeNullMetadata: boolean;\n  /** Filter by prometheus type */\n  selectedTypes: Array<SelectableValue<string>>;\n  /** Filter by the series match endpoint instead of the fuzzy search */\n  useBackend: boolean;\n  /** Disable text wrap for descriptions in the results table */\n  disableTextWrap: boolean;\n  /** Display toggle switches for settings */\n  showAdditionalSettings: boolean;\n}\n\n/**\n * Type for the useEffect get metadata function\n */\nexport type MetricsModalMetadata = {\n  isLoading: boolean;\n  metrics: MetricsData;\n  hasMetadata: boolean;\n  metaHaystackDictionary: HaystackDictionary;\n  nameHaystackDictionary: HaystackDictionary;\n  totalMetricCount: number;\n  filteredMetricCount: number | null;\n};\n\n// for updating the settings in the PromQuery model\nexport function getSettings(visQuery: PromVisualQuery): MetricsModalSettings {\n  return {\n    useBackend: visQuery?.useBackend ?? false,\n    disableTextWrap: visQuery?.disableTextWrap ?? false,\n    fullMetaSearch: visQuery?.fullMetaSearch ?? false,\n    includeNullMetadata: visQuery.includeNullMetadata ?? false,\n  };\n}\n\nexport type MetricsModalSettings = {\n  useBackend?: boolean;\n  disableTextWrap?: boolean;\n  fullMetaSearch?: boolean;\n  includeNullMetadata?: boolean;\n};\n\nexport const stateSlice = createSlice({\n  name: 'metrics-modal-state',\n  initialState: initialState(),\n  reducers: {\n    filterMetricsBackend: (\n      state,\n      action: PayloadAction<{\n        metrics: MetricsData;\n        filteredMetricCount: number;\n        isLoading: boolean;\n      }>\n    ) => {\n      state.metrics = action.payload.metrics;\n      state.filteredMetricCount = action.payload.filteredMetricCount;\n      state.isLoading = action.payload.isLoading;\n    },\n    buildMetrics: (state, action: PayloadAction<MetricsModalMetadata>) => {\n      state.isLoading = action.payload.isLoading;\n      state.metrics = action.payload.metrics;\n      state.hasMetadata = action.payload.hasMetadata;\n      state.metaHaystackDictionary = action.payload.metaHaystackDictionary;\n      state.nameHaystackDictionary = action.payload.nameHaystackDictionary;\n      state.totalMetricCount = action.payload.totalMetricCount;\n      state.filteredMetricCount = action.payload.filteredMetricCount;\n    },\n    setIsLoading: (state, action: PayloadAction<boolean>) => {\n      state.isLoading = action.payload;\n    },\n    setFilteredMetricCount: (state, action: PayloadAction<number>) => {\n      state.filteredMetricCount = action.payload;\n    },\n    setResultsPerPage: (state, action: PayloadAction<number>) => {\n      state.resultsPerPage = action.payload;\n    },\n    setPageNum: (state, action: PayloadAction<number>) => {\n      state.pageNum = action.payload;\n    },\n    setFuzzySearchQuery: (state, action: PayloadAction<string>) => {\n      state.fuzzySearchQuery = action.payload;\n      state.pageNum = 1;\n    },\n    setNameHaystack: (state, action: PayloadAction<string[][]>) => {\n      state.nameHaystackOrder = action.payload[0];\n      state.nameHaystackMatches = action.payload[1];\n    },\n    setMetaHaystack: (state, action: PayloadAction<string[][]>) => {\n      state.metaHaystackOrder = action.payload[0];\n      state.metaHaystackMatches = action.payload[1];\n    },\n    setFullMetaSearch: (state, action: PayloadAction<boolean>) => {\n      state.fullMetaSearch = action.payload;\n      state.pageNum = 1;\n    },\n    setIncludeNullMetadata: (state, action: PayloadAction<boolean>) => {\n      state.includeNullMetadata = action.payload;\n      state.pageNum = 1;\n    },\n    setSelectedTypes: (state, action: PayloadAction<Array<SelectableValue<string>>>) => {\n      state.selectedTypes = action.payload;\n      state.pageNum = 1;\n    },\n    setUseBackend: (state, action: PayloadAction<boolean>) => {\n      state.useBackend = action.payload;\n      state.fullMetaSearch = false;\n      state.pageNum = 1;\n    },\n    setDisableTextWrap: (state) => {\n      state.disableTextWrap = !state.disableTextWrap;\n    },\n    showAdditionalSettings: (state) => {\n      state.showAdditionalSettings = !state.showAdditionalSettings;\n    },\n  },\n});\n\nexport const {\n  setIsLoading,\n  buildMetrics,\n  filterMetricsBackend,\n  setResultsPerPage,\n  setPageNum,\n  setFuzzySearchQuery,\n  setNameHaystack,\n  setMetaHaystack,\n  setFullMetaSearch,\n  setIncludeNullMetadata,\n  setSelectedTypes,\n  setUseBackend,\n  setDisableTextWrap,\n  showAdditionalSettings,\n  setFilteredMetricCount,\n} = stateSlice.actions;\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/state/helpers.ts\nimport { AnyAction } from '@reduxjs/toolkit';\n\nimport { reportInteraction } from '@grafana/runtime';\n\nimport { PrometheusDatasource } from '../../../../datasource';\nimport { PromMetricsMetadata } from '../../../../types';\nimport { regexifyLabelValuesQueryString } from '../../../parsingUtils';\nimport { QueryBuilderLabelFilter } from '../../../shared/types';\nimport { PromVisualQuery } from '../../../types';\nimport { HaystackDictionary, MetricData, MetricsData, PromFilterOption } from '../types';\n\nimport { MetricsModalMetadata, MetricsModalState, setFilteredMetricCount } from './state';\nexport async function setMetrics(\n  datasource: PrometheusDatasource,\n  query: PromVisualQuery,\n  initialMetrics?: string[]\n): Promise<MetricsModalMetadata> {\n  // metadata is set in the metric select now\n  // use this to disable metadata search and display\n  let hasMetadata = true;\n  const metadata = datasource.languageProvider.retrieveMetricsMetadata();\n  if (metadata && Object.keys(metadata).length === 0) {\n    hasMetadata = false;\n  }\n\n  let nameHaystackDictionaryData: HaystackDictionary = {};\n  let metaHaystackDictionaryData: HaystackDictionary = {};\n\n  // pass in metrics from getMetrics in the query builder, reduced in the metric select\n  let metricsData: MetricsData | undefined;\n\n  metricsData = initialMetrics?.map((m: string) => {\n    const metricData = buildMetricData(m, datasource);\n\n    const metaDataString = `${m}${metricData.description}`;\n\n    nameHaystackDictionaryData[m] = metricData;\n    metaHaystackDictionaryData[metaDataString] = metricData;\n\n    return metricData;\n  });\n\n  return {\n    isLoading: false,\n    hasMetadata: hasMetadata,\n    metrics: metricsData ?? [],\n    metaHaystackDictionary: metaHaystackDictionaryData,\n    nameHaystackDictionary: nameHaystackDictionaryData,\n    totalMetricCount: metricsData?.length ?? 0,\n    filteredMetricCount: metricsData?.length ?? 0,\n  };\n}\n\n/**\n * Builds the metric data object with type and description\n *\n * @param   metric  The metric name\n * @param   datasource  The Prometheus datasource for mapping metradata to the metric name\n * @returns A MetricData object.\n */\nfunction buildMetricData(metric: string, datasource: PrometheusDatasource): MetricData {\n  let type = getMetadataType(metric, datasource.languageProvider.retrieveMetricsMetadata());\n\n  const description = getMetadataHelp(metric, datasource.languageProvider.retrieveMetricsMetadata());\n\n  ['histogram', 'summary'].forEach((t) => {\n    if (description?.toLowerCase().includes(t) && type !== t) {\n      type += ` (${t})`;\n    }\n  });\n\n  const oldHistogramMatch = metric.match(/^\\w+_bucket$|^\\w+_bucket{.*}$/);\n\n  if (type === 'histogram' && !oldHistogramMatch) {\n    type = 'native histogram';\n  }\n\n  const metricData: MetricData = {\n    value: metric,\n    type: type,\n    description: description,\n  };\n\n  return metricData;\n}\n\nexport function getMetadataHelp(metric: string, metadata: PromMetricsMetadata): string | undefined {\n  return metadata[metric]?.help;\n}\n\nexport function getMetadataType(metric: string, metadata: PromMetricsMetadata): string | undefined {\n  return metadata[metric]?.type;\n}\n\n/**\n * The filtered and paginated metrics displayed in the modal\n * */\nexport function displayedMetrics(state: MetricsModalState, dispatch: React.Dispatch<AnyAction>) {\n  const filteredSorted: MetricsData = filterMetrics(state);\n\n  if (!state.isLoading && state.filteredMetricCount !== filteredSorted.length) {\n    dispatch(setFilteredMetricCount(filteredSorted.length));\n  }\n\n  return sliceMetrics(filteredSorted, state.pageNum, state.resultsPerPage);\n}\n\n/**\n * Filter the metrics with all the options, fuzzy, type, null metadata\n */\nexport function filterMetrics(state: MetricsModalState): MetricsData {\n  let filteredMetrics: MetricsData = state.metrics;\n\n  if (state.fuzzySearchQuery && !state.useBackend) {\n    if (state.fullMetaSearch) {\n      filteredMetrics = state.metaHaystackOrder.map((needle: string) => state.metaHaystackDictionary[needle]);\n    } else {\n      filteredMetrics = state.nameHaystackOrder.map((needle: string) => state.nameHaystackDictionary[needle]);\n    }\n  }\n\n  if (state.selectedTypes.length > 0) {\n    filteredMetrics = filteredMetrics.filter((m: MetricData, idx) => {\n      // Matches type\n      const matchesSelectedType = state.selectedTypes.some((t) => {\n        if (m.type && t.value) {\n          return m.type.includes(t.value);\n        }\n\n        if (!m.type && t.value === 'no type') {\n          return true;\n        }\n\n        return false;\n      });\n\n      // when a user filters for type, only return metrics with defined types\n      return matchesSelectedType;\n    });\n  }\n\n  if (!state.includeNullMetadata) {\n    filteredMetrics = filteredMetrics.filter((m: MetricData) => {\n      return m.type !== undefined && m.description !== undefined;\n    });\n  }\n\n  return filteredMetrics;\n}\n\nexport function calculatePageList(state: MetricsModalState) {\n  if (!state.metrics.length) {\n    return [];\n  }\n\n  const calcResultsPerPage: number = state.resultsPerPage === 0 ? 1 : state.resultsPerPage;\n\n  const pages = Math.floor(filterMetrics(state).length / calcResultsPerPage) + 1;\n\n  return [...Array(pages).keys()].map((i) => i + 1);\n}\n\nexport function sliceMetrics(metrics: MetricsData, pageNum: number, resultsPerPage: number) {\n  const calcResultsPerPage: number = resultsPerPage === 0 ? 1 : resultsPerPage;\n  const start: number = pageNum === 1 ? 0 : (pageNum - 1) * calcResultsPerPage;\n  const end: number = start + calcResultsPerPage;\n  return metrics.slice(start, end);\n}\n\nexport const calculateResultsPerPage = (results: number, defaultResults: number, max: number) => {\n  if (results < 1) {\n    return 1;\n  }\n\n  if (results > max) {\n    return max;\n  }\n\n  return results ?? defaultResults;\n};\n\n/**\n * The backend query that replaces the uFuzzy search when the option 'useBackend' has been selected\n * this is a regex search either to the series or labels Prometheus endpoint\n * depending on which the Prometheus type or version supports\n * @param metricText\n * @param labels\n * @param datasource\n */\nexport async function getBackendSearchMetrics(\n  metricText: string,\n  labels: QueryBuilderLabelFilter[],\n  datasource: PrometheusDatasource\n): Promise<Array<{ value: string }>> {\n  const queryString = regexifyLabelValuesQueryString(metricText);\n\n  const labelsParams = labels.map((label) => {\n    return `,${label.label}=\"${label.value}\"`;\n  });\n\n  const params = `label_values({__name__=~\".*${queryString}\"${labels ? labelsParams.join() : ''}},__name__)`;\n\n  const results = datasource.metricFindQuery(params);\n\n  return await results.then((results) => {\n    return results.map((result) => buildMetricData(result.text, datasource));\n  });\n}\n\nexport function tracking(event: string, state?: MetricsModalState | null, metric?: string, query?: PromVisualQuery) {\n  switch (event) {\n    case 'grafana_prom_metric_encycopedia_tracking':\n      reportInteraction(event, {\n        metric: metric,\n        hasMetadata: state?.hasMetadata,\n        totalMetricCount: state?.totalMetricCount,\n        fuzzySearchQuery: state?.fuzzySearchQuery,\n        fullMetaSearch: state?.fullMetaSearch,\n        selectedTypes: state?.selectedTypes,\n        useRegexSearch: state?.useBackend,\n        includeResultsWithoutMetadata: state?.includeNullMetadata,\n      });\n    case 'grafana_prom_metric_encycopedia_disable_text_wrap_interaction':\n      reportInteraction(event, {\n        disableTextWrap: state?.disableTextWrap,\n      });\n    case 'grafana_prometheus_metric_encyclopedia_open':\n      reportInteraction(event, {\n        query: query,\n      });\n  }\n}\n\nexport const promTypes: PromFilterOption[] = [\n  {\n    value: 'counter',\n    description:\n      'A cumulative metric that represents a single monotonically increasing counter whose value can only increase or be reset to zero on restart.',\n  },\n  {\n    value: 'gauge',\n    description: 'A metric that represents a single numerical value that can arbitrarily go up and down.',\n  },\n  {\n    value: 'histogram',\n    description:\n      'A histogram samples observations (usually things like request durations or response sizes) and counts them in configurable buckets.',\n  },\n  {\n    value: 'native histogram',\n    description:\n      'Native histograms are different from classic Prometheus histograms in a number of ways: Native histogram bucket boundaries are calculated by a formula that depends on the scale (resolution) of the native histogram, and are not user defined.',\n  },\n  {\n    value: 'summary',\n    description:\n      'A summary samples observations (usually things like request durations and response sizes) and can calculate configurable quantiles over a sliding time window.',\n  },\n  {\n    value: 'unknown',\n    description: 'These metrics have been given the type unknown in the metadata.',\n  },\n  {\n    value: 'no type',\n    description: 'These metrics have no defined type in the metadata.',\n  },\n];\n\nexport const placeholders = {\n  browse: 'Search metrics by name',\n  metadataSearchSwitch: 'Include description in search',\n  type: 'Filter by type',\n  includeNullMetadata: 'Include results with no metadata',\n  setUseBackend: 'Enable regex search',\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/AdditionalSettings.tsx\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Icon, Switch, Tooltip, useTheme2 } from '@grafana/ui';\n\nimport { metricsModaltestIds } from './shared/testIds';\nimport { AdditionalSettingsProps } from './shared/types';\nimport { placeholders } from './state/helpers';\n\nexport function AdditionalSettings(props: AdditionalSettingsProps) {\n  const { state, onChangeFullMetaSearch, onChangeIncludeNullMetadata, onChangeDisableTextWrap, onChangeUseBackend } =\n    props;\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <>\n      <div className={styles.selectItem}>\n        <Switch\n          data-testid={metricsModaltestIds.searchWithMetadata}\n          value={state.fullMetaSearch}\n          disabled={state.useBackend || !state.hasMetadata}\n          onChange={() => onChangeFullMetaSearch()}\n        />\n        <div className={styles.selectItemLabel}>{placeholders.metadataSearchSwitch}</div>\n      </div>\n      <div className={styles.selectItem}>\n        <Switch\n          value={state.includeNullMetadata}\n          disabled={!state.hasMetadata}\n          onChange={() => onChangeIncludeNullMetadata()}\n        />\n        <div className={styles.selectItemLabel}>{placeholders.includeNullMetadata}</div>\n      </div>\n      <div className={styles.selectItem}>\n        <Switch value={state.disableTextWrap} onChange={() => onChangeDisableTextWrap()} />\n        <div className={styles.selectItemLabel}>\n          <Trans i18nKey=\"grafana-prometheus.querybuilder.additional-settings.disable-text-wrap\">\n            Disable text wrap\n          </Trans>\n        </div>\n      </div>\n      <div className={styles.selectItem}>\n        <Switch\n          data-testid={metricsModaltestIds.setUseBackend}\n          value={state.useBackend}\n          onChange={() => onChangeUseBackend()}\n        />\n        <div className={styles.selectItemLabel}>{placeholders.setUseBackend}&nbsp;</div>\n        <Tooltip\n          content={t(\n            'grafana-prometheus.querybuilder.additional-settings.content-filter-metric-names-regex-search-using',\n            'Filter metric names by regex search, using an additional call on the Prometheus API.'\n          )}\n          placement=\"bottom-end\"\n        >\n          <Icon name=\"info-circle\" size=\"xs\" className={styles.settingsIcon} />\n        </Tooltip>\n      </div>\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    settingsIcon: css({\n      color: theme.colors.text.secondary,\n    }),\n    selectItem: css({\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      padding: '4px 0',\n    }),\n    selectItemLabel: css({\n      margin: `0 0 0 ${theme.spacing(1)}`,\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n    }),\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/FeedbackLink.tsx\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Icon, useStyles2, Stack } from '@grafana/ui';\n\nexport interface Props {\n  feedbackUrl?: string;\n}\n\nexport function FeedbackLink({ feedbackUrl }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack>\n      <a\n        href={feedbackUrl}\n        className={styles.link}\n        title={t(\n          'grafana-prometheus.querybuilder.feedback-link.title-give-feedback',\n          'The metrics explorer is new, please let us know how we can improve it'\n        )}\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" />{' '}\n        <Trans i18nKey=\"grafana-prometheus.querybuilder.feedback-link.give-feedback\">Give feedback</Trans>\n      </a>\n    </Stack>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    link: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      ':hover': {\n        color: theme.colors.text.link,\n      },\n      margin: `-25px 0 30px 0`,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { FieldValidationMessage, TextLink } from '@grafana/ui';\n\n/**\n * Use this to return a url in a tooltip in a field. Don't forget to make the field interactive to be able to click on the tooltip\n * @param url\n * @returns\n */\nexport function docsTip(url?: string) {\n  const docsUrl = 'https://grafana.com/docs/grafana/latest/datasources/prometheus/configure-prometheus-data-source/';\n\n  return (\n    <TextLink href={url ? url : docsUrl} external>\n      <Trans i18nKey=\"grafana-prometheus.configuration.docs-tip.visit-docs-for-more-details-here\">\n        Visit docs for more details here.\n      </Trans>\n    </TextLink>\n  );\n}\n\nexport const validateInput = (\n  input: string,\n  pattern: string | RegExp,\n  errorMessage?: string\n): boolean | JSX.Element => {\n  const defaultErrorMessage = 'Value is not valid';\n  const inputTooLongErrorMessage = 'Input is too long';\n  const validationTimeoutErrorMessage = 'Validation timeout - input too complex';\n  const invalidValidationPatternErrorMessage = 'Invalid validation pattern';\n  const MAX_INPUT_LENGTH = 1000; // Reasonable limit for most validation cases\n\n  // Early return if no input\n  if (!input) {\n    return true;\n  }\n\n  // Check input length\n  if (input.length > MAX_INPUT_LENGTH) {\n    return <FieldValidationMessage>{inputTooLongErrorMessage}</FieldValidationMessage>;\n  }\n\n  try {\n    // Convert string pattern to RegExp if needed\n    let regex = typeof pattern === 'string' ? new RegExp(pattern) : pattern;\n\n    // Ensure pattern is properly anchored to prevent catastrophic backtracking\n    if (typeof pattern === 'string' && !pattern.startsWith('^') && !pattern.endsWith('$')) {\n      regex = new RegExp(`^${pattern}$`);\n    }\n\n    // Add timeout to prevent ReDoS\n    const timeout = 100; // 100ms timeout\n    const startTime = Date.now();\n\n    const isValid = regex.test(input);\n\n    // Check if execution took too long\n    if (Date.now() - startTime > timeout) {\n      return <FieldValidationMessage>{validationTimeoutErrorMessage}</FieldValidationMessage>;\n    }\n\n    if (!isValid) {\n      return <FieldValidationMessage>{errorMessage || defaultErrorMessage}</FieldValidationMessage>;\n    }\n\n    return true;\n  } catch (error) {\n    return <FieldValidationMessage>{invalidValidationPatternErrorMessage}</FieldValidationMessage>;\n  }\n};\n\nexport function overhaulStyles(theme: GrafanaTheme2) {\n  return {\n    additionalSettings: css({\n      marginBottom: '25px',\n    }),\n    secondaryGrey: css({\n      color: theme.colors.secondary.text,\n      opacity: '65%',\n    }),\n    inlineError: css({\n      margin: '0px 0px 4px 245px',\n    }),\n    switchField: css({\n      alignItems: 'center',\n    }),\n    sectionHeaderPadding: css({\n      paddingTop: '32px',\n    }),\n    sectionBottomPadding: css({\n      paddingBottom: '28px',\n    }),\n    subsectionText: css({\n      fontSize: '12px',\n    }),\n    hrBottomSpace: css({\n      marginBottom: '56px',\n    }),\n    hrTopSpace: css({\n      marginTop: '50px',\n    }),\n    textUnderline: css({\n      textDecoration: 'underline',\n    }),\n    versionMargin: css({\n      marginBottom: '12px',\n    }),\n    advancedHTTPSettingsMargin: css({\n      margin: '24px 0 8px 0',\n    }),\n    advancedSettings: css({\n      paddingTop: '32px',\n    }),\n    alertingTop: css({\n      marginTop: '40px !important',\n    }),\n    overhaulPageHeading: css({\n      fontWeight: 400,\n    }),\n    container: css({\n      maxwidth: 578,\n    }),\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/ResultsTable.tsx\nimport { css } from '@emotion/css';\nimport { ReactElement } from 'react';\nimport Highlighter from 'react-highlight-words';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { Button, Icon, Tooltip, useTheme2 } from '@grafana/ui';\n\nimport { docsTip } from '../../../configuration/shared/utils';\nimport { PromVisualQuery } from '../../types';\n\nimport { tracking } from './state/helpers';\nimport { MetricsModalState } from './state/state';\nimport { MetricData, MetricsData } from './types';\n\ntype ResultsTableProps = {\n  metrics: MetricsData;\n  onChange: (query: PromVisualQuery) => void;\n  onClose: () => void;\n  query: PromVisualQuery;\n  state: MetricsModalState;\n  disableTextWrap: boolean;\n};\n\nexport function ResultsTable(props: ResultsTableProps) {\n  const { metrics, onChange, onClose, query, state, disableTextWrap } = props;\n\n  const theme = useTheme2();\n  const styles = getStyles(theme, disableTextWrap);\n\n  function selectMetric(metric: MetricData) {\n    if (metric.value) {\n      onChange({ ...query, metric: metric.value });\n      tracking('grafana_prom_metric_encycopedia_tracking', state, metric.value);\n      onClose();\n    }\n  }\n\n  function metaRows(metric: MetricData) {\n    if (state.fullMetaSearch && metric) {\n      return (\n        <>\n          <td>{displayType(metric.type ?? '')}</td>\n          <td>\n            <Highlighter\n              textToHighlight={metric.description ?? ''}\n              searchWords={state.metaHaystackMatches}\n              autoEscape\n              highlightClassName={styles.matchHighLight}\n            />\n          </td>\n        </>\n      );\n    } else {\n      return (\n        <>\n          <td>{displayType(metric.type ?? '')}</td>\n          <td>{metric.description ?? ''}</td>\n        </>\n      );\n    }\n  }\n\n  function addHelpIcon(fullType: string, descriptiveType: string, link: string) {\n    return (\n      <>\n        {fullType}\n        <span className={styles.tooltipSpace}>\n          <Tooltip\n            content={\n              <>\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.results-table.content-descriptive-type\">\n                  When creating a {{ descriptiveType }}, Prometheus exposes multiple series with the type counter.{' '}\n                </Trans>\n                {docsTip(link)}\n              </>\n            }\n            placement=\"bottom-start\"\n            interactive={true}\n          >\n            <Icon name=\"info-circle\" size=\"xs\" />\n          </Tooltip>\n        </span>\n      </>\n    );\n  }\n\n  function displayType(type: string | null) {\n    if (!type) {\n      return '';\n    }\n\n    if (type.includes('(summary)')) {\n      return addHelpIcon(type, 'summary', 'https://prometheus.io/docs/concepts/metric_types/#summary');\n    }\n\n    if (type.includes('(histogram)')) {\n      return addHelpIcon(type, 'histogram', 'https://prometheus.io/docs/concepts/metric_types/#histogram');\n    }\n\n    return type;\n  }\n\n  function noMetricsMessages(): ReactElement {\n    let message;\n\n    if (!state.fuzzySearchQuery) {\n      message = 'There are no metrics found in the data source.';\n    }\n\n    if (query.labels.length > 0) {\n      message = 'There are no metrics found. Try to expand your label filters.';\n    }\n\n    if (state.fuzzySearchQuery || state.selectedTypes.length > 0) {\n      message = 'There are no metrics found. Try to expand your search and filters.';\n    }\n\n    return (\n      <tr className={styles.noResults}>\n        <td colSpan={3}>{message}</td>\n      </tr>\n    );\n  }\n\n  function textHighlight(state: MetricsModalState) {\n    if (state.useBackend) {\n      // highlight the input only for the backend search\n      // this highlight is equivalent to how the metric select highlights\n      // look into matching on regex input\n      return [state.fuzzySearchQuery];\n    } else if (state.fullMetaSearch) {\n      // highlight the matches in the ufuzzy metaHaystack\n      return state.metaHaystackMatches;\n    } else {\n      // highlight the ufuzzy name matches\n      return state.nameHaystackMatches;\n    }\n  }\n\n  return (\n    <table className={styles.table}>\n      <thead className={styles.stickyHeader}>\n        <tr>\n          <th className={`${styles.nameWidth} ${styles.tableHeaderPadding}`}>\n            <Trans i18nKey=\"grafana-prometheus.querybuilder.results-table.name\">Name</Trans>\n          </th>\n          {state.hasMetadata && (\n            <>\n              <th className={`${styles.typeWidth} ${styles.tableHeaderPadding}`}>\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.results-table.type\">Type</Trans>\n              </th>\n              <th className={`${styles.descriptionWidth} ${styles.tableHeaderPadding}`}>\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.results-table.description\">Description</Trans>\n              </th>\n            </>\n          )}\n          <th className={styles.selectButtonWidth}> </th>\n        </tr>\n      </thead>\n      <tbody>\n        <>\n          {metrics.length > 0 &&\n            metrics.map((metric: MetricData, idx: number) => {\n              return (\n                <tr key={metric?.value ?? idx} className={styles.row}>\n                  <td className={styles.nameOverflow}>\n                    <Highlighter\n                      textToHighlight={metric?.value ?? ''}\n                      searchWords={textHighlight(state)}\n                      autoEscape\n                      highlightClassName={styles.matchHighLight}\n                    />\n                  </td>\n                  {state.hasMetadata && metaRows(metric)}\n                  <td>\n                    <Button\n                      size=\"md\"\n                      variant=\"secondary\"\n                      onClick={() => selectMetric(metric)}\n                      className={styles.centerButton}\n                    >\n                      <Trans i18nKey=\"grafana-prometheus.querybuilder.results-table.select\">Select</Trans>\n                    </Button>\n                  </td>\n                </tr>\n              );\n            })}\n          {metrics.length === 0 && !state.isLoading && noMetricsMessages()}\n        </>\n      </tbody>\n    </table>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, disableTextWrap: boolean) => {\n  return {\n    table: css({\n      tableLayout: disableTextWrap ? undefined : 'fixed',\n      borderRadius: theme.shape.radius.default,\n      width: '100%',\n      whiteSpace: disableTextWrap ? 'nowrap' : 'normal',\n      td: {\n        padding: theme.spacing(1),\n      },\n      'td,th': {\n        minWidth: theme.spacing(3),\n        borderBottom: `1px solid ${theme.colors.border.weak}`,\n      },\n    }),\n    row: css({\n      label: 'row',\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n      '&:last-child': {\n        borderBottom: 0,\n      },\n    }),\n    tableHeaderPadding: css({\n      padding: '8px',\n    }),\n    matchHighLight: css({\n      background: 'inherit',\n      color: theme.components.textHighlight.text,\n      backgroundColor: theme.components.textHighlight.background,\n    }),\n    nameWidth: css({\n      width: disableTextWrap ? undefined : '37.5%',\n    }),\n    nameOverflow: css({\n      overflowWrap: disableTextWrap ? undefined : 'anywhere',\n    }),\n    typeWidth: css({\n      width: disableTextWrap ? undefined : '15%',\n    }),\n    descriptionWidth: css({\n      width: disableTextWrap ? undefined : '35%',\n    }),\n    selectButtonWidth: css({\n      width: disableTextWrap ? undefined : '12.5%',\n    }),\n    stickyHeader: css({\n      position: 'sticky',\n      top: 0,\n      backgroundColor: theme.colors.background.primary,\n    }),\n    noResults: css({\n      textAlign: 'center',\n      color: theme.colors.text.secondary,\n    }),\n    tooltipSpace: css({\n      marginLeft: '4px',\n    }),\n    centerButton: css({\n      display: 'block',\n      margin: 'auto',\n      border: 'none',\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/styles.ts\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nexport const getStyles = (theme: GrafanaTheme2, disableTextWrap: boolean) => {\n  return {\n    modal: css({\n      width: '85vw',\n      [theme.breakpoints.down('md')]: {\n        width: '100%',\n      },\n      [theme.breakpoints.up('xl')]: {\n        width: '60%',\n      },\n    }),\n    inputWrapper: css({\n      display: 'flex',\n      flexDirection: 'row',\n      flexWrap: 'wrap',\n    }),\n    inputItemFirst: css({\n      flexBasis: '40%',\n      paddingRight: '16px',\n      [theme.breakpoints.down('md')]: {\n        paddingRight: '0px',\n        paddingBottom: '16px',\n      },\n    }),\n    inputItem: css({\n      flexGrow: 1,\n      flexBasis: '20%',\n      [theme.breakpoints.down('md')]: {\n        minWidth: '100%',\n      },\n    }),\n    selectWrapper: css({\n      marginBottom: theme.spacing(1),\n    }),\n    resultsAmount: css({\n      color: theme.colors.text.secondary,\n      fontSize: '0.85rem',\n      padding: '0 0 4px 0',\n    }),\n    resultsData: css({\n      margin: `4px 0 ${theme.spacing(2)} 0`,\n    }),\n    resultsDataCount: css({\n      margin: 0,\n    }),\n    resultsDataFiltered: css({\n      color: theme.colors.text.secondary,\n      textAlign: 'center',\n      border: 'solid 1px rgba(204, 204, 220, 0.25)',\n      padding: '7px',\n    }),\n    resultsDataFilteredText: css({\n      display: 'inline',\n      verticalAlign: 'text-top',\n    }),\n    results: css({\n      height: 'calc(80vh - 310px)',\n      overflowY: 'scroll',\n    }),\n    resultsFooter: css({\n      marginTop: '24px',\n      display: 'flex',\n      flexDirection: 'row',\n      flexWrap: 'wrap',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      position: 'sticky',\n    }),\n    currentlySelected: css({\n      color: 'grey',\n      opacity: '75%',\n      fontSize: '0.75rem',\n    }),\n    loadingSpinner: css({\n      visibility: 'hidden',\n    }),\n    visible: css({\n      visibility: 'visible',\n    }),\n    settingsBtn: css({\n      float: 'right',\n    }),\n    noBorder: css({\n      border: 'none',\n    }),\n    resultsPerPageLabel: css({\n      color: theme.colors.text.secondary,\n      opacity: '75%',\n      paddingTop: '5px',\n      fontSize: '0.85rem',\n      marginRight: '8px',\n    }),\n    resultsPerPageWrapper: css({\n      display: 'flex',\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/uFuzzy.ts\nimport uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, dispatcher: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for hilighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    dispatcher([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    dispatcher([[], []]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/metrics-modal/MetricsModal.tsx\nimport { cx } from '@emotion/css';\nimport debounce from 'debounce-promise';\nimport { useCallback, useEffect, useMemo, useReducer } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t, Trans } from '@grafana/i18n';\nimport {\n  Button,\n  ButtonGroup,\n  Icon,\n  Input,\n  Modal,\n  MultiSelect,\n  Pagination,\n  Spinner,\n  Toggletip,\n  useTheme2,\n} from '@grafana/ui';\n\nimport { getDebounceTimeInMilliseconds } from '../../../caching';\nimport { METRIC_LABEL } from '../../../constants';\nimport { regexifyLabelValuesQueryString } from '../../parsingUtils';\nimport { formatPrometheusLabelFilters } from '../MetricCombobox';\n\nimport { AdditionalSettings } from './AdditionalSettings';\nimport { FeedbackLink } from './FeedbackLink';\nimport { ResultsTable } from './ResultsTable';\nimport { MetricsModalProps } from './shared/types';\nimport {\n  calculatePageList,\n  calculateResultsPerPage,\n  displayedMetrics,\n  placeholders,\n  promTypes,\n  setMetrics,\n  tracking,\n} from './state/helpers';\nimport {\n  DEFAULT_RESULTS_PER_PAGE,\n  initialState,\n  MAXIMUM_RESULTS_PER_PAGE,\n  MetricsModalMetadata,\n  stateSlice,\n} from './state/state';\nimport { getStyles } from './styles';\nimport { PromFilterOption } from './types';\nimport { debouncedFuzzySearch } from './uFuzzy';\n\nexport const MetricsModal = (props: MetricsModalProps) => {\n  const { datasource, isOpen, onClose, onChange, query, initialMetrics, timeRange } = props;\n\n  const [state, dispatch] = useReducer(stateSlice.reducer, initialState(query));\n\n  const theme = useTheme2();\n  const styles = getStyles(theme, state.disableTextWrap);\n\n  /**\n   * loads metrics and metadata on opening modal and switching off useBackend\n   */\n  const updateMetricsMetadata = useCallback(async () => {\n    // *** Loading Gif\n    dispatch(setIsLoading(true));\n\n    // Because Combobox in MetricsCombobox doesn't use the same lifecycle as Select to open the Metrics Explorer\n    // it might not have loaded any metrics yet, so it instead passes in an async function to get the metrics\n    const metrics = typeof initialMetrics === 'function' ? await initialMetrics() : initialMetrics;\n\n    const data: MetricsModalMetadata = await setMetrics(datasource, query, metrics);\n    dispatch(\n      buildMetrics({\n        isLoading: false,\n        hasMetadata: data.hasMetadata,\n        metrics: data.metrics,\n        metaHaystackDictionary: data.metaHaystackDictionary,\n        nameHaystackDictionary: data.nameHaystackDictionary,\n        totalMetricCount: data.metrics.length,\n        filteredMetricCount: data.metrics.length,\n      })\n    );\n  }, [query, datasource, initialMetrics]);\n\n  useEffect(() => {\n    updateMetricsMetadata();\n  }, [updateMetricsMetadata]);\n\n  const typeOptions: SelectableValue[] = promTypes.map((t: PromFilterOption) => {\n    return {\n      value: t.value,\n      label: t.value,\n      description: t.description,\n    };\n  });\n\n  /**\n   * The backend debounced search\n   */\n  const debouncedBackendSearch = useMemo(\n    () =>\n      debounce(async (metricText: string) => {\n        dispatch(setIsLoading(true));\n\n        const queryString = regexifyLabelValuesQueryString(metricText);\n        const filterArray = query.labels ? formatPrometheusLabelFilters(query.labels) : [];\n        const match = `{__name__=~\".*${queryString}\"${filterArray ? filterArray.join('') : ''}}`;\n\n        const results = await datasource.languageProvider.queryLabelValues(timeRange, METRIC_LABEL, match);\n\n        const resultsOptions = results.map((result) => ({\n          value: result,\n        }));\n\n        dispatch(\n          filterMetricsBackend({\n            metrics: resultsOptions,\n            filteredMetricCount: resultsOptions.length,\n            isLoading: false,\n          })\n        );\n      }, getDebounceTimeInMilliseconds(datasource.cacheLevel)),\n    [datasource.cacheLevel, datasource.languageProvider, query.labels, timeRange]\n  );\n\n  function fuzzyNameDispatch(haystackData: string[][]) {\n    dispatch(setNameHaystack(haystackData));\n  }\n\n  function fuzzyMetaDispatch(haystackData: string[][]) {\n    dispatch(setMetaHaystack(haystackData));\n  }\n\n  function searchCallback(query: string, fullMetaSearchVal: boolean) {\n    if (state.useBackend && query === '') {\n      // get all metrics data if a user erases everything in the input\n      updateMetricsMetadata();\n    } else if (state.useBackend) {\n      debouncedBackendSearch(query);\n    } else {\n      // search either the names or all metadata\n      // fuzzy search go!\n      if (fullMetaSearchVal) {\n        debouncedFuzzySearch(Object.keys(state.metaHaystackDictionary), query, fuzzyMetaDispatch);\n      } else {\n        debouncedFuzzySearch(Object.keys(state.nameHaystackDictionary), query, fuzzyNameDispatch);\n      }\n    }\n  }\n\n  /* Settings switches */\n  const additionalSettings = (\n    <AdditionalSettings\n      state={state}\n      onChangeFullMetaSearch={() => {\n        const newVal = !state.fullMetaSearch;\n        dispatch(setFullMetaSearch(newVal));\n        onChange({ ...query, fullMetaSearch: newVal });\n        searchCallback(state.fuzzySearchQuery, newVal);\n      }}\n      onChangeIncludeNullMetadata={() => {\n        dispatch(setIncludeNullMetadata(!state.includeNullMetadata));\n        onChange({ ...query, includeNullMetadata: !state.includeNullMetadata });\n      }}\n      onChangeDisableTextWrap={() => {\n        dispatch(setDisableTextWrap());\n        onChange({ ...query, disableTextWrap: !state.disableTextWrap });\n        tracking('grafana_prom_metric_encycopedia_disable_text_wrap_interaction', state, '');\n      }}\n      onChangeUseBackend={() => {\n        const newVal = !state.useBackend;\n        dispatch(setUseBackend(newVal));\n        onChange({ ...query, useBackend: newVal });\n        if (newVal === false) {\n          // rebuild the metrics metadata if we turn off useBackend\n          updateMetricsMetadata();\n        } else {\n          // check if there is text in the browse search and update\n          if (state.fuzzySearchQuery !== '') {\n            debouncedBackendSearch(state.fuzzySearchQuery);\n          }\n          // otherwise wait for user typing\n        }\n      }}\n    />\n  );\n\n  return (\n    <Modal\n      data-testid={metricsModaltestIds.metricModal}\n      isOpen={isOpen}\n      title={t('grafana-prometheus.querybuilder.metrics-modal.title-metrics-explorer', 'Metrics explorer')}\n      onDismiss={onClose}\n      aria-label={t('grafana-prometheus.querybuilder.metrics-modal.aria-label-browse-metrics', 'Browse metrics')}\n      className={styles.modal}\n    >\n      <FeedbackLink feedbackUrl=\"https://forms.gle/DEMAJHoAMpe3e54CA\" />\n      <div\n        className={styles.inputWrapper}\n        data-testid={selectors.components.DataSource.Prometheus.queryEditor.builder.metricsExplorer}\n      >\n        <div className={cx(styles.inputItem, styles.inputItemFirst)}>\n          <Input\n            autoFocus={true}\n            data-testid={metricsModaltestIds.searchMetric}\n            placeholder={placeholders.browse}\n            value={state.fuzzySearchQuery}\n            onInput={(e) => {\n              const value = e.currentTarget.value ?? '';\n              dispatch(setFuzzySearchQuery(value));\n              searchCallback(value, state.fullMetaSearch);\n            }}\n          />\n        </div>\n        {state.hasMetadata && (\n          <div className={styles.inputItem}>\n            <MultiSelect\n              data-testid={metricsModaltestIds.selectType}\n              inputId=\"my-select\"\n              options={typeOptions}\n              value={state.selectedTypes}\n              placeholder={placeholders.type}\n              onChange={(v) => dispatch(setSelectedTypes(v))}\n            />\n          </div>\n        )}\n        <div>\n          <Spinner className={`${styles.loadingSpinner} ${state.isLoading ? styles.visible : ''}`} />\n        </div>\n        <div className={styles.inputItem}>\n          <Toggletip\n            aria-label={t(\n              'grafana-prometheus.querybuilder.metrics-modal.aria-label-additional-settings',\n              'Additional settings'\n            )}\n            content={additionalSettings}\n            placement=\"bottom-end\"\n            closeButton={false}\n          >\n            <ButtonGroup className={styles.settingsBtn}>\n              <Button\n                variant=\"secondary\"\n                size=\"md\"\n                onClick={() => dispatch(showAdditionalSettings())}\n                data-testid={metricsModaltestIds.showAdditionalSettings}\n                className={styles.noBorder}\n              >\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.metrics-modal.additional-settings\">\n                  Additional Settings\n                </Trans>\n              </Button>\n              <Button\n                className={styles.noBorder}\n                variant=\"secondary\"\n                icon={state.showAdditionalSettings ? 'angle-up' : 'angle-down'}\n              />\n            </ButtonGroup>\n          </Toggletip>\n        </div>\n      </div>\n      <div className={styles.resultsData}>\n        {query.metric && (\n          <i className={styles.currentlySelected}>\n            <Trans\n              i18nKey=\"grafana-prometheus.querybuilder.metrics-modal.currently-selected\"\n              values={{ selected: query.metric }}\n            >\n              Currently selected: {'{{selected}}'}\n            </Trans>\n          </i>\n        )}\n        {query.labels.length > 0 && (\n          <div className={styles.resultsDataFiltered}>\n            <Icon name=\"info-circle\" size=\"sm\" />\n            <div className={styles.resultsDataFilteredText}>\n              &nbsp;\n              <Trans i18nKey=\"grafana-prometheus.querybuilder.metrics-modal.metrics-pre-filtered\">\n                These metrics have been pre-filtered by labels chosen in the label filters.\n              </Trans>\n            </div>\n          </div>\n        )}\n      </div>\n      <div className={styles.results}>\n        {state.metrics && (\n          <ResultsTable\n            metrics={displayedMetrics(state, dispatch)}\n            onChange={onChange}\n            onClose={onClose}\n            query={query}\n            state={state}\n            disableTextWrap={state.disableTextWrap}\n          />\n        )}\n      </div>\n      <div className={styles.resultsFooter}>\n        <div className={styles.resultsAmount}>\n          <Trans\n            i18nKey=\"grafana-prometheus.querybuilder.metrics-modal.results-amount\"\n            values={{ num: state.filteredMetricCount }}\n            count={state.totalMetricCount}\n          >\n            Showing {'{{num}}'} of {'{{count}}'} results\n          </Trans>\n        </div>\n        <Pagination\n          currentPage={state.pageNum ?? 1}\n          numberOfPages={calculatePageList(state).length}\n          onNavigate={(val: number) => {\n            const page = val ?? 1;\n            dispatch(setPageNum(page));\n          }}\n        />\n        <div className={styles.resultsPerPageWrapper}>\n          <p className={styles.resultsPerPageLabel}>\n            <Trans i18nKey=\"grafana-prometheus.querybuilder.metrics-modal.results-per-page\">Results per page</Trans>\n          </p>\n          <Input\n            data-testid={metricsModaltestIds.resultsPerPage}\n            value={calculateResultsPerPage(state.resultsPerPage, DEFAULT_RESULTS_PER_PAGE, MAXIMUM_RESULTS_PER_PAGE)}\n            placeholder={t(\n              'grafana-prometheus.querybuilder.metrics-modal.placeholder-results-per-page',\n              'results per page'\n            )}\n            width={10}\n            title={'The maximum results per page is ' + MAXIMUM_RESULTS_PER_PAGE}\n            type=\"number\"\n            onInput={(e) => {\n              const value = +e.currentTarget.value;\n\n              if (isNaN(value) || value >= MAXIMUM_RESULTS_PER_PAGE) {\n                return;\n              }\n\n              dispatch(setResultsPerPage(value));\n            }}\n          />\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport const metricsModaltestIds = {\n  metricModal: 'metric-modal',\n  searchMetric: 'search-metric',\n  searchWithMetadata: 'search-with-metadata',\n  selectType: 'select-type',\n  metricCard: 'metric-card',\n  useMetric: 'use-metric',\n  searchPage: 'search-page',\n  resultsPerPage: 'results-per-page',\n  setUseBackend: 'set-use-backend',\n  showAdditionalSettings: 'show-additional-settings',\n};\n// actions to update the state\nexport const {\n  setIsLoading,\n  buildMetrics,\n  filterMetricsBackend,\n  setResultsPerPage,\n  setPageNum,\n  setFuzzySearchQuery,\n  setNameHaystack,\n  setMetaHaystack,\n  setFullMetaSearch,\n  setIncludeNullMetadata,\n  setSelectedTypes,\n  setUseBackend,\n  setDisableTextWrap,\n  showAdditionalSettings,\n  setFilteredMetricCount,\n} = stateSlice.actions;\n","import { useCallback, useState } from 'react';\n\nimport { SelectableValue, TimeRange } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { EditorField, EditorFieldGroup, InputGroup } from '@grafana/plugin-ui';\nimport { Button, InlineField, InlineFieldRow, Combobox, ComboboxOption } from '@grafana/ui';\n\nimport { METRIC_LABEL } from '../../constants';\nimport { PrometheusDatasource } from '../../datasource';\nimport { regexifyLabelValuesQueryString } from '../parsingUtils';\nimport { QueryBuilderLabelFilter } from '../shared/types';\nimport { PromVisualQuery } from '../types';\n\nimport { MetricsModal } from './metrics-modal/MetricsModal';\nimport { tracking } from './metrics-modal/state/helpers';\n\nexport interface MetricComboboxProps {\n  metricLookupDisabled: boolean;\n  query: PromVisualQuery;\n  onChange: (query: PromVisualQuery) => void;\n  onGetMetrics: () => Promise<SelectableValue[]>;\n  datasource: PrometheusDatasource;\n  labelsFilters: QueryBuilderLabelFilter[];\n  onBlur?: () => void;\n  variableEditor?: boolean;\n  timeRange: TimeRange;\n}\n\nexport function MetricCombobox({\n  datasource,\n  query,\n  onChange,\n  onGetMetrics,\n  labelsFilters,\n  variableEditor,\n  timeRange,\n}: Readonly<MetricComboboxProps>) {\n  const [metricsModalOpen, setMetricsModalOpen] = useState(false);\n\n  /**\n   * Gets label_values response from prometheus API for current autocomplete query string and any existing labels filters\n   */\n  const getMetricLabels = useCallback(\n    async (query: string) => {\n      const match = formatKeyValueStrings(query, labelsFilters);\n      const results = await datasource.languageProvider.queryLabelValues(timeRange, METRIC_LABEL, match);\n\n      const resultsOptions = results.map((result) => {\n        return {\n          label: result,\n          value: result,\n        };\n      });\n      return resultsOptions;\n    },\n    [datasource.languageProvider, labelsFilters, timeRange]\n  );\n\n  const onComboboxChange = useCallback(\n    (opt: ComboboxOption<string> | null) => {\n      onChange({ ...query, metric: opt?.value ?? '' });\n    },\n    [onChange, query]\n  );\n\n  const loadOptions = useCallback(\n    async (input: string): Promise<ComboboxOption[]> => {\n      const metrics = input.length ? await getMetricLabels(input) : await onGetMetrics();\n\n      return metrics.map((option) => ({\n        label: option.label ?? option.value,\n        value: option.value,\n      }));\n    },\n    [getMetricLabels, onGetMetrics]\n  );\n\n  const loadMetricsExplorerMetrics = useCallback(async () => {\n    const allMetrics = await onGetMetrics();\n    const metrics: string[] = [];\n    for (const metric of allMetrics) {\n      if (metric.value) {\n        metrics.push(metric.value);\n      }\n    }\n\n    return metrics;\n  }, [onGetMetrics]);\n\n  const asyncSelect = () => {\n    return (\n      <InputGroup>\n        <Combobox\n          placeholder={t(\n            'grafana-prometheus.querybuilder.metric-combobox.async-select.placeholder-select-metric',\n            'Select metric'\n          )}\n          width=\"auto\"\n          minWidth={25}\n          options={loadOptions}\n          value={query.metric}\n          onChange={onComboboxChange}\n          createCustomValue\n          data-testid={selectors.components.DataSource.Prometheus.queryEditor.builder.metricSelect}\n        />\n        <Button\n          tooltip={t(\n            'grafana-prometheus.querybuilder.metric-combobox.async-select.tooltip-open-metrics-explorer',\n            'Open metrics explorer'\n          )}\n          aria-label={t(\n            'grafana-prometheus.querybuilder.metric-combobox.async-select.aria-label-open-metrics-explorer',\n            'Open metrics explorer'\n          )}\n          variant=\"secondary\"\n          icon=\"book-open\"\n          onClick={() => {\n            tracking('grafana_prometheus_metric_encyclopedia_open', null, '', query);\n            setMetricsModalOpen(true);\n          }}\n        />\n      </InputGroup>\n    );\n  };\n\n  return (\n    <>\n      {!datasource.lookupsDisabled && metricsModalOpen && (\n        <MetricsModal\n          datasource={datasource}\n          isOpen={metricsModalOpen}\n          onClose={() => setMetricsModalOpen(false)}\n          query={query}\n          onChange={onChange}\n          initialMetrics={loadMetricsExplorerMetrics}\n          timeRange={timeRange}\n        />\n      )}\n      {variableEditor ? (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.querybuilder.metric-combobox.label-metric', 'Metric')}\n            labelWidth={20}\n            tooltip={\n              <div>\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.metric-combobox.tooltip-metric\">\n                  Optional: returns a list of label values for the label name in the specified metric.\n                </Trans>\n              </div>\n            }\n          >\n            {asyncSelect()}\n          </InlineField>\n        </InlineFieldRow>\n      ) : (\n        <EditorFieldGroup>\n          <EditorField label={t('grafana-prometheus.querybuilder.metric-combobox.label-metric', 'Metric')}>\n            {asyncSelect()}\n          </EditorField>\n        </EditorFieldGroup>\n      )}\n    </>\n  );\n}\n\nexport const formatPrometheusLabelFiltersToString = (\n  queryString: string,\n  labelsFilters: QueryBuilderLabelFilter[] | undefined\n): string => {\n  const filterArray = labelsFilters ? formatPrometheusLabelFilters(labelsFilters) : [];\n\n  return `{__name__=~\".*${queryString}\"${filterArray ? filterArray.join('') : ''}}`;\n};\n\nexport const formatPrometheusLabelFilters = (labelsFilters: QueryBuilderLabelFilter[]): string[] => {\n  return labelsFilters.map((label) => {\n    return `,${label.label}=\"${label.value}\"`;\n  });\n};\n\n/**\n * Reformat the query string and label filters to return all valid results for current query editor state\n */\nconst formatKeyValueStrings = (query: string, labelsFilters?: QueryBuilderLabelFilter[]): string => {\n  const queryString = regexifyLabelValuesQueryString(query);\n\n  return formatPrometheusLabelFiltersToString(queryString, labelsFilters);\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/MetricsLabelsSection.tsx\nimport { useCallback } from 'react';\n\nimport { SelectableValue, TimeRange } from '@grafana/data';\n\nimport { getDebounceTimeInMilliseconds } from '../../caching';\nimport { PrometheusDatasource } from '../../datasource';\nimport { truncateResult } from '../../language_utils';\nimport { PromMetricsMetadata } from '../../types';\nimport { regexifyLabelValuesQueryString } from '../parsingUtils';\nimport { promQueryModeller } from '../shared/modeller_instance';\nimport { QueryBuilderLabelFilter } from '../shared/types';\nimport { PromVisualQuery } from '../types';\n\nimport { LabelFilters } from './LabelFilters';\nimport { MetricCombobox } from './MetricCombobox';\n\nexport interface MetricsLabelsSectionProps {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromVisualQuery) => void;\n  variableEditor?: boolean;\n  onBlur?: () => void;\n  timeRange: TimeRange;\n}\n\nexport function MetricsLabelsSection({\n  datasource,\n  query,\n  onChange,\n  onBlur,\n  variableEditor,\n  timeRange,\n}: MetricsLabelsSectionProps) {\n  // fixing the use of 'as' from refactoring\n  // @ts-ignore\n  const onChangeLabels = (labels) => {\n    onChange({ ...query, labels });\n  };\n  /**\n   * Map metric metadata to SelectableValue for Select component and also adds defined template variables to the list.\n   */\n  const withTemplateVariableOptions = useCallback(\n    async (optionsPromise: Promise<SelectableValue[]>): Promise<SelectableValue[]> => {\n      const variables = datasource.getVariables();\n      const options = await optionsPromise;\n      return [\n        ...variables.map((value: string) => ({ label: value, value })),\n        ...options.map((option: SelectableValue) => ({\n          label: option.value,\n          value: option.value,\n          title: option.description,\n        })),\n      ];\n    },\n    [datasource]\n  );\n\n  /**\n   * Function kicked off when user interacts with label in label filters.\n   * Formats a promQL expression and passes that off to helper functions depending on API support\n   * @param forLabel\n   */\n  const onGetLabelNames = async (forLabel: Partial<QueryBuilderLabelFilter>): Promise<SelectableValue[]> => {\n    // If no metric we need to use a different method\n    if (!query.metric) {\n      await datasource.languageProvider.queryLabelKeys(timeRange);\n      return datasource.languageProvider.retrieveLabelKeys().map((k) => ({ value: k }));\n    }\n\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n    // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n    labelsToConsider.push({ label: '__name__', op: '=', value: query.metric });\n    const expr = promQueryModeller.renderLabels(labelsToConsider);\n\n    let labelsIndex: string[] = await datasource.languageProvider.queryLabelKeys(timeRange, expr);\n\n    // filter out already used labels\n    return labelsIndex\n      .filter((labelName) => !labelsToConsider.find((filter) => filter.label === labelName))\n      .map((k) => ({ value: k }));\n  };\n\n  const getLabelValuesAutocompleteSuggestions = async (\n    queryString?: string,\n    labelName?: string\n  ): Promise<SelectableValue[]> => {\n    const forLabel = {\n      label: labelName ?? '__name__',\n      op: '=~',\n      value: regexifyLabelValuesQueryString(`.*${queryString}`),\n    };\n    const labelsToConsider = query.labels.filter((x) => x.label !== forLabel.label);\n    labelsToConsider.push(forLabel);\n    if (query.metric) {\n      // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n      labelsToConsider.push({ label: '__name__', op: '=', value: query.metric });\n    }\n    const interpolatedLabelsToConsider = labelsToConsider.map((labelObject) => ({\n      ...labelObject,\n      label: datasource.interpolateString(labelObject.label),\n      value: datasource.interpolateString(labelObject.value),\n    }));\n    const expr = promQueryModeller.renderLabels(interpolatedLabelsToConsider);\n    const values = await datasource.languageProvider.queryLabelValues(timeRange, forLabel.label, expr);\n    return truncateResult(values).map(toSelectableValue);\n  };\n\n  /**\n   * Function kicked off when users interact with the value of the label filters\n   * Formats a promQL expression and passes that into helper functions depending on API support\n   * @param forLabel\n   */\n  const onGetLabelValues = async (forLabel: Partial<QueryBuilderLabelFilter>): Promise<SelectableValue[]> => {\n    if (!forLabel.label) {\n      return [];\n    }\n    // If no metric is selected, we can get the raw list of labels\n    if (!query.metric) {\n      return (await datasource.languageProvider.queryLabelValues(timeRange, forLabel.label)).map((v) => ({ value: v }));\n    }\n\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n    // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n    labelsToConsider.push({ label: '__name__', op: '=', value: query.metric });\n\n    const interpolatedLabelsToConsider = labelsToConsider.map((labelObject) => ({\n      ...labelObject,\n      label: datasource.interpolateString(labelObject.label),\n      value: datasource.interpolateString(labelObject.value),\n    }));\n\n    const expr = promQueryModeller.renderLabels(interpolatedLabelsToConsider);\n    return (await datasource.languageProvider.queryLabelValues(timeRange, forLabel.label, expr)).map(toSelectableValue);\n  };\n\n  const onGetMetrics = useCallback(() => {\n    return withTemplateVariableOptions(getMetrics(datasource, query, timeRange));\n  }, [datasource, query, timeRange, withTemplateVariableOptions]);\n\n  return (\n    <>\n      <MetricCombobox\n        query={query}\n        onChange={onChange}\n        onGetMetrics={onGetMetrics}\n        datasource={datasource}\n        labelsFilters={query.labels}\n        metricLookupDisabled={datasource.lookupsDisabled}\n        onBlur={onBlur ? onBlur : () => {}}\n        variableEditor={variableEditor}\n        timeRange={timeRange}\n      />\n      <LabelFilters\n        debounceDuration={getDebounceTimeInMilliseconds(datasource.cacheLevel)}\n        getLabelValuesAutofillSuggestions={getLabelValuesAutocompleteSuggestions}\n        labelsFilters={query.labels}\n        onChange={onChangeLabels}\n        onGetLabelNames={(forLabel) => withTemplateVariableOptions(onGetLabelNames(forLabel))}\n        onGetLabelValues={(forLabel) => withTemplateVariableOptions(onGetLabelValues(forLabel))}\n        variableEditor={variableEditor}\n      />\n    </>\n  );\n}\n\n/**\n * Returns list of metrics, either all or filtered by query param. It also adds description string to each metric if it\n * exists.\n * @param datasource\n * @param query\n * @param timeRange\n */\nasync function getMetrics(\n  datasource: PrometheusDatasource,\n  query: PromVisualQuery,\n  timeRange: TimeRange\n): Promise<Array<{ value: string; description?: string }>> {\n  // Makes sure we loaded the metadata for metrics. Usually this is done in the start() method of the provider but we\n  // don't use it with the visual builder and there is no need to run all the start() setup anyway.\n  const metadata = datasource.languageProvider.retrieveMetricsMetadata();\n  if (Object.keys(metadata).length === 0) {\n    await datasource.languageProvider.queryMetricsMetadata();\n  }\n\n  let metrics: string[];\n  const expr = promQueryModeller.renderLabels(query.labels);\n  metrics =\n    (await datasource.languageProvider.queryLabelValues(timeRange, '__name__', expr === '' ? undefined : expr)) ?? [];\n\n  return metrics.map((m) => ({\n    value: m,\n    description: getMetadataString(m, datasource.languageProvider.retrieveMetricsMetadata()),\n  }));\n}\n\nexport function getMetadataString(metric: string, metadata: PromMetricsMetadata): string | undefined {\n  if (!metadata[metric]) {\n    return;\n  }\n  const { type, help } = metadata[metric];\n  return `${type.toUpperCase()}: ${help}`;\n}\n\nfunction toSelectableValue(lv: string) {\n  return {\n    label: lv,\n    value: lv,\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/VariableQueryEditor.tsx\nimport debounce from 'debounce-promise';\nimport { FormEvent, useCallback, useEffect, useState } from 'react';\n\nimport { getDefaultTimeRange, QueryEditorProps, SelectableValue, toOption } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t, Trans } from '@grafana/i18n';\nimport { AsyncSelect, InlineField, InlineFieldRow, Input, Select, TextArea } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { truncateResult } from '../language_utils';\nimport {\n  migrateVariableEditorBackToVariableSupport,\n  migrateVariableQueryToEditor,\n} from '../migrations/variableMigration';\nimport { MetricsLabelsSection } from '../querybuilder/components/MetricsLabelsSection';\nimport { promQueryModeller } from '../querybuilder/shared/modeller_instance';\nimport { QueryBuilderLabelFilter } from '../querybuilder/shared/types';\nimport { PromVisualQuery } from '../querybuilder/types';\nimport {\n  PromOptions,\n  PromQuery,\n  PromVariableQuery,\n  PromVariableQueryType as QueryType,\n  StandardPromVariableQuery,\n} from '../types';\n\nexport const variableOptions = [\n  { label: 'Label names', value: QueryType.LabelNames },\n  { label: 'Label values', value: QueryType.LabelValues },\n  { label: 'Metrics', value: QueryType.MetricNames },\n  { label: 'Query result', value: QueryType.VarQueryResult },\n  { label: 'Series query', value: QueryType.SeriesQuery },\n  { label: 'Classic query', value: QueryType.ClassicQuery },\n];\n\nexport type Props = QueryEditorProps<PrometheusDatasource, PromQuery, PromOptions, PromVariableQuery>;\n\nconst refId = 'PrometheusVariableQueryEditor-VariableQuery';\n\nexport const PromVariableQueryEditor = ({ onChange, query, datasource, range }: Props) => {\n  // to select the query type, i.e. label_names, label_values, etc.\n  const [qryType, setQryType] = useState<number | undefined>(undefined);\n  // list of variables for each function\n  const [label, setLabel] = useState('');\n\n  const [labelNamesMatch, setLabelNamesMatch] = useState('');\n\n  // metric is used for both label_values() and metric()\n  // label_values() metric requires a whole/complete metric\n  // metric() is expected to be a part of a metric string\n  const [metric, setMetric] = useState('');\n  // varQuery is a whole query, can include math/rates/etc\n  const [varQuery, setVarQuery] = useState('');\n  // seriesQuery is only a whole\n  const [seriesQuery, setSeriesQuery] = useState('');\n\n  // the original variable query implementation, e.g. label_value(metric, label_name)\n  const [classicQuery, setClassicQuery] = useState('');\n\n  // list of label names for label_values(), /api/v1/labels, contains the same results as label_names() function\n  const [truncatedLabelOptions, setTruncatedLabelOptions] = useState<Array<SelectableValue<string>>>([]);\n  const [allLabelOptions, setAllLabelOptions] = useState<Array<SelectableValue<string>>>([]);\n\n  /**\n   * Set the both allLabels and truncatedLabels\n   *\n   * @param names\n   * @param variables\n   */\n  function setLabels(names: SelectableValue[], variables: SelectableValue[]) {\n    setAllLabelOptions([...variables, ...names]);\n    const truncatedNames = truncateResult(names);\n    setTruncatedLabelOptions([...variables, ...truncatedNames]);\n  }\n\n  // label filters have been added as a filter for metrics in label values query type\n  const [labelFilters, setLabelFilters] = useState<QueryBuilderLabelFilter[]>([]);\n\n  useEffect(() => {\n    datasource.languageProvider.start(range);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!query) {\n      return;\n    }\n\n    if (query.qryType === QueryType.ClassicQuery) {\n      setQryType(query.qryType);\n      setClassicQuery(query.query ?? '');\n    } else {\n      // 1. Changing from standard to custom variable editor changes the string attr from expr to query\n      // 2. jsonnet grafana as code passes a variable as a string\n      const variableQuery = variableMigration(query);\n\n      setLabelNamesMatch(variableQuery.match ?? '');\n      setQryType(variableQuery.qryType);\n      setLabel(variableQuery.label ?? '');\n      setMetric(variableQuery.metric ?? '');\n      setLabelFilters(variableQuery.labelFilters ?? []);\n      setVarQuery(variableQuery.varQuery ?? '');\n      setSeriesQuery(variableQuery.seriesQuery ?? '');\n      setClassicQuery(variableQuery.classicQuery ?? '');\n    }\n  }, [query]);\n\n  // set the label names options for the label values var query\n  useEffect(() => {\n    if (qryType !== QueryType.LabelValues) {\n      return;\n    }\n    const variables = datasource.getVariables().map((variable: string) => ({ label: variable, value: variable }));\n    let timeRange = range;\n    if (!timeRange) {\n      timeRange = getDefaultTimeRange();\n    }\n\n    if (!metric) {\n      // get all the labels\n      datasource.getTagKeys({ timeRange, filters: [] }).then((labelNames: Array<{ text: string }>) => {\n        const names = labelNames.map(({ text }) => ({ label: text, value: text }));\n        setLabels(names, variables);\n      });\n    } else {\n      // fetch the labels filtered by the metric\n      // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n      const labelToConsider = [{ label: '__name__', op: '=', value: metric }];\n      const expr = promQueryModeller.renderLabels(labelToConsider);\n\n      datasource.languageProvider.queryLabelKeys(timeRange, expr).then((labelNames: string[]) => {\n        const names = labelNames.map((value) => ({ label: value, value: value }));\n        setLabels(names, variables);\n      });\n    }\n  }, [datasource, qryType, metric, range]);\n\n  const onChangeWithVariableString = (\n    updateVar: { [key: string]: QueryType | string },\n    updLabelFilters?: QueryBuilderLabelFilter[]\n  ) => {\n    const queryVar = {\n      qryType,\n      label,\n      metric,\n      match: labelNamesMatch,\n      varQuery,\n      seriesQuery,\n      classicQuery,\n      refId: 'PrometheusVariableQueryEditor-VariableQuery',\n    };\n\n    let updateLabelFilters = updLabelFilters ? { labelFilters: updLabelFilters } : { labelFilters: labelFilters };\n\n    const updatedVar = { ...queryVar, ...updateVar, ...updateLabelFilters };\n\n    const queryString = migrateVariableEditorBackToVariableSupport(updatedVar);\n\n    // setting query.query property allows for update of variable definition\n    onChange({\n      query: queryString,\n      qryType: updatedVar.qryType,\n      refId,\n    });\n  };\n\n  /** Call onchange for label names query type change */\n  const onQueryTypeChange = (newType: SelectableValue<QueryType>) => {\n    setQryType(newType.value);\n    if (newType.value !== QueryType.SeriesQuery) {\n      onChangeWithVariableString({ qryType: newType.value ?? 0 });\n    }\n  };\n\n  /** Call onchange for label select when query type is label values */\n  const onLabelChange = (newLabel: SelectableValue<string>) => {\n    const newLabelvalue = newLabel && newLabel.value ? newLabel.value : '';\n    setLabel(newLabelvalue);\n    if (qryType === QueryType.LabelValues && newLabelvalue) {\n      onChangeWithVariableString({ label: newLabelvalue });\n    }\n  };\n\n  /**\n   * Call onChange for MetricsLabels component change for label values query type\n   * if there is a label (required) and\n   * if the labels or metric are updated.\n   */\n  const metricsLabelsChange = (update: PromVisualQuery) => {\n    setMetric(update.metric);\n    setLabelFilters(update.labels);\n\n    const updMetric = update.metric;\n    const updLabelFilters = update.labels ?? [];\n\n    if (qryType === QueryType.LabelValues && label && (updMetric || updLabelFilters)) {\n      onChangeWithVariableString({ qryType, metric: updMetric }, updLabelFilters);\n    }\n  };\n\n  const onLabelNamesMatchChange = (regex: string) => {\n    if (qryType === QueryType.LabelNames) {\n      onChangeWithVariableString({ qryType, match: regex });\n    }\n  };\n\n  /**\n   * Call onchange for metric change if metrics names (regex) query type\n   * Debounce this because to not call the API for every keystroke.\n   */\n  const onMetricChange = (value: string) => {\n    if (qryType === QueryType.MetricNames && value) {\n      onChangeWithVariableString({ metric: value });\n    }\n  };\n\n  /**\n   *  Do not call onchange for variable query result when query type is var query result\n   *  because the query may not be finished typing and an error is returned\n   *  for incorrectly formatted series. Call onchange for blur instead.\n   */\n  const onVarQueryChange = (e: FormEvent<HTMLTextAreaElement>) => {\n    setVarQuery(e.currentTarget.value);\n  };\n\n  /**\n   *  Do not call onchange for seriesQuery when query type is series query\n   *  because the series may not be finished typing and an error is returned\n   *  for incorrectly formatted series. Call onchange for blur instead.\n   */\n  const onSeriesQueryChange = (e: FormEvent<HTMLInputElement>) => {\n    setSeriesQuery(e.currentTarget.value);\n  };\n\n  const onClassicQueryChange = (e: FormEvent<HTMLInputElement>) => {\n    setClassicQuery(e.currentTarget.value);\n  };\n\n  const promVisualQuery = useCallback(() => {\n    return { metric: metric, labels: labelFilters, operations: [] };\n  }, [metric, labelFilters]);\n\n  /**\n   * Debounce a search through all the labels possible and truncate by .\n   */\n  const labelNamesSearch = debounce((query: string) => {\n    // we limit the select to show 1000 options,\n    // but we still search through all the possible options\n    const results = allLabelOptions.filter((label) => {\n      return label.value?.includes(query);\n    });\n    return truncateResult(results);\n  }, 300);\n\n  return (\n    <>\n      <InlineFieldRow>\n        <InlineField\n          label={t('grafana-prometheus.components.prom-variable-query-editor.label-query-type', 'Query type')}\n          labelWidth={20}\n          tooltip={\n            <div>\n              <Trans i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-query-type\">\n                The Prometheus data source plugin provides the following query types for template variables.\n              </Trans>\n            </div>\n          }\n        >\n          <Select\n            placeholder={t(\n              'grafana-prometheus.components.prom-variable-query-editor.placeholder-select-query-type',\n              'Select query type'\n            )}\n            aria-label={t(\n              'grafana-prometheus.components.prom-variable-query-editor.aria-label-query-type',\n              'Query type'\n            )}\n            onChange={onQueryTypeChange}\n            value={qryType}\n            options={variableOptions}\n            width={25}\n            data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.queryType}\n          />\n        </InlineField>\n      </InlineFieldRow>\n\n      {qryType === QueryType.LabelValues && (\n        <>\n          <InlineFieldRow>\n            <InlineField\n              label={t('grafana-prometheus.components.prom-variable-query-editor.label-label', 'Label')}\n              labelWidth={20}\n              required\n              aria-labelledby=\"label-select\"\n              tooltip={\n                <div>\n                  <Trans i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-label\">\n                    Returns a list of label values for the label name in all metrics unless the metric is specified.\n                  </Trans>\n                </div>\n              }\n            >\n              <AsyncSelect\n                onChange={onLabelChange}\n                value={label ? toOption(label) : null}\n                defaultOptions={truncatedLabelOptions}\n                width={25}\n                allowCustomValue\n                isClearable={true}\n                loadOptions={labelNamesSearch}\n                data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.labelValues.labelSelect}\n              />\n            </InlineField>\n          </InlineFieldRow>\n          {/* Used to select an optional metric with optional label filters */}\n          <MetricsLabelsSection\n            query={promVisualQuery()}\n            datasource={datasource}\n            onChange={metricsLabelsChange}\n            variableEditor={true}\n            timeRange={range ?? getDefaultTimeRange()}\n          />\n        </>\n      )}\n\n      {qryType === QueryType.LabelNames && (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.components.prom-variable-query-editor.label-metric-regex', 'Metric regex')}\n            labelWidth={20}\n            aria-labelledby=\"Metric regex\"\n            tooltip={\n              <div>\n                <Trans i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-metric-regex\">\n                  Returns a list of label names, optionally filtering by specified metric regex.\n                </Trans>\n              </div>\n            }\n          >\n            <Input\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.prom-variable-query-editor.aria-label-metric-regex',\n                'Metric regex'\n              )}\n              placeholder={t(\n                'grafana-prometheus.components.prom-variable-query-editor.placeholder-metric-regex',\n                'Metric regex'\n              )}\n              value={labelNamesMatch}\n              onBlur={(event) => {\n                setLabelNamesMatch(event.currentTarget.value);\n                onLabelNamesMatchChange(event.currentTarget.value);\n              }}\n              onChange={(e) => {\n                setLabelNamesMatch(e.currentTarget.value);\n              }}\n              width={25}\n              data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.labelnames.metricRegex}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n\n      {qryType === QueryType.MetricNames && (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.components.prom-variable-query-editor.label-metric-regex', 'Metric regex')}\n            labelWidth={20}\n            aria-labelledby=\"Metric selector\"\n            tooltip={\n              <div>\n                <Trans i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.returns-metrics-matching-specified-metric-regex\">\n                  Returns a list of metrics matching the specified metric regex.\n                </Trans>\n              </div>\n            }\n          >\n            <Input\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.prom-variable-query-editor.aria-label-metric-selector',\n                'Metric selector'\n              )}\n              placeholder={t(\n                'grafana-prometheus.components.prom-variable-query-editor.placeholder-metric-regex',\n                'Metric regex'\n              )}\n              value={metric}\n              onChange={(e) => {\n                setMetric(e.currentTarget.value);\n              }}\n              onBlur={(e) => {\n                setMetric(e.currentTarget.value);\n                onMetricChange(e.currentTarget.value);\n              }}\n              width={25}\n              data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.metricNames.metricRegex}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n\n      {qryType === QueryType.VarQueryResult && (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.components.prom-variable-query-editor.label-query', 'Query')}\n            labelWidth={20}\n            tooltip={\n              <div>\n                <Trans\n                  i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-query\"\n                  values={{ exampleQuery: 'sum(go_goroutines)' }}\n                >\n                  Returns a list of Prometheus query results for the query. This can include Prometheus functions, i.e.\n                  {'{{exampleQuery}}'}.\n                </Trans>\n              </div>\n            }\n          >\n            <TextArea\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.prom-variable-query-editor.aria-label-prometheus-query',\n                'Prometheus Query'\n              )}\n              placeholder={t(\n                'grafana-prometheus.components.prom-variable-query-editor.placeholder-prometheus-query',\n                'Prometheus Query'\n              )}\n              value={varQuery}\n              onChange={onVarQueryChange}\n              onBlur={() => {\n                if (qryType === QueryType.VarQueryResult && varQuery) {\n                  onChangeWithVariableString({ qryType });\n                }\n              }}\n              cols={100}\n              data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.varQueryResult}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n\n      {qryType === QueryType.SeriesQuery && (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.components.prom-variable-query-editor.label-series-query', 'Series Query')}\n            labelWidth={20}\n            tooltip={\n              <div>\n                <Trans\n                  i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-series-query\"\n                  values={{\n                    example1: 'go_goroutines{instance=\"localhost:9090\"}',\n                    example2: 'go_goroutines',\n                    example3: '{instance=\"localhost:9090\"}',\n                  }}\n                >\n                  Enter a metric with labels, only a metric or only labels, i.e.\n                  {'{{example1}}'}, {'{{example2}}'}, or {'{{example3}}'}. Returns a list of time series associated with\n                  the entered data.\n                </Trans>\n              </div>\n            }\n          >\n            <Input\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.prom-variable-query-editor.aria-label-series-query',\n                'Series Query'\n              )}\n              placeholder={t(\n                'grafana-prometheus.components.prom-variable-query-editor.placeholder-series-query',\n                'Series Query'\n              )}\n              value={seriesQuery}\n              onChange={onSeriesQueryChange}\n              onBlur={() => {\n                if (qryType === QueryType.SeriesQuery && seriesQuery) {\n                  onChangeWithVariableString({ qryType });\n                }\n              }}\n              width={100}\n              data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.seriesQuery}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n\n      {qryType === QueryType.ClassicQuery && (\n        <InlineFieldRow>\n          <InlineField\n            label={t('grafana-prometheus.components.prom-variable-query-editor.label-classic-query', 'Classic Query')}\n            labelWidth={20}\n            tooltip={\n              <div>\n                <Trans\n                  i18nKey=\"grafana-prometheus.components.prom-variable-query-editor.tooltip-classic-query\"\n                  values={{\n                    exampleQuery: 'label_values(metric, label)',\n                  }}\n                >\n                  The original implementation of the Prometheus variable query editor. Enter a string with the correct\n                  query type and parameters as described in these docs. For example, {'{{exampleQuery}}'}.\n                </Trans>\n              </div>\n            }\n          >\n            <Input\n              type=\"text\"\n              aria-label={t(\n                'grafana-prometheus.components.prom-variable-query-editor.aria-label-classic-query',\n                'Classic Query'\n              )}\n              placeholder={t(\n                'grafana-prometheus.components.prom-variable-query-editor.placeholder-classic-query',\n                'Classic Query'\n              )}\n              value={classicQuery}\n              onChange={onClassicQueryChange}\n              onBlur={() => {\n                if (qryType === QueryType.ClassicQuery && classicQuery) {\n                  onChangeWithVariableString({ qryType });\n                }\n              }}\n              width={100}\n              data-testid={selectors.components.DataSource.Prometheus.variableQueryEditor.classicQuery}\n            />\n          </InlineField>\n        </InlineFieldRow>\n      )}\n    </>\n  );\n};\n\nexport function variableMigration(query: string | PromVariableQuery | StandardPromVariableQuery): PromVariableQuery {\n  if (typeof query === 'string') {\n    return migrateVariableQueryToEditor(query);\n  } else if (query.query) {\n    return migrateVariableQueryToEditor(query.query);\n  } else {\n    return query;\n  }\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/variables.ts\nimport { from, Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { CustomVariableSupport, DataQueryRequest, DataQueryResponse, rangeUtil } from '@grafana/data';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\n\nimport { PromVariableQueryEditor } from './components/VariableQueryEditor';\nimport { PrometheusDatasource } from './datasource';\nimport { PrometheusMetricFindQuery } from './metric_find_query';\nimport { PromVariableQuery } from './types';\n\nexport class PrometheusVariableSupport extends CustomVariableSupport<PrometheusDatasource> {\n  constructor(\n    private readonly datasource: PrometheusDatasource,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super();\n  }\n\n  editor = PromVariableQueryEditor;\n\n  query(request: DataQueryRequest<PromVariableQuery>): Observable<DataQueryResponse> {\n    // Handling grafana as code from jsonnet variable queries which are strings and not objects\n    // Previously, when using StandardVariableSupport\n    // the variable query string was changed to be on the expr attribute\n    // Now, using CustomVariableSupport,\n    // the variable query is changed to the query attribute.\n    // So, without standard variable support changing the query string to the expr attribute,\n    // the variable query string is coming in as it is written in jsonnet,\n    // where it is just a string. Here is where we handle that.\n    let query: string | undefined;\n    if (typeof request.targets[0] === 'string') {\n      query = request.targets[0];\n    } else {\n      query = request.targets[0].query;\n    }\n\n    if (!query) {\n      return of({ data: [] });\n    }\n\n    const scopedVars = {\n      ...request.scopedVars,\n      __interval: { text: this.datasource.interval, value: this.datasource.interval },\n      __interval_ms: {\n        text: rangeUtil.intervalToMs(this.datasource.interval),\n        value: rangeUtil.intervalToMs(this.datasource.interval),\n      },\n      ...this.datasource.getRangeScopedVars(request.range),\n    };\n\n    const interpolated = this.templateSrv.replace(query, scopedVars, this.datasource.interpolateQueryExpr);\n    const metricFindQuery = new PrometheusMetricFindQuery(this.datasource, interpolated);\n    const metricFindStream = from(metricFindQuery.process(request.range));\n\n    return metricFindStream.pipe(map((results) => ({ data: results })));\n  }\n}\n","import { defaults } from 'lodash';\nimport { tz } from 'moment-timezone';\nimport { lastValueFrom, Observable, throwError } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { gte } from 'semver';\n\nimport {\n  AbstractQuery,\n  AdHocVariableFilter,\n  CoreApp,\n  CustomVariableModel,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceGetTagKeysOptions,\n  DataSourceGetTagValuesOptions,\n  DataSourceInstanceSettings,\n  DataSourceWithQueryExportSupport,\n  DataSourceWithQueryImportSupport,\n  dateTime,\n  getDefaultTimeRange,\n  LegacyMetricFindQueryOptions,\n  MetricFindValue,\n  QueryFixAction,\n  QueryVariableModel,\n  rangeUtil,\n  ScopedVars,\n  scopeFilterOperatorMap,\n  ScopeSpecFilter,\n  TimeRange,\n} from '@grafana/data';\nimport {\n  BackendSrvRequest,\n  config,\n  DataSourceWithBackend,\n  FetchResponse,\n  getBackendSrv,\n  getTemplateSrv,\n  isFetchError,\n  TemplateSrv,\n} from '@grafana/runtime';\n\nimport { addLabelToQuery } from './add_label_to_query';\nimport { PrometheusAnnotationSupport } from './annotations';\nimport {\n  DEFAULT_SERIES_LIMIT,\n  GET_AND_POST_METADATA_ENDPOINTS,\n  InstantQueryRefIdIndex,\n  SUGGESTIONS_LIMIT,\n} from './constants';\nimport { prometheusRegularEscape, prometheusSpecialRegexEscape } from './escaping';\nimport {\n  exportToAbstractQuery,\n  importFromAbstractQuery,\n  populateMatchParamsFromQueries,\n  PrometheusLanguageProvider,\n  PrometheusLanguageProviderInterface,\n} from './language_provider';\nimport { expandRecordingRules, getPrometheusTime, getRangeSnapInterval } from './language_utils';\nimport { PrometheusMetricFindQuery } from './metric_find_query';\nimport { getQueryHints } from './query_hints';\nimport { renderLabelsWithoutBrackets } from './querybuilder/shared/rendering/labels';\nimport { QueryBuilderLabelFilter, QueryEditorMode } from './querybuilder/shared/types';\nimport { CacheRequestInfo, defaultPrometheusQueryOverlapWindow, QueryCache } from './querycache/QueryCache';\nimport { transformV2 } from './result_transformer';\nimport { trackQuery } from './tracking';\nimport {\n  ExemplarTraceIdDestination,\n  PromApplication,\n  PrometheusCacheLevel,\n  PromOptions,\n  PromQuery,\n  PromQueryRequest,\n  RawRecordingRules,\n  RuleQueryMapping,\n} from './types';\nimport { utf8Support, wrapUtf8Filters } from './utf8_support';\nimport { PrometheusVariableSupport } from './variables';\n\nexport class PrometheusDatasource\n  extends DataSourceWithBackend<PromQuery, PromOptions>\n  implements DataSourceWithQueryImportSupport<PromQuery>, DataSourceWithQueryExportSupport<PromQuery>\n{\n  access: 'direct' | 'proxy';\n  basicAuth: any;\n  cache: QueryCache<PromQuery>;\n  cacheLevel: PrometheusCacheLevel;\n  customQueryParameters: URLSearchParams;\n  datasourceConfigurationPrometheusFlavor?: PromApplication;\n  datasourceConfigurationPrometheusVersion?: string;\n  disableRecordingRules: boolean;\n  exemplarTraceIdDestinations: ExemplarTraceIdDestination[] | undefined;\n  exemplarsAvailable: boolean;\n  hasIncrementalQuery: boolean;\n  httpMethod: string;\n  id: number;\n  interval: string;\n  languageProvider: PrometheusLanguageProviderInterface;\n  lookupsDisabled: boolean;\n  metricNamesAutocompleteSuggestionLimit: number;\n  ruleMappings: RuleQueryMapping;\n  seriesEndpoint: boolean;\n  seriesLimit: number;\n  type: string;\n  url: string;\n  withCredentials: boolean;\n  defaultEditor?: QueryEditorMode;\n\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<PromOptions>,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv(),\n    languageProvider?: PrometheusLanguageProviderInterface\n  ) {\n    super(instanceSettings);\n\n    // DATASOURCE CONFIGURATION PROPERTIES\n    this.access = instanceSettings.access;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.cache = new QueryCache({\n      getTargetSignature: this.getPrometheusTargetSignature.bind(this),\n      overlapString: instanceSettings.jsonData.incrementalQueryOverlapWindow ?? defaultPrometheusQueryOverlapWindow,\n      applyInterpolation: this.interpolateString.bind(this),\n    });\n    this.cacheLevel = instanceSettings.jsonData.cacheLevel ?? PrometheusCacheLevel.Low;\n    this.customQueryParameters = new URLSearchParams(instanceSettings.jsonData.customQueryParameters);\n    this.datasourceConfigurationPrometheusFlavor = instanceSettings.jsonData.prometheusType;\n    this.datasourceConfigurationPrometheusVersion = instanceSettings.jsonData.prometheusVersion;\n    this.disableRecordingRules = instanceSettings.jsonData.disableRecordingRules ?? false;\n    this.exemplarTraceIdDestinations = instanceSettings.jsonData.exemplarTraceIdDestinations;\n    this.exemplarsAvailable = true;\n    this.hasIncrementalQuery = instanceSettings.jsonData.incrementalQuerying ?? false;\n    this.httpMethod = instanceSettings.jsonData.httpMethod || 'GET';\n    this.id = instanceSettings.id;\n    this.interval = instanceSettings.jsonData.timeInterval || '15s';\n    this.lookupsDisabled = instanceSettings.jsonData.disableMetricsLookup ?? false;\n    this.metricNamesAutocompleteSuggestionLimit =\n      instanceSettings.jsonData.codeModeMetricNamesSuggestionLimit ?? SUGGESTIONS_LIMIT;\n    this.ruleMappings = {};\n    this.seriesEndpoint = instanceSettings.jsonData.seriesEndpoint ?? false;\n    this.seriesLimit = instanceSettings.jsonData.seriesLimit ?? DEFAULT_SERIES_LIMIT;\n    this.type = 'prometheus';\n    this.url = instanceSettings.url!;\n    this.withCredentials = Boolean(instanceSettings.withCredentials);\n    this.defaultEditor = instanceSettings.jsonData.defaultEditor;\n\n    // INHERITED PROPERTIES\n    this.annotations = PrometheusAnnotationSupport(this);\n    this.variables = new PrometheusVariableSupport(this, this.templateSrv);\n\n    // LANGUAGE PROVIDER\n    // This needs to be the last thing we initialize.\n    this.languageProvider = languageProvider ?? new PrometheusLanguageProvider(this);\n  }\n\n  /**\n   * Initializes the Prometheus datasource by loading recording rules and checking exemplar availability.\n   *\n   * This method performs two key initialization tasks: Loads recording rules from the\n   * Prometheus API and checks if exemplars are available by testing the exemplars API endpoint.\n   */\n  init = async (): Promise<void> => {\n    if (!this.disableRecordingRules) {\n      this.loadRules();\n    }\n    this.exemplarsAvailable = await this.areExemplarsAvailable();\n  };\n\n  /**\n   * Loads recording rules from the Prometheus API and extracts rule mappings.\n   *\n   * This method fetches rules from the `/api/v1/rules` endpoint and processes\n   * them to create a mapping of rule names to their corresponding queries and labels.\n   * The rules API is experimental, so errors are logged but not thrown.\n   */\n  private async loadRules(): Promise<void> {\n    try {\n      const params = {};\n      const options = { showErrorAlert: false };\n      const res = await this.metadataRequest('/api/v1/rules', params, options);\n      const ruleGroups = res.data?.data?.groups;\n\n      if (ruleGroups) {\n        this.ruleMappings = extractRuleMappingFromGroups(ruleGroups);\n      }\n    } catch (err) {\n      console.log('Rules API is experimental. Ignore next error.');\n      console.error(err);\n    }\n  }\n\n  /**\n   * Checks if exemplars are available by testing the exemplars API endpoint.\n   *\n   * This method makes a test request to the `/api/v1/query_exemplars` endpoint to determine\n   * if the Prometheus instance supports exemplars. The test uses a simple query with a\n   * 30-minute time range. If the request succeeds with a 'success' status, exemplars\n   * are considered available. Errors are caught and return false to avoid breaking\n   * the datasource initialization.\n   */\n  private async areExemplarsAvailable(): Promise<boolean> {\n    try {\n      const params = {\n        query: 'test',\n        start: dateTime().subtract(30, 'minutes').valueOf().toString(),\n        end: dateTime().valueOf().toString(),\n      };\n      const options = { showErrorAlert: false };\n      const res = await this.metadataRequest('/api/v1/query_exemplars', params, options);\n\n      return res.data.status === 'success';\n    } catch (err) {\n      return false;\n    }\n  }\n\n  getQueryDisplayText(query: PromQuery) {\n    return query.expr;\n  }\n\n  /**\n   * Get target signature for query caching\n   * @param request\n   * @param query\n   */\n  getPrometheusTargetSignature(request: DataQueryRequest<PromQuery>, query: PromQuery) {\n    const targExpr = this.interpolateString(query.expr);\n    return `${targExpr}|${query.interval ?? request.interval}|${JSON.stringify(request.rangeRaw ?? '')}|${\n      query.exemplar\n    }`;\n  }\n\n  hasLabelsMatchAPISupport(): boolean {\n    // users may choose the series endpoint as it has a POST method\n    // while the label values is only GET\n    if (this.seriesEndpoint) {\n      return false;\n    }\n\n    return (\n      // https://github.com/prometheus/prometheus/releases/tag/v2.24.0\n      this._isDatasourceVersionGreaterOrEqualTo('2.24.0', PromApplication.Prometheus) ||\n      // All versions of Mimir support matchers for labels API\n      this._isDatasourceVersionGreaterOrEqualTo('2.0.0', PromApplication.Mimir) ||\n      // https://github.com/cortexproject/cortex/discussions/4542\n      this._isDatasourceVersionGreaterOrEqualTo('1.11.0', PromApplication.Cortex) ||\n      // https://github.com/thanos-io/thanos/pull/3566\n      //https://github.com/thanos-io/thanos/releases/tag/v0.18.0\n      this._isDatasourceVersionGreaterOrEqualTo('0.18.0', PromApplication.Thanos)\n    );\n  }\n\n  _isDatasourceVersionGreaterOrEqualTo(targetVersion: string, targetFlavor: PromApplication): boolean {\n    // User hasn't configured flavor/version yet, default behavior is to support labels match api support\n    if (!this.datasourceConfigurationPrometheusVersion || !this.datasourceConfigurationPrometheusFlavor) {\n      return true;\n    }\n\n    if (targetFlavor !== this.datasourceConfigurationPrometheusFlavor) {\n      return false;\n    }\n\n    return gte(this.datasourceConfigurationPrometheusVersion, targetVersion);\n  }\n\n  _addTracingHeaders(httpOptions: PromQueryRequest, options: DataQueryRequest<PromQuery>) {\n    httpOptions.headers = {};\n    if (this.access === 'proxy') {\n      httpOptions.headers['X-Dashboard-UID'] = options.dashboardUID;\n      httpOptions.headers['X-Panel-Id'] = options.panelId;\n    }\n  }\n\n  directAccessError() {\n    return throwError(\n      () =>\n        new Error(\n          'Browser access mode in the Prometheus datasource is no longer available. Switch to server access mode.'\n        )\n    );\n  }\n\n  /**\n   * Any request done from this data source should go through here as it contains some common processing for the\n   * request. Any processing done here needs to be also copied on the backend as this goes through data source proxy\n   * but not through the same code as alerting.\n   */\n  _request<T = unknown>(\n    url: string,\n    data: Record<string, string> | null,\n    overrides: Partial<BackendSrvRequest> = {}\n  ): Observable<FetchResponse<T>> {\n    if (this.access === 'direct') {\n      return this.directAccessError();\n    }\n\n    data = data || {};\n    for (const [key, value] of this.customQueryParameters) {\n      if (data[key] == null) {\n        data[key] = value;\n      }\n    }\n\n    let queryUrl = this.url + url;\n    if (url.startsWith(`/api/datasources/uid/${this.uid}`)) {\n      // This url is meant to be a replacement for the whole URL. Replace the entire URL\n      queryUrl = url;\n    }\n\n    const options: BackendSrvRequest = defaults(overrides, {\n      url: queryUrl,\n      method: this.httpMethod,\n      headers: {},\n    });\n\n    if (options.method === 'GET') {\n      if (data && Object.keys(data).length) {\n        options.url =\n          options.url +\n          (options.url.search(/\\?/) >= 0 ? '&' : '?') +\n          Object.entries(data)\n            .map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n            .join('&');\n      }\n    } else {\n      if (!options.headers!['Content-Type']) {\n        options.headers!['Content-Type'] = 'application/x-www-form-urlencoded';\n      }\n      options.data = data;\n    }\n\n    if (this.basicAuth || this.withCredentials) {\n      options.withCredentials = true;\n    }\n\n    if (this.basicAuth) {\n      options.headers!.Authorization = this.basicAuth;\n    }\n\n    return getBackendSrv().fetch<T>(options);\n  }\n\n  async importFromAbstractQueries(abstractQueries: AbstractQuery[]): Promise<PromQuery[]> {\n    return abstractQueries.map((abstractQuery) => importFromAbstractQuery(abstractQuery));\n  }\n\n  async exportToAbstractQueries(queries: PromQuery[]): Promise<AbstractQuery[]> {\n    return queries.map((query) => exportToAbstractQuery(query));\n  }\n\n  // Use this for tab completion features, wont publish response to other components\n  async metadataRequest<T = any>(url: string, params = {}, options?: Partial<BackendSrvRequest>) {\n    // If URL includes endpoint that supports POST and GET method, try to use configured method. This might fail as POST is supported only in v2.10+.\n    if (GET_AND_POST_METADATA_ENDPOINTS.some((endpoint) => url.includes(endpoint))) {\n      try {\n        return await lastValueFrom(\n          this._request<T>(`/api/datasources/uid/${this.uid}/resources${url}`, params, {\n            method: this.httpMethod,\n            hideFromInspector: true,\n            showErrorAlert: false,\n            ...options,\n          })\n        );\n      } catch (err) {\n        // If status code of error is Method Not Allowed (405) and HTTP method is POST, retry with GET\n        if (this.httpMethod === 'POST' && isFetchError(err) && (err.status === 405 || err.status === 400)) {\n          console.warn(`Couldn't use configured POST HTTP method for this request. Trying to use GET method instead.`);\n        } else {\n          throw err;\n        }\n      }\n    }\n\n    return await lastValueFrom(\n      this._request<T>(`/api/datasources/uid/${this.uid}/resources${url}`, params, {\n        method: 'GET',\n        hideFromInspector: true,\n        ...options,\n      })\n    ); // toPromise until we change getTagValues, getLabelNames to Observable\n  }\n\n  interpolateQueryExpr(value: string | string[] = [], variable: QueryVariableModel | CustomVariableModel) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return prometheusRegularEscape(value);\n    }\n\n    if (typeof value === 'string') {\n      return prometheusSpecialRegexEscape(value);\n    }\n\n    const escapedValues = value.map((val) => prometheusSpecialRegexEscape(val));\n\n    if (escapedValues.length === 1) {\n      return escapedValues[0];\n    }\n\n    return '(' + escapedValues.join('|') + ')';\n  }\n\n  targetContainsTemplate(target: PromQuery) {\n    return this.templateSrv.containsTemplate(target.expr);\n  }\n\n  shouldRunExemplarQuery(target: PromQuery, request: DataQueryRequest<PromQuery>): boolean {\n    if (target.exemplar) {\n      // We check all already processed targets and only create exemplar target for not used metric names\n      const metricName = this.languageProvider.retrieveHistogramMetrics().find((m) => target.expr.includes(m));\n      // Remove targets that weren't processed yet (in targets array they are after current target)\n      const currentTargetIdx = request.targets.findIndex((t) => t.refId === target.refId);\n      const targets = request.targets.slice(0, currentTargetIdx).filter((t) => !t.hide);\n\n      if (!metricName || (metricName && !targets.some((t) => t.expr.includes(metricName)))) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  processTargetV2(target: PromQuery, request: DataQueryRequest<PromQuery>) {\n    // The `utcOffsetSec` parameter is required by the backend to correctly align time ranges.\n    // This alignment ensures that relative time ranges (e.g., \"Last N hours/days/years\") are adjusted\n    // according to the user's selected time zone, rather than defaulting to UTC.\n    //\n    // Example: If the user selects \"Last 5 days,\" each day should begin at 00:00 in the chosen time zone,\n    // rather than at 00:00 UTC, ensuring an accurate breakdown.\n    //\n    // This adjustment does not apply to absolute time ranges, where users explicitly set\n    // the start and end timestamps.\n    //\n    // Handling `utcOffsetSec`:\n    // - When using the browser's time zone, the UTC offset is derived from the request range object.\n    // - When the user selects a custom time zone, the UTC offset must be calculated accordingly.\n    // More details:\n    // - Issue that led to the introduction of utcOffsetSec: https://github.com/grafana/grafana/issues/17278\n    // - Implementation PR: https://github.com/grafana/grafana/pull/17477\n    let utcOffset = request.range.to.utcOffset();\n    if (request.timezone === 'browser') {\n      // we need to check if the request is a relative or absolute range.\n      // if it is absolute time range then utcOffset must be 0. we don't care the offset\n      // because we are already sending the from and to values in utc. we don't need to adjust them again\n      // for relative ranges we need utcOffset to adjust query range.\n      utcOffset = this.isUsingRelativeTimeRange(request.range) ? utcOffset : 0;\n    } else {\n      utcOffset = tz(request.timezone).utcOffset();\n    }\n\n    const processedTargets: PromQuery[] = [];\n    const processedTarget = {\n      ...target,\n      exemplar: this.shouldRunExemplarQuery(target, request),\n      requestId: request.panelId + target.refId,\n      utcOffsetSec: utcOffset * 60,\n    };\n\n    if (config.featureToggles.promQLScope) {\n      processedTarget.scopes = (request.scopes ?? []).map((scope) => ({\n        name: scope.metadata.name,\n        ...scope.spec,\n      }));\n    }\n\n    if (config.featureToggles.groupByVariable) {\n      processedTarget.groupByKeys = request.groupByKeys;\n    }\n\n    if (target.instant && target.range) {\n      // We have query type \"Both\" selected\n      // We should send separate queries with different refId\n      processedTargets.push(\n        {\n          ...processedTarget,\n          refId: processedTarget.refId,\n          instant: false,\n        },\n        {\n          ...processedTarget,\n          refId: processedTarget.refId + InstantQueryRefIdIndex,\n          range: false,\n          exemplar: false,\n        }\n      );\n    } else {\n      processedTargets.push(processedTarget);\n    }\n\n    return processedTargets;\n  }\n\n  query(request: DataQueryRequest<PromQuery>): Observable<DataQueryResponse> {\n    if (this.access === 'direct') {\n      return this.directAccessError();\n    }\n\n    let fullOrPartialRequest: DataQueryRequest<PromQuery>;\n    let requestInfo: CacheRequestInfo<PromQuery> | undefined = undefined;\n    const hasInstantQuery = request.targets.some((target) => target.instant);\n\n    // Don't cache instant queries\n    if (this.hasIncrementalQuery && !hasInstantQuery) {\n      requestInfo = this.cache.requestInfo(request);\n      fullOrPartialRequest = requestInfo.requests[0];\n    } else {\n      fullOrPartialRequest = request;\n    }\n\n    const targets = fullOrPartialRequest.targets.map((target) => this.processTargetV2(target, fullOrPartialRequest));\n    const startTime = new Date();\n    return super.query({ ...fullOrPartialRequest, targets: targets.flat() }).pipe(\n      map((response) => {\n        const amendedResponse = {\n          ...response,\n          data: this.cache.procFrames(request, requestInfo, response.data),\n        };\n        return transformV2(amendedResponse, request, {\n          exemplarTraceIdDestinations: this.exemplarTraceIdDestinations,\n        });\n      }),\n      tap((response: DataQueryResponse) => {\n        trackQuery(response, request, startTime);\n      })\n    );\n  }\n\n  metricFindQuery(query: string, options?: LegacyMetricFindQueryOptions) {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    const timeRange = options?.range ?? getDefaultTimeRange();\n\n    const scopedVars = {\n      ...this.getIntervalVars(),\n      ...this.getRangeScopedVars(timeRange),\n    };\n    const interpolated = this.templateSrv.replace(query, scopedVars, this.interpolateQueryExpr);\n    const metricFindQuery = new PrometheusMetricFindQuery(this, interpolated);\n    return metricFindQuery.process(timeRange);\n  }\n\n  getIntervalVars() {\n    return {\n      __interval: { text: this.interval, value: this.interval },\n      __interval_ms: { text: rangeUtil.intervalToMs(this.interval), value: rangeUtil.intervalToMs(this.interval) },\n    };\n  }\n\n  getRangeScopedVars(range: TimeRange) {\n    const msRange = range.to.diff(range.from);\n    const sRange = Math.round(msRange / 1000);\n    return {\n      __range_ms: { text: msRange, value: msRange },\n      __range_s: { text: sRange, value: sRange },\n      __range: { text: sRange + 's', value: sRange + 's' },\n    };\n  }\n\n  // By implementing getTagKeys and getTagValues we add ad-hoc filters functionality\n  // this is used to get label keys, a.k.a label names\n  // it is used in metric_find_query.ts\n  // and in Tempo here grafana/public/app/plugins/datasource/tempo/QueryEditor/ServiceGraphSection.tsx\n  async getTagKeys(options: DataSourceGetTagKeysOptions<PromQuery>): Promise<MetricFindValue[]> {\n    if (!options.timeRange) {\n      options.timeRange = getDefaultTimeRange();\n    }\n\n    if (config.featureToggles.promQLScope && (options?.scopes?.length ?? 0) > 0) {\n      const suggestions = await this.languageProvider.fetchSuggestions(\n        options.timeRange,\n        options.queries,\n        options.scopes,\n        options.filters\n      );\n\n      // filter out already used labels and empty labels\n      return suggestions\n        .filter((labelName) => !!labelName && !options.filters.find((filter) => filter.key === labelName))\n        .map((k) => ({ value: k, text: k }));\n    }\n\n    const match = extractResourceMatcher(options.queries ?? [], options.filters);\n\n    let labelKeys: string[] = await this.languageProvider.queryLabelKeys(options.timeRange, match);\n\n    // filter out already used labels\n    return labelKeys\n      .filter((labelName) => !options.filters.find((filter) => filter.key === labelName))\n      .map((k) => ({ value: k, text: k }));\n  }\n\n  // By implementing getTagKeys and getTagValues we add ad-hoc filters functionality\n  async getTagValues(options: DataSourceGetTagValuesOptions<PromQuery>): Promise<MetricFindValue[]> {\n    if (!options.timeRange) {\n      options.timeRange = getDefaultTimeRange();\n    }\n\n    const requestId = `[${this.uid}][${options.key}]`;\n    if (config.featureToggles.promQLScope && (options?.scopes?.length ?? 0) > 0) {\n      return (\n        await this.languageProvider.fetchSuggestions(\n          options.timeRange,\n          options.queries,\n          options.scopes,\n          options.filters,\n          options.key,\n          undefined,\n          requestId\n        )\n      ).map((v) => ({ value: v, text: v }));\n    }\n\n    const match = extractResourceMatcher(options.queries ?? [], options.filters);\n\n    return (await this.languageProvider.queryLabelValues(options.timeRange, options.key, match)).map((v) => ({\n      value: v,\n      text: v,\n    }));\n  }\n\n  interpolateVariablesInQueries(\n    queries: PromQuery[],\n    scopedVars: ScopedVars,\n    filters?: AdHocVariableFilter[]\n  ): PromQuery[] {\n    let expandedQueries = queries;\n    if (queries && queries.length) {\n      expandedQueries = queries.map((query) => {\n        const interpolatedQuery = this.templateSrv.replace(\n          query.expr,\n          scopedVars,\n          this.interpolateExploreMetrics(query.fromExploreMetrics)\n        );\n        const replacedInterpolatedQuery = config.featureToggles.promQLScope\n          ? interpolatedQuery\n          : this.templateSrv.replace(\n              this.enhanceExprWithAdHocFilters(filters, interpolatedQuery),\n              scopedVars,\n              this.interpolateQueryExpr\n            );\n\n        const expandedQuery = {\n          ...query,\n          ...(config.featureToggles.promQLScope ? { adhocFilters: this.generateScopeFilters(filters) } : {}),\n          datasource: this.getRef(),\n          expr: replacedInterpolatedQuery,\n          interval: this.templateSrv.replace(query.interval, scopedVars),\n        };\n\n        return expandedQuery;\n      });\n    }\n    return expandedQueries;\n  }\n\n  getQueryHints(query: PromQuery, result: unknown[]) {\n    return getQueryHints(query.expr ?? '', result, this);\n  }\n\n  modifyQuery(query: PromQuery, action: QueryFixAction): PromQuery {\n    let expression = query.expr ?? '';\n    switch (action.type) {\n      case 'ADD_FILTER': {\n        const { key, value } = action.options ?? {};\n        if (key && value) {\n          expression = addLabelToQuery(expression, key, value);\n        }\n\n        break;\n      }\n      case 'ADD_FILTER_OUT': {\n        const { key, value } = action.options ?? {};\n        if (key && value) {\n          expression = addLabelToQuery(expression, key, value, '!=');\n        }\n        break;\n      }\n      case 'ADD_HISTOGRAM_QUANTILE': {\n        expression = `histogram_quantile(0.95, sum(rate(${expression}[$__rate_interval])) by (le))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_AVG': {\n        expression = `histogram_avg(rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_FRACTION': {\n        expression = `histogram_fraction(0,0.2,rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_COUNT': {\n        expression = `histogram_count(rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_SUM': {\n        expression = `histogram_sum(rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_STDDEV': {\n        expression = `histogram_stddev(rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_HISTOGRAM_STDVAR': {\n        expression = `histogram_stdvar(rate(${expression}[$__rate_interval]))`;\n        break;\n      }\n      case 'ADD_RATE': {\n        expression = `rate(${expression}[$__rate_interval])`;\n        break;\n      }\n      case 'ADD_SUM': {\n        expression = `sum(${expression.trim()}) by ($1)`;\n        break;\n      }\n      case 'EXPAND_RULES': {\n        if (action.options) {\n          expression = expandRecordingRules(expression, action.options as any);\n        }\n        break;\n      }\n      default:\n        break;\n    }\n    return { ...query, expr: expression };\n  }\n\n  /**\n   * Returns the adjusted \"snapped\" interval parameters\n   */\n  getAdjustedInterval(timeRange: TimeRange): { start: string; end: string } {\n    return getRangeSnapInterval(this.cacheLevel, timeRange);\n  }\n\n  /**\n   * This will return a time range that always includes the users current time range,\n   * and then a little extra padding to round up/down to the nearest nth minute,\n   * defined by the result of the getCacheDurationInMinutes.\n   *\n   * For longer cache durations, and shorter query durations,\n   * the window we're calculating might be much bigger then the user's current window,\n   * resulting in us returning labels/values that might not be applicable for the given window,\n   * this is a necessary trade-off if we want to cache larger durations\n   */\n  getTimeRangeParams(timeRange: TimeRange): { start: string; end: string } {\n    return {\n      start: getPrometheusTime(timeRange.from, false).toString(),\n      end: getPrometheusTime(timeRange.to, true).toString(),\n    };\n  }\n\n  /**\n   * This converts the adhocVariableFilter array and converts it to scopeFilter array\n   * @param filters\n   */\n  generateScopeFilters(filters?: AdHocVariableFilter[]): ScopeSpecFilter[] {\n    if (!filters) {\n      return [];\n    }\n\n    return filters.map((f) => ({\n      key: f.key,\n      operator: scopeFilterOperatorMap[f.operator],\n      value: this.templateSrv.replace(f.value, {}, this.interpolateQueryExpr),\n      values: f.values?.map((v) => this.templateSrv.replace(v, {}, this.interpolateQueryExpr)),\n    }));\n  }\n\n  enhanceExprWithAdHocFilters(filters: AdHocVariableFilter[] | undefined, expr: string) {\n    if (!filters || filters.length === 0) {\n      return expr;\n    }\n\n    const finalQuery = filters.reduce((acc, filter) => {\n      const { key, operator } = filter;\n      let { value } = filter;\n      if (operator === '=~' || operator === '!~') {\n        value = prometheusRegularEscape(value);\n      }\n      return addLabelToQuery(acc, key, value, operator);\n    }, expr);\n    return finalQuery;\n  }\n\n  // Used when running queries through backend\n  filterQuery(query: PromQuery): boolean {\n    if (query.hide || !query.expr) {\n      return false;\n    }\n    return true;\n  }\n\n  // Used when running queries through backend\n  applyTemplateVariables(target: PromQuery, scopedVars: ScopedVars, filters?: AdHocVariableFilter[]) {\n    const variables = { ...scopedVars };\n\n    // We want to interpolate these variables on backend.\n    // The pre-calculated values are replaced withe the variable strings.\n    variables.__interval = {\n      value: '$__interval',\n    };\n    variables.__interval_ms = {\n      value: '$__interval_ms',\n    };\n\n    // interpolate expression\n\n    // We need a first replace to evaluate variables before applying adhoc filters\n    // This is required for an expression like `metric > $VAR` where $VAR is a float to which we must not add adhoc filters\n    const expr = this.templateSrv.replace(\n      target.expr,\n      variables,\n      this.interpolateExploreMetrics(target.fromExploreMetrics)\n    );\n\n    // Apply ad-hoc filters\n    // When ad-hoc filters are applied, we replace again the variables in case the ad-hoc filters also reference a variable\n    const exprWithAdhoc = config.featureToggles.promQLScope\n      ? expr\n      : this.templateSrv.replace(this.enhanceExprWithAdHocFilters(filters, expr), variables, this.interpolateQueryExpr);\n\n    return {\n      ...target,\n      ...(config.featureToggles.promQLScope ? { adhocFilters: this.generateScopeFilters(filters) } : {}),\n      expr: exprWithAdhoc,\n      interval: this.templateSrv.replace(target.interval, variables),\n      legendFormat: this.templateSrv.replace(target.legendFormat, variables),\n    };\n  }\n\n  getVariables(): string[] {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n\n  interpolateString(string: string, scopedVars?: ScopedVars) {\n    return this.templateSrv.replace(string, scopedVars, this.interpolateQueryExpr);\n  }\n\n  interpolateExploreMetrics(fromExploreMetrics?: boolean) {\n    return (value: string | string[] = [], variable: QueryVariableModel | CustomVariableModel) => {\n      if (typeof value === 'string' && fromExploreMetrics) {\n        if (variable.name === 'filters') {\n          return wrapUtf8Filters(value);\n        }\n        if (variable.name === 'groupby') {\n          return utf8Support(value);\n        }\n      }\n      return this.interpolateQueryExpr(value, variable);\n    };\n  }\n\n  isUsingRelativeTimeRange(range: TimeRange): boolean {\n    if (typeof range.raw.from !== 'string' || typeof range.raw.to !== 'string') {\n      return false;\n    }\n\n    return range.raw.from.includes('now') || range.raw.to.includes('now');\n  }\n\n  getDefaultQuery(app: CoreApp): PromQuery {\n    const defaults = {\n      refId: 'A',\n      expr: '',\n      range: true,\n      instant: false,\n    };\n\n    if (app === CoreApp.UnifiedAlerting) {\n      return {\n        ...defaults,\n        instant: true,\n        range: false,\n      };\n    }\n\n    if (app === CoreApp.Explore) {\n      return {\n        ...defaults,\n        instant: true,\n        range: true,\n      };\n    }\n\n    return defaults;\n  }\n}\n\nexport function extractRuleMappingFromGroups(groups: RawRecordingRules[]): RuleQueryMapping {\n  return groups.reduce<RuleQueryMapping>(\n    (mapping, group) =>\n      group.rules\n        .filter((rule) => rule.type === 'recording')\n        .reduce((acc, rule) => {\n          // retrieve existing record\n          const existingRule = acc[rule.name] ?? [];\n          // push a new query with labels\n          existingRule.push({\n            query: rule.query,\n            labels: rule.labels,\n          });\n          acc[rule.name] = existingRule;\n          return acc;\n        }, mapping),\n    {}\n  );\n}\n\n/**\n * It creates a matcher string for resource calls\n * @param queries\n * @param adhocFilters\n *\n * @example\n * queries<PromQuery>=[{expr:`metricName{label=\"value\"}`}]\n * adhocFilters={key:\"instance\", operator:\"=\", value:\"localhost\"}\n * returns {__name__=~\"metricName\", instance=\"localhost\"}\n */\nexport const extractResourceMatcher = (\n  queries: PromQuery[],\n  adhocFilters: AdHocVariableFilter[]\n): string | undefined => {\n  // Extract metric names from queries we have already\n  const metricMatch = populateMatchParamsFromQueries(queries);\n  const labelFilters: QueryBuilderLabelFilter[] = adhocFilters.map((f) => ({\n    label: f.key,\n    value: f.value,\n    op: f.operator,\n  }));\n  // Extract label filters from the filters we have already\n  const labelsMatch = renderLabelsWithoutBrackets(labelFilters);\n\n  if (metricMatch.length === 0 && labelsMatch.length === 0) {\n    return undefined;\n  }\n\n  // Create a matcher using metric names and label filters\n  return `{${[...metricMatch, ...labelsMatch].join(',')}}`;\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/QueryPattern.tsx\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { Button, Card, useStyles2 } from '@grafana/ui';\n\nimport promqlGrammar from '../promql';\n\nimport { RawQuery } from './shared/RawQuery';\nimport { promQueryModeller } from './shared/modeller_instance';\nimport { PromQueryPattern } from './types';\n\ntype Props = {\n  pattern: PromQueryPattern;\n  hasNewQueryOption: boolean;\n  hasPreviousQuery: boolean | string;\n  selectedPatternName: string | null;\n  setSelectedPatternName: (name: string | null) => void;\n  onPatternSelect: (pattern: PromQueryPattern, selectAsNewQuery?: boolean) => void;\n};\n\nexport const QueryPattern = (props: Props) => {\n  const { pattern, onPatternSelect, hasNewQueryOption, hasPreviousQuery, selectedPatternName, setSelectedPatternName } =\n    props;\n\n  const styles = useStyles2(getStyles);\n  const lang = { grammar: promqlGrammar, name: 'promql' };\n\n  return (\n    <Card className={styles.card}>\n      <Card.Heading>{pattern.name}</Card.Heading>\n      <div className={styles.rawQueryContainer}>\n        <RawQuery\n          aria-label={t(\n            'grafana-prometheus.querybuilder.query-pattern.aria-label-raw-query',\n            '{{patternName}} raw query',\n            {\n              patternName: pattern.name,\n            }\n          )}\n          query={promQueryModeller.renderQuery({\n            metric: '',\n            labels: [],\n            operations: pattern.operations,\n            binaryQueries: pattern.binaryQueries,\n          })}\n          lang={lang}\n          className={styles.rawQuery}\n        />\n      </div>\n      <Card.Actions>\n        {selectedPatternName !== pattern.name ? (\n          <Button\n            size=\"sm\"\n            aria-label={t(\n              'grafana-prometheus.querybuilder.query-pattern.aria-label-use-this-query-button',\n              'use this query button'\n            )}\n            onClick={() => {\n              if (hasPreviousQuery) {\n                // If user has previous query, we need to confirm that they want to apply this query pattern\n                setSelectedPatternName(pattern.name);\n              } else {\n                onPatternSelect(pattern);\n              }\n            }}\n          >\n            <Trans i18nKey=\"grafana-prometheus.querybuilder.query-pattern.use-this-query\">Use this query</Trans>\n          </Button>\n        ) : (\n          <>\n            <div className={styles.spacing}>\n              {`If you would like to use this query, ${\n                hasNewQueryOption\n                  ? 'you can either apply this query pattern or create a new query'\n                  : 'this query pattern will be applied to your current query'\n              }.`}\n            </div>\n            <Button\n              size=\"sm\"\n              aria-label={t('grafana-prometheus.querybuilder.query-pattern.aria-label-back-button', 'back button')}\n              fill=\"outline\"\n              onClick={() => setSelectedPatternName(null)}\n            >\n              <Trans i18nKey=\"grafana-prometheus.querybuilder.query-pattern.back\">Back</Trans>\n            </Button>\n            <Button\n              size=\"sm\"\n              aria-label={t(\n                'grafana-prometheus.querybuilder.query-pattern.aria-label-apply-query-starter-button',\n                'apply query starter button'\n              )}\n              onClick={() => {\n                onPatternSelect(pattern);\n              }}\n            >\n              <Trans i18nKey=\"grafana-prometheus.querybuilder.query-pattern.apply-query\">Apply query</Trans>\n            </Button>\n            {hasNewQueryOption && (\n              <Button\n                size=\"sm\"\n                aria-label={t(\n                  'grafana-prometheus.querybuilder.query-pattern.aria-label-create-new-query-button',\n                  'create new query button'\n                )}\n                onClick={() => {\n                  onPatternSelect(pattern, true);\n                }}\n              >\n                <Trans i18nKey=\"grafana-prometheus.querybuilder.query-pattern.create-new-query\">Create new query</Trans>\n              </Button>\n            )}\n          </>\n        )}\n      </Card.Actions>\n    </Card>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      width: '49.5%',\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    rawQueryContainer: css({\n      flexGrow: 1,\n    }),\n    rawQuery: css({\n      backgroundColor: theme.colors.background.primary,\n      padding: theme.spacing(1),\n      marginTop: theme.spacing(1),\n    }),\n    spacing: css({\n      marginBottom: theme.spacing(1),\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/QueryPatternsModal.tsx\nimport { css } from '@emotion/css';\nimport { capitalize } from 'lodash';\nimport { useMemo, useState } from 'react';\n\nimport { CoreApp, DataQuery, getNextRefId, GrafanaTheme2 } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Collapse, Modal, useStyles2 } from '@grafana/ui';\n\nimport { PromQuery } from '../types';\n\nimport { QueryPattern } from './QueryPattern';\nimport { buildVisualQueryFromString } from './parsing';\nimport { promQueryModeller } from './shared/modeller_instance';\nimport { PromQueryPattern, PromQueryPatternType } from './types';\n\ntype Props = {\n  isOpen: boolean;\n  query: PromQuery;\n  queries: DataQuery[] | undefined;\n  app?: CoreApp;\n  onClose: () => void;\n  onChange: (query: PromQuery) => void;\n  onAddQuery?: (query: PromQuery) => void;\n};\n\nexport const QueryPatternsModal = (props: Props) => {\n  const { isOpen, onClose, onChange, onAddQuery, query, queries, app } = props;\n  const [openTabs, setOpenTabs] = useState<string[]>([]);\n  const [selectedPatternName, setSelectedPatternName] = useState<string | null>(null);\n\n  const styles = useStyles2(getStyles);\n  const hasNewQueryOption = !!onAddQuery;\n  const hasPreviousQuery = useMemo(() => {\n    const visualQuery = buildVisualQueryFromString(query.expr ?? '');\n    // has anything entered in the query, metric, labels, operations, or binary queries\n    const hasOperations = visualQuery.query.operations.length > 0,\n      hasMetric = visualQuery.query.metric,\n      hasLabels = visualQuery.query.labels.length > 0,\n      hasBinaryQueries = visualQuery.query.binaryQueries ? visualQuery.query.binaryQueries.length > 0 : false;\n\n    return hasOperations || hasMetric || hasLabels || hasBinaryQueries;\n  }, [query.expr]);\n\n  const onPatternSelect = (pattern: PromQueryPattern, selectAsNewQuery = false) => {\n    const visualQuery = buildVisualQueryFromString(selectAsNewQuery ? '' : query.expr);\n    reportInteraction('grafana_prom_kickstart_your_query_selected', {\n      app: app ?? '',\n      editorMode: query.editorMode,\n      selectedPattern: pattern.name,\n      preSelectedOperationsCount: visualQuery.query.operations.length,\n      preSelectedLabelsCount: visualQuery.query.labels.length,\n      createNewQuery: hasNewQueryOption && selectAsNewQuery,\n    });\n\n    // Apply the pattern operations before rendering the expression\n    visualQuery.query.operations = pattern.operations;\n    visualQuery.query.binaryQueries = pattern.binaryQueries;\n    const renderedExpr = promQueryModeller.renderQuery(visualQuery.query);\n\n    if (hasNewQueryOption && selectAsNewQuery) {\n      onAddQuery({\n        ...query,\n        refId: getNextRefId(queries ?? [query]),\n        expr: renderedExpr,\n      });\n    } else {\n      onChange({\n        ...query,\n        expr: renderedExpr,\n      });\n    }\n    setSelectedPatternName(null);\n    onClose();\n  };\n\n  return (\n    <Modal\n      aria-label={t(\n        'grafana-prometheus.querybuilder.query-patterns-modal.aria-label-kick-start-your-query-modal',\n        'Kick start your query modal'\n      )}\n      isOpen={isOpen}\n      title={t(\n        'grafana-prometheus.querybuilder.query-patterns-modal.title-kick-start-your-query',\n        'Kick start your query'\n      )}\n      onDismiss={onClose}\n    >\n      <div className={styles.spacing}>\n        <Trans i18nKey=\"grafana-prometheus.querybuilder.query-patterns-modal.description-kick-start-your-query\">\n          Kick start your query by selecting one of these queries. You can then continue to complete your query.\n        </Trans>\n      </div>\n      {Object.values(PromQueryPatternType).map((patternType) => {\n        const isOpen = openTabs.includes(patternType);\n        return (\n          <Collapse\n            aria-label={t(\n              'grafana-prometheus.querybuilder.query-patterns-modal.aria-label-toggle-query-starter',\n              'open and close {{patternType}} query starter card',\n              { patternType }\n            )}\n            key={patternType}\n            label={t(\n              'grafana-prometheus.querybuilder.query-patterns-modal.label-toggle-query-starter',\n              '{{patternType}} query starters',\n              {\n                patternType: capitalize(patternType),\n              }\n            )}\n            isOpen={isOpen}\n            collapsible={true}\n            onToggle={() => {\n              const action = isOpen ? 'close' : 'open';\n              reportInteraction(`grafana_prom_kickstart_toggle_pattern_card`, {\n                action,\n                patternType,\n              });\n\n              setOpenTabs((tabs) =>\n                // close tab if it's already open, otherwise open it\n                tabs.includes(patternType) ? tabs.filter((t) => t !== patternType) : [...tabs, patternType]\n              );\n            }}\n          >\n            <div className={styles.cardsContainer}>\n              {promQueryModeller\n                .getQueryPatterns()\n                .filter((pattern) => pattern.type === patternType)\n                .map((pattern) => (\n                  <QueryPattern\n                    key={pattern.name}\n                    pattern={pattern}\n                    hasNewQueryOption={hasNewQueryOption}\n                    hasPreviousQuery={hasPreviousQuery}\n                    onPatternSelect={onPatternSelect}\n                    selectedPatternName={selectedPatternName}\n                    setSelectedPatternName={setSelectedPatternName}\n                  />\n                ))}\n            </div>\n          </Collapse>\n        );\n      })}\n      <Button\n        aria-label={t(\n          'grafana-prometheus.querybuilder.query-patterns-modal.aria-label-close-kick-start-your-query-modal',\n          'close kick start your query modal'\n        )}\n        variant=\"secondary\"\n        onClick={onClose}\n      >\n        <Trans i18nKey=\"grafana-prometheus.querybuilder.query-patterns-modal.close\">Close</Trans>\n      </Button>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    cardsContainer: css({\n      display: 'flex',\n      flexDirection: 'row',\n      flexWrap: 'wrap',\n      justifyContent: 'space-between',\n    }),\n    spacing: css({\n      marginBottom: theme.spacing(1),\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/hooks/useFlag.ts\nimport { useCallback, useState } from 'react';\n\nimport { store } from '@grafana/data';\n\nexport const promQueryEditorExplainKey = 'PrometheusQueryEditorExplainDefault';\n\nexport type QueryEditorFlags = typeof promQueryEditorExplainKey;\n\nfunction getFlagValue(key: QueryEditorFlags, defaultValue = false): boolean {\n  const val = store.get(key);\n  return val === undefined ? defaultValue : Boolean(parseInt(val, 10));\n}\n\nfunction setFlagValue(key: QueryEditorFlags, value: boolean) {\n  store.set(key, value ? '1' : '0');\n}\n\ntype UseFlagHookReturnType = { flag: boolean; setFlag: (val: boolean) => void };\n\n/**\n *\n * Use and store value of explain switch in local storage.\n * Needs to be a hook with local state to trigger re-renders.\n */\nexport function useFlag(key: QueryEditorFlags, defaultValue = false): UseFlagHookReturnType {\n  const [flag, updateFlag] = useState(getFlagValue(key, defaultValue));\n  const setter = useCallback(\n    (value: boolean) => {\n      setFlagValue(key, value);\n      updateFlag(value);\n    },\n    [key]\n  );\n\n  return { flag, setFlag: setter };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/types.ts\n/**\n * Shared types that can be reused by Loki and other data sources\n */\nimport { ComponentType } from 'react';\n\nimport { DataSourceApi, RegistryItem, SelectableValue, TimeRange } from '@grafana/data';\n\nimport { PromVisualQuery } from '../types';\n\nexport interface QueryBuilderLabelFilter {\n  label: string;\n  op: string;\n  value: string;\n}\n\nexport interface QueryBuilderOperation {\n  id: string;\n  params: QueryBuilderOperationParamValue[];\n}\n\nexport interface QueryWithOperations {\n  operations: QueryBuilderOperation[];\n}\n\nexport interface QueryBuilderOperationDef<T = any> extends RegistryItem {\n  documentation?: string;\n  params: QueryBuilderOperationParamDef[];\n  defaultParams: QueryBuilderOperationParamValue[];\n  category: string;\n  hideFromList?: boolean;\n  alternativesKey?: string;\n  /** Can be used to control operation placement when adding a new operations, lower are placed first */\n  orderRank?: number;\n  renderer: QueryBuilderOperationRenderer;\n  addOperationHandler: QueryBuilderAddOperationHandler<T>;\n  paramChangedHandler?: QueryBuilderOnParamChangedHandler;\n  explainHandler?: QueryBuilderExplainOperationHandler;\n  changeTypeHandler?: (op: QueryBuilderOperation, newDef: QueryBuilderOperationDef<T>) => QueryBuilderOperation;\n}\n\nexport type QueryBuilderAddOperationHandler<T> = (\n  def: QueryBuilderOperationDef,\n  query: T,\n  modeller: VisualQueryModeller\n) => T;\n\nexport type QueryBuilderExplainOperationHandler = (op: QueryBuilderOperation, def?: QueryBuilderOperationDef) => string;\n\nexport type QueryBuilderOnParamChangedHandler = (\n  index: number,\n  operation: QueryBuilderOperation,\n  operationDef: QueryBuilderOperationDef\n) => QueryBuilderOperation;\n\nexport type QueryBuilderOperationRenderer = (\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) => string;\n\nexport type QueryBuilderOperationParamValue = string | number | boolean;\n\nexport interface QueryBuilderOperationParamDef {\n  name: string;\n  type: 'string' | 'number' | 'boolean';\n  options?: string[] | number[] | Array<SelectableValue<string>>;\n  hideName?: boolean;\n  restParam?: boolean;\n  optional?: boolean;\n  placeholder?: string;\n  description?: string;\n  minWidth?: number;\n  editor?: ComponentType<QueryBuilderOperationParamEditorProps> | string;\n  runQueryOnEnter?: boolean;\n}\n\nexport interface QueryBuilderOperationEditorProps {\n  operation: QueryBuilderOperation;\n  index: number;\n  query: any;\n  datasource: DataSourceApi;\n  queryModeller: VisualQueryModeller;\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n}\n\nexport interface QueryBuilderOperationParamEditorProps {\n  onChange: (index: number, value: QueryBuilderOperationParamValue) => void;\n  onRunQuery: () => void;\n  /** Parameter index */\n  index: number;\n  operationId: string;\n  query: PromVisualQuery;\n  datasource: DataSourceApi;\n  timeRange: TimeRange;\n  paramDef: QueryBuilderOperationParamDef;\n  queryModeller: VisualQueryModeller;\n  value?: QueryBuilderOperationParamValue;\n}\n\nexport enum QueryEditorMode {\n  Code = 'code',\n  Builder = 'builder',\n}\n\nexport interface VisualQueryModeller {\n  getOperationsForCategory(category: string): QueryBuilderOperationDef[];\n\n  getAlternativeOperations(key: string): QueryBuilderOperationDef[];\n\n  getCategories(): string[];\n\n  getOperationDef(id: string): QueryBuilderOperationDef | undefined;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/QueryEditorModeToggle.tsx\nimport { t } from '@grafana/i18n';\nimport { RadioButtonGroup } from '@grafana/ui';\n\nimport { QueryEditorMode } from './types';\n\nexport interface Props {\n  mode: QueryEditorMode;\n  onChange: (mode: QueryEditorMode) => void;\n}\n\nexport function QueryEditorModeToggle({ mode, onChange }: Props) {\n  const editorModes = [\n    {\n      label: t('grafana-prometheus.querybuilder.query-editor-mode-toggle.editor-modes.label-builder', 'Builder'),\n      value: QueryEditorMode.Builder,\n    },\n    {\n      label: t('grafana-prometheus.querybuilder.query-editor-mode-toggle.editor-modes.label-code', 'Code'),\n      value: QueryEditorMode.Code,\n    },\n  ];\n  return (\n    <div data-testid={'QueryEditorModeToggle'}>\n      <RadioButtonGroup options={editorModes} size=\"sm\" value={mode} onChange={onChange} />\n    </div>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/QueryHeaderSwitch.tsx\nimport { css } from '@emotion/css';\nimport { uniqueId } from 'lodash';\nimport { HTMLProps, useRef } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Switch, useStyles2, Stack } from '@grafana/ui';\n\nexport interface Props extends Omit<HTMLProps<HTMLInputElement>, 'value' | 'ref'> {\n  value?: boolean;\n  label: string;\n}\n\nexport function QueryHeaderSwitch({ label, ...inputProps }: Props) {\n  const dashedLabel = label.replace(' ', '-');\n  const switchIdRef = useRef(uniqueId(`switch-${dashedLabel}`));\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack gap={1}>\n      <label htmlFor={switchIdRef.current} className={styles.switchLabel}>\n        {label}\n      </label>\n      <Switch {...inputProps} id={switchIdRef.current} />\n    </Stack>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    switchLabel: css({\n      color: theme.colors.text.secondary,\n      cursor: 'pointer',\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/state.ts\nimport { CoreApp, store } from '@grafana/data';\n\nimport { LegendFormatMode, PromQuery } from '../types';\n\nimport { QueryEditorMode } from './shared/types';\n\nconst queryEditorModeDefaultLocalStorageKey = 'PrometheusQueryEditorModeDefault';\n\nexport function changeEditorMode(query: PromQuery, editorMode: QueryEditorMode, onChange: (query: PromQuery) => void) {\n  // If empty query store new mode as default\n  if (query.expr === '') {\n    store.set(queryEditorModeDefaultLocalStorageKey, editorMode);\n  }\n\n  onChange({ ...query, editorMode });\n}\n\nfunction getDefaultEditorMode(expr: string, defaultEditor: QueryEditorMode = QueryEditorMode.Builder): QueryEditorMode {\n  // If we already have an expression default to code view\n  if (expr != null && expr !== '') {\n    return QueryEditorMode.Code;\n  }\n\n  const value: QueryEditorMode = store.get(queryEditorModeDefaultLocalStorageKey);\n  switch (value) {\n    case QueryEditorMode.Builder:\n    case QueryEditorMode.Code:\n      return value;\n    default:\n      return defaultEditor;\n  }\n}\n\n/**\n * Returns query with defaults, and boolean true/false depending on change was required\n */\nexport function getQueryWithDefaults(\n  query: PromQuery & { expr?: string },\n  app: CoreApp | undefined,\n  defaultEditor?: QueryEditorMode\n): PromQuery {\n  let result = query;\n\n  if (!query.editorMode) {\n    result = { ...query, editorMode: getDefaultEditorMode(query.expr, defaultEditor) };\n  }\n\n  // default query expr is now empty string, set in getDefaultQuery\n  // While expr is required in the types, it is not always defined at runtime, so we need to check for undefined and default to an empty string to prevent runtime errors\n  if (!query.expr) {\n    result = { ...result, expr: '', legendFormat: LegendFormatMode.Auto };\n  }\n\n  if (query.range == null && query.instant == null) {\n    // Default to range query\n    result = { ...result, range: true };\n\n    // In explore we default to both instant & range\n    if (app === CoreApp.Explore) {\n      result.instant = true;\n    }\n  }\n\n  // Unified Alerting does not support \"both\" for query type  fall back to \"range\".\n  const isBothInstantAndRange = query.instant && query.range;\n  if (app === CoreApp.UnifiedAlerting && isBothInstantAndRange) {\n    result = { ...result, instant: false, range: true };\n  }\n\n  return result;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationInfoButton.tsx\nimport { css } from '@emotion/css';\nimport {\n  autoUpdate,\n  flip,\n  offset,\n  shift,\n  useClick,\n  useDismiss,\n  useFloating,\n  useInteractions,\n} from '@floating-ui/react';\nimport { memo, useState } from 'react';\n\nimport { GrafanaTheme2, renderMarkdown } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { FlexItem } from '@grafana/plugin-ui';\nimport { Button, Portal, useStyles2 } from '@grafana/ui';\n\nimport { QueryBuilderOperation, QueryBuilderOperationDef } from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  def: QueryBuilderOperationDef;\n}\n\nexport const OperationInfoButton = memo<Props>(({ def, operation }) => {\n  const styles = useStyles2(getStyles);\n  const [show, setShow] = useState(false);\n\n  // the order of middleware is important!\n  const middleware = [\n    offset(16),\n    flip({\n      fallbackAxisSideDirection: 'end',\n      // see https://floating-ui.com/docs/flip#combining-with-shift\n      crossAxis: false,\n      boundary: document.body,\n    }),\n    shift(),\n  ];\n\n  const { context, refs, floatingStyles } = useFloating({\n    open: show,\n    placement: 'top',\n    onOpenChange: setShow,\n    middleware,\n    whileElementsMounted: autoUpdate,\n  });\n\n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, click]);\n\n  return (\n    <>\n      <Button\n        title={t(\n          'grafana-prometheus.querybuilder.operation-info-button.title-click-to-show-description',\n          'Click to show description'\n        )}\n        ref={refs.setReference}\n        icon=\"info-circle\"\n        size=\"sm\"\n        variant=\"secondary\"\n        fill=\"text\"\n        {...getReferenceProps()}\n      />\n      {show && (\n        <Portal>\n          <div ref={refs.setFloating} style={floatingStyles} {...getFloatingProps()} className={styles.docBox}>\n            <div className={styles.docBoxHeader}>\n              <span>{def.renderer(operation, def, '<expr>')}</span>\n              <FlexItem grow={1} />\n              <Button\n                icon=\"times\"\n                onClick={() => setShow(false)}\n                fill=\"text\"\n                variant=\"secondary\"\n                title={t(\n                  'grafana-prometheus.querybuilder.operation-info-button.title-remove-operation',\n                  'Remove operation'\n                )}\n              />\n            </div>\n            <div\n              className={styles.docBoxBody}\n              dangerouslySetInnerHTML={{ __html: getOperationDocs(def, operation) }}\n            ></div>\n          </div>\n        </Portal>\n      )}\n    </>\n  );\n});\n\nOperationInfoButton.displayName = 'OperationDocs';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    docBox: css({\n      overflow: 'hidden',\n      background: theme.colors.background.elevated,\n      border: `1px solid ${theme.colors.border.weak}`,\n      boxShadow: theme.shadows.z3,\n      maxWidth: '600px',\n      padding: theme.spacing(1),\n      borderRadius: theme.shape.radius.default,\n      zIndex: theme.zIndex.tooltip,\n    }),\n    docBoxHeader: css({\n      fontSize: theme.typography.h5.fontSize,\n      fontFamily: theme.typography.fontFamilyMonospace,\n      paddingBottom: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    docBoxBody: css({\n      // The markdown paragraph has a marginBottom this removes it\n      marginBottom: theme.spacing(-1),\n      color: theme.colors.text.secondary,\n    }),\n  };\n};\n\nfunction getOperationDocs(def: QueryBuilderOperationDef, op: QueryBuilderOperation): string {\n  return renderMarkdown(def.explainHandler ? def.explainHandler(op, def) : (def.documentation ?? 'no docs'));\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationHeader.tsx\nimport { css } from '@emotion/css';\nimport { DraggableProvided } from '@hello-pangea/dnd';\nimport { memo, useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { FlexItem } from '@grafana/plugin-ui';\nimport { Button, Select, useStyles2 } from '@grafana/ui';\n\nimport { OperationInfoButton } from './OperationInfoButton';\nimport { QueryBuilderOperation, QueryBuilderOperationDef, VisualQueryModeller } from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  def: QueryBuilderOperationDef;\n  index: number;\n  queryModeller: VisualQueryModeller;\n  dragHandleProps?: DraggableProvided['dragHandleProps'];\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n}\n\ninterface State {\n  isOpen?: boolean;\n  alternatives?: Array<SelectableValue<QueryBuilderOperationDef>>;\n}\n\nexport const OperationHeader = memo<Props>(\n  ({ operation, def, index, onChange, onRemove, queryModeller, dragHandleProps }) => {\n    const styles = useStyles2(getStyles);\n    const [state, setState] = useState<State>({});\n\n    const onToggleSwitcher = () => {\n      if (state.isOpen) {\n        setState({ ...state, isOpen: false });\n      } else {\n        const alternatives = queryModeller\n          .getAlternativeOperations(def.alternativesKey!)\n          .map((alt) => ({ label: alt.name, value: alt }));\n        setState({ isOpen: true, alternatives });\n      }\n    };\n\n    return (\n      <div className={styles.header}>\n        {!state.isOpen && (\n          <>\n            <div {...dragHandleProps}>{def.name ?? def.id}</div>\n            <FlexItem grow={1} />\n            <div className={`${styles.operationHeaderButtons} operation-header-show-on-hover`}>\n              <Button\n                icon=\"angle-down\"\n                size=\"sm\"\n                onClick={onToggleSwitcher}\n                fill=\"text\"\n                variant=\"secondary\"\n                title={t(\n                  'grafana-prometheus.querybuilder.operation-header.title-click-to-view-alternative-operations',\n                  'Click to view alternative operations'\n                )}\n              />\n              <OperationInfoButton def={def} operation={operation} />\n              <Button\n                icon=\"times\"\n                size=\"sm\"\n                onClick={() => onRemove(index)}\n                fill=\"text\"\n                variant=\"secondary\"\n                title={t('grafana-prometheus.querybuilder.operation-header.title-remove-operation', 'Remove operation')}\n              />\n            </div>\n          </>\n        )}\n        {state.isOpen && (\n          <div className={styles.selectWrapper}>\n            <Select\n              autoFocus\n              openMenuOnFocus\n              placeholder={t(\n                'grafana-prometheus.querybuilder.operation-header.placeholder-replace-with',\n                'Replace with'\n              )}\n              options={state.alternatives}\n              isOpen={true}\n              onCloseMenu={onToggleSwitcher}\n              onChange={(value) => {\n                if (value.value) {\n                  // Operation should exist if it is selectable\n                  const newDef = queryModeller.getOperationDef(value.value.id)!;\n\n                  // copy default params, and override with all current params\n                  const newParams = [...newDef.defaultParams];\n                  for (let i = 0; i < Math.min(operation.params.length, newParams.length); i++) {\n                    if (newDef.params[i].type === def.params[i].type) {\n                      newParams[i] = operation.params[i];\n                    }\n                  }\n\n                  const changedOp = { ...operation, params: newParams, id: value.value.id };\n                  onChange(index, def.changeTypeHandler ? def.changeTypeHandler(changedOp, newDef) : changedOp);\n                }\n              }}\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nOperationHeader.displayName = 'OperationHeader';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    header: css({\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    operationHeaderButtons: css({\n      opacity: 1,\n    }),\n    selectWrapper: css({\n      paddingRight: theme.spacing(2),\n    }),\n  };\n};\n","export function getOperationParamId(operationId: string, paramIndex: number) {\n  return `operations.${operationId}.param.${paramIndex}`;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/LabelParamEditor.tsx\nimport { useState } from 'react';\n\nimport { DataSourceApi, SelectableValue, TimeRange, toOption } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { Select } from '@grafana/ui';\n\nimport { getOperationParamId } from '../shared/param_utils';\nimport { QueryBuilderLabelFilter, QueryBuilderOperationParamEditorProps } from '../shared/types';\nimport { PromVisualQuery, PromQueryModellerInterface } from '../types';\n\n/**\n * Props for the LabelParamEditor component.\n * This editor specifically requires a Prometheus query modeller instance.\n */\nexport interface LabelParamEditorProps extends Omit<QueryBuilderOperationParamEditorProps, 'queryModeller'> {\n  queryModeller: PromQueryModellerInterface;\n}\n\n/**\n * Editor for label parameters that requires a Prometheus query modeller instance.\n * This is used by the OperationParamEditorWrapper which ensures the modeller is always provided.\n */\nexport function LabelParamEditor({\n  onChange,\n  index,\n  operationId,\n  value,\n  query,\n  datasource,\n  timeRange,\n  queryModeller,\n}: LabelParamEditorProps) {\n  const [state, setState] = useState<{\n    options?: SelectableValue[];\n    isLoading?: boolean;\n  }>({});\n\n  return (\n    <Select\n      inputId={getOperationParamId(operationId, index)}\n      autoFocus={value === '' ? true : undefined}\n      openMenuOnFocus\n      onOpenMenu={async () => {\n        setState({ isLoading: true });\n        const options = await loadGroupByLabels(timeRange, query, datasource, queryModeller);\n        setState({ options, isLoading: undefined });\n      }}\n      isLoading={state.isLoading}\n      allowCustomValue\n      noOptionsMessage={t(\n        'grafana-prometheus.querybuilder.label-param-editor.noOptionsMessage-no-labels-found',\n        'No labels found'\n      )}\n      loadingMessage={t(\n        'grafana-prometheus.querybuilder.label-param-editor.loadingMessage-loading-labels',\n        'Loading labels'\n      )}\n      options={state.options}\n      value={toOption(value as string)}\n      onChange={(value) => onChange(index, value.value!)}\n    />\n  );\n}\n\nasync function loadGroupByLabels(\n  timeRange: TimeRange,\n  query: PromVisualQuery,\n  datasource: DataSourceApi,\n  modeller: PromQueryModellerInterface\n): Promise<SelectableValue[]> {\n  let labels: QueryBuilderLabelFilter[] = query.labels;\n\n  // This function is used by both Prometheus and Loki and this the only difference.\n  if (datasource.type === 'prometheus') {\n    // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n    labels = [{ label: '__name__', op: '=', value: query.metric }, ...query.labels];\n  }\n\n  const expr = modeller.renderLabels(labels);\n  const result: string[] = await datasource.languageProvider.queryLabelKeys(timeRange, expr);\n\n  return result.map((x) => ({\n    label: x,\n    value: x,\n  }));\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationParamEditor.tsx\nimport { css } from '@emotion/css';\nimport { ComponentType } from 'react';\n\nimport { GrafanaTheme2, SelectableValue, toOption } from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { AutoSizeInput, Button, Checkbox, Select, useStyles2, Stack } from '@grafana/ui';\n\nimport { LabelParamEditor } from '../components/LabelParamEditor';\n\nimport { getOperationParamId } from './param_utils';\nimport { QueryBuilderOperationParamDef, QueryBuilderOperationParamEditorProps } from './types';\n\n/**\n * Registry of operation parameter editors that can be referenced by key.\n *\n * This approach solves a circular dependency problem in the codebase:\n * - Operation definitions need to reference editors (e.g., LabelParamEditor)\n * - Editors need to reference the modeller instance\n * - The modeller instance needs to reference operation definitions\n *\n * By using string keys instead of direct imports, we break this cycle:\n * 1. Operation definitions reference editors by key (no component import needed)\n * 2. The registry maps these keys to actual editor components\n * 3. The wrapper component (OperationParamEditorWrapper) injects the modeller instance\n *\n * This creates a clear dependency flow:\n * Operation Definitions -> Registry -> Editor Components <- Wrapper <- Modeller Instance\n *\n * @example\n * ```ts\n * {\n *   id: 'someOperation',\n *   params: [{\n *     name: 'Label',\n *     type: 'string',\n *     editor: 'LabelParamEditor' // Reference by key instead of supplying the component directly\n *   }]\n * }\n * ```\n */\nconst editorMap: Record<string, ComponentType<QueryBuilderOperationParamEditorProps>> = {\n  // The wrapper component will ensure the modeller is provided\n  LabelParamEditor: LabelParamEditor as ComponentType<QueryBuilderOperationParamEditorProps>,\n};\n\n/**\n * Resolves an operation parameter editor based on the parameter definition.\n *\n * The editor can be specified in three ways:\n * 1. As a string key referencing a registered editor in editorMap\n * 2. As a direct component reference\n * 3. Based on the parameter type (string, number, boolean) or options\n *\n * This flexibility allows operation definitions to be decoupled from editor implementations\n * while maintaining type safety and clear dependencies.\n */\nexport function getOperationParamEditor(\n  paramDef: QueryBuilderOperationParamDef\n): ComponentType<QueryBuilderOperationParamEditorProps> {\n  if (paramDef.editor) {\n    if (typeof paramDef.editor === 'string') {\n      return editorMap[paramDef.editor] || SimpleInputParamEditor;\n    }\n    return paramDef.editor;\n  }\n\n  if (paramDef.options) {\n    return SelectInputParamEditor;\n  }\n\n  switch (paramDef.type) {\n    case 'boolean':\n      return BoolInputParamEditor;\n    case 'number':\n    case 'string':\n    default:\n      return SimpleInputParamEditor;\n  }\n}\n\nfunction SimpleInputParamEditor(props: QueryBuilderOperationParamEditorProps) {\n  return (\n    <AutoSizeInput\n      id={getOperationParamId(props.operationId, props.index)}\n      defaultValue={props.value?.toString()}\n      minWidth={props.paramDef.minWidth}\n      placeholder={props.paramDef.placeholder}\n      title={props.paramDef.description}\n      maxWidth={(props.paramDef.minWidth || 20) * 3}\n      onCommitChange={(evt) => {\n        props.onChange(props.index, evt.currentTarget.value);\n        if (props.paramDef.runQueryOnEnter && evt.type === 'keydown') {\n          props.onRunQuery();\n        }\n      }}\n    />\n  );\n}\n\nfunction BoolInputParamEditor(props: QueryBuilderOperationParamEditorProps) {\n  return (\n    <Checkbox\n      id={getOperationParamId(props.operationId, props.index)}\n      value={Boolean(props.value)}\n      onChange={(evt) => props.onChange(props.index, evt.currentTarget.checked)}\n    />\n  );\n}\n\nfunction SelectInputParamEditor({\n  paramDef,\n  value,\n  index,\n  operationId,\n  onChange,\n}: QueryBuilderOperationParamEditorProps) {\n  const styles = useStyles2(getStyles);\n  let selectOptions = paramDef.options as SelectableValue[];\n\n  if (!selectOptions[0]?.label) {\n    selectOptions = paramDef.options!.map((option) => ({\n      label: option.toString(),\n      value: option,\n    }));\n  }\n\n  let valueOption = selectOptions.find((x) => x.value === value) ?? toOption(value as string);\n\n  // If we have optional options param and don't have value, we want to render button with which we add optional options.\n  // This makes it easier to understand what needs to be selected and what is optional.\n  if (!value && paramDef.optional) {\n    return (\n      <div className={styles.optionalParam}>\n        <Button\n          size=\"sm\"\n          variant=\"secondary\"\n          title={t('grafana-prometheus.querybuilder.operation-param-editor.title-add', 'Add {{name}}', {\n            name: paramDef.name,\n          })}\n          icon=\"plus\"\n          onClick={() => onChange(index, selectOptions[0].value)}\n        >\n          {paramDef.name}\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n      <Select\n        id={getOperationParamId(operationId, index)}\n        value={valueOption}\n        options={selectOptions}\n        placeholder={paramDef.placeholder}\n        allowCustomValue={true}\n        onChange={(value) => onChange(index, value.value!)}\n        width={paramDef.minWidth || 'auto'}\n      />\n      {paramDef.optional && (\n        <Button\n          data-testid={`operations.${index}.remove-param`}\n          size=\"sm\"\n          fill=\"text\"\n          icon=\"times\"\n          variant=\"secondary\"\n          title={t('grafana-prometheus.querybuilder.operation-param-editor.title-remove', 'Remove {{name}}', {\n            name: paramDef.name,\n          })}\n          onClick={() => onChange(index, '')}\n        />\n      )}\n    </Stack>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    optionalParam: css({\n      marginTop: theme.spacing(1),\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationEditor.tsx\nimport { css, cx } from '@emotion/css';\nimport { Draggable } from '@hello-pangea/dnd';\nimport { useEffect, useId, useState } from 'react';\nimport * as React from 'react';\n\nimport { DataSourceApi, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { Button, Icon, Stack, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { OperationHeader } from './OperationHeader';\nimport { getOperationParamEditor } from './OperationParamEditorRegistry';\nimport { getOperationParamId } from './param_utils';\nimport {\n  QueryBuilderOperation,\n  QueryBuilderOperationDef,\n  QueryBuilderOperationParamDef,\n  QueryBuilderOperationParamValue,\n  VisualQueryModeller,\n} from './types';\n\nexport interface Props {\n  operation: QueryBuilderOperation;\n  index: number;\n  query: any;\n  datasource: DataSourceApi;\n  queryModeller: VisualQueryModeller;\n  onChange: (index: number, update: QueryBuilderOperation) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n  flash?: boolean;\n  highlight?: boolean;\n  timeRange: TimeRange;\n}\n\nexport function OperationEditor({\n  operation,\n  index,\n  onRemove,\n  onChange,\n  onRunQuery,\n  queryModeller,\n  query,\n  datasource,\n  flash,\n  highlight,\n  timeRange,\n}: Props) {\n  const styles = useStyles2(getStyles);\n  const def = queryModeller.getOperationDef(operation.id);\n  const shouldFlash = useFlash(flash);\n  const id = useId();\n\n  if (!def) {\n    return (\n      <span>\n        <Trans i18nKey=\"grafana-prometheus.querybuilder.operation-editor.not-found\" values={{ id: operation.id }}>\n          Operation {'{{id}}'} not found\n        </Trans>\n      </span>\n    );\n  }\n\n  const onParamValueChanged = (paramIdx: number, value: QueryBuilderOperationParamValue) => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params] };\n    update.params[paramIdx] = value;\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const onAddRestParam = () => {\n    const update: QueryBuilderOperation = { ...operation, params: [...operation.params, ''] };\n    callParamChangedThenOnChange(def, update, index, operation.params.length, onChange);\n  };\n\n  const onRemoveRestParam = (paramIdx: number) => {\n    const update: QueryBuilderOperation = {\n      ...operation,\n      params: [...operation.params.slice(0, paramIdx), ...operation.params.slice(paramIdx + 1)],\n    };\n    callParamChangedThenOnChange(def, update, index, paramIdx, onChange);\n  };\n\n  const operationElements: React.ReactNode[] = [];\n\n  for (let paramIndex = 0; paramIndex < operation.params.length; paramIndex++) {\n    const paramDef = def.params[Math.min(def.params.length - 1, paramIndex)];\n    const Editor = getOperationParamEditor(paramDef);\n\n    operationElements.push(\n      <div className={styles.paramRow} key={`${paramIndex}-1`}>\n        {!paramDef.hideName && (\n          <div className={styles.paramName}>\n            <label htmlFor={getOperationParamId(id, paramIndex)}>{paramDef.name}</label>\n            {paramDef.description && (\n              <Tooltip placement=\"top\" content={paramDef.description} theme=\"info\">\n                <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n              </Tooltip>\n            )}\n          </div>\n        )}\n        <div className={styles.paramValue}>\n          <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n            <Editor\n              paramDef={paramDef}\n              value={operation.params[paramIndex]}\n              index={paramIndex}\n              operationId={operation.id}\n              query={query}\n              datasource={datasource}\n              timeRange={timeRange}\n              onChange={onParamValueChanged}\n              onRunQuery={onRunQuery}\n              queryModeller={queryModeller}\n            />\n            {paramDef.restParam && (operation.params.length > def.params.length || paramDef.optional) && (\n              <Button\n                data-testid={`operations.${index}.remove-rest-param`}\n                size=\"sm\"\n                fill=\"text\"\n                icon=\"times\"\n                variant=\"secondary\"\n                title={t('grafana-prometheus.querybuilder.operation-editor.title-remove', 'Remove {{name}}', {\n                  name: paramDef.name,\n                })}\n                onClick={() => onRemoveRestParam(paramIndex)}\n              />\n            )}\n          </Stack>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle adding button for rest params\n  let restParam: React.ReactNode | undefined;\n  if (def.params.length > 0) {\n    const lastParamDef = def.params[def.params.length - 1];\n    if (lastParamDef.restParam) {\n      restParam = renderAddRestParamButton(lastParamDef, onAddRestParam, index, operation.params.length, styles);\n    }\n  }\n\n  return (\n    <Draggable draggableId={`operation-${index}`} index={index}>\n      {(provided) => (\n        <div\n          className={cx(styles.card, (shouldFlash || highlight) && styles.cardHighlight)}\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          data-testid={`operations.${index}.wrapper`}\n        >\n          <OperationHeader\n            operation={operation}\n            dragHandleProps={provided.dragHandleProps}\n            def={def}\n            index={index}\n            onChange={onChange}\n            onRemove={onRemove}\n            queryModeller={queryModeller}\n          />\n          <div className={styles.body}>{operationElements}</div>\n          {restParam}\n          {index < query.operations.length - 1 && (\n            <div className={styles.arrow}>\n              <div className={styles.arrowLine} />\n              <div className={styles.arrowArrow} />\n            </div>\n          )}\n        </div>\n      )}\n    </Draggable>\n  );\n}\n\n/**\n * When flash is switched on makes sure it is switched of right away, so we just flash the highlight and then fade\n * out.\n * @param flash\n */\nfunction useFlash(flash?: boolean) {\n  const [keepFlash, setKeepFlash] = useState(true);\n  useEffect(() => {\n    let t: ReturnType<typeof setTimeout>;\n    if (flash) {\n      t = setTimeout(() => {\n        setKeepFlash(false);\n      }, 1000);\n    } else {\n      setKeepFlash(true);\n    }\n\n    return () => clearTimeout(t);\n  }, [flash]);\n\n  return keepFlash && flash;\n}\n\nfunction renderAddRestParamButton(\n  paramDef: QueryBuilderOperationParamDef,\n  onAddRestParam: () => void,\n  operationIndex: number,\n  paramIndex: number,\n  styles: OperationEditorStyles\n) {\n  return (\n    <div className={styles.restParam} key={`${paramIndex}-2`}>\n      <Button\n        size=\"sm\"\n        icon=\"plus\"\n        title={`Add ${paramDef.name}`.trimEnd()}\n        variant=\"secondary\"\n        onClick={onAddRestParam}\n        data-testid={`operations.${operationIndex}.add-rest-param`}\n      >\n        {paramDef.name}\n      </Button>\n    </div>\n  );\n}\n\nfunction callParamChangedThenOnChange(\n  def: QueryBuilderOperationDef,\n  operation: QueryBuilderOperation,\n  operationIndex: number,\n  paramIndex: number,\n  onChange: (index: number, update: QueryBuilderOperation) => void\n) {\n  if (def.paramChangedHandler) {\n    onChange(operationIndex, def.paramChangedHandler(paramIndex, operation, def));\n  } else {\n    onChange(operationIndex, operation);\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    cardWrapper: css({\n      alignItems: 'stretch',\n    }),\n    error: css({\n      marginBottom: theme.spacing(1),\n    }),\n    card: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.medium}`,\n      cursor: 'grab',\n      borderRadius: theme.shape.radius.default,\n      marginBottom: theme.spacing(1),\n      position: 'relative',\n      [theme.transitions.handleMotion('no-preference', 'reduce')]: {\n        transition: 'all 0.5s ease-in 0s',\n      },\n      height: '100%',\n    }),\n    cardError: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.warning.main}`,\n      border: `1px solid ${theme.colors.warning.main}`,\n    }),\n    cardHighlight: css({\n      boxShadow: `0px 0px 4px 0px ${theme.colors.primary.border}`,\n      border: `1px solid ${theme.colors.primary.border}`,\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(0.5),\n      color: theme.colors.text.secondary,\n      ':hover': {\n        color: theme.colors.text.primary,\n      },\n    }),\n    body: css({\n      margin: theme.spacing(1, 1, 0.5, 1),\n      display: 'table',\n    }),\n    paramRow: css({\n      label: 'paramRow',\n      display: 'table-row',\n      verticalAlign: 'middle',\n    }),\n    paramName: css({\n      display: 'table-cell',\n      padding: theme.spacing(0, 1, 0, 0),\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      verticalAlign: 'middle',\n      height: '32px',\n    }),\n    paramValue: css({\n      label: 'paramValue',\n      display: 'table-cell',\n      verticalAlign: 'middle',\n    }),\n    restParam: css({\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n    arrow: css({\n      position: 'absolute',\n      top: '0',\n      right: '-18px',\n      display: 'flex',\n    }),\n    arrowLine: css({\n      height: '2px',\n      width: '8px',\n      backgroundColor: theme.colors.border.strong,\n      position: 'relative',\n      top: '14px',\n    }),\n    arrowArrow: css({\n      width: 0,\n      height: 0,\n      borderTop: `5px solid transparent`,\n      borderBottom: `5px solid transparent`,\n      borderLeft: `7px solid ${theme.colors.border.strong}`,\n      position: 'relative',\n      top: '10px',\n    }),\n  };\n};\n\ntype OperationEditorStyles = ReturnType<typeof getStyles>;\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationList.tsx\nimport { css } from '@emotion/css';\nimport { DragDropContext, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { useState } from 'react';\nimport { useMountedState, usePrevious } from 'react-use';\n\nimport { DataSourceApi, GrafanaTheme2, TimeRange } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { Button, Cascader, CascaderOption, useStyles2, Stack } from '@grafana/ui';\n\nimport { OperationEditor } from './OperationEditor';\nimport { QueryBuilderOperation, QueryWithOperations, VisualQueryModeller } from './types';\n\nexport interface Props<T extends QueryWithOperations> {\n  query: T;\n  datasource: DataSourceApi;\n  onChange: (query: T) => void;\n  onRunQuery: () => void;\n  queryModeller: VisualQueryModeller;\n  explainMode?: boolean;\n  highlightedOp?: QueryBuilderOperation;\n  timeRange: TimeRange;\n}\n\nexport function OperationList<T extends QueryWithOperations>({\n  query,\n  datasource,\n  queryModeller,\n  onChange,\n  onRunQuery,\n  highlightedOp,\n  timeRange,\n}: Props<T>) {\n  const styles = useStyles2(getStyles);\n  const { operations } = query;\n\n  const opsToHighlight = useOperationsHighlight(operations);\n\n  const [cascaderOpen, setCascaderOpen] = useState(false);\n\n  const onOperationChange = (index: number, update: QueryBuilderOperation) => {\n    const updatedList = [...operations];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...operations.slice(0, index), ...operations.slice(index + 1)];\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const addOptions: CascaderOption[] = queryModeller.getCategories().map((category) => {\n    return {\n      value: category,\n      label: category,\n      items: queryModeller.getOperationsForCategory(category).map((operation) => ({\n        value: operation.id,\n        label: operation.name,\n        isLeaf: true,\n      })),\n    };\n  });\n\n  const onAddOperation = (value: string) => {\n    const operationDef = queryModeller.getOperationDef(value);\n    if (!operationDef) {\n      return;\n    }\n    onChange(operationDef.addOperationHandler(operationDef, query, queryModeller));\n    setCascaderOpen(false);\n  };\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n\n    const updatedList = [...operations];\n    const element = updatedList[result.source.index];\n    updatedList.splice(result.source.index, 1);\n    updatedList.splice(result.destination.index, 0, element);\n    onChange({ ...query, operations: updatedList });\n  };\n\n  const onCascaderBlur = () => {\n    setCascaderOpen(false);\n  };\n\n  return (\n    <Stack gap={1} direction=\"column\">\n      <Stack gap={1}>\n        {operations.length > 0 && (\n          <DragDropContext onDragEnd={onDragEnd}>\n            <Droppable droppableId=\"sortable-field-mappings\" direction=\"horizontal\">\n              {(provided) => (\n                <div className={styles.operationList} ref={provided.innerRef} {...provided.droppableProps}>\n                  {operations.map((op, index) => {\n                    return (\n                      <OperationEditor\n                        key={op.id + JSON.stringify(op.params) + index}\n                        queryModeller={queryModeller}\n                        index={index}\n                        operation={op}\n                        query={query}\n                        datasource={datasource}\n                        onChange={onOperationChange}\n                        onRemove={onRemove}\n                        onRunQuery={onRunQuery}\n                        flash={opsToHighlight[index]}\n                        highlight={highlightedOp === op}\n                        timeRange={timeRange}\n                      />\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        )}\n        <div className={styles.addButton}>\n          {cascaderOpen ? (\n            <Cascader\n              options={addOptions}\n              onSelect={onAddOperation}\n              onBlur={onCascaderBlur}\n              autoFocus={true}\n              alwaysOpen={true}\n              hideActiveLevelLabel={true}\n              placeholder={t('grafana-prometheus.querybuilder.operation-list.placeholder-search', 'Search')}\n            />\n          ) : (\n            <Button\n              icon={'plus'}\n              variant={'secondary'}\n              onClick={() => setCascaderOpen(true)}\n              title={t('grafana-prometheus.querybuilder.operation-list.title-add-operation', 'Add operation')}\n            >\n              <Trans i18nKey=\"grafana-prometheus.querybuilder.operation-list.operations\">Operations</Trans>\n            </Button>\n          )}\n        </div>\n      </Stack>\n    </Stack>\n  );\n}\n\n/**\n * Returns indexes of operations that should be highlighted. We check the diff of operations added but at the same time\n * we want to highlight operations only after the initial render, so we check for mounted state and calculate the diff\n * only after.\n * @param operations\n */\nfunction useOperationsHighlight(operations: QueryBuilderOperation[]) {\n  const isMounted = useMountedState();\n  const prevOperations = usePrevious(operations);\n\n  if (!isMounted()) {\n    return operations.map(() => false);\n  }\n\n  if (!prevOperations) {\n    return operations.map(() => true);\n  }\n\n  let newOps: boolean[] = [];\n\n  if (prevOperations.length - 1 === operations.length && operations.every((op) => prevOperations.includes(op))) {\n    // In case we remove one op and does not change any ops then don't highlight anything.\n    return operations.map(() => false);\n  }\n  if (prevOperations.length + 1 === operations.length && prevOperations.every((op) => operations.includes(op))) {\n    // If we add a single op just find it and highlight just that.\n    const newOp = operations.find((op) => !prevOperations.includes(op));\n    newOps = operations.map((op) => {\n      return op === newOp;\n    });\n  } else {\n    // Default diff of all ops.\n    newOps = operations.map((op, index) => {\n      return !isSameOp(op.id, prevOperations[index]?.id);\n    });\n  }\n  return newOps;\n}\n\nfunction isSameOp(op1?: string, op2?: string) {\n  return op1 === op2 || `__${op1}_by` === op2 || op1 === `__${op2}_by`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    heading: css({\n      label: 'heading',\n      fontSize: 12,\n      fontWeight: theme.typography.fontWeightMedium,\n      marginBottom: 0,\n    }),\n    operationList: css({\n      label: 'operationList',\n      display: 'flex',\n      flexWrap: 'wrap',\n      gap: theme.spacing(2),\n    }),\n    addButton: css({\n      label: 'addButton',\n      width: 126,\n      paddingBottom: theme.spacing(1),\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/OperationsEditorRow.tsx\nimport { css } from '@emotion/css';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, Stack } from '@grafana/ui';\n\ninterface Props {\n  children: React.ReactNode;\n}\n\nexport function OperationsEditorRow({ children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.root}>\n      <Stack gap={1}>{children}</Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    root: css({\n      padding: theme.spacing(1, 1, 0, 1),\n      backgroundColor: theme.colors.background.secondary,\n      borderRadius: theme.shape.radius.default,\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/QueryBuilderHints.tsx\nimport { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\n\nimport { GrafanaTheme2, PanelData, QueryHint } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromQueryModellerInterface, PromVisualQuery } from '../types';\n\nexport interface Props {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  queryModeller: PromQueryModellerInterface;\n  buildVisualQueryFromString: (expr: string) => { query: PromVisualQuery };\n  onChange: (update: PromVisualQuery) => void;\n  data?: PanelData;\n}\n\nexport const QueryBuilderHints = ({\n  datasource,\n  query: visualQuery,\n  onChange,\n  data,\n  queryModeller,\n  buildVisualQueryFromString,\n}: Props) => {\n  const [hints, setHints] = useState<QueryHint[]>([]);\n  const styles = useStyles2(getStyles);\n\n  useEffect(() => {\n    const query = { expr: queryModeller.renderQuery(visualQuery), refId: '' };\n    // For now show only actionable hints\n    const hints = datasource.getQueryHints(query, data?.series || []).filter((hint) => hint.fix?.action);\n    setHints(hints);\n  }, [datasource, visualQuery, data, queryModeller]);\n\n  return (\n    <>\n      {hints.length > 0 && (\n        <div className={styles.container}>\n          {hints.map((hint) => {\n            return (\n              // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n              <Tooltip content={`${hint.label} ${hint.fix?.label}`} key={hint.type}>\n                <Button\n                  onClick={() => {\n                    reportInteraction('grafana_query_builder_hints_clicked', {\n                      hint: hint.type,\n                      datasourceType: datasource.type,\n                    });\n\n                    if (hint?.fix?.action) {\n                      const query = { expr: queryModeller.renderQuery(visualQuery), refId: '' };\n                      const newQuery = datasource.modifyQuery(query, hint.fix.action);\n                      const newVisualQuery = buildVisualQueryFromString(newQuery.expr);\n                      return onChange(newVisualQuery.query);\n                    }\n                  }}\n                  fill=\"outline\"\n                  size=\"sm\"\n                  className={styles.hint}\n                >\n                  <Trans\n                    i18nKey=\"grafana-prometheus.querybuilder.query-builder-hints.hint-details\"\n                    values={{ hintDetails: hint.fix?.title || hint.fix?.action?.type.toLowerCase().replace('_', ' ') }}\n                  >\n                    hint: {'{{hintDetails}}'}\n                  </Trans>\n                </Button>\n              </Tooltip>\n            );\n          })}\n        </div>\n      )}\n    </>\n  );\n};\n\nQueryBuilderHints.displayName = 'QueryBuilderHints';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    container: css({\n      display: 'flex',\n      alignItems: 'start',\n    }),\n    hint: css({\n      marginRight: theme.spacing(1),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { memo, useState } from 'react';\n\nimport { DataSourceApi, getDefaultTimeRange } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorRow } from '@grafana/plugin-ui';\n\nimport promqlGrammar from '../../../promql';\nimport { getInitHints } from '../../../query_hints';\nimport { buildVisualQueryFromString } from '../../parsing';\nimport { OperationExplainedBox } from '../../shared/OperationExplainedBox';\nimport { OperationList } from '../../shared/OperationList';\nimport { OperationListExplained } from '../../shared/OperationListExplained';\nimport { OperationsEditorRow } from '../../shared/OperationsEditorRow';\nimport { QueryBuilderHints } from '../../shared/QueryBuilderHints';\nimport { RawQuery } from '../../shared/RawQuery';\nimport { promQueryModeller } from '../../shared/modeller_instance';\nimport { QueryBuilderOperation } from '../../shared/types';\nimport { PromVisualQuery } from '../../types';\nimport { MetricsLabelsSection } from '../MetricsLabelsSection';\nimport { EXPLAIN_LABEL_FILTER_CONTENT } from '../PromQueryBuilderExplained';\n\nimport { BaseQueryBuilderProps } from './BaseQueryBuilderProps';\n\nexport const QueryBuilderContent = memo<BaseQueryBuilderProps>((props) => {\n  const { datasource, query, onChange, onRunQuery, data, showExplain } = props;\n  const [highlightedOp, setHighlightedOp] = useState<QueryBuilderOperation | undefined>();\n\n  const lang = { grammar: promqlGrammar, name: 'promql' };\n  const initHints = getInitHints(datasource);\n\n  return (\n    <>\n      <EditorRow>\n        <MetricsLabelsSection\n          query={query}\n          onChange={onChange}\n          datasource={datasource}\n          timeRange={data?.timeRange ?? getDefaultTimeRange()}\n        />\n      </EditorRow>\n      {initHints.length ? (\n        <div\n          className={css({\n            flexBasis: '100%',\n          })}\n        >\n          <div className=\"text-warning\">\n            {initHints[0].label}{' '}\n            {initHints[0].fix ? (\n              <button type=\"button\" className={'text-warning'}>\n                {initHints[0].fix.label}\n              </button>\n            ) : null}\n          </div>\n        </div>\n      ) : null}\n      {showExplain && (\n        <OperationExplainedBox\n          stepNumber={1}\n          title={<RawQuery query={`${promQueryModeller.renderQuery(query)}`} lang={lang} />}\n        >\n          {EXPLAIN_LABEL_FILTER_CONTENT}\n        </OperationExplainedBox>\n      )}\n      <OperationsEditorRow>\n        <OperationList<PromVisualQuery>\n          queryModeller={promQueryModeller}\n          // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n          datasource={datasource as DataSourceApi}\n          query={query}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          highlightedOp={highlightedOp}\n          timeRange={data?.timeRange ?? getDefaultTimeRange()}\n        />\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.builder.hints}>\n          <QueryBuilderHints\n            datasource={datasource}\n            query={query}\n            onChange={onChange}\n            data={data}\n            queryModeller={promQueryModeller}\n            buildVisualQueryFromString={buildVisualQueryFromString}\n          />\n        </div>\n      </OperationsEditorRow>\n      {showExplain && (\n        <OperationListExplained<PromVisualQuery>\n          lang={lang}\n          query={query}\n          stepNumber={2}\n          queryModeller={promQueryModeller}\n          onMouseEnter={(op: QueryBuilderOperation) => setHighlightedOp(op)}\n          onMouseLeave={() => setHighlightedOp(undefined)}\n        />\n      )}\n    </>\n  );\n});\n\nQueryBuilderContent.displayName = 'QueryBuilderContent';\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/NestedQuery.tsx\nimport { css } from '@emotion/css';\nimport { memo } from 'react';\n\nimport { GrafanaTheme2, toOption } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { EditorRows, FlexItem } from '@grafana/plugin-ui';\nimport { AutoSizeInput, IconButton, Select, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { binaryScalarDefs } from '../binaryScalarOperations';\nimport { PromVisualQueryBinary } from '../types';\n\nimport { QueryBuilderContent } from './shared/QueryBuilderContent';\n\nexport interface NestedQueryProps {\n  nestedQuery: PromVisualQueryBinary;\n  datasource: PrometheusDatasource;\n  index: number;\n  onChange: (index: number, update: PromVisualQueryBinary) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n  showExplain: boolean;\n}\n\nexport const NestedQuery = memo<NestedQueryProps>((props) => {\n  const { nestedQuery, index, datasource, onChange, onRemove, onRunQuery, showExplain } = props;\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.card}>\n      <div className={styles.header}>\n        <div className={styles.name}>\n          <Trans i18nKey=\"grafana-prometheus.querybuilder.nested-query.operator\">Operator</Trans>\n        </div>\n        <Select\n          width=\"auto\"\n          options={operators}\n          value={toOption(nestedQuery.operator)}\n          onChange={(value) => {\n            onChange(index, {\n              ...nestedQuery,\n              operator: value.value!,\n            });\n          }}\n        />\n        <div className={styles.name}>\n          <Trans i18nKey=\"grafana-prometheus.querybuilder.nested-query.vector-matches\">Vector matches</Trans>\n        </div>\n        <div className={styles.vectorMatchWrapper}>\n          <Select<PromVisualQueryBinary['vectorMatchesType']>\n            width=\"auto\"\n            value={nestedQuery.vectorMatchesType || 'on'}\n            allowCustomValue\n            options={[\n              { value: 'on', label: t('grafana-prometheus.querybuilder.nested-query.label.on', 'On') },\n              {\n                value: 'ignoring',\n                label: t('grafana-prometheus.querybuilder.nested-query.label.ignoring', 'Ignoring'),\n              },\n            ]}\n            onChange={(val) => {\n              onChange(index, {\n                ...nestedQuery,\n                vectorMatchesType: val.value,\n              });\n            }}\n          />\n          <AutoSizeInput\n            className={styles.vectorMatchInput}\n            minWidth={20}\n            defaultValue={nestedQuery.vectorMatches}\n            onCommitChange={(evt) => {\n              onChange(index, {\n                ...nestedQuery,\n                vectorMatches: evt.currentTarget.value,\n                vectorMatchesType: nestedQuery.vectorMatchesType || 'on',\n              });\n            }}\n          />\n        </div>\n        <FlexItem grow={1} />\n        <IconButton\n          name=\"times\"\n          size=\"sm\"\n          onClick={() => onRemove(index)}\n          tooltip={t('grafana-prometheus.querybuilder.nested-query.tooltip-remove-match', 'Remove match')}\n        />\n      </div>\n      <div className={styles.body}>\n        <EditorRows>\n          <QueryBuilderContent\n            showExplain={showExplain}\n            query={nestedQuery.query}\n            datasource={datasource}\n            onRunQuery={onRunQuery}\n            onChange={(update) => {\n              onChange(index, { ...nestedQuery, query: update });\n            }}\n          />\n        </EditorRows>\n      </div>\n    </div>\n  );\n});\n\nconst operators = binaryScalarDefs.map((def) => ({ label: def.sign, value: def.sign }));\n\nNestedQuery.displayName = 'NestedQuery';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      label: 'card',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(0.5),\n    }),\n    header: css({\n      label: 'header',\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      gap: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    name: css({\n      label: 'name',\n      whiteSpace: 'nowrap',\n    }),\n    body: css({\n      label: 'body',\n      paddingLeft: theme.spacing(2),\n    }),\n    vectorMatchInput: css({\n      label: 'vectorMatchInput',\n      marginLeft: -1,\n    }),\n    vectorMatchWrapper: css({\n      label: 'vectorMatchWrapper',\n      display: 'flex',\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/NestedQueryList.tsx\nimport { Stack } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromVisualQuery, PromVisualQueryBinary } from '../types';\n\nimport { NestedQuery } from './NestedQuery';\n\nexport interface NestedQueryListProps {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (query: PromVisualQuery) => void;\n  onRunQuery: () => void;\n  showExplain: boolean;\n}\n\nexport function NestedQueryList(props: NestedQueryListProps) {\n  const { query, datasource, onChange, onRunQuery, showExplain } = props;\n  const nestedQueries = query.binaryQueries ?? [];\n\n  const onNestedQueryUpdate = (index: number, update: PromVisualQueryBinary) => {\n    const updatedList = [...nestedQueries];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...nestedQueries.slice(0, index), ...nestedQueries.slice(index + 1)];\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  return (\n    <Stack direction=\"column\" gap={1}>\n      {nestedQueries.map((nestedQuery, index) => (\n        <NestedQuery\n          key={index.toString()}\n          nestedQuery={nestedQuery}\n          index={index}\n          onChange={onNestedQueryUpdate}\n          datasource={datasource}\n          onRemove={onRemove}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      ))}\n    </Stack>\n  );\n}\n","import { memo } from 'react';\n\nimport { NestedQueryList } from '../NestedQueryList';\n\nimport { BaseQueryBuilderProps } from './BaseQueryBuilderProps';\nimport { QueryBuilderContent } from './QueryBuilderContent';\n\nexport const BaseQueryBuilder = memo<BaseQueryBuilderProps>((props) => {\n  const { query, datasource, onChange, onRunQuery, showExplain } = props;\n\n  return (\n    <>\n      <QueryBuilderContent {...props} />\n      {query.binaryQueries && query.binaryQueries.length > 0 && (\n        <NestedQueryList\n          query={query}\n          datasource={datasource}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          showExplain={showExplain}\n        />\n      )}\n    </>\n  );\n});\n\nBaseQueryBuilder.displayName = 'BaseQueryBuilder';\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilder.tsx\nimport { memo } from 'react';\n\nimport { PanelData } from '@grafana/data';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromVisualQuery } from '../types';\n\nimport { BaseQueryBuilder } from './shared/BaseQueryBuilder';\n\nexport interface PromQueryBuilderProps {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromVisualQuery) => void;\n  onRunQuery: () => void;\n  data?: PanelData;\n  showExplain: boolean;\n}\n\nexport const PromQueryBuilder = memo<PromQueryBuilderProps>((props) => {\n  return <BaseQueryBuilder {...props} />;\n});\n\nPromQueryBuilder.displayName = 'PromQueryBuilder';\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/QueryPreview.tsx\nimport { EditorFieldGroup, EditorRow } from '@grafana/plugin-ui';\n\nimport promqlGrammar from '../../promql';\nimport { RawQuery } from '../shared/RawQuery';\n\nexport interface QueryPreviewProps {\n  query: string;\n}\n\nexport function QueryPreview({ query }: QueryPreviewProps) {\n  if (!query) {\n    return null;\n  }\n\n  return (\n    <EditorRow>\n      <EditorFieldGroup>\n        <RawQuery query={query} lang={{ grammar: promqlGrammar, name: 'promql' }} />\n      </EditorFieldGroup>\n    </EditorRow>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderContainer.tsx\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { useEffect, useReducer } from 'react';\n\nimport { PanelData } from '@grafana/data';\n\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromQuery } from '../../types';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { promQueryModeller } from '../shared/modeller_instance';\nimport { PromVisualQuery } from '../types';\n\nimport { PromQueryBuilder } from './PromQueryBuilder';\nimport { QueryPreview } from './QueryPreview';\nimport { getSettings, MetricsModalSettings } from './metrics-modal/state/state';\n\nexport interface PromQueryBuilderContainerProps {\n  query: PromQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromQuery) => void;\n  onRunQuery: () => void;\n  data?: PanelData;\n  showExplain: boolean;\n}\n\nexport interface State {\n  visQuery?: PromVisualQuery;\n  expr: string;\n}\n\n/**\n * This component is here just to contain the translation logic between string query and the visual query builder model.\n */\nexport function PromQueryBuilderContainer(props: PromQueryBuilderContainerProps) {\n  const { query, onChange, onRunQuery, datasource, data, showExplain } = props;\n  const [state, dispatch] = useReducer(stateSlice.reducer, { expr: query.expr });\n  // Only rebuild visual query if expr changes from outside\n  useEffect(() => {\n    dispatch(exprChanged(query.expr));\n    dispatch(\n      setMetricsModalSettings({\n        useBackend: query.useBackend ?? false,\n        disableTextWrap: query.disableTextWrap ?? false,\n        fullMetaSearch: query.fullMetaSearch ?? false,\n        includeNullMetadata: query.includeNullMetadata ?? true,\n      })\n    );\n  }, [query]);\n\n  useEffect(() => {\n    datasource.languageProvider.start(data?.timeRange);\n  }, [data?.timeRange, datasource.languageProvider]);\n\n  const onVisQueryChange = (visQuery: PromVisualQuery) => {\n    const expr = promQueryModeller.renderQuery(visQuery);\n    dispatch(visualQueryChange({ visQuery, expr }));\n\n    const metricsModalSettings = getSettings(visQuery);\n    onChange({ ...props.query, expr: expr, ...metricsModalSettings });\n  };\n\n  if (!state.visQuery) {\n    return null;\n  }\n\n  return (\n    <>\n      <PromQueryBuilder\n        query={state.visQuery}\n        datasource={datasource}\n        onChange={onVisQueryChange}\n        onRunQuery={onRunQuery}\n        data={data}\n        showExplain={showExplain}\n      />\n      {<QueryPreview query={query.expr} />}\n    </>\n  );\n}\n\nconst initialState: State = {\n  expr: '',\n};\n\nconst stateSlice = createSlice({\n  name: 'prom-builder-container',\n  initialState,\n  reducers: {\n    visualQueryChange: (state, action: PayloadAction<{ visQuery: PromVisualQuery; expr: string }>) => {\n      state.expr = action.payload.expr;\n      state.visQuery = action.payload.visQuery;\n    },\n    exprChanged: (state, action: PayloadAction<string>) => {\n      if (!state.visQuery || state.expr !== action.payload) {\n        state.expr = action.payload;\n        const parseResult = buildVisualQueryFromString(action.payload ?? '');\n\n        state.visQuery = parseResult.query;\n      }\n    },\n    setMetricsModalSettings: (state, action: PayloadAction<MetricsModalSettings>) => {\n      if (state.visQuery) {\n        state.visQuery.useBackend = action.payload.useBackend;\n        state.visQuery.disableTextWrap = action.payload.disableTextWrap;\n        state.visQuery.fullMetaSearch = action.payload.fullMetaSearch;\n        state.visQuery.includeNullMetadata = action.payload.includeNullMetadata;\n      }\n    },\n  },\n});\n\nconst { visualQueryChange, exprChanged, setMetricsModalSettings } = stateSlice.actions;\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromExemplarField.tsx\nimport { css, cx } from '@emotion/css';\nimport { useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Trans, t } from '@grafana/i18n';\nimport { IconButton, InlineLabel, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\ninterface Props {\n  onChange: (exemplar: boolean) => void;\n  datasource: PrometheusDatasource;\n  query: PromQuery;\n  'data-testid'?: string;\n}\n\nexport function PromExemplarField({ datasource, onChange, query, ...rest }: Props) {\n  const [error, setError] = useState<string | null>(null);\n  const styles = useStyles2(getStyles);\n  const prevError = usePrevious(error);\n\n  useEffect(() => {\n    if (!datasource.exemplarsAvailable) {\n      setError('Exemplars for this query are not available');\n      onChange(false);\n    } else if (query.instant && !query.range) {\n      setError('Exemplars are not available for instant queries');\n      onChange(false);\n    } else {\n      setError(null);\n      // If error is cleared, we want to change exemplar to true\n      if (prevError && !error) {\n        onChange(true);\n      }\n    }\n  }, [datasource.exemplarsAvailable, query.instant, query.range, onChange, prevError, error]);\n\n  const iconButtonStyles = cx(\n    {\n      [styles.activeIcon]: !!query.exemplar,\n    },\n    styles.eyeIcon\n  );\n\n  return (\n    <InlineLabel width=\"auto\" data-testid={rest['data-testid']}>\n      <Tooltip content={error ?? ''}>\n        <div className={styles.iconWrapper}>\n          <Trans i18nKey=\"grafana-prometheus.components.prom-exemplar-field.exemplars\">Exemplars</Trans>\n          <IconButton\n            name=\"eye\"\n            tooltip={\n              !!query.exemplar\n                ? t(\n                    'grafana-prometheus.components.prom-exemplar-field.tooltip-disable-query',\n                    'Disable query with exemplars'\n                  )\n                : t(\n                    'grafana-prometheus.components.prom-exemplar-field.tooltip-enable-query',\n                    'Enable query with exemplars'\n                  )\n            }\n            disabled={!!error}\n            className={iconButtonStyles}\n            onClick={() => {\n              onChange(!query.exemplar);\n            }}\n          />\n        </div>\n      </Tooltip>\n    </InlineLabel>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    eyeIcon: css({\n      marginLeft: theme.spacing(2),\n    }),\n    activeIcon: css({\n      color: theme.colors.primary.main,\n    }),\n    iconWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n    }),\n  };\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromExploreExtraField.tsx\nimport { css, cx } from '@emotion/css';\nimport { isEqual } from 'lodash';\nimport { memo, useCallback } from 'react';\nimport * as React from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { t, Trans } from '@grafana/i18n';\nimport { InlineFormLabel, RadioButtonGroup, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\nimport { PromExemplarField } from './PromExemplarField';\n\nexport interface PromExploreExtraFieldProps {\n  query: PromQuery;\n  onChange: (value: PromQuery) => void;\n  onRunQuery: () => void;\n  datasource: PrometheusDatasource;\n}\n\nexport const PromExploreExtraField = memo(({ query, datasource, onChange, onRunQuery }: PromExploreExtraFieldProps) => {\n  const rangeOptions = getQueryTypeOptions(true);\n  const prevQuery = usePrevious(query);\n  const styles = useStyles2(getStyles);\n\n  const onExemplarChange = useCallback(\n    (exemplar: boolean) => {\n      if (!isEqual(query, prevQuery) || exemplar !== query.exemplar) {\n        onChange({ ...query, exemplar });\n      }\n    },\n    [prevQuery, query, onChange]\n  );\n\n  function onChangeQueryStep(interval: string) {\n    onChange({ ...query, interval });\n  }\n\n  function onStepChange(e: React.SyntheticEvent<HTMLInputElement>) {\n    if (e.currentTarget.value !== query.interval) {\n      onChangeQueryStep(e.currentTarget.value);\n    }\n  }\n\n  function onReturnKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n    if (e.key === 'Enter' && e.shiftKey) {\n      onRunQuery();\n    }\n  }\n\n  const onQueryTypeChange = getQueryTypeChangeHandler(query, onChange);\n\n  return (\n    <div\n      aria-label={t(\n        'grafana-prometheus.components.prom-explore-extra-field.aria-label-prometheus-extra-field',\n        'Prometheus extra field'\n      )}\n      className=\"gf-form-inline\"\n      data-testid={promExploreExtraFieldTestIds.extraFieldEditor}\n    >\n      {/*Query type field*/}\n      <div\n        data-testid={promExploreExtraFieldTestIds.queryTypeField}\n        className={cx(\n          'gf-form',\n          styles.queryTypeField,\n          css({\n            flexWrap: 'nowrap',\n          })\n        )}\n        aria-label={t(\n          'grafana-prometheus.components.prom-explore-extra-field.aria-label-query-type-field',\n          'Query type field'\n        )}\n      >\n        <InlineFormLabel width=\"auto\">\n          <Trans i18nKey=\"grafana-prometheus.components.prom-explore-extra-field.query-type\">Query type</Trans>\n        </InlineFormLabel>\n\n        <RadioButtonGroup\n          options={rangeOptions}\n          value={query.range && query.instant ? 'both' : query.instant ? 'instant' : 'range'}\n          onChange={onQueryTypeChange}\n        />\n      </div>\n      {/*Step field*/}\n      <div\n        data-testid={promExploreExtraFieldTestIds.stepField}\n        className={cx(\n          'gf-form',\n          css({\n            flexWrap: 'nowrap',\n          })\n        )}\n        aria-label={t('grafana-prometheus.components.prom-explore-extra-field.aria-label-step-field', 'Step field')}\n      >\n        <InlineFormLabel\n          width={6}\n          tooltip={t(\n            'grafana-prometheus.components.prom-explore-extra-field.tooltip-units-builtin-variables-example-interval-rateinterval',\n            'Time units and built-in variables can be used here, for example: {{example1}}, {{example2}}, {{example3}}, {{example4}}, {{example5}}, {{example6}}, {{example7}} (Default if no unit is specified: {{default}})',\n            {\n              example1: '$__interval',\n              example2: '$__rate_interval',\n              example3: '5s',\n              example4: '1m',\n              example5: '3h',\n              example6: '1d',\n              example7: '1y',\n              default: 's',\n            }\n          )}\n        >\n          <Trans i18nKey=\"grafana-prometheus.components.prom-explore-extra-field.min-step\">Min step</Trans>\n        </InlineFormLabel>\n        <input\n          type={'text'}\n          className=\"gf-form-input width-4\"\n          // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n          placeholder=\"auto\"\n          onChange={onStepChange}\n          onKeyDown={onReturnKeyDown}\n          value={query.interval ?? ''}\n        />\n      </div>\n\n      <PromExemplarField onChange={onExemplarChange} datasource={datasource} query={query} />\n    </div>\n  );\n});\n\nPromExploreExtraField.displayName = 'PromExploreExtraField';\n\nexport function getQueryTypeOptions(includeBoth: boolean) {\n  const rangeOptions = [\n    {\n      value: 'range',\n      label: t('grafana-prometheus.components.get-query-type-options.range-options.label.range', 'Range'),\n      description: t(\n        'grafana-prometheus.components.get-query-type-options.range-options.description.query-range',\n        'Run query over a range of time'\n      ),\n    },\n    {\n      value: 'instant',\n      label: t('grafana-prometheus.components.get-query-type-options.range-options.label.instant', 'Instant'),\n      description: 'Run query against a single point in time. For this query, the \"To\" time is used',\n    },\n  ];\n\n  if (includeBoth) {\n    rangeOptions.push({\n      value: 'both',\n      label: t('grafana-prometheus.components.get-query-type-options.label.both', 'Both'),\n      description: t(\n        'grafana-prometheus.components.get-query-type-options.description.instant-query-range',\n        'Run an Instant query and a Range query'\n      ),\n    });\n  }\n\n  return rangeOptions;\n}\n\nexport function getQueryTypeChangeHandler(query: PromQuery, onChange: (update: PromQuery) => void) {\n  return (queryType: string) => {\n    if (queryType === 'instant') {\n      onChange({ ...query, instant: true, range: false, exemplar: false });\n    } else if (queryType === 'range') {\n      onChange({ ...query, instant: false, range: true });\n    } else {\n      onChange({ ...query, instant: true, range: true });\n    }\n  };\n}\n\nexport const promExploreExtraFieldTestIds = {\n  extraFieldEditor: 'prom-editor-extra-field',\n  stepField: 'prom-editor-extra-field-step',\n  queryTypeField: 'prom-editor-extra-field-query-type',\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  queryTypeField: css({\n    marginRight: theme.spacing(0.5),\n  }),\n});\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/shared/QueryOptionGroup.tsx\nimport { css } from '@emotion/css';\nimport * as React from 'react';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Collapse, useStyles2, Stack } from '@grafana/ui';\n\nexport interface Props {\n  title: string;\n  collapsedInfo: string[];\n  children: React.ReactNode;\n}\n\nexport function QueryOptionGroup({ title, children, collapsedInfo }: Props) {\n  const [isOpen, toggleOpen] = useToggle(false);\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.wrapper}>\n      <Collapse\n        className={styles.collapse}\n        collapsible\n        isOpen={isOpen}\n        onToggle={toggleOpen}\n        label={\n          <Stack gap={0}>\n            <h6 className={styles.title}>{title}</h6>\n            {!isOpen && (\n              <div className={styles.description}>\n                {collapsedInfo.map((x, i) => (\n                  <span key={i}>{x}</span>\n                ))}\n              </div>\n            )}\n          </Stack>\n        }\n      >\n        <div className={styles.body}>{children}</div>\n      </Collapse>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    collapse: css({\n      backgroundColor: 'unset',\n      border: 'unset',\n      marginBottom: 0,\n\n      ['> button']: {\n        padding: theme.spacing(0, 1),\n      },\n    }),\n    wrapper: css({\n      width: '100%',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'baseline',\n    }),\n    title: css({\n      flexGrow: 1,\n      overflow: 'hidden',\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.fontWeightMedium,\n      margin: 0,\n    }),\n    description: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      fontWeight: theme.typography.bodySmall.fontWeight,\n      paddingLeft: theme.spacing(2),\n      gap: theme.spacing(2),\n      display: 'flex',\n    }),\n    body: css({\n      display: 'flex',\n      gap: theme.spacing(2),\n      flexWrap: 'wrap',\n    }),\n    tooltip: css({\n      marginRight: theme.spacing(0.25),\n    }),\n  };\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryLegendEditor.tsx\nimport { useRef } from 'react';\nimport * as React from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t } from '@grafana/i18n';\nimport { EditorField } from '@grafana/plugin-ui';\nimport { AutoSizeInput, Select } from '@grafana/ui';\n\nimport { LegendFormatMode } from '../../types';\n\nexport interface PromQueryLegendEditorProps {\n  legendFormat: string | undefined;\n  onChange: (legendFormat: string) => void;\n  onRunQuery: () => void;\n}\n\nconst getLegendModeOptions = () => [\n  {\n    label: t('grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.label-auto', 'Auto'),\n    value: LegendFormatMode.Auto,\n    description: t(\n      'grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.description-auto',\n      'Only includes unique labels'\n    ),\n  },\n  {\n    label: t('grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.label-verbose', 'Verbose'),\n    value: LegendFormatMode.Verbose,\n    description: t(\n      'grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.description-verbose',\n      'All label names and values'\n    ),\n  },\n  {\n    label: t('grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.label-custom', 'Custom'),\n    value: LegendFormatMode.Custom,\n    description: t(\n      'grafana-prometheus.prom-query-legend-editor.get-legend-mode-options.description-custom',\n      'Provide a naming template'\n    ),\n  },\n];\n\n/**\n * Tests for this component are on the parent level (PromQueryBuilderOptions).\n */\nexport const PromQueryLegendEditor = React.memo<PromQueryLegendEditorProps>(\n  ({ legendFormat, onChange, onRunQuery }) => {\n    const mode = getLegendMode(legendFormat);\n    const inputRef = useRef<HTMLInputElement | null>(null);\n    const legendModeOptions = getLegendModeOptions();\n\n    const onLegendFormatChanged = (evt: React.FormEvent<HTMLInputElement>) => {\n      let newFormat = evt.currentTarget.value;\n      if (newFormat.length === 0) {\n        newFormat = LegendFormatMode.Auto;\n      }\n\n      if (newFormat !== legendFormat) {\n        onChange(newFormat);\n        onRunQuery();\n      }\n    };\n\n    const onLegendModeChanged = (value: SelectableValue<LegendFormatMode>) => {\n      switch (value.value!) {\n        case LegendFormatMode.Auto:\n          onChange(LegendFormatMode.Auto);\n          break;\n        case LegendFormatMode.Custom:\n          onChange('{{label_name}}');\n          setTimeout(() => {\n            inputRef.current?.focus();\n            inputRef.current?.setSelectionRange(2, 12, 'forward');\n          }, 10);\n          break;\n        case LegendFormatMode.Verbose:\n          onChange('');\n          break;\n      }\n      onRunQuery();\n    };\n\n    return (\n      <EditorField\n        label={t('grafana-prometheus.querybuilder.prom-query-legend-editor.label-legend', 'Legend')}\n        tooltip={t(\n          'grafana-prometheus.querybuilder.prom-query-legend-editor.tooltip-legend',\n          'Series name override or template. Ex. {{templateExample}} will be replaced with label value for {{labelName}}.',\n          { templateExample: '{{hostname}}', labelName: 'hostname' }\n        )}\n        data-testid={selectors.components.DataSource.Prometheus.queryEditor.legend}\n      >\n        <>\n          {mode === LegendFormatMode.Custom && (\n            <AutoSizeInput\n              id=\"legendFormat\"\n              minWidth={22}\n              // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n              placeholder=\"auto\"\n              defaultValue={legendFormat}\n              onCommitChange={onLegendFormatChanged}\n              ref={inputRef}\n            />\n          )}\n          {mode !== LegendFormatMode.Custom && (\n            <Select\n              inputId=\"legend.mode\"\n              isSearchable={false}\n              placeholder={t(\n                'grafana-prometheus.querybuilder.prom-query-legend-editor.placeholder-select-legend-mode',\n                'Select legend mode'\n              )}\n              options={legendModeOptions}\n              width={22}\n              onChange={onLegendModeChanged}\n              value={legendModeOptions.find((x) => x.value === mode)}\n            />\n          )}\n        </>\n      </EditorField>\n    );\n  }\n);\n\nPromQueryLegendEditor.displayName = 'PromQueryLegendEditor';\n\nfunction getLegendMode(legendFormat: string | undefined) {\n  // This special value means the new smart minimal series naming\n  if (legendFormat === LegendFormatMode.Auto) {\n    return LegendFormatMode.Auto;\n  }\n\n  // Missing or empty legend format is the old verbose behavior\n  if (legendFormat == null || legendFormat === '') {\n    return LegendFormatMode.Verbose;\n  }\n\n  return LegendFormatMode.Custom;\n}\n\nexport function getLegendModeLabel(legendFormat: string | undefined) {\n  const legendModeOptions = getLegendModeOptions();\n  const mode = getLegendMode(legendFormat);\n  if (mode !== LegendFormatMode.Custom) {\n    return legendModeOptions.find((x) => x.value === mode)?.label;\n  }\n  return legendFormat;\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderOptions.tsx\nimport { map } from 'lodash';\nimport { SyntheticEvent } from 'react';\nimport * as React from 'react';\n\nimport { CoreApp, SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { EditorField, EditorRow, EditorSwitch } from '@grafana/plugin-ui';\nimport { AutoSizeInput, RadioButtonGroup, Select } from '@grafana/ui';\n\nimport { getQueryTypeChangeHandler, getQueryTypeOptions } from '../../components/PromExploreExtraField';\nimport { PromQueryFormat } from '../../dataquery';\nimport { PromQuery } from '../../types';\nimport { QueryOptionGroup } from '../shared/QueryOptionGroup';\n\nimport { getLegendModeLabel, PromQueryLegendEditor } from './PromQueryLegendEditor';\n\nexport interface UIOptions {\n  exemplars: boolean;\n  type: boolean;\n  format: boolean;\n  minStep: boolean;\n  legend: boolean;\n  resolution: boolean;\n}\n\nexport interface PromQueryBuilderOptionsProps {\n  query: PromQuery;\n  app?: CoreApp;\n  onChange: (update: PromQuery) => void;\n  onRunQuery: () => void;\n}\n\nconst INTERVAL_FACTOR_OPTIONS: Array<SelectableValue<number>> = map([1, 2, 3, 4, 5, 10], (value: number) => ({\n  value,\n  label: '1/' + value,\n}));\n\nexport const PromQueryBuilderOptions = React.memo<PromQueryBuilderOptionsProps>(\n  ({ query, app, onChange, onRunQuery }) => {\n    const FORMAT_OPTIONS: Array<SelectableValue<PromQueryFormat>> = [\n      {\n        label: t(\n          'grafana-prometheus.querybuilder.prom-query-builder-options.format-options.label-time-series',\n          'Time series'\n        ),\n        value: 'time_series',\n      },\n      {\n        label: t('grafana-prometheus.querybuilder.prom-query-builder-options.format-options.label-table', 'Table'),\n        value: 'table',\n      },\n      {\n        label: t('grafana-prometheus.querybuilder.prom-query-builder-options.format-options.label-heatmap', 'Heatmap'),\n        value: 'heatmap',\n      },\n    ];\n\n    const onChangeFormat = (value: SelectableValue<PromQueryFormat>) => {\n      onChange({ ...query, format: value.value });\n      onRunQuery();\n    };\n\n    const onChangeStep = (evt: React.FormEvent<HTMLInputElement>) => {\n      onChange({ ...query, interval: evt.currentTarget.value.trim() });\n      onRunQuery();\n    };\n\n    const queryTypeOptions = getQueryTypeOptions(\n      app === CoreApp.Explore || app === CoreApp.Correlations || app === CoreApp.PanelEditor\n    );\n\n    const onQueryTypeChange = getQueryTypeChangeHandler(query, onChange);\n\n    const onExemplarChange = (event: SyntheticEvent<HTMLInputElement>) => {\n      const isEnabled = event.currentTarget.checked;\n      onChange({ ...query, exemplar: isEnabled });\n      onRunQuery();\n    };\n\n    const onIntervalFactorChange = (value: SelectableValue<number>) => {\n      onChange({ ...query, intervalFactor: value.value });\n      onRunQuery();\n    };\n\n    const formatOption = FORMAT_OPTIONS.find((option) => option.value === query.format) || FORMAT_OPTIONS[0];\n    const queryTypeValue = getQueryTypeValue(query);\n    const queryTypeLabel = queryTypeOptions.find((x) => x.value === queryTypeValue)!.label;\n\n    return (\n      <EditorRow>\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.options}>\n          <QueryOptionGroup\n            title={t('grafana-prometheus.querybuilder.prom-query-builder-options.title-options', 'Options')}\n            collapsedInfo={getCollapsedInfo(query, formatOption.label!, queryTypeLabel, app)}\n          >\n            <PromQueryLegendEditor\n              legendFormat={query.legendFormat}\n              onChange={(legendFormat) => onChange({ ...query, legendFormat })}\n              onRunQuery={onRunQuery}\n            />\n            <EditorField\n              label={t('grafana-prometheus.querybuilder.prom-query-builder-options.label-min-step', 'Min step')}\n              tooltip={\n                <>\n                  <Trans\n                    i18nKey=\"grafana-prometheus.querybuilder.prom-query-builder-options.tooltip-min-step\"\n                    values={{\n                      interval: '$__interval',\n                      rateInterval: '$__rate_interval',\n                    }}\n                  >\n                    An additional lower limit for the step parameter of the Prometheus query and for the{' '}\n                    <code>{'{{interval}}'}</code> and <code>{'{{rateInterval}}'}</code> variables.\n                  </Trans>\n                </>\n              }\n            >\n              <AutoSizeInput\n                type=\"text\"\n                aria-label={t(\n                  'grafana-prometheus.querybuilder.prom-query-builder-options.aria-label-lower-limit-parameter',\n                  'Set lower limit for the step parameter'\n                )}\n                placeholder={t('grafana-prometheus.querybuilder.prom-query-builder-options.placeholder-auto', 'auto')}\n                minWidth={10}\n                onCommitChange={onChangeStep}\n                defaultValue={query.interval}\n                data-testid={selectors.components.DataSource.Prometheus.queryEditor.step}\n              />\n            </EditorField>\n            <EditorField label={t('grafana-prometheus.querybuilder.prom-query-builder-options.label-format', 'Format')}>\n              <Select\n                data-testid={selectors.components.DataSource.Prometheus.queryEditor.format}\n                value={formatOption}\n                allowCustomValue\n                onChange={onChangeFormat}\n                options={FORMAT_OPTIONS}\n              />\n            </EditorField>\n            <EditorField\n              label={t('grafana-prometheus.querybuilder.prom-query-builder-options.label-type', 'Type')}\n              data-testid={selectors.components.DataSource.Prometheus.queryEditor.type}\n            >\n              <RadioButtonGroup options={queryTypeOptions} value={queryTypeValue} onChange={onQueryTypeChange} />\n            </EditorField>\n            {shouldShowExemplarSwitch(query, app) && (\n              <EditorField\n                label={t('grafana-prometheus.querybuilder.prom-query-builder-options.label-exemplars', 'Exemplars')}\n              >\n                <EditorSwitch\n                  value={query.exemplar || false}\n                  onChange={onExemplarChange}\n                  data-testid={selectors.components.DataSource.Prometheus.queryEditor.exemplars}\n                />\n              </EditorField>\n            )}\n            {query.intervalFactor && query.intervalFactor > 1 && (\n              <EditorField\n                label={t('grafana-prometheus.querybuilder.prom-query-builder-options.label-resolution', 'Resolution')}\n              >\n                <Select\n                  aria-label={t(\n                    'grafana-prometheus.querybuilder.prom-query-builder-options.aria-label-select-resolution',\n                    'Select resolution'\n                  )}\n                  isSearchable={false}\n                  options={INTERVAL_FACTOR_OPTIONS}\n                  onChange={onIntervalFactorChange}\n                  value={INTERVAL_FACTOR_OPTIONS.find((option) => option.value === query.intervalFactor)}\n                />\n              </EditorField>\n            )}\n          </QueryOptionGroup>\n        </div>\n      </EditorRow>\n    );\n  }\n);\n\nfunction shouldShowExemplarSwitch(query: PromQuery, app?: CoreApp) {\n  if (app === CoreApp.UnifiedAlerting || !query.range) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction getQueryTypeValue(query: PromQuery) {\n  return query.range && query.instant ? 'both' : query.instant ? 'instant' : 'range';\n}\n\nfunction getCollapsedInfo(query: PromQuery, formatOption: string, queryType: string, app?: CoreApp): string[] {\n  const items: string[] = [];\n\n  items.push(\n    t('grafana-prometheus.querybuilder.get-collapsed-info.legend', 'Legend: {{value}}', {\n      value: getLegendModeLabel(query.legendFormat),\n    })\n  );\n  items.push(\n    t('grafana-prometheus.querybuilder.get-collapsed-info.format', 'Format: {{value}}', { value: formatOption })\n  );\n  items.push(\n    t('grafana-prometheus.querybuilder.get-collapsed-info.step', 'Step: {{value}}', { value: query.interval ?? 'auto' })\n  );\n  items.push(t('grafana-prometheus.querybuilder.get-collapsed-info.type', 'Type: {{value}}', { value: queryType }));\n\n  if (shouldShowExemplarSwitch(query, app)) {\n    items.push(\n      t('grafana-prometheus.querybuilder.get-collapsed-info.exemplars', 'Exemplars: {{value}}', {\n        value: query.exemplar ? 'true' : 'false',\n      })\n    );\n  }\n  return items;\n}\n\nPromQueryBuilderOptions.displayName = 'PromQueryBuilderOptions';\n","import { useState, useEffect, useCallback } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { config } from '@grafana/runtime';\nimport { IconButton, Text, Stack } from '@grafana/ui';\n\nimport {\n  CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT,\n  isSuggestionsIncompleteEvent,\n} from '../../components/monaco-query-field/monaco-completion-provider/data_provider';\nimport { PromQueryEditorProps } from '../../components/types';\nimport { QueryEditorMode } from '../shared/types';\n\ninterface Props {\n  datasourceUid: PromQueryEditorProps['datasource']['uid'];\n  editorMode: QueryEditorMode;\n}\n\nexport function PromQueryCodeEditorAutocompleteInfo(props: Readonly<Props>) {\n  const [autocompleteLimit, setAutocompleteLimit] = useState('n');\n  const [autocompleteLimitExceeded, setAutocompleteLimitExceeded] = useState(false);\n  const handleSuggestionsIncompleteEvent = useCallback(\n    (e: Event) => {\n      if (!isSuggestionsIncompleteEvent(e)) {\n        return;\n      }\n\n      if (e.detail.datasourceUid === props.datasourceUid) {\n        setAutocompleteLimitExceeded(true);\n        setAutocompleteLimit(e.detail.limit.toString());\n      }\n    },\n    [props.datasourceUid]\n  );\n\n  useEffect(() => {\n    window.addEventListener(CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT, handleSuggestionsIncompleteEvent);\n\n    return () => {\n      window.removeEventListener(CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT, handleSuggestionsIncompleteEvent);\n    };\n  }, [handleSuggestionsIncompleteEvent]);\n\n  const showCodeModeAutocompleteDisclaimer = (): boolean => {\n    return (\n      Boolean(config.featureToggles.prometheusCodeModeMetricNamesSearch) &&\n      props.editorMode === QueryEditorMode.Code &&\n      autocompleteLimitExceeded\n    );\n  };\n\n  if (!showCodeModeAutocompleteDisclaimer()) {\n    return null;\n  }\n\n  return (\n    <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.code.metricsCountInfo}>\n      <Stack direction=\"row\" gap={1}>\n        <Text color=\"secondary\" element=\"p\" italic={true}>\n          <Trans i18nKey=\"grafana-prometheus.querybuilder.prom-query-code-editor-autocomplete-info.autocomplete-suggestions-limited\">\n            Autocomplete suggestions limited\n          </Trans>\n        </Text>\n        <IconButton\n          name=\"info-circle\"\n          tooltip={t(\n            'grafana-prometheus.querybuilder.prom-query-code-editor-autocomplete-info.tooltip-autocomplete-suggestions-limited',\n            'The number of metric names exceeds the autocomplete limit. Only the {{autocompleteLimit}}-most relevant metrics are displayed. You can adjust the threshold in the data source settings.',\n            { autocompleteLimit }\n          )}\n        />\n      </Stack>\n    </div>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryEditorSelector.tsx\nimport { isEqual } from 'lodash';\nimport { memo, SyntheticEvent, useCallback, useEffect, useState } from 'react';\n\nimport { CoreApp, LoadingState } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t, Trans } from '@grafana/i18n';\nimport { EditorHeader, EditorRows, FlexItem } from '@grafana/plugin-ui';\nimport { reportInteraction } from '@grafana/runtime';\nimport { Button, ConfirmModal, Space } from '@grafana/ui';\n\nimport { PromQueryEditorProps } from '../../components/types';\nimport { PromQuery } from '../../types';\nimport { QueryPatternsModal } from '../QueryPatternsModal';\nimport { promQueryEditorExplainKey, useFlag } from '../hooks/useFlag';\nimport { buildVisualQueryFromString } from '../parsing';\nimport { QueryEditorModeToggle } from '../shared/QueryEditorModeToggle';\nimport { QueryHeaderSwitch } from '../shared/QueryHeaderSwitch';\nimport { QueryEditorMode } from '../shared/types';\nimport { changeEditorMode, getQueryWithDefaults } from '../state';\n\nimport { PromQueryBuilderContainer } from './PromQueryBuilderContainer';\nimport { PromQueryBuilderOptions } from './PromQueryBuilderOptions';\nimport { PromQueryCodeEditor } from './PromQueryCodeEditor';\nimport { PromQueryCodeEditorAutocompleteInfo } from './PromQueryCodeEditorAutocompleteInfo';\n\ntype Props = PromQueryEditorProps;\n\nexport const PromQueryEditorSelector = memo<Props>((props) => {\n  const {\n    onChange,\n    onRunQuery,\n    data,\n    app,\n    onAddQuery,\n    datasource: { defaultEditor },\n    queries,\n  } = props;\n\n  const [parseModalOpen, setParseModalOpen] = useState(false);\n  const [queryPatternsModalOpen, setQueryPatternsModalOpen] = useState(false);\n  const [dataIsStale, setDataIsStale] = useState(false);\n  const { flag: explain, setFlag: setExplain } = useFlag(promQueryEditorExplainKey);\n\n  const query = getQueryWithDefaults(props.query, app, defaultEditor);\n  // This should be filled in from the defaults by now.\n  const editorMode = query.editorMode!;\n\n  const onEditorModeChange = useCallback(\n    (newMetricEditorMode: QueryEditorMode) => {\n      reportInteraction('user_grafana_prometheus_editor_mode_clicked', {\n        newEditor: newMetricEditorMode,\n        previousEditor: query.editorMode ?? '',\n        newQuery: !query.expr,\n        app: app ?? '',\n      });\n\n      if (newMetricEditorMode === QueryEditorMode.Builder) {\n        const result = buildVisualQueryFromString(query.expr || '');\n        // If there are errors, give user a chance to decide if they want to go to builder as that can lose some data.\n        if (result.errors.length) {\n          setParseModalOpen(true);\n          return;\n        }\n      }\n      changeEditorMode(query, newMetricEditorMode, onChange);\n    },\n    [onChange, query, app]\n  );\n\n  useEffect(() => {\n    setDataIsStale(false);\n  }, [data]);\n\n  const onChangeInternal = (query: PromQuery) => {\n    if (!isEqual(query, props.query)) {\n      setDataIsStale(true);\n    }\n    onChange(query);\n  };\n\n  const onShowExplainChange = (e: SyntheticEvent<HTMLInputElement>) => {\n    setExplain(e.currentTarget.checked);\n  };\n\n  const handleOpenQueryPatternsModal = useCallback(() => {\n    reportInteraction('grafana_prometheus_open_kickstart_clicked', {\n      app: app ?? '',\n    });\n    setQueryPatternsModalOpen(true);\n  }, [app]);\n\n  return (\n    <>\n      <ConfirmModal\n        isOpen={parseModalOpen}\n        title={t(\n          'grafana-prometheus.querybuilder.prom-query-editor-selector.title-parsing-error-switch-builder',\n          'Parsing error: Switch to the builder mode?'\n        )}\n        body={t(\n          'grafana-prometheus.querybuilder.prom-query-editor-selector.body-syntax-error',\n          'There is a syntax error, or the query structure cannot be visualized when switching to the builder mode. Parts of the query may be lost.'\n        )}\n        confirmText={t('grafana-prometheus.querybuilder.prom-query-editor-selector.confirmText-continue', 'Continue')}\n        onConfirm={() => {\n          changeEditorMode(query, QueryEditorMode.Builder, onChange);\n          setParseModalOpen(false);\n        }}\n        onDismiss={() => setParseModalOpen(false)}\n      />\n      <QueryPatternsModal\n        isOpen={queryPatternsModalOpen}\n        onClose={() => setQueryPatternsModalOpen(false)}\n        query={query}\n        queries={queries}\n        app={app}\n        onChange={onChange}\n        onAddQuery={onAddQuery}\n      />\n      <EditorHeader>\n        <Button\n          data-testid={selectors.components.QueryBuilder.queryPatterns}\n          variant=\"secondary\"\n          size=\"sm\"\n          onClick={handleOpenQueryPatternsModal}\n        >\n          <Trans i18nKey=\"grafana-prometheus.querybuilder.prom-query-editor-selector.kick-start-your-query\">\n            Kick start your query\n          </Trans>\n        </Button>\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.explain}>\n          <QueryHeaderSwitch\n            label={t('grafana-prometheus.querybuilder.prom-query-editor-selector.label-explain', 'Explain')}\n            value={explain}\n            onChange={onShowExplainChange}\n          />\n        </div>\n        <FlexItem grow={1} />\n        {app !== CoreApp.Explore && app !== CoreApp.Correlations && (\n          <Button\n            variant={dataIsStale ? 'primary' : 'secondary'}\n            size=\"sm\"\n            onClick={onRunQuery}\n            icon={data?.state === LoadingState.Loading ? 'spinner' : undefined}\n            disabled={data?.state === LoadingState.Loading}\n          >\n            <Trans i18nKey=\"grafana-prometheus.querybuilder.prom-query-editor-selector.run-queries\">Run queries</Trans>\n          </Button>\n        )}\n        <PromQueryCodeEditorAutocompleteInfo datasourceUid={props.datasource.uid} editorMode={editorMode} />\n        <div data-testid={selectors.components.DataSource.Prometheus.queryEditor.editorToggle}>\n          <QueryEditorModeToggle mode={editorMode} onChange={onEditorModeChange} />\n        </div>\n      </EditorHeader>\n      <Space v={0.5} />\n      <EditorRows>\n        {editorMode === QueryEditorMode.Code && (\n          <PromQueryCodeEditor {...props} query={query} showExplain={explain} onChange={onChangeInternal} />\n        )}\n        {editorMode === QueryEditorMode.Builder && (\n          <PromQueryBuilderContainer\n            query={query}\n            datasource={props.datasource}\n            onChange={onChangeInternal}\n            onRunQuery={props.onRunQuery}\n            data={data}\n            showExplain={explain}\n          />\n        )}\n        <PromQueryBuilderOptions query={query} app={props.app} onChange={onChange} onRunQuery={onRunQuery} />\n      </EditorRows>\n    </>\n  );\n});\n\nPromQueryEditorSelector.displayName = 'PromQueryEditorSelector';\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromQueryEditorForAlerting.tsx\nimport { PromQueryField } from './PromQueryField';\nimport { PromQueryEditorProps } from './types';\n\nexport function PromQueryEditorForAlerting(props: PromQueryEditorProps) {\n  const { datasource, query, range, data, onChange, onRunQuery } = props;\n\n  return (\n    <PromQueryField\n      datasource={datasource}\n      query={query}\n      onRunQuery={onRunQuery}\n      onChange={onChange}\n      history={[]}\n      range={range}\n      data={data}\n      data-testid={alertingTestIds.editor}\n    />\n  );\n}\n\nexport const alertingTestIds = {\n  editor: 'prom-editor-cloud-alerting',\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromQueryEditorByApp.tsx\nimport { memo } from 'react';\n\nimport { CoreApp } from '@grafana/data';\n\nimport { PromQueryEditorSelector } from '../querybuilder/components/PromQueryEditorSelector';\n\nimport { PromQueryEditorForAlerting } from './PromQueryEditorForAlerting';\nimport { PromQueryEditorProps } from './types';\n\nfunction PromQueryEditorByAppBase(props: PromQueryEditorProps) {\n  const { app } = props;\n\n  switch (app) {\n    case CoreApp.CloudAlerting:\n      return <PromQueryEditorForAlerting {...props} />;\n    default:\n      return <PromQueryEditorSelector {...props} />;\n  }\n}\n\nexport const PromQueryEditorByApp = memo(PromQueryEditorByAppBase);\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromCheatSheet.tsx\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2, QueryEditorHelpProps } from '@grafana/data';\nimport { Trans } from '@grafana/i18n';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { PromQuery } from '../types';\n\nconst CHEAT_SHEET_ITEMS = [\n  {\n    title: 'Request Rate',\n    expression: 'rate(http_request_total[5m])',\n    label:\n      'Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes.',\n  },\n  {\n    title: '95th Percentile of Request Latencies',\n    expression: 'histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))',\n    label: 'Calculates the 95th percentile of HTTP request rate over 5 minute windows.',\n  },\n  {\n    title: 'Alerts Firing',\n    expression: 'sort_desc(sum(sum_over_time(ALERTS{alertstate=\"firing\"}[24h])) by (alertname))',\n    label: 'Sums up the alerts that have been firing over the last 24 hours.',\n  },\n  {\n    title: 'Step',\n    label:\n      'Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically.',\n  },\n];\n\nexport const PromCheatSheet = (props: QueryEditorHelpProps<PromQuery>) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div>\n      <h2>\n        <Trans i18nKey=\"grafana-prometheus.components.prom-cheat-sheet.prom-ql-cheat-sheet\">PromQL Cheat Sheet</Trans>\n      </h2>\n      {CHEAT_SHEET_ITEMS.map((item, index) => (\n        <div className={styles.cheatSheetItem} key={index}>\n          <div className={styles.cheatSheetItemTitle}>{item.title}</div>\n          {item.expression ? (\n            <button\n              type=\"button\"\n              className={styles.cheatSheetExample}\n              onClick={(e) => props.onClickExample({ refId: 'A', expr: item.expression })}\n            >\n              <code>{item.expression}</code>\n            </button>\n          ) : null}\n          {item.label}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  cheatSheetItem: css({\n    margin: theme.spacing(3, 0),\n  }),\n  cheatSheetItemTitle: css({\n    fontSize: theme.typography.h3.fontSize,\n  }),\n  cheatSheetExample: css({\n    margin: theme.spacing(0.5, 0),\n    // element is interactive, clear button styles\n    textAlign: 'left',\n    border: 'none',\n    background: 'transparent',\n    display: 'block',\n  }),\n});\n","import { config } from '@grafana/runtime';\n\nvar AzureCloud = /* @__PURE__ */ ((AzureCloud2) => {\n  AzureCloud2[\"Public\"] = \"AzureCloud\";\n  AzureCloud2[\"China\"] = \"AzureChinaCloud\";\n  AzureCloud2[\"USGovernment\"] = \"AzureUSGovernment\";\n  AzureCloud2[\"None\"] = \"\";\n  return AzureCloud2;\n})(AzureCloud || {});\nconst predefinedClouds = [\n  {\n    name: \"AzureCloud\",\n    displayName: \"Azure\"\n  },\n  {\n    name: \"AzureChinaCloud\",\n    displayName: \"Azure China\"\n  },\n  {\n    name: \"AzureUSGovernment\",\n    displayName: \"Azure US Government\"\n  }\n];\nfunction getAzureClouds() {\n  const settingsEx = config.azure;\n  if (Array.isArray(settingsEx.clouds) && settingsEx.clouds.length > 0) {\n    return settingsEx.clouds;\n  }\n  return predefinedClouds;\n}\nfunction getDefaultAzureCloud() {\n  return config.azure.cloud || \"AzureCloud\" /* Public */;\n}\nfunction resolveLegacyCloudName(cloudName) {\n  if (!cloudName) {\n    return void 0;\n  }\n  switch (cloudName) {\n    case \"azuremonitor\":\n      return \"AzureCloud\" /* Public */;\n    case \"chinaazuremonitor\":\n      return \"AzureChinaCloud\" /* China */;\n    case \"govazuremonitor\":\n      return \"AzureUSGovernment\" /* USGovernment */;\n    default:\n      throw new Error(`Azure cloud '${cloudName}' is not recognized by datasource.`);\n  }\n}\n\nexport { AzureCloud, getAzureClouds, getDefaultAzureCloud, resolveLegacyCloudName };\n//# sourceMappingURL=clouds.js.map\n","function instanceOfAzureCredential(authType, object) {\n  if (!object) {\n    return false;\n  }\n  return object.authType === authType;\n}\n\nexport { instanceOfAzureCredential };\n//# sourceMappingURL=AzureCredentials.js.map\n","import { config } from '@grafana/runtime';\nimport { getDefaultAzureCloud } from '../clouds.js';\nimport { instanceOfAzureCredential } from './AzureCredentials.js';\n\nconst concealed = Symbol(\"Concealed client secret\");\nconst concealedLegacy = Symbol(\"Concealed legacy client secret\");\nfunction isCredentialsComplete(credentials, ignoreSecret = false) {\n  const authType = credentials.authType;\n  switch (authType) {\n    case \"msi\":\n    case \"workloadidentity\":\n    case \"currentuser\":\n      return true;\n    case \"clientsecret\":\n    case \"clientsecret-obo\":\n      return !!(credentials.azureCloud && credentials.tenantId && credentials.clientId && // When ignoreSecret is set we consider the credentials complete without checking the secret\n      !!(ignoreSecret || credentials.clientSecret));\n    case \"ad-password\":\n      return !!(credentials.clientId && credentials.password && credentials.userId);\n    default:\n      throw new Error(`The auth type '${authType}' not supported.`);\n  }\n}\nfunction getClientSecret(options) {\n  if (!(\"secureJsonFields\" in options) || !options.hasOwnProperty(\"secureJsonFields\")) {\n    return void 0;\n  }\n  if (options.secureJsonFields.azureClientSecret) {\n    return concealed;\n  } else if (options.secureJsonFields.clientSecret) {\n    return concealedLegacy;\n  } else {\n    const secret = options.secureJsonData?.azureClientSecret;\n    return typeof secret === \"string\" && secret.length > 0 ? secret : void 0;\n  }\n}\nfunction getAdPassword(options) {\n  if (!(\"secureJsonFields\" in options) || !options.hasOwnProperty(\"secureJsonFields\")) {\n    return void 0;\n  }\n  if (options.secureJsonFields.password) {\n    return concealed;\n  } else {\n    const secret = options.secureJsonData?.password;\n    return typeof secret === \"string\" && secret.length > 0 ? secret : void 0;\n  }\n}\nfunction getDatasourceCredentials(options, oboEnabled) {\n  const credentials = options.jsonData.azureCredentials;\n  if (!credentials) {\n    return void 0;\n  }\n  const authType = credentials.authType;\n  switch (authType) {\n    case \"msi\":\n    case \"workloadidentity\":\n      if (authType === \"msi\" && config.azure.managedIdentityEnabled || authType === \"workloadidentity\" && config.azure.workloadIdentityEnabled) {\n        return {\n          authType\n        };\n      } else {\n        return void 0;\n      }\n    case \"clientsecret\":\n    case \"clientsecret-obo\":\n      if (authType === \"clientsecret-obo\" && !oboEnabled) {\n        return void 0;\n      }\n      return {\n        authType,\n        azureCloud: credentials.azureCloud || getDefaultAzureCloud(),\n        tenantId: credentials.tenantId,\n        clientId: credentials.clientId,\n        clientSecret: getClientSecret(options)\n      };\n    case \"ad-password\":\n      return {\n        authType,\n        userId: credentials.userId,\n        clientId: credentials.clientId,\n        password: getAdPassword(options)\n      };\n  }\n  if (instanceOfAzureCredential(authType, credentials)) {\n    if (!config.azure.userIdentityEnabled) {\n      return void 0;\n    }\n    if (instanceOfAzureCredential(\"clientsecret\", credentials.serviceCredentials)) {\n      const serviceCredentials = { ...credentials.serviceCredentials, clientSecret: getClientSecret(options) };\n      return {\n        authType,\n        serviceCredentialsEnabled: credentials.serviceCredentialsEnabled,\n        serviceCredentials\n      };\n    }\n    return {\n      authType,\n      serviceCredentialsEnabled: credentials.serviceCredentialsEnabled,\n      serviceCredentials: credentials.serviceCredentials\n    };\n  }\n  throw new Error(`The auth type '${authType}' is not supported.`);\n}\nfunction updateDatasourceCredentials(options, credentials, oboEnabled) {\n  options = {\n    ...options,\n    jsonData: {\n      ...options.jsonData,\n      azureAuthType: void 0,\n      cloudName: void 0,\n      tenantId: void 0,\n      clientId: void 0\n    }\n  };\n  const authType = credentials.authType;\n  switch (authType) {\n    case \"msi\":\n    case \"workloadidentity\":\n      if (authType === \"msi\" && !config.azure.managedIdentityEnabled) {\n        throw new Error(\"Managed Identity authentication is not enabled in Grafana config.\");\n      }\n      if (authType === \"workloadidentity\" && !config.azure.workloadIdentityEnabled) {\n        throw new Error(\"Workload Identity authentication is not enabled in Grafana config.\");\n      }\n      options = {\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureCredentials: {\n            authType\n          }\n        }\n      };\n      return options;\n    case \"clientsecret\":\n    case \"clientsecret-obo\":\n      if (authType === \"clientsecret-obo\" && !oboEnabled) {\n        throw new Error(\"Client Secret OBO authentication is not enabled in Grafana config.\");\n      }\n      options = {\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureCredentials: {\n            authType,\n            azureCloud: credentials.azureCloud || getDefaultAzureCloud(),\n            tenantId: credentials.tenantId,\n            clientId: credentials.clientId\n          }\n        },\n        secureJsonData: {\n          ...options.secureJsonData,\n          azureClientSecret: typeof credentials.clientSecret === \"string\" && credentials.clientSecret.length > 0 ? credentials.clientSecret : void 0\n        },\n        secureJsonFields: {\n          ...options.secureJsonFields,\n          azureClientSecret: credentials.clientSecret === concealed,\n          clientSecret: credentials.clientSecret === concealedLegacy\n        }\n      };\n      if (authType === \"clientsecret-obo\") {\n        options = {\n          ...options,\n          jsonData: {\n            ...options.jsonData,\n            oauthPassThru: true\n          }\n        };\n      }\n      return options;\n    case \"ad-password\":\n      options = {\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureCredentials: {\n            authType: \"ad-password\",\n            userId: credentials.userId,\n            clientId: credentials.clientId\n          }\n        },\n        secureJsonData: {\n          ...options.secureJsonData,\n          password: typeof credentials.password === \"string\" && credentials.password.length > 0 ? credentials.password : void 0\n        },\n        secureJsonFields: {\n          ...options.secureJsonFields,\n          password: typeof credentials.password === \"symbol\"\n        }\n      };\n      return options;\n  }\n  if (instanceOfAzureCredential(\"currentuser\", credentials)) {\n    if (!config.azure.userIdentityEnabled) {\n      throw new Error(\"User Identity authentication is not enabled in Grafana config.\");\n    }\n    const serviceCredentials = credentials.serviceCredentials;\n    let clientSecret;\n    if (instanceOfAzureCredential(\"clientsecret\", serviceCredentials)) {\n      clientSecret = serviceCredentials.clientSecret;\n      delete serviceCredentials.clientSecret;\n    }\n    options = {\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        azureCredentials: {\n          authType: \"currentuser\",\n          serviceCredentialsEnabled: credentials.serviceCredentialsEnabled,\n          serviceCredentials\n        },\n        oauthPassThru: true,\n        disableGrafanaCache: true\n      },\n      secureJsonData: {\n        ...options.secureJsonData,\n        azureClientSecret: typeof clientSecret === \"string\" && clientSecret.length > 0 ? clientSecret : void 0\n      },\n      secureJsonFields: {\n        ...options.secureJsonFields,\n        azureClientSecret: clientSecret === concealed,\n        clientSecret: clientSecret === concealedLegacy\n      }\n    };\n    return options;\n  }\n  throw new Error(`The auth type '${authType}' is not supported.`);\n}\nfunction hasCredentials(options) {\n  return !!options.jsonData.azureCredentials;\n}\n\nexport { concealed, concealedLegacy, getAdPassword, getClientSecret, getDatasourceCredentials, hasCredentials, isCredentialsComplete, updateDatasourceCredentials };\n//# sourceMappingURL=AzureCredentialsConfig.js.map\n","const ResourceTypes = {\n  AnalysisServices: \"microsoft.analysisservices/servers\",\n  ApiManagementService: \"microsoft.apimanagement/service\",\n  ApplicationGateways: \"microsoft.network/applicationgateways\",\n  ApplicationGatewayforContainers: \"microsoft.servicenetworking/trafficcontrollers\",\n  ApplicationInsights: \"microsoft.insights/components\",\n  AppServiceEnvironments: \"microsoft.web/hostingenvironments\",\n  AppServicePlans: \"microsoft.web/serverfarms\",\n  AppServices: \"microsoft.web/sites\",\n  ArcMachines: \"microsoft.hybridcompute/machines\",\n  AutomationAccounts: \"microsoft.automation/automationaccounts\",\n  AutonomousDatabases: \"oracle.database/autonomousdatabases\",\n  AutoscaleSettings: \"microsoft.insights/autoscalesettings\",\n  AzureAD: \"microsoft.aadiam/azureadmetrics\",\n  AzureADDomainServices: \"microsoft.aad/domainservices\",\n  AzureDatabricks: \"microsoft.databricks/workspaces\",\n  AzureBotService: \"microsoft.botservice/botservices\",\n  AzureElasticSAN: \"microsoft.elasticsan/elasticsans\",\n  AzureResourceManager: \"microsoft.resources/subscriptions\",\n  AzureSpringCloud: \"microsoft.appplatform/spring\",\n  AzureStackHCI: \"microsoft.azurestackhci/clusters\",\n  AzureVMWarePrivateClouds: \"microsoft.avs/privateclouds\",\n  AzsResourceMonitor: \"microsoft.azurestackresourcemonitor/storageaccountmonitor\",\n  // AzureStack Resource\n  BackupVaults: \"microsoft.dataprotection/backupvaults\",\n  BareMetalMachine: \"microsoft.networkcloud/baremetalmachines\",\n  Bastion: \"microsoft.network/bastionhosts\",\n  BatchAccounts: \"microsoft.batch/batchaccounts\",\n  BatchAi: \"microsoft.batchai/workspaces\",\n  CdnProfile: \"microsoft.cdn/profiles\",\n  CdnWafPolicy: \"microsoft.cdn/cdnwebapplicationfirewallpolicies\",\n  ClassicCloudServices: \"microsoft.classiccompute/domainnames\",\n  CloudServiceExtendedSupport: \"microsoft.compute/cloudservices\",\n  ClassicComputeVirtualMachines: \"microsoft.classiccompute/virtualmachines\",\n  CloudSimple: \"microsoft.vmwarecloudsimple/virtualmachines\",\n  // 3rd party resource\n  Cluster: \"microsoft.networkcloud/clusters\",\n  ClusterManagers: \"microsoft.networkcloud/clustermanagers\",\n  CognitiveServices: \"microsoft.cognitiveservices/accounts\",\n  CommunicationsGateways: \"microsoft.voiceservices/communicationsgateways\",\n  CodeSigningAccounts: \"microsoft.codesigning/codesigningaccounts\",\n  ConfigurationStores: \"microsoft.appconfiguration/configurationstores\",\n  Connections: \"microsoft.network/connections\",\n  ConnectedVehicle: \"microsoft.connectedvehicle/platformaccounts\",\n  ContactProfiles: \"microsoft.orbital/contactprofiles\",\n  ContainerApps: \"microsoft.app/containerapps\",\n  ContainerAppsEnvironment: \"microsoft.app/managedenvironments\",\n  ContainerGroups: \"microsoft.containerinstance/containergroups\",\n  ContainerRegistries: \"microsoft.containerregistry/registries\",\n  ContainerServicesManaged: \"microsoft.containerservice/managedclusters\",\n  CosmosDB: \"microsoft.documentdb/databaseaccounts\",\n  CosmosCassandra: \"microsoft.documentdb/cassandraClusters\",\n  CosmosMongo: \"microsoft.documentdb/mongoClusters\",\n  CustomerInsights: \"microsoft.customerinsights/hubs\",\n  CustomMetricUsage: \"microsoft.insights/qos\",\n  DataboxEdge: \"microsoft.databoxedge/databoxedgedevices\",\n  DataFactories: \"microsoft.datafactory/datafactories\",\n  DataFactoriesv2: \"microsoft.datafactory/factories\",\n  DataCollectionRules: \"microsoft.insights/datacollectionrules\",\n  DataLakeAnalytics: \"microsoft.datalakeanalytics/accounts\",\n  DataLakeStore: \"microsoft.datalakestore/accounts\",\n  DataShare: \"microsoft.datashare/accounts\",\n  DBForMySql: \"microsoft.dbformysql/servers\",\n  DeviceProvisioningServices: \"microsoft.devices/provisioningservices\",\n  DevCenters: \"microsoft.devcenter/devcenters\",\n  Disks: \"microsoft.compute/disks\",\n  DNSZones: \"microsoft.network/dnszones\",\n  DNSPrivateResolver: \"microsoft.network/dnsresolvers\",\n  DNSForwardingRuleset: \"microsoft.network/dnsforwardingrulesets\",\n  EnterpriseGraph: \"microsoft.enterpriseknowledgegraph/services\",\n  EventGridDomains: \"microsoft.eventgrid/domains\",\n  EventGridTopics: \"microsoft.eventgrid/topics\",\n  EventGridSystemTopics: \"microsoft.eventgrid/systemtopics\",\n  EventHubs: \"microsoft.eventhub/namespaces\",\n  EventHubsClusters: \"microsoft.eventhub/clusters\",\n  ExpressRouteCircuits: \"microsoft.network/expressroutecircuits\",\n  ExpressRouteGateways: \"microsoft.network/expressroutegateways\",\n  ExpressRoutePorts: \"microsoft.network/expressrouteports\",\n  FabricLocations: \"microsoft.fabric.admin/fabriclocations\",\n  // AzureStack Resource\n  Firewall: \"microsoft.network/azurefirewalls\",\n  FrontDoor: \"microsoft.network/frontdoors\",\n  Grafana: \"microsoft.dashboard/grafana\",\n  HDInsights: \"microsoft.hdinsight/clusters\",\n  IoTCentralApplications: \"microsoft.iotcentral/iotapps\",\n  IoTHub: \"microsoft.devices/iothubs\",\n  IotSpaces: \"microsoft.iotspaces/graph\",\n  KeyVault: \"microsoft.keyvault/vaults\",\n  KubernetesArc: \"microsoft.kubernetes/connectedclusters\",\n  KustoClusters: \"microsoft.kusto/clusters\",\n  Layer2IsolationDomain: \"microsoft.managednetworkfabric/l2isolationdomains\",\n  Layer3IsolationDomain: \"microsoft.managednetworkfabric/l3isolationdomains\",\n  LoadBalancers: \"microsoft.network/loadbalancers\",\n  LogAnalytics: \"microsoft.operationalinsights/workspaces\",\n  LogicApps: \"microsoft.logic/workflows\",\n  LogicIntegrationServiceEnvironment: \"microsoft.logic/integrationserviceenvironments\",\n  MachineLearningServiceWorkspace: \"microsoft.machinelearningservices/workspaces\",\n  MariaDB: \"microsoft.dbformariadb/servers\",\n  ManagedHsms: \"microsoft.keyvault/managedhsms\",\n  ManagedLustre: \"microsoft.storagecache/amlfilesystems\",\n  ManagedNetworkFabricNetworkDevices: \"microsoft.managednetworkfabric/networkdevices\",\n  MediaServices: \"microsoft.media/mediaservices\",\n  MonitorAccounts: \"microsoft.monitor/accounts\",\n  MySQLFlexibleServers: \"microsoft.dbformysql/flexibleservers\",\n  NatGateway: \"microsoft.network/natgateways\",\n  NetworkInterfaces: \"microsoft.network/networkinterfaces\",\n  NetworkVirtualAppliances: \"microsoft.network/networkvirtualappliances\",\n  NetAppCapacityPools: \"microsoft.netapp/netappaccounts/capacitypools\",\n  NetworkWatcher: \"microsoft.network/networkwatchers\",\n  NGINXaaS: \"nginx.nginxplus/nginxdeployments\",\n  ConnectionMonitor: \"microsoft.network/networkwatchers/connectionmonitors\",\n  NotificationHubs: \"microsoft.notificationhubs/namespaces/notificationhubs\",\n  OracleExadataVMCluster: \"oracle.database/cloudvmclusters\",\n  OracleExadbVMCluster: \"oracle.database/exadbVmClusters\",\n  OrbitalL2Connections: \"microsoft.orbital/l2connections\",\n  MobileNetworkSite: \"microsoft.mobilenetwork/mobilenetworks/sites\",\n  RadioAccessNetwork: \"microsoft.mobilenetwork/radioaccessnetworks\",\n  PacketCoreControlPlane: \"microsoft.mobilenetwork/packetcorecontrolplanes\",\n  PacketCoreDataPlane: \"microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes\",\n  PeeringServices: \"microsoft.peering/peeringservices\",\n  PlayFabTitles: \"microsoft.playfab/titles\",\n  PointToSiteVPN: \"microsoft.network/p2svpngateways\",\n  PostgreSQLFlexibleServers: \"microsoft.dbforpostgresql/flexibleservers\",\n  PostgreSQLServers: \"microsoft.dbforpostgresql/servers\",\n  PostgreSQLServersV2: \"microsoft.dbforpostgresql/serversv2\",\n  PowerBIDedicatedCapacities: \"microsoft.powerbidedicated/capacities\",\n  PrivateEndpoint: \"microsoft.network/privateendpoints\",\n  PrivateLinkService: \"microsoft.network/privatelinkservices\",\n  ProviderMonitorSettings: \"Microsoft.ProviderHub/providerMonitorSettings\",\n  ProvisionedClusters: \"microsoft.hybridcontainerservice/provisionedclusters\",\n  PublicIPAddresses: \"microsoft.network/publicipaddresses\",\n  PublicIPPrefixes: \"microsoft.network/publicipprefixes\",\n  RecoveryServicesVault: \"microsoft.recoveryservices/vaults\",\n  RedisCaches: \"microsoft.cache/redis\",\n  RedisEnterprise: \"microsoft.cache/redisenterprise\",\n  Relay: \"microsoft.relay/namespaces\",\n  SearchServices: \"microsoft.search/searchservices\",\n  ServerGroups: \"microsoft.dbforpostgresql/servergroupsv2\",\n  ServiceBus: \"microsoft.servicebus/namespaces\",\n  ServiceFabricMesh: \"microsoft.servicefabricmesh/applications\",\n  SignalRService: \"microsoft.signalrservice/signalr\",\n  SignalRServiceWebPubSub: \"microsoft.signalrservice/webpubsub\",\n  Solutions: \"microsoft.operationsmanagement/solutions\",\n  Spacecrafts: \"microsoft.orbital/spacecrafts\",\n  SqlManaged: \"microsoft.sql/managedinstances\",\n  SqlServersDatabases: \"microsoft.sql/servers/databases\",\n  SqlServersElasticPools: \"microsoft.sql/servers/elasticpools\",\n  SqlServersElasticJobAgents: \"microsoft.sql/servers/jobagents\",\n  StaticSites: \"Microsoft.web/staticSites\",\n  Storage: \"microsoft.storage/storageaccounts\",\n  StorageAppliance: \"microsoft.networkcloud/storageappliances\",\n  StorageCaches: \"microsoft.storagecache/caches\",\n  StorageMover: \"microsoft.storagemover/storagemovers\",\n  StorageClassic: \"microsoft.classicstorage/storageaccounts\",\n  StorageSync: \"microsoft.storagesync/storagesyncservices\",\n  StreamAnalyticsJobs: \"microsoft.streamanalytics/streamingjobs\",\n  SynapseWorkspace: \"microsoft.synapse/workspaces\",\n  TimeseriesInsightsEnvironments: \"microsoft.timeseriesinsights/environments\",\n  TrafficManagerProfiles: \"microsoft.network/trafficmanagerprofiles\",\n  VirtualHubs: \"microsoft.network/virtualhubs\",\n  VirtualMachines: \"microsoft.compute/virtualmachines\",\n  VirtualMachinesScaleSets: \"microsoft.compute/virtualmachinescalesets\",\n  VirtualNetworkFunctions: \"microsoft.hybridnetwork/virtualnetworkfunctions\",\n  VirtualNetworkGateWays: \"microsoft.network/virtualnetworkgateways\",\n  VirtualWANs: \"microsoft.network/virtualwans\",\n  VPNGateways: \"microsoft.network/vpngateways\",\n  WebsitesSlots: \"microsoft.web/sites/slots\",\n  WorkerPools: \"microsoft.web/hostingenvironments/workerpools\",\n  ActivityLogAlertRules: \"microsoft.insights/activitylogalerts\",\n  MetricAlertRules: \"microsoft.insights/metricalerts\",\n  LogAlertRules: \"microsoft.insights/scheduledqueryrules\",\n  ActionGroups: \"microsoft.insights/actiongroups\",\n  AlertProcessingRules: \"microsoft.alertsmanagement/actionrules\",\n  SmartAlertRules: \"microsoft.alertsmanagement/smartdetectoralertrules\",\n  PrometheusRuleGroups: \"microsoft.alertsmanagement/prometheusrulegroups\"\n};\n\nexport { ResourceTypes };\n//# sourceMappingURL=ResourceTypes.js.map\n","import { ResourceTypes } from './ResourceTypes.js';\n\nconst MetricsSupportedTypes = [\n  ResourceTypes.AnalysisServices,\n  ResourceTypes.ApiManagementService,\n  ResourceTypes.ApplicationGateways,\n  ResourceTypes.ApplicationGatewayforContainers,\n  ResourceTypes.ApplicationInsights,\n  ResourceTypes.AppServiceEnvironments,\n  ResourceTypes.AppServicePlans,\n  ResourceTypes.AppServices,\n  ResourceTypes.AutomationAccounts,\n  ResourceTypes.AutonomousDatabases,\n  ResourceTypes.AzureADDomainServices,\n  ResourceTypes.AzureBotService,\n  ResourceTypes.AzureDatabricks,\n  ResourceTypes.AzureElasticSAN,\n  ResourceTypes.AzureSpringCloud,\n  ResourceTypes.AzureStackHCI,\n  ResourceTypes.AzureVMWarePrivateClouds,\n  ResourceTypes.BackupVaults,\n  ResourceTypes.BareMetalMachine,\n  ResourceTypes.Bastion,\n  ResourceTypes.BatchAccounts,\n  ResourceTypes.DataCollectionRules,\n  ResourceTypes.BatchAi,\n  ResourceTypes.CdnProfile,\n  ResourceTypes.CdnWafPolicy,\n  ResourceTypes.ClassicCloudServices,\n  ResourceTypes.ClassicComputeVirtualMachines,\n  ResourceTypes.CloudServiceExtendedSupport,\n  ResourceTypes.CloudSimple,\n  ResourceTypes.Cluster,\n  ResourceTypes.ClusterManagers,\n  ResourceTypes.CodeSigningAccounts,\n  ResourceTypes.CognitiveServices,\n  ResourceTypes.CommunicationsGateways,\n  ResourceTypes.ConfigurationStores,\n  ResourceTypes.Connections,\n  ResourceTypes.ConnectedVehicle,\n  ResourceTypes.ContainerAppsEnvironment,\n  ResourceTypes.ContainerGroups,\n  ResourceTypes.ContainerRegistries,\n  ResourceTypes.ContainerServicesManaged,\n  ResourceTypes.CosmosDB,\n  ResourceTypes.CosmosCassandra,\n  ResourceTypes.CosmosMongo,\n  ResourceTypes.DataboxEdge,\n  ResourceTypes.DataFactories,\n  ResourceTypes.DataFactoriesv2,\n  ResourceTypes.DataLakeAnalytics,\n  ResourceTypes.DataLakeStore,\n  ResourceTypes.DataShare,\n  ResourceTypes.DBForMySql,\n  ResourceTypes.DeviceProvisioningServices,\n  ResourceTypes.DevCenters,\n  ResourceTypes.Disks,\n  ResourceTypes.DNSZones,\n  ResourceTypes.DNSPrivateResolver,\n  ResourceTypes.DNSForwardingRuleset,\n  ResourceTypes.EnterpriseGraph,\n  ResourceTypes.EventGridDomains,\n  ResourceTypes.EventGridTopics,\n  ResourceTypes.EventGridSystemTopics,\n  ResourceTypes.EventHubs,\n  ResourceTypes.EventHubsClusters,\n  ResourceTypes.ExpressRouteCircuits,\n  ResourceTypes.ExpressRoutePorts,\n  ResourceTypes.Firewall,\n  ResourceTypes.FrontDoor,\n  ResourceTypes.HDInsights,\n  ResourceTypes.IoTCentralApplications,\n  ResourceTypes.IoTHub,\n  ResourceTypes.IotSpaces,\n  ResourceTypes.KeyVault,\n  ResourceTypes.KubernetesArc,\n  ResourceTypes.KustoClusters,\n  ResourceTypes.Layer2IsolationDomain,\n  ResourceTypes.Layer3IsolationDomain,\n  ResourceTypes.LoadBalancers,\n  ResourceTypes.LogAnalytics,\n  ResourceTypes.LogicApps,\n  ResourceTypes.LogicIntegrationServiceEnvironment,\n  ResourceTypes.MachineLearningServiceWorkspace,\n  ResourceTypes.ManagedNetworkFabricNetworkDevices,\n  ResourceTypes.MariaDB,\n  ResourceTypes.ManagedHsms,\n  ResourceTypes.MediaServices,\n  ResourceTypes.MonitorAccounts,\n  ResourceTypes.MySQLFlexibleServers,\n  ResourceTypes.NatGateway,\n  ResourceTypes.NetAppCapacityPools,\n  ResourceTypes.NetworkInterfaces,\n  ResourceTypes.NGINXaaS,\n  ResourceTypes.NotificationHubs,\n  ResourceTypes.OracleExadataVMCluster,\n  ResourceTypes.OracleExadbVMCluster,\n  ResourceTypes.OrbitalL2Connections,\n  ResourceTypes.MobileNetworkSite,\n  ResourceTypes.RadioAccessNetwork,\n  ResourceTypes.PacketCoreControlPlane,\n  ResourceTypes.PacketCoreDataPlane,\n  ResourceTypes.PeeringServices,\n  ResourceTypes.PlayFabTitles,\n  ResourceTypes.PostgreSQLServers,\n  ResourceTypes.PostgreSQLServersV2,\n  ResourceTypes.PowerBIDedicatedCapacities,\n  ResourceTypes.PrivateEndpoint,\n  ResourceTypes.PrivateLinkService,\n  ResourceTypes.ProviderMonitorSettings,\n  ResourceTypes.ProvisionedClusters,\n  ResourceTypes.PublicIPAddresses,\n  ResourceTypes.PublicIPPrefixes,\n  ResourceTypes.RecoveryServicesVault,\n  ResourceTypes.RedisCaches,\n  ResourceTypes.RedisEnterprise,\n  ResourceTypes.Relay,\n  ResourceTypes.SearchServices,\n  ResourceTypes.ServerGroups,\n  ResourceTypes.ServiceBus,\n  ResourceTypes.ServiceFabricMesh,\n  ResourceTypes.SignalRService,\n  ResourceTypes.SignalRServiceWebPubSub,\n  ResourceTypes.Solutions,\n  ResourceTypes.SqlManaged,\n  ResourceTypes.SqlServersDatabases,\n  ResourceTypes.SqlServersElasticPools,\n  ResourceTypes.SqlServersElasticJobAgents,\n  ResourceTypes.StaticSites,\n  ResourceTypes.Storage,\n  ResourceTypes.StorageAppliance,\n  ResourceTypes.StorageCaches,\n  ResourceTypes.StorageClassic,\n  ResourceTypes.StorageMover,\n  ResourceTypes.StorageSync,\n  ResourceTypes.StreamAnalyticsJobs,\n  ResourceTypes.SynapseWorkspace,\n  ResourceTypes.TimeseriesInsightsEnvironments,\n  ResourceTypes.TrafficManagerProfiles,\n  ResourceTypes.VirtualMachines,\n  ResourceTypes.VirtualMachinesScaleSets,\n  ResourceTypes.VirtualNetworkGateWays,\n  ResourceTypes.WebsitesSlots,\n  ResourceTypes.AutoscaleSettings,\n  ResourceTypes.AzureAD,\n  ResourceTypes.AzsResourceMonitor,\n  ResourceTypes.ConnectionMonitor,\n  ResourceTypes.ContainerApps,\n  ResourceTypes.CustomerInsights,\n  ResourceTypes.ExpressRouteGateways,\n  ResourceTypes.FabricLocations,\n  ResourceTypes.NetworkVirtualAppliances,\n  ResourceTypes.NetworkWatcher,\n  ResourceTypes.PointToSiteVPN,\n  ResourceTypes.PostgreSQLFlexibleServers,\n  ResourceTypes.VPNGateways,\n  ResourceTypes.VirtualHubs,\n  ResourceTypes.WorkerPools,\n  ResourceTypes.ManagedLustre,\n  ResourceTypes.Grafana,\n  ResourceTypes.ContactProfiles,\n  ResourceTypes.Spacecrafts\n];\n\nexport { MetricsSupportedTypes };\n//# sourceMappingURL=MetricsResourceTypes.js.map\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/configuration/AlertingSettingsOverhaul.tsx\nimport { cx } from '@emotion/css';\n\nimport { DataSourceJsonData, DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { ConfigSubSection } from '@grafana/plugin-ui';\nimport { config } from '@grafana/runtime';\nimport { InlineField, Switch, useTheme2 } from '@grafana/ui';\n\nimport { docsTip, overhaulStyles } from './shared/utils';\n\ninterface Props<T extends DataSourceJsonData>\n  extends Pick<DataSourcePluginOptionsEditorProps<T>, 'options' | 'onOptionsChange'> {}\n\ninterface AlertingConfig extends DataSourceJsonData {\n  manageAlerts?: boolean;\n  allowAsRecordingRulesTarget?: boolean;\n}\n\nexport function AlertingSettingsOverhaul<T extends AlertingConfig>({\n  options,\n  onOptionsChange,\n}: Props<T>): JSX.Element {\n  const theme = useTheme2();\n  // imported GrafanaTheme2 from @grafana/data does not match type of same from @grafana/ui\n  // @ts-ignore\n  const styles = overhaulStyles(theme);\n\n  return (\n    <ConfigSubSection\n      title={t('grafana-prometheus.configuration.alerting-settings-overhaul.title-alerting', 'Alerting')}\n      className={cx(styles.container, styles.alertingTop)}\n    >\n      <div className=\"gf-form-group\">\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <InlineField\n              labelWidth={30}\n              label={t(\n                'grafana-prometheus.configuration.alerting-settings-overhaul.label-manage-alerts-via-alerting-ui',\n                'Manage alerts via Alerting UI'\n              )}\n              disabled={options.readOnly}\n              tooltip={\n                <>\n                  <Trans i18nKey=\"grafana-prometheus.configuration.alerting-settings-overhaul.tooltip-manage-alerts-via-alerting-ui\">\n                    Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager\n                    data source.\n                  </Trans>{' '}\n                  {docsTip()}\n                </>\n              }\n              interactive={true}\n              className={styles.switchField}\n            >\n              <Switch\n                value={options.jsonData.manageAlerts ?? config.defaultDatasourceManageAlertsUiToggle}\n                onChange={(event) =>\n                  onOptionsChange({\n                    ...options,\n                    jsonData: { ...options.jsonData, manageAlerts: event!.currentTarget.checked },\n                  })\n                }\n                id={selectors.components.DataSource.Prometheus.configPage.manageAlerts}\n              />\n            </InlineField>\n          </div>\n        </div>\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <InlineField\n              labelWidth={30}\n              label={t(\n                'grafana-prometheus.configuration.alerting-settings-overhaul.label-allow-as-recording-rules-target',\n                'Allow as recording rules target'\n              )}\n              disabled={options.readOnly}\n              tooltip={\n                <>\n                  <Trans i18nKey=\"grafana-prometheus.configuration.alerting-settings-overhaul.tooltip-allow-as-recording-rules-target\">\n                    Allow this data source to be selected as a target for writing recording rules.\n                  </Trans>{' '}\n                  {docsTip()}\n                </>\n              }\n              interactive={true}\n              className={styles.switchField}\n            >\n              <Switch\n                value={\n                  options.jsonData.allowAsRecordingRulesTarget ?? config.defaultAllowRecordingRulesTargetAlertsUiToggle\n                }\n                onChange={(event) =>\n                  onOptionsChange({\n                    ...options,\n                    jsonData: { ...options.jsonData, allowAsRecordingRulesTarget: event!.currentTarget.checked },\n                  })\n                }\n                id={selectors.components.DataSource.Prometheus.configPage.allowAsRecordingRulesTarget}\n              />\n            </InlineField>\n          </div>\n        </div>\n      </div>\n    </ConfigSubSection>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/configuration/ExemplarSetting.tsx\nimport { useState } from 'react';\n\nimport { DataSourceInstanceSettings } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { config, DataSourcePicker } from '@grafana/runtime';\nimport { Button, InlineField, Input, Switch, useTheme2 } from '@grafana/ui';\n\nimport { PROM_CONFIG_LABEL_WIDTH } from '../constants';\nimport { ExemplarTraceIdDestination } from '../types';\n\nimport { docsTip, overhaulStyles } from './shared/utils';\n\ntype Props = {\n  value: ExemplarTraceIdDestination;\n  onChange: (value: ExemplarTraceIdDestination) => void;\n  onDelete: () => void;\n  disabled?: boolean;\n};\n\nexport function ExemplarSetting({ value, onChange, onDelete, disabled }: Props) {\n  const [isInternalLink, setIsInternalLink] = useState(Boolean(value.datasourceUid));\n\n  const theme = useTheme2();\n  const styles = overhaulStyles(theme);\n\n  return (\n    <div className=\"gf-form-group\">\n      <InlineField\n        label={t('grafana-prometheus.configuration.exemplar-setting.label-internal-link', 'Internal link')}\n        labelWidth={PROM_CONFIG_LABEL_WIDTH}\n        disabled={disabled}\n        tooltip={\n          <>\n            <Trans i18nKey=\"grafana-prometheus.configuration.exemplar-setting.tooltip-internal-link\">\n              Enable this option if you have an internal link. When enabled, this reveals the data source selector.\n              Select the backend tracing data store for your exemplar data.\n            </Trans>{' '}\n            {docsTip()}\n          </>\n        }\n        interactive={true}\n        className={styles.switchField}\n      >\n        <>\n          <Switch\n            value={isInternalLink}\n            data-testid={selectors.components.DataSource.Prometheus.configPage.internalLinkSwitch}\n            onChange={(ev) => setIsInternalLink(ev.currentTarget.checked)}\n          />\n        </>\n      </InlineField>\n\n      {isInternalLink ? (\n        <InlineField\n          label={t('grafana-prometheus.configuration.exemplar-setting.label-data-source', 'Data source')}\n          labelWidth={PROM_CONFIG_LABEL_WIDTH}\n          tooltip={\n            <>\n              <Trans i18nKey=\"grafana-prometheus.configuration.exemplar-setting.tooltip-data-source\">\n                The data source the exemplar is going to navigate to.\n              </Trans>{' '}\n              {docsTip()}\n            </>\n          }\n          disabled={disabled}\n          interactive={true}\n        >\n          <DataSourcePicker\n            filter={\n              config.featureToggles.azureMonitorPrometheusExemplars\n                ? undefined\n                : (ds) => ds.type !== 'grafana-azure-monitor-datasource'\n            }\n            tracing={true}\n            current={value.datasourceUid}\n            noDefault={true}\n            width={40}\n            onChange={(ds: DataSourceInstanceSettings) =>\n              onChange({\n                ...value,\n                datasourceUid: ds.uid,\n                url: undefined,\n              })\n            }\n          />\n        </InlineField>\n      ) : (\n        <InlineField\n          label={t('grafana-prometheus.configuration.exemplar-setting.label-url', 'URL')}\n          labelWidth={PROM_CONFIG_LABEL_WIDTH}\n          tooltip={\n            <>\n              <Trans i18nKey=\"grafana-prometheus.configuration.exemplar-setting.tooltip-url\">\n                The URL of the trace backend the user would go to see its trace\n              </Trans>{' '}\n              {docsTip()}\n            </>\n          }\n          disabled={disabled}\n          interactive={true}\n        >\n          <Input\n            placeholder={t(\n              'grafana-prometheus.configuration.exemplar-setting.placeholder-httpsexamplecomvalueraw',\n              'https://example.com/${__value.raw}'\n            )}\n            spellCheck={false}\n            width={40}\n            value={value.url}\n            onChange={(event) =>\n              onChange({\n                ...value,\n                datasourceUid: undefined,\n                url: event.currentTarget.value,\n              })\n            }\n          />\n        </InlineField>\n      )}\n\n      <InlineField\n        label={t('grafana-prometheus.configuration.exemplar-setting.label-url-label', 'URL Label')}\n        labelWidth={PROM_CONFIG_LABEL_WIDTH}\n        tooltip={\n          <>\n            <Trans i18nKey=\"grafana-prometheus.configuration.exemplar-setting.tooltip-url-label\">\n              Use to override the button label on the exemplar traceID field.\n            </Trans>{' '}\n            {docsTip()}\n          </>\n        }\n        disabled={disabled}\n        interactive={true}\n      >\n        <Input\n          placeholder={t(\n            'grafana-prometheus.configuration.exemplar-setting.placeholder-go-to-examplecom',\n            'Go to example.com'\n          )}\n          spellCheck={false}\n          width={40}\n          value={value.urlDisplayLabel}\n          onChange={(event) =>\n            onChange({\n              ...value,\n              urlDisplayLabel: event.currentTarget.value,\n            })\n          }\n        />\n      </InlineField>\n      <InlineField\n        label={t('grafana-prometheus.configuration.exemplar-setting.label-label-name', 'Label name')}\n        labelWidth={PROM_CONFIG_LABEL_WIDTH}\n        tooltip={\n          <>\n            <Trans i18nKey=\"grafana-prometheus.configuration.exemplar-setting.tooltip-label-name\">\n              The name of the field in the labels object that should be used to get the traceID.\n            </Trans>{' '}\n            {docsTip()}\n          </>\n        }\n        disabled={disabled}\n        interactive={true}\n      >\n        <Input\n          placeholder={t('grafana-prometheus.configuration.exemplar-setting.placeholder-trace-id', 'traceID')}\n          spellCheck={false}\n          width={40}\n          value={value.name}\n          onChange={(event) =>\n            onChange({\n              ...value,\n              name: event.currentTarget.value,\n            })\n          }\n        />\n      </InlineField>\n      {!disabled && (\n        <InlineField\n          label={t(\n            'grafana-prometheus.configuration.exemplar-setting.label-remove-exemplar-link',\n            'Remove exemplar link'\n          )}\n          labelWidth={PROM_CONFIG_LABEL_WIDTH}\n          disabled={disabled}\n        >\n          <Button\n            variant=\"destructive\"\n            title={t(\n              'grafana-prometheus.configuration.exemplar-setting.title-remove-exemplar-link',\n              'Remove exemplar link'\n            )}\n            icon=\"times\"\n            onClick={(event) => {\n              event.preventDefault();\n              onDelete();\n            }}\n          />\n        </InlineField>\n      )}\n    </div>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/configuration/ExemplarsSettings.tsx\nimport { css } from '@emotion/css';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { t, Trans } from '@grafana/i18n';\nimport { ConfigSubSection } from '@grafana/plugin-ui';\nimport { Button, useTheme2 } from '@grafana/ui';\n\nimport { ExemplarTraceIdDestination } from '../types';\n\nimport { ExemplarSetting } from './ExemplarSetting';\nimport { overhaulStyles } from './shared/utils';\n\ntype Props = {\n  options?: ExemplarTraceIdDestination[];\n  onChange: (value: ExemplarTraceIdDestination[]) => void;\n  disabled?: boolean;\n};\n\nexport function ExemplarsSettings({ options, onChange, disabled }: Props) {\n  const theme = useTheme2();\n  const styles = overhaulStyles(theme);\n  return (\n    <div className={styles.sectionBottomPadding}>\n      <ConfigSubSection\n        title={t('grafana-prometheus.configuration.exemplars-settings.title-exemplars', 'Exemplars')}\n        className={styles.container}\n      >\n        {options &&\n          options.map((option, index) => {\n            return (\n              <ExemplarSetting\n                key={index}\n                value={option}\n                onChange={(newField) => {\n                  const newOptions = [...options];\n                  newOptions.splice(index, 1, newField);\n                  onChange(newOptions);\n                }}\n                onDelete={() => {\n                  const newOptions = [...options];\n                  newOptions.splice(index, 1);\n                  onChange(newOptions);\n                }}\n                disabled={disabled}\n              />\n            );\n          })}\n\n        {!disabled && (\n          <Button\n            variant=\"secondary\"\n            data-testid={selectors.components.DataSource.Prometheus.configPage.exemplarsAddButton}\n            className={css({\n              marginBottom: '10px',\n            })}\n            icon=\"plus\"\n            onClick={(event) => {\n              event.preventDefault();\n              const newOptions = [...(options || []), { name: 'traceID' }];\n              onChange(newOptions);\n            }}\n          >\n            <Trans i18nKey=\"grafana-prometheus.configuration.exemplars-settings.add\">Add</Trans>\n          </Button>\n        )}\n        {disabled && !options && (\n          <i>\n            <Trans i18nKey=\"grafana-prometheus.configuration.exemplars-settings.no-exemplars-configurations\">\n              No exemplars configurations\n            </Trans>\n          </i>\n        )}\n      </ConfigSubSection>\n    </div>\n  );\n}\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/configuration/PromFlavorVersions.ts\nexport const PromFlavorVersions: { [index: string]: Array<{ value?: string; label: string }> } = {\n  Prometheus: [\n    { value: undefined, label: 'Please select' },\n    { value: '2.0.0', label: '< 2.14.x' },\n    { value: '2.14.0', label: '2.14.x' },\n    { value: '2.15.0', label: '2.15.x' },\n    { value: '2.16.0', label: '2.16.x' },\n    { value: '2.17.0', label: '2.17.x' },\n    { value: '2.18.0', label: '2.18.x' },\n    { value: '2.19.0', label: '2.19.x' },\n    { value: '2.20.0', label: '2.20.x' },\n    { value: '2.21.0', label: '2.21.x' },\n    { value: '2.22.0', label: '2.22.x' },\n    { value: '2.23.0', label: '2.23.x' },\n    { value: '2.24.0', label: '2.24.x' },\n    { value: '2.25.0', label: '2.25.x' },\n    { value: '2.26.0', label: '2.26.x' },\n    { value: '2.27.0', label: '2.27.x' },\n    { value: '2.28.0', label: '2.28.x' },\n    { value: '2.29.0', label: '2.29.x' },\n    { value: '2.30.0', label: '2.30.x' },\n    { value: '2.31.0', label: '2.31.x' },\n    { value: '2.32.0', label: '2.32.x' },\n    { value: '2.33.0', label: '2.33.x' },\n    { value: '2.34.0', label: '2.34.x' },\n    { value: '2.35.0', label: '2.35.x' },\n    { value: '2.36.0', label: '2.36.x' },\n    { value: '2.37.0', label: '2.37.x' },\n    { value: '2.38.0', label: '2.38.x' },\n    { value: '2.39.0', label: '2.39.x' },\n    { value: '2.40.0', label: '2.40.x' },\n    { value: '2.41.0', label: '2.41.x' },\n    { value: '2.42.0', label: '2.42.x' },\n    { value: '2.43.0', label: '2.43.x' },\n    { value: '2.44.0', label: '2.44.x' },\n    { value: '2.45.0', label: '2.45.x' },\n    { value: '2.46.0', label: '2.46.x' },\n    { value: '2.47.0', label: '2.47.x' },\n    { value: '2.48.0', label: '2.48.x' },\n    { value: '2.49.0', label: '2.49.x' },\n    { value: '2.50.0', label: '2.50.x' },\n\n    // This value will be returned for future versions of prometheus until we add new entries to this object\n    { value: '2.50.1', label: '> 2.50.x' },\n  ],\n  Mimir: [\n    { value: undefined, label: 'Please select' },\n    { value: '2.0.0', label: '2.0.x' },\n    { value: '2.1.0', label: '2.1.x' },\n    { value: '2.2.0', label: '2.2.x' },\n    { value: '2.3.0', label: '2.3.x' },\n    { value: '2.4.0', label: '2.4.x' },\n    { value: '2.5.0', label: '2.5.x' },\n    { value: '2.6.0', label: '2.6.x' },\n    { value: '2.7.0', label: '2.7.x' },\n    { value: '2.8.0', label: '2.8.x' },\n    { value: '2.9.0', label: '2.9.x' },\n    { value: '2.9.1', label: '> 2.9.x' },\n  ],\n  Thanos: [\n    { value: undefined, label: 'Please select' },\n    { value: '0.0.0', label: '< 0.16.x' },\n    { value: '0.16.0', label: '0.16.x' },\n    { value: '0.17.0', label: '0.17.x' },\n    { value: '0.18.0', label: '0.18.x' },\n    { value: '0.19.0', label: '0.19.x' },\n    { value: '0.20.0', label: '0.20.x' },\n    { value: '0.21.0', label: '0.21.x' },\n    { value: '0.22.0', label: '0.22.x' },\n    { value: '0.23.0', label: '0.23.x' },\n    { value: '0.24.0', label: '0.24.x' },\n    { value: '0.25.0', label: '0.25.x' },\n    { value: '0.26.0', label: '0.26.x' },\n    { value: '0.27.0', label: '0.27.x' },\n    { value: '0.28.0', label: '0.28.x' },\n    { value: '0.29.0', label: '0.29.x' },\n    { value: '0.30.0', label: '0.30.x' },\n    { value: '0.31.0', label: '0.31.x' },\n    { value: '0.31.1', label: '> 0.31.x' },\n  ],\n  Cortex: [\n    { value: undefined, label: 'Please select' },\n    { value: '0.0.0', label: '< 1.0.0' },\n    { value: '1.0.0', label: '1.0.0' },\n    { value: '1.1.0', label: '1.1.x' },\n    { value: '1.2.0', label: '1.2.x' },\n    { value: '1.3.0', label: '1.3.x' },\n    { value: '1.4.0', label: '1.4.x' },\n    { value: '1.5.0', label: '1.5.x' },\n    { value: '1.6.0', label: '1.6.x' },\n    { value: '1.7.0', label: '1.7.x' },\n    { value: '1.8.0', label: '1.8.x' },\n    { value: '1.9.0', label: '1.9.x' },\n    { value: '1.10.0', label: '1.10.x' },\n    { value: '1.11.0', label: '1.11.x' },\n    { value: '1.13.0', label: '1.13.x' },\n    { value: '1.14.0', label: '> 1.13.x' },\n  ],\n};\n","// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/configuration/PromSettings.tsx\nimport { SyntheticEvent, useState } from 'react';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  DataSourceSettings,\n  onUpdateDatasourceJsonDataOptionChecked,\n  SelectableValue,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Trans, t } from '@grafana/i18n';\nimport { ConfigSubSection } from '@grafana/plugin-ui';\nimport { config } from '@grafana/runtime';\nimport { InlineField, Input, Select, Switch, TextLink, useTheme2 } from '@grafana/ui';\n\nimport {\n  countError,\n  DEFAULT_SERIES_LIMIT,\n  DURATION_REGEX,\n  durationError,\n  MULTIPLE_DURATION_REGEX,\n  NON_NEGATIVE_INTEGER_REGEX,\n  PROM_CONFIG_LABEL_WIDTH,\n  seriesLimitError,\n  SUGGESTIONS_LIMIT,\n} from '../constants';\nimport { QueryEditorMode } from '../querybuilder/shared/types';\nimport { defaultPrometheusQueryOverlapWindow } from '../querycache/QueryCache';\nimport { PromApplication, PrometheusCacheLevel, PromOptions } from '../types';\n\nimport { ExemplarsSettings } from './ExemplarsSettings';\nimport { PromFlavorVersions } from './PromFlavorVersions';\nimport { docsTip, overhaulStyles, validateInput } from './shared/utils';\n\ntype Props = Pick<DataSourcePluginOptionsEditorProps<PromOptions>, 'options' | 'onOptionsChange'>;\n\nconst httpOptions = [\n  { value: 'POST', label: 'POST' },\n  { value: 'GET', label: 'GET' },\n];\n\nconst cacheValueOptions = [\n  { value: PrometheusCacheLevel.Low, label: 'Low' },\n  { value: PrometheusCacheLevel.Medium, label: 'Medium' },\n  { value: PrometheusCacheLevel.High, label: 'High' },\n  { value: PrometheusCacheLevel.None, label: 'None' },\n];\n\ntype PrometheusSelectItemsType = Array<{ value: PromApplication; label: PromApplication }>;\n\ntype ValidDuration = {\n  timeInterval: string;\n  queryTimeout: string;\n  incrementalQueryOverlapWindow: string;\n};\n\ntype ValidCount = {\n  codeModeMetricNamesSuggestionLimit: string;\n};\n\nconst prometheusFlavorSelectItems: PrometheusSelectItemsType = [\n  { value: PromApplication.Prometheus, label: PromApplication.Prometheus },\n  { value: PromApplication.Cortex, label: PromApplication.Cortex },\n  { value: PromApplication.Mimir, label: PromApplication.Mimir },\n  { value: PromApplication.Thanos, label: PromApplication.Thanos },\n];\n\nconst getOptionsWithDefaults = (options: DataSourceSettings<PromOptions>) => {\n  if (options.jsonData.httpMethod) {\n    return options;\n  }\n\n  // We are explicitly adding httpMethod so, it is correctly displayed in dropdown.\n  // This way, it is more predictable for users.\n  return { ...options, jsonData: { ...options.jsonData, httpMethod: 'POST' } };\n};\n\nexport const PromSettings = (props: Props) => {\n  const theme = useTheme2();\n  const styles = overhaulStyles(theme);\n  const { onOptionsChange } = props;\n\n  const editorOptions = [\n    {\n      value: QueryEditorMode.Builder,\n      label: t('grafana-prometheus.configuration.prom-settings.editor-options.label-builder', 'Builder'),\n    },\n    {\n      value: QueryEditorMode.Code,\n      label: t('grafana-prometheus.configuration.prom-settings.editor-options.label-code', 'Code'),\n    },\n  ];\n\n  const optionsWithDefaults = getOptionsWithDefaults(props.options);\n  const [validDuration, updateValidDuration] = useState<ValidDuration>({\n    timeInterval: '',\n    queryTimeout: '',\n    incrementalQueryOverlapWindow: '',\n  });\n\n  const [validCount, updateValidCount] = useState<ValidCount>({\n    codeModeMetricNamesSuggestionLimit: '',\n  });\n\n  const [seriesLimit, setSeriesLimit] = useState<string>(\n    optionsWithDefaults.jsonData.seriesLimit?.toString() || `${DEFAULT_SERIES_LIMIT}`\n  );\n\n  return (\n    <>\n      <ConfigSubSection\n        title={t('grafana-prometheus.configuration.prom-settings.title-interval-behaviour', 'Interval behaviour')}\n        className={styles.container}\n      >\n        <div className=\"gf-form-group\">\n          {/* Scrape interval */}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineField\n                label={t('grafana-prometheus.configuration.prom-settings.label-scrape-interval', 'Scrape interval')}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans\n                      i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-scrape-interval\"\n                      values={{ default: '15s' }}\n                    >\n                      This interval is how frequently Prometheus scrapes targets. Set this to the typical scrape and\n                      evaluation interval configured in your Prometheus config file. If you set this to a greater value\n                      than your Prometheus config file interval, Grafana will evaluate the data according to this\n                      interval and you will see less data points. Defaults to {'{{default}}'}.\n                    </Trans>{' '}\n                    {docsTip()}\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <>\n                  <Input\n                    className=\"width-20\"\n                    value={optionsWithDefaults.jsonData.timeInterval}\n                    spellCheck={false}\n                    // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n                    placeholder=\"15s\"\n                    onChange={onChangeHandler('timeInterval', optionsWithDefaults, onOptionsChange)}\n                    onBlur={(e) =>\n                      updateValidDuration({\n                        ...validDuration,\n                        timeInterval: e.currentTarget.value,\n                      })\n                    }\n                    data-testid={selectors.components.DataSource.Prometheus.configPage.scrapeInterval}\n                  />\n                  {validateInput(validDuration.timeInterval, DURATION_REGEX, durationError)}\n                </>\n              </InlineField>\n            </div>\n          </div>\n          {/* Query Timeout */}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineField\n                label={t('grafana-prometheus.configuration.prom-settings.label-query-timeout', 'Query timeout')}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-query-timeout\">\n                      Set the Prometheus query timeout.\n                    </Trans>{' '}\n                    {docsTip()}\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <>\n                  <Input\n                    className=\"width-20\"\n                    value={optionsWithDefaults.jsonData.queryTimeout}\n                    onChange={onChangeHandler('queryTimeout', optionsWithDefaults, onOptionsChange)}\n                    spellCheck={false}\n                    // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n                    placeholder=\"60s\"\n                    onBlur={(e) =>\n                      updateValidDuration({\n                        ...validDuration,\n                        queryTimeout: e.currentTarget.value,\n                      })\n                    }\n                    data-testid={selectors.components.DataSource.Prometheus.configPage.queryTimeout}\n                  />\n                  {validateInput(validDuration.queryTimeout, DURATION_REGEX, durationError)}\n                </>\n              </InlineField>\n            </div>\n          </div>\n        </div>\n      </ConfigSubSection>\n\n      <ConfigSubSection\n        title={t('grafana-prometheus.configuration.prom-settings.title-query-editor', 'Query editor')}\n        className={styles.container}\n      >\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form\">\n            <InlineField\n              label={t('grafana-prometheus.configuration.prom-settings.label-default-editor', 'Default editor')}\n              labelWidth={PROM_CONFIG_LABEL_WIDTH}\n              tooltip={\n                <>\n                  <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-default-editor\">\n                    Set default editor option for all users of this data source.\n                  </Trans>{' '}\n                  {docsTip()}\n                </>\n              }\n              interactive={true}\n              disabled={optionsWithDefaults.readOnly}\n            >\n              <Select\n                aria-label={t(\n                  'grafana-prometheus.configuration.prom-settings.aria-label-default-editor',\n                  'Default Editor (Code or Builder)'\n                )}\n                options={editorOptions}\n                value={\n                  editorOptions.find((o) => o.value === optionsWithDefaults.jsonData.defaultEditor) ??\n                  editorOptions.find((o) => o.value === QueryEditorMode.Builder)\n                }\n                onChange={onChangeHandler('defaultEditor', optionsWithDefaults, onOptionsChange)}\n                width={40}\n                data-testid={selectors.components.DataSource.Prometheus.configPage.defaultEditor}\n              />\n            </InlineField>\n          </div>\n          <div className=\"gf-form\">\n            <InlineField\n              labelWidth={PROM_CONFIG_LABEL_WIDTH}\n              label={t(\n                'grafana-prometheus.configuration.prom-settings.label-disable-metrics-lookup',\n                'Disable metrics lookup'\n              )}\n              tooltip={\n                <>\n                  <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-disable-metrics-lookup\">\n                    Checking this option will disable the metrics chooser and metric/label support in the query\n                    field&apos;s autocomplete. This helps if you have performance issues with bigger Prometheus\n                    instances.{' '}\n                  </Trans>\n                  {docsTip()}\n                </>\n              }\n              interactive={true}\n              disabled={optionsWithDefaults.readOnly}\n              className={styles.switchField}\n            >\n              <Switch\n                value={optionsWithDefaults.jsonData.disableMetricsLookup ?? false}\n                onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'disableMetricsLookup')}\n                id={selectors.components.DataSource.Prometheus.configPage.disableMetricLookup}\n              />\n            </InlineField>\n          </div>\n        </div>\n      </ConfigSubSection>\n\n      <ConfigSubSection\n        title={t('grafana-prometheus.configuration.prom-settings.title-performance', 'Performance')}\n        className={styles.container}\n      >\n        {!optionsWithDefaults.jsonData.prometheusType &&\n          !optionsWithDefaults.jsonData.prometheusVersion &&\n          optionsWithDefaults.readOnly && (\n            <div className={styles.versionMargin}>\n              <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.more-info\">\n                For more information on configuring prometheus type and version in data sources, see the{' '}\n                <TextLink external href=\"https://grafana.com/docs/grafana/latest/administration/provisioning/\">\n                  provisioning documentation\n                </TextLink>\n                .\n              </Trans>\n            </div>\n          )}\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineField\n                label={t('grafana-prometheus.configuration.prom-settings.label-prometheus-type', 'Prometheus type')}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    {/* , and attempt to detect the version */}\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-prometheus-type\">\n                      Set this to the type of your prometheus database, e.g. Prometheus, Cortex, Mimir or Thanos.\n                      Changing this field will save your current settings. Certain types of Prometheus supports or does\n                      not support various APIs. For example, some types support regex matching for label queries to\n                      improve performance. Some types have an API for metadata. If you set this incorrectly you may\n                      experience odd behavior when querying metrics and labels. Please check your Prometheus\n                      documentation to ensure you enter the correct type.\n                    </Trans>{' '}\n                    {docsTip()}\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Select\n                  aria-label={t(\n                    'grafana-prometheus.configuration.prom-settings.aria-label-prometheus-type',\n                    'Prometheus type'\n                  )}\n                  options={prometheusFlavorSelectItems}\n                  value={prometheusFlavorSelectItems.find(\n                    (o) => o.value === optionsWithDefaults.jsonData.prometheusType\n                  )}\n                  onChange={onChangeHandler('prometheusType', optionsWithDefaults, onOptionsChange)}\n                  width={40}\n                  data-testid={selectors.components.DataSource.Prometheus.configPage.prometheusType}\n                />\n              </InlineField>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            {optionsWithDefaults.jsonData.prometheusType && (\n              <div className=\"gf-form\">\n                <InlineField\n                  label={t(\n                    'grafana-prometheus.configuration.prom-settings.label-prom-type-version',\n                    '{{promType}} version',\n                    {\n                      promType: optionsWithDefaults.jsonData.prometheusType,\n                    }\n                  )}\n                  labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                  tooltip={\n                    <>\n                      <Trans\n                        i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-prom-type-version\"\n                        values={{ promType: optionsWithDefaults.jsonData.prometheusType }}\n                      >\n                        Use this to set the version of your {'{{promType}}'} instance if it is not automatically\n                        configured.\n                      </Trans>{' '}\n                      {docsTip()}\n                    </>\n                  }\n                  interactive={true}\n                  disabled={optionsWithDefaults.readOnly}\n                >\n                  <Select\n                    aria-label={t(\n                      'grafana-prometheus.configuration.prom-settings.aria-label-prom-type-type',\n                      '{{promType}} type',\n                      {\n                        promType: optionsWithDefaults.jsonData.prometheusType,\n                      }\n                    )}\n                    options={PromFlavorVersions[optionsWithDefaults.jsonData.prometheusType]}\n                    value={PromFlavorVersions[optionsWithDefaults.jsonData.prometheusType]?.find(\n                      (o) => o.value === optionsWithDefaults.jsonData.prometheusVersion\n                    )}\n                    onChange={onChangeHandler('prometheusVersion', optionsWithDefaults, onOptionsChange)}\n                    width={40}\n                    data-testid={selectors.components.DataSource.Prometheus.configPage.prometheusVersion}\n                  />\n                </InlineField>\n              </div>\n            )}\n          </div>\n\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-30\">\n              <InlineField\n                label={t('grafana-prometheus.configuration.prom-settings.label-cache-level', 'Cache level')}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-cache-level\">\n                      Sets the browser caching level for editor queries. Higher cache settings are recommended for high\n                      cardinality data sources.\n                    </Trans>\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Select\n                  width={40}\n                  onChange={onChangeHandler('cacheLevel', optionsWithDefaults, onOptionsChange)}\n                  options={cacheValueOptions}\n                  value={\n                    cacheValueOptions.find((o) => o.value === optionsWithDefaults.jsonData.cacheLevel) ??\n                    PrometheusCacheLevel.Low\n                  }\n                  data-testid={selectors.components.DataSource.Prometheus.configPage.cacheLevel}\n                />\n              </InlineField>\n            </div>\n          </div>\n\n          {config.featureToggles.prometheusCodeModeMetricNamesSearch && (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineField\n                  label={t(\n                    'grafana-prometheus.configuration.prom-settings.label-metric-names-suggestion-limit',\n                    'Metric names suggestion limit'\n                  )}\n                  labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                  tooltip={\n                    <>\n                      <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-metric-names-suggestion-limit\">\n                        The maximum number of metric names that may appear as autocomplete suggestions in the query\n                        editor&apos;s Code mode.\n                      </Trans>\n                    </>\n                  }\n                  interactive={true}\n                  disabled={optionsWithDefaults.readOnly}\n                >\n                  <>\n                    <Input\n                      className=\"width-20\"\n                      value={optionsWithDefaults.jsonData.codeModeMetricNamesSuggestionLimit}\n                      onChange={onChangeHandler(\n                        'codeModeMetricNamesSuggestionLimit',\n                        optionsWithDefaults,\n                        onOptionsChange\n                      )}\n                      spellCheck={false}\n                      placeholder={SUGGESTIONS_LIMIT.toString()}\n                      onBlur={(e) =>\n                        updateValidCount({\n                          ...validCount,\n                          codeModeMetricNamesSuggestionLimit: e.currentTarget.value,\n                        })\n                      }\n                      data-testid={\n                        selectors.components.DataSource.Prometheus.configPage.codeModeMetricNamesSuggestionLimit\n                      }\n                    />\n                    {validateInput(\n                      validCount.codeModeMetricNamesSuggestionLimit,\n                      NON_NEGATIVE_INTEGER_REGEX,\n                      countError\n                    )}\n                  </>\n                </InlineField>\n              </div>\n            </div>\n          )}\n\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-30\">\n              <InlineField\n                label={t(\n                  'grafana-prometheus.configuration.prom-settings.label-incremental-querying-beta',\n                  'Incremental querying (beta)'\n                )}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-incremental-querying-beta\">\n                      This feature will change the default behavior of relative queries to always request fresh data\n                      from the prometheus instance, instead query results will be cached, and only new records are\n                      requested. Turn this on to decrease database and network load.\n                    </Trans>\n                  </>\n                }\n                interactive={true}\n                className={styles.switchField}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Switch\n                  value={optionsWithDefaults.jsonData.incrementalQuerying ?? false}\n                  onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'incrementalQuerying')}\n                  id={selectors.components.DataSource.Prometheus.configPage.incrementalQuerying}\n                />\n              </InlineField>\n            </div>\n          </div>\n\n          <div className=\"gf-form-inline\">\n            {optionsWithDefaults.jsonData.incrementalQuerying && (\n              <InlineField\n                label={t(\n                  'grafana-prometheus.configuration.prom-settings.label-query-overlap-window',\n                  'Query overlap window'\n                )}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans\n                      i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-query-overlap-window\"\n                      values={{\n                        example1: '10m',\n                        example2: '120s',\n                        example3: '0s',\n                        default: '10m',\n                      }}\n                    >\n                      Set a duration like {'{{example1}}'} or {'{{example2}}'} or {'{{example3}}'}. Default of{' '}\n                      {'{{default}}'}. This duration will be added to the duration of each incremental request.\n                    </Trans>\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <>\n                  <Input\n                    onBlur={(e) =>\n                      updateValidDuration({\n                        ...validDuration,\n                        incrementalQueryOverlapWindow: e.currentTarget.value,\n                      })\n                    }\n                    className=\"width-20\"\n                    value={\n                      optionsWithDefaults.jsonData.incrementalQueryOverlapWindow ?? defaultPrometheusQueryOverlapWindow\n                    }\n                    onChange={onChangeHandler('incrementalQueryOverlapWindow', optionsWithDefaults, onOptionsChange)}\n                    spellCheck={false}\n                    data-testid={selectors.components.DataSource.Prometheus.configPage.queryOverlapWindow}\n                  />\n                  {validateInput(validDuration.incrementalQueryOverlapWindow, MULTIPLE_DURATION_REGEX, durationError)}\n                </>\n              </InlineField>\n            )}\n          </div>\n\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-30\">\n              <InlineField\n                label={t(\n                  'grafana-prometheus.configuration.prom-settings.label-disable-recording-rules-beta',\n                  'Disable recording rules (beta)'\n                )}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-disable-recording-rules-beta\">\n                      This feature will disable recording rules. Turn this on to improve dashboard performance\n                    </Trans>\n                  </>\n                }\n                interactive={true}\n                className={styles.switchField}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Switch\n                  value={optionsWithDefaults.jsonData.disableRecordingRules ?? false}\n                  onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'disableRecordingRules')}\n                  id={selectors.components.DataSource.Prometheus.configPage.disableRecordingRules}\n                />\n              </InlineField>\n            </div>\n          </div>\n        </div>\n      </ConfigSubSection>\n\n      <ConfigSubSection\n        title={t('grafana-prometheus.configuration.prom-settings.title-other', 'Other')}\n        className={styles.container}\n      >\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-30\">\n              <InlineField\n                label={t(\n                  'grafana-prometheus.configuration.prom-settings.label-custom-query-parameters',\n                  'Custom query parameters'\n                )}\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans\n                      i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-custom-query-parameters\"\n                      values={{\n                        example1: 'timeout',\n                        example2: 'partial_response',\n                        example3: 'dedup',\n                        example4: 'max_source_resolution',\n                        concatenationChar: '&',\n                      }}\n                    >\n                      Add custom parameters to the Prometheus query URL. For example {'{{example1}}'}, {'{{example2}}'},{' '}\n                      {'{{example3}}'}, or\n                      {'{{example4}}'}. Multiple parameters should be concatenated together with{' '}\n                      {'{{concatenationChar}}'}.\n                    </Trans>{' '}\n                    {docsTip()}\n                  </>\n                }\n                interactive={true}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Input\n                  className=\"width-20\"\n                  value={optionsWithDefaults.jsonData.customQueryParameters}\n                  onChange={onChangeHandler('customQueryParameters', optionsWithDefaults, onOptionsChange)}\n                  spellCheck={false}\n                  placeholder={t(\n                    'grafana-prometheus.configuration.prom-settings.placeholder-example-maxsourceresolutionmtimeout',\n                    'Example: {{example}}',\n                    { example: 'max_source_resolution=5m&timeout=10' }\n                  )}\n                  data-testid={selectors.components.DataSource.Prometheus.configPage.customQueryParameters}\n                />\n              </InlineField>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            {/* HTTP Method */}\n            <div className=\"gf-form\">\n              <InlineField\n                labelWidth={PROM_CONFIG_LABEL_WIDTH}\n                tooltip={\n                  <>\n                    <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-http-method\">\n                      You can use either POST or GET HTTP method to query your Prometheus data source. POST is the\n                      recommended method as it allows bigger queries. Change this to GET if you have a Prometheus\n                      version older than 2.1 or if POST requests are restricted in your network.\n                    </Trans>{' '}\n                    {docsTip()}\n                  </>\n                }\n                interactive={true}\n                label={t('grafana-prometheus.configuration.prom-settings.label-http-method', 'HTTP method')}\n                disabled={optionsWithDefaults.readOnly}\n              >\n                <Select\n                  width={40}\n                  aria-label={t(\n                    'grafana-prometheus.configuration.prom-settings.aria-label-select-http-method',\n                    'Select HTTP method'\n                  )}\n                  options={httpOptions}\n                  value={httpOptions.find((o) => o.value === optionsWithDefaults.jsonData.httpMethod)}\n                  onChange={onChangeHandler('httpMethod', optionsWithDefaults, onOptionsChange)}\n                  data-testid={selectors.components.DataSource.Prometheus.configPage.httpMethod}\n                />\n              </InlineField>\n            </div>\n          </div>\n          <InlineField\n            labelWidth={PROM_CONFIG_LABEL_WIDTH}\n            label={t('grafana-prometheus.configuration.prom-settings.label-series-limit', 'Series limit')}\n            tooltip={\n              <>\n                <Trans i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-series-limit\">\n                  The limit applies to all resources (metrics, labels, and values) for both endpoints (series and\n                  labels). Leave the field empty to use the default limit (40000). Set to 0 to disable the limit and\n                  fetch everything  this may cause performance issues. Default limit is 40000.\n                </Trans>\n                {docsTip()}\n              </>\n            }\n            interactive={true}\n            disabled={optionsWithDefaults.readOnly}\n          >\n            <>\n              <Input\n                className=\"width-20\"\n                value={seriesLimit}\n                spellCheck={false}\n                // eslint-disable-next-line @grafana/i18n/no-untranslated-strings\n                placeholder=\"40000\"\n                onChange={(event: { currentTarget: { value: string } }) => {\n                  setSeriesLimit(event.currentTarget.value);\n                  onOptionsChange({\n                    ...optionsWithDefaults,\n                    jsonData: {\n                      ...optionsWithDefaults.jsonData,\n                      seriesLimit: parseInt(event.currentTarget.value, 10),\n                    },\n                  });\n                }}\n                onBlur={(e) => validateInput(e.currentTarget.value, NON_NEGATIVE_INTEGER_REGEX, seriesLimitError)}\n                data-testid={selectors.components.DataSource.Prometheus.configPage.seriesLimit}\n              />\n              {validateInput(seriesLimit, NON_NEGATIVE_INTEGER_REGEX, seriesLimitError)}\n            </>\n          </InlineField>\n          <InlineField\n            labelWidth={PROM_CONFIG_LABEL_WIDTH}\n            label={t('grafana-prometheus.configuration.prom-settings.label-use-series-endpoint', 'Use series endpoint')}\n            tooltip={\n              <>\n                <Trans\n                  i18nKey=\"grafana-prometheus.configuration.prom-settings.tooltip-use-series-endpoint\"\n                  values={{ exampleParameter: 'match[]' }}\n                >\n                  Checking this option will favor the series endpoint with {'{{exampleParameter}}'} parameter over the\n                  label values endpoint with {'{{exampleParameter}}'} parameter. While the label values endpoint is\n                  considered more performant, some users may prefer the series because it has a POST method while the\n                  label values endpoint only has a GET method.\n                </Trans>{' '}\n                {docsTip()}\n              </>\n            }\n            interactive={true}\n            disabled={optionsWithDefaults.readOnly}\n            className={styles.switchField}\n          >\n            <Switch\n              value={optionsWithDefaults.jsonData.seriesEndpoint ?? false}\n              onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'seriesEndpoint')}\n            />\n          </InlineField>\n        </div>\n      </ConfigSubSection>\n\n      <ExemplarsSettings\n        options={optionsWithDefaults.jsonData.exemplarTraceIdDestinations}\n        onChange={(exemplarOptions) =>\n          updateDatasourcePluginJsonDataOption(\n            { onOptionsChange, options: optionsWithDefaults },\n            'exemplarTraceIdDestinations',\n            exemplarOptions\n          )\n        }\n        disabled={optionsWithDefaults.readOnly}\n      />\n    </>\n  );\n};\n\nexport const getValueFromEventItem = (eventItem: SyntheticEvent<HTMLInputElement> | SelectableValue<string>) => {\n  if (!eventItem) {\n    return '';\n  }\n\n  if ('currentTarget' in eventItem) {\n    return eventItem.currentTarget.value;\n  }\n\n  return eventItem.value;\n};\n\nconst onChangeHandler =\n  (key: keyof PromOptions, options: Props['options'], onOptionsChange: Props['onOptionsChange']) =>\n  (eventItem: SyntheticEvent<HTMLInputElement> | SelectableValue<string>) => {\n    onOptionsChange({\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        [key]: getValueFromEventItem(eventItem),\n      },\n    });\n  };\n","import {\n  AzureCredentials,\n  AzureDataSourceJsonData,\n  AzureDataSourceSecureJsonData,\n  AzureDataSourceSettings,\n  getAzureClouds,\n  getDatasourceCredentials,\n  getDefaultAzureCloud,\n  updateDatasourceCredentials,\n} from '@grafana/azure-sdk';\nimport { DataSourceSettings, SelectableValue } from '@grafana/data';\nimport { PromOptions } from '@grafana/prometheus';\nimport { config } from '@grafana/runtime';\n\nexport function getAzureCloudOptions(): Array<SelectableValue<string>> {\n  const cloudInfo = getAzureClouds();\n\n  return cloudInfo.map((cloud) => ({\n    value: cloud.name,\n    label: cloud.displayName,\n  }));\n}\n\nexport function getDefaultCredentials(): AzureCredentials {\n  if (config.azure.managedIdentityEnabled) {\n    return { authType: 'msi' };\n  } else {\n    return { authType: 'clientsecret', azureCloud: getDefaultAzureCloud() };\n  }\n}\n\nexport function getCredentials(options: AzureDataSourceSettings): AzureCredentials {\n  const credentials = getDatasourceCredentials(options);\n  if (credentials) {\n    return credentials;\n  }\n\n  // If no credentials saved, then return empty credentials\n  // of type based on whether the managed identity enabled\n  return getDefaultCredentials();\n}\n\nexport function updateCredentials(\n  options: AzurePromDataSourceSettings,\n  credentials: AzureCredentials\n): AzurePromDataSourceSettings {\n  return updateDatasourceCredentials(options, credentials);\n}\n\nexport function setDefaultCredentials(options: AzurePromDataSourceSettings): Partial<AzurePromDataSourceSettings> {\n  return {\n    jsonData: {\n      ...options.jsonData,\n      azureCredentials: getDefaultCredentials(),\n    },\n  };\n}\n\nexport function resetCredentials(options: AzurePromDataSourceSettings): Partial<AzurePromDataSourceSettings> {\n  return {\n    jsonData: {\n      ...options.jsonData,\n      azureCredentials: undefined,\n      azureEndpointResourceId: undefined,\n    },\n  };\n}\n\nexport interface AzurePromDataSourceOptions extends PromOptions, AzureDataSourceJsonData {\n  azureEndpointResourceId?: string;\n}\n\nexport type AzurePromDataSourceSettings = DataSourceSettings<AzurePromDataSourceOptions, AzureDataSourceSecureJsonData>;\n","import { cx } from '@emotion/css';\nimport { ChangeEvent, useMemo } from 'react';\n\nimport { AzureAuthType, AzureCredentials } from '@grafana/azure-sdk';\nimport { SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, Button, Select, Input } from '@grafana/ui';\n\nexport interface Props {\n  managedIdentityEnabled: boolean;\n  workloadIdentityEnabled: boolean;\n  credentials: AzureCredentials;\n  azureCloudOptions?: SelectableValue[];\n  onCredentialsChange: (updatedCredentials: AzureCredentials) => void;\n  getSubscriptions?: () => Promise<SelectableValue[]>;\n  disabled?: boolean;\n}\n\nexport const AzureCredentialsForm = (props: Props) => {\n  const {\n    credentials,\n    azureCloudOptions,\n    onCredentialsChange,\n    disabled,\n    managedIdentityEnabled,\n    workloadIdentityEnabled,\n  } = props;\n\n  const authTypeOptions = useMemo(() => {\n    let opts: Array<SelectableValue<AzureAuthType>> = [\n      {\n        value: 'clientsecret',\n        label: 'App Registration',\n      },\n    ];\n\n    if (managedIdentityEnabled) {\n      opts.push({\n        value: 'msi',\n        label: 'Managed Identity',\n      });\n    }\n\n    if (workloadIdentityEnabled) {\n      opts.push({\n        value: 'workloadidentity',\n        label: 'Workload Identity',\n      });\n    }\n    return opts;\n  }, [managedIdentityEnabled, workloadIdentityEnabled]);\n\n  const onAuthTypeChange = (selected: SelectableValue<AzureAuthType>) => {\n    const defaultAuthType = managedIdentityEnabled\n      ? 'msi'\n      : workloadIdentityEnabled\n        ? 'workloadidentity'\n        : 'clientsecret';\n    const updated: AzureCredentials = {\n      ...credentials,\n      authType: selected.value || defaultAuthType,\n    };\n    onCredentialsChange(updated);\n  };\n\n  const onAzureCloudChange = (selected: SelectableValue<string>) => {\n    if (credentials.authType === 'clientsecret') {\n      const updated: AzureCredentials = {\n        ...credentials,\n        azureCloud: selected.value,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onTenantIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (credentials.authType === 'clientsecret') {\n      const updated: AzureCredentials = {\n        ...credentials,\n        tenantId: event.target.value,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (credentials.authType === 'clientsecret') {\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientId: event.target.value,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientSecretChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (credentials.authType === 'clientsecret') {\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientSecret: event.target.value,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientSecretReset = () => {\n    if (credentials.authType === 'clientsecret') {\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientSecret: '',\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  return (\n    <div className=\"gf-form-group\">\n      {authTypeOptions.length > 1 && (\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <InlineFormLabel className=\"width-12\" tooltip=\"Choose the type of authentication to Azure services\">\n              Authentication\n            </InlineFormLabel>\n            <Select\n              className=\"width-15\"\n              value={authTypeOptions.find((opt) => opt.value === credentials.authType)}\n              options={authTypeOptions}\n              onChange={onAuthTypeChange}\n              isDisabled={disabled}\n            />\n          </div>\n        </div>\n      )}\n      {credentials.authType === 'clientsecret' && (\n        <>\n          {azureCloudOptions && (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\" tooltip=\"Choose an Azure Cloud\">\n                  Azure Cloud\n                </InlineFormLabel>\n                <Select\n                  className=\"width-15\"\n                  value={azureCloudOptions.find((opt) => opt.value === credentials.azureCloud)}\n                  options={azureCloudOptions}\n                  onChange={onAzureCloudChange}\n                  isDisabled={disabled}\n                />\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Directory (tenant) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className={cx('width-20')}\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={credentials.tenantId || ''}\n                  onChange={onTenantIdChange}\n                  disabled={disabled}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Application (client) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className={cx('width-20')}\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={credentials.clientId || ''}\n                  onChange={onClientIdChange}\n                  disabled={disabled}\n                />\n              </div>\n            </div>\n          </div>\n          {typeof credentials.clientSecret === 'symbol' ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel htmlFor=\"azure-client-secret\" className=\"width-12\">\n                  Client Secret\n                </InlineFormLabel>\n                <Input id=\"azure-client-secret\" className={cx('width-20')} placeholder=\"configured\" disabled />\n              </div>\n              {!disabled && (\n                <div className=\"gf-form\">\n                  <div className={cx('max-width-20 gf-form-inline')}>\n                    <Button variant=\"secondary\" type=\"button\" onClick={onClientSecretReset}>\n                      reset\n                    </Button>\n                  </div>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">Client Secret</InlineFormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className={cx('width-20')}\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={credentials.clientSecret || ''}\n                    onChange={onClientSecretChange}\n                    disabled={disabled}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default AzureCredentialsForm;\n","import { cx } from '@emotion/css';\nimport { FormEvent, useMemo, useState } from 'react';\nimport { useEffectOnce } from 'react-use';\n\nimport { AzureCredentials } from '@grafana/azure-sdk';\nimport { config } from '@grafana/runtime';\nimport { InlineField, InlineFieldRow, InlineSwitch, Input } from '@grafana/ui';\nimport { HttpSettingsBaseProps } from '@grafana/ui/internal';\n\nimport { getAzureCloudOptions, getCredentials, updateCredentials } from './AzureCredentialsConfig';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\n\nexport const AzureAuthSettings = (props: HttpSettingsBaseProps) => {\n  const { dataSourceConfig, onChange } = props;\n\n  const [overrideAudienceAllowed] = useState<boolean>(!!config.featureToggles.prometheusAzureOverrideAudience);\n  const [overrideAudienceChecked, setOverrideAudienceChecked] = useState<boolean>(\n    !!dataSourceConfig.jsonData.azureEndpointResourceId\n  );\n\n  const credentials = useMemo(() => getCredentials(dataSourceConfig), [dataSourceConfig]);\n\n  const onCredentialsChange = (credentials: AzureCredentials): void => {\n    onChange(updateCredentials(dataSourceConfig, credentials));\n  };\n\n  const onOverrideAudienceChange = (ev: FormEvent<HTMLInputElement>): void => {\n    setOverrideAudienceChecked(ev.currentTarget.checked);\n    if (!ev.currentTarget.checked) {\n      onChange({\n        ...dataSourceConfig,\n        jsonData: { ...dataSourceConfig.jsonData, azureEndpointResourceId: undefined },\n      });\n    }\n  };\n\n  const onResourceIdChange = (ev: FormEvent<HTMLInputElement>): void => {\n    if (overrideAudienceChecked) {\n      onChange({\n        ...dataSourceConfig,\n        jsonData: { ...dataSourceConfig.jsonData, azureEndpointResourceId: ev.currentTarget.value },\n      });\n    }\n  };\n\n  // The auth type needs to be set on the first load of the data source\n  useEffectOnce(() => {\n    if (!dataSourceConfig.jsonData.authType) {\n      onCredentialsChange(credentials);\n    }\n  });\n\n  return (\n    <>\n      <h6>Azure authentication</h6>\n      <AzureCredentialsForm\n        managedIdentityEnabled={config.azure.managedIdentityEnabled}\n        workloadIdentityEnabled={config.azure.workloadIdentityEnabled}\n        credentials={credentials}\n        azureCloudOptions={getAzureCloudOptions()}\n        onCredentialsChange={onCredentialsChange}\n        disabled={dataSourceConfig.readOnly}\n      />\n      {overrideAudienceAllowed && (\n        <>\n          <h6>Azure configuration</h6>\n          <div className=\"gf-form-group\">\n            <InlineFieldRow>\n              <InlineField labelWidth={24} label=\"Override AAD audience\" disabled={dataSourceConfig.readOnly}>\n                <InlineSwitch value={overrideAudienceChecked} onChange={onOverrideAudienceChange} />\n              </InlineField>\n            </InlineFieldRow>\n            {overrideAudienceChecked && (\n              <InlineFieldRow>\n                <InlineField labelWidth={24} label=\"Resource ID\" disabled={dataSourceConfig.readOnly}>\n                  <Input\n                    className={cx('width-20')}\n                    value={dataSourceConfig.jsonData.azureEndpointResourceId || ''}\n                    onChange={onResourceIdChange}\n                  />\n                </InlineField>\n              </InlineFieldRow>\n            )}\n          </div>\n        </>\n      )}\n    </>\n  );\n};\n\nexport default AzureAuthSettings;\n","import { ReactElement, useState } from 'react';\nimport * as React from 'react';\n\nimport { Auth, ConnectionSettings, convertLegacyAuthProps, AuthMethod } from '@grafana/plugin-ui';\nimport { docsTip, overhaulStyles } from '@grafana/prometheus';\nimport { Alert, SecureSocksProxySettings, useTheme2 } from '@grafana/ui';\n// NEED TO EXPORT THIS FROM GRAFANA/UI FOR EXTERNAL DS\nimport { AzureAuthSettings } from '@grafana/ui/internal';\n\nimport { AzurePromDataSourceSettings } from './AzureCredentialsConfig';\n\ntype Props = {\n  options: AzurePromDataSourceSettings;\n  onOptionsChange: (options: AzurePromDataSourceSettings) => void;\n  azureAuthSettings: AzureAuthSettings;\n  sigV4AuthToggleEnabled: boolean | undefined;\n  renderSigV4Editor: React.ReactNode;\n  secureSocksDSProxyEnabled: boolean;\n};\n\n// these are not available yet in grafana\nexport type CustomMethodId = `custom-${string}`;\n\nexport type CustomMethod = {\n  id: CustomMethodId;\n  label: string;\n  description: string;\n  component: ReactElement;\n};\n\nexport const DataSourcehttpSettingsOverhaul = (props: Props) => {\n  const {\n    options,\n    onOptionsChange,\n    azureAuthSettings,\n    sigV4AuthToggleEnabled,\n    renderSigV4Editor,\n    secureSocksDSProxyEnabled,\n  } = props;\n\n  const newAuthProps = convertLegacyAuthProps({\n    config: options,\n    onChange: onOptionsChange,\n  });\n\n  const theme = useTheme2();\n  const styles = overhaulStyles(theme);\n\n  // for custom auth methods sigV4 and azure auth\n  let customMethods: CustomMethod[] = [];\n\n  const [sigV4Selected, setSigV4Selected] = useState<boolean>(options.jsonData.sigV4Auth || false);\n\n  const sigV4Id = 'custom-sigV4Id';\n\n  const sigV4Option: CustomMethod = {\n    id: sigV4Id,\n    label: 'SigV4 auth',\n    description: 'This is SigV4 auth description',\n    component: <>{renderSigV4Editor}</>,\n  };\n\n  if (sigV4AuthToggleEnabled) {\n    customMethods.push(sigV4Option);\n  }\n\n  const azureAuthEnabled: boolean =\n    (azureAuthSettings?.azureAuthSupported && azureAuthSettings.getAzureAuthEnabled(options)) || false;\n\n  const [azureAuthSelected, setAzureAuthSelected] = useState<boolean>(azureAuthEnabled);\n\n  const azureAuthId = 'custom-azureAuthId';\n\n  const azureAuthOption: CustomMethod = {\n    id: azureAuthId,\n    label: 'Azure auth',\n    description: 'Authenticate with Azure',\n    component: (\n      <>\n        {azureAuthSettings.azureSettingsUI && (\n          <azureAuthSettings.azureSettingsUI dataSourceConfig={options} onChange={onOptionsChange} />\n        )}\n      </>\n    ),\n  };\n\n  // allow the option to show in the dropdown\n  if (azureAuthSettings?.azureAuthSupported) {\n    customMethods.push(azureAuthOption);\n  }\n\n  function returnSelectedMethod() {\n    if (sigV4Selected) {\n      return sigV4Id;\n    }\n\n    if (azureAuthSelected) {\n      return azureAuthId;\n    }\n\n    return newAuthProps.selectedMethod;\n  }\n\n  // Do we need this switch anymore? Update the language.\n  let urlTooltip;\n  switch (options.access) {\n    case 'direct':\n      urlTooltip = (\n        <>\n          Your access method is <em>Browser</em>, this means the URL needs to be accessible from the browser.\n          {docsTip()}\n        </>\n      );\n      break;\n    case 'proxy':\n      urlTooltip = (\n        <>\n          Your access method is <em>Server</em>, this means the URL needs to be accessible from the grafana\n          backend/server.\n          {docsTip()}\n        </>\n      );\n      break;\n    default:\n      urlTooltip = <>Specify a complete HTTP URL (for example http://your_server:8080) {docsTip()}</>;\n  }\n\n  return (\n    <>\n      <ConnectionSettings\n        urlPlaceholder=\"http://localhost:9090\"\n        config={options}\n        onChange={onOptionsChange}\n        urlLabel=\"Prometheus server URL\"\n        urlTooltip={urlTooltip}\n      />\n      <hr className={`${styles.hrTopSpace} ${styles.hrBottomSpace}`} />\n      {sigV4Selected && (\n        <Alert title=\"Deprecation Notice\" severity=\"warning\">\n          The SigV4 authentication in the core Prometheus data source is deprecated. Please use the Amazon Managed\n          Service for Prometheus data source to authenticate with SigV4.\n        </Alert>\n      )}\n      {azureAuthSelected && (\n        <Alert title=\"Deprecation Notice\" severity=\"warning\">\n          Azure authentication in the core Prometheus data source is deprecated. Please use the Azure Monitor Managed\n          Service for Prometheus data source to authenticate using Azure authentication.\n        </Alert>\n      )}\n      <Auth\n        {...newAuthProps}\n        customMethods={customMethods}\n        onAuthMethodSelect={(method) => {\n          // sigV4Id\n          if (sigV4AuthToggleEnabled) {\n            setSigV4Selected(method === sigV4Id);\n          }\n\n          // Azure\n          if (azureAuthSettings?.azureAuthSupported) {\n            setAzureAuthSelected(method === azureAuthId);\n            azureAuthSettings.setAzureAuthEnabled(options, method === azureAuthId);\n          }\n\n          onOptionsChange({\n            ...options,\n            basicAuth: method === AuthMethod.BasicAuth,\n            withCredentials: method === AuthMethod.CrossSiteCredentials,\n            jsonData: {\n              ...options.jsonData,\n              azureCredentials: method === azureAuthId ? options.jsonData.azureCredentials : undefined,\n              sigV4Auth: method === sigV4Id,\n              oauthPassThru: method === AuthMethod.OAuthForward,\n            },\n          });\n        }}\n        // If your method is selected pass its id to `selectedMethod`,\n        // otherwise pass the id from converted legacy data\n        selectedMethod={returnSelectedMethod()}\n      />\n      <div className={styles.sectionBottomPadding} />\n      {secureSocksDSProxyEnabled && (\n        <>\n          <SecureSocksProxySettings options={options} onOptionsChange={onOptionsChange} />\n          <div className={styles.sectionBottomPadding} />\n        </>\n      )}\n    </>\n  );\n};\n","import { css } from '@emotion/css';\n\nimport { SIGV4ConnectionConfig } from '@grafana/aws-sdk';\nimport { hasCredentials } from '@grafana/azure-sdk';\nimport { DataSourcePluginOptionsEditorProps, GrafanaTheme2 } from '@grafana/data';\nimport { AdvancedHttpSettings, ConfigSection, DataSourceDescription } from '@grafana/plugin-ui';\nimport { AlertingSettingsOverhaul, PromOptions, PromSettings } from '@grafana/prometheus';\nimport { config } from '@grafana/runtime';\nimport { Alert, FieldValidationMessage, useTheme2 } from '@grafana/ui';\n\nimport { AzureAuthSettings } from './AzureAuthSettings';\nimport { AzurePromDataSourceSettings, setDefaultCredentials, resetCredentials } from './AzureCredentialsConfig';\nimport { DataSourcehttpSettingsOverhaul } from './DataSourceHttpSettingsOverhaulPackage';\n\nexport const PROM_CONFIG_LABEL_WIDTH = 30;\n\nexport type Props = DataSourcePluginOptionsEditorProps<PromOptions>;\n\nexport const ConfigEditor = (props: Props) => {\n  const { options, onOptionsChange } = props;\n\n  const azureAuthSettings = {\n    azureAuthSupported: config.azureAuthEnabled,\n    getAzureAuthEnabled: (config: AzurePromDataSourceSettings): boolean => hasCredentials(config),\n    setAzureAuthEnabled: (config: AzurePromDataSourceSettings, enabled: boolean) =>\n      enabled ? setDefaultCredentials(config) : resetCredentials(config),\n    azureSettingsUI: AzureAuthSettings,\n  };\n\n  const theme = useTheme2();\n  const styles = overhaulStyles(theme);\n\n  return (\n    <>\n      {options.access === 'direct' && (\n        <Alert title=\"Error\" severity=\"error\">\n          Browser access mode in the Prometheus data source is no longer available. Switch to server access mode.\n        </Alert>\n      )}\n      <DataSourceDescription\n        dataSourceName=\"Prometheus\"\n        docsLink=\"https://grafana.com/docs/grafana/latest/datasources/prometheus/configure-prometheus-data-source/\"\n      />\n      <hr className={`${styles.hrTopSpace} ${styles.hrBottomSpace}`} />\n      <DataSourcehttpSettingsOverhaul\n        options={options}\n        onOptionsChange={onOptionsChange}\n        azureAuthSettings={azureAuthSettings}\n        sigV4AuthToggleEnabled={config.sigV4AuthEnabled}\n        renderSigV4Editor={\n          <SIGV4ConnectionConfig inExperimentalAuthComponent={true} {...props}></SIGV4ConnectionConfig>\n        }\n        secureSocksDSProxyEnabled={config.secureSocksDSProxyEnabled}\n      />\n      <hr />\n      <ConfigSection\n        className={styles.advancedSettings}\n        title=\"Advanced settings\"\n        description=\"Additional settings are optional settings that can be configured for more control over your data source.\"\n      >\n        <AdvancedHttpSettings\n          className={styles.advancedHTTPSettingsMargin}\n          config={options}\n          onChange={onOptionsChange}\n        />\n        <AlertingSettingsOverhaul<PromOptions> options={options} onOptionsChange={onOptionsChange} />\n        <PromSettings options={options} onOptionsChange={onOptionsChange} />\n      </ConfigSection>\n    </>\n  );\n};\n/**\n * Use this to return a url in a tooltip in a field. Don't forget to make the field interactive to be able to click on the tooltip\n * @param url\n * @returns\n */\nexport function docsTip(url?: string) {\n  const docsUrl = 'https://grafana.com/docs/grafana/latest/datasources/prometheus/#configure-the-data-source';\n\n  return (\n    <a href={url ? url : docsUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n      Visit docs for more details here.\n    </a>\n  );\n}\n\nexport const validateInput = (\n  input: string,\n  pattern: string | RegExp,\n  errorMessage?: string\n): boolean | JSX.Element => {\n  const defaultErrorMessage = 'Value is not valid';\n  if (input && !input.match(pattern)) {\n    return <FieldValidationMessage>{errorMessage ? errorMessage : defaultErrorMessage}</FieldValidationMessage>;\n  } else {\n    return true;\n  }\n};\n\nexport function overhaulStyles(theme: GrafanaTheme2) {\n  return {\n    additionalSettings: css({\n      marginBottom: '25px',\n    }),\n    secondaryGrey: css({\n      color: `${theme.colors.secondary.text}`,\n      opacity: '65%',\n    }),\n    inlineError: css({\n      margin: '0px 0px 4px 245px',\n    }),\n    switchField: css({\n      alignItems: 'center',\n    }),\n    sectionHeaderPadding: css({\n      paddingTop: '32px',\n    }),\n    sectionBottomPadding: css({\n      paddingBottom: '28px',\n    }),\n    subsectionText: css({\n      fontSize: '12px',\n    }),\n    hrBottomSpace: css({\n      marginBottom: '56px',\n    }),\n    hrTopSpace: css({\n      marginTop: '50px',\n    }),\n    textUnderline: css({\n      textDecoration: 'underline',\n    }),\n    versionMargin: css({\n      marginBottom: '12px',\n    }),\n    advancedHTTPSettingsMargin: css({\n      margin: '24px 0 8px 0',\n    }),\n    advancedSettings: css({\n      paddingTop: '32px',\n    }),\n    alertingTop: css({\n      marginTop: '40px !important',\n    }),\n    overhaulPageHeading: css({\n      fontWeight: '400',\n    }),\n    container: css({\n      maxwidth: '578',\n    }),\n  };\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { PrometheusDatasource, PromQueryEditorByApp, PromCheatSheet } from '@grafana/prometheus';\n\nimport { ConfigEditor } from './configuration/ConfigEditorPackage';\n\nexport const plugin = new DataSourcePlugin(PrometheusDatasource)\n  .setQueryEditor(PromQueryEditorByApp)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditorHelp(PromCheatSheet);\n","import { useRef } from 'react';\nvar useLatest = function (value) {\n    var ref = useRef(value);\n    ref.current = value;\n    return ref;\n};\nexport default useLatest;\n","import { cx, css } from '@emotion/css';\nimport React__default from 'react';\nimport '@grafana/data';\nimport { useStyles2, Button } from '@grafana/ui';\n\nconst AccessoryButton = ({ className, ...props }) => {\n  const styles = useStyles2(getButtonStyles);\n  return /* @__PURE__ */ React__default.createElement(Button, { ...props, className: cx(className, styles.button) });\n};\nconst getButtonStyles = (theme) => ({\n  button: css({\n    paddingLeft: theme.spacing(3 / 2),\n    paddingRight: theme.spacing(3 / 2)\n  })\n});\n\nexport { AccessoryButton };\n//# sourceMappingURL=AccessoryButton.js.map\n","import React__default from 'react';\nimport { EditorStack } from './EditorStack.js';\n\nconst EditorFieldGroup = ({ children }) => {\n  return /* @__PURE__ */ React__default.createElement(EditorStack, { gap: 1 }, children);\n};\n\nexport { EditorFieldGroup };\n//# sourceMappingURL=EditorFieldGroup.js.map\n","import { css } from '@emotion/css';\nimport React__default from 'react';\nimport '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst EditorHeader = ({ children }) => {\n  const styles = useStyles2(getStyles);\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.root }, children);\n};\nconst getStyles = (theme) => ({\n  root: css({\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    alignItems: \"center\",\n    gap: theme.spacing(3),\n    minHeight: theme.spacing(4)\n  })\n});\n\nexport { EditorHeader };\n//# sourceMappingURL=EditorHeader.js.map\n","import { Button } from '@grafana/ui';\nimport React__default from 'react';\nimport { EditorStack } from './EditorStack.js';\n\nconst EditorList = React__default.forwardRef(function EditorList2({ items, renderItem, onChange }, ref) {\n  const onAddItem = () => {\n    const newItems = [...items, {}];\n    onChange(newItems);\n  };\n  const onChangeItem = (itemIndex, newItem) => {\n    const newItems = [...items];\n    newItems[itemIndex] = newItem;\n    onChange(newItems);\n  };\n  const onDeleteItem = (itemIndex) => {\n    const newItems = [...items];\n    newItems.splice(itemIndex, 1);\n    onChange(newItems);\n  };\n  return /* @__PURE__ */ React__default.createElement(EditorStack, null, items.map((item, index) => /* @__PURE__ */ React__default.createElement(\"div\", { key: index }, renderItem(\n    item,\n    (newItem) => onChangeItem(index, newItem),\n    () => onDeleteItem(index)\n  ))), /* @__PURE__ */ React__default.createElement(Button, { ref, onClick: onAddItem, variant: \"secondary\", size: \"md\", icon: \"plus\", \"aria-label\": \"Add\", type: \"button\" }));\n});\n\nexport { EditorList };\n//# sourceMappingURL=EditorList.js.map\n","import React__default from 'react';\nimport { EditorStack } from './EditorStack.js';\n\nconst EditorRows = ({ children }) => {\n  return /* @__PURE__ */ React__default.createElement(EditorStack, { gap: 0.5, direction: \"column\" }, children);\n};\n\nexport { EditorRows };\n//# sourceMappingURL=EditorRows.js.map\n","import { css } from '@emotion/css';\nimport { Switch } from '@grafana/ui';\nimport React__default from 'react';\n\nconst EditorSwitch = (props) => {\n  const styles = getStyles();\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.switch }, /* @__PURE__ */ React__default.createElement(Switch, { ...props }));\n};\nconst getStyles = () => {\n  return {\n    switch: css({\n      display: \"flex\",\n      alignItems: \"center\",\n      minHeight: 30\n    })\n  };\n};\n\nexport { EditorSwitch };\n//# sourceMappingURL=EditorSwitch.js.map\n","import React__default from 'react';\n\nconst FlexItem = ({ grow, shrink }) => {\n  return /* @__PURE__ */ React__default.createElement(\"div\", { style: { display: \"block\", flexGrow: grow, flexShrink: shrink } });\n};\n\nexport { FlexItem };\n//# sourceMappingURL=FlexItem.js.map\n","import { cx, css } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React__default, { Children, isValidElement, cloneElement } from 'react';\n\nconst InputGroup = ({ children }) => {\n  const styles = useStyles2(getStyles);\n  const modifiedChildren = Children.map(children, (child) => {\n    if (isValidElement(child) && child.props.invalid) {\n      return cloneElement(child, { className: cx(child.props.className, styles.invalidChild) });\n    }\n    return child;\n  });\n  return /* @__PURE__ */ React__default.createElement(\"div\", { className: styles.root }, modifiedChildren);\n};\nconst borderPriority = [\n  \"\",\n  // lowest priority\n  \"base\",\n  \"hovered\",\n  \"invalid\",\n  \"focused\"\n  // highest priority\n];\nconst getStyles = () => ({\n  root: css({\n    display: \"flex\",\n    // Style the direct children of the component\n    \"> *\": {\n      \"&:not(:first-child)\": {\n        // Negative margin hides the double-border on adjacent selects\n        marginLeft: -1\n      },\n      \"&:first-child\": {\n        borderTopRightRadius: 0,\n        borderBottomRightRadius: 0\n      },\n      \"&:last-child\": {\n        borderTopLeftRadius: 0,\n        borderBottomLeftRadius: 0\n      },\n      \"&:not(:first-child):not(:last-child)\": {\n        borderRadius: 0\n      },\n      //\n      position: \"relative\",\n      zIndex: borderPriority.indexOf(\"base\"),\n      // Adjacent borders are overlapping, so raise children up when hovering etc\n      // so all that child's borders are visible.\n      \"&:hover\": {\n        zIndex: borderPriority.indexOf(\"hovered\")\n      },\n      \"&:focus-within\": {\n        zIndex: borderPriority.indexOf(\"focused\")\n      }\n    }\n  }),\n  invalidChild: css({\n    zIndex: borderPriority.indexOf(\"invalid\")\n  })\n});\n\nexport { InputGroup };\n//# sourceMappingURL=InputGroup.js.map\n"],"names":["INFINITY_SAMPLE_REGEX","isTableResult","dataFrame","options","target","isCumulativeHeatmapResult","transformV2","response","request","f","t","field","fieldCopy","tableFrames","framesWithoutTable","df","processedTableFrames","transformDFToTable","exemplarFrames","framesWithoutTableAndExemplars","destinations","processedExemplarFrames","exemplarTraceIdDestination","traceIDField","links","getDataLinks","heatmapResults","framesWithoutTableHeatmapsAndExemplars","le","heatmapResultsGroupedByQuery","h","processedHeatmapResultsGroupedByQuery","query","heatmapResultsGroup","heatmapResultsGroupedByValues","values","HISTOGRAM_QUANTILE_LABEL_NAME","notLE","dataFrames","key","sortedHeatmap","sortSeriesByLabel","mergeHeatmapFrames","transformToHistogramOverTime","otherFrames","flattenedProcessedHeatmapFrames","dfs","dataFramesByRefId","refIds","refId","valueText","getValueText","valueField","getValueField","timeField","getTimeField","labelFields","promLabels","label","l","prevTime","needsSort","timeFields","dataFields","value","parseSampleValue","labelsForField","getLabelValue","fields","frame","responseLength","dataLinks","dsSettings","metric","data","isMs","val","valueName","parseValue","labels","displayNameFromDS","getOriginalMetricName","labelData","metricName","labelPart","frames","countFields","seriesList","i","topSeries","s","bottomSeries","j","bottomPoint","s1","s2","le1","le2","err","nextTagID","Tag","name","set","base","modified","mod","nameOrParent","parent","tag","Modifier","a","b","nextModifierID","mods","exists","sameArray","m","configs","powerSet","config","x","array","sets","e","styleTags","spec","byName","prop","tags","part","pieces","mode","rest","pos","next","last","inner","rule","Rule","ruleNodeProp","context","other","tagHighlighter","map","style","scope","all","cls","sub","tagClass","highlightTags","highlighters","result","highlighter","highlightTree","tree","putStyle","from","to","builder","HighlightBuilder","highlightCode","code","putText","putBreak","writeTo","p","classes","text","nextBreak","upto","at","span","cursor","inheritedClass","type","start","end","getStyleTags","tagCls","mounted","innerHighlighters","hasChild","nextPos","rangeFrom","rangeTo","node","comment","typeName","propertyName","literal","string","number","content","heading","keyword","operator","punctuation","bracket","meta","classHighlighter","inf$1","nan$1","Bool$1","Ignoring$1","On$1","GroupLeft$1","GroupRight$1","Offset$1","Atan2$1","Avg$1","Bottomk$1","Count$1","CountValues$1","Group$1","Max$1","Min$1","Quantile$1","LimitK$1","LimitRatio$1","Stddev$1","Stdvar$1","Sum$1","Topk$1","By$1","Without$1","And$1","Or$1","Unless$1","Start$1","End$1","keywordTokens","specializeIdentifier","stack","contextualKeywordTokens","extendIdentifier","promQLHighLight","spec_Identifier","parser","inf","nan","Bool","Ignoring","On","GroupLeft","GroupRight","Offset","Atan2","Avg","Bottomk","Count","CountValues","Group","Max","Min","Quantile","LimitK","LimitRatio","Stddev","Stdvar","Sum","Topk","By","Without","And","Or","Unless","Start","End","LineComment","PromQL","AggregateExpr","AggregateOp","AggregateModifier","GroupingLabels","LabelName","QuotedLabelName","StringLiteral","FunctionCallBody","BinaryExpr","Pow","BoolModifier","MatchingModifierClause","Mul","Div","Mod","Add","Sub","Eql","Gte","Gtr","Lte","Lss","Neq","FunctionCall","FunctionIdentifier","AbsentOverTime","Identifier","Absent","Abs","Acos","Acosh","Asin","Asinh","Atan","Atanh","AvgOverTime","Ceil","Changes","Clamp","ClampMax","ClampMin","Cos","Cosh","CountOverTime","DaysInMonth","DayOfMonth","DayOfWeek","DayOfYear","Deg","Delta","Deriv","Exp","Floor","HistogramCount","HistogramFraction","HistogramQuantile","HistogramStdDev","HistogramStdVar","HistogramSum","HistogramAvg","DoubleExponentialSmoothing","Hour","Idelta","Increase","Info","Irate","LabelReplace","LabelJoin","LastOverTime","Ln","Log10","Log2","MadOverTime","MaxOverTime","MinOverTime","Minute","Month","Pi","PredictLinear","PresentOverTime","QuantileOverTime","Rad","Rate","Resets","Round","Scalar","Sgn","Sin","Sinh","Sort","SortDesc","SortByLabel","SortByLabelDesc","Sqrt","StddevOverTime","StdvarOverTime","SumOverTime","Tan","Tanh","Timestamp","Time","Vector","Year","MatrixSelector","NumberDurationLiteralInDurationContext","NumberDurationLiteral","OffsetExpr","ParenExpr","SubqueryExpr","UnaryExpr","UnaryOp","VectorSelector","LabelMatchers","UnquotedLabelMatcher","MatchOp","EqlSingle","EqlRegex","NeqRegex","QuotedLabelMatcher","StepInvariantExpr","At","AtModifierPreprocessors","MetricName","PromVisualQueryOperationCategory","PromOperationId","PromQueryPatternType","functionRendererLeft","model","def","innerExpr","params","renderParams","str","functionRendererRight","rangeRendererWithParams","renderLeft","rangeVector","rangeRendererRightWithParams","rangeRendererLeftWithParams","index","defaultAddOperationHandler","newOperation","getPromOperationDisplayName","funcName","getRangeVectorParamDef","withRateInterval","createAggregationOperation","overrides","getOnLabelAddedHandler","getAggregationExplainer","getAggregationByRenderer","getLastLabelRemovedHandler","getAggregationWithoutRenderer","createAggregationOperationWithParam","paramsDef","operations","getAggregationByRendererWithParameter","aggregation","aggregationName","labelWord","restParamIndex","param","restParams","idx","changeToOperationId","op","isConflictingSelector","newLabel","operationIsNegative","candidate","binaryScalarDefs","binaryScalarOperatorToOperatorName","acc","binaryScalarOperations","opDef","defaultParams","getSimpleBinaryRenderer","bool","ErrorId","getLeftMostChild","cur","makeError","expr","getString","variableRegex","replaceVariables","replacedVariables","match","var1","var2","fmt2","var3","fieldPath","fmt3","fmt","variable","varType","replacement","varTypeFunc","v","returnVariables","makeBinOp","numberNode","hasBool","getAllByType","child","BUILT_IN_VARIABLES","variableToReplacement","replacementToVariable","builtInVariablePattern","builtInVariableRegex","builtInReplacementPattern","builtInReplacementRegex","replaceBuiltInVariable","returnBuiltInVariable","buildVisualQueryFromString","replacedExpr","handleExpression","isEmptyQuery","visQuery","strLiteral","quotedMetric","quotedLabel","getLabel","handleFunction","handleAggregation","handleBinary","isIntervalVariableError","labelType","rangeFunctions","nameNode","body","interval","updateFunctionArgs","modifier","binaryExpressionWithinFunctionArgs","identifierNode","customVarName","left","binModifier","getBinaryModifier","right","leftNumber","rightNumber","rightBinary","leftMostChild","binQuery","groupingLabels","prometheusRegularEscape","prometheusSpecialRegexEscape","RE2_METACHARACTERS","escapePrometheusRegexp","escapeLabelValueInExactSelector","labelValue","escapeLabelValueInRegexSelector","renderLabels","filter","usingRegexOperator","renderLabelsWithoutBrackets","renderedLabels","renderOperations","queryString","operationsRegistry","operation","hasBinaryOp","renderBinaryQueries","binaryQueries","renderBinaryQuery","leftOperand","binaryQuery","renderQuery","nested","hasNesting","hasBinaryOperation","rightOperand","renderNestedPart","vectorMatchingStr","renderedQuery","hasOps","hasNestedBinary","addLabelToQuery","vectorSelectorPositions","getVectorSelectorPositions","toLabelFilter","addFilter","positions","transformedValue","newQuery","prev","isLast","labelExists","newLabels","SUM_HINT_THRESHOLD_COUNT","getQueryHints","series","datasource","hints","metricsMetadata","simpleQueryCheck","queryTokens","getQueryTokens","nameMetric","checkMetricType","nameMatch","counterNameMetric","certain","metricTypeChecked","fixableQuery","fix","expandQueryHints","getExpandRulesHints","getInitHints","isRuleInQuery","ruleName","mapping","mappingForQuery","expandedQuery","identifier","identifierValue","getRecordingRuleIdentifierIdx","queryStr","queryMetricLabels","getQueryLabelsForRuleName","uuidLabel","uuidLabelValue","uuidLabelIdx","qml","mp","token","metricType","metadata","isCancelablePromiseRejection","promise","makePromiseCancelable","hasCanceled_","resolve","reject","canceledPromiseRejection","error","buildSelector","selectedMetric","selectedLabelValues","selectorParts","useMetricsLabelsValues","timeRange","languageProvider","timeRangeRef","lastSeriesLimitRef","isInitializedRef","seriesLimit","setSeriesLimit","setErr","status","setStatus","validationStatus","setValidationStatus","metrics","setMetrics","setSelectedMetric","labelKeys","setLabelKeys","selectedLabelKeys","setSelectedLabelKeys","lastSelectedLabelKey","setLastSelectedLabelKey","labelValues","setLabelValues","setSelectedLabelValues","effectiveLimit","handleError","msg","getMetricDetails","buildSafeSelector","selector","loadSelectedLabelsFromStorage","availableLabelKeys","labelKeysInLocalStorageAsString","slk","fetchMetrics","safeSelector","fetchLabelKeys","fetchLabelValues","transformedLabelValues","newSelectedLabelValues","lk","initialize","transformedMetrics","transformedLabelKeys","labelKeysInLocalStorage","useDebounce","newSelectedMetric","fetchedMetrics","fetchedLabelKeys","newSelectedLabelKeys","labelKey","lkIdx","newLabelValues","isSelected","newLastSelectedLabelKey","fetchedLabelValues","item","newMetrics","newLabelKeys","labelKeysSelector","results","MetricsBrowserContext","MetricsBrowserProvider","children","onChange","handleSelectedMetricChange","handleSelectedLabelKeyChange","handleSelectedLabelValueChange","handleValidation","handleClear","getSelector","useMetricsBrowser","getStylesMetricsBrowser","theme","getStylesMetricSelector","getStylesLabelSelector","getStylesValueSelector","getStylesSelectorActions","LabelSelector","styles","labelSearchTerm","setLabelSearchTerm","onLabelKeyClick","filteredLabelKeys","Label","Input","selectors","MetricSelector","metricSearchTerm","setMetricSearchTerm","onMetricClick","filteredMetrics","SelectorActions","onValidationClick","onClearClick","onClickRunQuery","onClickRunRateQuery","empty","Stack","Button","ValueSelector","valueSearchTerm","setValueSearchTerm","onLabelValueClick","lv","MetricsBrowser","promLanguageDefinition","makeStorageService","strings","fallbackValue","reason","overrideServices","getOverrideServices","CODE_MODE_SUGGESTIONS_INCOMPLETE_EVENT","isSuggestionsIncompleteEvent","DataProvider","metricNames","metaItem","textInput","NeverCaseError","InsertAsSnippet","metricNamesSearch","snippetMarker","filterMetricNames","inputText","limit","fuzzyResults","getAllMetricNamesCompletions","dataProvider","monacoSettings","FUNCTION_COMPLETIONS","getAllFunctionsAndMetricNamesCompletions","DURATION_COMPLETIONS","getAllHistoryCompletions","makeSelector","allLabels","getLabelNames","otherLabels","labelNames","usedLabelNames","getLabelNamesForCompletions","suffix","triggerOnInsert","isUtf8","getLabelNamesForSelectorCompletions","getLabelNamesForByCompletions","getLabelValues","labelName","getLabelValuesForMetricCompletions","betweenQuotes","formatLabelValueForCompletion","getCompletions","situation","historyCompletions","move","direction","walk","path","current","expectedType","getNodeText","utf8","nodeFrom","nodeTo","parsePromQLStringLiteral","inside","isPathMatch","resolverPath","cursorPath","ERROR_NODE_NAME","RESOLVERS","resolveLabelKeysWithEquals","resolveUtf8LabelKeysWithEquals","resolveTopLevel","resolveInFunction","resolveLabelMatcher","resolveQuotedLabelMatcher","resolveDurations","resolveLabelsForGrouping","LABEL_OP_MAP","getLabelOp","opNode","opChild","labelMatcherNode","valueNode","getLabels","labelMatchersNode","matcher","ln","notEmpty","getNodeChildren","getNodeInSubtree","typeId","aggrExpNode","bodyNode","metricIdNode","inStringNode","labelNameNode","getMetricName","legacyMetricNameNode","utf8MetricNameNode","getErrorNode","getSituation","maybeErrorNode","currentNode","ids","resolver","getSuggestOptions","getMonacoCompletionItemKind","monaco","getCompletionProvider","position","word","range","positionClone","selectedText","offset","items","maxIndexDigits","warningTypes","NodeType","validateQuery","interpolatedQuery","queryLines","interpolatedErrors","interpolatedWarnings","parseQuery","parseErrors","parseWarnings","queryErrors","queryWarnings","interpolatedError","queryError","interpolatedWarning","queryWarning","errorBoundaries","parseError","findIssueBoundary","isValidIssueBoundary","warningBoundaries","parseWarning","nodeRef","durations","issueType","isEmptyString","errorNode","issue","startPos","endPos","line","boundary","placeHolderScopedVars","languageConfiguration","aggregations","functions","aggregationsOverTime","_i","aggregations_1","agg","vectorMatching","vectorMatchingRegex","curr","operators","offsetModifier","language","EDITOR_HEIGHT_OFFSET","PROMQL_LANG_ID","PROMQL_SETUP_STARTED","ensurePromQL","aliases","extensions","mimetypes","getStyles","placeholder","props","id","overrideServicesRef","containerRef","history","onBlur","onRunQuery","initialValue","lpRef","useLatest","historyRef","onRunQueryRef","onBlurRef","autocompleteDisposeFun","editor","isEditorFocused","completionProvider","filteringCompletionProvider","dispose","updateElementHeight","containerDiv","pixelHeight","pixelWidth","placeholderDecorators","decorators","checkDecorators","newDecorators","errors","warnings","errorMarkers","warningMarkers","MonacoQueryFieldLazy","MonacoQueryFieldWrapper","lastRunValueRef","handleRunQuery","handleBlur","getChooserText","metricsLookupDisabled","hasSyntax","hasMetrics","useMetricsState","syntaxLoaded","chooserText","PrometheusCacheLevel","PromApplication","LegendFormatMode","PromVariableQueryType","getDebounceTimeInMilliseconds","cacheLevel","getDaysToCacheMetadata","getCacheDurationInMinutes","buildCacheHeaders","durationInSeconds","getDefaultCacheHeaders","processHistogramMetrics","resultSet","regexp","processLabels","withName","valueSet","__name__","valueArray","limitSuggestions","selectorRegexp","labelRegexp","parseSelector","cursorOffset","prefix","prefixOpen","prefixClose","suffixClose","suffixOpenIndex","suffixOpen","labelOffset","valueStart","valueEnd","metricMatch","selectorString","expandRecordingRules","getRuleRegex","tmpSplitParts","parts","tmpParts","removeIdx","ri","labelFound","tsp","recordingRule","invalidLabelsRegex","addLabelsToExpression","invalidLabelsRegexp","indexOfRegexMatch","exprBeforeRegexMatch","exprAfterRegexMatch","arrayOfLabelObjects","comma","space","obj","existingLabel","potentialLeftOver","fixSummariesMetadata","baseMetadata","summaryMetadata","syntheticMetadata","roundMsToMin","milliseconds","roundSecToMin","seconds","roundSecToNextMin","secondsToRound","addLimitInfo","FromPromLikeMap","ToPromLikeMap","toPromLikeExpr","labelBasedQuery","toPromLikeQuery","getMaybeTokenStringContent","extractLabelMatchers","tokens","labelMatchers","labelOperator","contentTokens","currentToken","currentStr","labelComparator","getRangeSnapInterval","getPrometheusTime","startTime","startTimeQuantizedSeconds","endTime","endTimeQuantizedSeconds","endTimePlusOneStep","date","roundUp","truncateResult","usePromQueryFieldEffects","refreshMetrics","refreshHint","lastRangeRef","languageProviderInitRef","currentFrom","currentTo","lastFrom","lastTo","PromQueryField","app","ExtraFieldElement","setSyntaxLoaded","hint","setHint","labelBrowserVisible","setLabelBrowserVisible","updateLanguage","initialization","remainingTasks","initHint","queryHints","queryHint","onChangeQuery","override","nextQuery","onChangeLabelBrowser","onClickChooserButton","onClickHintFix","buttonDisabled","Icon","OperationExplainedBox","title","stepNumber","markdown","RawQuery","lang","className","highlighted","OperationListExplained","queryModeller","onMouseEnter","onMouseLeave","getOperationDefinitions","createFunction","createRangeFunction","addOperationWithRangeVector","operationTypeChangedHandlerForRangeFunction","addNestedQueryHandler","labelJoinRenderer","labelJoinExplainHandler","labelJoinAddOperationHandler","definition","operationWithRangeVectorRenderer","newDef","modeller","paramZero","separator","explainMessage","getAggregationOperations","createAggregationOverTime","LokiAndPromQueryModellerBase","getOperations","Registry","categories","category","PromQueryModeller","allOperations","func","promQueryModeller","EXPLAIN_LABEL_FILTER_CONTENT","PromQueryBuilderExplained","promql","PromQueryCodeEditor","showExplain","PLACEHOLDER_TITLE","PLACEHOLDER_TEXT","PLACEHOLDER_TAGS","AnnotationQueryEditor","annotation","onAnnotationChange","handleMinStepChange","handleTitleChange","handleTagsChange","handleTextChange","handleUseValueForTimeChange","checked","EditorRows","EditorRow","EditorField","AutoSizeInput","Space","event","EditorSwitch","ANNOTATION_QUERY_STEP_DEFAULT","PrometheusAnnotationSupport","ds","json","anno","Observable","tagKeys","titleFormat","textFormat","input","regex","stepValue","step","tagKeysArray","eventList","timeValueTuple","timeStampValue","valueValue","time","activeValuesTimestamps","latestEvent","timestamp","of","BaseResourceClient","effectiveMatch","searchParams","url","LabelsApiClient","ResourceClientsCache","timeParams","maybeCachedKeys","res","interpolatedName","interpolatedAndEscapedName","removeQuotesIfExist","maybeCachedValues","SeriesApiClient","processSeries","metricFilter","labelFilters","lf","keys","cacheKey","snappedTimeRange","currentEntries","entriesToRemove","size","count","timestamp1","timestamp2","findValuesForKey","DEFAULT_KEYS","API_V1","PromQlLanguageProvider","initialValues","isCancelledError","queries","q","visualQuery","isUtf8Metric","bq","requestId","withLimit","interpolatedMatch","urlParams","requestOptions","possibleLabelNames","ac","scopes","adhocFilters","headers","PrometheusLanguageProvider","importFromAbstractQuery","exportToAbstractQuery","promQuery","nameLabelValue","getNameLabelValue","populateMatchParamsFromQueries","PrometheusLabelNamesRegex","PrometheusLabelValuesRegex","PrometheusMetricNamesRegex","PrometheusQueryResultRegex","PrometheusLabelNamesRegexWithMatch","migrateVariableQueryToEditor","rawQuery","queryBase","labelNamesMatchQuery","labelValuesCheck","metricNamesCheck","queryResultCheck","queryResult","varQuery","migrateVariableEditorBackToVariableSupport","QueryVariable","visualQueryQuery","removeLineBreaks","PrometheusMetricFindQuery","labelNamesRegex","labelNamesRegexWithMatch","labelValuesRegex","metricNamesRegex","queryResultRegex","labelNamesQuery","labelValuesQuery","isFilterDefined","metricNamesQuery","queryResultQuery","metricFilterPattern","metricData","k","defaultPrometheusQueryOverlapWindow","getFieldIdentity","QueryCache","scopedVars","unverifiedOverlap","duration","newFrom","newTo","shouldCache","doPartialQuery","prevTo","reqTargetSignatures","targetIdentity","targetSignature","cached","newFromPartial","newToDate","newFromPartialDate","targSig","targIdent","requestInfo","respFrames","respByTarget","targetIdent","outFrames","cachedFrames","respFrame","respFrameIdentity","cachedFrame","prevTable","nextTable","amendedTable","nonEmptyCachedFrames","table","dataPointStep","findDatapointStep","trimmed","applyInterpolation","minStepMs","trackQuery","LabelFilterItem","defaultOp","onDelete","onGetLabelNames","onGetLabelValues","invalidLabel","invalidValue","getLabelValuesAutofillSuggestions","debounceDuration","state","setState","labelNamesMenuOpen","setLabelNamesMenuOpen","labelValuesMenuOpen","setLabelValuesMenuOpen","setAllLabels","isMultiSelect","getSelectOptionsFromString","regExp","matches","labelValueSearch","labelNamesSearch","itemValue","InputGroup","truncatedLabelNames","change","Select","changes","AccessoryButton","MISSING_LABEL_FILTER_ERROR_MESSAGE","LabelFilters","labelsFilters","labelFilterRequired","variableEditor","setItems","onLabelsChange","newItems","hasLabelFilter","editorList","EditorList","onChangeItem","InlineFieldRow","InlineLabel","EditorFieldGroup","metricsModaltestIds","DEFAULT_RESULTS_PER_PAGE","MAXIMUM_RESULTS_PER_PAGE","initialState","getSettings","stateSlice","action","setIsLoading","buildMetrics","filterMetricsBackend","setResultsPerPage","setPageNum","setFuzzySearchQuery","setNameHaystack","setMetaHaystack","setFullMetaSearch","setIncludeNullMetadata","setSelectedTypes","setUseBackend","setDisableTextWrap","showAdditionalSettings","setFilteredMetricCount","initialMetrics","hasMetadata","nameHaystackDictionaryData","metaHaystackDictionaryData","metricsData","buildMetricData","metaDataString","getMetadataType","description","getMetadataHelp","oldHistogramMatch","displayedMetrics","dispatch","filteredSorted","filterMetrics","sliceMetrics","needle","calculatePageList","calcResultsPerPage","pages","pageNum","resultsPerPage","calculateResultsPerPage","defaultResults","max","getBackendSearchMetrics","metricText","labelsParams","tracking","promTypes","placeholders","AdditionalSettings","onChangeFullMetaSearch","onChangeIncludeNullMetadata","onChangeDisableTextWrap","onChangeUseBackend","Switch","Tooltip","FeedbackLink","feedbackUrl","docsTip","TextLink","validateInput","pattern","errorMessage","defaultErrorMessage","inputTooLongErrorMessage","validationTimeoutErrorMessage","invalidValidationPatternErrorMessage","timeout","isValid","overhaulStyles","ResultsTable","onClose","disableTextWrap","selectMetric","metaRows","displayType","addHelpIcon","fullType","descriptiveType","link","noMetricsMessages","message","textHighlight","uf","uFuzzy","fuzzySearch","haystack","dispatcher","idxs","info","order","haystackOrder","matchesSet","mark","matched","infoIdx","debouncedFuzzySearch","MetricsModal","isOpen","updateMetricsMetadata","typeOptions","debouncedBackendSearch","filterArray","formatPrometheusLabelFilters","resultsOptions","fuzzyNameDispatch","haystackData","fuzzyMetaDispatch","searchCallback","fullMetaSearchVal","additionalSettings","newVal","Modal","Spinner","Toggletip","ButtonGroup","Pagination","MetricCombobox","onGetMetrics","metricsModalOpen","setMetricsModalOpen","getMetricLabels","formatKeyValueStrings","onComboboxChange","opt","loadOptions","option","loadMetricsExplorerMetrics","allMetrics","asyncSelect","Combobox","InlineField","formatPrometheusLabelFiltersToString","MetricsLabelsSection","onChangeLabels","withTemplateVariableOptions","optionsPromise","variables","forLabel","labelsToConsider","getLabelValuesAutocompleteSuggestions","interpolatedLabelsToConsider","labelObject","toSelectableValue","getMetrics","getMetadataString","help","variableOptions","PromVariableQueryEditor","qryType","setQryType","setLabel","labelNamesMatch","setLabelNamesMatch","setMetric","setVarQuery","seriesQuery","setSeriesQuery","classicQuery","setClassicQuery","truncatedLabelOptions","setTruncatedLabelOptions","allLabelOptions","setAllLabelOptions","setLabels","names","truncatedNames","setLabelFilters","variableQuery","variableMigration","labelToConsider","onChangeWithVariableString","updateVar","updLabelFilters","updatedVar","onQueryTypeChange","newType","onLabelChange","newLabelvalue","metricsLabelsChange","update","updMetric","onLabelNamesMatchChange","onMetricChange","onVarQueryChange","onSeriesQueryChange","onClassicQueryChange","promVisualQuery","TextArea","PrometheusVariableSupport","templateSrv","interpolated","metricFindQuery","PrometheusDatasource","DataSourceWithBackend","instanceSettings","ruleGroups","extractRuleMappingFromGroups","targetVersion","targetFlavor","httpOptions","throwError","queryUrl","abstractQueries","abstractQuery","endpoint","lastValueFrom","escapedValues","currentTargetIdx","targets","utcOffset","processedTargets","processedTarget","fullOrPartialRequest","hasInstantQuery","amendedResponse","tap","msRange","sRange","extractResourceMatcher","filters","expandedQueries","replacedInterpolatedQuery","expression","exprWithAdhoc","fromExploreMetrics","defaults","groups","group","existingRule","labelsMatch","QueryPattern","onPatternSelect","hasNewQueryOption","hasPreviousQuery","selectedPatternName","setSelectedPatternName","Card","QueryPatternsModal","onAddQuery","openTabs","setOpenTabs","hasOperations","hasMetric","hasLabels","hasBinaryQueries","selectAsNewQuery","renderedExpr","patternType","Collapse","tabs","promQueryEditorExplainKey","getFlagValue","defaultValue","store","setFlagValue","useFlag","flag","updateFlag","setter","QueryEditorMode","QueryEditorModeToggle","editorModes","RadioButtonGroup","QueryHeaderSwitch","inputProps","dashedLabel","switchIdRef","queryEditorModeDefaultLocalStorageKey","changeEditorMode","editorMode","getDefaultEditorMode","defaultEditor","getQueryWithDefaults","isBothInstantAndRange","OperationInfoButton","show","setShow","middleware","refs","floatingStyles","click","dismiss","getReferenceProps","getFloatingProps","Portal","FlexItem","getOperationDocs","OperationHeader","onRemove","dragHandleProps","onToggleSwitcher","alternatives","alt","newParams","changedOp","getOperationParamId","operationId","paramIndex","LabelParamEditor","loadGroupByLabels","editorMap","getOperationParamEditor","paramDef","SimpleInputParamEditor","SelectInputParamEditor","BoolInputParamEditor","evt","Checkbox","selectOptions","valueOption","OperationEditor","flash","highlight","shouldFlash","useFlash","onParamValueChanged","paramIdx","callParamChangedThenOnChange","onAddRestParam","onRemoveRestParam","operationElements","Editor","restParam","lastParamDef","renderAddRestParamButton","provided","keepFlash","setKeepFlash","operationIndex","OperationList","highlightedOp","opsToHighlight","useOperationsHighlight","cascaderOpen","setCascaderOpen","onOperationChange","updatedList","addOptions","onAddOperation","operationDef","onDragEnd","element","onCascaderBlur","Cascader","isMounted","useMountedState","prevOperations","usePrevious","newOps","newOp","isSameOp","op1","op2","OperationsEditorRow","QueryBuilderHints","setHints","newVisualQuery","QueryBuilderContent","setHighlightedOp","initHints","NestedQuery","nestedQuery","IconButton","NestedQueryList","nestedQueries","onNestedQueryUpdate","BaseQueryBuilder","PromQueryBuilder","QueryPreview","PromQueryBuilderContainer","exprChanged","setMetricsModalSettings","onVisQueryChange","visualQueryChange","metricsModalSettings","parseResult","PromExemplarField","setError","prevError","iconButtonStyles","PromExploreExtraField","rangeOptions","getQueryTypeOptions","prevQuery","onExemplarChange","exemplar","onChangeQueryStep","onStepChange","onReturnKeyDown","getQueryTypeChangeHandler","promExploreExtraFieldTestIds","includeBoth","queryType","QueryOptionGroup","collapsedInfo","toggleOpen","useToggle","getLegendModeOptions","PromQueryLegendEditor","legendFormat","getLegendMode","inputRef","legendModeOptions","onLegendFormatChanged","newFormat","onLegendModeChanged","getLegendModeLabel","INTERVAL_FACTOR_OPTIONS","PromQueryBuilderOptions","FORMAT_OPTIONS","onChangeFormat","onChangeStep","queryTypeOptions","isEnabled","onIntervalFactorChange","formatOption","queryTypeValue","getQueryTypeValue","queryTypeLabel","getCollapsedInfo","shouldShowExemplarSwitch","PromQueryCodeEditorAutocompleteInfo","autocompleteLimit","setAutocompleteLimit","autocompleteLimitExceeded","setAutocompleteLimitExceeded","handleSuggestionsIncompleteEvent","Text","PromQueryEditorSelector","parseModalOpen","setParseModalOpen","queryPatternsModalOpen","setQueryPatternsModalOpen","dataIsStale","setDataIsStale","explain","setExplain","onEditorModeChange","newMetricEditorMode","onChangeInternal","onShowExplainChange","handleOpenQueryPatternsModal","ConfirmModal","EditorHeader","PromQueryEditorForAlerting","alertingTestIds","PromQueryEditorByAppBase","PromQueryEditorByApp","CHEAT_SHEET_ITEMS","PromCheatSheet","AzureCloud","AzureCloud2","predefinedClouds","getAzureClouds","settingsEx","getDefaultAzureCloud","resolveLegacyCloudName","cloudName","instanceOfAzureCredential","authType","object","concealed","concealedLegacy","isCredentialsComplete","credentials","ignoreSecret","getClientSecret","secret","getAdPassword","getDatasourceCredentials","oboEnabled","serviceCredentials","updateDatasourceCredentials","clientSecret","hasCredentials","ResourceTypes","MetricsSupportedTypes","AlertingSettingsOverhaul","onOptionsChange","ConfigSubSection","ExemplarSetting","disabled","isInternalLink","setIsInternalLink","ev","DataSourcePicker","ExemplarsSettings","newField","newOptions","PromFlavorVersions","cacheValueOptions","prometheusFlavorSelectItems","getOptionsWithDefaults","PromSettings","editorOptions","optionsWithDefaults","validDuration","updateValidDuration","validCount","updateValidCount","onChangeHandler","o","exemplarOptions","getValueFromEventItem","eventItem","getAzureCloudOptions","cloud","getDefaultCredentials","getCredentials","updateCredentials","setDefaultCredentials","resetCredentials","AzureCredentialsForm","azureCloudOptions","onCredentialsChange","managedIdentityEnabled","workloadIdentityEnabled","authTypeOptions","opts","onAuthTypeChange","selected","defaultAuthType","updated","onAzureCloudChange","onTenantIdChange","onClientIdChange","onClientSecretChange","onClientSecretReset","AzureAuthSettings","dataSourceConfig","overrideAudienceAllowed","overrideAudienceChecked","setOverrideAudienceChecked","onOverrideAudienceChange","onResourceIdChange","useEffectOnce","DataSourcehttpSettingsOverhaul","azureAuthSettings","sigV4AuthToggleEnabled","renderSigV4Editor","secureSocksDSProxyEnabled","newAuthProps","customMethods","sigV4Selected","setSigV4Selected","sigV4Id","sigV4Option","azureAuthEnabled","azureAuthSelected","setAzureAuthSelected","azureAuthId","azureAuthOption","returnSelectedMethod","urlTooltip","ConnectionSettings","Alert","Auth","method","SecureSocksProxySettings","PROM_CONFIG_LABEL_WIDTH","ConfigEditor","enabled","DataSourceDescription","ConfigSection","AdvancedHttpSettings","ref","getButtonStyles","renderItem","onAddItem","itemIndex","newItem","onDeleteItem","grow","shrink","modifiedChildren","borderPriority"],"sourceRoot":""}