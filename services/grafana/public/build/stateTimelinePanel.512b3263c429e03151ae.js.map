{"version":3,"file":"stateTimelinePanel.512b3263c429e03151ae.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/panel/state-timeline/StateTimelinePanel.tsx","webpack://grafana/./public/app/plugins/panel/state-timeline/migrations.ts","webpack://grafana/./public/app/plugins/panel/state-timeline/suggestions.ts","webpack://grafana/./public/app/plugins/panel/state-timeline/module.tsx"],"sourcesContent":["import { useMemo, useState } from 'react';\n\nimport { DashboardCursorSync, PanelProps } from '@grafana/data';\nimport { PanelDataErrorView } from '@grafana/runtime';\nimport {\n  AxisPlacement,\n  EventBusPlugin,\n  TooltipDisplayMode,\n  TooltipPlugin2,\n  usePanelContext,\n  useTheme2,\n} from '@grafana/ui';\nimport { TimeRange2, TooltipHoverMode } from '@grafana/ui/internal';\nimport { TimelineChart } from 'app/core/components/TimelineChart/TimelineChart';\nimport {\n  prepareTimelineFields,\n  prepareTimelineLegendItems,\n  TimelineMode,\n} from 'app/core/components/TimelineChart/utils';\n\nimport { AnnotationsPlugin2 } from '../timeseries/plugins/AnnotationsPlugin2';\nimport { OutsideRangePlugin } from '../timeseries/plugins/OutsideRangePlugin';\nimport { getTimezones } from '../timeseries/utils';\n\nimport { StateTimelineTooltip2 } from './StateTimelineTooltip2';\nimport { Options } from './panelcfg.gen';\nimport { containerStyles, usePagination } from './utils';\n\ninterface TimelinePanelProps extends PanelProps<Options> {}\n\n/**\n * @alpha\n */\nexport const StateTimelinePanel = ({\n  data,\n  timeRange,\n  timeZone,\n  options,\n  width,\n  height,\n  fieldConfig,\n  replaceVariables,\n  onChangeTimeRange,\n  id: panelId,\n}: TimelinePanelProps) => {\n  const theme = useTheme2();\n\n  // temp range set for adding new annotation set by TooltipPlugin2, consumed by AnnotationPlugin2\n  const [newAnnotationRange, setNewAnnotationRange] = useState<TimeRange2 | null>(null);\n  const { sync, eventsScope, canAddAnnotations, dataLinkPostProcessor, eventBus } = usePanelContext();\n  const cursorSync = sync?.() ?? DashboardCursorSync.Off;\n\n  const { frames, warn } = useMemo(\n    () => prepareTimelineFields(data.series, options.mergeValues ?? true, timeRange, theme),\n    [data.series, options.mergeValues, timeRange, theme]\n  );\n\n  const { paginatedFrames, paginationRev, paginationElement, paginationHeight } = usePagination(\n    frames,\n    options.perPage\n  );\n\n  const legendItems = useMemo(\n    () => prepareTimelineLegendItems(paginatedFrames, options.legend, theme),\n    [paginatedFrames, options.legend, theme]\n  );\n\n  const timezones = useMemo(() => getTimezones(options.timezone, timeZone), [options.timezone, timeZone]);\n\n  if (!paginatedFrames || typeof warn === 'string') {\n    return <PanelDataErrorView panelId={panelId} fieldConfig={fieldConfig} data={data} message={warn} needsTimeField />;\n  }\n\n  const enableAnnotationCreation = Boolean(canAddAnnotations && canAddAnnotations());\n\n  return (\n    <div className={containerStyles.container}>\n      <TimelineChart\n        theme={theme}\n        frames={paginatedFrames}\n        structureRev={data.structureRev}\n        paginationRev={paginationRev}\n        timeRange={timeRange}\n        timeZone={timezones}\n        width={width}\n        height={height - paginationHeight}\n        legendItems={legendItems}\n        {...options}\n        mode={TimelineMode.Changes}\n        replaceVariables={replaceVariables}\n        dataLinkPostProcessor={dataLinkPostProcessor}\n        cursorSync={cursorSync}\n      >\n        {(builder, alignedFrame) => {\n          return (\n            <>\n              {cursorSync !== DashboardCursorSync.Off && (\n                <EventBusPlugin config={builder} eventBus={eventBus} frame={alignedFrame} />\n              )}\n              {options.tooltip.mode !== TooltipDisplayMode.None && (\n                <TooltipPlugin2\n                  config={builder}\n                  hoverMode={\n                    options.tooltip.mode === TooltipDisplayMode.Multi ? TooltipHoverMode.xAll : TooltipHoverMode.xOne\n                  }\n                  queryZoom={onChangeTimeRange}\n                  syncMode={cursorSync}\n                  syncScope={eventsScope}\n                  getDataLinks={(seriesIdx, dataIdx) =>\n                    alignedFrame.fields[seriesIdx].getLinks?.({ valueRowIndex: dataIdx }) ?? []\n                  }\n                  render={(u, dataIdxs, seriesIdx, isPinned, dismiss, timeRange2, viaSync, dataLinks) => {\n                    if (enableAnnotationCreation && timeRange2 != null) {\n                      setNewAnnotationRange(timeRange2);\n                      dismiss();\n                      return;\n                    }\n\n                    const annotate = () => {\n                      let xVal = u.posToVal(u.cursor.left!, 'x');\n\n                      setNewAnnotationRange({ from: xVal, to: xVal });\n                      dismiss();\n                    };\n\n                    return (\n                      <StateTimelineTooltip2\n                        series={alignedFrame}\n                        dataIdxs={dataIdxs}\n                        seriesIdx={seriesIdx}\n                        mode={viaSync ? TooltipDisplayMode.Multi : options.tooltip.mode}\n                        sortOrder={options.tooltip.sort}\n                        isPinned={isPinned}\n                        timeRange={timeRange}\n                        annotate={enableAnnotationCreation ? annotate : undefined}\n                        withDuration={true}\n                        maxHeight={options.tooltip.maxHeight}\n                        replaceVariables={replaceVariables}\n                        dataLinks={dataLinks}\n                      />\n                    );\n                  }}\n                  maxWidth={options.tooltip.maxWidth}\n                />\n              )}\n              {alignedFrame.fields[0].config.custom?.axisPlacement !== AxisPlacement.Hidden && (\n                <AnnotationsPlugin2\n                  annotations={data.annotations ?? []}\n                  config={builder}\n                  timeZone={timeZone}\n                  newRange={newAnnotationRange}\n                  setNewRange={setNewAnnotationRange}\n                  canvasRegionRendering={false}\n                />\n              )}\n              <OutsideRangePlugin config={builder} onChangeTimeRange={onChangeTimeRange} />\n            </>\n          );\n        }}\n      </TimelineChart>\n      {paginationElement}\n    </div>\n  );\n};\n","import { isArray } from 'lodash';\n\nimport { FieldConfigSource, MappingType, PanelModel, ValueMap, RangeMap, ValueMapping } from '@grafana/data';\n\nimport { FieldConfig, Options } from './panelcfg.gen';\n\n// This is called when the panel changes from another panel\nexport const timelinePanelChangedHandler = (\n  panel: PanelModel<Partial<Options>> | any,\n  prevPluginId: string,\n  prevOptions: any\n) => {\n  let options: Options = panel.options ?? {};\n\n  // Changing from angular singlestat\n  if (prevPluginId === 'natel-discrete-panel' && prevOptions.angular) {\n    const oldOptions = prevOptions.angular;\n    const fieldConfig: FieldConfigSource = panel.fieldConfig ?? { defaults: {}, overrides: [] };\n\n    if (oldOptions.units) {\n      fieldConfig.defaults.unit = oldOptions.units;\n    }\n\n    const custom: FieldConfig = {\n      fillOpacity: 100,\n      lineWidth: 0,\n    };\n    fieldConfig.defaults.custom = custom;\n    options.mergeValues = true;\n\n    // Convert mappings\n    const valuemap: ValueMap = { type: MappingType.ValueToText, options: {} };\n    fieldConfig.defaults.mappings = [valuemap];\n\n    if (isArray(oldOptions.colorMaps)) {\n      for (const p of oldOptions.colorMaps) {\n        const color: string = p.color;\n        if (color) {\n          valuemap.options[p.text] = { color };\n        }\n      }\n    }\n\n    if (isArray(oldOptions.valueMaps)) {\n      for (const p of oldOptions.valueMaps) {\n        const text: string = p.text;\n        const value: string = p.value;\n        if (text && value) {\n          let old = valuemap.options[value];\n          if (old) {\n            old.text = text;\n          } else {\n            valuemap.options[value] = { text };\n          }\n        }\n      }\n    }\n\n    if (isArray(oldOptions.rangeMaps)) {\n      for (const p of oldOptions.rangeMaps) {\n        let from = +p.from;\n        let to = +p.to;\n        const text: string = p.text;\n        if (text) {\n          fieldConfig.defaults.mappings.push({\n            type: MappingType.RangeToText,\n            options: {\n              from,\n              to,\n              result: { text },\n            },\n          });\n        }\n      }\n    }\n\n    if (fieldConfig.defaults.mappings?.length) {\n      fieldConfig.defaults.mappings = expandColorMappings(fieldConfig.defaults.mappings);\n    }\n\n    // mutates the input\n    panel.fieldConfig = fieldConfig;\n  }\n\n  return options;\n};\n\nfunction expandColorMappings(mappings: ValueMapping[]): ValueMapping[] {\n  let keyToColor: Record<string, string> = {};\n  for (const m of mappings) {\n    if (isValueToText(m)) {\n      for (const key in m.options) {\n        const target = m.options[key];\n        if (target.color?.length) {\n          keyToColor[key] = target.color;\n        }\n      }\n    } else if (isRangeMap(m)) {\n      const { text, color } = m.options.result;\n      if (text?.length && color?.length && !keyToColor[text]) {\n        keyToColor[text] = color;\n      }\n    }\n  }\n\n  // Set a color for values that match\n  return mappings.map((m) => {\n    if (isValueToText(m)) {\n      for (const key in m.options) {\n        const target = m.options[key];\n        if (!target.color?.length) {\n          let c = keyToColor[key];\n          if (!c && target.text) {\n            c = keyToColor[target.text];\n          }\n          if (c) {\n            target.color = c; // link the mapped color\n          }\n        }\n      }\n    } else if (isRangeMap(m)) {\n      const { text, color } = m.options.result;\n      if (!color && text && keyToColor[text]) {\n        m.options.result.color = keyToColor[text];\n      }\n    }\n    return m;\n  });\n}\n\nfunction isValueToText(m: ValueMapping): m is ValueMap {\n  return m.type === MappingType.ValueToText;\n}\n\nfunction isRangeMap(m: ValueMapping): m is RangeMap {\n  return m.type === MappingType.RangeToText;\n}\n","import { VisualizationSuggestionsBuilder } from '@grafana/data';\nimport { SuggestionName } from 'app/types/suggestions';\n\nimport { FieldConfig, Options } from './panelcfg.gen';\n\nexport class StatTimelineSuggestionsSupplier {\n  getSuggestionsForData(builder: VisualizationSuggestionsBuilder) {\n    const { dataSummary: ds } = builder;\n\n    if (!ds.hasData) {\n      return;\n    }\n\n    // This panel needs a time field and a string or number field\n    if (!ds.hasTimeField || (!ds.hasStringField && !ds.hasNumberField)) {\n      return;\n    }\n\n    // If there are many series then they won't fit on y-axis so this panel is not good fit\n    if (ds.numberFieldCount >= 30) {\n      return;\n    }\n\n    // Probably better ways to filter out this by inspecting the types of string values so view this as temporary\n    if (ds.preferredVisualisationType === 'logs') {\n      return;\n    }\n\n    const list = builder.getListAppender<Options, FieldConfig>({\n      name: '',\n      pluginId: 'state-timeline',\n      options: {},\n      fieldConfig: {\n        defaults: {\n          custom: {},\n        },\n        overrides: [],\n      },\n    });\n\n    list.append({ name: SuggestionName.StateTimeline });\n  }\n}\n","import {\n  FieldColorModeId,\n  FieldConfigProperty,\n  FieldType,\n  identityOverrideProcessor,\n  PanelPlugin,\n} from '@grafana/data';\nimport { t } from '@grafana/i18n';\nimport { AxisPlacement, VisibilityMode } from '@grafana/schema';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { InsertNullsEditor } from '../timeseries/InsertNullsEditor';\nimport { SpanNullsEditor } from '../timeseries/SpanNullsEditor';\nimport { NullEditorSettings } from '../timeseries/config';\n\nimport { StateTimelinePanel } from './StateTimelinePanel';\nimport { timelinePanelChangedHandler } from './migrations';\nimport { defaultFieldConfig, defaultOptions, FieldConfig, Options } from './panelcfg.gen';\nimport { StatTimelineSuggestionsSupplier } from './suggestions';\n\nexport const plugin = new PanelPlugin<Options, FieldConfig>(StateTimelinePanel)\n  .setPanelChangeHandler(timelinePanelChangedHandler)\n  .useFieldConfig({\n    standardOptions: {\n      [FieldConfigProperty.Color]: {\n        settings: {\n          byValueSupport: true,\n        },\n        defaultValue: {\n          mode: FieldColorModeId.ContinuousGrYlRd,\n        },\n      },\n      [FieldConfigProperty.Links]: {\n        settings: {\n          showOneClick: true,\n        },\n      },\n      [FieldConfigProperty.Actions]: {\n        hideFromDefaults: false,\n      },\n    },\n    useCustomConfig: (builder) => {\n      const category = [t('state-timeline.category-state-timeline', 'State timeline')];\n      builder\n        .addSliderInput({\n          path: 'lineWidth',\n          name: t('state-timeline.name-line-width', 'Line width'),\n          category,\n          defaultValue: defaultFieldConfig.lineWidth,\n          settings: {\n            min: 0,\n            max: 10,\n            step: 1,\n          },\n        })\n        .addSliderInput({\n          path: 'fillOpacity',\n          name: t('state-timeline.name-fill-opacity', 'Fill opacity'),\n          category,\n          defaultValue: defaultFieldConfig.fillOpacity,\n          settings: {\n            min: 0,\n            max: 100,\n            step: 1,\n          },\n        })\n        .addCustomEditor<NullEditorSettings, boolean>({\n          id: 'spanNulls',\n          path: 'spanNulls',\n          name: t('state-timeline.name-connect-null-values', 'Connect null values'),\n          category,\n          defaultValue: false,\n          editor: SpanNullsEditor,\n          override: SpanNullsEditor,\n          shouldApply: (field) => field.type !== FieldType.time,\n          process: identityOverrideProcessor,\n          settings: { isTime: true },\n        })\n        .addCustomEditor<NullEditorSettings, boolean>({\n          id: 'insertNulls',\n          path: 'insertNulls',\n          name: t('state-timeline.name-disconnect-values', 'Disconnect values'),\n          category,\n          defaultValue: false,\n          editor: InsertNullsEditor,\n          override: InsertNullsEditor,\n          shouldApply: (field) => field.type !== FieldType.time,\n          process: identityOverrideProcessor,\n          settings: { isTime: true },\n        });\n\n      commonOptionsBuilder.addHideFrom(builder);\n      commonOptionsBuilder.addAxisPlacement(\n        builder,\n        (placement) => placement === AxisPlacement.Auto || placement === AxisPlacement.Hidden\n      );\n      commonOptionsBuilder.addAxisWidth(builder);\n    },\n  })\n  .setPanelOptions((builder) => {\n    const category = [t('state-timeline.category-state-timeline', 'State timeline')];\n    builder\n      .addBooleanSwitch({\n        path: 'mergeValues',\n        name: t('state-timeline.name-merge-equal-consecutive-values', 'Merge equal consecutive values'),\n        category,\n        defaultValue: defaultOptions.mergeValues,\n      })\n      .addRadio({\n        path: 'showValue',\n        name: t('state-timeline.name-show-values', 'Show values'),\n        category,\n        settings: {\n          options: [\n            { value: VisibilityMode.Auto, label: t('state-timeline.show-values-options.label-auto', 'Auto') },\n            { value: VisibilityMode.Always, label: t('state-timeline.show-values-options.label-always', 'Always') },\n            { value: VisibilityMode.Never, label: t('state-timeline.show-values-options.label-never', 'Never') },\n          ],\n        },\n        defaultValue: defaultOptions.showValue,\n      })\n      .addRadio({\n        path: 'alignValue',\n        name: t('state-timeline.name-align-values', 'Align values'),\n        category,\n        settings: {\n          options: [\n            { value: 'left', label: t('state-timeline.align-values-options.label-left', 'Left') },\n            { value: 'center', label: t('state-timeline.align-values-options.label-center', 'Center') },\n            { value: 'right', label: t('state-timeline.align-values-options.label-right', 'Right') },\n          ],\n        },\n        defaultValue: defaultOptions.alignValue,\n      })\n      .addSliderInput({\n        path: 'rowHeight',\n        name: t('state-timeline.name-row-height', 'Row height'),\n        category,\n        settings: {\n          min: 0,\n          max: 1,\n          step: 0.01,\n        },\n        defaultValue: defaultOptions.rowHeight,\n      })\n      .addNumberInput({\n        path: 'perPage',\n        name: t('state-timeline.name-page-size', 'Page size (enable pagination)'),\n        category,\n        settings: {\n          min: 1,\n          step: 1,\n          integer: true,\n        },\n      });\n\n    commonOptionsBuilder.addLegendOptions(builder, false);\n    commonOptionsBuilder.addTooltipOptions(builder);\n  })\n  .setSuggestionsSupplier(new StatTimelineSuggestionsSupplier())\n  .setDataSupport({ annotations: true });\n"],"names":["StateTimelinePanel","data","timeRange","timeZone","options","width","height","fieldConfig","replaceVariables","onChangeTimeRange","panelId","theme","newAnnotationRange","setNewAnnotationRange","sync","eventsScope","canAddAnnotations","dataLinkPostProcessor","eventBus","cursorSync","frames","warn","paginatedFrames","paginationRev","paginationElement","paginationHeight","legendItems","timezones","PanelDataErrorView","enableAnnotationCreation","TimelineChart","builder","alignedFrame","EventBusPlugin","TooltipPlugin2","seriesIdx","dataIdx","u","dataIdxs","isPinned","dismiss","timeRange2","viaSync","dataLinks","annotate","xVal","StateTimelineTooltip2","AnnotationsPlugin2","OutsideRangePlugin","timelinePanelChangedHandler","panel","prevPluginId","prevOptions","oldOptions","custom","valuemap","p","color","text","value","old","from","to","expandColorMappings","mappings","keyToColor","m","isValueToText","key","target","isRangeMap","c","StatTimelineSuggestionsSupplier","ds","PanelPlugin","category","SpanNullsEditor","field","InsertNullsEditor","placement"],"sourceRoot":""}